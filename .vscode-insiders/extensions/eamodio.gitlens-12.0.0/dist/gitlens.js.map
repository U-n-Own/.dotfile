{"version":3,"file":"gitlens.js","mappings":"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","sources":["webpack://gitlens/./src/api/actionRunners.ts","webpack://gitlens/./src/avatars.ts","webpack://gitlens/./src/commands/addAuthors.ts","webpack://gitlens/./src/commands/browseRepoAtRevision.ts","webpack://gitlens/./src/commands/closeUnchangedFiles.ts","webpack://gitlens/./src/commands/compareWith.ts","webpack://gitlens/./src/commands/copyCurrentBranch.ts","webpack://gitlens/./src/commands/copyMessageToClipboard.ts","webpack://gitlens/./src/commands/copyShaToClipboard.ts","webpack://gitlens/./src/commands/createPullRequestOnRemote.ts","webpack://gitlens/./src/commands/openDirectoryCompare.ts","webpack://gitlens/./src/commands/diffLineWithPrevious.ts","webpack://gitlens/./src/commands/diffLineWithWorking.ts","webpack://gitlens/./src/commands/diffWith.ts","webpack://gitlens/./src/commands/diffWithNext.ts","webpack://gitlens/./src/commands/diffWithPrevious.ts","webpack://gitlens/./src/quickpicks/commitPicker.ts","webpack://gitlens/./src/commands/diffWithRevision.ts","webpack://gitlens/./src/commands/diffWithRevisionFrom.ts","webpack://gitlens/./src/commands/diffWithWorking.ts","webpack://gitlens/./src/@types/vscode.git.enums.ts","webpack://gitlens/./src/@types/vscode.git.resources.enums.ts","webpack://gitlens/./src/commands/externalDiff.ts","webpack://gitlens/./src/commands/gitCommands.ts","webpack://gitlens/./src/commands/inviteToLiveShare.ts","webpack://gitlens/./src/commands/logging.ts","webpack://gitlens/./src/commands/openAssociatedPullRequestOnRemote.ts","webpack://gitlens/./src/commands/openBranchesOnRemote.ts","webpack://gitlens/./src/commands/openBranchOnRemote.ts","webpack://gitlens/./src/commands/openChangedFiles.ts","webpack://gitlens/./src/commands/openCommitOnRemote.ts","webpack://gitlens/./src/commands/openComparisonOnRemote.ts","webpack://gitlens/./src/commands/openFileFromRemote.ts","webpack://gitlens/./src/commands/openFileOnRemote.ts","webpack://gitlens/./src/commands/openFileAtRevision.ts","webpack://gitlens/./src/commands/openFileAtRevisionFrom.ts","webpack://gitlens/./src/commands/openOnRemote.ts","webpack://gitlens/./src/commands/openIssueOnRemote.ts","webpack://gitlens/./src/commands/openPullRequestOnRemote.ts","webpack://gitlens/./src/commands/openRepoOnRemote.ts","webpack://gitlens/./src/commands/openRevisionFile.ts","webpack://gitlens/./src/commands/openWorkingFile.ts","webpack://gitlens/./src/commands/rebaseEditor.ts","webpack://gitlens/./src/commands/refreshHover.ts","webpack://gitlens/./src/commands/remoteProviders.ts","webpack://gitlens/./src/commands/repositories.ts","webpack://gitlens/./src/commands/resetAvatarCache.ts","webpack://gitlens/./src/commands/resetSuppressedWarnings.ts","webpack://gitlens/./src/commands/setViewsLayout.ts","webpack://gitlens/./src/commands/searchCommits.ts","webpack://gitlens/./src/commands/showCommitsInView.ts","webpack://gitlens/./src/commands/showLastQuickPick.ts","webpack://gitlens/./src/commands/showQuickBranchHistory.ts","webpack://gitlens/./src/commands/showQuickCommit.ts","webpack://gitlens/./src/commands/showQuickCommitFile.ts","webpack://gitlens/./src/commands/showQuickFileHistory.ts","webpack://gitlens/./src/commands/showQuickRepoStatus.ts","webpack://gitlens/./src/commands/showQuickStashList.ts","webpack://gitlens/./src/commands/showView.ts","webpack://gitlens/./src/commands/stashApply.ts","webpack://gitlens/./src/commands/stashSave.ts","webpack://gitlens/./src/quickpicks/modePicker.ts","webpack://gitlens/./src/commands/switchMode.ts","webpack://gitlens/./src/commands/toggleCodeLens.ts","webpack://gitlens/./src/commands/toggleFileAnnotations.ts","webpack://gitlens/./src/commands/toggleLineBlame.ts","webpack://gitlens/./src/commands/walkthroughs.ts","webpack://gitlens/./src/commands/base.ts","webpack://gitlens/./src/commands/gitCommands.actions.ts","webpack://gitlens/./src/quickpicks/items/flags.ts","webpack://gitlens/./src/commands/git/branch.ts","webpack://gitlens/./src/commands/git/cherry-pick.ts","webpack://gitlens/./src/commands/git/coauthors.ts","webpack://gitlens/./src/commands/git/fetch.ts","webpack://gitlens/./src/commands/git/log.ts","webpack://gitlens/./src/commands/git/merge.ts","webpack://gitlens/./src/commands/git/pull.ts","webpack://gitlens/./src/commands/git/push.ts","webpack://gitlens/./src/commands/git/rebase.ts","webpack://gitlens/./src/commands/git/reset.ts","webpack://gitlens/./src/commands/git/revert.ts","webpack://gitlens/./src/commands/git/search.ts","webpack://gitlens/./src/commands/git/show.ts","webpack://gitlens/./src/commands/git/stash.ts","webpack://gitlens/./src/commands/git/status.ts","webpack://gitlens/./src/commands/git/switch.ts","webpack://gitlens/./src/commands/git/tag.ts","webpack://gitlens/./src/commands/git/worktree.ts","webpack://gitlens/./src/commands/gitCommands.utils.ts","webpack://gitlens/./src/commands/quickCommand.buttons.ts","webpack://gitlens/./node_modules/lodash-es/_baseIsNaN.js","webpack://gitlens/./node_modules/lodash-es/_strictIndexOf.js","webpack://gitlens/./node_modules/lodash-es/_baseIndexOf.js","webpack://gitlens/./node_modules/lodash-es/_arrayIncludes.js","webpack://gitlens/./node_modules/lodash-es/_arrayIncludesWith.js","webpack://gitlens/./node_modules/lodash-es/_baseIntersection.js","webpack://gitlens/./node_modules/lodash-es/_apply.js","webpack://gitlens/./node_modules/lodash-es/_overRest.js","webpack://gitlens/./node_modules/lodash-es/constant.js","webpack://gitlens/./node_modules/lodash-es/_defineProperty.js","webpack://gitlens/./node_modules/lodash-es/_baseSetToString.js","webpack://gitlens/./node_modules/lodash-es/_shortOut.js","webpack://gitlens/./node_modules/lodash-es/_setToString.js","webpack://gitlens/./node_modules/lodash-es/_baseRest.js","webpack://gitlens/./node_modules/lodash-es/isArrayLikeObject.js","webpack://gitlens/./node_modules/lodash-es/_castArrayLikeObject.js","webpack://gitlens/./node_modules/lodash-es/last.js","webpack://gitlens/./node_modules/lodash-es/intersectionWith.js","webpack://gitlens/./src/commands/quickCommand.steps.ts","webpack://gitlens/./src/commands/quickCommand.ts","webpack://gitlens/./src/comparers.ts","webpack://gitlens/./src/config.ts","webpack://gitlens/./node_modules/lodash-es/isEqual.js","webpack://gitlens/./src/configuration.ts","webpack://gitlens/./src/constants.ts","webpack://gitlens/./src/git/commandOptions.ts","webpack://gitlens/./src/git/parsers/blameParser.ts","webpack://gitlens/./src/git/parsers/branchParser.ts","webpack://gitlens/./src/git/parsers/logParser.ts","webpack://gitlens/./src/git/parsers/reflogParser.ts","webpack://gitlens/./src/git/parsers/remoteParser.ts","webpack://gitlens/./src/git/parsers/stashParser.ts","webpack://gitlens/./src/git/parsers/statusParser.ts","webpack://gitlens/./src/git/parsers/tagParser.ts","webpack://gitlens/./src/git/parsers/treeParser.ts","webpack://gitlens/./src/git/parsers/worktreeParser.ts","webpack://gitlens/external node-commonjs \"child_process\"","webpack://gitlens/external node-commonjs \"fs\"","webpack://gitlens/./src/env/node/git/shell.ts","webpack://gitlens/./src/env/node/git/git.ts","webpack://gitlens/external node-commonjs \"os\"","webpack://gitlens/./src/env/node/git/locator.ts","webpack://gitlens/./src/env/node/git/localGitProvider.ts","webpack://gitlens/./src/env/node/git/vslsGitProvider.ts","webpack://gitlens/./src/env/node/providers.ts","webpack://gitlens/./src/annotations/autolinks.ts","webpack://gitlens/./src/annotations/annotationProvider.ts","webpack://gitlens/./src/webviews/apps/shared/colors.ts","webpack://gitlens/./src/annotations/annotations.ts","webpack://gitlens/./src/hovers/hovers.ts","webpack://gitlens/./src/annotations/blameAnnotationProvider.ts","webpack://gitlens/./src/annotations/gutterBlameAnnotationProvider.ts","webpack://gitlens/./src/annotations/gutterChangesAnnotationProvider.ts","webpack://gitlens/./src/annotations/gutterHeatmapBlameAnnotationProvider.ts","webpack://gitlens/./src/annotations/fileAnnotationController.ts","webpack://gitlens/./src/annotations/lineAnnotationController.ts","webpack://gitlens/./src/codelens/codeLensProvider.ts","webpack://gitlens/./src/codelens/codeLensController.ts","webpack://gitlens/./src/system/searchTree.ts","webpack://gitlens/./src/git/fsProvider.ts","webpack://gitlens/./src/hovers/lineHoverController.ts","webpack://gitlens/./src/keyboard.ts","webpack://gitlens/./src/premium/subscription/subscriptionService.ts","webpack://gitlens/./src/webviews/protocol.ts","webpack://gitlens/./src/webviews/webviewBase.ts","webpack://gitlens/./src/premium/webviews/timeline/protocol.ts","webpack://gitlens/./src/webviews/webviewViewBase.ts","webpack://gitlens/./src/premium/webviews/timeline/timelineWebviewView.ts","webpack://gitlens/./src/premium/webviews/timeline/timelineWebview.ts","webpack://gitlens/./src/statusbar/statusBarController.ts","webpack://gitlens/./src/terminal/linkProvider.ts","webpack://gitlens/./src/trackers/lineTracker.ts","webpack://gitlens/./src/trackers/gitLineTracker.ts","webpack://gitlens/./src/views/branchesView.ts","webpack://gitlens/./src/views/commitsView.ts","webpack://gitlens/./src/views/contributorsView.ts","webpack://gitlens/./src/views/lineHistoryView.ts","webpack://gitlens/./src/views/searchAndCompareView.ts","webpack://gitlens/./src/views/stashesView.ts","webpack://gitlens/./src/views/viewCommands.ts","webpack://gitlens/./src/views/viewDecorationProvider.ts","webpack://gitlens/./src/vsls/protocol.ts","webpack://gitlens/./src/vsls/host.ts","webpack://gitlens/./src/vsls/guest.ts","webpack://gitlens/./src/vsls/vsls.ts","webpack://gitlens/./src/webviews/home/protocol.ts","webpack://gitlens/./src/webviews/home/homeWebviewView.ts","webpack://gitlens/./src/webviews/rebase/protocol.ts","webpack://gitlens/./src/webviews/rebase/rebaseEditor.ts","webpack://gitlens/./src/webviews/webviewWithConfigBase.ts","webpack://gitlens/./src/webviews/settings/settingsWebview.ts","webpack://gitlens/./src/webviews/welcome/welcomeWebview.ts","webpack://gitlens/./src/container.ts","webpack://gitlens/./src/context.ts","webpack://gitlens/./src/emojis.ts","webpack://gitlens/external node-commonjs \"crypto\"","webpack://gitlens/./src/env/node/crypto.ts","webpack://gitlens/./src/env/node/hex.ts","webpack://gitlens/external node-commonjs \"process\"","webpack://gitlens/./src/env/node/platform.ts","webpack://gitlens/./src/errors.ts","webpack://gitlens/./src/features.ts","webpack://gitlens/./src/git/errors.ts","webpack://gitlens/./src/git/formatters/commitFormatter.ts","webpack://gitlens/./src/git/formatters/formatter.ts","webpack://gitlens/./src/git/formatters/statusFormatter.ts","webpack://gitlens/./src/git/gitProvider.ts","webpack://gitlens/./src/git/gitProviderService.ts","webpack://gitlens/./src/git/gitUri.ts","webpack://gitlens/./src/git/models/contributor.ts","webpack://gitlens/./src/git/models/issue.ts","webpack://gitlens/./src/git/models/pullRequest.ts","webpack://gitlens/./src/git/models/remote.ts","webpack://gitlens/./src/git/models/repository.ts","webpack://gitlens/./src/git/models/tag.ts","webpack://gitlens/./src/git/models/user.ts","webpack://gitlens/./src/git/models/branch.ts","webpack://gitlens/./src/git/models/commit.ts","webpack://gitlens/./src/git/models/diff.ts","webpack://gitlens/./src/git/models/file.ts","webpack://gitlens/./src/git/models/reference.ts","webpack://gitlens/./src/git/models/reflog.ts","webpack://gitlens/./src/git/models/status.ts","webpack://gitlens/./src/git/models/worktree.ts","webpack://gitlens/./src/git/parsers/diffParser.ts","webpack://gitlens/./src/git/remotes/azure-devops.ts","webpack://gitlens/./src/git/remotes/bitbucket.ts","webpack://gitlens/./src/git/remotes/bitbucket-server.ts","webpack://gitlens/./src/git/remotes/custom.ts","webpack://gitlens/./src/git/remotes/gerrit.ts","webpack://gitlens/./src/git/remotes/gitea.ts","webpack://gitlens/./src/git/remotes/github.ts","webpack://gitlens/./src/git/remotes/gitlab.ts","webpack://gitlens/./src/git/remotes/factory.ts","webpack://gitlens/./src/git/remotes/provider.ts","webpack://gitlens/./src/git/search.ts","webpack://gitlens/./src/logger.ts","webpack://gitlens/./src/messages.ts","webpack://gitlens/./src/quickpicks/items/commits.ts","webpack://gitlens/./src/quickpicks/items/common.ts","webpack://gitlens/./src/quickpicks/items/directive.ts","webpack://gitlens/./src/quickpicks/items/gitCommands.ts","webpack://gitlens/./src/quickpicks/referencePicker.ts","webpack://gitlens/./src/quickpicks/remoteProviderPicker.ts","webpack://gitlens/./src/quickpicks/repositoryPicker.ts","webpack://gitlens/./src/repositories.ts","webpack://gitlens/./src/storage.ts","webpack://gitlens/./src/subscription.ts","webpack://gitlens/./src/system/array.ts","webpack://gitlens/./src/system/command.ts","webpack://gitlens/./src/system/date.ts","webpack://gitlens/./src/system/decorators/gate.ts","webpack://gitlens/./src/system/decorators/log.ts","webpack://gitlens/./src/system/decorators/memoize.ts","webpack://gitlens/./src/system/decorators/resolver.ts","webpack://gitlens/./src/system/decorators/timeout.ts","webpack://gitlens/./src/system/encoding.ts","webpack://gitlens/./src/system/event.ts","webpack://gitlens/./src/system/formatPath.ts","webpack://gitlens/./node_modules/lodash-es/now.js","webpack://gitlens/./node_modules/lodash-es/debounce.js","webpack://gitlens/./node_modules/lodash-es/before.js","webpack://gitlens/./node_modules/lodash-es/once.js","webpack://gitlens/./src/system/function.ts","webpack://gitlens/./src/system/iterable.ts","webpack://gitlens/./src/system/path.ts","webpack://gitlens/./src/system/promise.ts","webpack://gitlens/./src/system/stopwatch.ts","webpack://gitlens/./node_modules/ansi-regex/index.js","webpack://gitlens/./src/env/node/base64.ts","webpack://gitlens/./src/system/string.ts","webpack://gitlens/./src/system/trie.ts","webpack://gitlens/./src/system/utils.ts","webpack://gitlens/./src/system/version.ts","webpack://gitlens/./src/terminal.ts","webpack://gitlens/./src/trackers/trackedDocument.ts","webpack://gitlens/./src/trackers/documentTracker.ts","webpack://gitlens/./src/trackers/gitDocumentTracker.ts","webpack://gitlens/./src/views/fileHistoryView.ts","webpack://gitlens/./src/views/nodes/common.ts","webpack://gitlens/./src/views/nodes/folderNode.ts","webpack://gitlens/./src/views/nodes/mergeConflictCurrentChangesNode.ts","webpack://gitlens/./src/views/nodes/mergeConflictIncomingChangesNode.ts","webpack://gitlens/./src/views/nodes/fileRevisionAsCommitNode.ts","webpack://gitlens/./src/views/nodes/statusFileNode.ts","webpack://gitlens/./src/views/nodes/branchTrackingStatusFilesNode.ts","webpack://gitlens/./src/views/nodes/commitFileNode.ts","webpack://gitlens/./node_modules/lodash-es/_baseIsMatch.js","webpack://gitlens/./node_modules/lodash-es/_isStrictComparable.js","webpack://gitlens/./node_modules/lodash-es/_getMatchData.js","webpack://gitlens/./node_modules/lodash-es/_matchesStrictComparable.js","webpack://gitlens/./node_modules/lodash-es/_baseMatches.js","webpack://gitlens/./node_modules/lodash-es/_isKey.js","webpack://gitlens/./node_modules/lodash-es/memoize.js","webpack://gitlens/./node_modules/lodash-es/_memoizeCapped.js","webpack://gitlens/./node_modules/lodash-es/_stringToPath.js","webpack://gitlens/./node_modules/lodash-es/_baseToString.js","webpack://gitlens/./node_modules/lodash-es/toString.js","webpack://gitlens/./node_modules/lodash-es/_castPath.js","webpack://gitlens/./node_modules/lodash-es/_toKey.js","webpack://gitlens/./node_modules/lodash-es/_baseGet.js","webpack://gitlens/./node_modules/lodash-es/get.js","webpack://gitlens/./node_modules/lodash-es/_baseHasIn.js","webpack://gitlens/./node_modules/lodash-es/_hasPath.js","webpack://gitlens/./node_modules/lodash-es/hasIn.js","webpack://gitlens/./node_modules/lodash-es/_baseMatchesProperty.js","webpack://gitlens/./node_modules/lodash-es/_baseProperty.js","webpack://gitlens/./node_modules/lodash-es/_basePropertyDeep.js","webpack://gitlens/./node_modules/lodash-es/property.js","webpack://gitlens/./node_modules/lodash-es/_baseIteratee.js","webpack://gitlens/./node_modules/lodash-es/findLastIndex.js","webpack://gitlens/./src/views/nodes/autolinkedItemsNode.ts","webpack://gitlens/./src/views/nodes/helpers.ts","webpack://gitlens/./src/views/nodes/resultsFileNode.ts","webpack://gitlens/./src/views/nodes/resultsFilesNode.ts","webpack://gitlens/./src/views/nodes/resultsCommitsNode.ts","webpack://gitlens/./src/views/nodes/compareBranchNode.ts","webpack://gitlens/./src/views/nodes/contributorNode.ts","webpack://gitlens/./src/views/nodes/contributorsNode.ts","webpack://gitlens/./src/views/nodes/mergeConflictFileNode.ts","webpack://gitlens/./src/views/nodes/mergeStatusNode.ts","webpack://gitlens/./src/views/nodes/rebaseStatusNode.ts","webpack://gitlens/./src/views/nodes/reflogRecordNode.ts","webpack://gitlens/./src/views/nodes/reflogNode.ts","webpack://gitlens/./src/views/nodes/branchOrTagFolderNode.ts","webpack://gitlens/./src/views/nodes/remoteNode.ts","webpack://gitlens/./src/views/nodes/remotesNode.ts","webpack://gitlens/./src/views/nodes/stashNode.ts","webpack://gitlens/./src/views/nodes/stashesNode.ts","webpack://gitlens/./src/views/nodes/statusFilesNode.ts","webpack://gitlens/./src/views/nodes/tagNode.ts","webpack://gitlens/./src/views/nodes/tagsNode.ts","webpack://gitlens/./src/views/nodes/UncommittedFileNode.ts","webpack://gitlens/./src/views/nodes/UncommittedFilesNode.ts","webpack://gitlens/./src/views/nodes/worktreeNode.ts","webpack://gitlens/./src/views/nodes/worktreesNode.ts","webpack://gitlens/./src/views/nodes/repositoryNode.ts","webpack://gitlens/./src/views/nodes/pullRequestNode.ts","webpack://gitlens/./src/views/nodes/commitNode.ts","webpack://gitlens/./src/views/nodes/branchTrackingStatusNode.ts","webpack://gitlens/./src/views/nodes/branchNode.ts","webpack://gitlens/./src/views/nodes/branchesNode.ts","webpack://gitlens/./src/views/nodes/compareResultsNode.ts","webpack://gitlens/./src/views/nodes/fileHistoryTrackerNode.ts","webpack://gitlens/./src/views/nodes/fileHistoryNode.ts","webpack://gitlens/./src/views/nodes/lineHistoryTrackerNode.ts","webpack://gitlens/./src/views/nodes/lineHistoryNode.ts","webpack://gitlens/./src/views/nodes/repositoriesNode.ts","webpack://gitlens/./src/views/nodes/searchResultsNode.ts","webpack://gitlens/./src/views/nodes/stashFileNode.ts","webpack://gitlens/./src/views/nodes/autolinkedItemNode.ts","webpack://gitlens/./src/views/nodes/comparePickerNode.ts","webpack://gitlens/./src/views/nodes/viewNode.ts","webpack://gitlens/./src/views/remotesView.ts","webpack://gitlens/./src/views/repositoriesView.ts","webpack://gitlens/./src/views/tagsView.ts","webpack://gitlens/./src/views/viewBase.ts","webpack://gitlens/./src/views/worktreesView.ts","webpack://gitlens/./node_modules/iconv-lite/encodings/dbcs-codec.js","webpack://gitlens/./node_modules/iconv-lite/encodings/dbcs-data.js","webpack://gitlens/./node_modules/iconv-lite/encodings/index.js","webpack://gitlens/./node_modules/iconv-lite/encodings/internal.js","webpack://gitlens/./node_modules/iconv-lite/encodings/sbcs-codec.js","webpack://gitlens/./node_modules/iconv-lite/encodings/sbcs-data-generated.js","webpack://gitlens/./node_modules/iconv-lite/encodings/sbcs-data.js","webpack://gitlens/./node_modules/iconv-lite/encodings/utf16.js","webpack://gitlens/./node_modules/iconv-lite/encodings/utf32.js","webpack://gitlens/./node_modules/iconv-lite/encodings/utf7.js","webpack://gitlens/./node_modules/iconv-lite/lib/bom-handling.js","webpack://gitlens/./node_modules/iconv-lite/lib/index.js","webpack://gitlens/./node_modules/iconv-lite/lib/streams.js","webpack://gitlens/./node_modules/safer-buffer/safer.js","webpack://gitlens/./node_modules/webidl-conversions/lib/index.js","webpack://gitlens/./node_modules/whatwg-url/lib/URL-impl.js","webpack://gitlens/./node_modules/whatwg-url/lib/URL.js","webpack://gitlens/./node_modules/whatwg-url/lib/public-api.js","webpack://gitlens/./node_modules/whatwg-url/lib/url-state-machine.js","webpack://gitlens/./node_modules/whatwg-url/lib/utils.js","webpack://gitlens/./patches/tr46.js","webpack://gitlens/external commonjs \"vscode\"","webpack://gitlens/external node-commonjs \"buffer\"","webpack://gitlens/external node-commonjs \"path\"","webpack://gitlens/external node-commonjs \"punycode\"","webpack://gitlens/external node-commonjs \"stream\"","webpack://gitlens/external node-commonjs \"string_decoder\"","webpack://gitlens/./node_modules/lodash-es/_listCacheClear.js","webpack://gitlens/./node_modules/lodash-es/_assocIndexOf.js","webpack://gitlens/./node_modules/lodash-es/_listCacheDelete.js","webpack://gitlens/./node_modules/lodash-es/_listCacheGet.js","webpack://gitlens/./node_modules/lodash-es/_listCacheHas.js","webpack://gitlens/./node_modules/lodash-es/_listCacheSet.js","webpack://gitlens/./node_modules/lodash-es/_ListCache.js","webpack://gitlens/./node_modules/lodash-es/_Map.js","webpack://gitlens/./node_modules/lodash-es/_nativeCreate.js","webpack://gitlens/./node_modules/lodash-es/_hashClear.js","webpack://gitlens/./node_modules/lodash-es/_hashDelete.js","webpack://gitlens/./node_modules/lodash-es/_hashGet.js","webpack://gitlens/./node_modules/lodash-es/_hashHas.js","webpack://gitlens/./node_modules/lodash-es/_hashSet.js","webpack://gitlens/./node_modules/lodash-es/_Hash.js","webpack://gitlens/./node_modules/lodash-es/_mapCacheClear.js","webpack://gitlens/./node_modules/lodash-es/_isKeyable.js","webpack://gitlens/./node_modules/lodash-es/_getMapData.js","webpack://gitlens/./node_modules/lodash-es/_mapCacheDelete.js","webpack://gitlens/./node_modules/lodash-es/_mapCacheGet.js","webpack://gitlens/./node_modules/lodash-es/_mapCacheHas.js","webpack://gitlens/./node_modules/lodash-es/_mapCacheSet.js","webpack://gitlens/./node_modules/lodash-es/_MapCache.js","webpack://gitlens/./node_modules/lodash-es/_setCacheAdd.js","webpack://gitlens/./node_modules/lodash-es/_setCacheHas.js","webpack://gitlens/./node_modules/lodash-es/_SetCache.js","webpack://gitlens/./node_modules/lodash-es/_stackClear.js","webpack://gitlens/./node_modules/lodash-es/_stackDelete.js","webpack://gitlens/./node_modules/lodash-es/_stackGet.js","webpack://gitlens/./node_modules/lodash-es/_stackHas.js","webpack://gitlens/./node_modules/lodash-es/_stackSet.js","webpack://gitlens/./node_modules/lodash-es/_Stack.js","webpack://gitlens/./node_modules/lodash-es/_Symbol.js","webpack://gitlens/./node_modules/lodash-es/_arrayMap.js","webpack://gitlens/./node_modules/lodash-es/_baseFindIndex.js","webpack://gitlens/./node_modules/lodash-es/_getRawTag.js","webpack://gitlens/./node_modules/lodash-es/_objectToString.js","webpack://gitlens/./node_modules/lodash-es/_baseGetTag.js","webpack://gitlens/./node_modules/lodash-es/_arraySome.js","webpack://gitlens/./node_modules/lodash-es/_equalArrays.js","webpack://gitlens/./node_modules/lodash-es/_Uint8Array.js","webpack://gitlens/./node_modules/lodash-es/_mapToArray.js","webpack://gitlens/./node_modules/lodash-es/_setToArray.js","webpack://gitlens/./node_modules/lodash-es/_equalByTag.js","webpack://gitlens/./node_modules/lodash-es/_arrayPush.js","webpack://gitlens/./node_modules/lodash-es/_baseGetAllKeys.js","webpack://gitlens/./node_modules/lodash-es/_arrayFilter.js","webpack://gitlens/./node_modules/lodash-es/stubArray.js","webpack://gitlens/./node_modules/lodash-es/_getSymbols.js","webpack://gitlens/./node_modules/lodash-es/_getAllKeys.js","webpack://gitlens/./node_modules/lodash-es/_equalObjects.js","webpack://gitlens/./node_modules/lodash-es/_DataView.js","webpack://gitlens/./node_modules/lodash-es/_Promise.js","webpack://gitlens/./node_modules/lodash-es/_Set.js","webpack://gitlens/./node_modules/lodash-es/_WeakMap.js","webpack://gitlens/./node_modules/lodash-es/_getTag.js","webpack://gitlens/./node_modules/lodash-es/_baseIsEqualDeep.js","webpack://gitlens/./node_modules/lodash-es/_baseIsEqual.js","webpack://gitlens/./node_modules/lodash-es/_baseUnary.js","webpack://gitlens/./node_modules/lodash-es/_cacheHas.js","webpack://gitlens/./node_modules/lodash-es/_freeGlobal.js","webpack://gitlens/./node_modules/lodash-es/_coreJsData.js","webpack://gitlens/./node_modules/lodash-es/_isMasked.js","webpack://gitlens/./node_modules/lodash-es/_baseIsNative.js","webpack://gitlens/./node_modules/lodash-es/_getValue.js","webpack://gitlens/./node_modules/lodash-es/_getNative.js","webpack://gitlens/./node_modules/lodash-es/_isIndex.js","webpack://gitlens/./node_modules/lodash-es/_root.js","webpack://gitlens/./node_modules/lodash-es/_toSource.js","webpack://gitlens/./node_modules/lodash-es/eq.js","webpack://gitlens/./node_modules/lodash-es/identity.js","webpack://gitlens/./node_modules/lodash-es/_baseIsArguments.js","webpack://gitlens/./node_modules/lodash-es/isArguments.js","webpack://gitlens/./node_modules/lodash-es/isArray.js","webpack://gitlens/./node_modules/lodash-es/isArrayLike.js","webpack://gitlens/./node_modules/lodash-es/stubFalse.js","webpack://gitlens/./node_modules/lodash-es/isBuffer.js","webpack://gitlens/./node_modules/lodash-es/isFunction.js","webpack://gitlens/./node_modules/lodash-es/isLength.js","webpack://gitlens/./node_modules/lodash-es/isObject.js","webpack://gitlens/./node_modules/lodash-es/isObjectLike.js","webpack://gitlens/./node_modules/lodash-es/isSymbol.js","webpack://gitlens/./node_modules/lodash-es/_baseIsTypedArray.js","webpack://gitlens/./node_modules/lodash-es/_nodeUtil.js","webpack://gitlens/./node_modules/lodash-es/isTypedArray.js","webpack://gitlens/./node_modules/lodash-es/_baseTimes.js","webpack://gitlens/./node_modules/lodash-es/_arrayLikeKeys.js","webpack://gitlens/./node_modules/lodash-es/_isPrototype.js","webpack://gitlens/./node_modules/lodash-es/_overArg.js","webpack://gitlens/./node_modules/lodash-es/_nativeKeys.js","webpack://gitlens/./node_modules/lodash-es/_baseKeys.js","webpack://gitlens/./node_modules/lodash-es/keys.js","webpack://gitlens/./node_modules/lodash-es/toFinite.js","webpack://gitlens/./node_modules/lodash-es/toInteger.js","webpack://gitlens/./node_modules/lodash-es/_trimmedEndIndex.js","webpack://gitlens/./node_modules/lodash-es/_baseTrim.js","webpack://gitlens/./node_modules/lodash-es/toNumber.js","webpack://gitlens/external node-commonjs \"http\"","webpack://gitlens/external node-commonjs \"url\"","webpack://gitlens/external node-commonjs \"https\"","webpack://gitlens/external node-commonjs \"zlib\"","webpack://gitlens/./node_modules/node-fetch/lib/index.mjs","webpack://gitlens/webpack/bootstrap","webpack://gitlens/webpack/runtime/compat get default export","webpack://gitlens/webpack/runtime/create fake namespace object","webpack://gitlens/webpack/runtime/define property getters","webpack://gitlens/webpack/runtime/ensure chunk","webpack://gitlens/webpack/runtime/get javascript chunk filename","webpack://gitlens/webpack/runtime/hasOwnProperty shorthand","webpack://gitlens/webpack/runtime/make namespace object","webpack://gitlens/webpack/runtime/require chunk loading","webpack://gitlens/./src/api/api.ts","webpack://gitlens/./src/partners.ts","webpack://gitlens/./src/extension.ts"],"sourcesContent":["import { commands, Disposable, Event, EventEmitter, QuickPickItem, window } from 'vscode';\nimport { Config, configuration } from '../configuration';\nimport { Commands, ContextKeys } from '../constants';\nimport { Container } from '../container';\nimport { setContext } from '../context';\nimport { sortCompare } from '../system/string';\nimport { getQuickPickIgnoreFocusOut } from '../system/utils';\nimport type { Action, ActionContext, ActionRunner } from './gitlens';\n\ntype Actions = ActionContext['type'];\nconst actions: Actions[] = ['createPullRequest', 'openPullRequest', 'hover.commands'];\n\n// The order here determines the sorting of these actions when shown to the user\nexport const enum ActionRunnerType {\n\tBuiltIn = 0,\n\tBuiltInPartner = 1,\n\tPartner = 2,\n\tBuiltInPartnerInstaller = 3,\n}\n\nexport const builtInActionRunnerName = 'Built In';\n\nclass ActionRunnerQuickPickItem implements QuickPickItem {\n\tprivate readonly _label: string;\n\n\tconstructor(public readonly runner: RegisteredActionRunner, context: ActionContext) {\n\t\tthis._label = typeof runner.label === 'string' ? runner.label : runner.label(context);\n\t}\n\n\tget label(): string {\n\t\treturn this._label;\n\t}\n\n\tget detail(): string | undefined {\n\t\treturn this.runner.name;\n\t}\n}\n\nclass NoActionRunnersQuickPickItem implements QuickPickItem {\n\tpublic readonly runner: RegisteredActionRunner | undefined;\n\n\tget label(): string {\n\t\treturn 'No actions were found';\n\t}\n\n\tget detail(): string | undefined {\n\t\treturn undefined;\n\t}\n}\n\nlet runnerId = 0;\nfunction nextRunnerId() {\n\tif (runnerId === Number.MAX_SAFE_INTEGER) {\n\t\trunnerId = 1;\n\t} else {\n\t\trunnerId++;\n\t}\n\n\treturn runnerId;\n}\n\nclass RegisteredActionRunner<T extends ActionContext = ActionContext> implements ActionRunner<T>, Disposable {\n\treadonly id: number;\n\n\tconstructor(\n\t\tpublic readonly type: ActionRunnerType,\n\t\tprivate readonly runner: ActionRunner<T>,\n\t\tprivate readonly unregister: () => void,\n\t) {\n\t\tthis.id = nextRunnerId();\n\t}\n\n\tdispose() {\n\t\tthis.unregister();\n\t}\n\n\tget name(): string {\n\t\treturn this.runner.name;\n\t}\n\n\tget label(): string | ((context: T) => string) {\n\t\treturn this.runner.label;\n\t}\n\n\tget order(): number {\n\t\tswitch (this.type) {\n\t\t\tcase ActionRunnerType.BuiltIn:\n\t\t\t\treturn 0;\n\n\t\t\tcase ActionRunnerType.BuiltInPartner:\n\t\t\t\treturn 1;\n\n\t\t\tcase ActionRunnerType.Partner:\n\t\t\t\t// Sort built-in partners and partners with ids the same\n\t\t\t\treturn this.partnerId ? 1 : 2;\n\n\t\t\tcase ActionRunnerType.BuiltInPartnerInstaller:\n\t\t\t\treturn 3;\n\n\t\t\tdefault:\n\t\t\t\treturn 100;\n\t\t}\n\t}\n\n\tget partnerId(): string {\n\t\treturn this.runner.partnerId;\n\t}\n\n\trun(context: T): void | Promise<void> {\n\t\treturn this.runner.run(context);\n\t}\n\n\t// when(context: ActionContext): boolean {\n\t// \ttry {\n\t// \t\treturn this.runner.when?.(context) ?? true;\n\t// \t} catch {\n\t// \t\treturn false;\n\t// \t}\n\t// }\n}\n\nexport class ActionRunners implements Disposable {\n\tprivate _onDidChange = new EventEmitter<Actions | undefined>();\n\tget onDidChange(): Event<Actions | undefined> {\n\t\treturn this._onDidChange.event;\n\t}\n\n\tprivate readonly _actionRunners = new Map<Actions, RegisteredActionRunner<any>[]>();\n\tprivate readonly _disposable: Disposable;\n\n\tconstructor(private readonly container: Container) {\n\t\tconst subscriptions: Disposable[] = [\n\t\t\tconfiguration.onDidChange(e => {\n\t\t\t\tif (!configuration.changed(e, 'partners')) return;\n\n\t\t\t\tvoid this._updateAllContextKeys();\n\t\t\t}),\n\t\t];\n\n\t\tfor (const action of actions) {\n\t\t\tsubscriptions.push(\n\t\t\t\tcommands.registerCommand(\n\t\t\t\t\t`${Commands.ActionPrefix}${action}`,\n\t\t\t\t\t(context: ActionContext, runnerId?: number) => this.run(context, runnerId),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tthis._disposable = Disposable.from(...subscriptions);\n\t}\n\n\tdispose() {\n\t\tthis._disposable.dispose();\n\n\t\tfor (const runners of this._actionRunners.values()) {\n\t\t\tfor (const runner of runners) {\n\t\t\t\trunner.dispose();\n\t\t\t}\n\t\t}\n\t\tthis._actionRunners.clear();\n\t}\n\n\tcount(action: Actions): number {\n\t\treturn this.get(action)?.length ?? 0;\n\t}\n\n\tget(action: Actions): RegisteredActionRunner[] | undefined {\n\t\treturn filterOnlyEnabledRunners(this.container.config, this._actionRunners.get(action));\n\t}\n\n\thas(action: Actions): boolean {\n\t\treturn this.count(action) > 0;\n\t}\n\n\tregister<T extends ActionContext>(\n\t\taction: Action<T>,\n\t\trunner: ActionRunner<T>,\n\t\ttype: ActionRunnerType = ActionRunnerType.Partner,\n\t): Disposable {\n\t\tlet runners = this._actionRunners.get(action);\n\t\tif (runners == null) {\n\t\t\trunners = [];\n\t\t\tthis._actionRunners.set(action, runners);\n\t\t}\n\n\t\tconst onChanged = (action: Actions) => {\n\t\t\tvoid this._updateContextKeys(action);\n\t\t\tthis._onDidChange.fire(action);\n\t\t};\n\n\t\tconst runnersMap = this._actionRunners;\n\n\t\tconst registeredRunner = new RegisteredActionRunner(type, runner, function (this: RegisteredActionRunner) {\n\t\t\tif (runners!.length === 1) {\n\t\t\t\trunnersMap.delete(action);\n\t\t\t\tonChanged(action);\n\t\t\t} else {\n\t\t\t\tconst index = runners!.indexOf(this);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\trunners!.splice(index, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\trunners.push(registeredRunner);\n\t\tonChanged(action);\n\n\t\treturn {\n\t\t\tdispose: () => registeredRunner.dispose(),\n\t\t};\n\t}\n\n\tregisterBuiltIn<T extends ActionContext>(\n\t\taction: Action<T>,\n\t\trunner: Omit<ActionRunner<T>, 'partnerId' | 'name'>,\n\t): Disposable {\n\t\treturn this.register(\n\t\t\taction,\n\t\t\t{ ...runner, partnerId: undefined!, name: builtInActionRunnerName },\n\t\t\tActionRunnerType.BuiltIn,\n\t\t);\n\t}\n\n\tregisterBuiltInPartner<T extends ActionContext>(\n\t\tpartnerId: string,\n\t\taction: Action<T>,\n\t\trunner: Omit<ActionRunner<T>, 'partnerId'>,\n\t): Disposable {\n\t\treturn this.register(action, { ...runner, partnerId: partnerId }, ActionRunnerType.BuiltInPartner);\n\t}\n\n\tregisterBuiltInPartnerInstaller<T extends ActionContext>(\n\t\tpartnerId: string,\n\t\taction: Action<T>,\n\t\trunner: Omit<ActionRunner<T>, 'partnerId'>,\n\t): Disposable {\n\t\treturn this.register(\n\t\t\taction,\n\t\t\t{ ...runner, partnerId: partnerId, name: `${runner.name} (Not Installed)` },\n\t\t\tActionRunnerType.BuiltInPartnerInstaller,\n\t\t);\n\t}\n\n\tasync run<T extends ActionContext>(context: T, runnerId?: number) {\n\t\tlet runners = this.get(context.type);\n\t\tif (runners == null || runners.length === 0) return;\n\n\t\tif (runnerId != null) {\n\t\t\trunners = runners.filter(r => r.id === runnerId);\n\t\t}\n\t\tif (runners.length === 0) return;\n\n\t\tlet runner;\n\n\t\tif (runners.length > 1 || runners.every(r => r.type !== ActionRunnerType.BuiltIn)) {\n\t\t\tconst items: (ActionRunnerQuickPickItem | NoActionRunnersQuickPickItem)[] = runners\n\t\t\t\t// .filter(r => r.when(context))\n\t\t\t\t.sort((a, b) => a.order - b.order || sortCompare(a.name, b.name))\n\t\t\t\t.map(r => new ActionRunnerQuickPickItem(r, context));\n\n\t\t\tif (items.length === 0) {\n\t\t\t\titems.push(new NoActionRunnersQuickPickItem());\n\t\t\t}\n\n\t\t\tconst quickpick = window.createQuickPick<ActionRunnerQuickPickItem | NoActionRunnersQuickPickItem>();\n\t\t\tquickpick.ignoreFocusOut = getQuickPickIgnoreFocusOut();\n\n\t\t\tconst disposables: Disposable[] = [];\n\n\t\t\ttry {\n\t\t\t\tconst pick = await new Promise<ActionRunnerQuickPickItem | NoActionRunnersQuickPickItem | undefined>(\n\t\t\t\t\tresolve => {\n\t\t\t\t\t\tdisposables.push(\n\t\t\t\t\t\t\tquickpick.onDidHide(() => resolve(undefined)),\n\t\t\t\t\t\t\tquickpick.onDidAccept(() => {\n\t\t\t\t\t\t\t\tif (quickpick.activeItems.length !== 0) {\n\t\t\t\t\t\t\t\t\tresolve(quickpick.activeItems[0]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tlet title;\n\t\t\t\t\t\tlet placeholder;\n\t\t\t\t\t\tswitch (context.type) {\n\t\t\t\t\t\t\tcase 'createPullRequest':\n\t\t\t\t\t\t\t\ttitle = 'Create Pull Request';\n\t\t\t\t\t\t\t\tplaceholder = 'Choose how to create a pull request';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'openPullRequest':\n\t\t\t\t\t\t\t\ttitle = 'Open Pull Request';\n\t\t\t\t\t\t\t\tplaceholder = 'Choose how to open the pull request';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'hover.commands':\n\t\t\t\t\t\t\t\ttitle = 'Need Help or Want to Collaborate?';\n\t\t\t\t\t\t\t\tplaceholder = 'Choose what you would like to do';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tdebugger;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tquickpick.title = title;\n\t\t\t\t\t\tquickpick.placeholder = placeholder;\n\t\t\t\t\t\tquickpick.matchOnDetail = true;\n\t\t\t\t\t\tquickpick.items = items;\n\n\t\t\t\t\t\tquickpick.show();\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tif (pick == null) return;\n\n\t\t\t\trunner = pick.runner;\n\t\t\t} finally {\n\t\t\t\tquickpick.dispose();\n\t\t\t\tdisposables.forEach(d => d.dispose());\n\t\t\t}\n\t\t} else {\n\t\t\t[runner] = runners;\n\t\t}\n\n\t\tawait runner?.run(context);\n\t}\n\n\tprivate async _updateContextKeys(action: Actions) {\n\t\tawait setContext(`${ContextKeys.ActionPrefix}${action}`, this.count(action));\n\t}\n\n\tprivate async _updateAllContextKeys() {\n\t\tfor (const action of actions) {\n\t\t\tawait this._updateContextKeys(action);\n\t\t}\n\t}\n}\n\nfunction filterOnlyEnabledRunners(config: Config, runners: RegisteredActionRunner[] | undefined) {\n\tif (runners == null || runners.length === 0) return undefined;\n\n\tconst partners = config.partners;\n\tif (partners == null) return runners;\n\n\treturn runners.filter(\n\t\tr => r.partnerId == null || (r.partnerId != null && partners[r.partnerId]?.enabled !== false),\n\t);\n}\n","import { EventEmitter, Uri } from 'vscode';\nimport { GravatarDefaultStyle } from './config';\nimport { Container } from './container';\nimport { GitRevisionReference } from './git/models';\nimport { StorageKeys } from './storage';\nimport { debounce } from './system/function';\nimport { filterMap } from './system/iterable';\nimport { base64, equalsIgnoreCase, md5 } from './system/string';\nimport { ContactPresenceStatus } from './vsls/vsls';\n\nconst _onDidFetchAvatar = new EventEmitter<{ email: string }>();\n_onDidFetchAvatar.event(\n\tdebounce(() => {\n\t\tconst avatars =\n\t\t\tavatarCache != null\n\t\t\t\t? [\n\t\t\t\t\t\t...filterMap(avatarCache, ([key, avatar]) =>\n\t\t\t\t\t\t\tavatar.uri != null\n\t\t\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\turi: avatar.uri.toString(),\n\t\t\t\t\t\t\t\t\t\t\ttimestamp: avatar.timestamp,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t  ]\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t),\n\t\t\t\t  ]\n\t\t\t\t: undefined;\n\t\tvoid Container.instance.storage.store(StorageKeys.Avatars, avatars);\n\t}, 1000),\n);\n\nexport namespace Avatars {\n\texport const onDidFetch = _onDidFetchAvatar.event;\n}\n\ninterface Avatar {\n\turi?: Uri;\n\tfallback?: Uri;\n\ttimestamp: number;\n\tretries: number;\n}\n\ninterface SerializedAvatar {\n\turi: string;\n\ttimestamp: number;\n}\n\nlet avatarCache: Map<string, Avatar> | undefined;\nconst avatarQueue = new Map<string, Promise<Uri>>();\n\nconst missingGravatarHash = '00000000000000000000000000000000';\n\nconst presenceCache = new Map<ContactPresenceStatus, string>();\n\nconst gitHubNoReplyAddressRegex = /^(?:(?<userId>\\d+)\\+)?(?<userName>[a-zA-Z\\d-]{1,39})@users\\.noreply\\.github\\.com$/;\n\nconst millisecondsPerMinute = 60 * 1000;\nconst millisecondsPerHour = 60 * 60 * 1000;\nconst millisecondsPerDay = 24 * 60 * 60 * 1000;\n\nconst retryDecay = [\n\tmillisecondsPerDay * 7, // First item is cache expiration (since retries will be 0)\n\tmillisecondsPerMinute,\n\tmillisecondsPerMinute * 5,\n\tmillisecondsPerMinute * 10,\n\tmillisecondsPerHour,\n\tmillisecondsPerDay,\n\tmillisecondsPerDay * 7,\n];\n\nexport function getAvatarUri(\n\temail: string | undefined,\n\trepoPathOrCommit: string | GitRevisionReference | undefined,\n\t{ defaultStyle, size = 16 }: { defaultStyle?: GravatarDefaultStyle; size?: number } = {},\n): Uri | Promise<Uri> {\n\tensureAvatarCache(avatarCache);\n\n\t// Double the size to avoid blurring on the retina screen\n\tsize *= 2;\n\n\tif (!email) {\n\t\tconst avatar = createOrUpdateAvatar(\n\t\t\t`${missingGravatarHash}:${size}`,\n\t\t\tundefined,\n\t\t\tsize,\n\t\t\tmissingGravatarHash,\n\t\t\tdefaultStyle,\n\t\t);\n\t\treturn avatar.uri ?? avatar.fallback!;\n\t}\n\n\tconst hash = md5(email.trim().toLowerCase(), 'hex');\n\tconst key = `${hash}:${size}`;\n\n\tconst avatar = createOrUpdateAvatar(key, email, size, hash, defaultStyle);\n\tif (avatar.uri != null) return avatar.uri;\n\n\tlet query = avatarQueue.get(key);\n\tif (query == null && repoPathOrCommit != null && hasAvatarExpired(avatar)) {\n\t\tquery = getAvatarUriFromRemoteProvider(avatar, key, email, repoPathOrCommit, { size: size }).then(\n\t\t\turi => uri ?? avatar.uri ?? avatar.fallback!,\n\t\t);\n\t\tavatarQueue.set(\n\t\t\tkey,\n\t\t\tquery.finally(() => avatarQueue.delete(key)),\n\t\t);\n\t}\n\n\tif (query != null) return query;\n\n\treturn avatar.uri ?? avatar.fallback!;\n}\n\nfunction createOrUpdateAvatar(\n\tkey: string,\n\temail: string | undefined,\n\tsize: number,\n\thash: string,\n\tdefaultStyle?: GravatarDefaultStyle,\n): Avatar {\n\tlet avatar = avatarCache!.get(key);\n\tif (avatar == null) {\n\t\tavatar = {\n\t\t\turi: email != null && email.length !== 0 ? getAvatarUriFromGitHubNoReplyAddress(email, size) : undefined,\n\t\t\tfallback: getAvatarUriFromGravatar(hash, size, defaultStyle),\n\t\t\ttimestamp: 0,\n\t\t\tretries: 0,\n\t\t};\n\t\tavatarCache!.set(key, avatar);\n\t} else if (avatar.fallback == null) {\n\t\tavatar.fallback = getAvatarUriFromGravatar(hash, size, defaultStyle);\n\t}\n\treturn avatar;\n}\n\nfunction ensureAvatarCache(cache: Map<string, Avatar> | undefined): asserts cache is Map<string, Avatar> {\n\tif (cache == null) {\n\t\tconst avatars: [string, Avatar][] | undefined = Container.instance.storage\n\t\t\t.get<[string, SerializedAvatar][]>(StorageKeys.Avatars)\n\t\t\t?.map<[string, Avatar]>(([key, avatar]) => [\n\t\t\t\tkey,\n\t\t\t\t{\n\t\t\t\t\turi: Uri.parse(avatar.uri),\n\t\t\t\t\ttimestamp: avatar.timestamp,\n\t\t\t\t\tretries: 0,\n\t\t\t\t},\n\t\t\t]);\n\t\tavatarCache = new Map<string, Avatar>(avatars);\n\t}\n}\n\nfunction hasAvatarExpired(avatar: Avatar) {\n\treturn Date.now() >= avatar.timestamp + retryDecay[Math.min(avatar.retries, retryDecay.length - 1)];\n}\n\nfunction getAvatarUriFromGravatar(\n\thash: string,\n\tsize: number,\n\tdefaultStyle: GravatarDefaultStyle = GravatarDefaultStyle.Robot,\n): Uri {\n\treturn Uri.parse(`https://www.gravatar.com/avatar/${hash}.jpg?s=${size}&d=${defaultStyle}`);\n}\n\nfunction getAvatarUriFromGitHubNoReplyAddress(email: string, size: number = 16): Uri | undefined {\n\tconst match = gitHubNoReplyAddressRegex.exec(email);\n\tif (match == null) return undefined;\n\n\tconst [, userId, userName] = match;\n\treturn Uri.parse(`https://avatars.githubusercontent.com/${userId ? `u/${userId}` : userName}?size=${size}`);\n}\n\nasync function getAvatarUriFromRemoteProvider(\n\tavatar: Avatar,\n\tkey: string,\n\temail: string,\n\trepoPathOrCommit: string | GitRevisionReference,\n\t{ size = 16 }: { size?: number } = {},\n) {\n\tensureAvatarCache(avatarCache);\n\n\ttry {\n\t\tlet account;\n\t\tif (Container.instance.config.integrations.enabled) {\n\t\t\t// if (typeof repoPathOrCommit === 'string') {\n\t\t\t// \tconst remote = await Container.instance.git.getRichRemoteProvider(repoPathOrCommit);\n\t\t\t// \taccount = await remote?.provider.getAccountForEmail(email, { avatarSize: size });\n\t\t\t// } else {\n\t\t\tif (typeof repoPathOrCommit !== 'string') {\n\t\t\t\tconst remote = await Container.instance.git.getRichRemoteProvider(repoPathOrCommit.repoPath);\n\t\t\t\taccount = await remote?.provider.getAccountForCommit(repoPathOrCommit.ref, { avatarSize: size });\n\t\t\t}\n\t\t}\n\t\tif (account == null) {\n\t\t\t// If we have no account assume that won't change (without a reset), so set the timestamp to \"never expire\"\n\t\t\tavatar.uri = undefined;\n\t\t\tavatar.timestamp = Number.MAX_SAFE_INTEGER;\n\t\t\tavatar.retries = 0;\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tavatar.uri = Uri.parse(account.avatarUrl);\n\t\tavatar.timestamp = Date.now();\n\t\tavatar.retries = 0;\n\n\t\tif (account.email != null && equalsIgnoreCase(email, account.email)) {\n\t\t\tavatarCache.set(`${md5(account.email.trim().toLowerCase(), 'hex')}:${size}`, { ...avatar });\n\t\t}\n\n\t\t_onDidFetchAvatar.fire({ email: email });\n\n\t\treturn avatar.uri;\n\t} catch {\n\t\tavatar.uri = undefined;\n\t\tavatar.timestamp = Date.now();\n\t\tavatar.retries++;\n\n\t\treturn undefined;\n\t}\n}\n\nconst presenceStatusColorMap = new Map<ContactPresenceStatus, string>([\n\t['online', '#28ca42'],\n\t['away', '#cecece'],\n\t['busy', '#ca5628'],\n\t['dnd', '#ca5628'],\n\t['offline', '#cecece'],\n]);\n\nexport function getPresenceDataUri(status: ContactPresenceStatus) {\n\tlet dataUri = presenceCache.get(status);\n\tif (dataUri == null) {\n\t\tconst contents = base64(`<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"4\" height=\"16\" viewBox=\"0 0 4 16\">\n\t<circle cx=\"2\" cy=\"14\" r=\"2\" fill=\"${presenceStatusColorMap.get(status)!}\"/>\n</svg>`);\n\t\tdataUri = encodeURI(`data:image/svg+xml;base64,${contents}`);\n\t\tpresenceCache.set(status, dataUri);\n\t}\n\n\treturn dataUri;\n}\n\nexport function resetAvatarCache(reset: 'all' | 'failed' | 'fallback') {\n\tswitch (reset) {\n\t\tcase 'all':\n\t\t\tvoid Container.instance.storage.delete(StorageKeys.Avatars);\n\t\t\tavatarCache?.clear();\n\t\t\tavatarQueue.clear();\n\t\t\tbreak;\n\n\t\tcase 'failed':\n\t\t\tfor (const avatar of avatarCache?.values() ?? []) {\n\t\t\t\t// Reset failed requests\n\t\t\t\tif (avatar.uri == null) {\n\t\t\t\t\tavatar.timestamp = 0;\n\t\t\t\t\tavatar.retries = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'fallback':\n\t\t\tfor (const avatar of avatarCache?.values() ?? []) {\n\t\t\t\tavatar.fallback = undefined;\n\t\t\t}\n\t\t\tbreak;\n\t}\n}\n","import { SourceControl } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { Command } from './base';\nimport { executeGitCommand } from './gitCommands.actions';\n\n@command()\nexport class AddAuthorsCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.AddAuthors);\n\t}\n\n\texecute(sourceControl: SourceControl) {\n\t\tlet repo;\n\t\tif (sourceControl?.rootUri != null) {\n\t\t\trepo = this.container.git.getRepository(sourceControl.rootUri);\n\t\t}\n\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'co-authors',\n\t\t\tstate: { repo: repo, contributors: undefined },\n\t\t});\n\t}\n}\n","import { TextEditor, Uri } from 'vscode';\nimport { Commands, CoreCommands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command, executeCoreCommand } from '../system/command';\nimport { basename } from '../system/path';\nimport { openWorkspace, OpenWorkspaceLocation } from '../system/utils';\nimport { ActiveEditorCommand, CommandContext, getCommandUri } from './base';\n\nexport interface BrowseRepoAtRevisionCommandArgs {\n\turi?: Uri;\n\n\tbefore?: boolean;\n\topenInNewWindow?: boolean;\n}\n\n@command()\nexport class BrowseRepoAtRevisionCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([\n\t\t\tCommands.BrowseRepoAtRevision,\n\t\t\tCommands.BrowseRepoAtRevisionInNewWindow,\n\t\t\tCommands.BrowseRepoBeforeRevision,\n\t\t\tCommands.BrowseRepoBeforeRevisionInNewWindow,\n\t\t]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: BrowseRepoAtRevisionCommandArgs) {\n\t\tswitch (context.command) {\n\t\t\tcase Commands.BrowseRepoAtRevisionInNewWindow:\n\t\t\t\targs = { ...args, before: false, openInNewWindow: true };\n\t\t\t\tbreak;\n\t\t\tcase Commands.BrowseRepoBeforeRevision:\n\t\t\t\targs = { ...args, before: true, openInNewWindow: false };\n\t\t\t\tbreak;\n\t\t\tcase Commands.BrowseRepoBeforeRevisionInNewWindow:\n\t\t\t\targs = { ...args, before: true, openInNewWindow: true };\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn this.execute(context.editor!, context.uri, args);\n\t}\n\n\tasync execute(editor: TextEditor, uri?: Uri, args?: BrowseRepoAtRevisionCommandArgs) {\n\t\targs = { ...args };\n\n\t\ttry {\n\t\t\tif (args.uri == null) {\n\t\t\t\turi = getCommandUri(uri, editor);\n\t\t\t\tif (uri == null) return;\n\t\t\t} else {\n\t\t\t\turi = args.uri;\n\t\t\t}\n\n\t\t\tlet gitUri = await GitUri.fromUri(uri);\n\t\t\tif (gitUri.sha == null) return;\n\n\t\t\tconst sha = args?.before\n\t\t\t\t? await this.container.git.resolveReference(gitUri.repoPath!, `${gitUri.sha}^`)\n\t\t\t\t: gitUri.sha;\n\t\t\turi = this.container.git.getRevisionUri(sha, gitUri.repoPath!, gitUri.repoPath!);\n\t\t\tgitUri = GitUri.fromRevisionUri(uri);\n\n\t\t\topenWorkspace(uri, {\n\t\t\t\tlocation: args.openInNewWindow ? OpenWorkspaceLocation.NewWindow : OpenWorkspaceLocation.AddToWorkspace,\n\t\t\t\tname: `${basename(gitUri.repoPath!)} @ ${gitUri.shortSha}`,\n\t\t\t});\n\n\t\t\tif (!args.openInNewWindow) {\n\t\t\t\tvoid executeCoreCommand(CoreCommands.FocusFilesExplorer);\n\t\t\t}\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'BrowseRepoAtRevisionCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open the repository at the specified revision');\n\t\t}\n\t}\n}\n","import { TextEditor, Uri, window } from 'vscode';\nimport { TextEditorComparer, UriComparer } from '../comparers';\nimport { Commands, CoreCommands } from '../constants';\nimport type { Container } from '../container';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { RepositoryPicker } from '../quickpicks/repositoryPicker';\nimport { command, executeCoreCommand } from '../system/command';\nimport { debounce } from '../system/function';\nimport { Command } from './base';\n\nexport interface CloseUnchangedFilesCommandArgs {\n\turis?: Uri[];\n}\n\n@command()\nexport class CloseUnchangedFilesCommand extends Command {\n\tprivate _onEditorChangedFn: ((editor: TextEditor | undefined) => void) | undefined;\n\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.CloseUnchangedFiles);\n\t}\n\n\tasync execute(args?: CloseUnchangedFilesCommandArgs) {\n\t\targs = { ...args };\n\n\t\ttry {\n\t\t\tif (args.uris == null) {\n\t\t\t\tconst repository = await RepositoryPicker.getRepositoryOrShow('Close All Unchanged Files');\n\t\t\t\tif (repository == null) return;\n\n\t\t\t\tconst status = await this.container.git.getStatusForRepo(repository.uri);\n\t\t\t\tif (status == null) {\n\t\t\t\t\tvoid window.showWarningMessage('Unable to close unchanged files');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\targs.uris = status.files.map(f => f.uri);\n\t\t\t}\n\n\t\t\tif (args.uris.length === 0) {\n\t\t\t\tvoid executeCoreCommand(CoreCommands.CloseAllEditors);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst disposable = window.onDidChangeActiveTextEditor(\n\t\t\t\tdebounce((e: TextEditor | undefined) => this._onEditorChangedFn?.(e), 50),\n\t\t\t);\n\n\t\t\tlet editor = window.activeTextEditor;\n\n\t\t\tlet count = 0;\n\t\t\tlet loopCount = 0;\n\t\t\tconst editors: TextEditor[] = [];\n\n\t\t\t// Find out how many editors there are\n\t\t\twhile (true) {\n\t\t\t\tif (editor != null) {\n\t\t\t\t\tlet found = false;\n\t\t\t\t\tfor (const e of editors) {\n\t\t\t\t\t\tif (TextEditorComparer.equals(e, editor, { usePosition: true })) {\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (found) break;\n\n\t\t\t\t\t// Start counting at the first real editor\n\t\t\t\t\tcount++;\n\t\t\t\t\teditors.push(editor);\n\t\t\t\t} else if (count !== 0) {\n\t\t\t\t\tcount++;\n\t\t\t\t}\n\n\t\t\t\teditor = await this.nextEditor();\n\n\t\t\t\tloopCount++;\n\t\t\t\t// Break out if we've looped 4 times and haven't found any editors\n\t\t\t\tif (loopCount >= 4 && editors.length === 0) break;\n\t\t\t}\n\n\t\t\tif (editors.length) {\n\t\t\t\teditor = window.activeTextEditor;\n\n\t\t\t\tfor (let i = 0; i <= count; i++) {\n\t\t\t\t\tif (\n\t\t\t\t\t\teditor == null ||\n\t\t\t\t\t\teditor.document.isDirty ||\n\t\t\t\t\t\t// eslint-disable-next-line no-loop-func\n\t\t\t\t\t\targs.uris.some(uri => UriComparer.equals(uri, editor?.document.uri))\n\t\t\t\t\t) {\n\t\t\t\t\t\teditor = await this.nextEditor();\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor = await this.closeEditor();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdisposable.dispose();\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'CloseUnchangedFilesCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to close all unchanged files');\n\t\t}\n\t}\n\n\tprivate async closeEditor(timeout: number = 500): Promise<TextEditor | undefined> {\n\t\tconst editor = window.activeTextEditor;\n\n\t\tvoid (await executeCoreCommand(CoreCommands.CloseActiveEditor));\n\n\t\tif (editor !== window.activeTextEditor) {\n\t\t\treturn window.activeTextEditor;\n\t\t}\n\n\t\treturn this.waitForEditorChange(timeout);\n\t}\n\n\tprivate async nextEditor(timeout: number = 500): Promise<TextEditor | undefined> {\n\t\tconst editor = window.activeTextEditor;\n\n\t\tvoid (await executeCoreCommand(CoreCommands.NextEditor));\n\n\t\tif (editor !== window.activeTextEditor) {\n\t\t\treturn window.activeTextEditor;\n\t\t}\n\n\t\treturn this.waitForEditorChange(timeout);\n\t}\n\n\tprivate waitForEditorChange(timeout: number = 500): Promise<TextEditor | undefined> {\n\t\treturn new Promise<TextEditor | undefined>(resolve => {\n\t\t\tlet timer: ReturnType<typeof setTimeout> | undefined;\n\n\t\t\tthis._onEditorChangedFn = (editor: TextEditor | undefined) => {\n\t\t\t\tif (timer != null) {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\ttimer = undefined;\n\n\t\t\t\t\tresolve(editor);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\ttimer = undefined;\n\n\t\t\t\tresolve(window.activeTextEditor);\n\t\t\t}, timeout);\n\t\t});\n\t}\n}\n","import { TextEditor, Uri } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { RepositoryPicker } from '../quickpicks/repositoryPicker';\nimport { command } from '../system/command';\nimport { ActiveEditorCommand, CommandContext, getCommandUri } from './base';\n\nexport interface CompareWithCommandArgs {\n\tref1?: string;\n\tref2?: string;\n}\n\n@command()\nexport class CompareWithCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([\n\t\t\tCommands.CompareWith,\n\t\t\tCommands.CompareHeadWith,\n\t\t\tCommands.CompareWorkingWith,\n\t\t\tCommands.Deprecated_DiffHeadWith,\n\t\t\tCommands.Deprecated_DiffWorkingWith,\n\t\t]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: CompareWithCommandArgs) {\n\t\tswitch (context.command) {\n\t\t\tcase Commands.CompareWith:\n\t\t\t\targs = { ...args };\n\t\t\t\tbreak;\n\n\t\t\tcase Commands.CompareHeadWith:\n\t\t\tcase Commands.Deprecated_DiffHeadWith:\n\t\t\t\targs = { ...args };\n\t\t\t\targs.ref1 = 'HEAD';\n\t\t\t\tbreak;\n\n\t\t\tcase Commands.CompareWorkingWith:\n\t\t\tcase Commands.Deprecated_DiffWorkingWith:\n\t\t\t\targs = { ...args };\n\t\t\t\targs.ref1 = '';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: CompareWithCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\targs = { ...args };\n\n\t\ttry {\n\t\t\tlet title;\n\t\t\tswitch (args.ref1) {\n\t\t\t\tcase null:\n\t\t\t\t\ttitle = 'Compare';\n\t\t\t\t\tbreak;\n\t\t\t\tcase '':\n\t\t\t\t\ttitle = 'Compare Working Tree with';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'HEAD':\n\t\t\t\t\ttitle = 'Compare HEAD with';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\ttitle = `Compare ${args.ref1} with`;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst repoPath = (await RepositoryPicker.getBestRepositoryOrShow(uri, editor, title))?.path;\n\t\t\tif (!repoPath) return;\n\n\t\t\tif (args.ref1 != null && args.ref2 != null) {\n\t\t\t\tvoid (await this.container.searchAndCompareView.compare(repoPath, args.ref1, args.ref2));\n\t\t\t} else {\n\t\t\t\tthis.container.searchAndCompareView.selectForCompare(repoPath, args.ref1, { prompt: true });\n\t\t\t}\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'CompareWithCommmand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open comparison');\n\t\t}\n\t}\n}\n","import { env, TextEditor, Uri, window } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { Logger } from '../logger';\nimport { RepositoryPicker } from '../quickpicks/repositoryPicker';\nimport { command } from '../system/command';\nimport { ActiveEditorCommand, getCommandUri } from './base';\n\n@command()\nexport class CopyCurrentBranchCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.CopyCurrentBranch);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri) {\n\t\turi = getCommandUri(uri, editor);\n\n\t\tconst gitUri = uri != null ? await GitUri.fromUri(uri) : undefined;\n\n\t\tconst repository = await RepositoryPicker.getBestRepositoryOrShow(gitUri, editor, 'Copy Current Branch Name');\n\t\tif (repository == null) return;\n\n\t\ttry {\n\t\t\tconst branch = await repository.getBranch();\n\t\t\tif (branch?.name) {\n\t\t\t\tawait env.clipboard.writeText(branch.name);\n\t\t\t}\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'CopyCurrentBranchCommand');\n\t\t\tvoid window.showErrorMessage('Unable to copy current branch name. See output channel for more details');\n\t\t}\n\t}\n}\n","import { env, TextEditor, Uri } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command } from '../system/command';\nimport { first } from '../system/iterable';\nimport {\n\tActiveEditorCommand,\n\tCommandContext,\n\tgetCommandUri,\n\tisCommandContextViewNodeHasBranch,\n\tisCommandContextViewNodeHasCommit,\n\tisCommandContextViewNodeHasTag,\n} from './base';\nimport { GitActions } from './gitCommands.actions';\n\nexport interface CopyMessageToClipboardCommandArgs {\n\tmessage?: string;\n\tsha?: string;\n}\n\n@command()\nexport class CopyMessageToClipboardCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.CopyMessageToClipboard);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: CopyMessageToClipboardCommandArgs) {\n\t\tif (isCommandContextViewNodeHasCommit(context)) {\n\t\t\targs = { ...args };\n\t\t\targs.sha = context.node.commit.sha;\n\t\t\treturn this.execute(context.editor, context.node.commit.file?.uri, args);\n\t\t} else if (isCommandContextViewNodeHasBranch(context)) {\n\t\t\targs = { ...args };\n\t\t\targs.sha = context.node.branch.sha;\n\t\t\treturn this.execute(context.editor, context.node.uri, args);\n\t\t} else if (isCommandContextViewNodeHasTag(context)) {\n\t\t\targs = { ...args };\n\t\t\targs.sha = context.node.tag.sha;\n\t\t\treturn this.execute(context.editor, context.node.uri, args);\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: CopyMessageToClipboardCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\targs = { ...args };\n\n\t\ttry {\n\t\t\tlet repoPath;\n\n\t\t\t// If we don't have an editor then get the message of the last commit to the branch\n\t\t\tif (uri == null) {\n\t\t\t\trepoPath = this.container.git.getBestRepository(editor)?.path;\n\t\t\t\tif (!repoPath) return;\n\n\t\t\t\tconst log = await this.container.git.getLog(repoPath, { limit: 1 });\n\t\t\t\tif (log == null) return;\n\n\t\t\t\tconst commit = first(log.commits.values());\n\t\t\t\tif (commit?.message == null) return;\n\n\t\t\t\targs.message = commit.message;\n\t\t\t} else if (args.message == null) {\n\t\t\t\tconst gitUri = await GitUri.fromUri(uri);\n\t\t\t\trepoPath = gitUri.repoPath;\n\n\t\t\t\tif (args.sha == null) {\n\t\t\t\t\tconst blameline = editor?.selection.active.line ?? 0;\n\t\t\t\t\tif (blameline < 0) return;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst blame = await this.container.git.getBlameForLine(gitUri, blameline, editor?.document);\n\t\t\t\t\t\tif (blame == null || blame.commit.isUncommitted) return;\n\n\t\t\t\t\t\tvoid (await GitActions.Commit.copyMessageToClipboard(blame.commit));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\tLogger.error(ex, 'CopyMessageToClipboardCommand', `getBlameForLine(${blameline})`);\n\t\t\t\t\t\tvoid Messages.showGenericErrorMessage('Unable to copy message');\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvoid (await GitActions.Commit.copyMessageToClipboard({ ref: args.sha, repoPath: repoPath! }));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvoid (await env.clipboard.writeText(args.message));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'CopyMessageToClipboardCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to copy message');\n\t\t}\n\t}\n}\n","import { env, TextEditor, Uri } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command } from '../system/command';\nimport { first } from '../system/iterable';\nimport {\n\tActiveEditorCommand,\n\tCommandContext,\n\tgetCommandUri,\n\tisCommandContextViewNodeHasBranch,\n\tisCommandContextViewNodeHasCommit,\n\tisCommandContextViewNodeHasTag,\n} from './base';\n\nexport interface CopyShaToClipboardCommandArgs {\n\tsha?: string;\n}\n\n@command()\nexport class CopyShaToClipboardCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.CopyShaToClipboard);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: CopyShaToClipboardCommandArgs) {\n\t\tif (isCommandContextViewNodeHasCommit(context)) {\n\t\t\targs = { ...args };\n\t\t\targs.sha = this.container.config.advanced.abbreviateShaOnCopy\n\t\t\t\t? context.node.commit.shortSha\n\t\t\t\t: context.node.commit.sha;\n\t\t\treturn this.execute(context.editor, context.node.commit.file?.uri, args);\n\t\t} else if (isCommandContextViewNodeHasBranch(context)) {\n\t\t\targs = { ...args };\n\t\t\targs.sha = context.node.branch.sha;\n\t\t\treturn this.execute(context.editor, context.node.uri, args);\n\t\t} else if (isCommandContextViewNodeHasTag(context)) {\n\t\t\targs = { ...args };\n\t\t\targs.sha = context.node.tag.sha;\n\t\t\treturn this.execute(context.editor, context.node.uri, args);\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: CopyShaToClipboardCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\targs = { ...args };\n\n\t\ttry {\n\t\t\t// If we don't have an editor then get the sha of the last commit to the branch\n\t\t\tif (uri == null) {\n\t\t\t\tconst repoPath = this.container.git.getBestRepository(editor)?.path;\n\t\t\t\tif (!repoPath) return;\n\n\t\t\t\tconst log = await this.container.git.getLog(repoPath, { limit: 1 });\n\t\t\t\tif (log == null) return;\n\n\t\t\t\targs.sha = first(log.commits.values()).sha;\n\t\t\t} else if (args.sha == null) {\n\t\t\t\tconst blameline = editor?.selection.active.line ?? 0;\n\t\t\t\tif (blameline < 0) return;\n\n\t\t\t\ttry {\n\t\t\t\t\tconst gitUri = await GitUri.fromUri(uri);\n\t\t\t\t\tconst blame = await this.container.git.getBlameForLine(gitUri, blameline, editor?.document);\n\t\t\t\t\tif (blame == null) return;\n\n\t\t\t\t\targs.sha = blame.commit.sha;\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tLogger.error(ex, 'CopyShaToClipboardCommand', `getBlameForLine(${blameline})`);\n\t\t\t\t\tvoid Messages.showGenericErrorMessage('Unable to copy commit SHA');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvoid (await env.clipboard.writeText(args.sha));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'CopyShaToClipboardCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to copy commit SHA');\n\t\t}\n\t}\n}\n","import { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitRemote } from '../git/models';\nimport { RemoteProvider, RemoteResource, RemoteResourceType } from '../git/remotes/provider';\nimport { command, executeCommand } from '../system/command';\nimport { Command } from './base';\nimport { OpenOnRemoteCommandArgs } from './openOnRemote';\n\nexport interface CreatePullRequestOnRemoteCommandArgs {\n\tbase?: string;\n\tcompare: string;\n\tremote: string;\n\trepoPath: string;\n\n\tclipboard?: boolean;\n}\n\n@command()\nexport class CreatePullRequestOnRemoteCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.CreatePullRequestOnRemote);\n\t}\n\n\tasync execute(args?: CreatePullRequestOnRemoteCommandArgs) {\n\t\tif (args?.repoPath == null) return;\n\n\t\tconst repo = this.container.git.getRepository(args.repoPath);\n\t\tif (repo == null) return;\n\n\t\tconst compareRemote = await repo.getRemote(args.remote);\n\t\tif (compareRemote?.provider == null) return;\n\n\t\tconst providerId = compareRemote.provider.id;\n\t\tconst remotes = (await repo.getRemotes({\n\t\t\tfilter: r => r.provider?.id === providerId,\n\t\t})) as GitRemote<RemoteProvider>[];\n\n\t\tconst resource: RemoteResource = {\n\t\t\ttype: RemoteResourceType.CreatePullRequest,\n\t\t\tbase: {\n\t\t\t\tbranch: args.base,\n\t\t\t\tremote: undefined!,\n\t\t\t},\n\t\t\tcompare: {\n\t\t\t\tbranch: args.compare,\n\t\t\t\tremote: { path: compareRemote.path, url: compareRemote.url },\n\t\t\t},\n\t\t};\n\n\t\tvoid (await executeCommand<OpenOnRemoteCommandArgs>(Commands.OpenOnRemote, {\n\t\t\tresource: resource,\n\t\t\tremotes: remotes,\n\t\t}));\n\t}\n}\n","import { TextEditor, Uri } from 'vscode';\nimport { GitActions } from '../commands/gitCommands.actions';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { ReferencePicker } from '../quickpicks/referencePicker';\nimport { RepositoryPicker } from '../quickpicks/repositoryPicker';\nimport { command } from '../system/command';\nimport { CompareResultsNode } from '../views/nodes';\nimport { ActiveEditorCommand, CommandContext, getCommandUri, isCommandContextViewNodeHasRef } from './base';\n\nexport interface OpenDirectoryCompareCommandArgs {\n\tref1?: string;\n\tref2?: string;\n}\n\n@command()\nexport class OpenDirectoryCompareCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([\n\t\t\tCommands.DiffDirectory,\n\t\t\tCommands.DiffDirectoryWithHead,\n\t\t\tCommands.ViewsOpenDirectoryDiff,\n\t\t\tCommands.ViewsOpenDirectoryDiffWithWorking,\n\t\t]);\n\t}\n\n\tprotected override async preExecute(context: CommandContext, args?: OpenDirectoryCompareCommandArgs) {\n\t\tswitch (context.command) {\n\t\t\tcase Commands.DiffDirectoryWithHead:\n\t\t\t\targs = { ...args };\n\t\t\t\targs.ref1 = 'HEAD';\n\t\t\t\targs.ref2 = undefined;\n\t\t\t\tbreak;\n\n\t\t\tcase Commands.ViewsOpenDirectoryDiff:\n\t\t\t\tif (context.type === 'viewItem' && context.node instanceof CompareResultsNode) {\n\t\t\t\t\targs = { ...args };\n\t\t\t\t\t[args.ref1, args.ref2] = await context.node.getDiffRefs();\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase Commands.ViewsOpenDirectoryDiffWithWorking:\n\t\t\t\tif (isCommandContextViewNodeHasRef(context)) {\n\t\t\t\t\targs = { ...args };\n\t\t\t\t\targs.ref1 = context.node.ref.ref;\n\t\t\t\t\targs.ref2 = undefined;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: OpenDirectoryCompareCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\targs = { ...args };\n\n\t\ttry {\n\t\t\tconst repoPath = (\n\t\t\t\tawait RepositoryPicker.getBestRepositoryOrShow(uri, editor, 'Directory Compare Working Tree With')\n\t\t\t)?.path;\n\t\t\tif (!repoPath) return;\n\n\t\t\tif (!args.ref1) {\n\t\t\t\tconst pick = await ReferencePicker.show(\n\t\t\t\t\trepoPath,\n\t\t\t\t\t'Directory Compare Working Tree with',\n\t\t\t\t\t'Choose a branch or tag to compare with',\n\t\t\t\t\t{\n\t\t\t\t\t\tallowEnteringRefs: true,\n\t\t\t\t\t\t// checkmarks: false,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tif (pick == null) return;\n\n\t\t\t\targs.ref1 = pick.ref;\n\t\t\t\tif (args.ref1 == null) return;\n\t\t\t}\n\n\t\t\tvoid GitActions.Commit.openDirectoryCompare(repoPath, args.ref1, args.ref2);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenDirectoryCompareCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open directory compare');\n\t\t}\n\t}\n}\n","import { TextDocumentShowOptions, TextEditor, Uri } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitCommit } from '../git/models';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command, executeCommand } from '../system/command';\nimport { ActiveEditorCommand, getCommandUri } from './base';\nimport { DiffWithCommandArgs } from './diffWith';\n\nexport interface DiffLineWithPreviousCommandArgs {\n\tcommit?: GitCommit;\n\n\tline?: number;\n\tshowOptions?: TextDocumentShowOptions;\n}\n\n@command()\nexport class DiffLineWithPreviousCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.DiffLineWithPrevious);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: DiffLineWithPreviousCommandArgs): Promise<any> {\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\targs = { ...args };\n\t\tif (args.line == null) {\n\t\t\targs.line = editor?.selection.active.line ?? 0;\n\t\t}\n\n\t\tconst gitUri = args.commit?.getGitUri() ?? (await GitUri.fromUri(uri));\n\n\t\ttry {\n\t\t\tconst diffUris = await this.container.git.getPreviousComparisonUrisForLine(\n\t\t\t\tgitUri.repoPath!,\n\t\t\t\tgitUri,\n\t\t\t\targs.line,\n\t\t\t\tgitUri.sha,\n\t\t\t);\n\n\t\t\tif (diffUris == null || diffUris.previous == null) {\n\t\t\t\tvoid Messages.showCommitHasNoPreviousCommitWarningMessage();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid (await executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\t\trepoPath: diffUris.current.repoPath,\n\t\t\t\tlhs: {\n\t\t\t\t\tsha: diffUris.previous.sha ?? '',\n\t\t\t\t\turi: diffUris.previous.documentUri(),\n\t\t\t\t},\n\t\t\t\trhs: {\n\t\t\t\t\tsha: diffUris.current.sha ?? '',\n\t\t\t\t\turi: diffUris.current.documentUri(),\n\t\t\t\t},\n\t\t\t\tline: diffUris.line,\n\t\t\t\tshowOptions: args.showOptions,\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(\n\t\t\t\tex,\n\t\t\t\t'DiffLineWithPreviousCommand',\n\t\t\t\t`getPreviousLineDiffUris(${gitUri.repoPath}, ${gitUri.fsPath}, ${gitUri.sha})`,\n\t\t\t);\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open compare');\n\t\t}\n\t}\n}\n","import { TextDocumentShowOptions, TextEditor, Uri, window } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitCommit, GitRevision } from '../git/models';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command, executeCommand } from '../system/command';\nimport { ActiveEditorCommand, getCommandUri } from './base';\nimport { DiffWithCommandArgs } from './diffWith';\n\nexport interface DiffLineWithWorkingCommandArgs {\n\tcommit?: GitCommit;\n\n\tline?: number;\n\tshowOptions?: TextDocumentShowOptions;\n}\n\n@command()\nexport class DiffLineWithWorkingCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.DiffLineWithWorking);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: DiffLineWithWorkingCommandArgs): Promise<any> {\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\tconst gitUri = await GitUri.fromUri(uri);\n\n\t\targs = { ...args };\n\t\tif (args.line == null) {\n\t\t\targs.line = editor?.selection.active.line ?? 0;\n\t\t}\n\n\t\tlet lhsSha: string;\n\t\tlet lhsUri: Uri;\n\n\t\tif (args.commit == null || args.commit.isUncommitted) {\n\t\t\tconst blameline = args.line;\n\t\t\tif (blameline < 0) return;\n\n\t\t\ttry {\n\t\t\t\tconst blame = await this.container.git.getBlameForLine(gitUri, blameline, editor?.document);\n\t\t\t\tif (blame == null) {\n\t\t\t\t\tvoid Messages.showFileNotUnderSourceControlWarningMessage('Unable to open compare');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\targs.commit = blame.commit;\n\n\t\t\t\t// If the line is uncommitted, use previous commit (or index if the file is staged)\n\t\t\t\tif (args.commit.isUncommitted) {\n\t\t\t\t\tconst status = await this.container.git.getStatusForFile(gitUri.repoPath!, gitUri);\n\t\t\t\t\tif (status?.indexStatus != null) {\n\t\t\t\t\t\tlhsSha = GitRevision.uncommittedStaged;\n\t\t\t\t\t\tlhsUri = this.container.git.getAbsoluteUri(\n\t\t\t\t\t\t\tstatus.originalPath || status.path,\n\t\t\t\t\t\t\targs.commit.repoPath,\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Don't need to worry about verifying the previous sha, as the DiffWith command will\n\t\t\t\t\t\tlhsSha = args.commit.unresolvedPreviousSha;\n\t\t\t\t\t\tlhsUri = args.commit.file!.originalUri ?? args.commit.file!.uri;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlhsSha = args.commit.sha;\n\t\t\t\t\tlhsUri = args.commit.file!.uri;\n\t\t\t\t}\n\t\t\t\t// editor lines are 0-based\n\t\t\t\targs.line = blame.line.line - 1;\n\t\t\t} catch (ex) {\n\t\t\t\tLogger.error(ex, 'DiffLineWithWorkingCommand', `getBlameForLine(${blameline})`);\n\t\t\t\tvoid Messages.showGenericErrorMessage('Unable to open compare');\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\tlhsSha = args.commit.sha;\n\t\t\tlhsUri = args.commit.file?.uri ?? gitUri;\n\t\t}\n\n\t\tconst workingUri = await args.commit.file?.getWorkingUri();\n\t\tif (workingUri == null) {\n\t\t\tvoid window.showWarningMessage('Unable to open compare. File has been deleted from the working tree');\n\n\t\t\treturn;\n\t\t}\n\n\t\tvoid (await executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\trepoPath: args.commit.repoPath,\n\t\t\tlhs: {\n\t\t\t\tsha: lhsSha,\n\t\t\t\turi: lhsUri,\n\t\t\t},\n\t\t\trhs: {\n\t\t\t\tsha: '',\n\t\t\t\turi: workingUri,\n\t\t\t},\n\t\t\tline: args.line,\n\t\t\tshowOptions: args.showOptions,\n\t\t}));\n\t}\n}\n","import { Range, TextDocumentShowOptions, Uri, ViewColumn } from 'vscode';\nimport { Commands, CoreCommands, GlyphChars } from '../constants';\nimport type { Container } from '../container';\nimport { GitCommit, GitRevision } from '../git/models';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command, executeCoreCommand } from '../system/command';\nimport { basename } from '../system/path';\nimport { Command } from './base';\n\nexport interface DiffWithCommandArgsRevision {\n\tsha: string;\n\turi: Uri;\n\ttitle?: string;\n}\n\nexport interface DiffWithCommandArgs {\n\tlhs: DiffWithCommandArgsRevision;\n\trhs: DiffWithCommandArgsRevision;\n\trepoPath: string | undefined;\n\n\tline?: number;\n\tshowOptions?: TextDocumentShowOptions;\n}\n\n@command()\nexport class DiffWithCommand extends Command {\n\tstatic getMarkdownCommandArgs(args: DiffWithCommandArgs): string;\n\tstatic getMarkdownCommandArgs(commit: GitCommit, line?: number): string;\n\tstatic getMarkdownCommandArgs(argsOrCommit: DiffWithCommandArgs | GitCommit, line?: number): string {\n\t\tlet args: DiffWithCommandArgs | GitCommit;\n\t\tif (GitCommit.is(argsOrCommit)) {\n\t\t\tconst commit = argsOrCommit;\n\t\t\tif (commit.file == null || commit.unresolvedPreviousSha == null) {\n\t\t\t\tdebugger;\n\t\t\t\tthrow new Error('Commit has no file');\n\t\t\t}\n\n\t\t\tif (commit.isUncommitted) {\n\t\t\t\targs = {\n\t\t\t\t\trepoPath: commit.repoPath,\n\t\t\t\t\tlhs: {\n\t\t\t\t\t\tsha: 'HEAD',\n\t\t\t\t\t\turi: commit.file.uri,\n\t\t\t\t\t},\n\t\t\t\t\trhs: {\n\t\t\t\t\t\tsha: '',\n\t\t\t\t\t\turi: commit.file.uri,\n\t\t\t\t\t},\n\t\t\t\t\tline: line,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\targs = {\n\t\t\t\t\trepoPath: commit.repoPath,\n\t\t\t\t\tlhs: {\n\t\t\t\t\t\tsha: commit.unresolvedPreviousSha,\n\t\t\t\t\t\turi: commit.file.originalUri ?? commit.file.uri,\n\t\t\t\t\t},\n\t\t\t\t\trhs: {\n\t\t\t\t\t\tsha: commit.sha,\n\t\t\t\t\t\turi: commit.file.uri,\n\t\t\t\t\t},\n\t\t\t\t\tline: line,\n\t\t\t\t};\n\t\t\t}\n\t\t} else {\n\t\t\targs = argsOrCommit;\n\t\t}\n\n\t\treturn super.getMarkdownCommandArgsCore<DiffWithCommandArgs>(Commands.DiffWith, args);\n\t}\n\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.DiffWith);\n\t}\n\n\tasync execute(args?: DiffWithCommandArgs): Promise<any> {\n\t\tif (args?.lhs == null || args?.rhs == null) return;\n\n\t\targs = {\n\t\t\t...args,\n\t\t\tlhs: { ...args.lhs },\n\t\t\trhs: { ...args.rhs },\n\t\t\tshowOptions: args.showOptions == null ? undefined : { ...args.showOptions },\n\t\t};\n\n\t\tif (args.repoPath == null) return;\n\n\t\ttry {\n\t\t\tlet lhsSha = args.lhs.sha;\n\t\t\tlet rhsSha = args.rhs.sha;\n\n\t\t\t[args.lhs.sha, args.rhs.sha] = await Promise.all([\n\t\t\t\tawait this.container.git.resolveReference(args.repoPath, args.lhs.sha, args.lhs.uri, {\n\t\t\t\t\t// If the ref looks like a sha, don't wait too long, since it should work\n\t\t\t\t\ttimeout: GitRevision.isSha(args.lhs.sha) ? 100 : undefined,\n\t\t\t\t}),\n\t\t\t\tawait this.container.git.resolveReference(args.repoPath, args.rhs.sha, args.rhs.uri, {\n\t\t\t\t\t// If the ref looks like a sha, don't wait too long, since it should work\n\t\t\t\t\ttimeout: GitRevision.isSha(args.rhs.sha) ? 100 : undefined,\n\t\t\t\t}),\n\t\t\t]);\n\n\t\t\tif (args.lhs.sha !== GitRevision.deletedOrMissing) {\n\t\t\t\tlhsSha = args.lhs.sha;\n\t\t\t}\n\n\t\t\tif (args.rhs.sha && args.rhs.sha !== GitRevision.deletedOrMissing) {\n\t\t\t\t// Ensure that the file still exists in this commit\n\t\t\t\tconst status = await this.container.git.getFileStatusForCommit(\n\t\t\t\t\targs.repoPath,\n\t\t\t\t\targs.rhs.uri,\n\t\t\t\t\targs.rhs.sha,\n\t\t\t\t);\n\t\t\t\tif (status?.status === 'D') {\n\t\t\t\t\targs.rhs.sha = GitRevision.deletedOrMissing;\n\t\t\t\t} else {\n\t\t\t\t\trhsSha = args.rhs.sha;\n\t\t\t\t}\n\n\t\t\t\tif (status?.status === 'A' && args.lhs.sha.endsWith('^')) {\n\t\t\t\t\targs.lhs.sha = GitRevision.deletedOrMissing;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst [lhs, rhs] = await Promise.all([\n\t\t\t\tthis.container.git.getBestRevisionUri(args.repoPath, args.lhs.uri.fsPath, args.lhs.sha),\n\t\t\t\tthis.container.git.getBestRevisionUri(args.repoPath, args.rhs.uri.fsPath, args.rhs.sha),\n\t\t\t]);\n\n\t\t\tlet rhsSuffix = GitRevision.shorten(rhsSha, { strings: { uncommitted: 'Working Tree' } });\n\t\t\tif (rhs == null) {\n\t\t\t\tif (GitRevision.isUncommitted(args.rhs.sha)) {\n\t\t\t\t\trhsSuffix = 'deleted';\n\t\t\t\t} else if (rhsSuffix.length === 0 && args.rhs.sha === GitRevision.deletedOrMissing) {\n\t\t\t\t\trhsSuffix = 'not in Working Tree';\n\t\t\t\t} else {\n\t\t\t\t\trhsSuffix = `deleted${rhsSuffix.length === 0 ? '' : ` in ${rhsSuffix}`}`;\n\t\t\t\t}\n\t\t\t} else if (lhs == null) {\n\t\t\t\trhsSuffix = `added${rhsSuffix.length === 0 ? '' : ` in ${rhsSuffix}`}`;\n\t\t\t}\n\n\t\t\tlet lhsSuffix = args.lhs.sha !== GitRevision.deletedOrMissing ? GitRevision.shorten(lhsSha) : '';\n\t\t\tif (lhs == null && args.rhs.sha.length === 0) {\n\t\t\t\tif (rhs != null) {\n\t\t\t\t\tlhsSuffix = lhsSuffix.length === 0 ? '' : `not in ${lhsSuffix}`;\n\t\t\t\t\trhsSuffix = '';\n\t\t\t\t} else {\n\t\t\t\t\tlhsSuffix = `deleted${lhsSuffix.length === 0 ? '' : ` in ${lhsSuffix}`}`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (args.lhs.title == null && (lhs != null || lhsSuffix.length !== 0)) {\n\t\t\t\targs.lhs.title = `${basename(args.lhs.uri.fsPath)}${lhsSuffix ? ` (${lhsSuffix})` : ''}`;\n\t\t\t}\n\t\t\tif (args.rhs.title == null) {\n\t\t\t\targs.rhs.title = `${basename(args.rhs.uri.fsPath)}${rhsSuffix ? ` (${rhsSuffix})` : ''}`;\n\t\t\t}\n\n\t\t\tconst title =\n\t\t\t\targs.lhs.title != null && args.rhs.title != null\n\t\t\t\t\t? `${args.lhs.title} ${GlyphChars.ArrowLeftRightLong} ${args.rhs.title}`\n\t\t\t\t\t: args.lhs.title ?? args.rhs.title;\n\n\t\t\tif (args.showOptions == null) {\n\t\t\t\targs.showOptions = {};\n\t\t\t}\n\n\t\t\tif (args.showOptions.viewColumn == null) {\n\t\t\t\targs.showOptions.viewColumn = ViewColumn.Active;\n\t\t\t}\n\n\t\t\tif (args.line != null && args.line !== 0) {\n\t\t\t\targs.showOptions.selection = new Range(args.line, 0, args.line, 0);\n\t\t\t}\n\n\t\t\tvoid (await executeCoreCommand(\n\t\t\t\tCoreCommands.Diff,\n\t\t\t\tlhs ??\n\t\t\t\t\tthis.container.git.getRevisionUri(GitRevision.deletedOrMissing, args.lhs.uri.fsPath, args.repoPath),\n\t\t\t\trhs ??\n\t\t\t\t\tthis.container.git.getRevisionUri(GitRevision.deletedOrMissing, args.rhs.uri.fsPath, args.repoPath),\n\t\t\t\ttitle,\n\t\t\t\targs.showOptions,\n\t\t\t));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'DiffWithCommand', 'getVersionedFile');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open compare');\n\t\t}\n\t}\n}\n","import { Range, TextDocumentShowOptions, TextEditor, Uri } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitCommit } from '../git/models';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command, executeCommand } from '../system/command';\nimport { ActiveEditorCommand, CommandContext, getCommandUri } from './base';\nimport { DiffWithCommandArgs } from './diffWith';\n\nexport interface DiffWithNextCommandArgs {\n\tcommit?: GitCommit;\n\trange?: Range;\n\n\tinDiffLeftEditor?: boolean;\n\tline?: number;\n\tshowOptions?: TextDocumentShowOptions;\n}\n\n@command()\nexport class DiffWithNextCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.DiffWithNext, Commands.DiffWithNextInDiffLeft, Commands.DiffWithNextInDiffRight]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: DiffWithNextCommandArgs) {\n\t\tif (context.command === Commands.DiffWithNextInDiffLeft) {\n\t\t\targs = { ...args, inDiffLeftEditor: true };\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: DiffWithNextCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\targs = { ...args };\n\t\tif (args.line == null) {\n\t\t\targs.line = editor?.selection.active.line ?? 0;\n\t\t}\n\n\t\tconst gitUri = args.commit?.getGitUri() ?? (await GitUri.fromUri(uri));\n\t\ttry {\n\t\t\tconst diffUris = await this.container.git.getNextComparisonUris(\n\t\t\t\tgitUri.repoPath!,\n\t\t\t\tgitUri,\n\t\t\t\tgitUri.sha,\n\t\t\t\t// If we are in the left-side of the diff editor, we need to skip forward 1 more revision\n\t\t\t\targs.inDiffLeftEditor ? 1 : 0,\n\t\t\t);\n\n\t\t\tif (diffUris == null || diffUris.next == null) return;\n\n\t\t\tvoid (await executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\t\trepoPath: diffUris.current.repoPath,\n\t\t\t\tlhs: {\n\t\t\t\t\tsha: diffUris.current.sha ?? '',\n\t\t\t\t\turi: diffUris.current.documentUri(),\n\t\t\t\t},\n\t\t\t\trhs: {\n\t\t\t\t\tsha: diffUris.next.sha ?? '',\n\t\t\t\t\turi: diffUris.next.documentUri(),\n\t\t\t\t},\n\t\t\t\tline: args.line,\n\t\t\t\tshowOptions: args.showOptions,\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(\n\t\t\t\tex,\n\t\t\t\t'DiffWithNextCommand',\n\t\t\t\t`getNextDiffUris(${gitUri.repoPath}, ${gitUri.fsPath}, ${gitUri.sha})`,\n\t\t\t);\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open compare');\n\t\t}\n\t}\n}\n","import { TextDocumentShowOptions, TextEditor, Uri } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitCommit, GitRevision } from '../git/models';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command, executeCommand } from '../system/command';\nimport { findOrOpenEditor } from '../system/utils';\nimport { ActiveEditorCommand, CommandContext, getCommandUri } from './base';\nimport { DiffWithCommandArgs } from './diffWith';\n\nexport interface DiffWithPreviousCommandArgs {\n\tcommit?: GitCommit;\n\n\tinDiffRightEditor?: boolean;\n\turi?: Uri;\n\tline?: number;\n\tshowOptions?: TextDocumentShowOptions;\n}\n\n@command()\nexport class DiffWithPreviousCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.DiffWithPrevious, Commands.DiffWithPreviousInDiffLeft, Commands.DiffWithPreviousInDiffRight]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: DiffWithPreviousCommandArgs) {\n\t\tif (context.command === Commands.DiffWithPreviousInDiffRight) {\n\t\t\targs = { ...args, inDiffRightEditor: true };\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: DiffWithPreviousCommandArgs) {\n\t\targs = { ...args };\n\t\tif (args.uri == null) {\n\t\t\turi = getCommandUri(uri, editor);\n\t\t\tif (uri == null) return;\n\t\t} else {\n\t\t\turi = args.uri;\n\t\t}\n\n\t\tif (args.line == null) {\n\t\t\targs.line = editor?.selection.active.line ?? 0;\n\t\t}\n\n\t\tlet gitUri;\n\t\tif (args.commit?.file != null) {\n\t\t\tif (!args.commit.isUncommitted) {\n\t\t\t\tvoid (await executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\t\t\trepoPath: args.commit.repoPath,\n\t\t\t\t\tlhs: {\n\t\t\t\t\t\tsha: `${args.commit.sha}^`,\n\t\t\t\t\t\turi: args.commit.file.originalUri ?? args.commit.file.uri,\n\t\t\t\t\t},\n\t\t\t\t\trhs: {\n\t\t\t\t\t\tsha: args.commit.sha || '',\n\t\t\t\t\t\turi: args.commit.file.uri,\n\t\t\t\t\t},\n\t\t\t\t\tline: args.line,\n\t\t\t\t\tshowOptions: args.showOptions,\n\t\t\t\t}));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tgitUri = args.commit?.getGitUri();\n\t\t} else {\n\t\t\tgitUri = await GitUri.fromUri(uri);\n\t\t}\n\n\t\t// If we are in the right diff editor, we can't really trust the line number\n\t\t// if (args.inDiffRightEditor && args.line !== 0) {\n\t\t// \t// TODO@eamodio figure out how to tell where the line moved in the previous commit (if at all)\n\t\t// }\n\n\t\ttry {\n\t\t\tconst diffUris = await this.container.git.getPreviousComparisonUris(\n\t\t\t\tgitUri.repoPath!,\n\t\t\t\tgitUri,\n\t\t\t\tgitUri.sha,\n\t\t\t\t// If we are in the right-side of the diff editor, we need to skip back 1 more revision\n\t\t\t\targs.inDiffRightEditor ? 1 : 0,\n\t\t\t);\n\n\t\t\tif (diffUris == null || diffUris.previous == null) {\n\t\t\t\tif (diffUris == null) {\n\t\t\t\t\tvoid Messages.showCommitHasNoPreviousCommitWarningMessage();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// If we have no previous and the current is the working file, just open the working file\n\t\t\t\tif (diffUris.current.sha == null) {\n\t\t\t\t\tvoid (await findOrOpenEditor(diffUris.current, args.showOptions));\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!diffUris.current.isUncommittedStaged) {\n\t\t\t\t\tvoid Messages.showCommitHasNoPreviousCommitWarningMessage();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// If we have no previous and the current is staged, then diff staged with missing\n\t\t\t\tdiffUris.previous = GitUri.fromFile(\n\t\t\t\t\tdiffUris.current.fileName,\n\t\t\t\t\tdiffUris.current.repoPath!,\n\t\t\t\t\tGitRevision.deletedOrMissing,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tvoid (await executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\t\trepoPath: diffUris.current.repoPath,\n\t\t\t\tlhs: {\n\t\t\t\t\tsha: diffUris.previous.sha ?? '',\n\t\t\t\t\turi: diffUris.previous.documentUri(),\n\t\t\t\t},\n\t\t\t\trhs: {\n\t\t\t\t\tsha: diffUris.current.sha ?? '',\n\t\t\t\t\turi: diffUris.current.documentUri(),\n\t\t\t\t},\n\t\t\t\tline: args.line,\n\t\t\t\tshowOptions: args.showOptions,\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(\n\t\t\t\tex,\n\t\t\t\t'DiffWithPreviousCommand',\n\t\t\t\t`getPreviousDiffUris(${gitUri.repoPath}, ${gitUri.fsPath}, ${gitUri.sha})`,\n\t\t\t);\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open compare');\n\t\t}\n\t}\n}\n","import { Disposable, window } from 'vscode';\nimport { configuration } from '../configuration';\nimport { Container } from '../container';\nimport { GitCommit, GitLog, GitStash, GitStashCommit } from '../git/models';\nimport { KeyboardScope, Keys } from '../keyboard';\nimport { CommandQuickPickItem } from '../quickpicks/items/common';\nimport { filter, map } from '../system/iterable';\nimport { isPromise } from '../system/promise';\nimport { getQuickPickIgnoreFocusOut } from '../system/utils';\nimport { Directive, DirectiveQuickPickItem } from './items/directive';\nimport { CommitQuickPickItem } from './items/gitCommands';\n\nexport namespace CommitPicker {\n\texport async function show(\n\t\tlog: GitLog | undefined | Promise<GitLog | undefined>,\n\t\ttitle: string,\n\t\tplaceholder: string,\n\t\toptions?: {\n\t\t\tpicked?: string;\n\t\t\tkeys?: Keys[];\n\t\t\tonDidPressKey?(key: Keys, item: CommitQuickPickItem): void | Promise<void>;\n\t\t\tshowOtherReferences?: CommandQuickPickItem[];\n\t\t},\n\t): Promise<GitCommit | undefined> {\n\t\tconst quickpick = window.createQuickPick<CommandQuickPickItem | CommitQuickPickItem | DirectiveQuickPickItem>();\n\t\tquickpick.ignoreFocusOut = getQuickPickIgnoreFocusOut();\n\n\t\tquickpick.title = title;\n\t\tquickpick.placeholder = placeholder;\n\t\tquickpick.matchOnDescription = true;\n\t\tquickpick.matchOnDetail = true;\n\n\t\tif (isPromise(log)) {\n\t\t\tquickpick.busy = true;\n\t\t\tquickpick.enabled = false;\n\t\t\tquickpick.show();\n\n\t\t\tlog = await log;\n\n\t\t\tif (log == null) {\n\t\t\t\tquickpick.placeholder = 'Unable to show commit history';\n\t\t\t}\n\t\t}\n\n\t\tquickpick.items = getItems(log);\n\n\t\tif (options?.picked) {\n\t\t\tquickpick.activeItems = quickpick.items.filter(i => (CommandQuickPickItem.is(i) ? false : i.picked));\n\t\t}\n\n\t\tfunction getItems(log: GitLog | undefined) {\n\t\t\treturn log == null\n\t\t\t\t? [DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t\t: [\n\t\t\t\t\t\t...(options?.showOtherReferences ?? []),\n\t\t\t\t\t\t...map(log.commits.values(), commit =>\n\t\t\t\t\t\t\tCommitQuickPickItem.create(commit, options?.picked === commit.ref, {\n\t\t\t\t\t\t\t\tcompact: true,\n\t\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t),\n\t\t\t\t\t\t...(log?.hasMore ? [DirectiveQuickPickItem.create(Directive.LoadMore)] : []),\n\t\t\t\t  ];\n\t\t}\n\n\t\tasync function loadMore() {\n\t\t\tquickpick.busy = true;\n\t\t\tquickpick.enabled = false;\n\n\t\t\ttry {\n\t\t\t\tlog = await (await log)?.more?.(configuration.get('advanced.maxListItems'));\n\t\t\t\tconst items = getItems(log);\n\n\t\t\t\tlet activeIndex = -1;\n\t\t\t\tif (quickpick.activeItems.length !== 0) {\n\t\t\t\t\tconst active = quickpick.activeItems[0];\n\t\t\t\t\tactiveIndex = quickpick.items.indexOf(active);\n\n\t\t\t\t\t// If the active item is the \"Load more\" directive, then select the previous item\n\t\t\t\t\tif (DirectiveQuickPickItem.is(active)) {\n\t\t\t\t\t\tactiveIndex--;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tquickpick.items = items;\n\n\t\t\t\tif (activeIndex) {\n\t\t\t\t\tquickpick.activeItems = [quickpick.items[activeIndex]];\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\tquickpick.busy = false;\n\t\t\t\tquickpick.enabled = true;\n\t\t\t}\n\t\t}\n\n\t\tconst disposables: Disposable[] = [];\n\n\t\tlet scope: KeyboardScope | undefined;\n\t\tif (options?.keys != null && options.keys.length !== 0 && options?.onDidPressKey !== null) {\n\t\t\tscope = Container.instance.keyboard.createScope(\n\t\t\t\tObject.fromEntries(\n\t\t\t\t\toptions.keys.map(key => [\n\t\t\t\t\t\tkey,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonDidPressKey: key => {\n\t\t\t\t\t\t\t\tif (quickpick.activeItems.length !== 0) {\n\t\t\t\t\t\t\t\t\tconst [item] = quickpick.activeItems;\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\titem != null &&\n\t\t\t\t\t\t\t\t\t\t!DirectiveQuickPickItem.is(item) &&\n\t\t\t\t\t\t\t\t\t\t!CommandQuickPickItem.is(item)\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tvoid options.onDidPressKey!(key, item);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t]),\n\t\t\t\t),\n\t\t\t);\n\t\t\tvoid scope.start();\n\t\t\tdisposables.push(scope);\n\t\t}\n\n\t\ttry {\n\t\t\tconst pick = await new Promise<\n\t\t\t\tCommandQuickPickItem | CommitQuickPickItem | DirectiveQuickPickItem | undefined\n\t\t\t>(resolve => {\n\t\t\t\tdisposables.push(\n\t\t\t\t\tquickpick.onDidHide(() => resolve(undefined)),\n\t\t\t\t\tquickpick.onDidAccept(() => {\n\t\t\t\t\t\tif (quickpick.activeItems.length !== 0) {\n\t\t\t\t\t\t\tconst [item] = quickpick.activeItems;\n\t\t\t\t\t\t\tif (DirectiveQuickPickItem.is(item)) {\n\t\t\t\t\t\t\t\tswitch (item.directive) {\n\t\t\t\t\t\t\t\t\tcase Directive.LoadMore:\n\t\t\t\t\t\t\t\t\t\tvoid loadMore();\n\t\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tquickpick.onDidChangeValue(async e => {\n\t\t\t\t\t\tif (scope == null) return;\n\n\t\t\t\t\t\t// Pause the left/right keyboard commands if there is a value, otherwise the left/right arrows won't work in the input properly\n\t\t\t\t\t\tif (e.length !== 0) {\n\t\t\t\t\t\t\tawait scope.pause(['left', 'right']);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tawait scope.resume();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t);\n\n\t\t\t\tquickpick.busy = false;\n\t\t\t\tquickpick.enabled = true;\n\n\t\t\t\tquickpick.show();\n\t\t\t});\n\t\t\tif (pick == null || DirectiveQuickPickItem.is(pick)) return undefined;\n\n\t\t\tif (pick instanceof CommandQuickPickItem) {\n\t\t\t\tvoid (await pick.execute());\n\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn pick.item;\n\t\t} finally {\n\t\t\tquickpick.dispose();\n\t\t\tdisposables.forEach(d => d.dispose());\n\t\t}\n\t}\n}\n\nexport namespace StashPicker {\n\texport async function show(\n\t\tstash: GitStash | undefined | Promise<GitStash | undefined>,\n\t\ttitle: string,\n\t\tplaceholder: string,\n\t\toptions?: {\n\t\t\tempty?: string;\n\t\t\tfilter?: (c: GitStashCommit) => boolean;\n\t\t\tkeys?: Keys[];\n\t\t\tonDidPressKey?(key: Keys, item: CommitQuickPickItem<GitStashCommit>): void | Promise<void>;\n\t\t\tpicked?: string;\n\t\t\tshowOtherReferences?: CommandQuickPickItem[];\n\t\t},\n\t): Promise<GitStashCommit | undefined> {\n\t\tconst quickpick = window.createQuickPick<\n\t\t\tCommandQuickPickItem | CommitQuickPickItem<GitStashCommit> | DirectiveQuickPickItem\n\t\t>();\n\t\tquickpick.ignoreFocusOut = getQuickPickIgnoreFocusOut();\n\n\t\tquickpick.title = title;\n\t\tquickpick.placeholder = placeholder;\n\t\tquickpick.matchOnDescription = true;\n\t\tquickpick.matchOnDetail = true;\n\n\t\tif (isPromise(stash)) {\n\t\t\tquickpick.busy = true;\n\t\t\tquickpick.enabled = false;\n\t\t\tquickpick.show();\n\n\t\t\tstash = await stash;\n\t\t}\n\n\t\tif (stash != null) {\n\t\t\tquickpick.items = [\n\t\t\t\t...(options?.showOtherReferences ?? []),\n\t\t\t\t...map(\n\t\t\t\t\toptions?.filter != null ? filter(stash.commits.values(), options.filter) : stash.commits.values(),\n\t\t\t\t\tcommit =>\n\t\t\t\t\t\tCommitQuickPickItem.create(commit, options?.picked === commit.ref, {\n\t\t\t\t\t\t\tcompact: true,\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t];\n\t\t}\n\n\t\tif (stash == null || quickpick.items.length <= (options?.showOtherReferences?.length ?? 0)) {\n\t\t\tquickpick.placeholder = stash == null ? 'No stashes found' : options?.empty ?? `No matching stashes found`;\n\t\t\tquickpick.items = [DirectiveQuickPickItem.create(Directive.Cancel)];\n\t\t}\n\n\t\tif (options?.picked) {\n\t\t\tquickpick.activeItems = quickpick.items.filter(i => (CommandQuickPickItem.is(i) ? false : i.picked));\n\t\t}\n\n\t\tconst disposables: Disposable[] = [];\n\n\t\tlet scope: KeyboardScope | undefined;\n\t\tif (options?.keys != null && options.keys.length !== 0 && options?.onDidPressKey !== null) {\n\t\t\tscope = Container.instance.keyboard.createScope(\n\t\t\t\tObject.fromEntries(\n\t\t\t\t\toptions.keys.map(key => [\n\t\t\t\t\t\tkey,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonDidPressKey: key => {\n\t\t\t\t\t\t\t\tif (quickpick.activeItems.length !== 0) {\n\t\t\t\t\t\t\t\t\tconst [item] = quickpick.activeItems;\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\titem != null &&\n\t\t\t\t\t\t\t\t\t\t!DirectiveQuickPickItem.is(item) &&\n\t\t\t\t\t\t\t\t\t\t!CommandQuickPickItem.is(item)\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tvoid options.onDidPressKey!(key, item);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t]),\n\t\t\t\t),\n\t\t\t);\n\t\t\tvoid scope.start();\n\t\t\tdisposables.push(scope);\n\t\t}\n\n\t\ttry {\n\t\t\tconst pick = await new Promise<\n\t\t\t\tCommandQuickPickItem | CommitQuickPickItem<GitStashCommit> | DirectiveQuickPickItem | undefined\n\t\t\t>(resolve => {\n\t\t\t\tdisposables.push(\n\t\t\t\t\tquickpick.onDidHide(() => resolve(undefined)),\n\t\t\t\t\tquickpick.onDidAccept(() => {\n\t\t\t\t\t\tif (quickpick.activeItems.length !== 0) {\n\t\t\t\t\t\t\tconst [item] = quickpick.activeItems;\n\t\t\t\t\t\t\tif (DirectiveQuickPickItem.is(item)) {\n\t\t\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tquickpick.onDidChangeValue(async e => {\n\t\t\t\t\t\tif (scope == null) return;\n\n\t\t\t\t\t\t// Pause the left/right keyboard commands if there is a value, otherwise the left/right arrows won't work in the input properly\n\t\t\t\t\t\tif (e.length !== 0) {\n\t\t\t\t\t\t\tawait scope.pause(['left', 'right']);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tawait scope.resume();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t);\n\n\t\t\t\tquickpick.busy = false;\n\t\t\t\tquickpick.enabled = true;\n\n\t\t\t\tquickpick.show();\n\t\t\t});\n\t\t\tif (pick == null || DirectiveQuickPickItem.is(pick)) return undefined;\n\n\t\t\tif (pick instanceof CommandQuickPickItem) {\n\t\t\t\tvoid (await pick.execute());\n\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn pick.item;\n\t\t} finally {\n\t\t\tquickpick.dispose();\n\t\t\tdisposables.forEach(d => d.dispose());\n\t\t}\n\t}\n}\n","import { TextDocumentShowOptions, TextEditor, Uri } from 'vscode';\nimport { Commands, GlyphChars, quickPickTitleMaxChars } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitRevision } from '../git/models';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { CommitPicker } from '../quickpicks/commitPicker';\nimport { CommandQuickPickItem } from '../quickpicks/items/common';\nimport { command, executeCommand } from '../system/command';\nimport { pad } from '../system/string';\nimport { ActiveEditorCommand, getCommandUri } from './base';\nimport { DiffWithCommandArgs } from './diffWith';\nimport { DiffWithRevisionFromCommandArgs } from './diffWithRevisionFrom';\n\nexport interface DiffWithRevisionCommandArgs {\n\tline?: number;\n\tshowOptions?: TextDocumentShowOptions;\n}\n\n@command()\nexport class DiffWithRevisionCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.DiffWithRevision);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: DiffWithRevisionCommandArgs): Promise<any> {\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\tconst gitUri = await GitUri.fromUri(uri);\n\n\t\targs = { ...args };\n\t\tif (args.line == null) {\n\t\t\targs.line = editor?.selection.active.line ?? 0;\n\t\t}\n\n\t\ttry {\n\t\t\tconst log = this.container.git\n\t\t\t\t.getLogForFile(gitUri.repoPath, gitUri.fsPath)\n\t\t\t\t.then(\n\t\t\t\t\tlog =>\n\t\t\t\t\t\tlog ??\n\t\t\t\t\t\t(gitUri.sha\n\t\t\t\t\t\t\t? this.container.git.getLogForFile(gitUri.repoPath, gitUri.fsPath, { ref: gitUri.sha })\n\t\t\t\t\t\t\t: undefined),\n\t\t\t\t);\n\n\t\t\tconst title = `Open Changes with Revision${pad(GlyphChars.Dot, 2, 2)}`;\n\t\t\tconst pick = await CommitPicker.show(\n\t\t\t\tlog,\n\t\t\t\t`${title}${gitUri.getFormattedFileName({\n\t\t\t\t\tsuffix: gitUri.sha ? `:${GitRevision.shorten(gitUri.sha)}` : undefined,\n\t\t\t\t\ttruncateTo: quickPickTitleMaxChars - title.length,\n\t\t\t\t})}`,\n\t\t\t\t'Choose a commit to compare with',\n\t\t\t\t{\n\t\t\t\t\tpicked: gitUri.sha,\n\t\t\t\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\t\t\t\tonDidPressKey: async (key, item) => {\n\t\t\t\t\t\tvoid (await executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\t\t\t\t\trepoPath: gitUri.repoPath,\n\t\t\t\t\t\t\tlhs: {\n\t\t\t\t\t\t\t\tsha: item.item.ref,\n\t\t\t\t\t\t\t\turi: gitUri,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trhs: {\n\t\t\t\t\t\t\t\tsha: '',\n\t\t\t\t\t\t\t\turi: gitUri,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tline: args!.line,\n\t\t\t\t\t\t\tshowOptions: args!.showOptions,\n\t\t\t\t\t\t}));\n\t\t\t\t\t},\n\t\t\t\t\tshowOtherReferences: [\n\t\t\t\t\t\tCommandQuickPickItem.fromCommand('Choose a Branch or Tag...', Commands.DiffWithRevisionFrom),\n\t\t\t\t\t\tCommandQuickPickItem.fromCommand<DiffWithRevisionFromCommandArgs>(\n\t\t\t\t\t\t\t'Choose a Stash...',\n\t\t\t\t\t\t\tCommands.DiffWithRevisionFrom,\n\t\t\t\t\t\t\t{ stash: true },\n\t\t\t\t\t\t),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t);\n\t\t\tif (pick == null) return;\n\n\t\t\tvoid (await executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\t\trepoPath: gitUri.repoPath,\n\t\t\t\tlhs: {\n\t\t\t\t\tsha: pick.ref,\n\t\t\t\t\turi: gitUri,\n\t\t\t\t},\n\t\t\t\trhs: {\n\t\t\t\t\tsha: '',\n\t\t\t\t\turi: gitUri,\n\t\t\t\t},\n\t\t\t\tline: args.line,\n\t\t\t\tshowOptions: args.showOptions,\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'DiffWithRevisionCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open compare');\n\t\t}\n\t}\n}\n","import { TextDocumentShowOptions, TextEditor, Uri } from 'vscode';\nimport { Commands, GlyphChars, quickPickTitleMaxChars } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitReference, GitRevision } from '../git/models';\nimport { Messages } from '../messages';\nimport { StashPicker } from '../quickpicks/commitPicker';\nimport { ReferencePicker } from '../quickpicks/referencePicker';\nimport { command, executeCommand } from '../system/command';\nimport { basename } from '../system/path';\nimport { pad } from '../system/string';\nimport { ActiveEditorCommand, getCommandUri } from './base';\nimport { DiffWithCommandArgs } from './diffWith';\n\nexport interface DiffWithRevisionFromCommandArgs {\n\tline?: number;\n\tshowOptions?: TextDocumentShowOptions;\n\tstash?: boolean;\n}\n\n@command()\nexport class DiffWithRevisionFromCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.DiffWithRevisionFrom);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: DiffWithRevisionFromCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\tconst gitUri = await GitUri.fromUri(uri);\n\t\tif (!gitUri.repoPath) {\n\t\t\tvoid Messages.showNoRepositoryWarningMessage('Unable to open file compare');\n\n\t\t\treturn;\n\t\t}\n\n\t\targs = { ...args };\n\t\tif (args.line == null) {\n\t\t\targs.line = editor?.selection.active.line ?? 0;\n\t\t}\n\n\t\tconst path = this.container.git.getRelativePath(gitUri, gitUri.repoPath);\n\n\t\tlet ref;\n\t\tlet sha;\n\t\tif (args?.stash) {\n\t\t\tconst title = `Open Changes with Stash${pad(GlyphChars.Dot, 2, 2)}`;\n\t\t\tconst pick = await StashPicker.show(\n\t\t\t\tthis.container.git.getStash(gitUri.repoPath),\n\t\t\t\t`${title}${gitUri.getFormattedFileName({ truncateTo: quickPickTitleMaxChars - title.length })}`,\n\t\t\t\t'Choose a stash to compare with',\n\t\t\t\t{\n\t\t\t\t\tempty: `No stashes with '${gitUri.getFormattedFileName()}' found`,\n\t\t\t\t\t// Stashes should always come with files, so this should be fine (but protect it just in case)\n\t\t\t\t\tfilter: c => c.files?.some(f => f.path === path || f.originalPath === path) ?? true,\n\t\t\t\t},\n\t\t\t);\n\t\t\tif (pick == null) return;\n\n\t\t\tref = pick.ref;\n\t\t\tsha = ref;\n\t\t} else {\n\t\t\tconst title = `Open Changes with Branch or Tag${pad(GlyphChars.Dot, 2, 2)}`;\n\t\t\tconst pick = await ReferencePicker.show(\n\t\t\t\tgitUri.repoPath,\n\t\t\t\t`${title}${gitUri.getFormattedFileName({ truncateTo: quickPickTitleMaxChars - title.length })}`,\n\t\t\t\t'Choose a branch or tag to compare with',\n\t\t\t\t{\n\t\t\t\t\tallowEnteringRefs: true,\n\t\t\t\t\t// checkmarks: false,\n\t\t\t\t},\n\t\t\t);\n\t\t\tif (pick == null) return;\n\n\t\t\tref = pick.ref;\n\t\t\tsha = GitReference.isBranch(pick) && pick.remote ? `remotes/${ref}` : ref;\n\t\t}\n\n\t\tif (ref == null) return;\n\n\t\tlet renamedUri: Uri | undefined;\n\t\tlet renamedTitle: string | undefined;\n\n\t\t// Check to see if this file has been renamed\n\t\tconst files = await this.container.git.getDiffStatus(gitUri.repoPath, 'HEAD', ref, { filters: ['R', 'C'] });\n\t\tif (files != null) {\n\t\t\tconst rename = files.find(s => s.path === path);\n\t\t\tif (rename?.originalPath != null) {\n\t\t\t\trenamedUri = this.container.git.getAbsoluteUri(rename.originalPath, gitUri.repoPath);\n\t\t\t\trenamedTitle = `${basename(rename.originalPath)} (${GitRevision.shorten(ref)})`;\n\t\t\t}\n\t\t}\n\n\t\tvoid (await executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\trepoPath: gitUri.repoPath,\n\t\t\tlhs: {\n\t\t\t\tsha: sha,\n\t\t\t\turi: renamedUri ?? gitUri,\n\t\t\t\ttitle: renamedTitle ?? `${basename(gitUri.fsPath)} (${GitRevision.shorten(ref)})`,\n\t\t\t},\n\t\t\trhs: {\n\t\t\t\tsha: '',\n\t\t\t\turi: gitUri,\n\t\t\t},\n\t\t\tline: args.line,\n\t\t\tshowOptions: args.showOptions,\n\t\t}));\n\t}\n}\n","import { TextDocumentShowOptions, TextEditor, Uri, window } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitRevision } from '../git/models';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command, executeCommand } from '../system/command';\nimport { ActiveEditorCommand, getCommandUri } from './base';\nimport { DiffWithCommandArgs } from './diffWith';\n\nexport interface DiffWithWorkingCommandArgs {\n\tinDiffRightEditor?: boolean;\n\turi?: Uri;\n\tline?: number;\n\tshowOptions?: TextDocumentShowOptions;\n}\n\n@command()\nexport class DiffWithWorkingCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.DiffWithWorking, Commands.DiffWithWorkingInDiffLeft, Commands.DiffWithWorkingInDiffRight]);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: DiffWithWorkingCommandArgs): Promise<any> {\n\t\targs = { ...args };\n\t\tif (args.uri == null) {\n\t\t\turi = getCommandUri(uri, editor);\n\t\t\tif (uri == null) return;\n\t\t} else {\n\t\t\turi = args.uri;\n\t\t}\n\n\t\tlet gitUri = await GitUri.fromUri(uri);\n\n\t\tif (args.line == null) {\n\t\t\targs.line = editor?.selection.active.line ?? 0;\n\t\t}\n\n\t\tif (args.inDiffRightEditor) {\n\t\t\ttry {\n\t\t\t\tconst diffUris = await this.container.git.getPreviousComparisonUris(\n\t\t\t\t\tgitUri.repoPath!,\n\t\t\t\t\tgitUri,\n\t\t\t\t\tgitUri.sha,\n\t\t\t\t);\n\t\t\t\tgitUri = diffUris?.previous ?? gitUri;\n\t\t\t} catch (ex) {\n\t\t\t\tLogger.error(\n\t\t\t\t\tex,\n\t\t\t\t\t'DiffWithWorkingCommand',\n\t\t\t\t\t`getPreviousDiffUris(${gitUri.repoPath}, ${gitUri.fsPath}, ${gitUri.sha})`,\n\t\t\t\t);\n\t\t\t\tvoid Messages.showGenericErrorMessage('Unable to open compare');\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// If the sha is missing, just let the user know the file matches\n\t\tif (gitUri.sha == null) {\n\t\t\tvoid window.showInformationMessage('File matches the working tree');\n\n\t\t\treturn;\n\t\t}\n\t\tif (gitUri.sha === GitRevision.deletedOrMissing) {\n\t\t\tvoid window.showWarningMessage('Unable to open compare. File has been deleted from the working tree');\n\n\t\t\treturn;\n\t\t}\n\n\t\t// If we are a fake \"staged\" sha, check the status\n\t\tif (gitUri.isUncommittedStaged) {\n\t\t\tconst status = await this.container.git.getStatusForFile(gitUri.repoPath!, gitUri);\n\t\t\tif (status?.indexStatus != null) {\n\t\t\t\tvoid (await executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\t\t\trepoPath: gitUri.repoPath,\n\t\t\t\t\tlhs: {\n\t\t\t\t\t\tsha: GitRevision.uncommittedStaged,\n\t\t\t\t\t\turi: gitUri.documentUri(),\n\t\t\t\t\t},\n\t\t\t\t\trhs: {\n\t\t\t\t\t\tsha: '',\n\t\t\t\t\t\turi: gitUri.documentUri(),\n\t\t\t\t\t},\n\t\t\t\t\tline: args.line,\n\t\t\t\t\tshowOptions: args.showOptions,\n\t\t\t\t}));\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\turi = gitUri.toFileUri();\n\n\t\tconst workingUri = await this.container.git.getWorkingUri(gitUri.repoPath!, uri);\n\t\tif (workingUri == null) {\n\t\t\tvoid window.showWarningMessage('Unable to open compare. File has been deleted from the working tree');\n\n\t\t\treturn;\n\t\t}\n\n\t\tvoid (await executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\trepoPath: gitUri.repoPath,\n\t\t\tlhs: {\n\t\t\t\tsha: gitUri.sha,\n\t\t\t\turi: uri,\n\t\t\t},\n\t\t\trhs: {\n\t\t\t\tsha: '',\n\t\t\t\turi: workingUri,\n\t\t\t},\n\t\t\tline: args.line,\n\t\t\tshowOptions: args.showOptions,\n\t\t}));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport const enum RefType {\n\tHead,\n\tRemoteHead,\n\tTag,\n}\n\nexport const enum Status {\n\tINDEX_MODIFIED,\n\tINDEX_ADDED,\n\tINDEX_DELETED,\n\tINDEX_RENAMED,\n\tINDEX_COPIED,\n\n\tMODIFIED,\n\tDELETED,\n\tUNTRACKED,\n\tIGNORED,\n\tINTENT_TO_ADD,\n\n\tADDED_BY_US,\n\tADDED_BY_THEM,\n\tDELETED_BY_US,\n\tDELETED_BY_THEM,\n\tBOTH_ADDED,\n\tBOTH_DELETED,\n\tBOTH_MODIFIED,\n}\n\nexport const enum GitErrorCodes {\n\tBadConfigFile = 'BadConfigFile',\n\tAuthenticationFailed = 'AuthenticationFailed',\n\tNoUserNameConfigured = 'NoUserNameConfigured',\n\tNoUserEmailConfigured = 'NoUserEmailConfigured',\n\tNoRemoteRepositorySpecified = 'NoRemoteRepositorySpecified',\n\tNotAGitRepository = 'NotAGitRepository',\n\tNotAtRepositoryRoot = 'NotAtRepositoryRoot',\n\tConflict = 'Conflict',\n\tStashConflict = 'StashConflict',\n\tUnmergedChanges = 'UnmergedChanges',\n\tPushRejected = 'PushRejected',\n\tRemoteConnectionError = 'RemoteConnectionError',\n\tDirtyWorkTree = 'DirtyWorkTree',\n\tCantOpenResource = 'CantOpenResource',\n\tGitNotFound = 'GitNotFound',\n\tCantCreatePipe = 'CantCreatePipe',\n\tPermissionDenied = 'PermissionDenied',\n\tCantAccessRemote = 'CantAccessRemote',\n\tRepositoryNotFound = 'RepositoryNotFound',\n\tRepositoryIsLocked = 'RepositoryIsLocked',\n\tBranchNotFullyMerged = 'BranchNotFullyMerged',\n\tNoRemoteReference = 'NoRemoteReference',\n\tInvalidBranchName = 'InvalidBranchName',\n\tBranchAlreadyExists = 'BranchAlreadyExists',\n\tNoLocalChanges = 'NoLocalChanges',\n\tNoStashFound = 'NoStashFound',\n\tLocalChangesOverwritten = 'LocalChangesOverwritten',\n\tNoUpstreamBranch = 'NoUpstreamBranch',\n\tIsInSubmodule = 'IsInSubmodule',\n\tWrongCase = 'WrongCase',\n\tCantLockRef = 'CantLockRef',\n\tCantRebaseMultipleBranches = 'CantRebaseMultipleBranches',\n\tPatchDoesNotApply = 'PatchDoesNotApply',\n\tNoPathFound = 'NoPathFound',\n\tUnknownPath = 'UnknownPath',\n}\n","export { Status as ScmStatus } from './vscode.git.enums';\n\nexport const enum ScmResourceGroupType {\n\tMerge,\n\tIndex,\n\tWorkingTree,\n}\n","import { env, SourceControlResourceState, Uri, window } from 'vscode';\nimport { ScmResource } from '../@types/vscode.git.resources';\nimport { ScmResourceGroupType, ScmStatus } from '../@types/vscode.git.resources.enums';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitRevision } from '../git/models';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { RepositoryPicker } from '../quickpicks/repositoryPicker';\nimport { filterMap } from '../system/array';\nimport { command } from '../system/command';\nimport {\n\tCommand,\n\tCommandContext,\n\tisCommandContextViewNodeHasFileCommit,\n\tisCommandContextViewNodeHasFileRefs,\n} from './base';\n\ninterface ExternalDiffFile {\n\turi: Uri;\n\tstaged: boolean;\n\tref1?: string;\n\tref2?: string;\n}\n\nexport interface ExternalDiffCommandArgs {\n\tfiles?: ExternalDiffFile[];\n}\n\n@command()\nexport class ExternalDiffCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.ExternalDiff, Commands.ExternalDiffAll]);\n\t}\n\n\tprotected override async preExecute(context: CommandContext, args?: ExternalDiffCommandArgs) {\n\t\targs = { ...args };\n\n\t\tif (isCommandContextViewNodeHasFileCommit(context)) {\n\t\t\tconst previousSha = await context.node.commit.getPreviousSha();\n\t\t\tconst ref1 = GitRevision.isUncommitted(previousSha) ? '' : previousSha;\n\t\t\tconst ref2 = context.node.commit.isUncommitted ? '' : context.node.commit.sha;\n\n\t\t\targs.files = [\n\t\t\t\t{\n\t\t\t\t\turi: GitUri.fromFile(context.node.file, context.node.file.repoPath ?? context.node.repoPath),\n\t\t\t\t\tstaged: context.node.commit.isUncommittedStaged || context.node.file.indexStatus != null,\n\t\t\t\t\tref1: ref1,\n\t\t\t\t\tref2: ref2,\n\t\t\t\t},\n\t\t\t];\n\n\t\t\treturn this.execute(args);\n\t\t}\n\n\t\tif (isCommandContextViewNodeHasFileRefs(context)) {\n\t\t\targs.files = [\n\t\t\t\t{\n\t\t\t\t\turi: GitUri.fromFile(context.node.file, context.node.file.repoPath ?? context.node.repoPath),\n\t\t\t\t\tstaged: context.node.file.indexStatus != null,\n\t\t\t\t\tref1: context.node.ref1,\n\t\t\t\t\tref2: context.node.ref2,\n\t\t\t\t},\n\t\t\t];\n\n\t\t\treturn this.execute(args);\n\t\t}\n\n\t\tif (args.files == null) {\n\t\t\tif (context.type === 'scm-states') {\n\t\t\t\targs.files = context.scmResourceStates.map(r => ({\n\t\t\t\t\turi: r.resourceUri,\n\t\t\t\t\tstaged: (r as ScmResource).resourceGroupType === ScmResourceGroupType.Index,\n\t\t\t\t}));\n\t\t\t} else if (context.type === 'scm-groups') {\n\t\t\t\targs.files = filterMap(context.scmResourceGroups[0].resourceStates, r =>\n\t\t\t\t\tthis.isModified(r)\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\turi: r.resourceUri,\n\t\t\t\t\t\t\t\tstaged: (r as ScmResource).resourceGroupType === ScmResourceGroupType.Index,\n\t\t\t\t\t\t  }\n\t\t\t\t\t\t: undefined,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (context.command === Commands.ExternalDiffAll) {\n\t\t\tif (args.files == null) {\n\t\t\t\tconst repository = await RepositoryPicker.getRepositoryOrShow('Open All Changes (difftool)');\n\t\t\t\tif (repository == null) return undefined;\n\n\t\t\t\tconst status = await this.container.git.getStatusForRepo(repository.uri);\n\t\t\t\tif (status == null) {\n\t\t\t\t\treturn window.showInformationMessage(\"The repository doesn't have any changes\");\n\t\t\t\t}\n\n\t\t\t\targs.files = [];\n\n\t\t\t\tfor (const file of status.files) {\n\t\t\t\t\tif (file.indexStatus === 'M') {\n\t\t\t\t\t\targs.files.push({ uri: file.uri, staged: true });\n\t\t\t\t\t}\n\n\t\t\t\t\tif (file.workingTreeStatus === 'M') {\n\t\t\t\t\t\targs.files.push({ uri: file.uri, staged: false });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.execute(args);\n\t}\n\n\tprivate isModified(resource: SourceControlResourceState) {\n\t\tconst status = (resource as ScmResource).type;\n\t\treturn (\n\t\t\tstatus === ScmStatus.BOTH_MODIFIED || status === ScmStatus.INDEX_MODIFIED || status === ScmStatus.MODIFIED\n\t\t);\n\t}\n\n\tasync execute(args?: ExternalDiffCommandArgs) {\n\t\targs = { ...args };\n\n\t\ttry {\n\t\t\tlet repoPath;\n\t\t\tif (args.files == null) {\n\t\t\t\tconst editor = window.activeTextEditor;\n\t\t\t\tif (editor == null) return;\n\n\t\t\t\trepoPath = this.container.git.getBestRepository(editor)?.path;\n\t\t\t\tif (!repoPath) return;\n\n\t\t\t\tconst uri = editor.document.uri;\n\t\t\t\tconst status = await this.container.git.getStatusForFile(repoPath, uri);\n\t\t\t\tif (status == null) {\n\t\t\t\t\tvoid window.showInformationMessage(\"The current file doesn't have any changes\");\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\targs.files = [];\n\t\t\t\tif (status.indexStatus === 'M') {\n\t\t\t\t\targs.files.push({ uri: status.uri, staged: true });\n\t\t\t\t}\n\n\t\t\t\tif (status.workingTreeStatus === 'M') {\n\t\t\t\t\targs.files.push({ uri: status.uri, staged: false });\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trepoPath = (await this.container.git.getOrOpenRepository(args.files[0].uri))?.path;\n\t\t\t\tif (!repoPath) return;\n\t\t\t}\n\n\t\t\tconst tool =\n\t\t\t\tthis.container.config.advanced.externalDiffTool || (await this.container.git.getDiffTool(repoPath));\n\t\t\tif (!tool) {\n\t\t\t\tconst viewDocs = 'View Git Docs';\n\t\t\t\tconst result = await window.showWarningMessage(\n\t\t\t\t\t'Unable to open changes because no Git diff tool is configured',\n\t\t\t\t\tviewDocs,\n\t\t\t\t);\n\t\t\t\tif (result === viewDocs) {\n\t\t\t\t\tvoid env.openExternal(\n\t\t\t\t\t\tUri.parse('https://git-scm.com/docs/git-config#Documentation/git-config.txt-difftool'),\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (const file of args.files) {\n\t\t\t\tvoid this.container.git.openDiffTool(repoPath, file.uri, {\n\t\t\t\t\tref1: file.ref1,\n\t\t\t\t\tref2: file.ref2,\n\t\t\t\t\tstaged: file.staged,\n\t\t\t\t\ttool: tool,\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'ExternalDiffCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open changes in diff tool');\n\t\t}\n\t}\n}\n","import { Disposable, InputBox, QuickInputButton, QuickInputButtons, QuickPick, QuickPickItem, window } from 'vscode';\nimport { configuration } from '../configuration';\nimport { Commands } from '../constants';\nimport { Container } from '../container';\nimport { KeyMapping } from '../keyboard';\nimport { Directive, DirectiveQuickPickItem } from '../quickpicks/items/directive';\nimport { command } from '../system/command';\nimport { log } from '../system/decorators/log';\nimport { isPromise } from '../system/promise';\nimport { Command, CommandContext } from './base';\nimport type { BranchGitCommandArgs } from './git/branch';\nimport type { CherryPickGitCommandArgs } from './git/cherry-pick';\nimport type { CoAuthorsGitCommandArgs } from './git/coauthors';\nimport type { FetchGitCommandArgs } from './git/fetch';\nimport type { LogGitCommandArgs } from './git/log';\nimport type { MergeGitCommandArgs } from './git/merge';\nimport type { PullGitCommandArgs } from './git/pull';\nimport type { PushGitCommandArgs } from './git/push';\nimport type { RebaseGitCommandArgs } from './git/rebase';\nimport type { ResetGitCommandArgs } from './git/reset';\nimport type { RevertGitCommandArgs } from './git/revert';\nimport type { SearchGitCommandArgs } from './git/search';\nimport type { ShowGitCommandArgs } from './git/show';\nimport type { StashGitCommandArgs } from './git/stash';\nimport type { StatusGitCommandArgs } from './git/status';\nimport type { SwitchGitCommandArgs } from './git/switch';\nimport type { TagGitCommandArgs } from './git/tag';\nimport type { WorktreeGitCommandArgs } from './git/worktree';\nimport { PickCommandStep } from './gitCommands.utils';\nimport {\n\tCustomStep,\n\tisCustomStep,\n\tisQuickInputStep,\n\tisQuickPickStep,\n\tQuickCommand,\n\tQuickInputStep,\n\tQuickPickStep,\n\tStepResult,\n\tStepSelection,\n} from './quickCommand';\nimport { QuickCommandButtons, ToggleQuickInputButton } from './quickCommand.buttons';\n\nconst sanitizeLabel = /\\$\\(.+?\\)|\\s/g;\nconst showLoadingSymbol = Symbol('ShowLoading');\n\nexport type GitCommandsCommandArgs =\n\t| BranchGitCommandArgs\n\t| CherryPickGitCommandArgs\n\t| CoAuthorsGitCommandArgs\n\t| FetchGitCommandArgs\n\t| LogGitCommandArgs\n\t| MergeGitCommandArgs\n\t| PullGitCommandArgs\n\t| PushGitCommandArgs\n\t| RebaseGitCommandArgs\n\t| ResetGitCommandArgs\n\t| RevertGitCommandArgs\n\t| SearchGitCommandArgs\n\t| ShowGitCommandArgs\n\t| StashGitCommandArgs\n\t| StatusGitCommandArgs\n\t| SwitchGitCommandArgs\n\t| TagGitCommandArgs\n\t| WorktreeGitCommandArgs;\n\n@command()\nexport class GitCommandsCommand extends Command {\n\tprivate startedWith: 'menu' | 'command' = 'menu';\n\n\tconstructor(private readonly container: Container) {\n\t\tsuper([\n\t\t\tCommands.GitCommands,\n\t\t\tCommands.GitCommandsBranch,\n\t\t\tCommands.GitCommandsCherryPick,\n\t\t\tCommands.GitCommandsMerge,\n\t\t\tCommands.GitCommandsRebase,\n\t\t\tCommands.GitCommandsReset,\n\t\t\tCommands.GitCommandsRevert,\n\t\t\tCommands.GitCommandsSwitch,\n\t\t\tCommands.GitCommandsTag,\n\t\t\tCommands.GitCommandsWorktree,\n\t\t]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: GitCommandsCommandArgs) {\n\t\tswitch (context.command) {\n\t\t\tcase Commands.GitCommandsBranch:\n\t\t\t\targs = { command: 'branch' };\n\t\t\t\tbreak;\n\t\t\tcase Commands.GitCommandsCherryPick:\n\t\t\t\targs = { command: 'cherry-pick' };\n\t\t\t\tbreak;\n\t\t\tcase Commands.GitCommandsMerge:\n\t\t\t\targs = { command: 'merge' };\n\t\t\t\tbreak;\n\t\t\tcase Commands.GitCommandsRebase:\n\t\t\t\targs = { command: 'rebase' };\n\t\t\t\tbreak;\n\t\t\tcase Commands.GitCommandsReset:\n\t\t\t\targs = { command: 'reset' };\n\t\t\t\tbreak;\n\t\t\tcase Commands.GitCommandsRevert:\n\t\t\t\targs = { command: 'revert' };\n\t\t\t\tbreak;\n\t\t\tcase Commands.GitCommandsSwitch:\n\t\t\t\targs = { command: 'switch' };\n\t\t\t\tbreak;\n\t\t\tcase Commands.GitCommandsTag:\n\t\t\t\targs = { command: 'tag' };\n\t\t\t\tbreak;\n\t\t\tcase Commands.GitCommandsWorktree:\n\t\t\t\targs = { command: 'worktree' };\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn this.execute(args);\n\t}\n\n\t@log({ args: false, correlate: true, singleLine: true, timed: false })\n\tasync execute(args?: GitCommandsCommandArgs) {\n\t\tconst commandsStep = new PickCommandStep(this.container, args);\n\n\t\tconst command = args?.command != null ? commandsStep.find(args.command) : undefined;\n\t\tthis.startedWith = command != null ? 'command' : 'menu';\n\n\t\tlet ignoreFocusOut;\n\n\t\tlet step: QuickPickStep<QuickPickItem> | QuickInputStep | CustomStep | undefined;\n\t\tif (command == null) {\n\t\t\tstep = commandsStep;\n\t\t} else {\n\t\t\tstep = await this.showLoadingIfNeeded(command, this.getCommandStep(command, commandsStep));\n\t\t}\n\n\t\t// If this is the first step, don't honor the step's setting\n\t\tif (step?.ignoreFocusOut === true) {\n\t\t\tstep.ignoreFocusOut = undefined;\n\t\t}\n\n\t\twhile (step != null) {\n\t\t\t// If we are trying to back up to the menu and have a starting command, then just reset to the starting command\n\t\t\tif (step === commandsStep && command != null) {\n\t\t\t\tstep = await this.getCommandStep(command, commandsStep);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (ignoreFocusOut && step.ignoreFocusOut == null) {\n\t\t\t\tstep.ignoreFocusOut = true;\n\t\t\t}\n\n\t\t\tif (isQuickPickStep(step)) {\n\t\t\t\tstep = await this.showPickStep(step, commandsStep);\n\t\t\t\tif (step?.ignoreFocusOut === true) {\n\t\t\t\t\tignoreFocusOut = true;\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (isQuickInputStep(step)) {\n\t\t\t\tstep = await this.showInputStep(step, commandsStep);\n\t\t\t\tif (step?.ignoreFocusOut === true) {\n\t\t\t\t\tignoreFocusOut = true;\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (isCustomStep(step)) {\n\t\t\t\tstep = await this.showCustomStep(step, commandsStep);\n\t\t\t\tif (step?.ignoreFocusOut === true) {\n\t\t\t\t\tignoreFocusOut = true;\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate async showLoadingIfNeeded(\n\t\tcommand: QuickCommand<any>,\n\t\tstepPromise: Promise<QuickPickStep<QuickPickItem> | QuickInputStep | CustomStep | undefined>,\n\t): Promise<QuickPickStep<QuickPickItem> | QuickInputStep | CustomStep | undefined> {\n\t\tconst stepOrTimeout = await Promise.race([\n\t\t\tstepPromise,\n\t\t\tnew Promise<typeof showLoadingSymbol>(resolve => setTimeout(() => resolve(showLoadingSymbol), 250)),\n\t\t]);\n\n\t\tif (stepOrTimeout !== showLoadingSymbol) {\n\t\t\treturn stepOrTimeout;\n\t\t}\n\n\t\tconst quickpick = window.createQuickPick();\n\t\tquickpick.ignoreFocusOut = false;\n\n\t\tconst disposables: Disposable[] = [];\n\n\t\tlet step: QuickPickStep<QuickPickItem> | QuickInputStep | CustomStep | undefined;\n\t\ttry {\n\t\t\treturn await new Promise<QuickPickStep<QuickPickItem> | QuickInputStep | CustomStep | undefined>(\n\t\t\t\t// eslint-disable-next-line no-async-promise-executor\n\t\t\t\tasync resolve => {\n\t\t\t\t\tdisposables.push(quickpick.onDidHide(() => resolve(step)));\n\n\t\t\t\t\tquickpick.title = command.title;\n\t\t\t\t\tquickpick.placeholder = 'Loading...';\n\t\t\t\t\tquickpick.busy = true;\n\t\t\t\t\tquickpick.enabled = false;\n\n\t\t\t\t\tquickpick.show();\n\n\t\t\t\t\tstep = await stepPromise;\n\n\t\t\t\t\tquickpick.hide();\n\t\t\t\t},\n\t\t\t);\n\t\t} finally {\n\t\t\tquickpick.dispose();\n\t\t\tdisposables.forEach(d => d.dispose());\n\t\t}\n\t}\n\n\tprivate getButtons(step: QuickInputStep | QuickPickStep | undefined, command?: QuickCommand) {\n\t\tconst buttons: QuickInputButton[] = [];\n\n\t\tif (step != null) {\n\t\t\tif (step.buttons != null) {\n\t\t\t\tbuttons.push(...step.buttons);\n\t\t\t\treturn buttons;\n\t\t\t}\n\n\t\t\tbuttons.push(QuickInputButtons.Back);\n\n\t\t\tif (step.additionalButtons != null) {\n\t\t\t\tbuttons.push(...step.additionalButtons);\n\t\t\t}\n\t\t}\n\n\t\tif (command?.canConfirm) {\n\t\t\tif (command.canSkipConfirm) {\n\t\t\t\tconst willConfirmToggle = new QuickCommandButtons.WillConfirmToggle(command.confirm(), async () => {\n\t\t\t\t\tif (command?.skipConfirmKey == null) return;\n\n\t\t\t\t\tconst skipConfirmations = configuration.get('gitCommands.skipConfirmations') ?? [];\n\n\t\t\t\t\tconst index = skipConfirmations.indexOf(command.skipConfirmKey);\n\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\tskipConfirmations.splice(index, 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tskipConfirmations.push(command.skipConfirmKey);\n\t\t\t\t\t}\n\n\t\t\t\t\tvoid (await configuration.updateEffective('gitCommands.skipConfirmations', skipConfirmations));\n\t\t\t\t});\n\t\t\t\tbuttons.push(willConfirmToggle);\n\t\t\t} else {\n\t\t\t\tbuttons.push(QuickCommandButtons.WillConfirmForced);\n\t\t\t}\n\t\t}\n\n\t\treturn buttons;\n\t}\n\n\tprivate async getCommandStep(command: QuickCommand, commandsStep: PickCommandStep) {\n\t\tcommandsStep.setCommand(command, 'command');\n\n\t\tconst next = await command.next();\n\t\tif (next.done) return undefined;\n\n\t\treturn next.value;\n\t}\n\n\tprivate async nextStep(\n\t\tcommand: QuickCommand,\n\t\tvalue: StepSelection<any> | undefined,\n\t\tquickInput?: InputBox | QuickPick<QuickPickItem>,\n\t) {\n\t\tif (quickInput != null) {\n\t\t\tquickInput.busy = true;\n\t\t\t// quickInput.enabled = false;\n\t\t}\n\n\t\tconst next = await command.next(value);\n\t\tif (next.done) return undefined;\n\n\t\tif (quickInput != null) {\n\t\t\tquickInput.value = '';\n\t\t}\n\t\treturn next.value;\n\t}\n\n\tprivate async showCustomStep(step: CustomStep, commandsStep: PickCommandStep) {\n\t\tconst result = await step.show(step);\n\t\tif (result === StepResult.Break) return undefined;\n\n\t\tif (Directive.is(result)) {\n\t\t\tswitch (result) {\n\t\t\t\tcase Directive.Back:\n\t\t\t\t\treturn (await commandsStep?.command?.previous()) ?? commandsStep;\n\t\t\t\tcase Directive.Noop:\n\t\t\t\t\treturn commandsStep.command?.retry();\n\t\t\t\tcase Directive.Cancel:\n\t\t\t\tdefault:\n\t\t\t\t\treturn undefined;\n\t\t\t}\n\t\t} else {\n\t\t\treturn this.nextStep(commandsStep.command!, result);\n\t\t}\n\t\t// switch (result.directive) {\n\t\t// \tcase 'back':\n\t\t// \t\treturn (await commandsStep?.command?.previous()) ?? commandsStep;\n\t\t// \tcase 'cancel':\n\t\t// \t\treturn undefined;\n\t\t// \tcase 'next':\n\t\t// \t\treturn this.nextStep(commandsStep.command!, result.value);\n\t\t// \tcase 'retry':\n\t\t// \t\treturn commandsStep.command?.retry();\n\t\t// \tdefault:\n\t\t// \t\treturn undefined;\n\t\t// }\n\t}\n\n\tprivate async showInputStep(step: QuickInputStep, commandsStep: PickCommandStep) {\n\t\tconst input = window.createInputBox();\n\t\tinput.ignoreFocusOut = !configuration.get('gitCommands.closeOnFocusOut') ? true : step.ignoreFocusOut ?? false;\n\n\t\tconst disposables: Disposable[] = [];\n\n\t\ttry {\n\t\t\treturn await new Promise<QuickPickStep | QuickInputStep | undefined>(resolve => {\n\t\t\t\tconst goBack = async () => {\n\t\t\t\t\tinput.value = '';\n\t\t\t\t\tif (commandsStep.command != null) {\n\t\t\t\t\t\tinput.busy = true;\n\t\t\t\t\t\tresolve((await commandsStep.command.previous()) ?? commandsStep);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tconst mapping: KeyMapping = {\n\t\t\t\t\tleft: { onDidPressKey: goBack },\n\t\t\t\t};\n\t\t\t\tif (step.onDidPressKey != null && step.keys != null && step.keys.length !== 0) {\n\t\t\t\t\tfor (const key of step.keys) {\n\t\t\t\t\t\tmapping[key] = {\n\t\t\t\t\t\t\tonDidPressKey: key => step.onDidPressKey!(input, key),\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst scope = this.container.keyboard.createScope(mapping);\n\t\t\t\tvoid scope.start();\n\n\t\t\t\tdisposables.push(\n\t\t\t\t\tscope,\n\t\t\t\t\tinput.onDidHide(() => resolve(undefined)),\n\t\t\t\t\tinput.onDidTriggerButton(async e => {\n\t\t\t\t\t\tif (e === QuickInputButtons.Back) {\n\t\t\t\t\t\t\tvoid goBack();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (e === QuickCommandButtons.WillConfirmForced) return;\n\n\t\t\t\t\t\tif (e instanceof ToggleQuickInputButton && e.onDidClick != null) {\n\t\t\t\t\t\t\tconst result = e.onDidClick(input);\n\n\t\t\t\t\t\t\tinput.buttons = this.getButtons(step, commandsStep.command);\n\n\t\t\t\t\t\t\tif ((await result) === true) {\n\t\t\t\t\t\t\t\tresolve(commandsStep.command?.retry());\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (isPromise(result)) {\n\t\t\t\t\t\t\t\tinput.buttons = this.getButtons(step, commandsStep.command);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (step.onDidClickButton != null) {\n\t\t\t\t\t\t\tconst result = step.onDidClickButton(input, e);\n\t\t\t\t\t\t\tinput.buttons = this.getButtons(step, commandsStep.command);\n\t\t\t\t\t\t\tif ((await result) === true) {\n\t\t\t\t\t\t\t\tresolve(commandsStep.command?.retry());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tinput.onDidChangeValue(async e => {\n\t\t\t\t\t\tif (scope != null) {\n\t\t\t\t\t\t\t// Pause the left/right keyboard commands if there is a value, otherwise the left/right arrows won't work in the input properly\n\t\t\t\t\t\t\tif (e.length !== 0) {\n\t\t\t\t\t\t\t\tawait scope.pause(['left', 'right']);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tawait scope.resume();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (step.validate == null) return;\n\n\t\t\t\t\t\tconst [, message] = await step.validate(e);\n\t\t\t\t\t\tinput.validationMessage = message;\n\t\t\t\t\t}),\n\t\t\t\t\tinput.onDidAccept(async () => {\n\t\t\t\t\t\tresolve(await this.nextStep(commandsStep.command!, input.value, input));\n\t\t\t\t\t}),\n\t\t\t\t);\n\n\t\t\t\tinput.buttons = this.getButtons(step, commandsStep.command);\n\t\t\t\tinput.title = step.title;\n\t\t\t\tinput.placeholder = step.placeholder;\n\t\t\t\tinput.prompt = step.prompt;\n\t\t\t\tif (step.value != null) {\n\t\t\t\t\tinput.value = step.value;\n\t\t\t\t}\n\n\t\t\t\t// If we are starting over clear the previously active command\n\t\t\t\tif (commandsStep.command != null && step === commandsStep) {\n\t\t\t\t\tcommandsStep.setCommand(undefined, 'menu');\n\t\t\t\t}\n\n\t\t\t\tinput.show();\n\n\t\t\t\t// Manually trigger `onDidChangeValue`, because the InputBox seems to fail to call it properly\n\t\t\t\tif (step.value != null) {\n\t\t\t\t\t// HACK: This is fragile!\n\t\t\t\t\t(input as any)._onDidChangeValueEmitter.fire(input.value);\n\t\t\t\t}\n\t\t\t});\n\t\t} finally {\n\t\t\tinput.dispose();\n\t\t\tdisposables.forEach(d => d.dispose());\n\t\t}\n\t}\n\n\tprivate async showPickStep(step: QuickPickStep, commandsStep: PickCommandStep) {\n\t\tconst originalIgnoreFocusOut = !configuration.get('gitCommands.closeOnFocusOut')\n\t\t\t? true\n\t\t\t: step.ignoreFocusOut ?? false;\n\t\tconst originalStepIgnoreFocusOut = step.ignoreFocusOut;\n\n\t\tconst quickpick = window.createQuickPick();\n\t\tquickpick.ignoreFocusOut = originalIgnoreFocusOut;\n\n\t\tconst disposables: Disposable[] = [];\n\n\t\ttry {\n\t\t\treturn await new Promise<QuickPickStep | QuickInputStep | undefined>(resolve => {\n\t\t\t\tasync function goBack() {\n\t\t\t\t\tquickpick.value = '';\n\t\t\t\t\tif (commandsStep.command != null) {\n\t\t\t\t\t\tquickpick.busy = true;\n\t\t\t\t\t\tresolve((await commandsStep.command.previous()) ?? commandsStep);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tasync function loadMore() {\n\t\t\t\t\tif (step.onDidLoadMore == null) return;\n\n\t\t\t\t\tquickpick.busy = true;\n\t\t\t\t\tquickpick.enabled = false;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst items = await step.onDidLoadMore?.(quickpick);\n\n\t\t\t\t\t\tlet activeIndex = -1;\n\t\t\t\t\t\tif (quickpick.activeItems.length !== 0) {\n\t\t\t\t\t\t\tconst active = quickpick.activeItems[0];\n\t\t\t\t\t\t\tactiveIndex = quickpick.items.indexOf(active);\n\n\t\t\t\t\t\t\t// If the active item is the \"Load more\" directive, then select the previous item\n\t\t\t\t\t\t\tif (DirectiveQuickPickItem.is(active)) {\n\t\t\t\t\t\t\t\tactiveIndex--;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tquickpick.items = step.items = items;\n\n\t\t\t\t\t\tif (activeIndex) {\n\t\t\t\t\t\t\tquickpick.activeItems = [quickpick.items[activeIndex]];\n\t\t\t\t\t\t}\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tquickpick.busy = false;\n\t\t\t\t\t\tquickpick.enabled = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst mapping: KeyMapping = {\n\t\t\t\t\tleft: { onDidPressKey: goBack },\n\t\t\t\t};\n\t\t\t\tif (step.onDidPressKey != null && step.keys != null && step.keys.length !== 0) {\n\t\t\t\t\tfor (const key of step.keys) {\n\t\t\t\t\t\tmapping[key] = {\n\t\t\t\t\t\t\tonDidPressKey: key => step.onDidPressKey!(quickpick, key),\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst scope = this.container.keyboard.createScope(mapping);\n\t\t\t\tvoid scope.start();\n\n\t\t\t\tlet overrideItems = false;\n\n\t\t\t\tdisposables.push(\n\t\t\t\t\tscope,\n\t\t\t\t\tquickpick.onDidHide(() => resolve(undefined)),\n\t\t\t\t\tquickpick.onDidTriggerItemButton(async e => {\n\t\t\t\t\t\tif ((await step.onDidClickItemButton?.(quickpick, e.button, e.item)) === true) {\n\t\t\t\t\t\t\tresolve(await this.nextStep(commandsStep.command!, [e.item], quickpick));\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tquickpick.onDidTriggerButton(async e => {\n\t\t\t\t\t\tif (e === QuickInputButtons.Back) {\n\t\t\t\t\t\t\tvoid goBack();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (e === QuickCommandButtons.WillConfirmForced) return;\n\n\t\t\t\t\t\tif (e === QuickCommandButtons.LoadMore) {\n\t\t\t\t\t\t\tvoid loadMore();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (e instanceof ToggleQuickInputButton && e.onDidClick != null) {\n\t\t\t\t\t\t\tlet activeCommand;\n\t\t\t\t\t\t\tif (commandsStep.command == null && quickpick.activeItems.length !== 0) {\n\t\t\t\t\t\t\t\tconst active = quickpick.activeItems[0];\n\t\t\t\t\t\t\t\tif (QuickCommand.is(active)) {\n\t\t\t\t\t\t\t\t\tactiveCommand = active;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst result = e.onDidClick(quickpick);\n\n\t\t\t\t\t\t\tquickpick.buttons = this.getButtons(\n\t\t\t\t\t\t\t\tactiveCommand != null ? activeCommand.value : step,\n\t\t\t\t\t\t\t\tactiveCommand ?? commandsStep.command,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif ((await result) === true) {\n\t\t\t\t\t\t\t\tresolve(commandsStep.command?.retry());\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (isPromise(result)) {\n\t\t\t\t\t\t\t\tquickpick.buttons = this.getButtons(\n\t\t\t\t\t\t\t\t\tactiveCommand != null ? activeCommand.value : step,\n\t\t\t\t\t\t\t\t\tactiveCommand ?? commandsStep.command,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (step.onDidClickButton != null) {\n\t\t\t\t\t\t\tconst result = step.onDidClickButton(quickpick, e);\n\t\t\t\t\t\t\tquickpick.buttons = this.getButtons(step, commandsStep.command);\n\t\t\t\t\t\t\tif ((await result) === true) {\n\t\t\t\t\t\t\t\tresolve(commandsStep.command?.retry());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tquickpick.onDidChangeValue(async e => {\n\t\t\t\t\t\tif (scope != null) {\n\t\t\t\t\t\t\t// Pause the left/right keyboard commands if there is a value, otherwise the left/right arrows won't work in the input properly\n\t\t\t\t\t\t\tif (e.length !== 0) {\n\t\t\t\t\t\t\t\tawait scope.pause(['left', 'right']);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tawait scope.resume();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (step.onDidChangeValue != null) {\n\t\t\t\t\t\t\tconst cancel = await step.onDidChangeValue(quickpick);\n\t\t\t\t\t\t\tif (cancel) return;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If something was typed, keep the quick pick open on focus loss\n\t\t\t\t\t\tif (e.length !== 0 && !quickpick.ignoreFocusOut) {\n\t\t\t\t\t\t\tquickpick.ignoreFocusOut = true;\n\t\t\t\t\t\t\tstep.ignoreFocusOut = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// If something typed was cleared, and we changed the behavior, then allow the quick pick close on focus loss\n\t\t\t\t\t\telse if (e.length === 0 && quickpick.ignoreFocusOut && !originalIgnoreFocusOut) {\n\t\t\t\t\t\t\tquickpick.ignoreFocusOut = originalIgnoreFocusOut;\n\t\t\t\t\t\t\tstep.ignoreFocusOut = originalStepIgnoreFocusOut;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!overrideItems) {\n\t\t\t\t\t\t\tif (quickpick.canSelectMany && e === ' ') {\n\t\t\t\t\t\t\t\tquickpick.value = '';\n\t\t\t\t\t\t\t\tquickpick.selectedItems =\n\t\t\t\t\t\t\t\t\tquickpick.selectedItems.length === quickpick.items.length ? [] : quickpick.items;\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (e.endsWith(' ')) {\n\t\t\t\t\t\t\t\tif (quickpick.canSelectMany && quickpick.selectedItems.length !== 0) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlet items;\n\t\t\t\t\t\t\t\tif (commandsStep.command == null) {\n\t\t\t\t\t\t\t\t\tconst command = commandsStep.find(quickpick.value.trim(), true);\n\t\t\t\t\t\t\t\t\tif (command == null) return;\n\n\t\t\t\t\t\t\t\t\tcommandsStep.setCommand(command, this.startedWith);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tconst cmd = quickpick.value.trim().toLowerCase();\n\t\t\t\t\t\t\t\t\tconst item = step.items.find(\n\t\t\t\t\t\t\t\t\t\ti => i.label.replace(sanitizeLabel, '').toLowerCase() === cmd,\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tif (item == null) return;\n\n\t\t\t\t\t\t\t\t\titems = [item];\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresolve(await this.nextStep(commandsStep.command!, items, quickpick));\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Assume there is no matches (since there is no activeItems)\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!quickpick.canSelectMany &&\n\t\t\t\t\t\t\tcommandsStep.command != null &&\n\t\t\t\t\t\t\te.trim().length !== 0 &&\n\t\t\t\t\t\t\t(overrideItems || quickpick.activeItems.length === 0)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tif (step.onValidateValue == null) return;\n\n\t\t\t\t\t\t\toverrideItems = await step.onValidateValue(quickpick, e.trim(), step.items);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toverrideItems = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If we are no longer overriding the items, put them back (only if we need to)\n\t\t\t\t\t\tif (!overrideItems && quickpick.items.length !== step.items.length) {\n\t\t\t\t\t\t\tquickpick.items = step.items;\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tquickpick.onDidChangeActive(() => {\n\t\t\t\t\t\tif (commandsStep.command != null || quickpick.activeItems.length === 0) return;\n\n\t\t\t\t\t\tconst command = quickpick.activeItems[0];\n\t\t\t\t\t\tif (!QuickCommand.is(command)) return;\n\n\t\t\t\t\t\tquickpick.buttons = this.getButtons(undefined, command);\n\t\t\t\t\t}),\n\t\t\t\t\tquickpick.onDidChangeSelection(e => {\n\t\t\t\t\t\tif (!quickpick.canSelectMany) return;\n\n\t\t\t\t\t\t// If something was selected, keep the quick pick open on focus loss\n\t\t\t\t\t\tif (e.length !== 0 && !quickpick.ignoreFocusOut) {\n\t\t\t\t\t\t\tquickpick.ignoreFocusOut = true;\n\t\t\t\t\t\t\tstep.ignoreFocusOut = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// If the selection was cleared, and we changed the behavior, then allow the quick pick close on focus loss\n\t\t\t\t\t\telse if (e?.length === 0 && quickpick.ignoreFocusOut && !originalIgnoreFocusOut) {\n\t\t\t\t\t\t\tquickpick.ignoreFocusOut = originalIgnoreFocusOut;\n\t\t\t\t\t\t\tstep.ignoreFocusOut = originalStepIgnoreFocusOut;\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tquickpick.onDidAccept(async () => {\n\t\t\t\t\t\tlet items = quickpick.selectedItems;\n\t\t\t\t\t\tif (items.length === 0) {\n\t\t\t\t\t\t\tif (!quickpick.canSelectMany || quickpick.activeItems.length === 0) {\n\t\t\t\t\t\t\t\tconst value = quickpick.value.trim();\n\t\t\t\t\t\t\t\tif (value.length === 0 && !step.allowEmpty) return;\n\n\t\t\t\t\t\t\t\tif (step.onDidAccept == null) {\n\t\t\t\t\t\t\t\t\tif (step.allowEmpty) {\n\t\t\t\t\t\t\t\t\t\tresolve(await this.nextStep(commandsStep.command!, [], quickpick));\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tquickpick.busy = true;\n\n\t\t\t\t\t\t\t\tif (await step.onDidAccept(quickpick)) {\n\t\t\t\t\t\t\t\t\tresolve(await this.nextStep(commandsStep.command!, value, quickpick));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tquickpick.busy = false;\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\titems = quickpick.activeItems;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (items.length === 1) {\n\t\t\t\t\t\t\tconst [item] = items;\n\t\t\t\t\t\t\tif (DirectiveQuickPickItem.is(item)) {\n\t\t\t\t\t\t\t\tswitch (item.directive) {\n\t\t\t\t\t\t\t\t\tcase Directive.Cancel:\n\t\t\t\t\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\t\tcase Directive.Back:\n\t\t\t\t\t\t\t\t\t\tvoid goBack();\n\t\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\t\tcase Directive.LoadMore:\n\t\t\t\t\t\t\t\t\t\tvoid loadMore();\n\t\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\t\tcase Directive.StartPreviewTrial:\n\t\t\t\t\t\t\t\t\t\tvoid Container.instance.subscription.startPreviewTrial();\n\t\t\t\t\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\t\tcase Directive.RequiresVerification:\n\t\t\t\t\t\t\t\t\t\tvoid Container.instance.subscription.resendVerification();\n\t\t\t\t\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\t\tcase Directive.RequiresFreeSubscription:\n\t\t\t\t\t\t\t\t\t\tvoid Container.instance.subscription.loginOrSignUp();\n\t\t\t\t\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\t\tcase Directive.RequiresPaidSubscription:\n\t\t\t\t\t\t\t\t\t\tvoid Container.instance.subscription.purchase();\n\t\t\t\t\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (commandsStep.command == null) {\n\t\t\t\t\t\t\tconst [command] = items;\n\t\t\t\t\t\t\tif (!QuickCommand.is(command)) return;\n\n\t\t\t\t\t\t\tcommandsStep.setCommand(command, this.startedWith);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!quickpick.canSelectMany) {\n\t\t\t\t\t\t\tif (step.onDidAccept != null) {\n\t\t\t\t\t\t\t\tquickpick.busy = true;\n\n\t\t\t\t\t\t\t\tconst next = await step.onDidAccept(quickpick);\n\n\t\t\t\t\t\t\t\tquickpick.busy = false;\n\n\t\t\t\t\t\t\t\tif (!next) return;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve(await this.nextStep(commandsStep.command!, items as QuickPickItem[], quickpick));\n\t\t\t\t\t}),\n\t\t\t\t);\n\n\t\t\t\tquickpick.title = step.title;\n\t\t\t\tquickpick.placeholder = step.placeholder;\n\t\t\t\tquickpick.matchOnDescription = Boolean(step.matchOnDescription);\n\t\t\t\tquickpick.matchOnDetail = Boolean(step.matchOnDetail);\n\t\t\t\tquickpick.canSelectMany = Boolean(step.multiselect);\n\n\t\t\t\tquickpick.items = step.items;\n\n\t\t\t\tif (quickpick.canSelectMany) {\n\t\t\t\t\tquickpick.selectedItems = step.selectedItems ?? quickpick.items.filter(i => i.picked);\n\t\t\t\t\tquickpick.activeItems = quickpick.selectedItems;\n\t\t\t\t} else {\n\t\t\t\t\tquickpick.activeItems = step.selectedItems ?? quickpick.items.filter(i => i.picked);\n\t\t\t\t}\n\n\t\t\t\t// If we are starting over clear the previously active command\n\t\t\t\tif (commandsStep.command != null && step === commandsStep) {\n\t\t\t\t\tcommandsStep.setCommand(undefined, 'menu');\n\t\t\t\t}\n\n\t\t\t\t// Needs to be after we reset the command\n\t\t\t\tquickpick.buttons = this.getButtons(step, commandsStep.command);\n\n\t\t\t\tif (step.value != null) {\n\t\t\t\t\tquickpick.value = step.value;\n\t\t\t\t}\n\n\t\t\t\tquickpick.show();\n\n\t\t\t\t// Manually trigger `onDidChangeValue`, because the QuickPick seems to fail to call it properly\n\t\t\t\tif (step.value != null) {\n\t\t\t\t\t// HACK: This is fragile!\n\t\t\t\t\t(quickpick as any)._onDidChangeValueEmitter.fire(quickpick.value);\n\t\t\t\t}\n\t\t\t});\n\t\t} finally {\n\t\t\tquickpick.dispose();\n\t\t\tdisposables.forEach(d => d.dispose());\n\t\t}\n\t}\n}\n","import { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { Command, CommandContext, isCommandContextViewNodeHasContributor } from './base';\n\nexport interface InviteToLiveShareCommandArgs {\n\temail?: string;\n}\n\n@command()\nexport class InviteToLiveShareCommand extends Command {\n\tstatic getMarkdownCommandArgs(args: InviteToLiveShareCommandArgs): string;\n\tstatic getMarkdownCommandArgs(email: string | undefined): string;\n\tstatic getMarkdownCommandArgs(argsOrEmail: InviteToLiveShareCommandArgs | string | undefined): string {\n\t\tconst args =\n\t\t\targsOrEmail === undefined || typeof argsOrEmail === 'string' ? { email: argsOrEmail } : argsOrEmail;\n\t\treturn super.getMarkdownCommandArgsCore<InviteToLiveShareCommandArgs>(Commands.InviteToLiveShare, args);\n\t}\n\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.InviteToLiveShare);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: InviteToLiveShareCommandArgs) {\n\t\tif (isCommandContextViewNodeHasContributor(context)) {\n\t\t\targs = { ...args };\n\t\t\targs.email = context.node.contributor.email;\n\t\t\treturn this.execute(args);\n\t\t}\n\n\t\treturn this.execute(args);\n\t}\n\n\tasync execute(args?: InviteToLiveShareCommandArgs) {\n\t\tif (args?.email) {\n\t\t\tconst contact = await this.container.vsls.getContact(args.email);\n\t\t\tif (contact != null) {\n\t\t\t\treturn contact.invite();\n\t\t\t}\n\t\t}\n\n\t\treturn this.container.vsls.startSession();\n\t}\n}\n","import { configuration, OutputLevel } from '../configuration';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { Command } from './base';\n\n@command()\nexport class EnableDebugLoggingCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.EnableDebugLogging);\n\t}\n\n\tasync execute() {\n\t\tawait configuration.updateEffective('outputLevel', OutputLevel.Debug);\n\t}\n}\n\n@command()\nexport class DisableDebugLoggingCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.DisableDebugLogging);\n\t}\n\n\tasync execute() {\n\t\tawait configuration.updateEffective('outputLevel', OutputLevel.Errors);\n\t}\n}\n","import { TextEditor, Uri } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { Logger } from '../logger';\nimport { command, executeCommand } from '../system/command';\nimport { ActiveEditorCommand, getCommandUri } from './base';\nimport { OpenPullRequestOnRemoteCommandArgs } from './openPullRequestOnRemote';\n\n@command()\nexport class OpenAssociatedPullRequestOnRemoteCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.OpenAssociatedPullRequestOnRemote);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri) {\n\t\tif (editor == null) return;\n\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\tconst gitUri = await GitUri.fromUri(uri);\n\n\t\tconst blameline = editor.selection.active.line;\n\t\tif (blameline < 0) return;\n\n\t\ttry {\n\t\t\tconst blame = await this.container.git.getBlameForLine(gitUri, blameline);\n\t\t\tif (blame == null) return;\n\n\t\t\tawait executeCommand<OpenPullRequestOnRemoteCommandArgs>(Commands.OpenPullRequestOnRemote, {\n\t\t\t\tclipboard: false,\n\t\t\t\tref: blame.commit.sha,\n\t\t\t\trepoPath: blame.commit.repoPath,\n\t\t\t});\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenAssociatedPullRequestOnRemoteCommand', `getBlameForLine(${blameline})`);\n\t\t}\n\t}\n}\n","import { TextEditor, Uri, window } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { RemoteResourceType } from '../git/remotes/provider';\nimport { Logger } from '../logger';\nimport { RepositoryPicker } from '../quickpicks/repositoryPicker';\nimport { command, executeCommand } from '../system/command';\nimport { ActiveEditorCommand, CommandContext, getCommandUri, isCommandContextViewNodeHasRemote } from './base';\nimport { OpenOnRemoteCommandArgs } from './openOnRemote';\n\nexport interface OpenBranchesOnRemoteCommandArgs {\n\tclipboard?: boolean;\n\tremote?: string;\n}\n\n@command()\nexport class OpenBranchesOnRemoteCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([\n\t\t\tCommands.OpenBranchesOnRemote,\n\t\t\tCommands.Deprecated_OpenBranchesInRemote,\n\t\t\tCommands.CopyRemoteBranchesUrl,\n\t\t]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: OpenBranchesOnRemoteCommandArgs) {\n\t\tif (isCommandContextViewNodeHasRemote(context)) {\n\t\t\targs = { ...args, remote: context.node.remote.name };\n\t\t}\n\n\t\tif (context.command === Commands.CopyRemoteBranchesUrl) {\n\t\t\targs = { ...args, clipboard: true };\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: OpenBranchesOnRemoteCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\n\t\tconst gitUri = uri != null ? await GitUri.fromUri(uri) : undefined;\n\n\t\tconst repoPath = (\n\t\t\tawait RepositoryPicker.getBestRepositoryOrShow(\n\t\t\t\tgitUri,\n\t\t\t\teditor,\n\t\t\t\targs?.clipboard ? 'Copy Remote Branches Url' : 'Open Branches on Remote',\n\t\t\t)\n\t\t)?.path;\n\t\tif (!repoPath) return;\n\n\t\ttry {\n\t\t\tvoid (await executeCommand<OpenOnRemoteCommandArgs>(Commands.OpenOnRemote, {\n\t\t\t\tresource: {\n\t\t\t\t\ttype: RemoteResourceType.Branches,\n\t\t\t\t},\n\t\t\t\trepoPath: repoPath,\n\t\t\t\tremote: args?.remote,\n\t\t\t\tclipboard: args?.clipboard,\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenBranchesOnRemoteCommand');\n\t\t\tvoid window.showErrorMessage(\n\t\t\t\t'Unable to open branches on remote provider. See output channel for more details',\n\t\t\t);\n\t\t}\n\t}\n}\n","import { TextEditor, Uri, window } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { RemoteResourceType } from '../git/remotes/provider';\nimport { Logger } from '../logger';\nimport { CommandQuickPickItem } from '../quickpicks/items/common';\nimport { ReferencePicker, ReferencesQuickPickIncludes } from '../quickpicks/referencePicker';\nimport { RepositoryPicker } from '../quickpicks/repositoryPicker';\nimport { command, executeCommand } from '../system/command';\nimport { ActiveEditorCommand, CommandContext, getCommandUri, isCommandContextViewNodeHasBranch } from './base';\nimport { OpenOnRemoteCommandArgs } from './openOnRemote';\n\nexport interface OpenBranchOnRemoteCommandArgs {\n\tbranch?: string;\n\tclipboard?: boolean;\n\tremote?: string;\n}\n\n@command()\nexport class OpenBranchOnRemoteCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.OpenBranchOnRemote, Commands.Deprecated_OpenBranchInRemote, Commands.CopyRemoteBranchUrl]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: OpenBranchOnRemoteCommandArgs) {\n\t\tif (isCommandContextViewNodeHasBranch(context)) {\n\t\t\targs = {\n\t\t\t\t...args,\n\t\t\t\tbranch: context.node.branch.name,\n\t\t\t\tremote: context.node.branch.getRemoteName(),\n\t\t\t};\n\t\t}\n\n\t\tif (context.command === Commands.CopyRemoteBranchUrl) {\n\t\t\targs = { ...args, clipboard: true };\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: OpenBranchOnRemoteCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\n\t\tconst gitUri = uri != null ? await GitUri.fromUri(uri) : undefined;\n\n\t\tconst repoPath = (\n\t\t\tawait RepositoryPicker.getBestRepositoryOrShow(\n\t\t\t\tgitUri,\n\t\t\t\teditor,\n\t\t\t\targs?.clipboard ? 'Copy Remote Branch Url' : 'Open Branch On Remote',\n\t\t\t)\n\t\t)?.path;\n\t\tif (!repoPath) return;\n\n\t\targs = { ...args };\n\n\t\ttry {\n\t\t\tif (args.branch == null) {\n\t\t\t\tconst pick = await ReferencePicker.show(\n\t\t\t\t\trepoPath,\n\t\t\t\t\targs.clipboard ? 'Copy Remote Branch Url' : 'Open Branch On Remote',\n\t\t\t\t\targs.clipboard ? 'Choose a branch to copy the url from' : 'Choose a branch to open',\n\t\t\t\t\t{\n\t\t\t\t\t\tautoPick: true,\n\t\t\t\t\t\t// checkmarks: false,\n\t\t\t\t\t\tfilter: { branches: b => b.upstream != null },\n\t\t\t\t\t\tinclude: ReferencesQuickPickIncludes.Branches,\n\t\t\t\t\t\tsort: { branches: { current: true }, tags: {} },\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tif (pick == null || pick instanceof CommandQuickPickItem) return;\n\n\t\t\t\targs.branch = pick.ref;\n\t\t\t}\n\n\t\t\tvoid (await executeCommand<OpenOnRemoteCommandArgs>(Commands.OpenOnRemote, {\n\t\t\t\tresource: {\n\t\t\t\t\ttype: RemoteResourceType.Branch,\n\t\t\t\t\tbranch: args.branch || 'HEAD',\n\t\t\t\t},\n\t\t\t\trepoPath: repoPath,\n\t\t\t\tremote: args.remote,\n\t\t\t\tclipboard: args.clipboard,\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenBranchOnRemoteCommand');\n\t\t\tvoid window.showErrorMessage(\n\t\t\t\t'Unable to open branch on remote provider. See output channel for more details',\n\t\t\t);\n\t\t}\n\t}\n}\n","import { Uri, window } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { RepositoryPicker } from '../quickpicks/repositoryPicker';\nimport { filterMap } from '../system/array';\nimport { command } from '../system/command';\nimport { findOrOpenEditors } from '../system/utils';\nimport { Command } from './base';\n\nexport interface OpenChangedFilesCommandArgs {\n\turis?: Uri[];\n}\n\n@command()\nexport class OpenChangedFilesCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.OpenChangedFiles);\n\t}\n\n\tasync execute(args?: OpenChangedFilesCommandArgs) {\n\t\targs = { ...args };\n\n\t\ttry {\n\t\t\tif (args.uris == null) {\n\t\t\t\tconst repository = await RepositoryPicker.getRepositoryOrShow('Open All Changed Files');\n\t\t\t\tif (repository == null) return;\n\n\t\t\t\tconst status = await this.container.git.getStatusForRepo(repository.uri);\n\t\t\t\tif (status == null) {\n\t\t\t\t\tvoid window.showWarningMessage('Unable to open changed files');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\targs.uris = filterMap(status.files, f => (f.status !== 'D' ? f.uri : undefined));\n\t\t\t}\n\n\t\t\tfindOrOpenEditors(args.uris);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenChangedFilesCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open all changed files');\n\t\t}\n\t}\n}\n","import { TextEditor, Uri, window } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitRevision } from '../git/models';\nimport { RemoteResourceType } from '../git/remotes/provider';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command, executeCommand } from '../system/command';\nimport {\n\tActiveEditorCommand,\n\tCommandContext,\n\tgetCommandUri,\n\tisCommandContextGitTimelineItem,\n\tisCommandContextViewNodeHasCommit,\n} from './base';\nimport { OpenOnRemoteCommandArgs } from './openOnRemote';\n\nexport interface OpenCommitOnRemoteCommandArgs {\n\tclipboard?: boolean;\n\tsha?: string;\n}\n\n@command()\nexport class OpenCommitOnRemoteCommand extends ActiveEditorCommand {\n\tstatic getMarkdownCommandArgs(sha: string): string;\n\tstatic getMarkdownCommandArgs(args: OpenCommitOnRemoteCommandArgs): string;\n\tstatic getMarkdownCommandArgs(argsOrSha: OpenCommitOnRemoteCommandArgs | string): string {\n\t\tconst args: OpenCommitOnRemoteCommandArgs = typeof argsOrSha === 'string' ? { sha: argsOrSha } : argsOrSha;\n\t\treturn super.getMarkdownCommandArgsCore<OpenCommitOnRemoteCommandArgs>(Commands.OpenCommitOnRemote, args);\n\t}\n\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.OpenCommitOnRemote, Commands.Deprecated_OpenCommitInRemote, Commands.CopyRemoteCommitUrl]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: OpenCommitOnRemoteCommandArgs) {\n\t\tlet uri = context.uri;\n\n\t\tif (isCommandContextViewNodeHasCommit(context)) {\n\t\t\tif (context.node.commit.isUncommitted) return Promise.resolve(undefined);\n\n\t\t\targs = { ...args, sha: context.node.commit.sha };\n\t\t\turi = context.node.uri;\n\t\t}\n\n\t\tif (isCommandContextGitTimelineItem(context)) {\n\t\t\targs = { sha: context.item.ref };\n\t\t\turi = context.uri;\n\t\t}\n\n\t\tif (context.command === Commands.CopyRemoteCommitUrl) {\n\t\t\targs = { ...args, clipboard: true };\n\t\t}\n\n\t\treturn this.execute(context.editor, uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: OpenCommitOnRemoteCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\tconst gitUri = await GitUri.fromUri(uri);\n\t\tif (!gitUri.repoPath) return;\n\n\t\targs = { ...args };\n\n\t\ttry {\n\t\t\tif (args.sha == null) {\n\t\t\t\tconst blameline = editor == null ? 0 : editor.selection.active.line;\n\t\t\t\tif (blameline < 0) return;\n\n\t\t\t\tconst blame = await this.container.git.getBlameForLine(gitUri, blameline, editor?.document);\n\t\t\t\tif (blame == null) {\n\t\t\t\t\tvoid Messages.showFileNotUnderSourceControlWarningMessage(\n\t\t\t\t\t\t'Unable to open commit on remote provider',\n\t\t\t\t\t);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// If the line is uncommitted, use previous commit\n\t\t\t\targs.sha = blame.commit.isUncommitted\n\t\t\t\t\t? (await blame.commit.getPreviousSha()) ?? GitRevision.deletedOrMissing\n\t\t\t\t\t: blame.commit.sha;\n\t\t\t}\n\n\t\t\tvoid (await executeCommand<OpenOnRemoteCommandArgs>(Commands.OpenOnRemote, {\n\t\t\t\tresource: {\n\t\t\t\t\ttype: RemoteResourceType.Commit,\n\t\t\t\t\tsha: args.sha,\n\t\t\t\t},\n\t\t\t\trepoPath: gitUri.repoPath,\n\t\t\t\tclipboard: args.clipboard,\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenCommitOnRemoteCommand');\n\t\t\tvoid window.showErrorMessage(\n\t\t\t\t'Unable to open commit on remote provider. See output channel for more details',\n\t\t\t);\n\t\t}\n\t}\n}\n","import { window } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { RemoteResourceType } from '../git/remotes/provider';\nimport { Logger } from '../logger';\nimport { command, executeCommand } from '../system/command';\nimport { ResultsCommitsNode } from '../views/nodes';\nimport { Command, CommandContext } from './base';\nimport { OpenOnRemoteCommandArgs } from './openOnRemote';\n\nexport interface OpenComparisonOnRemoteCommandArgs {\n\tclipboard?: boolean;\n\tref1?: string;\n\tref2?: string;\n\tnotation?: '..' | '...';\n\trepoPath?: string;\n}\n\n@command()\nexport class OpenComparisonOnRemoteCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.OpenComparisonOnRemote, Commands.CopyRemoteComparisonUrl]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: OpenComparisonOnRemoteCommandArgs) {\n\t\tif (context.type === 'viewItem') {\n\t\t\tif (context.node instanceof ResultsCommitsNode) {\n\t\t\t\targs = {\n\t\t\t\t\t...args,\n\t\t\t\t\trepoPath: context.node.repoPath,\n\t\t\t\t\tref1: context.node.ref1,\n\t\t\t\t\tref2: context.node.ref2,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (context.command === Commands.CopyRemoteBranchesUrl) {\n\t\t\targs = { ...args, clipboard: true };\n\t\t}\n\n\t\treturn this.execute(args);\n\t}\n\n\tasync execute(args?: OpenComparisonOnRemoteCommandArgs) {\n\t\tif (args?.repoPath == null || args.ref1 == null || args.ref2 == null) return;\n\n\t\ttry {\n\t\t\tvoid (await executeCommand<OpenOnRemoteCommandArgs>(Commands.OpenOnRemote, {\n\t\t\t\tresource: {\n\t\t\t\t\ttype: RemoteResourceType.Comparison,\n\t\t\t\t\tbase: args.ref1,\n\t\t\t\t\tcompare: args.ref2,\n\t\t\t\t\tnotation: args.notation,\n\t\t\t\t},\n\t\t\t\trepoPath: args.repoPath,\n\t\t\t\tclipboard: args?.clipboard,\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenComparisonOnRemoteCommand');\n\t\t\tvoid window.showErrorMessage(\n\t\t\t\t'Unable to open comparison on remote provider. See output channel for more details',\n\t\t\t);\n\t\t}\n\t}\n}\n","import { env, Range, Uri, window } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { openEditor } from '../system/utils';\nimport { Command } from './base';\n\n@command()\nexport class OpenFileFromRemoteCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.OpenFileFromRemote);\n\t}\n\n\tasync execute() {\n\t\tlet clipboard: string | undefined = await env.clipboard.readText();\n\t\ttry {\n\t\t\tUri.parse(clipboard, true);\n\t\t} catch {\n\t\t\tclipboard = undefined;\n\t\t}\n\n\t\tconst url = await window.showInputBox({\n\t\t\tprompt: 'Enter a remote file url to open',\n\t\t\tplaceHolder: 'Remote file url',\n\t\t\tvalue: clipboard,\n\t\t\tignoreFocusOut: true,\n\t\t});\n\t\tif (url == null || url.length === 0) return;\n\n\t\tlet local = await this.container.git.getLocalInfoFromRemoteUri(Uri.parse(url));\n\t\tif (local == null) {\n\t\t\tlocal = await this.container.git.getLocalInfoFromRemoteUri(Uri.parse(url), { validate: false });\n\t\t\tif (local == null) {\n\t\t\t\tvoid window.showWarningMessage('Unable to parse the provided remote url.');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst confirm = 'Open File...';\n\t\t\tconst pick = await window.showWarningMessage(\n\t\t\t\t'Unable to find a workspace folder that matches the provided remote url.',\n\t\t\t\tconfirm,\n\t\t\t);\n\t\t\tif (pick !== confirm) return;\n\t\t}\n\n\t\tlet selection;\n\t\tif (local.startLine) {\n\t\t\tif (local.endLine) {\n\t\t\t\tselection = new Range(local.startLine - 1, 0, local.endLine, 0);\n\t\t\t} else {\n\t\t\t\tselection = new Range(local.startLine - 1, 0, local.startLine - 1, 0);\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tawait openEditor(local.uri, { selection: selection, rethrow: true });\n\t\t} catch {\n\t\t\tconst uris = await window.showOpenDialog({\n\t\t\t\ttitle: 'Open local file',\n\t\t\t\tdefaultUri: local.uri,\n\t\t\t\tcanSelectMany: false,\n\t\t\t\tcanSelectFolders: false,\n\t\t\t});\n\t\t\tif (uris == null || uris.length === 0) return;\n\n\t\t\tawait openEditor(uris[0]);\n\t\t}\n\t}\n}\n","import { Range, TextEditor, Uri, window } from 'vscode';\nimport { UriComparer } from '../comparers';\nimport { BranchSorting, TagSorting } from '../configuration';\nimport { Commands, GlyphChars } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitBranch, GitRevision } from '../git/models';\nimport { RemoteResourceType } from '../git/remotes/provider';\nimport { Logger } from '../logger';\nimport { ReferencePicker } from '../quickpicks/referencePicker';\nimport { command, executeCommand } from '../system/command';\nimport { pad, splitSingle } from '../system/string';\nimport { StatusFileNode } from '../views/nodes';\nimport {\n\tActiveEditorCommand,\n\tCommandContext,\n\tgetCommandUri,\n\tisCommandContextViewNodeHasBranch,\n\tisCommandContextViewNodeHasCommit,\n} from './base';\nimport { OpenOnRemoteCommandArgs } from './openOnRemote';\n\nexport interface OpenFileOnRemoteCommandArgs {\n\tbranchOrTag?: string;\n\tclipboard?: boolean;\n\trange?: boolean;\n\tsha?: string;\n\tpickBranchOrTag?: boolean;\n}\n\n@command()\nexport class OpenFileOnRemoteCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([\n\t\t\tCommands.OpenFileOnRemote,\n\t\t\tCommands.Deprecated_OpenFileInRemote,\n\t\t\tCommands.CopyRemoteFileUrl,\n\t\t\tCommands.CopyRemoteFileUrlWithoutRange,\n\t\t\tCommands.OpenFileOnRemoteFrom,\n\t\t\tCommands.CopyRemoteFileUrlFrom,\n\t\t]);\n\t}\n\n\tprotected override async preExecute(context: CommandContext, args?: OpenFileOnRemoteCommandArgs) {\n\t\tlet uri = context.uri;\n\n\t\tif (context.command === Commands.CopyRemoteFileUrlWithoutRange) {\n\t\t\targs = { ...args, range: false };\n\t\t}\n\n\t\tif (isCommandContextViewNodeHasCommit(context)) {\n\t\t\targs = { ...args, range: false };\n\n\t\t\tif (\n\t\t\t\tcontext.command === Commands.CopyRemoteFileUrl ||\n\t\t\t\tcontext.command === Commands.CopyRemoteFileUrlWithoutRange ||\n\t\t\t\tcontext.command === Commands.CopyRemoteFileUrlFrom\n\t\t\t) {\n\t\t\t\t// If it is a StatusFileNode then don't include the sha, since it hasn't been pushed yet\n\t\t\t\targs.sha = context.node instanceof StatusFileNode ? undefined : context.node.commit.sha;\n\t\t\t} else if (isCommandContextViewNodeHasBranch(context)) {\n\t\t\t\targs.branchOrTag = context.node.branch?.name;\n\t\t\t}\n\n\t\t\turi = context.node.uri;\n\t\t} else if (context.type === 'viewItem') {\n\t\t\targs = { ...args, range: false };\n\n\t\t\turi = context.node.uri ?? context.uri;\n\t\t}\n\n\t\tif (\n\t\t\tcontext.command === Commands.CopyRemoteFileUrl ||\n\t\t\tcontext.command === Commands.CopyRemoteFileUrlWithoutRange ||\n\t\t\tcontext.command === Commands.CopyRemoteFileUrlFrom\n\t\t) {\n\t\t\targs = { ...args, clipboard: true };\n\t\t\tif (args.sha == null) {\n\t\t\t\tconst uri = getCommandUri(context.uri, context.editor);\n\t\t\t\tif (uri != null) {\n\t\t\t\t\tconst gitUri = await GitUri.fromUri(uri);\n\t\t\t\t\tif (gitUri.repoPath) {\n\t\t\t\t\t\tif (gitUri.sha == null) {\n\t\t\t\t\t\t\tconst commit = await this.container.git.getCommitForFile(gitUri.repoPath, gitUri, {\n\t\t\t\t\t\t\t\tfirstIfNotFound: true,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (commit != null) {\n\t\t\t\t\t\t\t\targs.sha = commit.sha;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\targs.sha = gitUri.sha;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (context.command === Commands.OpenFileOnRemoteFrom || context.command === Commands.CopyRemoteFileUrlFrom) {\n\t\t\targs = { ...args, pickBranchOrTag: true, range: false };\n\t\t}\n\n\t\treturn this.execute(context.editor, uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: OpenFileOnRemoteCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\tconst gitUri = await GitUri.fromUri(uri);\n\t\tif (!gitUri.repoPath) return;\n\n\t\targs = { range: true, ...args };\n\n\t\ttry {\n\t\t\tlet remotes = await this.container.git.getRemotesWithProviders(gitUri.repoPath);\n\t\t\tconst range =\n\t\t\t\targs.range && editor != null && UriComparer.equals(editor.document.uri, uri)\n\t\t\t\t\t? new Range(\n\t\t\t\t\t\t\teditor.selection.start.with({ line: editor.selection.start.line + 1 }),\n\t\t\t\t\t\t\teditor.selection.end.with({\n\t\t\t\t\t\t\t\tline: editor.selection.end.line + (editor.selection.end.character === 0 ? 0 : 1),\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t  )\n\t\t\t\t\t: undefined;\n\t\t\tlet sha = args.sha ?? gitUri.sha;\n\n\t\t\tif (args.branchOrTag == null && sha != null && !GitRevision.isSha(sha) && remotes.length !== 0) {\n\t\t\t\tconst [remoteName, branchName] = splitSingle(sha, '/');\n\t\t\t\tif (branchName != null) {\n\t\t\t\t\tconst remote = remotes.find(r => r.name === remoteName);\n\t\t\t\t\tif (remote != null) {\n\t\t\t\t\t\targs.branchOrTag = branchName;\n\t\t\t\t\t\tsha = undefined;\n\n\t\t\t\t\t\tremotes = [remote];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ((args.sha == null && args.branchOrTag == null) || args.pickBranchOrTag) {\n\t\t\t\tlet branch;\n\t\t\t\tif (!args.pickBranchOrTag) {\n\t\t\t\t\tbranch = await this.container.git.getBranch(gitUri.repoPath);\n\t\t\t\t}\n\n\t\t\t\tif (branch?.upstream == null) {\n\t\t\t\t\tconst pick = await ReferencePicker.show(\n\t\t\t\t\t\tgitUri.repoPath,\n\t\t\t\t\t\targs.clipboard\n\t\t\t\t\t\t\t? `Copy Remote File Url From${pad(GlyphChars.Dot, 2, 2)}${gitUri.relativePath}`\n\t\t\t\t\t\t\t: `Open File on Remote From${pad(GlyphChars.Dot, 2, 2)}${gitUri.relativePath}`,\n\t\t\t\t\t\t`Choose a branch or tag to ${args.clipboard ? 'copy' : 'open'} the file revision from`,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tallowEnteringRefs: true,\n\t\t\t\t\t\t\tautoPick: true,\n\t\t\t\t\t\t\t// checkmarks: false,\n\t\t\t\t\t\t\tfilter: { branches: b => b.remote || b.upstream != null },\n\t\t\t\t\t\t\tpicked: args.branchOrTag,\n\t\t\t\t\t\t\tsort: {\n\t\t\t\t\t\t\t\tbranches: { current: true, orderBy: BranchSorting.DateDesc },\n\t\t\t\t\t\t\t\ttags: { orderBy: TagSorting.DateDesc },\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tif (pick == null) return;\n\n\t\t\t\t\tif (pick.refType === 'branch') {\n\t\t\t\t\t\tif (pick.remote) {\n\t\t\t\t\t\t\targs.branchOrTag = GitBranch.getNameWithoutRemote(pick.name);\n\n\t\t\t\t\t\t\tconst remoteName = GitBranch.getRemote(pick.name);\n\t\t\t\t\t\t\tconst remote = remotes.find(r => r.name === remoteName);\n\t\t\t\t\t\t\tif (remote != null) {\n\t\t\t\t\t\t\t\tremotes = [remote];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\targs.branchOrTag = pick.name;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsha = undefined;\n\t\t\t\t\t} else if (pick.refType === 'tag') {\n\t\t\t\t\t\targs.branchOrTag = pick.ref;\n\t\t\t\t\t\tsha = undefined;\n\t\t\t\t\t} else {\n\t\t\t\t\t\targs.branchOrTag = undefined;\n\t\t\t\t\t\tsha = pick.ref;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\targs.branchOrTag = branch.name;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvoid (await executeCommand<OpenOnRemoteCommandArgs>(Commands.OpenOnRemote, {\n\t\t\t\tresource: {\n\t\t\t\t\ttype: sha == null ? RemoteResourceType.File : RemoteResourceType.Revision,\n\t\t\t\t\tbranchOrTag: args.branchOrTag ?? 'HEAD',\n\t\t\t\t\tfileName: gitUri.relativePath,\n\t\t\t\t\trange: range,\n\t\t\t\t\tsha: sha ?? undefined,\n\t\t\t\t},\n\t\t\t\trepoPath: gitUri.repoPath,\n\t\t\t\tremotes: remotes,\n\t\t\t\tclipboard: args.clipboard,\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenFileOnRemoteCommand');\n\t\t\tvoid window.showErrorMessage('Unable to open file on remote provider. See output channel for more details');\n\t\t}\n\t}\n}\n","import { TextDocumentShowOptions, TextEditor, Uri } from 'vscode';\nimport { FileAnnotationType } from '../configuration';\nimport { Commands, GlyphChars, quickPickTitleMaxChars } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitRevision } from '../git/models';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { CommitPicker } from '../quickpicks/commitPicker';\nimport { CommandQuickPickItem } from '../quickpicks/items/common';\nimport { command } from '../system/command';\nimport { pad } from '../system/string';\nimport { ActiveEditorCommand, CommandContext, getCommandUri } from './base';\nimport { GitActions } from './gitCommands.actions';\nimport { OpenFileAtRevisionFromCommandArgs } from './openFileAtRevisionFrom';\n\nexport interface OpenFileAtRevisionCommandArgs {\n\trevisionUri?: Uri;\n\n\tline?: number;\n\tshowOptions?: TextDocumentShowOptions;\n\tannotationType?: FileAnnotationType;\n}\n\n@command()\nexport class OpenFileAtRevisionCommand extends ActiveEditorCommand {\n\tstatic getMarkdownCommandArgs(args: OpenFileAtRevisionCommandArgs): string;\n\tstatic getMarkdownCommandArgs(revisionUri: Uri, annotationType?: FileAnnotationType, line?: number): string;\n\tstatic getMarkdownCommandArgs(\n\t\targsOrUri: OpenFileAtRevisionCommandArgs | Uri,\n\t\tannotationType?: FileAnnotationType,\n\t\tline?: number,\n\t): string {\n\t\tlet args: OpenFileAtRevisionCommandArgs | Uri;\n\t\tif (argsOrUri instanceof Uri) {\n\t\t\tconst revisionUri = argsOrUri;\n\n\t\t\targs = {\n\t\t\t\trevisionUri: revisionUri,\n\t\t\t\tline: line,\n\t\t\t\tannotationType: annotationType,\n\t\t\t};\n\t\t} else {\n\t\t\targs = argsOrUri;\n\t\t}\n\n\t\treturn super.getMarkdownCommandArgsCore<OpenFileAtRevisionCommandArgs>(Commands.OpenFileAtRevision, args);\n\t}\n\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.OpenFileAtRevision, Commands.OpenBlamePriorToChange]);\n\t}\n\n\tprotected override async preExecute(context: CommandContext, args?: OpenFileAtRevisionCommandArgs) {\n\t\tif (context.command === Commands.OpenBlamePriorToChange) {\n\t\t\targs = { ...args, annotationType: FileAnnotationType.Blame };\n\t\t\tif (args.revisionUri == null && context.editor != null) {\n\t\t\t\tconst editorLine = context.editor.selection.active.line;\n\t\t\t\tif (editorLine >= 0) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst gitUri = await GitUri.fromUri(context.editor.document.uri);\n\t\t\t\t\t\tconst blame = await this.container.git.getBlameForLine(gitUri, editorLine);\n\t\t\t\t\t\tif (blame != null) {\n\t\t\t\t\t\t\tif (blame.commit.isUncommitted) {\n\t\t\t\t\t\t\t\tconst comparisonUris = await blame.commit.getPreviousComparisonUrisForLine(editorLine);\n\t\t\t\t\t\t\t\tif (comparisonUris?.previous != null) {\n\t\t\t\t\t\t\t\t\targs.revisionUri = this.container.git.getRevisionUri(comparisonUris.previous);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvoid Messages.showCommitHasNoPreviousCommitWarningMessage(blame.commit);\n\t\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst previousSha = blame != null ? await blame?.commit.getPreviousSha() : undefined;\n\t\t\t\t\t\t\t\tif (previousSha != null) {\n\t\t\t\t\t\t\t\t\targs.revisionUri = this.container.git.getRevisionUri(blame.commit.getGitUri(true));\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvoid Messages.showCommitHasNoPreviousCommitWarningMessage(blame.commit);\n\t\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\tLogger.error(ex, 'OpenBlamePriorToChangeCommand');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (args.revisionUri == null) {\n\t\t\t\tvoid Messages.showGenericErrorMessage('Unable to open blame');\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor: TextEditor | undefined, uri?: Uri, args?: OpenFileAtRevisionCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\tconst gitUri = await GitUri.fromUri(uri);\n\n\t\targs = { ...args };\n\t\tif (args.line == null) {\n\t\t\targs.line = editor?.selection.active.line ?? 0;\n\t\t}\n\n\t\ttry {\n\t\t\tif (args.revisionUri == null) {\n\t\t\t\tconst log = this.container.git.getLogForFile(gitUri.repoPath, gitUri.fsPath).then(\n\t\t\t\t\tlog =>\n\t\t\t\t\t\tlog ??\n\t\t\t\t\t\t(gitUri.sha\n\t\t\t\t\t\t\t? this.container.git.getLogForFile(gitUri.repoPath, gitUri.fsPath, {\n\t\t\t\t\t\t\t\t\tref: gitUri.sha,\n\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t: undefined),\n\t\t\t\t);\n\n\t\t\t\tconst title = `Open ${\n\t\t\t\t\targs.annotationType === FileAnnotationType.Blame ? 'Blame' : 'File'\n\t\t\t\t} at Revision${pad(GlyphChars.Dot, 2, 2)}`;\n\t\t\t\tconst pick = await CommitPicker.show(\n\t\t\t\t\tlog,\n\t\t\t\t\t`${title}${gitUri.getFormattedFileName({\n\t\t\t\t\t\tsuffix: gitUri.sha ? `:${GitRevision.shorten(gitUri.sha)}` : undefined,\n\t\t\t\t\t\ttruncateTo: quickPickTitleMaxChars - title.length,\n\t\t\t\t\t})}`,\n\t\t\t\t\t`Choose a commit to ${\n\t\t\t\t\t\targs.annotationType === FileAnnotationType.Blame ? 'blame' : 'open'\n\t\t\t\t\t} the file revision from`,\n\t\t\t\t\t{\n\t\t\t\t\t\tpicked: gitUri.sha,\n\t\t\t\t\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\t\t\t\t\tonDidPressKey: async (key, item) => {\n\t\t\t\t\t\t\tvoid (await GitActions.Commit.openFileAtRevision(item.item.file!, item.item, {\n\t\t\t\t\t\t\t\tannotationType: args!.annotationType,\n\t\t\t\t\t\t\t\tline: args!.line,\n\t\t\t\t\t\t\t\tpreserveFocus: true,\n\t\t\t\t\t\t\t\tpreview: false,\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t},\n\t\t\t\t\t\tshowOtherReferences: [\n\t\t\t\t\t\t\tCommandQuickPickItem.fromCommand(\n\t\t\t\t\t\t\t\t'Choose a Branch or Tag...',\n\t\t\t\t\t\t\t\tCommands.OpenFileAtRevisionFrom,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tCommandQuickPickItem.fromCommand<OpenFileAtRevisionFromCommandArgs>(\n\t\t\t\t\t\t\t\t'Choose a Stash...',\n\t\t\t\t\t\t\t\tCommands.OpenFileAtRevisionFrom,\n\t\t\t\t\t\t\t\t{ stash: true },\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tif (pick?.file == null) return;\n\n\t\t\t\tvoid (await GitActions.Commit.openFileAtRevision(pick.file, pick, {\n\t\t\t\t\tannotationType: args.annotationType,\n\t\t\t\t\tline: args.line,\n\t\t\t\t\t...args.showOptions,\n\t\t\t\t}));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid (await GitActions.Commit.openFileAtRevision(args.revisionUri, {\n\t\t\t\tannotationType: args.annotationType,\n\t\t\t\tline: args.line,\n\t\t\t\t...args.showOptions,\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenFileAtRevisionCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open file at revision');\n\t\t}\n\t}\n}\n","import { TextDocumentShowOptions, TextEditor, Uri } from 'vscode';\nimport { FileAnnotationType } from '../configuration';\nimport { Commands, GlyphChars, quickPickTitleMaxChars } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitReference } from '../git/models';\nimport { Messages } from '../messages';\nimport { StashPicker } from '../quickpicks/commitPicker';\nimport { ReferencePicker } from '../quickpicks/referencePicker';\nimport { command } from '../system/command';\nimport { pad } from '../system/string';\nimport { ActiveEditorCommand, getCommandUri } from './base';\nimport { GitActions } from './gitCommands.actions';\n\nexport interface OpenFileAtRevisionFromCommandArgs {\n\treference?: GitReference;\n\n\tline?: number;\n\tshowOptions?: TextDocumentShowOptions;\n\tannotationType?: FileAnnotationType;\n\tstash?: boolean;\n}\n\n@command()\nexport class OpenFileAtRevisionFromCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.OpenFileAtRevisionFrom);\n\t}\n\n\tasync execute(editor: TextEditor | undefined, uri?: Uri, args?: OpenFileAtRevisionFromCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\tconst gitUri = await GitUri.fromUri(uri);\n\t\tif (!gitUri.repoPath) {\n\t\t\tvoid Messages.showNoRepositoryWarningMessage('Unable to open file revision');\n\t\t\treturn;\n\t\t}\n\n\t\targs = { ...args };\n\t\tif (args.line == null) {\n\t\t\targs.line = editor?.selection.active.line ?? 0;\n\t\t}\n\n\t\tif (args.reference == null) {\n\t\t\tif (args?.stash) {\n\t\t\t\tconst path = this.container.git.getRelativePath(gitUri, gitUri.repoPath);\n\n\t\t\t\tconst title = `Open Changes with Stash${pad(GlyphChars.Dot, 2, 2)}`;\n\t\t\t\tconst pick = await StashPicker.show(\n\t\t\t\t\tthis.container.git.getStash(gitUri.repoPath),\n\t\t\t\t\t`${title}${gitUri.getFormattedFileName({ truncateTo: quickPickTitleMaxChars - title.length })}`,\n\t\t\t\t\t'Choose a stash to compare with',\n\t\t\t\t\t// Stashes should always come with files, so this should be fine (but protect it just in case)\n\t\t\t\t\t{ filter: c => c.files?.some(f => f.path === path || f.originalPath === path) ?? true },\n\t\t\t\t);\n\t\t\t\tif (pick == null) return;\n\n\t\t\t\targs.reference = pick;\n\t\t\t} else {\n\t\t\t\tconst title = `Open File at Branch or Tag${pad(GlyphChars.Dot, 2, 2)}`;\n\t\t\t\tconst pick = await ReferencePicker.show(\n\t\t\t\t\tgitUri.repoPath,\n\t\t\t\t\t`${title}${gitUri.getFormattedFileName({ truncateTo: quickPickTitleMaxChars - title.length })}`,\n\t\t\t\t\t'Choose a branch or tag to open the file revision from',\n\t\t\t\t\t{\n\t\t\t\t\t\tallowEnteringRefs: true,\n\t\t\t\t\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\t\t\t\t\tonDidPressKey: async (key, quickpick) => {\n\t\t\t\t\t\t\tconst [item] = quickpick.activeItems;\n\t\t\t\t\t\t\tif (item != null) {\n\t\t\t\t\t\t\t\tvoid (await GitActions.Commit.openFileAtRevision(\n\t\t\t\t\t\t\t\t\tthis.container.git.getRevisionUri(item.ref, gitUri.fsPath, gitUri.repoPath!),\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tannotationType: args!.annotationType,\n\t\t\t\t\t\t\t\t\t\tline: args!.line,\n\t\t\t\t\t\t\t\t\t\tpreserveFocus: true,\n\t\t\t\t\t\t\t\t\t\tpreview: false,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tif (pick == null) return;\n\n\t\t\t\targs.reference = pick;\n\t\t\t}\n\t\t}\n\n\t\tvoid (await GitActions.Commit.openFileAtRevision(\n\t\t\tthis.container.git.getRevisionUri(args.reference.ref, gitUri.fsPath, gitUri.repoPath),\n\t\t\t{\n\t\t\t\tannotationType: args.annotationType,\n\t\t\t\tline: args.line,\n\t\t\t\t...args.showOptions,\n\t\t\t},\n\t\t));\n\t}\n}\n","import { Commands, GlyphChars } from '../constants';\nimport type { Container } from '../container';\nimport { GitRemote, GitRevision } from '../git/models';\nimport { RemoteProvider, RemoteResource, RemoteResourceType } from '../git/remotes/provider';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { RemoteProviderPicker } from '../quickpicks/remoteProviderPicker';\nimport { command } from '../system/command';\nimport { pad, splitSingle } from '../system/string';\nimport { Command } from './base';\n\nexport type OpenOnRemoteCommandArgs =\n\t| {\n\t\t\tresource: RemoteResource;\n\t\t\trepoPath: string;\n\n\t\t\tremote?: string;\n\t\t\tclipboard?: boolean;\n\t  }\n\t| {\n\t\t\tresource: RemoteResource;\n\t\t\tremotes: GitRemote<RemoteProvider>[];\n\n\t\t\tremote?: string;\n\t\t\tclipboard?: boolean;\n\t  };\n\n@command()\nexport class OpenOnRemoteCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.OpenOnRemote, Commands.Deprecated_OpenInRemote]);\n\t}\n\n\tasync execute(args?: OpenOnRemoteCommandArgs) {\n\t\tif (args?.resource == null) return;\n\n\t\tlet remotes =\n\t\t\t'remotes' in args ? args.remotes : await this.container.git.getRemotesWithProviders(args.repoPath);\n\n\t\tif (args.remote != null) {\n\t\t\tconst filtered = remotes.filter(r => r.name === args.remote);\n\t\t\t// Only filter if we get some results\n\t\t\tif (remotes.length > 0) {\n\t\t\t\tremotes = filtered;\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tif (args.resource.type === RemoteResourceType.Branch) {\n\t\t\t\t// Check to see if the remote is in the branch\n\t\t\t\tconst [remoteName, branchName] = splitSingle(args.resource.branch, '/');\n\t\t\t\tif (branchName != null) {\n\t\t\t\t\tconst remote = remotes.find(r => r.name === remoteName);\n\t\t\t\t\tif (remote != null) {\n\t\t\t\t\t\targs.resource.branch = branchName;\n\t\t\t\t\t\tremotes = [remote];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (args.resource.type === RemoteResourceType.Revision) {\n\t\t\t\tconst { commit, fileName } = args.resource;\n\t\t\t\tif (commit != null) {\n\t\t\t\t\tconst file = await commit.findFile(fileName);\n\t\t\t\t\tif (file?.status === 'D') {\n\t\t\t\t\t\t// Resolve to the previous commit to that file\n\t\t\t\t\t\targs.resource.sha = await this.container.git.resolveReference(\n\t\t\t\t\t\t\tcommit.repoPath,\n\t\t\t\t\t\t\t`${commit.sha}^`,\n\t\t\t\t\t\t\tfileName,\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\targs.resource.sha = commit.sha;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst providers = GitRemote.getHighlanderProviders(remotes);\n\t\t\tconst provider = providers?.length ? providers[0].name : 'Remote';\n\n\t\t\tconst options: Parameters<typeof RemoteProviderPicker.show>[4] = {\n\t\t\t\tautoPick: 'default',\n\t\t\t\tclipboard: args.clipboard,\n\t\t\t\tsetDefault: true,\n\t\t\t};\n\t\t\tlet title;\n\t\t\tlet placeHolder = `Choose which remote to ${args.clipboard ? 'copy the url for' : 'open on'}`;\n\n\t\t\tswitch (args.resource.type) {\n\t\t\t\tcase RemoteResourceType.Branch:\n\t\t\t\t\ttitle = `${args.clipboard ? `Copy ${provider} Branch Url` : `Open Branch on ${provider}`}${pad(\n\t\t\t\t\t\tGlyphChars.Dot,\n\t\t\t\t\t\t2,\n\t\t\t\t\t\t2,\n\t\t\t\t\t)}${args.resource.branch}`;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RemoteResourceType.Branches:\n\t\t\t\t\ttitle = `${args.clipboard ? `Copy ${provider} Branches Url` : `Open Branches on ${provider}`}`;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RemoteResourceType.Commit:\n\t\t\t\t\ttitle = `${args.clipboard ? `Copy ${provider} Commit Url` : `Open Commit on ${provider}`}${pad(\n\t\t\t\t\t\tGlyphChars.Dot,\n\t\t\t\t\t\t2,\n\t\t\t\t\t\t2,\n\t\t\t\t\t)}${GitRevision.shorten(args.resource.sha)}`;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RemoteResourceType.Comparison:\n\t\t\t\t\ttitle = `${\n\t\t\t\t\t\targs.clipboard ? `Copy ${provider} Comparison Url` : `Open Comparison on ${provider}`\n\t\t\t\t\t}${pad(GlyphChars.Dot, 2, 2)}${GitRevision.createRange(\n\t\t\t\t\t\targs.resource.base,\n\t\t\t\t\t\targs.resource.compare,\n\t\t\t\t\t\targs.resource.notation ?? '...',\n\t\t\t\t\t)}`;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RemoteResourceType.CreatePullRequest:\n\t\t\t\t\toptions.autoPick = true;\n\t\t\t\t\toptions.setDefault = false;\n\n\t\t\t\t\ttitle = `${\n\t\t\t\t\t\targs.clipboard\n\t\t\t\t\t\t\t? `Copy ${provider} Create Pull Request Url`\n\t\t\t\t\t\t\t: `Create Pull Request on ${provider}`\n\t\t\t\t\t}${pad(GlyphChars.Dot, 2, 2)}${\n\t\t\t\t\t\targs.resource.base?.branch\n\t\t\t\t\t\t\t? GitRevision.createRange(args.resource.base.branch, args.resource.compare.branch, '...')\n\t\t\t\t\t\t\t: args.resource.compare.branch\n\t\t\t\t\t}`;\n\n\t\t\t\t\tplaceHolder = `Choose which remote to ${\n\t\t\t\t\t\targs.clipboard ? 'copy the create pull request url for' : 'create the pull request on'\n\t\t\t\t\t}`;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RemoteResourceType.File:\n\t\t\t\t\ttitle = `${args.clipboard ? `Copy ${provider} File Url` : `Open File on ${provider}`}${pad(\n\t\t\t\t\t\tGlyphChars.Dot,\n\t\t\t\t\t\t2,\n\t\t\t\t\t\t2,\n\t\t\t\t\t)}${args.resource.fileName}`;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RemoteResourceType.Repo:\n\t\t\t\t\ttitle = `${args.clipboard ? `Copy ${provider} Repository Url` : `Open Repository on ${provider}`}`;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RemoteResourceType.Revision: {\n\t\t\t\t\ttitle = `${args.clipboard ? `Copy ${provider} File Url` : `Open File on ${provider}`}${pad(\n\t\t\t\t\t\tGlyphChars.Dot,\n\t\t\t\t\t\t2,\n\t\t\t\t\t\t2,\n\t\t\t\t\t)}${GitRevision.shorten(args.resource.sha)}${pad(GlyphChars.Dot, 1, 1)}${args.resource.fileName}`;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst pick = await RemoteProviderPicker.show(title, placeHolder, args.resource, remotes, options);\n\t\t\tvoid (await pick?.execute());\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenOnRemoteCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open in remote provider');\n\t\t}\n\t}\n}\n","import { env, Uri } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { AutolinkedItemNode } from '../views/nodes/autolinkedItemNode';\nimport { Command, CommandContext } from './base';\n\nexport interface OpenIssueOnRemoteCommandArgs {\n\tclipboard?: boolean;\n\tissue: { url: string };\n}\n\n@command()\nexport class OpenIssueOnRemoteCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.OpenIssueOnRemote, Commands.CopyRemoteIssueUrl]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args: OpenIssueOnRemoteCommandArgs) {\n\t\tif (context.type === 'viewItem' && context.node instanceof AutolinkedItemNode) {\n\t\t\targs = {\n\t\t\t\t...args,\n\t\t\t\tissue: { url: context.node.issue.url },\n\t\t\t\tclipboard: context.command === Commands.CopyRemotePullRequestUrl,\n\t\t\t};\n\t\t}\n\n\t\treturn this.execute(args);\n\t}\n\n\tasync execute(args: OpenIssueOnRemoteCommandArgs) {\n\t\tif (args.clipboard) {\n\t\t\tvoid (await env.clipboard.writeText(args.issue.url));\n\t\t} else {\n\t\t\tvoid env.openExternal(Uri.parse(args.issue.url));\n\t\t}\n\t}\n}\n","import { env, Uri } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { PullRequestNode } from '../views/nodes';\nimport { Command, CommandContext } from './base';\n\nexport interface OpenPullRequestOnRemoteCommandArgs {\n\tclipboard?: boolean;\n\tref?: string;\n\trepoPath?: string;\n\tpr?: { url: string };\n}\n\n@command()\nexport class OpenPullRequestOnRemoteCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.OpenPullRequestOnRemote, Commands.CopyRemotePullRequestUrl]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: OpenPullRequestOnRemoteCommandArgs) {\n\t\tif (context.type === 'viewItem' && context.node instanceof PullRequestNode) {\n\t\t\targs = {\n\t\t\t\t...args,\n\t\t\t\tpr: { url: context.node.pullRequest.url },\n\t\t\t\tclipboard: context.command === Commands.CopyRemotePullRequestUrl,\n\t\t\t};\n\t\t}\n\n\t\treturn this.execute(args);\n\t}\n\n\tasync execute(args?: OpenPullRequestOnRemoteCommandArgs) {\n\t\tif (args?.pr == null) {\n\t\t\tif (args?.repoPath == null || args?.ref == null) return;\n\n\t\t\tconst remote = await this.container.git.getRichRemoteProvider(args.repoPath);\n\t\t\tif (remote?.provider == null) return;\n\n\t\t\tconst pr = await this.container.git.getPullRequestForCommit(args.ref, remote.provider);\n\t\t\tif (pr == null) return;\n\n\t\t\targs = { ...args };\n\t\t\targs.pr = pr;\n\t\t}\n\n\t\tif (args.clipboard) {\n\t\t\tvoid (await env.clipboard.writeText(args.pr.url));\n\t\t} else {\n\t\t\tvoid env.openExternal(Uri.parse(args.pr.url));\n\t\t}\n\t}\n}\n","import { TextEditor, Uri, window } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { RemoteResourceType } from '../git/remotes/provider';\nimport { Logger } from '../logger';\nimport { RepositoryPicker } from '../quickpicks/repositoryPicker';\nimport { command, executeCommand } from '../system/command';\nimport { ActiveEditorCommand, CommandContext, getCommandUri, isCommandContextViewNodeHasRemote } from './base';\nimport { OpenOnRemoteCommandArgs } from './openOnRemote';\n\nexport interface OpenRepoOnRemoteCommandArgs {\n\tclipboard?: boolean;\n\tremote?: string;\n}\n\n@command()\nexport class OpenRepoOnRemoteCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.OpenRepoOnRemote, Commands.Deprecated_OpenRepoInRemote, Commands.CopyRemoteRepositoryUrl]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: OpenRepoOnRemoteCommandArgs) {\n\t\tif (isCommandContextViewNodeHasRemote(context)) {\n\t\t\targs = { ...args, remote: context.node.remote.name };\n\t\t}\n\n\t\tif (context.command === Commands.CopyRemoteRepositoryUrl) {\n\t\t\targs = { ...args, clipboard: true };\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: OpenRepoOnRemoteCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\n\t\tconst gitUri = uri != null ? await GitUri.fromUri(uri) : undefined;\n\n\t\tconst repoPath = (\n\t\t\tawait RepositoryPicker.getBestRepositoryOrShow(\n\t\t\t\tgitUri,\n\t\t\t\teditor,\n\t\t\t\targs?.clipboard\n\t\t\t\t\t? 'Choose which repository to copy the url from'\n\t\t\t\t\t: 'Choose which repository to open on remote',\n\t\t\t)\n\t\t)?.path;\n\t\tif (!repoPath) return;\n\n\t\ttry {\n\t\t\tvoid (await executeCommand<OpenOnRemoteCommandArgs>(Commands.OpenOnRemote, {\n\t\t\t\tresource: {\n\t\t\t\t\ttype: RemoteResourceType.Repo,\n\t\t\t\t},\n\t\t\t\trepoPath: repoPath,\n\t\t\t\tremote: args?.remote,\n\t\t\t\tclipboard: args?.clipboard,\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenRepoOnRemoteCommand');\n\t\t\tvoid window.showErrorMessage(\n\t\t\t\t'Unable to open repository on remote provider. See output channel for more details',\n\t\t\t);\n\t\t}\n\t}\n}\n","import { TextDocumentShowOptions, TextEditor, Uri } from 'vscode';\nimport { FileAnnotationType } from '../configuration';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitRevision } from '../git/models';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command } from '../system/command';\nimport { ActiveEditorCommand, getCommandUri } from './base';\nimport { GitActions } from './gitCommands.actions';\n\nexport interface OpenRevisionFileCommandArgs {\n\trevisionUri?: Uri;\n\n\tline?: number;\n\tshowOptions?: TextDocumentShowOptions;\n\tannotationType?: FileAnnotationType;\n}\n\n@command()\nexport class OpenRevisionFileCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.OpenRevisionFile, Commands.OpenRevisionFileInDiffLeft, Commands.OpenRevisionFileInDiffRight]);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: OpenRevisionFileCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\tconst gitUri = await GitUri.fromUri(uri);\n\n\t\targs = { ...args };\n\t\tif (args.line == null) {\n\t\t\targs.line = editor?.selection.active.line ?? 0;\n\t\t}\n\n\t\ttry {\n\t\t\tif (args.revisionUri == null) {\n\t\t\t\tif (gitUri?.sha) {\n\t\t\t\t\tconst commit = await this.container.git.getCommit(gitUri.repoPath!, gitUri.sha);\n\n\t\t\t\t\targs.revisionUri =\n\t\t\t\t\t\tcommit?.file?.status === 'D'\n\t\t\t\t\t\t\t? this.container.git.getRevisionUri(\n\t\t\t\t\t\t\t\t\t(await commit.getPreviousSha()) ?? GitRevision.deletedOrMissing,\n\t\t\t\t\t\t\t\t\tcommit.file,\n\t\t\t\t\t\t\t\t\tcommit.repoPath,\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t: this.container.git.getRevisionUri(gitUri);\n\t\t\t\t} else {\n\t\t\t\t\targs.revisionUri = this.container.git.getRevisionUri(gitUri);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvoid (await GitActions.Commit.openFileAtRevision(args.revisionUri, {\n\t\t\t\tannotationType: args.annotationType,\n\t\t\t\tline: args.line,\n\t\t\t\t...args.showOptions,\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenRevisionFileCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open file revision');\n\t\t}\n\t}\n}\n","import { Range, TextDocumentShowOptions, TextEditor, Uri, window } from 'vscode';\nimport { FileAnnotationType } from '../configuration';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command } from '../system/command';\nimport { findOrOpenEditor } from '../system/utils';\nimport { ActiveEditorCommand, getCommandUri } from './base';\n\nexport interface OpenWorkingFileCommandArgs {\n\turi?: Uri;\n\tline?: number;\n\tshowOptions?: TextDocumentShowOptions;\n\tannotationType?: FileAnnotationType;\n}\n\n@command()\nexport class OpenWorkingFileCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.OpenWorkingFile, Commands.OpenWorkingFileInDiffLeft, Commands.OpenWorkingFileInDiffRight]);\n\t}\n\n\tasync execute(editor: TextEditor, uri?: Uri, args?: OpenWorkingFileCommandArgs) {\n\t\targs = { ...args };\n\t\tif (args.line == null) {\n\t\t\targs.line = editor?.selection.active.line;\n\t\t}\n\n\t\ttry {\n\t\t\tif (args.uri == null) {\n\t\t\t\turi = getCommandUri(uri, editor);\n\t\t\t\tif (uri == null) return;\n\t\t\t} else {\n\t\t\t\turi = args.uri;\n\t\t\t}\n\n\t\t\targs.uri = await GitUri.fromUri(uri);\n\t\t\tif (GitUri.is(args.uri) && args.uri.sha) {\n\t\t\t\tconst workingUri = await this.container.git.getWorkingUri(args.uri.repoPath!, args.uri);\n\t\t\t\tif (workingUri === undefined) {\n\t\t\t\t\tvoid window.showWarningMessage(\n\t\t\t\t\t\t'Unable to open working file. File could not be found in the working tree',\n\t\t\t\t\t);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\targs.uri = new GitUri(workingUri, args.uri.repoPath);\n\t\t\t}\n\n\t\t\tif (args.line !== undefined && args.line !== 0) {\n\t\t\t\tif (args.showOptions === undefined) {\n\t\t\t\t\targs.showOptions = {};\n\t\t\t\t}\n\t\t\t\targs.showOptions.selection = new Range(args.line, 0, args.line, 0);\n\t\t\t}\n\n\t\t\tconst e = await findOrOpenEditor(args.uri, { ...args.showOptions, throwOnError: true });\n\t\t\tif (args.annotationType === undefined) return;\n\n\t\t\tvoid (await this.container.fileAnnotations.show(e, args.annotationType, {\n\t\t\t\tselection: { line: args.line },\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'OpenWorkingFileCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open working file');\n\t\t}\n\t}\n}\n","import { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { Command } from './base';\n\n@command()\nexport class DisableRebaseEditorCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.DisableRebaseEditor);\n\t}\n\n\texecute() {\n\t\treturn this.container.rebaseEditor.setEnabled(false);\n\t}\n}\n\n@command()\nexport class EnableRebaseEditorCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.EnableRebaseEditor);\n\t}\n\n\texecute() {\n\t\treturn this.container.rebaseEditor.setEnabled(true);\n\t}\n}\n","import { Commands, CoreCommands } from '../constants';\nimport type { Container } from '../container';\nimport { command, executeCoreCommand } from '../system/command';\nimport { Command } from './base';\n\n@command()\nexport class RefreshHoverCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.RefreshHover);\n\t}\n\n\tasync execute() {\n\t\t// TODO@eamodio figure out how to really refresh/update a hover\n\t\tawait executeCoreCommand(CoreCommands.EditorShowHover);\n\t}\n}\n","import { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitCommit, GitRemote, Repository } from '../git/models';\nimport { RichRemoteProvider } from '../git/remotes/provider';\nimport { RepositoryPicker } from '../quickpicks/repositoryPicker';\nimport { command } from '../system/command';\nimport { first } from '../system/iterable';\nimport { Command, CommandContext, isCommandContextViewNodeHasRemote } from './base';\n\nexport interface ConnectRemoteProviderCommandArgs {\n\tremote: string;\n\trepoPath: string;\n}\n\n@command()\nexport class ConnectRemoteProviderCommand extends Command {\n\tstatic getMarkdownCommandArgs(args: ConnectRemoteProviderCommandArgs): string;\n\tstatic getMarkdownCommandArgs(remote: GitRemote): string;\n\tstatic getMarkdownCommandArgs(argsOrRemote: ConnectRemoteProviderCommandArgs | GitRemote): string {\n\t\tlet args: ConnectRemoteProviderCommandArgs | GitCommit;\n\t\tif (GitRemote.is(argsOrRemote)) {\n\t\t\targs = {\n\t\t\t\tremote: argsOrRemote.id,\n\t\t\t\trepoPath: argsOrRemote.repoPath,\n\t\t\t};\n\t\t} else {\n\t\t\targs = argsOrRemote;\n\t\t}\n\n\t\treturn super.getMarkdownCommandArgsCore<ConnectRemoteProviderCommandArgs>(Commands.ConnectRemoteProvider, args);\n\t}\n\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.ConnectRemoteProvider);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: ConnectRemoteProviderCommandArgs) {\n\t\tif (isCommandContextViewNodeHasRemote(context)) {\n\t\t\targs = { ...args, remote: context.node.remote.id, repoPath: context.node.remote.repoPath };\n\t\t}\n\n\t\treturn this.execute(args);\n\t}\n\n\tasync execute(args?: ConnectRemoteProviderCommandArgs): Promise<any> {\n\t\tlet remote: GitRemote<RichRemoteProvider> | undefined;\n\t\tlet remotes: GitRemote[] | undefined;\n\t\tlet repoPath;\n\t\tif (args?.repoPath == null) {\n\t\t\tconst repos = new Map<Repository, GitRemote<RichRemoteProvider>>();\n\n\t\t\tfor (const repo of this.container.git.openRepositories) {\n\t\t\t\tconst remote = await repo.getRichRemote();\n\t\t\t\tif (remote?.provider != null && !(await remote.provider.isConnected())) {\n\t\t\t\t\trepos.set(repo, remote);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (repos.size === 0) return false;\n\t\t\tif (repos.size === 1) {\n\t\t\t\tlet repo;\n\t\t\t\t[repo, remote] = first(repos);\n\t\t\t\trepoPath = repo.path;\n\t\t\t} else {\n\t\t\t\tconst pick = await RepositoryPicker.show(\n\t\t\t\t\tundefined,\n\t\t\t\t\t'Choose which repository to connect to the remote provider',\n\t\t\t\t\t[...repos.keys()],\n\t\t\t\t);\n\t\t\t\tif (pick?.item == null) return undefined;\n\n\t\t\t\trepoPath = pick.repoPath;\n\t\t\t\tremote = repos.get(pick.item)!;\n\t\t\t}\n\t\t} else if (args?.remote == null) {\n\t\t\trepoPath = args.repoPath;\n\n\t\t\tremote = await this.container.git.getRichRemoteProvider(repoPath, { includeDisconnected: true });\n\t\t\tif (remote == null) return false;\n\t\t} else {\n\t\t\trepoPath = args.repoPath;\n\n\t\t\tremotes = await this.container.git.getRemotesWithProviders(repoPath);\n\t\t\tremote = remotes.find(r => r.id === args.remote) as GitRemote<RichRemoteProvider> | undefined;\n\t\t\tif (!remote?.hasRichProvider()) return false;\n\t\t}\n\n\t\tconst connected = await remote.provider.connect();\n\t\tif (\n\t\t\tconnected &&\n\t\t\t!(remotes ?? (await this.container.git.getRemotesWithProviders(repoPath))).some(r => r.default)\n\t\t) {\n\t\t\tawait remote.setAsDefault(true);\n\t\t}\n\t\treturn connected;\n\t}\n}\n\nexport interface DisconnectRemoteProviderCommandArgs {\n\tremote: string;\n\trepoPath: string;\n}\n\n@command()\nexport class DisconnectRemoteProviderCommand extends Command {\n\tstatic getMarkdownCommandArgs(args: DisconnectRemoteProviderCommandArgs): string;\n\tstatic getMarkdownCommandArgs(remote: GitRemote): string;\n\tstatic getMarkdownCommandArgs(argsOrRemote: DisconnectRemoteProviderCommandArgs | GitRemote): string {\n\t\tlet args: DisconnectRemoteProviderCommandArgs | GitCommit;\n\t\tif (GitRemote.is(argsOrRemote)) {\n\t\t\targs = {\n\t\t\t\tremote: argsOrRemote.id,\n\t\t\t\trepoPath: argsOrRemote.repoPath,\n\t\t\t};\n\t\t} else {\n\t\t\targs = argsOrRemote;\n\t\t}\n\n\t\treturn super.getMarkdownCommandArgsCore<DisconnectRemoteProviderCommandArgs>(\n\t\t\tCommands.DisconnectRemoteProvider,\n\t\t\targs,\n\t\t);\n\t}\n\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.DisconnectRemoteProvider);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: ConnectRemoteProviderCommandArgs) {\n\t\tif (isCommandContextViewNodeHasRemote(context)) {\n\t\t\targs = { ...args, remote: context.node.remote.id, repoPath: context.node.remote.repoPath };\n\t\t}\n\n\t\treturn this.execute(args);\n\t}\n\n\tasync execute(args?: DisconnectRemoteProviderCommandArgs): Promise<any> {\n\t\tlet remote: GitRemote<RichRemoteProvider> | undefined;\n\t\tlet repoPath;\n\t\tif (args?.repoPath == null) {\n\t\t\tconst repos = new Map<Repository, GitRemote<RichRemoteProvider>>();\n\n\t\t\tfor (const repo of this.container.git.openRepositories) {\n\t\t\t\tconst remote = await repo.getRichRemote(true);\n\t\t\t\tif (remote != null) {\n\t\t\t\t\trepos.set(repo, remote);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (repos.size === 0) return undefined;\n\t\t\tif (repos.size === 1) {\n\t\t\t\tlet repo;\n\t\t\t\t[repo, remote] = first(repos);\n\t\t\t\trepoPath = repo.path;\n\t\t\t} else {\n\t\t\t\tconst pick = await RepositoryPicker.show(\n\t\t\t\t\tundefined,\n\t\t\t\t\t'Choose which repository to disconnect from the remote provider',\n\t\t\t\t\t[...repos.keys()],\n\t\t\t\t);\n\t\t\t\tif (pick?.item == null) return undefined;\n\n\t\t\t\trepoPath = pick.repoPath;\n\t\t\t\tremote = repos.get(pick.item)!;\n\t\t\t}\n\t\t} else if (args?.remote == null) {\n\t\t\trepoPath = args.repoPath;\n\n\t\t\tremote = await this.container.git.getRichRemoteProvider(repoPath, { includeDisconnected: false });\n\t\t\tif (remote == null) return undefined;\n\t\t} else {\n\t\t\trepoPath = args.repoPath;\n\n\t\t\tremote = (await this.container.git.getRemotesWithProviders(repoPath)).find(r => r.id === args.remote) as\n\t\t\t\t| GitRemote<RichRemoteProvider>\n\t\t\t\t| undefined;\n\t\t\tif (!remote?.hasRichProvider()) return undefined;\n\t\t}\n\n\t\treturn remote.provider.disconnect();\n\t}\n}\n","import { executeGitCommand } from '../commands/gitCommands.actions';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { Command } from './base';\n\n@command()\nexport class FetchRepositoriesCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.FetchRepositories);\n\t}\n\n\tasync execute() {\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'fetch',\n\t\t\tstate: { repos: this.container.git.openRepositories },\n\t\t});\n\t}\n}\n\n@command()\nexport class PullRepositoriesCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.PullRepositories);\n\t}\n\n\tasync execute() {\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'pull',\n\t\t\tstate: { repos: this.container.git.openRepositories },\n\t\t});\n\t}\n}\n\n@command()\nexport class PushRepositoriesCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.PushRepositories);\n\t}\n\n\tasync execute() {\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'push',\n\t\t\tstate: { repos: this.container.git.openRepositories },\n\t\t});\n\t}\n}\n","import { resetAvatarCache } from '../avatars';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { Command } from './base';\n\n@command()\nexport class ResetAvatarCacheCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.ResetAvatarCache);\n\t}\n\n\texecute() {\n\t\tresetAvatarCache('all');\n\t}\n}\n","import { ConfigurationTarget } from 'vscode';\nimport { configuration } from '../configuration';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { Command } from './base';\n\n@command()\nexport class ResetSuppressedWarningsCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.ResetSuppressedWarnings);\n\t}\n\n\tasync execute() {\n\t\tvoid (await configuration.update('advanced.messages', undefined, ConfigurationTarget.Global));\n\t}\n}\n","import { window } from 'vscode';\nimport { viewsConfigKeys } from '../configuration';\nimport { Commands, CoreCommands } from '../constants';\nimport type { Container } from '../container';\nimport { command, executeCommand, executeCoreCommand } from '../system/command';\nimport { Command } from './base';\n\nenum ViewsLayout {\n\tGitLens = 'gitlens',\n\tSourceControl = 'scm',\n}\n\nexport interface SetViewsLayoutCommandArgs {\n\tlayout: ViewsLayout;\n}\n\n@command()\nexport class SetViewsLayoutCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.SetViewsLayout);\n\t}\n\n\tasync execute(args?: SetViewsLayoutCommandArgs) {\n\t\tlet layout = args?.layout;\n\t\tif (layout == null) {\n\t\t\tconst pick = await window.showQuickPick(\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Source Control Layout',\n\t\t\t\t\t\tdescription: '(default)',\n\t\t\t\t\t\tdetail: 'Shows all the views together on the Source Control side bar',\n\t\t\t\t\t\tlayout: ViewsLayout.SourceControl,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'GitLens Layout',\n\t\t\t\t\t\tdescription: '',\n\t\t\t\t\t\tdetail: 'Shows all the views together on the GitLens side bar',\n\t\t\t\t\t\tlayout: ViewsLayout.GitLens,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\t{\n\t\t\t\t\tplaceHolder: 'Choose a GitLens views layout',\n\t\t\t\t},\n\t\t\t);\n\t\t\tif (pick == null) return;\n\n\t\t\tlayout = pick.layout;\n\t\t}\n\n\t\tswitch (layout) {\n\t\t\tcase ViewsLayout.GitLens:\n\t\t\t\ttry {\n\t\t\t\t\t// Because of https://github.com/microsoft/vscode/issues/105774, run the command twice which seems to fix things\n\t\t\t\t\tlet count = 0;\n\t\t\t\t\twhile (count++ < 2) {\n\t\t\t\t\t\tvoid (await executeCoreCommand(CoreCommands.MoveViews, {\n\t\t\t\t\t\t\tviewIds: viewsConfigKeys.map(view => `gitlens.views.${view}`),\n\t\t\t\t\t\t\tdestinationId: 'workbench.view.extension.gitlens',\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t} catch {}\n\n\t\t\t\tbreak;\n\t\t\tcase ViewsLayout.SourceControl:\n\t\t\t\ttry {\n\t\t\t\t\t// Because of https://github.com/microsoft/vscode/issues/105774, run the command twice which seems to fix things\n\t\t\t\t\tlet count = 0;\n\t\t\t\t\twhile (count++ < 2) {\n\t\t\t\t\t\tvoid (await executeCoreCommand(CoreCommands.MoveViews, {\n\t\t\t\t\t\t\tviewIds: viewsConfigKeys.map(view => `gitlens.views.${view}`),\n\t\t\t\t\t\t\tdestinationId: 'workbench.view.scm',\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t} catch {\n\t\t\t\t\tfor (const view of viewsConfigKeys) {\n\t\t\t\t\t\tvoid (await executeCommand(`gitlens.views.${view}.resetViewLocation`));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n","import { executeGitCommand } from '../commands/gitCommands.actions';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { SearchPattern } from '../git/search';\nimport { command } from '../system/command';\nimport { SearchResultsNode } from '../views/nodes';\nimport { Command, CommandContext, isCommandContextViewNodeHasRepository } from './base';\n\nexport interface SearchCommitsCommandArgs {\n\tsearch?: Partial<SearchPattern>;\n\trepoPath?: string;\n\n\tprefillOnly?: boolean;\n\n\tshowResultsInSideBar?: boolean;\n}\n\n@command()\nexport class SearchCommitsCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.SearchCommits, Commands.SearchCommitsInView]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: SearchCommitsCommandArgs) {\n\t\tif (context.type === 'viewItem') {\n\t\t\targs = { ...args };\n\t\t\targs.showResultsInSideBar = true;\n\n\t\t\tif (context.node instanceof SearchResultsNode) {\n\t\t\t\targs.repoPath = context.node.repoPath;\n\t\t\t\targs.search = context.node.search;\n\t\t\t\targs.prefillOnly = true;\n\t\t\t}\n\n\t\t\tif (isCommandContextViewNodeHasRepository(context)) {\n\t\t\t\targs.repoPath = context.node.repo.path;\n\t\t\t}\n\t\t} else if (context.command === Commands.SearchCommitsInView) {\n\t\t\targs = { ...args };\n\t\t\targs.showResultsInSideBar = true;\n\t\t}\n\n\t\treturn this.execute(args);\n\t}\n\n\tasync execute(args?: SearchCommitsCommandArgs) {\n\t\tvoid (await executeGitCommand({\n\t\t\tcommand: 'search',\n\t\t\tprefillOnly: args?.prefillOnly,\n\t\t\tstate: {\n\t\t\t\trepo: args?.repoPath,\n\t\t\t\t...args?.search,\n\t\t\t\tshowResultsInSideBar:\n\t\t\t\t\tthis.container.config.gitCommands.search.showResultsInSideBar ?? args?.showResultsInSideBar,\n\t\t\t},\n\t\t}));\n\t}\n}\n","import { TextEditor, Uri } from 'vscode';\nimport { executeGitCommand } from '../commands/gitCommands.actions';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { SearchPattern } from '../git/search';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command } from '../system/command';\nimport { filterMap } from '../system/iterable';\nimport { ActiveEditorCommand, getCommandUri } from './base';\n\nexport interface ShowCommitsInViewCommandArgs {\n\trefs?: string[];\n\trepoPath?: string;\n}\n\n@command()\nexport class ShowCommitsInViewCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.ShowCommitInView, Commands.ShowCommitsInView]);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: ShowCommitsInViewCommandArgs) {\n\t\targs = { ...args };\n\n\t\tif (args.refs === undefined) {\n\t\t\turi = getCommandUri(uri, editor);\n\t\t\tif (uri == null) return undefined;\n\n\t\t\tconst gitUri = await GitUri.fromUri(uri);\n\n\t\t\targs.repoPath = gitUri.repoPath;\n\n\t\t\tif (editor != null) {\n\t\t\t\ttry {\n\t\t\t\t\t// Check for any uncommitted changes in the range\n\t\t\t\t\tconst blame = editor.document.isDirty\n\t\t\t\t\t\t? await this.container.git.getBlameForRangeContents(\n\t\t\t\t\t\t\t\tgitUri,\n\t\t\t\t\t\t\t\teditor.selection,\n\t\t\t\t\t\t\t\teditor.document.getText(),\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: await this.container.git.getBlameForRange(gitUri, editor.selection);\n\t\t\t\t\tif (blame === undefined) {\n\t\t\t\t\t\treturn Messages.showFileNotUnderSourceControlWarningMessage('Unable to find commits');\n\t\t\t\t\t}\n\n\t\t\t\t\targs.refs = [...filterMap(blame.commits.values(), c => (c.isUncommitted ? undefined : c.ref))];\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tLogger.error(ex, 'ShowCommitsInViewCommand', 'getBlameForRange');\n\t\t\t\t\treturn Messages.showGenericErrorMessage('Unable to find commits');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (gitUri.sha == null) return undefined;\n\n\t\t\t\targs.refs = [gitUri.sha];\n\t\t\t}\n\t\t}\n\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'search',\n\t\t\tstate: {\n\t\t\t\trepo: args?.repoPath,\n\t\t\t\tpattern: SearchPattern.fromCommits(args.refs),\n\t\t\t\tshowResultsInSideBar: true,\n\t\t\t},\n\t\t});\n\t}\n}\n","import { commands } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command } from '../system/command';\nimport { Command, getLastCommand } from './base';\n\n@command()\nexport class ShowLastQuickPickCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.ShowLastQuickPick);\n\t}\n\n\texecute() {\n\t\tconst command = getLastCommand();\n\t\tif (command === undefined) return Promise.resolve(undefined);\n\n\t\ttry {\n\t\t\treturn commands.executeCommand(command.command, ...command.args);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'ShowLastQuickPickCommand');\n\t\t\treturn Messages.showGenericErrorMessage('Unable to show last quick pick');\n\t\t}\n\t}\n}\n","import { TextEditor, Uri } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitReference } from '../git/models';\nimport { command } from '../system/command';\nimport { ActiveEditorCachedCommand, CommandContext, getCommandUri } from './base';\nimport { executeGitCommand } from './gitCommands.actions';\n\nexport interface ShowQuickBranchHistoryCommandArgs {\n\trepoPath?: string;\n\tbranch?: string;\n\ttag?: string;\n}\n\n@command()\nexport class ShowQuickBranchHistoryCommand extends ActiveEditorCachedCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.ShowQuickBranchHistory, Commands.ShowQuickCurrentBranchHistory]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: ShowQuickBranchHistoryCommandArgs) {\n\t\tif (context.command === Commands.ShowQuickCurrentBranchHistory) {\n\t\t\targs = { ...args };\n\t\t\targs.branch = 'HEAD';\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: ShowQuickBranchHistoryCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\n\t\tconst gitUri = uri != null ? await GitUri.fromUri(uri) : undefined;\n\n\t\tconst repoPath = args?.repoPath ?? gitUri?.repoPath ?? this.container.git.highlander?.path;\n\t\tlet ref: GitReference | 'HEAD' | undefined;\n\t\tif (repoPath != null) {\n\t\t\tif (args?.branch != null) {\n\t\t\t\tref =\n\t\t\t\t\targs.branch === 'HEAD'\n\t\t\t\t\t\t? 'HEAD'\n\t\t\t\t\t\t: GitReference.create(args.branch, repoPath, {\n\t\t\t\t\t\t\t\trefType: 'branch',\n\t\t\t\t\t\t\t\tname: args.branch,\n\t\t\t\t\t\t\t\tremote: false,\n\t\t\t\t\t\t  });\n\t\t\t} else if (args?.tag != null) {\n\t\t\t\tref = GitReference.create(args.tag, repoPath, { refType: 'tag', name: args.tag });\n\t\t\t}\n\t\t}\n\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'log',\n\t\t\tstate: repoPath != null ? { repo: repoPath, reference: ref } : {},\n\t\t});\n\t}\n}\n","import { TextEditor, Uri } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitCommit, GitLog, GitStashCommit } from '../git/models';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command } from '../system/command';\nimport { ActiveEditorCachedCommand, CommandContext, getCommandUri, isCommandContextViewNodeHasCommit } from './base';\nimport { executeGitCommand, GitActions } from './gitCommands.actions';\n\nexport interface ShowQuickCommitCommandArgs {\n\trepoPath?: string;\n\tsha?: string;\n\tcommit?: GitCommit | GitStashCommit;\n\trepoLog?: GitLog;\n\trevealInView?: boolean;\n}\n\n@command()\nexport class ShowQuickCommitCommand extends ActiveEditorCachedCommand {\n\tstatic getMarkdownCommandArgs(sha: string, repoPath?: string): string;\n\tstatic getMarkdownCommandArgs(args: ShowQuickCommitCommandArgs): string;\n\tstatic getMarkdownCommandArgs(argsOrSha: ShowQuickCommitCommandArgs | string, repoPath?: string): string {\n\t\tconst args = typeof argsOrSha === 'string' ? { sha: argsOrSha, repoPath: repoPath } : argsOrSha;\n\t\treturn super.getMarkdownCommandArgsCore<ShowQuickCommitCommandArgs>(Commands.ShowQuickCommit, args);\n\t}\n\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.RevealCommitInView, Commands.ShowQuickCommit]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: ShowQuickCommitCommandArgs) {\n\t\tif (context.command === Commands.RevealCommitInView) {\n\t\t\targs = { ...args };\n\t\t\targs.revealInView = true;\n\t\t}\n\n\t\tif (context.type === 'viewItem') {\n\t\t\targs = { ...args };\n\t\t\targs.sha = context.node.uri.sha;\n\n\t\t\tif (isCommandContextViewNodeHasCommit(context)) {\n\t\t\t\targs.commit = context.node.commit;\n\t\t\t}\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: ShowQuickCommitCommandArgs) {\n\t\tlet gitUri;\n\t\tlet repoPath;\n\t\tif (args?.commit == null) {\n\t\t\tif (args?.repoPath != null && args.sha != null) {\n\t\t\t\trepoPath = args.repoPath;\n\t\t\t\tgitUri = GitUri.fromRepoPath(repoPath);\n\t\t\t} else {\n\t\t\t\turi = getCommandUri(uri, editor);\n\t\t\t\tif (uri == null) return;\n\n\t\t\t\tgitUri = await GitUri.fromUri(uri);\n\t\t\t\trepoPath = gitUri.repoPath;\n\t\t\t}\n\t\t} else {\n\t\t\tif (args.sha == null) {\n\t\t\t\targs.sha = args.commit.sha;\n\t\t\t}\n\n\t\t\tgitUri = args.commit.getGitUri();\n\t\t\trepoPath = args.commit.repoPath;\n\n\t\t\tif (uri == null) {\n\t\t\t\turi = args.commit.file?.uri;\n\t\t\t}\n\t\t}\n\n\t\targs = { ...args };\n\t\tif (args.sha == null) {\n\t\t\tif (editor == null) return;\n\n\t\t\tconst blameline = editor.selection.active.line;\n\t\t\tif (blameline < 0) return;\n\n\t\t\ttry {\n\t\t\t\tconst blame = await this.container.git.getBlameForLine(gitUri, blameline);\n\t\t\t\tif (blame == null) {\n\t\t\t\t\tvoid Messages.showFileNotUnderSourceControlWarningMessage('Unable to show commit');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Because the previous sha of an uncommitted file isn't trust worthy we just have to kick out\n\t\t\t\tif (blame.commit.isUncommitted) {\n\t\t\t\t\tvoid Messages.showLineUncommittedWarningMessage('Unable to show commit');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\targs.sha = blame.commit.sha;\n\t\t\t\trepoPath = blame.commit.repoPath;\n\n\t\t\t\targs.commit = blame.commit;\n\t\t\t} catch (ex) {\n\t\t\t\tLogger.error(ex, 'ShowQuickCommitCommand', `getBlameForLine(${blameline})`);\n\t\t\t\tvoid Messages.showGenericErrorMessage('Unable to show commit');\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tif (args.commit == null || args.commit.file != null) {\n\t\t\t\tif (args.repoLog != null) {\n\t\t\t\t\targs.commit = args.repoLog.commits.get(args.sha);\n\t\t\t\t\t// If we can't find the commit, kill the repoLog\n\t\t\t\t\tif (args.commit == null) {\n\t\t\t\t\t\targs.repoLog = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (args.repoLog == null) {\n\t\t\t\t\targs.commit = await this.container.git.getCommit(repoPath!, args.sha);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (args.commit == null) {\n\t\t\t\tvoid Messages.showCommitNotFoundWarningMessage('Unable to show commit');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (args.revealInView) {\n\t\t\t\tvoid (await GitActions.Commit.reveal(args.commit, {\n\t\t\t\t\tselect: true,\n\t\t\t\t\tfocus: true,\n\t\t\t\t\texpand: true,\n\t\t\t\t}));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid (await executeGitCommand({\n\t\t\t\tcommand: 'show',\n\t\t\t\tstate: {\n\t\t\t\t\trepo: repoPath,\n\t\t\t\t\treference: args.commit,\n\t\t\t\t},\n\t\t\t}));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'ShowQuickCommitCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to show commit');\n\t\t}\n\t}\n}\n","import { TextEditor, Uri, window } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitCommit, GitLog, GitStashCommit } from '../git/models';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command } from '../system/command';\nimport { ActiveEditorCachedCommand, CommandContext, getCommandUri, isCommandContextViewNodeHasCommit } from './base';\nimport { executeGitCommand } from './gitCommands.actions';\n\nexport interface ShowQuickCommitFileCommandArgs {\n\tsha?: string;\n\tcommit?: GitCommit | GitStashCommit;\n\tfileLog?: GitLog;\n\trevisionUri?: string;\n}\n\n@command()\nexport class ShowQuickCommitFileCommand extends ActiveEditorCachedCommand {\n\tstatic getMarkdownCommandArgs(args: ShowQuickCommitFileCommandArgs): string {\n\t\treturn super.getMarkdownCommandArgsCore<ShowQuickCommitFileCommandArgs>(Commands.ShowQuickCommitFile, args);\n\t}\n\n\tconstructor(private readonly container: Container) {\n\t\tsuper([\n\t\t\tCommands.ShowQuickCommitFile,\n\t\t\tCommands.ShowQuickCommitRevision,\n\t\t\tCommands.ShowQuickCommitRevisionInDiffLeft,\n\t\t\tCommands.ShowQuickCommitRevisionInDiffRight,\n\t\t]);\n\t}\n\n\tprotected override async preExecute(context: CommandContext, args?: ShowQuickCommitFileCommandArgs) {\n\t\tif (context.editor != null && context.command.startsWith(Commands.ShowQuickCommitRevision)) {\n\t\t\targs = { ...args };\n\n\t\t\tconst gitUri = await GitUri.fromUri(context.editor.document.uri);\n\t\t\targs.sha = gitUri.sha;\n\t\t}\n\n\t\tif (context.type === 'viewItem') {\n\t\t\targs = { ...args };\n\t\t\targs.sha = context.node.uri.sha;\n\n\t\t\tif (isCommandContextViewNodeHasCommit(context)) {\n\t\t\t\targs.commit = context.node.commit as any;\n\t\t\t}\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: ShowQuickCommitFileCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\targs = { ...args };\n\n\t\tlet gitUri;\n\t\tif (args.revisionUri !== undefined) {\n\t\t\tgitUri = GitUri.fromRevisionUri(Uri.parse(args.revisionUri, true));\n\t\t\targs.sha = gitUri.sha;\n\t\t} else {\n\t\t\tgitUri = await GitUri.fromUri(uri);\n\t\t}\n\n\t\tif (args.sha === undefined) {\n\t\t\tif (editor == null) return;\n\n\t\t\tconst blameline = editor.selection.active.line;\n\t\t\tif (blameline < 0) return;\n\n\t\t\ttry {\n\t\t\t\tconst blame = await this.container.git.getBlameForLine(gitUri, blameline);\n\t\t\t\tif (blame == null) {\n\t\t\t\t\tvoid Messages.showFileNotUnderSourceControlWarningMessage('Unable to show commit file details');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Because the previous sha of an uncommitted file isn't trust worthy we just have to kick out\n\t\t\t\tif (blame.commit.isUncommitted) {\n\t\t\t\t\tvoid Messages.showLineUncommittedWarningMessage('Unable to show commit file details');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\targs.sha = blame.commit.sha;\n\n\t\t\t\targs.commit = blame.commit;\n\t\t\t} catch (ex) {\n\t\t\t\tLogger.error(ex, 'ShowQuickCommitFileDetailsCommand', `getBlameForLine(${blameline})`);\n\t\t\t\tvoid window.showErrorMessage('Unable to show commit file details. See output channel for more details');\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tif (args.commit == null /*|| args.commit.file != null*/) {\n\t\t\t\tif (args.fileLog != null) {\n\t\t\t\t\targs.commit = args.fileLog.commits.get(args.sha);\n\t\t\t\t\t// If we can't find the commit, kill the fileLog\n\t\t\t\t\tif (args.commit == null) {\n\t\t\t\t\t\targs.fileLog = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (args.fileLog == null) {\n\t\t\t\t\tconst repoPath = args.commit?.repoPath ?? gitUri.repoPath;\n\t\t\t\t\targs.commit = await this.container.git.getCommitForFile(repoPath, gitUri, {\n\t\t\t\t\t\tref: args.sha,\n\t\t\t\t\t});\n\t\t\t\t\tif (args.commit == null) {\n\t\t\t\t\t\tvoid Messages.showCommitNotFoundWarningMessage('Unable to show commit file details');\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (args.commit == null) {\n\t\t\t\tvoid Messages.showCommitNotFoundWarningMessage('Unable to show commit file details');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst path = args.commit?.file?.path ?? gitUri.fsPath;\n\t\t\tif (GitCommit.is(args.commit)) {\n\t\t\t\tif (args.commit.files == null) {\n\t\t\t\t\tawait args.commit.ensureFullDetails();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// const shortSha = GitRevision.shorten(args.sha);\n\n\t\t\t// if (args.commit instanceof GitBlameCommit) {\n\t\t\t// \targs.commit = (await this.container.git.getCommit(args.commit.repoPath, args.commit.ref))!;\n\t\t\t// }\n\n\t\t\tvoid (await executeGitCommand({\n\t\t\t\tcommand: 'show',\n\t\t\t\tstate: {\n\t\t\t\t\trepo: args.commit.repoPath,\n\t\t\t\t\treference: args.commit,\n\t\t\t\t\tfileName: path,\n\t\t\t\t},\n\t\t\t}));\n\n\t\t\t// if (args.goBackCommand === undefined) {\n\t\t\t// \tconst commandArgs: ShowQuickCommitCommandArgs = {\n\t\t\t// \t\tcommit: args.commit,\n\t\t\t// \t\tsha: args.sha,\n\t\t\t// \t};\n\n\t\t\t// \t// Create a command to get back to the commit details\n\t\t\t// \targs.goBackCommand = new CommandQuickPickItem(\n\t\t\t// \t\t{\n\t\t\t// \t\t\tlabel: `go back ${GlyphChars.ArrowBack}`,\n\t\t\t// \t\t\tdescription: `to details of ${GlyphChars.Space}$(git-commit) ${shortSha}`,\n\t\t\t// \t\t},\n\t\t\t// \t\tCommands.ShowQuickCommit,\n\t\t\t// \t\t[args.commit.toGitUri(), commandArgs],\n\t\t\t// \t);\n\t\t\t// }\n\n\t\t\t// // Create a command to get back to where we are right now\n\t\t\t// const currentCommand = new CommandQuickPickItem(\n\t\t\t// \t{\n\t\t\t// \t\tlabel: `go back ${GlyphChars.ArrowBack}`,\n\t\t\t// \t\tdescription: `to details of ${args.commit.getFormattedPath()} from ${\n\t\t\t// \t\t\tGlyphChars.Space\n\t\t\t// \t\t}$(git-commit) ${shortSha}`,\n\t\t\t// \t},\n\t\t\t// \tCommands.ShowQuickCommitFile,\n\t\t\t// \t[args.commit.toGitUri(), args],\n\t\t\t// );\n\n\t\t\t// const pick = await CommitFileQuickPick.show(args.commit as GitCommit, uri, {\n\t\t\t// \tgoBackCommand: args.goBackCommand,\n\t\t\t// \tcurrentCommand: currentCommand,\n\t\t\t// \tfileLog: args.fileLog,\n\t\t\t// });\n\t\t\t// if (pick === undefined) return undefined;\n\n\t\t\t// if (pick instanceof CommandQuickPickItem) return pick.execute();\n\n\t\t\t// return undefined;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'ShowQuickCommitFileDetailsCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to show commit file details');\n\t\t}\n\t}\n}\n","import { Range, TextEditor, Uri } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitBranch, GitLog, GitReference, GitTag } from '../git/models';\nimport { CommandQuickPickItem } from '../quickpicks/items/common';\nimport { command } from '../system/command';\nimport { ActiveEditorCachedCommand, CommandContext, getCommandUri } from './base';\nimport { executeGitCommand } from './gitCommands.actions';\n\nexport interface ShowQuickFileHistoryCommandArgs {\n\treference?: GitBranch | GitTag | GitReference;\n\tlog?: GitLog;\n\tlimit?: number;\n\trange?: Range;\n\tshowInSideBar?: boolean;\n\n\tgoBackCommand?: CommandQuickPickItem;\n\tnextPageCommand?: CommandQuickPickItem;\n}\n\n@command()\nexport class ShowQuickFileHistoryCommand extends ActiveEditorCachedCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([\n\t\t\tCommands.OpenFileHistory,\n\t\t\tCommands.OpenFolderHistory,\n\t\t\tCommands.ShowQuickFileHistory,\n\t\t\tCommands.QuickOpenFileHistory,\n\t\t\tCommands.Deprecated_ShowFileHistoryInView,\n\t\t]);\n\t}\n\n\tprotected override preExecute(context: CommandContext, args?: ShowQuickFileHistoryCommandArgs) {\n\t\tif (\n\t\t\tcontext.command === Commands.OpenFileHistory ||\n\t\t\tcontext.command === Commands.OpenFolderHistory ||\n\t\t\tcontext.command === Commands.Deprecated_ShowFileHistoryInView\n\t\t) {\n\t\t\targs = { ...args };\n\t\t\targs.showInSideBar = true;\n\t\t}\n\n\t\treturn this.execute(context.editor, context.uri, args);\n\t}\n\n\tasync execute(editor?: TextEditor, uri?: Uri, args?: ShowQuickFileHistoryCommandArgs) {\n\t\turi = getCommandUri(uri, editor);\n\t\tif (uri == null) return;\n\n\t\tconst gitUri = await GitUri.fromUri(uri);\n\n\t\tif (args?.showInSideBar) {\n\t\t\tawait this.container.fileHistoryView.showHistoryForUri(gitUri);\n\n\t\t\treturn;\n\t\t}\n\n\t\tvoid (await executeGitCommand({\n\t\t\tcommand: 'log',\n\t\t\tstate:\n\t\t\t\tgitUri?.repoPath != null\n\t\t\t\t\t? {\n\t\t\t\t\t\t\trepo: gitUri.repoPath,\n\t\t\t\t\t\t\treference: args?.reference ?? 'HEAD',\n\t\t\t\t\t\t\tfileName: gitUri.relativePath,\n\t\t\t\t\t  }\n\t\t\t\t\t: {},\n\t\t}));\n\t}\n}\n","import { executeGitCommand } from '../commands/gitCommands.actions';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { Command } from './base';\n\nexport interface ShowQuickRepoStatusCommandArgs {\n\trepoPath?: string;\n}\n\n@command()\nexport class ShowQuickRepoStatusCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.ShowQuickRepoStatus);\n\t}\n\n\tasync execute(args?: ShowQuickRepoStatusCommandArgs) {\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'status',\n\t\t\tstate: {\n\t\t\t\trepo: args?.repoPath,\n\t\t\t},\n\t\t});\n\t}\n}\n","import { executeGitCommand } from '../commands/gitCommands.actions';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { Command } from './base';\n\nexport interface ShowQuickStashListCommandArgs {\n\trepoPath?: string;\n}\n\n@command()\nexport class ShowQuickStashListCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.ShowQuickStashList);\n\t}\n\n\texecute(args?: ShowQuickStashListCommandArgs) {\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'stash',\n\t\t\tstate: {\n\t\t\t\tsubcommand: 'list',\n\t\t\t\trepo: args?.repoPath,\n\t\t\t},\n\t\t});\n\t}\n}\n","import { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { Command, CommandContext } from './base';\n\n@command()\nexport class ShowViewCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([\n\t\t\tCommands.ShowBranchesView,\n\t\t\tCommands.ShowCommitsView,\n\t\t\tCommands.ShowContributorsView,\n\t\t\tCommands.ShowFileHistoryView,\n\t\t\tCommands.ShowLineHistoryView,\n\t\t\tCommands.ShowRemotesView,\n\t\t\tCommands.ShowRepositoriesView,\n\t\t\tCommands.ShowSearchAndCompareView,\n\t\t\tCommands.ShowStashesView,\n\t\t\tCommands.ShowTagsView,\n\t\t\tCommands.ShowTimelineView,\n\t\t\tCommands.ShowWorktreesView,\n\t\t\tCommands.ShowHomeView,\n\t\t]);\n\t}\n\n\tprotected override preExecute(context: CommandContext) {\n\t\treturn this.execute(context.command as Commands);\n\t}\n\n\tasync execute(command: Commands) {\n\t\tswitch (command) {\n\t\t\tcase Commands.ShowBranchesView:\n\t\t\t\treturn this.container.branchesView.show();\n\t\t\tcase Commands.ShowCommitsView:\n\t\t\t\treturn this.container.commitsView.show();\n\t\t\tcase Commands.ShowContributorsView:\n\t\t\t\treturn this.container.contributorsView.show();\n\t\t\tcase Commands.ShowFileHistoryView:\n\t\t\t\treturn this.container.fileHistoryView.show();\n\t\t\tcase Commands.ShowHomeView:\n\t\t\t\treturn this.container.homeView.show();\n\t\t\tcase Commands.ShowLineHistoryView:\n\t\t\t\treturn this.container.lineHistoryView.show();\n\t\t\tcase Commands.ShowRemotesView:\n\t\t\t\treturn this.container.remotesView.show();\n\t\t\tcase Commands.ShowRepositoriesView:\n\t\t\t\treturn this.container.repositoriesView.show();\n\t\t\tcase Commands.ShowSearchAndCompareView:\n\t\t\t\treturn this.container.searchAndCompareView.show();\n\t\t\tcase Commands.ShowStashesView:\n\t\t\t\treturn this.container.stashesView.show();\n\t\t\tcase Commands.ShowTagsView:\n\t\t\t\treturn this.container.tagsView.show();\n\t\t\tcase Commands.ShowTimelineView:\n\t\t\t\treturn this.container.timelineView.show();\n\t\t\tcase Commands.ShowWorktreesView:\n\t\t\t\treturn this.container.worktreesView.show();\n\t\t}\n\n\t\treturn Promise.resolve(undefined);\n\t}\n}\n","import { GitActions } from '../commands/gitCommands.actions';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitStashCommit, GitStashReference } from '../git/models';\nimport { CommandQuickPickItem } from '../quickpicks/items/common';\nimport { command } from '../system/command';\nimport {\n\tCommand,\n\tCommandContext,\n\tisCommandContextViewNodeHasCommit,\n\tisCommandContextViewNodeHasRepository,\n} from './base';\n\nexport interface StashApplyCommandArgs {\n\tdeleteAfter?: boolean;\n\trepoPath?: string;\n\tstashItem?: GitStashReference & { message: string | undefined };\n\n\tgoBackCommand?: CommandQuickPickItem;\n}\n\n@command()\nexport class StashApplyCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.StashApply);\n\t}\n\n\tprotected override async preExecute(context: CommandContext, args?: StashApplyCommandArgs) {\n\t\tif (isCommandContextViewNodeHasCommit<GitStashCommit>(context)) {\n\t\t\tif (context.node.commit.message == null) {\n\t\t\t\tawait context.node.commit.ensureFullDetails();\n\t\t\t}\n\t\t\targs = { ...args, stashItem: context.node.commit };\n\t\t} else if (isCommandContextViewNodeHasRepository(context)) {\n\t\t\targs = { ...args, repoPath: context.node.repo.path };\n\t\t}\n\n\t\treturn this.execute(args);\n\t}\n\n\tasync execute(args?: StashApplyCommandArgs) {\n\t\tif (args?.deleteAfter) {\n\t\t\treturn GitActions.Stash.pop(args?.repoPath ?? args?.stashItem?.repoPath, args?.stashItem);\n\t\t}\n\n\t\treturn GitActions.Stash.apply(args?.repoPath ?? args?.stashItem?.repoPath, args?.stashItem);\n\t}\n}\n","import { Uri } from 'vscode';\nimport type { ScmResource } from '../@types/vscode.git.resources';\nimport { ScmResourceGroupType } from '../@types/vscode.git.resources.enums';\nimport { GitActions } from '../commands/gitCommands.actions';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { command } from '../system/command';\nimport {\n\tCommand,\n\tCommandContext,\n\tisCommandContextViewNodeHasFile,\n\tisCommandContextViewNodeHasRepoPath,\n\tisCommandContextViewNodeHasRepository,\n} from './base';\n\nexport interface StashSaveCommandArgs {\n\tmessage?: string;\n\trepoPath?: string;\n\turis?: Uri[];\n\tkeepStaged?: boolean;\n}\n\n@command()\nexport class StashSaveCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.StashSave, Commands.StashSaveFiles]);\n\t}\n\n\tprotected override async preExecute(context: CommandContext, args?: StashSaveCommandArgs) {\n\t\tif (isCommandContextViewNodeHasFile(context)) {\n\t\t\targs = { ...args };\n\t\t\targs.repoPath = context.node.file.repoPath ?? context.node.repoPath;\n\t\t\targs.uris = [GitUri.fromFile(context.node.file, args.repoPath)];\n\t\t} else if (isCommandContextViewNodeHasRepository(context)) {\n\t\t\targs = { ...args };\n\t\t\targs.repoPath = context.node.repo.path;\n\t\t} else if (isCommandContextViewNodeHasRepoPath(context)) {\n\t\t\targs = { ...args };\n\t\t\targs.repoPath = context.node.repoPath;\n\t\t} else if (context.type === 'scm-states') {\n\t\t\targs = { ...args };\n\t\t\targs.uris = context.scmResourceStates.map(s => s.resourceUri);\n\t\t\targs.repoPath = (await this.container.git.getOrOpenRepository(args.uris[0]))?.path;\n\n\t\t\tconst status = await this.container.git.getStatusForRepo(args.repoPath);\n\t\t\tif (status?.computeWorkingTreeStatus().staged) {\n\t\t\t\tif (\n\t\t\t\t\t!context.scmResourceStates.some(\n\t\t\t\t\t\ts => (s as ScmResource).resourceGroupType === ScmResourceGroupType.Index,\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\targs.keepStaged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (context.type === 'scm-groups') {\n\t\t\targs = { ...args };\n\t\t\targs.uris = context.scmResourceGroups.reduce<Uri[]>(\n\t\t\t\t(a, b) => a.concat(b.resourceStates.map(s => s.resourceUri)),\n\t\t\t\t[],\n\t\t\t);\n\t\t\targs.repoPath = (await this.container.git.getOrOpenRepository(args.uris[0]))?.path;\n\n\t\t\tconst status = await this.container.git.getStatusForRepo(args.repoPath);\n\t\t\tif (status?.computeWorkingTreeStatus().staged) {\n\t\t\t\tif (!context.scmResourceGroups.some(g => g.id === 'index')) {\n\t\t\t\t\targs.keepStaged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.execute(args);\n\t}\n\n\texecute(args?: StashSaveCommandArgs) {\n\t\treturn GitActions.Stash.push(args?.repoPath, args?.uris, args?.message, args?.keepStaged);\n\t}\n}\n","import { QuickPickItem, window } from 'vscode';\nimport { GlyphChars } from '../constants';\nimport { Container } from '../container';\n\nexport interface ModesQuickPickItem extends QuickPickItem {\n\tkey: string | undefined;\n}\n\nexport namespace ModePicker {\n\texport async function show(): Promise<ModesQuickPickItem | undefined> {\n\t\tif (Container.instance.config.modes == null) return undefined;\n\n\t\tconst modes = Container.instance.config.modes;\n\t\tconst modeKeys = Object.keys(modes);\n\t\tif (modeKeys.length === 0) return undefined;\n\n\t\tconst mode = Container.instance.config.mode.active;\n\n\t\tconst items = modeKeys.map(key => {\n\t\t\tconst modeCfg = modes[key];\n\t\t\tconst item: ModesQuickPickItem = {\n\t\t\t\tlabel: `${mode === key ? '$(check)\\u00a0\\u00a0' : '\\u00a0\\u00a0\\u00a0\\u00a0\\u00a0'}${\n\t\t\t\t\tmodeCfg.name\n\t\t\t\t} mode`,\n\t\t\t\tdescription: modeCfg.description ? `\\u00a0${GlyphChars.Dash}\\u00a0 ${modeCfg.description}` : '',\n\t\t\t\tkey: key,\n\t\t\t};\n\t\t\treturn item;\n\t\t});\n\n\t\tif (mode) {\n\t\t\titems.splice(0, 0, {\n\t\t\t\tlabel: `Exit ${modes[mode].name} mode`,\n\t\t\t\tkey: undefined,\n\t\t\t});\n\t\t}\n\n\t\tconst pick = await window.showQuickPick(items, {\n\t\t\tplaceHolder: 'select a GitLens mode to enter',\n\t\t});\n\n\t\treturn pick;\n\t}\n}\n","import { ConfigurationTarget } from 'vscode';\nimport { configuration } from '../configuration';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { Logger } from '../logger';\nimport { ModePicker } from '../quickpicks/modePicker';\nimport { command } from '../system/command';\nimport { log } from '../system/decorators/log';\nimport { Command } from './base';\n\n@command()\nexport class SwitchModeCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.SwitchMode);\n\t}\n\n\t@log({ args: false, correlate: true, singleLine: true, timed: false })\n\tasync execute() {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst pick = await ModePicker.show();\n\t\tif (pick === undefined) return;\n\n\t\tif (cc != null) {\n\t\t\tcc.exitDetails = ` \\u2014 mode=${pick.key ?? ''}`;\n\t\t}\n\n\t\tconst active = this.container.config.mode.active;\n\t\tif (active === pick.key) return;\n\n\t\t// Check if we have applied any annotations and clear them if we won't be applying them again\n\t\tif (active != null && active.length !== 0) {\n\t\t\tconst activeAnnotations = this.container.config.modes?.[active].annotations;\n\t\t\tif (activeAnnotations != null) {\n\t\t\t\tconst newAnnotations =\n\t\t\t\t\tpick.key != null ? this.container.config.modes?.[pick.key].annotations : undefined;\n\t\t\t\tif (activeAnnotations !== newAnnotations) {\n\t\t\t\t\tawait this.container.fileAnnotations.clearAll();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait configuration.update('mode.active', pick.key, ConfigurationTarget.Global);\n\t}\n}\n\n@command()\nexport class ToggleReviewModeCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.ToggleReviewMode);\n\t}\n\n\t@log({ args: false, singleLine: true, timed: false })\n\tasync execute() {\n\t\tif (this.container.config.modes == null || !Object.keys(this.container.config.modes).includes('review')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst mode = this.container.config.mode.active === 'review' ? undefined : 'review';\n\t\tawait configuration.update('mode.active', mode, ConfigurationTarget.Global);\n\t}\n}\n\n@command()\nexport class ToggleZenModeCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.ToggleZenMode);\n\t}\n\n\t@log({ args: false, singleLine: true, timed: false })\n\tasync execute() {\n\t\tif (this.container.config.modes == null || !Object.keys(this.container.config.modes).includes('zen')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst mode = this.container.config.mode.active === 'zen' ? undefined : 'zen';\n\t\tawait configuration.update('mode.active', mode, ConfigurationTarget.Global);\n\t}\n}\n","import { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { Command } from './base';\n\n@command()\nexport class ToggleCodeLensCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.ToggleCodeLens);\n\t}\n\n\texecute() {\n\t\treturn this.container.codeLens.toggleCodeLens();\n\t}\n}\n","import { TextEditor, TextEditorEdit, Uri, window } from 'vscode';\nimport { AnnotationContext } from '../annotations/annotationProvider';\nimport { ChangesAnnotationContext } from '../annotations/gutterChangesAnnotationProvider';\nimport { UriComparer } from '../comparers';\nimport { FileAnnotationType } from '../configuration';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { Logger } from '../logger';\nimport { Messages } from '../messages';\nimport { command } from '../system/command';\nimport { isTextEditor } from '../system/utils';\nimport { ActiveEditorCommand, EditorCommand } from './base';\n\n@command()\nexport class ClearFileAnnotationsCommand extends EditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.ClearFileAnnotations, Commands.ComputingFileAnnotations]);\n\t}\n\n\tasync execute(editor: TextEditor, edit: TextEditorEdit, uri?: Uri): Promise<void> {\n\t\t// Handle the case where we are focused on a non-editor editor (output, debug console)\n\t\tif (editor != null && !isTextEditor(editor)) {\n\t\t\tif (uri != null && !UriComparer.equals(uri, editor.document.uri)) {\n\t\t\t\tconst e = window.visibleTextEditors.find(e => UriComparer.equals(uri, e.document.uri));\n\t\t\t\tif (e != null) {\n\t\t\t\t\teditor = e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tvoid (await this.container.fileAnnotations.clear(editor));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'ClearFileAnnotationsCommand');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to clear file annotations');\n\t\t}\n\t}\n}\n\nexport interface ToggleFileBlameAnnotationCommandArgs {\n\ttype: FileAnnotationType.Blame;\n\tcontext?: AnnotationContext;\n\ton?: boolean;\n}\n\nexport interface ToggleFileChangesAnnotationCommandArgs {\n\ttype: FileAnnotationType.Changes;\n\tcontext?: ChangesAnnotationContext;\n\ton?: boolean;\n}\n\nexport interface ToggleFileHeatmapAnnotationCommandArgs {\n\ttype: FileAnnotationType.Heatmap;\n\tcontext?: AnnotationContext;\n\ton?: boolean;\n}\n\nexport type ToggleFileAnnotationCommandArgs =\n\t| ToggleFileBlameAnnotationCommandArgs\n\t| ToggleFileChangesAnnotationCommandArgs\n\t| ToggleFileHeatmapAnnotationCommandArgs;\n\n@command()\nexport class ToggleFileBlameCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([Commands.ToggleFileBlame, Commands.ToggleFileBlameInDiffLeft, Commands.ToggleFileBlameInDiffRight]);\n\t}\n\n\texecute(editor: TextEditor, uri?: Uri, args?: ToggleFileBlameAnnotationCommandArgs): Promise<void> {\n\t\treturn toggleFileAnnotations<ToggleFileBlameAnnotationCommandArgs>(this.container, editor, uri, {\n\t\t\t...args,\n\t\t\ttype: FileAnnotationType.Blame,\n\t\t});\n\t}\n}\n\n@command()\nexport class ToggleFileChangesCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.ToggleFileChanges);\n\t}\n\n\texecute(editor: TextEditor, uri?: Uri, args?: ToggleFileChangesAnnotationCommandArgs): Promise<void> {\n\t\treturn toggleFileAnnotations<ToggleFileChangesAnnotationCommandArgs>(this.container, editor, uri, {\n\t\t\t...args,\n\t\t\ttype: FileAnnotationType.Changes,\n\t\t});\n\t}\n}\n\n@command()\nexport class ToggleFileHeatmapCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper([\n\t\t\tCommands.ToggleFileHeatmap,\n\t\t\tCommands.ToggleFileHeatmapInDiffLeft,\n\t\t\tCommands.ToggleFileHeatmapInDiffRight,\n\t\t]);\n\t}\n\n\texecute(editor: TextEditor, uri?: Uri, args?: ToggleFileHeatmapAnnotationCommandArgs): Promise<void> {\n\t\treturn toggleFileAnnotations<ToggleFileHeatmapAnnotationCommandArgs>(this.container, editor, uri, {\n\t\t\t...args,\n\t\t\ttype: FileAnnotationType.Heatmap,\n\t\t});\n\t}\n}\n\nasync function toggleFileAnnotations<TArgs extends ToggleFileAnnotationCommandArgs>(\n\tcontainer: Container,\n\teditor: TextEditor,\n\turi: Uri | undefined,\n\targs: TArgs,\n): Promise<void> {\n\t// Handle the case where we are focused on a non-editor editor (output, debug console)\n\tif (editor != null && !isTextEditor(editor)) {\n\t\tif (uri != null && !UriComparer.equals(uri, editor.document.uri)) {\n\t\t\tconst e = window.visibleTextEditors.find(e => UriComparer.equals(uri, e.document.uri));\n\t\t\tif (e != null) {\n\t\t\t\teditor = e;\n\t\t\t}\n\t\t}\n\t}\n\n\ttry {\n\t\targs = { type: FileAnnotationType.Blame, ...(args as any) };\n\n\t\tvoid (await container.fileAnnotations.toggle(\n\t\t\teditor,\n\t\t\targs.type,\n\t\t\t{\n\t\t\t\tselection: args.context?.selection ?? { line: editor?.selection.active.line },\n\t\t\t\t...args.context,\n\t\t\t},\n\t\t\targs.on,\n\t\t));\n\t} catch (ex) {\n\t\tLogger.error(ex, 'ToggleFileAnnotationsCommand');\n\t\tvoid window.showErrorMessage(\n\t\t\t`Unable to toggle file ${args.type} annotations. See output channel for more details`,\n\t\t);\n\t}\n}\n","import { TextEditor, Uri, window } from 'vscode';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { Logger } from '../logger';\nimport { command } from '../system/command';\nimport { ActiveEditorCommand } from './base';\n\n@command()\nexport class ToggleLineBlameCommand extends ActiveEditorCommand {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.ToggleLineBlame);\n\t}\n\n\tasync execute(editor: TextEditor, _uri?: Uri): Promise<void> {\n\t\ttry {\n\t\t\tvoid (await this.container.lineAnnotations.toggle(editor));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'ToggleLineBlameCommand');\n\t\t\tvoid window.showErrorMessage(\n\t\t\t\t'Unable to toggle line blame annotations. See output channel for more details',\n\t\t\t);\n\t\t}\n\t}\n}\n","import { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { command } from '../system/command';\nimport { openWalkthrough } from '../system/utils';\nimport { Command } from './base';\n\n@command()\nexport class GetStartedCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.GetStarted);\n\t}\n\n\texecute(walkthroughId?: string) {\n\t\tconst extensionId = this.container.context.extension.id;\n\t\t// If the walkthroughId param is the same as the extension id, then this was run from the extensions view gear menu\n\t\tif (walkthroughId === extensionId) {\n\t\t\twalkthroughId = undefined;\n\t\t}\n\n\t\tvoid openWalkthrough(extensionId, walkthroughId ?? 'gitlens.welcome');\n\t}\n}\n\n@command()\nexport class OpenWalkthroughCommand extends Command {\n\tconstructor(private readonly container: Container) {\n\t\tsuper(Commands.OpenWalkthrough);\n\t}\n\n\texecute(walkthroughAndStep?: string) {\n\t\tconst [walkthroughId, stepId] = walkthroughAndStep?.split('|') ?? 'gitlens.welcome';\n\t\tvoid openWalkthrough(this.container.context.extension.id, walkthroughId, stepId);\n\t}\n}\n","import {\n\tcommands,\n\tDisposable,\n\tGitTimelineItem,\n\tSourceControlResourceGroup,\n\tSourceControlResourceState,\n\tTextEditor,\n\tTextEditorEdit,\n\tTimelineItem,\n\tUri,\n\twindow,\n} from 'vscode';\nimport type { ActionContext } from '../api/gitlens';\nimport { Commands } from '../constants';\nimport {\n\tGitBranch,\n\tGitCommit,\n\tGitContributor,\n\tGitFile,\n\tGitReference,\n\tGitRemote,\n\tGitStashCommit,\n\tGitTag,\n\tRepository,\n} from '../git/models';\nimport { ViewNode, ViewRefNode } from '../views/nodes';\n\nexport function getCommandUri(uri?: Uri, editor?: TextEditor): Uri | undefined {\n\t// Always use the editor.uri (if we have one), so we are correct for a split diff\n\treturn editor?.document?.uri ?? uri;\n}\n\nexport interface CommandContextParsingOptions {\n\texpectsEditor: boolean;\n}\n\nexport interface CommandBaseContext {\n\tcommand: string;\n\teditor?: TextEditor;\n\turi?: Uri;\n}\n\nexport interface CommandGitTimelineItemContext extends CommandBaseContext {\n\treadonly type: 'timeline-item:git';\n\treadonly item: GitTimelineItem;\n\treadonly uri: Uri;\n}\n\nexport interface CommandScmGroupsContext extends CommandBaseContext {\n\treadonly type: 'scm-groups';\n\treadonly scmResourceGroups: SourceControlResourceGroup[];\n}\n\nexport interface CommandScmStatesContext extends CommandBaseContext {\n\treadonly type: 'scm-states';\n\treadonly scmResourceStates: SourceControlResourceState[];\n}\n\nexport interface CommandUnknownContext extends CommandBaseContext {\n\treadonly type: 'unknown';\n}\n\nexport interface CommandUriContext extends CommandBaseContext {\n\treadonly type: 'uri';\n}\n\nexport interface CommandUrisContext extends CommandBaseContext {\n\treadonly type: 'uris';\n\treadonly uris: Uri[];\n}\n\n// export interface CommandViewContext extends CommandBaseContext {\n//     readonly type: 'view';\n// }\n\nexport interface CommandViewNodeContext extends CommandBaseContext {\n\treadonly type: 'viewItem';\n\treadonly node: ViewNode;\n}\n\nexport function isCommandContextGitTimelineItem(context: CommandContext): context is CommandGitTimelineItemContext {\n\treturn context.type === 'timeline-item:git';\n}\n\nexport function isCommandContextViewNodeHasBranch(\n\tcontext: CommandContext,\n): context is CommandViewNodeContext & { node: ViewNode & { branch: GitBranch } } {\n\tif (context.type !== 'viewItem') return false;\n\n\treturn GitBranch.is((context.node as ViewNode & { branch: GitBranch }).branch);\n}\n\nexport function isCommandContextViewNodeHasCommit<T extends GitCommit | GitStashCommit>(\n\tcontext: CommandContext,\n): context is CommandViewNodeContext & { node: ViewNode & { commit: T } } {\n\tif (context.type !== 'viewItem') return false;\n\n\treturn GitCommit.is((context.node as ViewNode & { commit: GitCommit | GitStashCommit }).commit);\n}\n\nexport function isCommandContextViewNodeHasContributor(\n\tcontext: CommandContext,\n): context is CommandViewNodeContext & { node: ViewNode & { contributor: GitContributor } } {\n\tif (context.type !== 'viewItem') return false;\n\n\treturn GitContributor.is((context.node as ViewNode & { contributor: GitContributor }).contributor);\n}\n\nexport function isCommandContextViewNodeHasFile(\n\tcontext: CommandContext,\n): context is CommandViewNodeContext & { node: ViewNode & { file: GitFile; repoPath: string } } {\n\tif (context.type !== 'viewItem') return false;\n\n\tconst node = context.node as ViewNode & { file: GitFile; repoPath: string };\n\treturn node.file != null && (node.file.repoPath != null || node.repoPath != null);\n}\n\nexport function isCommandContextViewNodeHasFileCommit(\n\tcontext: CommandContext,\n): context is CommandViewNodeContext & { node: ViewNode & { commit: GitCommit; file: GitFile; repoPath: string } } {\n\tif (context.type !== 'viewItem') return false;\n\n\tconst node = context.node as ViewNode & { commit: GitCommit; file: GitFile; repoPath: string };\n\treturn node.file != null && GitCommit.is(node.commit) && (node.file.repoPath != null || node.repoPath != null);\n}\n\nexport function isCommandContextViewNodeHasFileRefs(context: CommandContext): context is CommandViewNodeContext & {\n\tnode: ViewNode & { file: GitFile; ref1: string; ref2: string; repoPath: string };\n} {\n\tif (context.type !== 'viewItem') return false;\n\n\tconst node = context.node as ViewNode & { file: GitFile; ref1: string; ref2: string; repoPath: string };\n\treturn (\n\t\tnode.file != null &&\n\t\tnode.ref1 != null &&\n\t\tnode.ref2 != null &&\n\t\t(node.file.repoPath != null || node.repoPath != null)\n\t);\n}\n\nexport function isCommandContextViewNodeHasRef(\n\tcontext: CommandContext,\n): context is CommandViewNodeContext & { node: ViewNode & { ref: GitReference } } {\n\treturn context.type === 'viewItem' && context.node instanceof ViewRefNode;\n}\n\nexport function isCommandContextViewNodeHasRemote(\n\tcontext: CommandContext,\n): context is CommandViewNodeContext & { node: ViewNode & { remote: GitRemote } } {\n\tif (context.type !== 'viewItem') return false;\n\n\treturn GitRemote.is((context.node as ViewNode & { remote: GitRemote }).remote);\n}\n\nexport function isCommandContextViewNodeHasRepository(\n\tcontext: CommandContext,\n): context is CommandViewNodeContext & { node: ViewNode & { repo: Repository } } {\n\tif (context.type !== 'viewItem') return false;\n\n\treturn (context.node as ViewNode & { repo?: Repository }).repo instanceof Repository;\n}\n\nexport function isCommandContextViewNodeHasRepoPath(\n\tcontext: CommandContext,\n): context is CommandViewNodeContext & { node: ViewNode & { repoPath: string } } {\n\tif (context.type !== 'viewItem') return false;\n\n\treturn typeof (context.node as ViewNode & { repoPath?: string }).repoPath === 'string';\n}\n\nexport function isCommandContextViewNodeHasTag(\n\tcontext: CommandContext,\n): context is CommandViewNodeContext & { node: ViewNode & { tag: GitTag } } {\n\tif (context.type !== 'viewItem') return false;\n\n\treturn GitTag.is((context.node as ViewNode & { tag: GitTag }).tag);\n}\n\nexport type CommandContext =\n\t| CommandGitTimelineItemContext\n\t| CommandScmGroupsContext\n\t| CommandScmStatesContext\n\t| CommandUnknownContext\n\t| CommandUriContext\n\t| CommandUrisContext\n\t// | CommandViewContext\n\t| CommandViewNodeContext;\n\nfunction isScmResourceGroup(group: any): group is SourceControlResourceGroup {\n\tif (group == null) return false;\n\n\treturn (\n\t\t(group as SourceControlResourceGroup).id != null &&\n\t\t(group as SourceControlResourceGroup).label != null &&\n\t\t(group as SourceControlResourceGroup).resourceStates != null &&\n\t\tArray.isArray((group as SourceControlResourceGroup).resourceStates)\n\t);\n}\n\nfunction isScmResourceState(resource: any): resource is SourceControlResourceState {\n\tif (resource == null) return false;\n\n\treturn (resource as SourceControlResourceState).resourceUri != null;\n}\n\nfunction isTimelineItem(item: any): item is TimelineItem {\n\tif (item == null) return false;\n\n\treturn (item as TimelineItem).timestamp != null && (item as TimelineItem).label != null;\n}\n\nfunction isGitTimelineItem(item: any): item is GitTimelineItem {\n\tif (item == null) return false;\n\n\treturn (\n\t\tisTimelineItem(item) &&\n\t\t(item as GitTimelineItem).ref != null &&\n\t\t(item as GitTimelineItem).previousRef != null &&\n\t\t(item as GitTimelineItem).message != null\n\t);\n}\n\nexport abstract class Command implements Disposable {\n\tstatic getMarkdownCommandArgsCore<T>(\n\t\tcommand: Commands | `${Commands.ActionPrefix}${ActionContext['type']}`,\n\t\targs: T,\n\t): string {\n\t\treturn `command:${command}?${encodeURIComponent(JSON.stringify(args))}`;\n\t}\n\n\tprotected readonly contextParsingOptions: CommandContextParsingOptions = { expectsEditor: false };\n\n\tprivate readonly _disposable: Disposable;\n\n\tconstructor(command: Commands | Commands[]) {\n\t\tif (typeof command === 'string') {\n\t\t\tthis._disposable = commands.registerCommand(\n\t\t\t\tcommand,\n\t\t\t\t(...args: any[]) => this._execute(command, ...args),\n\t\t\t\tthis,\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst subscriptions = command.map(cmd =>\n\t\t\tcommands.registerCommand(cmd, (...args: any[]) => this._execute(cmd, ...args), this),\n\t\t);\n\t\tthis._disposable = Disposable.from(...subscriptions);\n\t}\n\n\tdispose() {\n\t\tthis._disposable.dispose();\n\t}\n\n\tprotected preExecute(context: CommandContext, ...args: any[]): Promise<any> {\n\t\treturn this.execute(...args);\n\t}\n\n\tabstract execute(...args: any[]): any;\n\n\tprotected _execute(command: string, ...args: any[]): any {\n\t\tconst [context, rest] = Command.parseContext(command, { ...this.contextParsingOptions }, ...args);\n\t\treturn this.preExecute(context, ...rest);\n\t}\n\n\tprivate static parseContext(\n\t\tcommand: string,\n\t\toptions: CommandContextParsingOptions,\n\t\t...args: any[]\n\t): [CommandContext, any[]] {\n\t\tlet editor: TextEditor | undefined = undefined;\n\n\t\tlet firstArg = args[0];\n\n\t\tif (options.expectsEditor) {\n\t\t\tif (firstArg == null || (firstArg.id != null && firstArg.document?.uri != null)) {\n\t\t\t\teditor = firstArg;\n\t\t\t\targs = args.slice(1);\n\t\t\t\tfirstArg = args[0];\n\t\t\t}\n\n\t\t\tif (args.length > 0 && (firstArg == null || firstArg instanceof Uri)) {\n\t\t\t\tconst [uri, ...rest] = args as [Uri, any];\n\t\t\t\tif (uri != null) {\n\t\t\t\t\t// If the uri matches the active editor (or we are in a left-hand side of a diff), then pass the active editor\n\t\t\t\t\tif (\n\t\t\t\t\t\teditor == null &&\n\t\t\t\t\t\t(uri.toString() === window.activeTextEditor?.document.uri.toString() ||\n\t\t\t\t\t\t\tcommand.endsWith('InDiffLeft'))\n\t\t\t\t\t) {\n\t\t\t\t\t\teditor = window.activeTextEditor;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst uris = rest[0];\n\t\t\t\t\tif (uris != null && Array.isArray(uris) && uris.length !== 0 && uris[0] instanceof Uri) {\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t{ command: command, type: 'uris', editor: editor, uri: uri, uris: uris },\n\t\t\t\t\t\t\trest.slice(1),\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\t\t\t\t\treturn [{ command: command, type: 'uri', editor: editor, uri: uri }, rest];\n\t\t\t\t}\n\n\t\t\t\targs = args.slice(1);\n\t\t\t} else if (editor == null) {\n\t\t\t\t// If we are expecting an editor and we have no uri, then pass the active editor\n\t\t\t\teditor = window.activeTextEditor;\n\t\t\t}\n\t\t}\n\n\t\tif (firstArg instanceof ViewNode) {\n\t\t\tconst [node, ...rest] = args as [ViewNode, any];\n\t\t\treturn [{ command: command, type: 'viewItem', node: node, uri: node.uri }, rest];\n\t\t}\n\n\t\tif (isScmResourceState(firstArg)) {\n\t\t\tconst states = [];\n\t\t\tlet count = 0;\n\t\t\tfor (const arg of args) {\n\t\t\t\tif (!isScmResourceState(arg)) break;\n\n\t\t\t\tcount++;\n\t\t\t\tstates.push(arg);\n\t\t\t}\n\n\t\t\treturn [\n\t\t\t\t{ command: command, type: 'scm-states', scmResourceStates: states, uri: states[0].resourceUri },\n\t\t\t\targs.slice(count),\n\t\t\t];\n\t\t}\n\n\t\tif (isScmResourceGroup(firstArg)) {\n\t\t\tconst groups = [];\n\t\t\tlet count = 0;\n\t\t\tfor (const arg of args) {\n\t\t\t\tif (!isScmResourceGroup(arg)) break;\n\n\t\t\t\tcount++;\n\t\t\t\tgroups.push(arg);\n\t\t\t}\n\n\t\t\treturn [{ command: command, type: 'scm-groups', scmResourceGroups: groups }, args.slice(count)];\n\t\t}\n\n\t\tif (isGitTimelineItem(firstArg)) {\n\t\t\tconst [item, uri, ...rest] = args as [GitTimelineItem, Uri, any];\n\t\t\treturn [{ command: command, type: 'timeline-item:git', item: item, uri: uri }, rest];\n\t\t}\n\n\t\treturn [{ command: command, type: 'unknown', editor: editor, uri: editor?.document.uri }, args];\n\t}\n}\n\nexport abstract class ActiveEditorCommand extends Command {\n\tprotected override readonly contextParsingOptions: CommandContextParsingOptions = { expectsEditor: true };\n\n\tconstructor(command: Commands | Commands[]) {\n\t\tsuper(command);\n\t}\n\n\tprotected override preExecute(context: CommandContext, ...args: any[]): Promise<any> {\n\t\treturn this.execute(context.editor, context.uri, ...args);\n\t}\n\n\tprotected override _execute(command: string, ...args: any[]): any {\n\t\treturn super._execute(command, undefined, ...args);\n\t}\n\n\tabstract override execute(editor?: TextEditor, ...args: any[]): any;\n}\n\nlet lastCommand: { command: string; args: any[] } | undefined = undefined;\nexport function getLastCommand() {\n\treturn lastCommand;\n}\n\nexport abstract class ActiveEditorCachedCommand extends ActiveEditorCommand {\n\tconstructor(command: Commands | Commands[]) {\n\t\tsuper(command);\n\t}\n\n\tprotected override _execute(command: string, ...args: any[]): any {\n\t\tlastCommand = {\n\t\t\tcommand: command,\n\t\t\targs: args,\n\t\t};\n\t\treturn super._execute(command, ...args);\n\t}\n\n\tabstract override execute(editor: TextEditor, ...args: any[]): any;\n}\n\nexport abstract class EditorCommand implements Disposable {\n\tprivate readonly _disposable: Disposable;\n\n\tconstructor(command: Commands | Commands[]) {\n\t\tif (!Array.isArray(command)) {\n\t\t\tcommand = [command];\n\t\t}\n\n\t\tconst subscriptions = [];\n\t\tfor (const cmd of command) {\n\t\t\tsubscriptions.push(\n\t\t\t\tcommands.registerTextEditorCommand(\n\t\t\t\t\tcmd,\n\t\t\t\t\t(editor: TextEditor, edit: TextEditorEdit, ...args: any[]) =>\n\t\t\t\t\t\tthis.executeCore(cmd, editor, edit, ...args),\n\t\t\t\t\tthis,\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t\tthis._disposable = Disposable.from(...subscriptions);\n\t}\n\n\tdispose() {\n\t\tthis._disposable.dispose();\n\t}\n\n\tprivate executeCore(command: string, editor: TextEditor, edit: TextEditorEdit, ...args: any[]): any {\n\t\treturn this.execute(editor, edit, ...args);\n\t}\n\n\tabstract execute(editor: TextEditor, edit: TextEditorEdit, ...args: any[]): any;\n}\n","import { env, Range, TextDocumentShowOptions, Uri, window } from 'vscode';\nimport type {\n\tBrowseRepoAtRevisionCommandArgs,\n\tDiffWithCommandArgs,\n\tDiffWithWorkingCommandArgs,\n\tGitCommandsCommandArgs,\n\tOpenWorkingFileCommandArgs,\n} from '../commands';\nimport { FileAnnotationType } from '../configuration';\nimport { Commands, CoreCommands } from '../constants';\nimport { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport {\n\tGitBranchReference,\n\tGitCommit,\n\tGitContributor,\n\tGitFile,\n\tGitReference,\n\tGitRemote,\n\tGitRevision,\n\tGitRevisionReference,\n\tGitStashReference,\n\tGitTagReference,\n\tGitWorktree,\n\tRepository,\n} from '../git/models';\nimport { RepositoryPicker } from '../quickpicks/repositoryPicker';\nimport { ensure } from '../system/array';\nimport { executeCommand, executeCoreCommand, executeEditorCommand } from '../system/command';\nimport { findOrOpenEditor, findOrOpenEditors, openWorkspace, OpenWorkspaceLocation } from '../system/utils';\nimport { ViewsWithRepositoryFolders } from '../views/viewBase';\nimport { ResetGitCommandArgs } from './git/reset';\n\nexport async function executeGitCommand(args: GitCommandsCommandArgs): Promise<void> {\n\tvoid (await executeCommand<GitCommandsCommandArgs>(Commands.GitCommands, args));\n}\n\nfunction ensureRepo(repo: string | Repository): Repository {\n\tconst repository = typeof repo === 'string' ? Container.instance.git.getRepository(repo) : repo;\n\tif (repository == null) throw new Error('Repository not found');\n\treturn repository;\n}\n\nexport namespace GitActions {\n\texport async function browseAtRevision(uri: Uri, options?: { before?: boolean; openInNewWindow?: boolean }) {\n\t\tvoid (await executeEditorCommand<BrowseRepoAtRevisionCommandArgs>(Commands.BrowseRepoAtRevision, undefined, {\n\t\t\turi: uri,\n\t\t\tbefore: options?.before,\n\t\t\topenInNewWindow: options?.openInNewWindow,\n\t\t}));\n\t}\n\n\texport function cherryPick(repo?: string | Repository, refs?: GitRevisionReference | GitRevisionReference[]) {\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'cherry-pick',\n\t\t\tstate: { repo: repo, references: refs },\n\t\t});\n\t}\n\n\texport function fetch(repos?: string | string[] | Repository | Repository[], ref?: GitBranchReference) {\n\t\treturn executeGitCommand({ command: 'fetch', state: { repos: repos, reference: ref } });\n\t}\n\n\texport function merge(repo?: string | Repository, ref?: GitReference) {\n\t\treturn executeGitCommand({ command: 'merge', state: { repo: repo, reference: ref } });\n\t}\n\n\texport function pull(repos?: string | string[] | Repository | Repository[], ref?: GitBranchReference) {\n\t\treturn executeGitCommand({ command: 'pull', state: { repos: repos, reference: ref } });\n\t}\n\n\texport function push(repos?: string | string[] | Repository | Repository[], force?: boolean, ref?: GitReference) {\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'push',\n\t\t\tstate: { repos: repos, flags: force ? ['--force'] : [], reference: ref },\n\t\t});\n\t}\n\n\texport function rebase(repo?: string | Repository, ref?: GitReference, interactive: boolean = true) {\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'rebase',\n\t\t\tstate: { repo: repo, reference: ref, flags: interactive ? ['--interactive'] : [] },\n\t\t});\n\t}\n\n\texport function reset(\n\t\trepo?: string | Repository,\n\t\tref?: GitRevisionReference,\n\t\tflags?: NonNullable<ResetGitCommandArgs['state']>['flags'],\n\t) {\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'reset',\n\t\t\tconfirm: flags == null || flags.includes('--hard'),\n\t\t\tstate: { repo: repo, reference: ref, flags: flags },\n\t\t});\n\t}\n\n\texport function revert(repo?: string | Repository, refs?: GitRevisionReference | GitRevisionReference[]) {\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'revert',\n\t\t\tstate: { repo: repo, references: refs },\n\t\t});\n\t}\n\n\texport function switchTo(repos?: string | string[] | Repository | Repository[], ref?: GitReference) {\n\t\treturn executeGitCommand({\n\t\t\tcommand: 'switch',\n\t\t\tstate: { repos: repos, reference: ref },\n\t\t});\n\t}\n\n\texport namespace Branch {\n\t\texport function create(repo?: string | Repository, ref?: GitReference, name?: string) {\n\t\t\treturn executeGitCommand({\n\t\t\t\tcommand: 'branch',\n\t\t\t\tstate: {\n\t\t\t\t\tsubcommand: 'create',\n\t\t\t\t\trepo: repo,\n\t\t\t\t\treference: ref,\n\t\t\t\t\tname: name,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\texport function remove(repo?: string | Repository, refs?: GitBranchReference | GitBranchReference[]) {\n\t\t\treturn executeGitCommand({\n\t\t\t\tcommand: 'branch',\n\t\t\t\tstate: {\n\t\t\t\t\tsubcommand: 'delete',\n\t\t\t\t\trepo: repo,\n\t\t\t\t\treferences: refs,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\texport function rename(repo?: string | Repository, ref?: GitBranchReference, name?: string) {\n\t\t\treturn executeGitCommand({\n\t\t\t\tcommand: 'branch',\n\t\t\t\tstate: {\n\t\t\t\t\tsubcommand: 'rename',\n\t\t\t\t\trepo: repo,\n\t\t\t\t\treference: ref,\n\t\t\t\t\tname: name,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\texport async function reveal(\n\t\t\tbranch: GitBranchReference,\n\t\t\toptions?: {\n\t\t\t\tselect?: boolean;\n\t\t\t\tfocus?: boolean;\n\t\t\t\texpand?: boolean | number;\n\t\t\t},\n\t\t) {\n\t\t\tconst view = branch.remote ? Container.instance.remotesView : Container.instance.branchesView;\n\t\t\tconst node = view.canReveal\n\t\t\t\t? await view.revealBranch(branch, options)\n\t\t\t\t: await Container.instance.repositoriesView.revealBranch(branch, options);\n\t\t\treturn node;\n\t\t}\n\t}\n\n\texport namespace Commit {\n\t\texport async function applyChanges(\n\t\t\tfile: string | GitFile,\n\t\t\tref1: GitRevisionReference,\n\t\t\tref2?: GitRevisionReference,\n\t\t) {\n\t\t\t// Open the working file to ensure undo will work\n\t\t\tvoid (await GitActions.Commit.openFile(file, ref1, { preserveFocus: true, preview: false }));\n\t\t\tvoid (await Container.instance.git.applyChangesToWorkingFile(\n\t\t\t\tGitUri.fromFile(file, ref1.repoPath, ref1.ref),\n\t\t\t\tref1.ref,\n\t\t\t\tref2?.ref,\n\t\t\t));\n\t\t}\n\n\t\texport async function copyIdToClipboard(ref: { repoPath: string; ref: string } | GitCommit) {\n\t\t\tvoid (await env.clipboard.writeText(ref.ref));\n\t\t}\n\n\t\texport async function copyMessageToClipboard(\n\t\t\tref: { repoPath: string; ref: string } | GitCommit,\n\t\t): Promise<void> {\n\t\t\tlet commit;\n\t\t\tif (GitCommit.is(ref)) {\n\t\t\t\tcommit = ref;\n\t\t\t\tif (commit.message == null) {\n\t\t\t\t\tawait commit.ensureFullDetails();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcommit = await Container.instance.git.getCommit(ref.repoPath, ref.ref);\n\t\t\t\tif (commit == null) return;\n\t\t\t}\n\n\t\t\tconst message = commit.message ?? commit.summary;\n\t\t\tvoid (await env.clipboard.writeText(message));\n\t\t}\n\n\t\texport async function openAllChanges(commit: GitCommit, options?: TextDocumentShowOptions): Promise<void>;\n\t\texport async function openAllChanges(\n\t\t\tfiles: GitFile[],\n\t\t\trefs: { repoPath: string; ref1: string; ref2: string },\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t): Promise<void>;\n\t\texport async function openAllChanges(\n\t\t\tcommitOrFiles: GitCommit | GitFile[],\n\t\t\trefsOrOptions: { repoPath: string; ref1: string; ref2: string } | TextDocumentShowOptions | undefined,\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t) {\n\t\t\tlet files;\n\t\t\tlet refs;\n\t\t\tif (GitCommit.is(commitOrFiles)) {\n\t\t\t\tif (commitOrFiles.files == null) {\n\t\t\t\t\tawait commitOrFiles.ensureFullDetails();\n\t\t\t\t}\n\n\t\t\t\tfiles = commitOrFiles.files ?? [];\n\t\t\t\trefs = {\n\t\t\t\t\trepoPath: commitOrFiles.repoPath,\n\t\t\t\t\t// Don't need to worry about verifying the previous sha, as the DiffWith command will\n\t\t\t\t\tref1: commitOrFiles.unresolvedPreviousSha,\n\t\t\t\t\tref2: commitOrFiles.sha,\n\t\t\t\t};\n\n\t\t\t\toptions = refsOrOptions as TextDocumentShowOptions | undefined;\n\t\t\t} else {\n\t\t\t\tfiles = commitOrFiles;\n\t\t\t\trefs = refsOrOptions as { repoPath: string; ref1: string; ref2: string };\n\t\t\t}\n\n\t\t\tif (files.length > 10) {\n\t\t\t\tconst result = await window.showWarningMessage(\n\t\t\t\t\t`Are your sure you want to open the changes for all ${files.length} files?`,\n\t\t\t\t\t{ title: 'Yes' },\n\t\t\t\t\t{ title: 'No', isCloseAffordance: true },\n\t\t\t\t);\n\t\t\t\tif (result == null || result.title === 'No') return;\n\t\t\t}\n\n\t\t\toptions = { preserveFocus: true, preview: false, ...options };\n\n\t\t\tfor (const file of files) {\n\t\t\t\tawait openChanges(file, refs, options);\n\t\t\t}\n\t\t}\n\n\t\texport async function openAllChangesWithDiffTool(commit: GitCommit): Promise<void>;\n\t\texport async function openAllChangesWithDiffTool(\n\t\t\tfiles: GitFile[],\n\t\t\tref: { repoPath: string; ref: string },\n\t\t): Promise<void>;\n\t\texport async function openAllChangesWithDiffTool(\n\t\t\tcommitOrFiles: GitCommit | GitFile[],\n\t\t\tref?: { repoPath: string; ref: string },\n\t\t) {\n\t\t\tlet files;\n\t\t\tif (GitCommit.is(commitOrFiles)) {\n\t\t\t\tif (commitOrFiles.files == null) {\n\t\t\t\t\tawait commitOrFiles.ensureFullDetails();\n\t\t\t\t}\n\n\t\t\t\tfiles = commitOrFiles.files ?? [];\n\t\t\t\tref = {\n\t\t\t\t\trepoPath: commitOrFiles.repoPath,\n\t\t\t\t\tref: commitOrFiles.sha,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tfiles = commitOrFiles;\n\t\t\t}\n\n\t\t\tif (files.length > 10) {\n\t\t\t\tconst result = await window.showWarningMessage(\n\t\t\t\t\t`Are your sure you want to open the changes for all ${files.length} files?`,\n\t\t\t\t\t{ title: 'Yes' },\n\t\t\t\t\t{ title: 'No', isCloseAffordance: true },\n\t\t\t\t);\n\t\t\t\tif (result == null || result.title === 'No') return;\n\t\t\t}\n\n\t\t\tfor (const file of files) {\n\t\t\t\tvoid openChangesWithDiffTool(file, ref!);\n\t\t\t}\n\t\t}\n\n\t\texport async function openAllChangesWithWorking(\n\t\t\tcommit: GitCommit,\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t): Promise<void>;\n\t\texport async function openAllChangesWithWorking(\n\t\t\tfiles: GitFile[],\n\t\t\tref: { repoPath: string; ref: string },\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t): Promise<void>;\n\t\texport async function openAllChangesWithWorking(\n\t\t\tcommitOrFiles: GitCommit | GitFile[],\n\t\t\trefOrOptions: { repoPath: string; ref: string } | TextDocumentShowOptions | undefined,\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t) {\n\t\t\tlet files;\n\t\t\tlet ref;\n\t\t\tif (GitCommit.is(commitOrFiles)) {\n\t\t\t\tif (commitOrFiles.files == null) {\n\t\t\t\t\tawait commitOrFiles.ensureFullDetails();\n\t\t\t\t}\n\n\t\t\t\tfiles = commitOrFiles.files ?? [];\n\t\t\t\tref = {\n\t\t\t\t\trepoPath: commitOrFiles.repoPath,\n\t\t\t\t\tref: commitOrFiles.sha,\n\t\t\t\t};\n\n\t\t\t\toptions = refOrOptions as TextDocumentShowOptions | undefined;\n\t\t\t} else {\n\t\t\t\tfiles = commitOrFiles;\n\t\t\t\tref = refOrOptions as { repoPath: string; ref: string };\n\t\t\t}\n\n\t\t\tif (files.length > 10) {\n\t\t\t\tconst result = await window.showWarningMessage(\n\t\t\t\t\t`Are your sure you want to open the changes for all ${files.length} files?`,\n\t\t\t\t\t{ title: 'Yes' },\n\t\t\t\t\t{ title: 'No', isCloseAffordance: true },\n\t\t\t\t);\n\t\t\t\tif (result == null || result.title === 'No') return;\n\t\t\t}\n\n\t\t\toptions = { preserveFocus: true, preview: false, ...options };\n\n\t\t\tfor (const file of files) {\n\t\t\t\tvoid (await openChangesWithWorking(file, ref, options));\n\t\t\t}\n\t\t}\n\n\t\texport async function openChanges(\n\t\t\tfile: string | GitFile,\n\t\t\tcommit: GitCommit,\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t): Promise<void>;\n\t\texport async function openChanges(\n\t\t\tfile: GitFile,\n\t\t\trefs: { repoPath: string; ref1: string; ref2: string },\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t): Promise<void>;\n\t\texport async function openChanges(\n\t\t\tfile: string | GitFile,\n\t\t\tcommitOrRefs: GitCommit | { repoPath: string; ref1: string; ref2: string },\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t) {\n\t\t\tif (typeof file === 'string') {\n\t\t\t\tif (!GitCommit.is(commitOrRefs)) throw new Error('Invalid arguments');\n\n\t\t\t\tconst f = await commitOrRefs.findFile(file);\n\t\t\t\tif (f == null) throw new Error('Invalid arguments');\n\n\t\t\t\tfile = f;\n\t\t\t}\n\n\t\t\tif (file.status === 'A') return;\n\n\t\t\tconst refs = GitCommit.is(commitOrRefs)\n\t\t\t\t? {\n\t\t\t\t\t\trepoPath: commitOrRefs.repoPath,\n\t\t\t\t\t\t// Don't need to worry about verifying the previous sha, as the DiffWith command will\n\t\t\t\t\t\tref1: commitOrRefs.unresolvedPreviousSha,\n\t\t\t\t\t\tref2: commitOrRefs.sha,\n\t\t\t\t  }\n\t\t\t\t: commitOrRefs;\n\n\t\t\toptions = { preserveFocus: true, preview: false, ...options };\n\n\t\t\tconst uri1 = GitUri.fromFile(file, refs.repoPath);\n\t\t\tconst uri2 =\n\t\t\t\tfile.status === 'R' || file.status === 'C'\n\t\t\t\t\t? GitUri.fromFile(file, refs.repoPath, refs.ref2, true)\n\t\t\t\t\t: uri1;\n\n\t\t\tvoid (await executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\t\trepoPath: refs.repoPath,\n\t\t\t\tlhs: { uri: uri1, sha: refs.ref1 },\n\t\t\t\trhs: { uri: uri2, sha: refs.ref2 },\n\t\t\t\tshowOptions: options,\n\t\t\t}));\n\t\t}\n\n\t\texport function openChangesWithDiffTool(\n\t\t\tfile: string | GitFile,\n\t\t\tcommit: GitCommit,\n\t\t\ttool?: string,\n\t\t): Promise<void>;\n\t\texport function openChangesWithDiffTool(\n\t\t\tfile: GitFile,\n\t\t\tref: { repoPath: string; ref: string },\n\t\t\ttool?: string,\n\t\t): Promise<void>;\n\t\texport async function openChangesWithDiffTool(\n\t\t\tfile: string | GitFile,\n\t\t\tcommitOrRef: GitCommit | { repoPath: string; ref: string },\n\t\t\ttool?: string,\n\t\t) {\n\t\t\tif (typeof file === 'string') {\n\t\t\t\tif (!GitCommit.is(commitOrRef)) throw new Error('Invalid arguments');\n\n\t\t\t\tconst f = await commitOrRef.findFile(file);\n\t\t\t\tif (f == null) throw new Error('Invalid arguments');\n\n\t\t\t\tfile = f;\n\t\t\t}\n\n\t\t\treturn Container.instance.git.openDiffTool(\n\t\t\t\tcommitOrRef.repoPath,\n\t\t\t\tGitUri.fromFile(file, file.repoPath ?? commitOrRef.repoPath),\n\t\t\t\t{\n\t\t\t\t\tref1: GitRevision.isUncommitted(commitOrRef.ref) ? '' : `${commitOrRef.ref}^`,\n\t\t\t\t\tref2: GitRevision.isUncommitted(commitOrRef.ref) ? '' : commitOrRef.ref,\n\t\t\t\t\tstaged: GitRevision.isUncommittedStaged(commitOrRef.ref) || file.indexStatus != null,\n\t\t\t\t\ttool: tool,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\texport async function openChangesWithWorking(\n\t\t\tfile: string | GitFile,\n\t\t\tcommit: GitCommit,\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t): Promise<void>;\n\t\texport async function openChangesWithWorking(\n\t\t\tfile: GitFile,\n\t\t\tref: { repoPath: string; ref: string },\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t): Promise<void>;\n\t\texport async function openChangesWithWorking(\n\t\t\tfile: string | GitFile,\n\t\t\tcommitOrRef: GitCommit | { repoPath: string; ref: string },\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t) {\n\t\t\tif (typeof file === 'string') {\n\t\t\t\tif (!GitCommit.is(commitOrRef)) throw new Error('Invalid arguments');\n\n\t\t\t\tconst f = await commitOrRef.findFile(file);\n\t\t\t\tif (f == null) throw new Error('Invalid arguments');\n\n\t\t\t\tfile = f;\n\t\t\t}\n\n\t\t\tif (file.status === 'D') return;\n\n\t\t\tlet ref;\n\t\t\tif (GitCommit.is(commitOrRef)) {\n\t\t\t\tref = {\n\t\t\t\t\trepoPath: commitOrRef.repoPath,\n\t\t\t\t\tref: commitOrRef.sha,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tref = commitOrRef;\n\t\t\t}\n\n\t\t\toptions = { preserveFocus: true, preview: false, ...options };\n\n\t\t\tvoid (await executeEditorCommand<DiffWithWorkingCommandArgs>(Commands.DiffWithWorking, undefined, {\n\t\t\t\turi: GitUri.fromFile(file, ref.repoPath, ref.ref),\n\t\t\t\tshowOptions: options,\n\t\t\t}));\n\t\t}\n\n\t\texport async function openDirectoryCompare(\n\t\t\trepoPath: string,\n\t\t\tref: string,\n\t\t\tref2: string | undefined,\n\t\t\ttool?: string,\n\t\t): Promise<void> {\n\t\t\treturn Container.instance.git.openDirectoryCompare(repoPath, ref, ref2, tool);\n\t\t}\n\n\t\texport async function openDirectoryCompareWithPrevious(\n\t\t\tref: { repoPath: string; ref: string } | GitCommit,\n\t\t): Promise<void> {\n\t\t\treturn openDirectoryCompare(ref.repoPath, ref.ref, `${ref.ref}^`);\n\t\t}\n\n\t\texport async function openDirectoryCompareWithWorking(\n\t\t\tref: { repoPath: string; ref: string } | GitCommit,\n\t\t): Promise<void> {\n\t\t\treturn openDirectoryCompare(ref.repoPath, ref.ref, undefined);\n\t\t}\n\n\t\texport async function openFile(uri: Uri, options?: TextDocumentShowOptions): Promise<void>;\n\t\texport async function openFile(\n\t\t\tfile: string | GitFile,\n\t\t\tref: GitRevisionReference,\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t): Promise<void>;\n\t\texport async function openFile(\n\t\t\tfileOrUri: string | GitFile | Uri,\n\t\t\trefOrOptions?: GitRevisionReference | TextDocumentShowOptions,\n\t\t\toptions?: TextDocumentShowOptions,\n\t\t) {\n\t\t\tlet uri;\n\t\t\tif (fileOrUri instanceof Uri) {\n\t\t\t\turi = fileOrUri;\n\t\t\t\toptions = refOrOptions as TextDocumentShowOptions;\n\t\t\t} else {\n\t\t\t\tconst ref = refOrOptions as GitRevisionReference;\n\t\t\t\turi = GitUri.fromFile(fileOrUri, ref.repoPath, ref.ref);\n\t\t\t}\n\n\t\t\toptions = { preserveFocus: true, preview: false, ...options };\n\n\t\t\tvoid (await executeEditorCommand<OpenWorkingFileCommandArgs>(Commands.OpenWorkingFile, undefined, {\n\t\t\t\turi: uri,\n\t\t\t\tshowOptions: options,\n\t\t\t}));\n\t\t}\n\n\t\texport async function openFileAtRevision(\n\t\t\trevisionUri: Uri,\n\t\t\toptions?: TextDocumentShowOptions & { annotationType?: FileAnnotationType; line?: number },\n\t\t): Promise<void>;\n\t\texport async function openFileAtRevision(\n\t\t\tfile: string | GitFile,\n\t\t\tcommit: GitCommit,\n\t\t\toptions?: TextDocumentShowOptions & { annotationType?: FileAnnotationType; line?: number },\n\t\t): Promise<void>;\n\t\texport async function openFileAtRevision(\n\t\t\tfileOrRevisionUri: string | GitFile | Uri,\n\t\t\tcommitOrOptions?: GitCommit | TextDocumentShowOptions,\n\t\t\toptions?: TextDocumentShowOptions & { annotationType?: FileAnnotationType; line?: number },\n\t\t): Promise<void> {\n\t\t\tlet uri;\n\t\t\tif (fileOrRevisionUri instanceof Uri) {\n\t\t\t\tif (GitCommit.is(commitOrOptions)) throw new Error('Invalid arguments');\n\n\t\t\t\turi = fileOrRevisionUri;\n\t\t\t\toptions = commitOrOptions;\n\t\t\t} else {\n\t\t\t\tif (!GitCommit.is(commitOrOptions)) throw new Error('Invalid arguments');\n\n\t\t\t\tconst commit = commitOrOptions;\n\n\t\t\t\tlet file;\n\t\t\t\tif (typeof fileOrRevisionUri === 'string') {\n\t\t\t\t\tconst f = await commit.findFile(fileOrRevisionUri);\n\t\t\t\t\tif (f == null) throw new Error('Invalid arguments');\n\n\t\t\t\t\tfile = f;\n\t\t\t\t} else {\n\t\t\t\t\tfile = fileOrRevisionUri;\n\t\t\t\t}\n\n\t\t\t\turi = Container.instance.git.getRevisionUri(\n\t\t\t\t\tfile.status === 'D' ? (await commit.getPreviousSha()) ?? GitRevision.deletedOrMissing : commit.sha,\n\t\t\t\t\tfile,\n\t\t\t\t\tcommit.repoPath,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst { annotationType, line, ...opts }: Exclude<typeof options, undefined> = {\n\t\t\t\tpreserveFocus: true,\n\t\t\t\tpreview: false,\n\t\t\t\t...options,\n\t\t\t};\n\n\t\t\tif (line != null && line !== 0) {\n\t\t\t\topts.selection = new Range(line, 0, line, 0);\n\t\t\t}\n\n\t\t\tconst editor = await findOrOpenEditor(uri, opts);\n\t\t\tif (annotationType != null && editor != null) {\n\t\t\t\tvoid (await Container.instance.fileAnnotations.show(editor, annotationType, {\n\t\t\t\t\tselection: { line: line },\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\texport async function openFiles(commit: GitCommit): Promise<void>;\n\t\texport async function openFiles(files: GitFile[], repoPath: string, ref: string): Promise<void>;\n\t\texport async function openFiles(\n\t\t\tcommitOrFiles: GitCommit | GitFile[],\n\t\t\trepoPath?: string,\n\t\t\tref?: string,\n\t\t): Promise<void> {\n\t\t\tlet files;\n\t\t\tif (GitCommit.is(commitOrFiles)) {\n\t\t\t\tif (commitOrFiles.files == null) {\n\t\t\t\t\tawait commitOrFiles.ensureFullDetails();\n\t\t\t\t}\n\n\t\t\t\tfiles = commitOrFiles.files ?? [];\n\t\t\t\trepoPath = commitOrFiles.repoPath;\n\t\t\t\tref = commitOrFiles.sha;\n\t\t\t} else {\n\t\t\t\tfiles = commitOrFiles;\n\t\t\t}\n\n\t\t\tif (files.length > 10) {\n\t\t\t\tconst result = await window.showWarningMessage(\n\t\t\t\t\t`Are your sure you want to open all ${files.length} files?`,\n\t\t\t\t\t{ title: 'Yes' },\n\t\t\t\t\t{ title: 'No', isCloseAffordance: true },\n\t\t\t\t);\n\t\t\t\tif (result == null || result.title === 'No') return;\n\t\t\t}\n\n\t\t\tconst uris: Uri[] = (\n\t\t\t\tawait Promise.all(\n\t\t\t\t\tfiles.map(file =>\n\t\t\t\t\t\tContainer.instance.git.getWorkingUri(repoPath!, GitUri.fromFile(file, repoPath!, ref)),\n\t\t\t\t\t),\n\t\t\t\t)\n\t\t\t).filter(<T>(u?: T): u is T => Boolean(u));\n\t\t\tfindOrOpenEditors(uris);\n\t\t}\n\n\t\texport async function openFilesAtRevision(commit: GitCommit): Promise<void>;\n\t\texport async function openFilesAtRevision(\n\t\t\tfiles: GitFile[],\n\t\t\trepoPath: string,\n\t\t\tref1: string,\n\t\t\tref2: string,\n\t\t): Promise<void>;\n\t\texport async function openFilesAtRevision(\n\t\t\tcommitOrFiles: GitCommit | GitFile[],\n\t\t\trepoPath?: string,\n\t\t\tref1?: string,\n\t\t\tref2?: string,\n\t\t): Promise<void> {\n\t\t\tlet files;\n\t\t\tif (GitCommit.is(commitOrFiles)) {\n\t\t\t\tif (commitOrFiles.files == null) {\n\t\t\t\t\tawait commitOrFiles.ensureFullDetails();\n\t\t\t\t}\n\n\t\t\t\tfiles = commitOrFiles.files ?? [];\n\t\t\t\trepoPath = commitOrFiles.repoPath;\n\t\t\t\tref1 = commitOrFiles.sha;\n\t\t\t\tref2 = await commitOrFiles.getPreviousSha();\n\t\t\t} else {\n\t\t\t\tfiles = commitOrFiles;\n\t\t\t}\n\n\t\t\tif (files.length > 10) {\n\t\t\t\tconst result = await window.showWarningMessage(\n\t\t\t\t\t`Are your sure you want to open all ${files.length} file revisions?`,\n\t\t\t\t\t{ title: 'Yes' },\n\t\t\t\t\t{ title: 'No', isCloseAffordance: true },\n\t\t\t\t);\n\t\t\t\tif (result == null || result.title === 'No') return;\n\t\t\t}\n\n\t\t\tfindOrOpenEditors(\n\t\t\t\tfiles.map(file =>\n\t\t\t\t\tContainer.instance.git.getRevisionUri(file.status === 'D' ? ref2! : ref1!, file, repoPath!),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\texport async function restoreFile(file: string | GitFile, ref: GitRevisionReference) {\n\t\t\tvoid (await Container.instance.git.checkout(ref.repoPath, ref.ref, {\n\t\t\t\tfileName: typeof file === 'string' ? file : file.path,\n\t\t\t}));\n\t\t}\n\n\t\texport async function reveal(\n\t\t\tcommit: GitRevisionReference,\n\t\t\toptions?: {\n\t\t\t\tselect?: boolean;\n\t\t\t\tfocus?: boolean;\n\t\t\t\texpand?: boolean | number;\n\t\t\t},\n\t\t) {\n\t\t\tconst views = [\n\t\t\t\tContainer.instance.commitsView,\n\t\t\t\tContainer.instance.branchesView,\n\t\t\t\tContainer.instance.remotesView,\n\t\t\t];\n\n\t\t\t// TODO@eamodio stop duplicate notifications\n\n\t\t\tfor (const view of views) {\n\t\t\t\tconst node = view.canReveal\n\t\t\t\t\t? await view.revealCommit(commit, options)\n\t\t\t\t\t: await Container.instance.repositoriesView.revealCommit(commit, options);\n\t\t\t\tif (node != null) return node;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\texport namespace Contributor {\n\t\texport function addAuthors(repo?: string | Repository, contributors?: GitContributor | GitContributor[]) {\n\t\t\treturn executeGitCommand({\n\t\t\t\tcommand: 'co-authors',\n\t\t\t\tstate: { repo: repo, contributors: contributors },\n\t\t\t});\n\t\t}\n\n\t\texport async function reveal(\n\t\t\tcontributor: GitContributor,\n\t\t\toptions?: {\n\t\t\t\tselect?: boolean;\n\t\t\t\tfocus?: boolean;\n\t\t\t\texpand?: boolean | number;\n\t\t\t},\n\t\t) {\n\t\t\tconst view = Container.instance.contributorsView;\n\t\t\tconst node = view.canReveal\n\t\t\t\t? await view.revealContributor(contributor, options)\n\t\t\t\t: await Container.instance.repositoriesView.revealContributor(contributor, options);\n\t\t\treturn node;\n\t\t}\n\t}\n\n\texport namespace Remote {\n\t\texport async function add(repo?: string | Repository) {\n\t\t\tif (repo == null) {\n\t\t\t\trepo = Container.instance.git.highlander;\n\n\t\t\t\tif (repo == null) {\n\t\t\t\t\tconst pick = await RepositoryPicker.show(undefined, 'Choose a repository to add a remote to');\n\t\t\t\t\trepo = pick?.item;\n\t\t\t\t\tif (repo == null) return undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst name = await window.showInputBox({\n\t\t\t\tprompt: 'Please provide a name for the remote',\n\t\t\t\tplaceHolder: 'Remote name',\n\t\t\t\tvalue: undefined,\n\t\t\t\tignoreFocusOut: true,\n\t\t\t});\n\t\t\tif (name == null || name.length === 0) return undefined;\n\n\t\t\tconst url = await window.showInputBox({\n\t\t\t\tprompt: 'Please provide the repository url for the remote',\n\t\t\t\tplaceHolder: 'Remote repository url',\n\t\t\t\tvalue: undefined,\n\t\t\t\tignoreFocusOut: true,\n\t\t\t});\n\t\t\tif (url == null || url.length === 0) return undefined;\n\n\t\t\trepo = ensureRepo(repo);\n\t\t\tvoid (await Container.instance.git.addRemote(repo.path, name, url));\n\t\t\tvoid (await repo.fetch({ remote: name }));\n\n\t\t\treturn name;\n\t\t}\n\n\t\texport async function fetch(repo: string | Repository, remote: string) {\n\t\t\tif (typeof repo === 'string') {\n\t\t\t\tconst r = Container.instance.git.getRepository(repo);\n\t\t\t\tif (r == null) return;\n\n\t\t\t\trepo = r;\n\t\t\t}\n\n\t\t\tvoid (await repo.fetch({ remote: remote }));\n\t\t}\n\n\t\texport async function prune(repo: string | Repository, remote: string) {\n\t\t\tvoid (await Container.instance.git.pruneRemote(typeof repo === 'string' ? repo : repo.path, remote));\n\t\t}\n\n\t\texport async function reveal(\n\t\t\tremote: GitRemote,\n\t\t\toptions?: {\n\t\t\t\tselect?: boolean;\n\t\t\t\tfocus?: boolean;\n\t\t\t\texpand?: boolean | number;\n\t\t\t},\n\t\t) {\n\t\t\tconst view = Container.instance.remotesView;\n\t\t\tconst node = view.canReveal\n\t\t\t\t? await view.revealRemote(remote, options)\n\t\t\t\t: await Container.instance.repositoriesView.revealRemote(remote, options);\n\t\t\treturn node;\n\t\t}\n\t}\n\n\texport namespace Repository {\n\t\texport async function reveal(\n\t\t\trepoPath: string,\n\t\t\tview?: ViewsWithRepositoryFolders,\n\t\t\toptions?: {\n\t\t\t\tselect?: boolean;\n\t\t\t\tfocus?: boolean;\n\t\t\t\texpand?: boolean | number;\n\t\t\t},\n\t\t) {\n\t\t\tconst node = view?.canReveal\n\t\t\t\t? await view.revealRepository(repoPath, options)\n\t\t\t\t: await Container.instance.repositoriesView.revealRepository(repoPath, options);\n\t\t\treturn node;\n\t\t}\n\t}\n\n\texport namespace Stash {\n\t\texport function apply(repo?: string | Repository, ref?: GitStashReference) {\n\t\t\treturn executeGitCommand({\n\t\t\t\tcommand: 'stash',\n\t\t\t\tstate: { subcommand: 'apply', repo: repo, reference: ref },\n\t\t\t});\n\t\t}\n\n\t\texport function drop(repo?: string | Repository, ref?: GitStashReference) {\n\t\t\treturn executeGitCommand({\n\t\t\t\tcommand: 'stash',\n\t\t\t\tstate: { subcommand: 'drop', repo: repo, reference: ref },\n\t\t\t});\n\t\t}\n\n\t\texport function pop(repo?: string | Repository, ref?: GitStashReference) {\n\t\t\treturn executeGitCommand({\n\t\t\t\tcommand: 'stash',\n\t\t\t\tstate: { subcommand: 'pop', repo: repo, reference: ref },\n\t\t\t});\n\t\t}\n\n\t\texport function push(repo?: string | Repository, uris?: Uri[], message?: string, keepStaged: boolean = false) {\n\t\t\treturn executeGitCommand({\n\t\t\t\tcommand: 'stash',\n\t\t\t\tstate: {\n\t\t\t\t\tsubcommand: 'push',\n\t\t\t\t\trepo: repo,\n\t\t\t\t\turis: uris,\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tflags: keepStaged ? ['--keep-index'] : undefined,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\texport async function reveal(\n\t\t\tstash: GitStashReference,\n\t\t\toptions?: {\n\t\t\t\tselect?: boolean;\n\t\t\t\tfocus?: boolean;\n\t\t\t\texpand?: boolean | number;\n\t\t\t},\n\t\t) {\n\t\t\tconst view = Container.instance.stashesView;\n\t\t\tconst node = view.canReveal\n\t\t\t\t? await view.revealStash(stash, options)\n\t\t\t\t: await Container.instance.repositoriesView.revealStash(stash, options);\n\t\t\treturn node;\n\t\t}\n\t}\n\n\texport namespace Tag {\n\t\texport function create(repo?: string | Repository, ref?: GitReference, name?: string) {\n\t\t\treturn executeGitCommand({\n\t\t\t\tcommand: 'tag',\n\t\t\t\tstate: {\n\t\t\t\t\tsubcommand: 'create',\n\t\t\t\t\trepo: repo,\n\t\t\t\t\treference: ref,\n\t\t\t\t\tname: name,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\texport function remove(repo?: string | Repository, refs?: GitTagReference | GitTagReference[]) {\n\t\t\treturn executeGitCommand({\n\t\t\t\tcommand: 'tag',\n\t\t\t\tstate: {\n\t\t\t\t\tsubcommand: 'delete',\n\t\t\t\t\trepo: repo,\n\t\t\t\t\treferences: refs,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\texport async function reveal(\n\t\t\ttag: GitTagReference,\n\t\t\toptions?: {\n\t\t\t\tselect?: boolean;\n\t\t\t\tfocus?: boolean;\n\t\t\t\texpand?: boolean | number;\n\t\t\t},\n\t\t) {\n\t\t\tconst view = Container.instance.tagsView;\n\t\t\tconst node = view.canReveal\n\t\t\t\t? await view.revealTag(tag, options)\n\t\t\t\t: await Container.instance.repositoriesView.revealTag(tag, options);\n\t\t\treturn node;\n\t\t}\n\t}\n\n\texport namespace Worktree {\n\t\texport function create(repo?: string | Repository, uri?: Uri, ref?: GitReference) {\n\t\t\treturn executeGitCommand({\n\t\t\t\tcommand: 'worktree',\n\t\t\t\tstate: { subcommand: 'create', repo: repo, uri: uri, reference: ref },\n\t\t\t});\n\t\t}\n\n\t\texport function open(worktree: GitWorktree, options?: { location?: OpenWorkspaceLocation }) {\n\t\t\treturn openWorkspace(worktree.uri, options);\n\t\t}\n\n\t\texport function remove(repo?: string | Repository, uri?: Uri) {\n\t\t\treturn executeGitCommand({\n\t\t\t\tcommand: 'worktree',\n\t\t\t\tstate: { subcommand: 'delete', repo: repo, uris: ensure(uri) },\n\t\t\t});\n\t\t}\n\n\t\texport async function reveal(\n\t\t\tworktree: GitWorktree,\n\t\t\toptions?: { select?: boolean; focus?: boolean; expand?: boolean | number },\n\t\t) {\n\t\t\tconst view = Container.instance.worktreesView;\n\t\t\tconst node = view.canReveal\n\t\t\t\t? await view.revealWorktree(worktree, options)\n\t\t\t\t: await Container.instance.repositoriesView.revealWorktree(worktree, options);\n\t\t\treturn node;\n\t\t}\n\n\t\texport async function revealInFileExplorer(worktree: GitWorktree) {\n\t\t\tvoid (await executeCoreCommand(CoreCommands.RevealInFileExplorer, worktree.uri));\n\t\t}\n\t}\n}\n","import { QuickPickItem } from 'vscode';\nimport { QuickPickItemOfT } from './common';\n\nexport type FlagsQuickPickItem<T, Context = void> = Context extends void\n\t? QuickPickItemOfT<T[]>\n\t: QuickPickItemOfT<T[]> & { context: Context };\nexport namespace FlagsQuickPickItem {\n\texport function create<T>(flags: T[], item: T[], options: QuickPickItem): FlagsQuickPickItem<T>;\n\texport function create<T, Context>(\n\t\tflags: T[],\n\t\titem: T[],\n\t\toptions: QuickPickItem,\n\t\tcontext: Context,\n\t): FlagsQuickPickItem<T, Context>;\n\texport function create<T, Context = void>(flags: T[], item: T[], options: QuickPickItem, context?: Context): any {\n\t\treturn { ...options, item: item, picked: hasFlags(flags, item), context: context };\n\t}\n}\nfunction hasFlags<T>(flags: T[], has?: T | T[]): boolean {\n\tif (has === undefined) {\n\t\treturn flags.length === 0;\n\t}\n\tif (!Array.isArray(has)) {\n\t\treturn flags.includes(has);\n\t}\n\n\treturn has.length === 0 ? flags.length === 0 : has.every(f => flags.includes(f));\n}\n","import { QuickInputButtons } from 'vscode';\nimport type { Container } from '../../container';\nimport { GitBranchReference, GitReference, Repository } from '../../git/models';\nimport { QuickPickItemOfT } from '../../quickpicks/items/common';\nimport { FlagsQuickPickItem } from '../../quickpicks/items/flags';\nimport { pluralize } from '../../system/string';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tappendReposToTitle,\n\tAsyncStepResultGenerator,\n\tinputBranchNameStep,\n\tPartialStepState,\n\tpickBranchesStep,\n\tpickBranchOrTagStep,\n\tpickBranchStep,\n\tpickRepositoryStep,\n\tQuickCommand,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepResultGenerator,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\tshowTags: boolean;\n\ttitle: string;\n}\n\ntype CreateFlags = '--switch';\n\ninterface CreateState {\n\tsubcommand: 'create';\n\trepo: string | Repository;\n\treference: GitReference;\n\tname: string;\n\tflags: CreateFlags[];\n}\n\ntype DeleteFlags = '--force' | '--remotes';\n\ninterface DeleteState {\n\tsubcommand: 'delete';\n\trepo: string | Repository;\n\treferences: GitBranchReference | GitBranchReference[];\n\tflags: DeleteFlags[];\n}\n\ntype RenameFlags = '-m';\n\ninterface RenameState {\n\tsubcommand: 'rename';\n\trepo: string | Repository;\n\treference: GitBranchReference;\n\tname: string;\n\tflags: RenameFlags[];\n}\n\ntype State = CreateState | DeleteState | RenameState;\ntype BranchStepState<T extends State> = SomeNonNullable<StepState<T>, 'subcommand'>;\n\ntype CreateStepState<T extends CreateState = CreateState> = BranchStepState<ExcludeSome<T, 'repo', string>>;\nfunction assertStateStepCreate(state: PartialStepState<State>): asserts state is CreateStepState {\n\tif (state.repo instanceof Repository && state.subcommand === 'create') return;\n\n\tdebugger;\n\tthrow new Error('Missing repository');\n}\n\ntype DeleteStepState<T extends DeleteState = DeleteState> = BranchStepState<ExcludeSome<T, 'repo', string>>;\nfunction assertStateStepDelete(state: PartialStepState<State>): asserts state is DeleteStepState {\n\tif (state.repo instanceof Repository && state.subcommand === 'delete') return;\n\n\tdebugger;\n\tthrow new Error('Missing repository');\n}\n\ntype RenameStepState<T extends RenameState = RenameState> = BranchStepState<ExcludeSome<T, 'repo', string>>;\nfunction assertStateStepRename(state: PartialStepState<State>): asserts state is RenameStepState {\n\tif (state.repo instanceof Repository && state.subcommand === 'rename') return;\n\n\tdebugger;\n\tthrow new Error('Missing repository');\n}\n\nfunction assertStateStepDeleteBranches(\n\tstate: DeleteStepState,\n): asserts state is ExcludeSome<typeof state, 'references', GitBranchReference> {\n\tif (Array.isArray(state.references)) return;\n\n\tdebugger;\n\tthrow new Error('Missing branches');\n}\n\nconst subcommandToTitleMap = new Map<State['subcommand'], string>([\n\t['create', 'Create'],\n\t['delete', 'Delete'],\n\t['rename', 'Rename'],\n]);\nfunction getTitle(title: string, subcommand: State['subcommand'] | undefined) {\n\treturn subcommand == null ? title : `${subcommandToTitleMap.get(subcommand)} ${title}`;\n}\n\nexport interface BranchGitCommandArgs {\n\treadonly command: 'branch';\n\tconfirm?: boolean;\n\tstate?: Partial<State>;\n}\n\nexport class BranchGitCommand extends QuickCommand<State> {\n\tprivate subcommand: State['subcommand'] | undefined;\n\n\tconstructor(container: Container, args?: BranchGitCommandArgs) {\n\t\tsuper(container, 'branch', 'branch', 'Branch', {\n\t\t\tdescription: 'create, rename, or delete branches',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.subcommand != null) {\n\t\t\tcounter++;\n\n\t\t\tswitch (args?.state.subcommand) {\n\t\t\t\tcase 'create':\n\t\t\t\t\tif (args.state.reference != null) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (args.state.name != null) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'delete':\n\t\t\t\t\tif (\n\t\t\t\t\t\targs.state.references != null &&\n\t\t\t\t\t\t(!Array.isArray(args.state.references) || args.state.references.length !== 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'rename':\n\t\t\t\t\tif (args.state.reference != null) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (args.state.name != null) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: args?.confirm,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canConfirm(): boolean {\n\t\treturn this.subcommand != null;\n\t}\n\n\toverride get canSkipConfirm(): boolean {\n\t\treturn this.subcommand === 'delete' || this.subcommand === 'rename' ? false : super.canSkipConfirm;\n\t}\n\n\toverride get skipConfirmKey() {\n\t\treturn `${this.key}${this.subcommand == null ? '' : `-${this.subcommand}`}:${this.pickedVia}`;\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\tassociatedView: this.container.branchesView,\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tshowTags: false,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tlet skippedStepTwo = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.subcommand == null) {\n\t\t\t\tthis.subcommand = undefined;\n\n\t\t\t\tconst result = yield* this.pickSubcommandStep(state);\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.subcommand = result;\n\t\t\t}\n\n\t\t\tthis.subcommand = state.subcommand;\n\n\t\t\tcontext.title = getTitle(state.subcommand === 'delete' ? 'Branches' : this.title, state.subcommand);\n\n\t\t\tif (state.counter < 2 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepTwo = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepTwo = true;\n\t\t\t\t\tstate.counter++;\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tswitch (state.subcommand) {\n\t\t\t\tcase 'create':\n\t\t\t\t\tassertStateStepCreate(state);\n\t\t\t\t\tyield* this.createCommandSteps(state, context);\n\t\t\t\t\t// Clear any chosen name, since we are exiting this subcommand\n\t\t\t\t\tstate.name = undefined!;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'delete':\n\t\t\t\t\tassertStateStepDelete(state);\n\t\t\t\t\tyield* this.deleteCommandSteps(state, context);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'rename':\n\t\t\t\t\tassertStateStepRename(state);\n\t\t\t\t\tyield* this.renameCommandSteps(state, context);\n\t\t\t\t\t// Clear any chosen name, since we are exiting this subcommand\n\t\t\t\t\tstate.name = undefined!;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tQuickCommand.endSteps(state);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\tif (skippedStepTwo) {\n\t\t\t\tstate.counter--;\n\t\t\t}\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate *pickSubcommandStep(state: PartialStepState<State>): StepResultGenerator<State['subcommand']> {\n\t\tconst step = QuickCommand.createPickStep<QuickPickItemOfT<State['subcommand']>>({\n\t\t\ttitle: this.title,\n\t\t\tplaceholder: `Choose a ${this.label} command`,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'create',\n\t\t\t\t\tdescription: 'creates a new branch',\n\t\t\t\t\tpicked: state.subcommand === 'create',\n\t\t\t\t\titem: 'create',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'delete',\n\t\t\t\t\tdescription: 'deletes the specified branches',\n\t\t\t\t\tpicked: state.subcommand === 'delete',\n\t\t\t\t\titem: 'delete',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'rename',\n\t\t\t\t\tdescription: 'renames the specified branch',\n\t\t\t\t\tpicked: state.subcommand === 'rename',\n\t\t\t\t\titem: 'rename',\n\t\t\t\t},\n\t\t\t],\n\t\t\tbuttons: [QuickInputButtons.Back],\n\t\t});\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n\n\tprivate async *createCommandSteps(state: CreateStepState, context: Context): AsyncStepResultGenerator<void> {\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tif (state.counter < 3 || state.reference == null) {\n\t\t\t\tconst result = yield* pickBranchOrTagStep(state, context, {\n\t\t\t\t\tplaceholder: context =>\n\t\t\t\t\t\t`Choose a branch${context.showTags ? ' or tag' : ''} to create the new branch from`,\n\t\t\t\t\tpicked: state.reference?.ref ?? (await state.repo.getBranch())?.ref,\n\t\t\t\t\ttitleContext: ' from',\n\t\t\t\t\tvalue: GitReference.isRevision(state.reference) ? state.reference.ref : undefined,\n\t\t\t\t});\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.reference = result;\n\t\t\t}\n\n\t\t\tif (state.counter < 4 || state.name == null) {\n\t\t\t\tconst result = yield* inputBranchNameStep(state, context, {\n\t\t\t\t\tplaceholder: 'Please provide a name for the new branch',\n\t\t\t\t\ttitleContext: ` from ${GitReference.toString(state.reference, {\n\t\t\t\t\t\tcapitalize: true,\n\t\t\t\t\t\ticon: false,\n\t\t\t\t\t\tlabel: state.reference.refType !== 'branch',\n\t\t\t\t\t})}`,\n\t\t\t\t\tvalue: state.name ?? GitReference.getNameWithoutRemote(state.reference),\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.name = result;\n\t\t\t}\n\n\t\t\tif (this.confirm(state.confirm)) {\n\t\t\t\tconst result = yield* this.createCommandConfirmStep(state, context);\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.flags = result;\n\t\t\t}\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tif (state.flags.includes('--switch')) {\n\t\t\t\tvoid (await state.repo.switch(state.reference.ref, { createBranch: state.name }));\n\t\t\t} else {\n\t\t\t\tvoid state.repo.branch(...state.flags, state.name, state.reference.ref);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate *createCommandConfirmStep(\n\t\tstate: CreateStepState<CreateState>,\n\t\tcontext: Context,\n\t): StepResultGenerator<CreateFlags[]> {\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<CreateFlags>> = QuickCommand.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\tFlagsQuickPickItem.create<CreateFlags>(state.flags, [], {\n\t\t\t\t\tlabel: context.title,\n\t\t\t\t\tdetail: `Will create a new branch named ${state.name} from ${GitReference.toString(\n\t\t\t\t\t\tstate.reference,\n\t\t\t\t\t)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<CreateFlags>(state.flags, ['--switch'], {\n\t\t\t\t\tlabel: `${context.title} and Switch`,\n\t\t\t\t\tdescription: '--switch',\n\t\t\t\t\tdetail: `Will create and switch to a new branch named ${state.name} from ${GitReference.toString(\n\t\t\t\t\t\tstate.reference,\n\t\t\t\t\t)}`,\n\t\t\t\t}),\n\t\t\t],\n\t\t\tcontext,\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n\n\tprivate async *deleteCommandSteps(state: DeleteStepState, context: Context): AsyncStepResultGenerator<void> {\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tif (state.references != null && !Array.isArray(state.references)) {\n\t\t\t\tstate.references = [state.references];\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tstate.counter < 3 ||\n\t\t\t\tstate.references == null ||\n\t\t\t\t(Array.isArray(state.references) && state.references.length === 0)\n\t\t\t) {\n\t\t\t\tcontext.title = getTitle('Branches', state.subcommand);\n\n\t\t\t\tconst result = yield* pickBranchesStep(state, context, {\n\t\t\t\t\tfilter: b => !b.current,\n\t\t\t\t\tpicked: state.references?.map(r => r.ref),\n\t\t\t\t\tplaceholder: 'Choose branches to delete',\n\t\t\t\t\tsort: { current: false, missingUpstream: true },\n\t\t\t\t});\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.references = result;\n\t\t\t}\n\n\t\t\tcontext.title = getTitle(\n\t\t\t\tpluralize('Branch', state.references.length, { only: true, plural: 'Branches' }),\n\t\t\t\tstate.subcommand,\n\t\t\t);\n\n\t\t\tassertStateStepDeleteBranches(state);\n\t\t\tconst result = yield* this.deleteCommandConfirmStep(state, context);\n\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\tstate.flags = result;\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tvoid state.repo.branchDelete(state.references, {\n\t\t\t\tforce: state.flags.includes('--force'),\n\t\t\t\tremote: state.flags.includes('--remotes'),\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate *deleteCommandConfirmStep(\n\t\tstate: DeleteStepState<ExcludeSome<DeleteState, 'references', GitBranchReference>>,\n\t\tcontext: Context,\n\t): StepResultGenerator<DeleteFlags[]> {\n\t\tconst confirmations: FlagsQuickPickItem<DeleteFlags>[] = [\n\t\t\tFlagsQuickPickItem.create<DeleteFlags>(state.flags, [], {\n\t\t\t\tlabel: context.title,\n\t\t\t\tdetail: `Will delete ${GitReference.toString(state.references)}`,\n\t\t\t}),\n\t\t];\n\t\tif (!state.references.every(b => b.remote)) {\n\t\t\tconfirmations.push(\n\t\t\t\tFlagsQuickPickItem.create<DeleteFlags>(state.flags, ['--force'], {\n\t\t\t\t\tlabel: `Force ${context.title}`,\n\t\t\t\t\tdescription: '--force',\n\t\t\t\t\tdetail: `Will forcibly delete ${GitReference.toString(state.references)}`,\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tif (state.references.some(b => b.upstream != null)) {\n\t\t\t\tconfirmations.push(\n\t\t\t\t\tFlagsQuickPickItem.create<DeleteFlags>(state.flags, ['--remotes'], {\n\t\t\t\t\t\tlabel: `${context.title} & Remote${\n\t\t\t\t\t\t\tstate.references.filter(b => !b.remote).length > 1 ? 's' : ''\n\t\t\t\t\t\t}`,\n\t\t\t\t\t\tdescription: '--remotes',\n\t\t\t\t\t\tdetail: `Will delete ${GitReference.toString(\n\t\t\t\t\t\t\tstate.references,\n\t\t\t\t\t\t)} and any remote tracking branches`,\n\t\t\t\t\t}),\n\t\t\t\t\tFlagsQuickPickItem.create<DeleteFlags>(state.flags, ['--force', '--remotes'], {\n\t\t\t\t\t\tlabel: `Force ${context.title} & Remote${\n\t\t\t\t\t\t\tstate.references.filter(b => !b.remote).length > 1 ? 's' : ''\n\t\t\t\t\t\t}`,\n\t\t\t\t\t\tdescription: '--force --remotes',\n\t\t\t\t\t\tdetail: `Will forcibly delete ${GitReference.toString(\n\t\t\t\t\t\t\tstate.references,\n\t\t\t\t\t\t)} and any remote tracking branches`,\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<DeleteFlags>> = QuickCommand.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\tconfirmations,\n\t\t\tcontext,\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n\n\tprivate async *renameCommandSteps(state: RenameStepState, context: Context): AsyncStepResultGenerator<void> {\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tif (state.counter < 3 || state.reference == null) {\n\t\t\t\tconst result = yield* pickBranchStep(state, context, {\n\t\t\t\t\tfilter: b => !b.remote,\n\t\t\t\t\tpicked: state.reference?.ref,\n\t\t\t\t\tplaceholder: 'Choose a branch to rename',\n\t\t\t\t});\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.reference = result;\n\t\t\t}\n\n\t\t\tif (state.counter < 4 || state.name == null) {\n\t\t\t\tconst result = yield* inputBranchNameStep(state, context, {\n\t\t\t\t\tplaceholder: `Please provide a new name for ${GitReference.toString(state.reference, {\n\t\t\t\t\t\ticon: false,\n\t\t\t\t\t})}`,\n\t\t\t\t\ttitleContext: ` ${GitReference.toString(state.reference, false)}`,\n\t\t\t\t\tvalue: state.name ?? state.reference.name,\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.name = result;\n\t\t\t}\n\n\t\t\tconst result = yield* this.renameCommandConfirmStep(state, context);\n\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\tstate.flags = result;\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tvoid state.repo.branch(...state.flags, state.reference.ref, state.name);\n\t\t}\n\t}\n\n\tprivate *renameCommandConfirmStep(\n\t\tstate: RenameStepState<RenameState>,\n\t\tcontext: Context,\n\t): StepResultGenerator<RenameFlags[]> {\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<RenameFlags>> = QuickCommand.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\tFlagsQuickPickItem.create<RenameFlags>(state.flags, ['-m'], {\n\t\t\t\t\tlabel: context.title,\n\t\t\t\t\tdetail: `Will rename ${GitReference.toString(state.reference)} to ${state.name}`,\n\t\t\t\t}),\n\t\t\t],\n\t\t\tcontext,\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n}\n","import { Container } from '../../container';\nimport { GitBranch, GitLog, GitReference, GitRevision, Repository } from '../../git/models';\nimport { FlagsQuickPickItem } from '../../quickpicks/items/flags';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tappendReposToTitle,\n\tPartialStepState,\n\tpickBranchOrTagStep,\n\tpickCommitsStep,\n\tpickRepositoryStep,\n\tQuickCommand,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepResultGenerator,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\tcache: Map<string, Promise<GitLog | undefined>>;\n\tdestination: GitBranch;\n\tselectedBranchOrTag: GitReference | undefined;\n\tshowTags: boolean;\n\ttitle: string;\n}\n\ntype Flags = '--edit' | '--no-commit';\n\ninterface State<Refs = GitReference | GitReference[]> {\n\trepo: string | Repository;\n\treferences: Refs;\n\tflags: Flags[];\n}\n\nexport interface CherryPickGitCommandArgs {\n\treadonly command: 'cherry-pick';\n\tstate?: Partial<State>;\n}\n\ntype CherryPickStepState<T extends State = State> = ExcludeSome<StepState<T>, 'repo', string>;\n\nexport class CherryPickGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: CherryPickGitCommandArgs) {\n\t\tsuper(container, 'cherry-pick', 'cherry-pick', 'Cherry Pick', {\n\t\t\tdescription: 'integrates changes from specified commits into the current branch',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tif (\n\t\t\targs?.state?.references != null &&\n\t\t\t(!Array.isArray(args.state.references) || args.state.references.length !== 0)\n\t\t) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: true,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canSkipConfirm(): boolean {\n\t\treturn false;\n\t}\n\n\texecute(state: CherryPickStepState<State<GitReference[]>>) {\n\t\tstate.repo.cherryPick(...state.flags, ...state.references.map(c => c.ref).reverse());\n\t}\n\n\toverride isFuzzyMatch(name: string) {\n\t\treturn super.isFuzzyMatch(name) || name === 'cherry';\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.commitsView,\n\t\t\tcache: new Map<string, Promise<GitLog | undefined>>(),\n\t\t\tdestination: undefined!,\n\t\t\tselectedBranchOrTag: undefined,\n\t\t\tshowTags: true,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\tif (state.references != null && !Array.isArray(state.references)) {\n\t\t\tstate.references = [state.references];\n\t\t}\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tif (state.repo == null) {\n\t\t\t\t\t\tstate.counter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (context.destination == null) {\n\t\t\t\tconst branch = await state.repo.getBranch();\n\t\t\t\tif (branch == null) break;\n\n\t\t\t\tcontext.destination = branch;\n\t\t\t}\n\n\t\t\tcontext.title = `${this.title} into ${GitReference.toString(context.destination, { icon: false })}`;\n\n\t\t\tif (state.counter < 2 || state.references == null || state.references.length === 0) {\n\t\t\t\tconst result: StepResult<GitReference> = yield* pickBranchOrTagStep(\n\t\t\t\t\tstate as CherryPickStepState,\n\t\t\t\t\tcontext,\n\t\t\t\t\t{\n\t\t\t\t\t\tfilter: { branches: b => b.id !== context.destination.id },\n\t\t\t\t\t\tplaceholder: context =>\n\t\t\t\t\t\t\t`Choose a branch${context.showTags ? ' or tag' : ''} to cherry-pick from`,\n\t\t\t\t\t\tpicked: context.selectedBranchOrTag?.ref,\n\t\t\t\t\t\tvalue: context.selectedBranchOrTag == null ? state.references?.[0]?.ref : undefined,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (GitReference.isRevision(result)) {\n\t\t\t\t\tstate.references = [result];\n\t\t\t\t\tcontext.selectedBranchOrTag = undefined;\n\t\t\t\t} else {\n\t\t\t\t\tcontext.selectedBranchOrTag = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (state.counter < 3 && context.selectedBranchOrTag != null) {\n\t\t\t\tconst ref = GitRevision.createRange(context.destination.ref, context.selectedBranchOrTag.ref);\n\n\t\t\t\tlet log = context.cache.get(ref);\n\t\t\t\tif (log == null) {\n\t\t\t\t\tlog = this.container.git.getLog(state.repo.path, { ref: ref, merges: false });\n\t\t\t\t\tcontext.cache.set(ref, log);\n\t\t\t\t}\n\n\t\t\t\tconst result: StepResult<GitReference[]> = yield* pickCommitsStep(\n\t\t\t\t\tstate as CherryPickStepState,\n\t\t\t\t\tcontext,\n\t\t\t\t\t{\n\t\t\t\t\t\tlog: await log,\n\t\t\t\t\t\tonDidLoadMore: log => context.cache.set(ref, Promise.resolve(log)),\n\t\t\t\t\t\tpicked: state.references?.map(r => r.ref),\n\t\t\t\t\t\tplaceholder: (context, log) =>\n\t\t\t\t\t\t\tlog == null\n\t\t\t\t\t\t\t\t? `No pickable commits found on ${GitReference.toString(context.selectedBranchOrTag, {\n\t\t\t\t\t\t\t\t\t\ticon: false,\n\t\t\t\t\t\t\t\t  })}`\n\t\t\t\t\t\t\t\t: `Choose commits to cherry-pick into ${GitReference.toString(context.destination, {\n\t\t\t\t\t\t\t\t\t\ticon: false,\n\t\t\t\t\t\t\t\t  })}`,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.references = result;\n\t\t\t}\n\n\t\t\tif (this.confirm(state.confirm)) {\n\t\t\t\tconst result = yield* this.confirmStep(state as CherryPickStepState, context);\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.flags = result;\n\t\t\t}\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tthis.execute(state as CherryPickStepState<State<GitReference[]>>);\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate *confirmStep(state: CherryPickStepState, context: Context): StepResultGenerator<Flags[]> {\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<Flags>> = QuickCommand.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, [], {\n\t\t\t\t\tlabel: this.title,\n\t\t\t\t\tdetail: `Will apply ${GitReference.toString(state.references)} to ${GitReference.toString(\n\t\t\t\t\t\tcontext.destination,\n\t\t\t\t\t)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--edit'], {\n\t\t\t\t\tlabel: `${this.title} & Edit`,\n\t\t\t\t\tdescription: '--edit',\n\t\t\t\t\tdetail: `Will edit and apply ${GitReference.toString(state.references)} to ${GitReference.toString(\n\t\t\t\t\t\tcontext.destination,\n\t\t\t\t\t)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--no-commit'], {\n\t\t\t\t\tlabel: `${this.title} without Committing`,\n\t\t\t\t\tdescription: '--no-commit',\n\t\t\t\t\tdetail: `Will apply ${GitReference.toString(state.references)} to ${GitReference.toString(\n\t\t\t\t\t\tcontext.destination,\n\t\t\t\t\t)} without Committing`,\n\t\t\t\t}),\n\t\t\t],\n\t\t\tcontext,\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n}\n","import { CoreCommands } from '../../constants';\nimport type { Container } from '../../container';\nimport type { GitContributor, Repository } from '../../git/models';\nimport { executeCoreCommand } from '../../system/command';\nimport { normalizePath } from '../../system/path';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tPartialStepState,\n\tpickContributorsStep,\n\tpickRepositoryStep,\n\tQuickCommand,\n\tStepGenerator,\n\tStepResult,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tactiveRepo: Repository | undefined;\n\tassociatedView: ViewsWithRepositoryFolders;\n\ttitle: string;\n}\n\ninterface State {\n\trepo: string | Repository;\n\tcontributors: GitContributor | GitContributor[];\n}\n\nexport interface CoAuthorsGitCommandArgs {\n\treadonly command: 'co-authors';\n\tstate?: Partial<State>;\n}\n\ntype CoAuthorStepState<T extends State = State> = ExcludeSome<StepState<T>, 'repo', string>;\n\nexport class CoAuthorsGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: CoAuthorsGitCommandArgs) {\n\t\tsuper(container, 'co-authors', 'co-authors', 'Add Co-Authors', {\n\t\t\tdescription: 'adds co-authors to a commit message',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tif (\n\t\t\targs?.state?.contributors != null &&\n\t\t\t(!Array.isArray(args.state.contributors) || args.state.contributors.length !== 0)\n\t\t) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: false,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canConfirm() {\n\t\treturn false;\n\t}\n\n\tasync execute(state: CoAuthorStepState) {\n\t\tconst repo = await this.container.git.getOrOpenScmRepository(state.repo.path);\n\t\tif (repo == null) return;\n\n\t\tlet message = repo.inputBox.value;\n\n\t\tconst index = message.indexOf('Co-authored-by: ');\n\t\tif (index !== -1) {\n\t\t\tmessage = message.substring(0, index - 1).trimRight();\n\t\t}\n\n\t\tif (state.contributors != null && !Array.isArray(state.contributors)) {\n\t\t\tstate.contributors = [state.contributors];\n\t\t}\n\n\t\tfor (const c of state.contributors) {\n\t\t\tlet newlines;\n\t\t\tif (message.includes('Co-authored-by: ')) {\n\t\t\t\tnewlines = '\\n';\n\t\t\t} else if (message.length !== 0 && message.endsWith('\\n')) {\n\t\t\t\tnewlines = '\\n\\n';\n\t\t\t} else {\n\t\t\t\tnewlines = '\\n\\n\\n';\n\t\t\t}\n\n\t\t\tmessage += `${newlines}Co-authored-by: ${c.getCoauthor()}`;\n\t\t}\n\n\t\trepo.inputBox.value = message;\n\t\tvoid (await executeCoreCommand(CoreCommands.ShowSCM));\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tactiveRepo: undefined,\n\t\t\tassociatedView: this.container.contributorsView,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tconst scmRepositories = await this.container.git.getOpenScmRepositories();\n\t\tif (scmRepositories.length) {\n\t\t\t// Filter out any repo's that are not known to the built-in git\n\t\t\tcontext.repos = context.repos.filter(repo =>\n\t\t\t\tscmRepositories.find(r => normalizePath(r.rootUri.fsPath) === repo.path),\n\t\t\t);\n\n\t\t\t// Ensure that the active repo is known to the built-in git\n\t\t\tcontext.activeRepo = await this.container.git.getOrOpenRepositoryForEditor();\n\t\t\tif (\n\t\t\t\tcontext.activeRepo != null &&\n\t\t\t\t!scmRepositories.some(r => r.rootUri.fsPath === context.activeRepo!.path)\n\t\t\t) {\n\t\t\t\tcontext.activeRepo = undefined;\n\t\t\t}\n\t\t}\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tif (state.repo == null) {\n\t\t\t\t\t\tstate.counter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (state.counter < 2 || state.contributors == null) {\n\t\t\t\tconst result = yield* pickContributorsStep(\n\t\t\t\t\tstate as CoAuthorStepState,\n\t\t\t\t\tcontext,\n\t\t\t\t\t'Choose contributors to add as co-authors',\n\t\t\t\t);\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.contributors = result;\n\t\t\t}\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tvoid this.execute(state as CoAuthorStepState);\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n}\n","import { GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { GitBranchReference, GitReference, Repository } from '../../git/models';\nimport { FlagsQuickPickItem } from '../../quickpicks/items/flags';\nimport { isStringArray } from '../../system/array';\nimport { fromNow } from '../../system/date';\nimport { pad } from '../../system/string';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tappendReposToTitle,\n\tAsyncStepResultGenerator,\n\tPartialStepState,\n\tpickRepositoriesStep,\n\tQuickCommand,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\ttitle: string;\n}\n\ntype Flags = '--all' | '--prune';\n\ninterface State {\n\trepos: string | string[] | Repository | Repository[];\n\treference?: GitBranchReference;\n\tflags: Flags[];\n}\n\nexport interface FetchGitCommandArgs {\n\treadonly command: 'fetch';\n\tconfirm?: boolean;\n\tstate?: Partial<State>;\n}\n\ntype FetchStepState<T extends State = State> = ExcludeSome<StepState<T>, 'repos', string | string[] | Repository>;\n\nexport class FetchGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: FetchGitCommandArgs) {\n\t\tsuper(container, 'fetch', 'fetch', 'Fetch', { description: 'fetches changes from one or more remotes' });\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repos != null && (!Array.isArray(args.state.repos) || args.state.repos.length !== 0)) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: args?.confirm,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\texecute(state: FetchStepState) {\n\t\tif (GitReference.isBranch(state.reference)) {\n\t\t\treturn state.repos[0].fetch({ branch: state.reference });\n\t\t}\n\n\t\treturn this.container.git.fetchAll(state.repos, {\n\t\t\tall: state.flags.includes('--all'),\n\t\t\tprune: state.flags.includes('--prune'),\n\t\t});\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.commitsView,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\tif (state.repos != null && !Array.isArray(state.repos)) {\n\t\t\tstate.repos = [state.repos as string];\n\t\t}\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repos == null || state.repos.length === 0 || isStringArray(state.repos)) {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tstate.counter++;\n\n\t\t\t\t\tstate.repos = [context.repos[0]];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoriesStep(\n\t\t\t\t\t\tstate as ExcludeSome<typeof state, 'repos', string | Repository>,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t{ skipIfPossible: state.counter >= 1 },\n\t\t\t\t\t);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repos = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.confirm(state.confirm)) {\n\t\t\t\tconst result = yield* this.confirmStep(state as FetchStepState, context);\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.flags = result;\n\t\t\t}\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tvoid this.execute(state as FetchStepState);\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate async *confirmStep(state: FetchStepState, context: Context): AsyncStepResultGenerator<Flags[]> {\n\t\tlet lastFetchedOn = '';\n\t\tif (state.repos.length === 1) {\n\t\t\tconst lastFetched = await state.repos[0].getLastFetched();\n\t\t\tif (lastFetched !== 0) {\n\t\t\t\tlastFetchedOn = `${pad(GlyphChars.Dot, 2, 2)}Last fetched ${fromNow(new Date(lastFetched))}`;\n\t\t\t}\n\t\t}\n\n\t\tlet step: QuickPickStep<FlagsQuickPickItem<Flags>>;\n\n\t\tif (state.repos.length === 1 && GitReference.isBranch(state.reference)) {\n\t\t\tstep = this.createConfirmStep(\n\t\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context, lastFetchedOn),\n\t\t\t\t[\n\t\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, [], {\n\t\t\t\t\t\tlabel: this.title,\n\t\t\t\t\t\tdetail: `Will fetch ${GitReference.toString(state.reference)}`,\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t);\n\t\t} else {\n\t\t\tconst reposToFetch =\n\t\t\t\tstate.repos.length === 1\n\t\t\t\t\t? `$(repo) ${state.repos[0].formattedName}`\n\t\t\t\t\t: `${state.repos.length} repositories`;\n\n\t\t\tstep = QuickCommand.createConfirmStep(\n\t\t\t\tappendReposToTitle(`Confirm ${this.title}`, state, context, lastFetchedOn),\n\t\t\t\t[\n\t\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, [], {\n\t\t\t\t\t\tlabel: this.title,\n\t\t\t\t\t\tdetail: `Will fetch ${reposToFetch}`,\n\t\t\t\t\t}),\n\t\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--prune'], {\n\t\t\t\t\t\tlabel: `${this.title} & Prune`,\n\t\t\t\t\t\tdescription: '--prune',\n\t\t\t\t\t\tdetail: `Will fetch and prune ${reposToFetch}`,\n\t\t\t\t\t}),\n\t\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--all'], {\n\t\t\t\t\t\tlabel: `${this.title} All`,\n\t\t\t\t\t\tdescription: '--all',\n\t\t\t\t\t\tdetail: `Will fetch all remotes of ${reposToFetch}`,\n\t\t\t\t\t}),\n\t\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--all', '--prune'], {\n\t\t\t\t\t\tlabel: `${this.title} All & Prune`,\n\t\t\t\t\t\tdescription: '--all --prune',\n\t\t\t\t\t\tdetail: `Will fetch and prune all remotes of ${reposToFetch}`,\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tcontext,\n\t\t\t);\n\t\t}\n\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n}\n","import { GlyphChars, quickPickTitleMaxChars } from '../../constants';\nimport { Container } from '../../container';\nimport { GitCommit, GitLog, GitReference, Repository } from '../../git/models';\nimport { formatPath } from '../../system/formatPath';\nimport { pad } from '../../system/string';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport { getSteps } from '../gitCommands.utils';\nimport {\n\tPartialStepState,\n\tpickBranchOrTagStep,\n\tpickCommitStep,\n\tpickRepositoryStep,\n\tQuickCommand,\n\tStepGenerator,\n\tStepResult,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\tcache: Map<string, Promise<GitLog | undefined>>;\n\tselectedBranchOrTag: GitReference | undefined;\n\ttitle: string;\n}\n\ninterface State {\n\trepo: string | Repository;\n\treference: GitReference | 'HEAD';\n\n\tfileName?: string;\n}\n\ntype RepositoryStepState<T extends State = State> = SomeNonNullable<\n\tExcludeSome<PartialStepState<T>, 'repo', string>,\n\t'repo'\n>;\nfunction assertStateStepRepository(state: PartialStepState<State>): asserts state is RepositoryStepState {\n\tif (state.repo instanceof Repository) return;\n\n\tdebugger;\n\tthrow new Error('Missing repository');\n}\n\nexport interface LogGitCommandArgs {\n\treadonly command: 'log';\n\tstate?: Partial<State>;\n}\n\nexport class LogGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: LogGitCommandArgs) {\n\t\tsuper(container, 'log', 'history', 'Commits', {\n\t\t\tdescription: 'aka log, shows commit history',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tif (args?.state?.reference != null) {\n\t\t\tcounter++;\n\t\t\tif (\n\t\t\t\targs.state.reference !== 'HEAD' &&\n\t\t\t\tGitReference.isRevision(args.state.reference) &&\n\t\t\t\t!GitReference.isRevisionRange(args.state.reference)\n\t\t\t) {\n\t\t\t\tcounter++;\n\t\t\t}\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: false,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canConfirm(): boolean {\n\t\treturn false;\n\t}\n\n\toverride isFuzzyMatch(name: string) {\n\t\treturn super.isFuzzyMatch(name) || name === 'log';\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.commitsView,\n\t\t\tcache: new Map<string, Promise<GitLog | undefined>>(),\n\t\t\tselectedBranchOrTag: undefined,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tif (state.repo == null) {\n\t\t\t\t\t\tstate.counter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tassertStateStepRepository(state);\n\n\t\t\tif (state.reference === 'HEAD') {\n\t\t\t\tconst branch = await state.repo.getBranch();\n\t\t\t\tstate.reference = branch;\n\t\t\t}\n\n\t\t\tif (state.counter < 2 || state.reference == null) {\n\t\t\t\tconst result = yield* pickBranchOrTagStep(state, context, {\n\t\t\t\t\tplaceholder: 'Choose a branch or tag to show its commit history',\n\t\t\t\t\tpicked: context.selectedBranchOrTag?.ref,\n\t\t\t\t\tvalue: context.selectedBranchOrTag == null ? state.reference?.ref : undefined,\n\t\t\t\t\tranges: true,\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.reference = result;\n\t\t\t\tcontext.selectedBranchOrTag = undefined;\n\t\t\t}\n\n\t\t\tif (!GitReference.isRevision(state.reference) || GitReference.isRevisionRange(state.reference)) {\n\t\t\t\tcontext.selectedBranchOrTag = state.reference;\n\t\t\t}\n\n\t\t\tcontext.title = `${this.title}${pad(GlyphChars.Dot, 2, 2)}${GitReference.toString(\n\t\t\t\tcontext.selectedBranchOrTag,\n\t\t\t\t{ icon: false },\n\t\t\t)}`;\n\n\t\t\tif (state.fileName) {\n\t\t\t\tcontext.title += `${pad(GlyphChars.Dot, 2, 2)}${formatPath(state.fileName, {\n\t\t\t\t\tfileOnly: true,\n\t\t\t\t\ttruncateTo: quickPickTitleMaxChars - context.title.length - 3,\n\t\t\t\t})}`;\n\t\t\t}\n\n\t\t\tif (state.counter < 3 && context.selectedBranchOrTag != null) {\n\t\t\t\tconst ref = context.selectedBranchOrTag.ref;\n\n\t\t\t\tlet log = context.cache.get(ref);\n\t\t\t\tif (log == null) {\n\t\t\t\t\tlog =\n\t\t\t\t\t\tstate.fileName != null\n\t\t\t\t\t\t\t? this.container.git.getLogForFile(state.repo.path, state.fileName, { ref: ref })\n\t\t\t\t\t\t\t: this.container.git.getLog(state.repo.path, { ref: ref });\n\t\t\t\t\tcontext.cache.set(ref, log);\n\t\t\t\t}\n\n\t\t\t\tconst result = yield* pickCommitStep(state, context, {\n\t\t\t\t\tignoreFocusOut: true,\n\t\t\t\t\tlog: await log,\n\t\t\t\t\tonDidLoadMore: log => context.cache.set(ref, Promise.resolve(log)),\n\t\t\t\t\tplaceholder: (context, log) =>\n\t\t\t\t\t\tlog == null\n\t\t\t\t\t\t\t? `No commits found in ${GitReference.toString(context.selectedBranchOrTag, {\n\t\t\t\t\t\t\t\t\ticon: false,\n\t\t\t\t\t\t\t  })}`\n\t\t\t\t\t\t\t: 'Choose a commit',\n\t\t\t\t\tpicked: state.reference?.ref,\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.reference = result;\n\t\t\t}\n\n\t\t\tif (!(state.reference instanceof GitCommit) || state.reference.file != null) {\n\t\t\t\tstate.reference = await this.container.git.getCommit(state.repo.path, state.reference.ref);\n\t\t\t}\n\n\t\t\tconst result = yield* getSteps(\n\t\t\t\tthis.container,\n\t\t\t\t{\n\t\t\t\t\tcommand: 'show',\n\t\t\t\t\tstate: {\n\t\t\t\t\t\trepo: state.repo,\n\t\t\t\t\t\treference: state.reference,\n\t\t\t\t\t\tfileName: state.fileName,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.pickedVia,\n\t\t\t);\n\t\t\tstate.counter--;\n\t\t\tif (result === StepResult.Break) {\n\t\t\t\tQuickCommand.endSteps(state);\n\t\t\t}\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n}\n","import { Container } from '../../container';\nimport { GitBranch, GitLog, GitReference, GitRevision, Repository } from '../../git/models';\nimport { Directive, DirectiveQuickPickItem } from '../../quickpicks/items/directive';\nimport { FlagsQuickPickItem } from '../../quickpicks/items/flags';\nimport { pluralize } from '../../system/string';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tappendReposToTitle,\n\tAsyncStepResultGenerator,\n\tPartialStepState,\n\tpickBranchOrTagStep,\n\tpickCommitStep,\n\tpickRepositoryStep,\n\tQuickCommand,\n\tQuickCommandButtons,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\tcache: Map<string, Promise<GitLog | undefined>>;\n\tdestination: GitBranch;\n\tpickCommit: boolean;\n\tpickCommitForItem: boolean;\n\tselectedBranchOrTag: GitReference | undefined;\n\tshowTags: boolean;\n\ttitle: string;\n}\n\ntype Flags = '--ff-only' | '--no-ff' | '--squash' | '--no-commit';\n\ninterface State {\n\trepo: string | Repository;\n\treference: GitReference;\n\tflags: Flags[];\n}\n\nexport interface MergeGitCommandArgs {\n\treadonly command: 'merge';\n\tstate?: Partial<State>;\n}\n\ntype MergeStepState<T extends State = State> = ExcludeSome<StepState<T>, 'repo', string>;\n\nexport class MergeGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: MergeGitCommandArgs) {\n\t\tsuper(container, 'merge', 'merge', 'Merge', {\n\t\t\tdescription: 'integrates changes from a specified branch into the current branch',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tif (args?.state?.reference != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: true,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canSkipConfirm(): boolean {\n\t\treturn false;\n\t}\n\n\texecute(state: MergeStepState) {\n\t\treturn state.repo.merge(...state.flags, state.reference.ref);\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.commitsView,\n\t\t\tcache: new Map<string, Promise<GitLog | undefined>>(),\n\t\t\tdestination: undefined!,\n\t\t\tpickCommit: false,\n\t\t\tpickCommitForItem: false,\n\t\t\tselectedBranchOrTag: undefined,\n\t\t\tshowTags: true,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tif (state.repo == null) {\n\t\t\t\t\t\tstate.counter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (context.destination == null) {\n\t\t\t\tconst branch = await state.repo.getBranch();\n\t\t\t\tif (branch == null) break;\n\n\t\t\t\tcontext.destination = branch;\n\t\t\t}\n\n\t\t\tcontext.title = `${this.title} into ${GitReference.toString(context.destination, { icon: false })}`;\n\t\t\tcontext.pickCommitForItem = false;\n\n\t\t\tif (state.counter < 2 || state.reference == null) {\n\t\t\t\tconst pickCommitToggle = new QuickCommandButtons.PickCommitToggle(context.pickCommit, context, () => {\n\t\t\t\t\tcontext.pickCommit = !context.pickCommit;\n\t\t\t\t\tpickCommitToggle.on = context.pickCommit;\n\t\t\t\t});\n\n\t\t\t\tconst result: StepResult<GitReference> = yield* pickBranchOrTagStep(state as MergeStepState, context, {\n\t\t\t\t\tplaceholder: context => `Choose a branch${context.showTags ? ' or tag' : ''} to merge`,\n\t\t\t\t\tpicked: context.selectedBranchOrTag?.ref,\n\t\t\t\t\tvalue: context.selectedBranchOrTag == null ? state.reference?.ref : undefined,\n\t\t\t\t\tadditionalButtons: [pickCommitToggle],\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.reference = result;\n\t\t\t\tcontext.selectedBranchOrTag = undefined;\n\t\t\t}\n\n\t\t\tif (!GitReference.isRevision(state.reference)) {\n\t\t\t\tcontext.selectedBranchOrTag = state.reference;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tstate.counter < 3 &&\n\t\t\t\tcontext.selectedBranchOrTag != null &&\n\t\t\t\t(context.pickCommit || context.pickCommitForItem || state.reference.ref === context.destination.ref)\n\t\t\t) {\n\t\t\t\tconst ref = context.selectedBranchOrTag.ref;\n\n\t\t\t\tlet log = context.cache.get(ref);\n\t\t\t\tif (log == null) {\n\t\t\t\t\tlog = this.container.git.getLog(state.repo.path, { ref: ref, merges: false });\n\t\t\t\t\tcontext.cache.set(ref, log);\n\t\t\t\t}\n\n\t\t\t\tconst result: StepResult<GitReference> = yield* pickCommitStep(state as MergeStepState, context, {\n\t\t\t\t\tignoreFocusOut: true,\n\t\t\t\t\tlog: await log,\n\t\t\t\t\tonDidLoadMore: log => context.cache.set(ref, Promise.resolve(log)),\n\t\t\t\t\tplaceholder: (context, log) =>\n\t\t\t\t\t\tlog == null\n\t\t\t\t\t\t\t? `No commits found on ${GitReference.toString(context.selectedBranchOrTag, {\n\t\t\t\t\t\t\t\t\ticon: false,\n\t\t\t\t\t\t\t  })}`\n\t\t\t\t\t\t\t: `Choose a commit to merge into ${GitReference.toString(context.destination, {\n\t\t\t\t\t\t\t\t\ticon: false,\n\t\t\t\t\t\t\t  })}`,\n\t\t\t\t\tpicked: state.reference?.ref,\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.reference = result;\n\t\t\t}\n\n\t\t\tconst result = yield* this.confirmStep(state as MergeStepState, context);\n\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\tstate.flags = result;\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tthis.execute(state as MergeStepState);\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate async *confirmStep(state: MergeStepState, context: Context): AsyncStepResultGenerator<Flags[]> {\n\t\tconst aheadBehind = await this.container.git.getAheadBehindCommitCount(state.repo.path, [\n\t\t\tGitRevision.createRange(context.destination.name, state.reference.name),\n\t\t]);\n\t\tconst count = aheadBehind != null ? aheadBehind.ahead + aheadBehind.behind : 0;\n\t\tif (count === 0) {\n\t\t\tconst step: QuickPickStep<DirectiveQuickPickItem> = this.createConfirmStep(\n\t\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t\t[],\n\t\t\t\tDirectiveQuickPickItem.create(Directive.Cancel, true, {\n\t\t\t\t\tlabel: `Cancel ${this.title}`,\n\t\t\t\t\tdetail: `${GitReference.toString(context.destination, {\n\t\t\t\t\t\tcapitalize: true,\n\t\t\t\t\t})} is up to date with ${GitReference.toString(state.reference)}`,\n\t\t\t\t}),\n\t\t\t);\n\t\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\t\tQuickCommand.canPickStepContinue(step, state, selection);\n\t\t\treturn StepResult.Break;\n\t\t}\n\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<Flags>> = this.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, [], {\n\t\t\t\t\tlabel: this.title,\n\t\t\t\t\tdetail: `Will merge ${pluralize('commit', count)} from ${GitReference.toString(\n\t\t\t\t\t\tstate.reference,\n\t\t\t\t\t)} into ${GitReference.toString(context.destination)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--ff-only'], {\n\t\t\t\t\tlabel: `Fast-forward ${this.title}`,\n\t\t\t\t\tdescription: '--ff-only',\n\t\t\t\t\tdetail: `Will fast-forward merge ${pluralize('commit', count)} from ${GitReference.toString(\n\t\t\t\t\t\tstate.reference,\n\t\t\t\t\t)} into ${GitReference.toString(context.destination)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--squash'], {\n\t\t\t\t\tlabel: `Squash ${this.title}`,\n\t\t\t\t\tdescription: '--squash',\n\t\t\t\t\tdetail: `Will squash ${pluralize('commit', count)} from ${GitReference.toString(\n\t\t\t\t\t\tstate.reference,\n\t\t\t\t\t)} into one when merging into ${GitReference.toString(context.destination)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--no-ff'], {\n\t\t\t\t\tlabel: `${this.title} without Fast-Forwarding`,\n\t\t\t\t\tdescription: '--no-ff',\n\t\t\t\t\tdetail: `Will create a merge commit when merging ${pluralize(\n\t\t\t\t\t\t'commit',\n\t\t\t\t\t\tcount,\n\t\t\t\t\t)} from ${GitReference.toString(state.reference)} into ${GitReference.toString(\n\t\t\t\t\t\tcontext.destination,\n\t\t\t\t\t)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--no-ff', '--no-commit'], {\n\t\t\t\t\tlabel: `${this.title} without Fast-Forwarding or Committing`,\n\t\t\t\t\tdescription: '--no-ff --no-commit',\n\t\t\t\t\tdetail: `Will merge ${pluralize('commit', count)} from ${GitReference.toString(\n\t\t\t\t\t\tstate.reference,\n\t\t\t\t\t)} into ${GitReference.toString(context.destination)} without Committing`,\n\t\t\t\t}),\n\t\t\t],\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n}\n","import { GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { GitBranch, GitBranchReference, GitReference, Repository } from '../../git/models';\nimport { Directive, DirectiveQuickPickItem } from '../../quickpicks/items/directive';\nimport { FlagsQuickPickItem } from '../../quickpicks/items/flags';\nimport { isStringArray } from '../../system/array';\nimport { fromNow } from '../../system/date';\nimport { pad, pluralize } from '../../system/string';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tappendReposToTitle,\n\tAsyncStepResultGenerator,\n\tPartialStepState,\n\tpickRepositoriesStep,\n\tQuickCommand,\n\tQuickCommandButtons,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\ttitle: string;\n}\n\ntype Flags = '--rebase';\n\ninterface State {\n\trepos: string | string[] | Repository | Repository[];\n\treference?: GitBranchReference;\n\tflags: Flags[];\n}\n\nexport interface PullGitCommandArgs {\n\treadonly command: 'pull';\n\tconfirm?: boolean;\n\tstate?: Partial<State>;\n}\n\ntype PullStepState<T extends State = State> = ExcludeSome<StepState<T>, 'repos', string | string[] | Repository>;\n\nexport class PullGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: PullGitCommandArgs) {\n\t\tsuper(container, 'pull', 'pull', 'Pull', {\n\t\t\tdescription: 'fetches and integrates changes from a remote into the current branch',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repos != null && (!Array.isArray(args.state.repos) || args.state.repos.length !== 0)) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: args?.confirm,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\tasync execute(state: PullStepState) {\n\t\tif (GitReference.isBranch(state.reference)) {\n\t\t\t// Only resort to a branch fetch if the branch isn't the current one\n\t\t\tif (!GitBranch.is(state.reference) || !state.reference.current) {\n\t\t\t\tconst currentBranch = await state.repos[0].getBranch();\n\t\t\t\tif (currentBranch?.name !== state.reference.name) {\n\t\t\t\t\treturn state.repos[0].fetch({ branch: state.reference, pull: true });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.container.git.pullAll(state.repos, { rebase: state.flags.includes('--rebase') });\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.commitsView,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\tif (state.repos != null && !Array.isArray(state.repos)) {\n\t\t\tstate.repos = [state.repos as string];\n\t\t}\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repos == null || state.repos.length === 0 || isStringArray(state.repos)) {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tstate.counter++;\n\n\t\t\t\t\tstate.repos = [context.repos[0]];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoriesStep(\n\t\t\t\t\t\tstate as ExcludeSome<typeof state, 'repos', string | Repository>,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t{ skipIfPossible: state.counter >= 1 },\n\t\t\t\t\t);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repos = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.confirm(state.confirm)) {\n\t\t\t\tconst result = yield* this.confirmStep(state as PullStepState, context);\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.flags = result;\n\t\t\t}\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tvoid this.execute(state as PullStepState);\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate async *confirmStep(state: PullStepState, context: Context): AsyncStepResultGenerator<Flags[]> {\n\t\tlet step: QuickPickStep<FlagsQuickPickItem<Flags>>;\n\n\t\tif (state.repos.length > 1) {\n\t\t\tstep = this.createConfirmStep(appendReposToTitle(`Confirm ${context.title}`, state, context), [\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, [], {\n\t\t\t\t\tlabel: this.title,\n\t\t\t\t\tdetail: `Will pull ${state.repos.length} repositories`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--rebase'], {\n\t\t\t\t\tlabel: `${this.title} with Rebase`,\n\t\t\t\t\tdescription: '--rebase',\n\t\t\t\t\tdetail: `Will pull ${state.repos.length} repositories by rebasing`,\n\t\t\t\t}),\n\t\t\t]);\n\t\t} else if (GitReference.isBranch(state.reference)) {\n\t\t\tif (state.reference.remote) {\n\t\t\t\tstep = this.createConfirmStep(\n\t\t\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t\t\t[],\n\t\t\t\t\tDirectiveQuickPickItem.create(Directive.Cancel, true, {\n\t\t\t\t\t\tlabel: `Cancel ${this.title}`,\n\t\t\t\t\t\tdetail: 'Cannot pull a remote branch',\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tconst [repo] = state.repos;\n\t\t\t\tconst branch = await repo.getBranch(state.reference.name);\n\n\t\t\t\tif (branch?.upstream == null) {\n\t\t\t\t\tstep = this.createConfirmStep(\n\t\t\t\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t\t\t\t[],\n\t\t\t\t\t\tDirectiveQuickPickItem.create(Directive.Cancel, true, {\n\t\t\t\t\t\t\tlabel: `Cancel ${this.title}`,\n\t\t\t\t\t\t\tdetail: 'Cannot pull a branch until it has been published',\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tstep = this.createConfirmStep(appendReposToTitle(`Confirm ${context.title}`, state, context), [\n\t\t\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, [], {\n\t\t\t\t\t\t\tlabel: this.title,\n\t\t\t\t\t\t\tdetail: `Will pull${\n\t\t\t\t\t\t\t\tbranch.state.behind\n\t\t\t\t\t\t\t\t\t? ` ${pluralize('commit', branch.state.behind)} into ${GitReference.toString(\n\t\t\t\t\t\t\t\t\t\t\tbranch,\n\t\t\t\t\t\t\t\t\t  )}`\n\t\t\t\t\t\t\t\t\t: ` into ${GitReference.toString(branch)}`\n\t\t\t\t\t\t\t}`,\n\t\t\t\t\t\t}),\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst [repo] = state.repos;\n\t\t\tconst [status, lastFetched] = await Promise.all([repo.getStatus(), repo.getLastFetched()]);\n\n\t\t\tlet lastFetchedOn = '';\n\t\t\tif (lastFetched !== 0) {\n\t\t\t\tlastFetchedOn = `${pad(GlyphChars.Dot, 2, 2)}Last fetched ${fromNow(new Date(lastFetched))}`;\n\t\t\t}\n\n\t\t\tconst pullDetails =\n\t\t\t\tstatus?.state.behind != null\n\t\t\t\t\t? ` ${pluralize('commit', status.state.behind)} into $(repo) ${repo.formattedName}`\n\t\t\t\t\t: ` into $(repo) ${repo.formattedName}`;\n\n\t\t\tstep = this.createConfirmStep(\n\t\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context, lastFetchedOn),\n\t\t\t\t[\n\t\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, [], {\n\t\t\t\t\t\tlabel: this.title,\n\t\t\t\t\t\tdetail: `Will pull${pullDetails}`,\n\t\t\t\t\t}),\n\t\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--rebase'], {\n\t\t\t\t\t\tlabel: `${this.title} with Rebase`,\n\t\t\t\t\t\tdescription: '--rebase',\n\t\t\t\t\t\tdetail: `Will pull and rebase${pullDetails}`,\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tundefined,\n\t\t\t\t{\n\t\t\t\t\tadditionalButtons: [QuickCommandButtons.Fetch],\n\t\t\t\t\tonDidClickButton: async (quickpick, button) => {\n\t\t\t\t\t\tif (button !== QuickCommandButtons.Fetch || quickpick.busy) return false;\n\n\t\t\t\t\t\tquickpick.title = `Confirm ${context.title}${pad(GlyphChars.Dot, 2, 2)}Fetching${\n\t\t\t\t\t\t\tGlyphChars.Ellipsis\n\t\t\t\t\t\t}`;\n\n\t\t\t\t\t\tquickpick.busy = true;\n\t\t\t\t\t\tquickpick.enabled = false;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait repo.fetch({ progress: true });\n\t\t\t\t\t\t\t// Signal that the step should be retried\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tquickpick.busy = false;\n\t\t\t\t\t\t\tquickpick.enabled = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n}\n","import { configuration } from '../../configuration';\nimport { CoreGitConfiguration, GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { GitBranch, GitBranchReference, GitReference, Repository } from '../../git/models';\nimport { Directive, DirectiveQuickPickItem } from '../../quickpicks/items/directive';\nimport { FlagsQuickPickItem } from '../../quickpicks/items/flags';\nimport { isStringArray } from '../../system/array';\nimport { fromNow } from '../../system/date';\nimport { pad, pluralize } from '../../system/string';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tappendReposToTitle,\n\tAsyncStepResultGenerator,\n\tPartialStepState,\n\tpickRepositoriesStep,\n\tpickRepositoryStep,\n\tQuickCommand,\n\tQuickCommandButtons,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\ttitle: string;\n}\n\ntype Flags = '--force' | '--set-upstream' | string;\n\ninterface State<Repos = string | string[] | Repository | Repository[]> {\n\trepos: Repos;\n\treference?: GitReference;\n\tflags: Flags[];\n}\n\nexport interface PushGitCommandArgs {\n\treadonly command: 'push';\n\tconfirm?: boolean;\n\tstate?: Partial<State>;\n}\n\ntype PushStepState<T extends State = State> = ExcludeSome<StepState<T>, 'repos', string | string[] | Repository>;\n\nexport class PushGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: PushGitCommandArgs) {\n\t\tsuper(container, 'push', 'push', 'Push', {\n\t\t\tdescription: 'pushes changes from the current branch to a remote',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repos != null && (!Array.isArray(args.state.repos) || args.state.repos.length !== 0)) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: args?.confirm,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\texecute(state: State<Repository[]>) {\n\t\tconst index = state.flags.indexOf('--set-upstream');\n\t\tif (index !== -1) {\n\t\t\tif (!GitReference.isBranch(state.reference)) return Promise.resolve();\n\n\t\t\treturn this.container.git.pushAll(state.repos, {\n\t\t\t\tforce: false,\n\t\t\t\tpublish: { remote: state.flags[index + 1] },\n\t\t\t\treference: state.reference,\n\t\t\t});\n\t\t}\n\n\t\treturn this.container.git.pushAll(state.repos, {\n\t\t\tforce: state.flags.includes('--force'),\n\t\t\treference: state.reference,\n\t\t});\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.commitsView,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\tif (state.repos != null && !Array.isArray(state.repos)) {\n\t\t\tstate.repos = [state.repos as string];\n\t\t}\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repos == null || state.repos.length === 0 || isStringArray(state.repos)) {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tstate.counter++;\n\n\t\t\t\t\tstate.repos = [context.repos[0]];\n\t\t\t\t} else if (state.reference != null) {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(\n\t\t\t\t\t\t{ ...state, repos: undefined, repo: state.reference.repoPath },\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repos = [result];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoriesStep(\n\t\t\t\t\t\tstate as ExcludeSome<typeof state, 'repos', string | Repository>,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t{ skipIfPossible: state.counter >= 1 },\n\t\t\t\t\t);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repos = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.confirm(state.confirm)) {\n\t\t\t\tconst result = yield* this.confirmStep(state as PushStepState, context);\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.flags = result;\n\t\t\t}\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tvoid this.execute(state as State<Repository[]>);\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate async *confirmStep(state: PushStepState, context: Context): AsyncStepResultGenerator<Flags[]> {\n\t\tconst useForceWithLease = configuration.getAny<boolean>(CoreGitConfiguration.UseForcePushWithLease) ?? false;\n\n\t\tlet step: QuickPickStep<FlagsQuickPickItem<Flags>>;\n\n\t\tif (state.repos.length > 1) {\n\t\t\tstep = this.createConfirmStep(appendReposToTitle(`Confirm ${context.title}`, state, context), [\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, [], {\n\t\t\t\t\tlabel: this.title,\n\t\t\t\t\tdetail: `Will push ${state.repos.length} repositories`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--force'], {\n\t\t\t\t\tlabel: `Force ${this.title}${useForceWithLease ? ' (with lease)' : ''}`,\n\t\t\t\t\tdescription: `--force${useForceWithLease ? '-with-lease' : ''}`,\n\t\t\t\t\tdetail: `Will force push${useForceWithLease ? ' (with lease)' : ''} ${\n\t\t\t\t\t\tstate.repos.length\n\t\t\t\t\t} repositories`,\n\t\t\t\t}),\n\t\t\t]);\n\t\t} else {\n\t\t\tconst [repo] = state.repos;\n\n\t\t\tconst items: FlagsQuickPickItem<Flags>[] = [];\n\n\t\t\tif (GitReference.isBranch(state.reference)) {\n\t\t\t\tif (state.reference.remote) {\n\t\t\t\t\tstep = this.createConfirmStep(\n\t\t\t\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t\t\t\t[],\n\t\t\t\t\t\tDirectiveQuickPickItem.create(Directive.Cancel, true, {\n\t\t\t\t\t\t\tlabel: `Cancel ${this.title}`,\n\t\t\t\t\t\t\tdetail: 'Cannot push remote branch',\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tconst branch = await repo.getBranch(state.reference.name);\n\n\t\t\t\t\tif (branch != null && branch?.upstream == null) {\n\t\t\t\t\t\tfor (const remote of await repo.getRemotes()) {\n\t\t\t\t\t\t\titems.push(\n\t\t\t\t\t\t\t\tFlagsQuickPickItem.create<Flags>(\n\t\t\t\t\t\t\t\t\tstate.flags,\n\t\t\t\t\t\t\t\t\t['--set-upstream', remote.name, branch.name],\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlabel: `Publish ${branch.name} to ${remote.name}`,\n\t\t\t\t\t\t\t\t\t\tdetail: `Will publish ${GitReference.toString(branch)} to ${remote.name}`,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (items.length) {\n\t\t\t\t\t\t\tstep = this.createConfirmStep(\n\t\t\t\t\t\t\t\tappendReposToTitle('Confirm Publish', state, context),\n\t\t\t\t\t\t\t\titems,\n\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\t{ placeholder: 'Confirm Publish' },\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstep = this.createConfirmStep(\n\t\t\t\t\t\t\t\tappendReposToTitle('Confirm Publish', state, context),\n\t\t\t\t\t\t\t\t[],\n\t\t\t\t\t\t\t\tDirectiveQuickPickItem.create(Directive.Cancel, true, {\n\t\t\t\t\t\t\t\t\tlabel: 'Cancel Publish',\n\t\t\t\t\t\t\t\t\tdetail: 'Cannot publish; No remotes found',\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t{ placeholder: 'Confirm Publish' },\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (branch != null && branch?.state.behind > 0) {\n\t\t\t\t\t\tconst currentBranch = await repo.getBranch();\n\n\t\t\t\t\t\tstep = this.createConfirmStep(\n\t\t\t\t\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t\t\t\t\tbranch.id === currentBranch?.id\n\t\t\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--force'], {\n\t\t\t\t\t\t\t\t\t\t\tlabel: `Force ${this.title}${useForceWithLease ? ' (with lease)' : ''}`,\n\t\t\t\t\t\t\t\t\t\t\tdescription: `--force${useForceWithLease ? '-with-lease' : ''}`,\n\t\t\t\t\t\t\t\t\t\t\tdetail: `Will force push${useForceWithLease ? ' (with lease)' : ''} ${\n\t\t\t\t\t\t\t\t\t\t\t\tbranch?.state.ahead ? ` ${pluralize('commit', branch.state.ahead)}` : ''\n\t\t\t\t\t\t\t\t\t\t\t}${branch.getRemoteName() ? ` to ${branch.getRemoteName()}` : ''}${\n\t\t\t\t\t\t\t\t\t\t\t\tbranch != null && branch.state.behind > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t? `, overwriting ${pluralize('commit', branch.state.behind)}${\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbranch?.getRemoteName()\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ` on ${branch.getRemoteName()}`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t\t\t\t\t\t\t  }`\n\t\t\t\t\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t\t\t\t\t}`,\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t  ]\n\t\t\t\t\t\t\t\t: [],\n\t\t\t\t\t\t\tDirectiveQuickPickItem.create(Directive.Cancel, true, {\n\t\t\t\t\t\t\t\tlabel: `Cancel ${this.title}`,\n\t\t\t\t\t\t\t\tdetail: `Cannot push; ${GitReference.toString(\n\t\t\t\t\t\t\t\t\tbranch,\n\t\t\t\t\t\t\t\t)} is behind ${branch.getRemoteName()} by ${pluralize('commit', branch.state.behind)}`,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if (branch != null && branch?.state.ahead > 0) {\n\t\t\t\t\t\tstep = this.createConfirmStep(appendReposToTitle(`Confirm ${context.title}`, state, context), [\n\t\t\t\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, [branch.getRemoteName()!], {\n\t\t\t\t\t\t\t\tlabel: this.title,\n\t\t\t\t\t\t\t\tdetail: `Will push ${pluralize(\n\t\t\t\t\t\t\t\t\t'commit',\n\t\t\t\t\t\t\t\t\tbranch.state.ahead,\n\t\t\t\t\t\t\t\t)} from ${GitReference.toString(branch)} to ${branch.getRemoteName()}`,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstep = this.createConfirmStep(\n\t\t\t\t\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t\t\t\t\t[],\n\t\t\t\t\t\t\tDirectiveQuickPickItem.create(Directive.Cancel, true, {\n\t\t\t\t\t\t\t\tlabel: `Cancel ${this.title}`,\n\t\t\t\t\t\t\t\tdetail: 'No commits found to push',\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst status = await repo.getStatus();\n\n\t\t\t\tconst branch: GitBranchReference = {\n\t\t\t\t\trefType: 'branch',\n\t\t\t\t\tname: status?.branch ?? 'HEAD',\n\t\t\t\t\tref: status?.branch ?? 'HEAD',\n\t\t\t\t\tremote: false,\n\t\t\t\t\trepoPath: repo.path,\n\t\t\t\t};\n\n\t\t\t\tif (status?.state.ahead === 0) {\n\t\t\t\t\tif (state.reference == null && status.upstream == null) {\n\t\t\t\t\t\tstate.reference = branch;\n\n\t\t\t\t\t\tfor (const remote of await repo.getRemotes()) {\n\t\t\t\t\t\t\titems.push(\n\t\t\t\t\t\t\t\tFlagsQuickPickItem.create<Flags>(\n\t\t\t\t\t\t\t\t\tstate.flags,\n\t\t\t\t\t\t\t\t\t['--set-upstream', remote.name, status.branch],\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlabel: `Publish ${branch.name} to ${remote.name}`,\n\t\t\t\t\t\t\t\t\t\tdetail: `Will publish ${GitReference.toString(branch)} to ${remote.name}`,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (items.length) {\n\t\t\t\t\t\tstep = this.createConfirmStep(\n\t\t\t\t\t\t\tappendReposToTitle('Confirm Publish', state, context),\n\t\t\t\t\t\t\titems,\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t{ placeholder: 'Confirm Publish' },\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if (status.upstream == null) {\n\t\t\t\t\t\tstep = this.createConfirmStep(\n\t\t\t\t\t\t\tappendReposToTitle('Confirm Publish', state, context),\n\t\t\t\t\t\t\t[],\n\t\t\t\t\t\t\tDirectiveQuickPickItem.create(Directive.Cancel, true, {\n\t\t\t\t\t\t\t\tlabel: 'Cancel Publish',\n\t\t\t\t\t\t\t\tdetail: 'Cannot publish; No remotes found',\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t{ placeholder: 'Confirm Publish' },\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstep = this.createConfirmStep(\n\t\t\t\t\t\t\tappendReposToTitle('Confirm Push', state, context),\n\t\t\t\t\t\t\t[],\n\t\t\t\t\t\t\tDirectiveQuickPickItem.create(Directive.Cancel, true, {\n\t\t\t\t\t\t\t\tlabel: `Cancel ${this.title}`,\n\t\t\t\t\t\t\t\tdetail: `Cannot push; No commits ahead of ${GitBranch.getRemote(status.upstream)}`,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet lastFetchedOn = '';\n\n\t\t\t\t\tconst lastFetched = await repo.getLastFetched();\n\t\t\t\t\tif (lastFetched !== 0) {\n\t\t\t\t\t\tlastFetchedOn = `${pad(GlyphChars.Dot, 2, 2)}Last fetched ${fromNow(new Date(lastFetched))}`;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet pushDetails;\n\t\t\t\t\tif (state.reference != null) {\n\t\t\t\t\t\tpushDetails = `${\n\t\t\t\t\t\t\tstatus?.state.ahead\n\t\t\t\t\t\t\t\t? ` commits up to and including ${GitReference.toString(state.reference, {\n\t\t\t\t\t\t\t\t\t\tlabel: false,\n\t\t\t\t\t\t\t\t  })}`\n\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t}${status?.upstream ? ` to ${GitBranch.getRemote(status.upstream)}` : ''}`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpushDetails = `${status?.state.ahead ? ` ${pluralize('commit', status.state.ahead)}` : ''}${\n\t\t\t\t\t\t\tstatus?.upstream ? ` to ${GitBranch.getRemote(status.upstream)}` : ''\n\t\t\t\t\t\t}`;\n\t\t\t\t\t}\n\n\t\t\t\t\tstep = this.createConfirmStep(\n\t\t\t\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context, lastFetchedOn),\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t...(status?.state.behind\n\t\t\t\t\t\t\t\t? []\n\t\t\t\t\t\t\t\t: [\n\t\t\t\t\t\t\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, [], {\n\t\t\t\t\t\t\t\t\t\t\tlabel: this.title,\n\t\t\t\t\t\t\t\t\t\t\tdetail: `Will push${pushDetails}`,\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t  ]),\n\t\t\t\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--force'], {\n\t\t\t\t\t\t\t\tlabel: `Force ${this.title}${useForceWithLease ? ' (with lease)' : ''}`,\n\t\t\t\t\t\t\t\tdescription: `--force${useForceWithLease ? '-with-lease' : ''}`,\n\t\t\t\t\t\t\t\tdetail: `Will force push${useForceWithLease ? ' (with lease)' : ''} ${pushDetails}${\n\t\t\t\t\t\t\t\t\tstatus != null && status.state.behind > 0\n\t\t\t\t\t\t\t\t\t\t? `, overwriting ${pluralize('commit', status.state.behind)}${\n\t\t\t\t\t\t\t\t\t\t\t\tstatus?.upstream ? ` on ${GitBranch.getRemote(status.upstream)}` : ''\n\t\t\t\t\t\t\t\t\t\t  }`\n\t\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t\t}`,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t],\n\t\t\t\t\t\tstatus?.state.behind\n\t\t\t\t\t\t\t? DirectiveQuickPickItem.create(Directive.Cancel, true, {\n\t\t\t\t\t\t\t\t\tlabel: `Cancel ${this.title}`,\n\t\t\t\t\t\t\t\t\tdetail: `Cannot push; ${GitReference.toString(branch)} is behind${\n\t\t\t\t\t\t\t\t\t\tstatus?.upstream ? ` ${GitBranch.getRemote(status.upstream)}` : ''\n\t\t\t\t\t\t\t\t\t} by ${pluralize('commit', status.state.behind)}`,\n\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t);\n\n\t\t\t\t\tstep.additionalButtons = [QuickCommandButtons.Fetch];\n\t\t\t\t\tstep.onDidClickButton = async (quickpick, button) => {\n\t\t\t\t\t\tif (button !== QuickCommandButtons.Fetch || quickpick.busy) return false;\n\n\t\t\t\t\t\tquickpick.title = `Confirm ${context.title}${pad(GlyphChars.Dot, 2, 2)}Fetching${\n\t\t\t\t\t\t\tGlyphChars.Ellipsis\n\t\t\t\t\t\t}`;\n\n\t\t\t\t\t\tquickpick.busy = true;\n\t\t\t\t\t\tquickpick.enabled = false;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait repo.fetch({ progress: true });\n\t\t\t\t\t\t\t// Signal that the step should be retried\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tquickpick.busy = false;\n\t\t\t\t\t\t\tquickpick.enabled = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n}\n","import { env } from 'vscode';\nimport { Container } from '../../container';\nimport { GitBranch, GitLog, GitReference, GitRevision, Repository } from '../../git/models';\nimport { Directive, DirectiveQuickPickItem } from '../../quickpicks/items/directive';\nimport { FlagsQuickPickItem } from '../../quickpicks/items/flags';\nimport { pluralize } from '../../system/string';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tappendReposToTitle,\n\tAsyncStepResultGenerator,\n\tPartialStepState,\n\tpickBranchOrTagStep,\n\tpickCommitStep,\n\tpickRepositoryStep,\n\tQuickCommand,\n\tQuickCommandButtons,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\tcache: Map<string, Promise<GitLog | undefined>>;\n\tdestination: GitBranch;\n\tpickCommit: boolean;\n\tpickCommitForItem: boolean;\n\tselectedBranchOrTag: GitReference | undefined;\n\tshowTags: boolean;\n\ttitle: string;\n}\n\ntype Flags = '--interactive';\n\ninterface State {\n\trepo: string | Repository;\n\treference: GitReference;\n\tflags: Flags[];\n}\n\nexport interface RebaseGitCommandArgs {\n\treadonly command: 'rebase';\n\tstate?: Partial<State>;\n}\n\ntype RebaseStepState<T extends State = State> = ExcludeSome<StepState<T>, 'repo', string>;\n\nexport class RebaseGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: RebaseGitCommandArgs) {\n\t\tsuper(container, 'rebase', 'rebase', 'Rebase', {\n\t\t\tdescription:\n\t\t\t\t'integrates changes from a specified branch into the current branch, by changing the base of the branch and reapplying the commits on top',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tif (args?.state?.reference != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: true,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canSkipConfirm(): boolean {\n\t\treturn false;\n\t}\n\n\tasync execute(state: RebaseStepState) {\n\t\tlet configs: string[] | undefined;\n\t\tif (state.flags.includes('--interactive')) {\n\t\t\tawait this.container.rebaseEditor.enableForNextUse();\n\n\t\t\tlet editor;\n\t\t\tswitch (env.appName) {\n\t\t\t\tcase 'Visual Studio Code - Insiders':\n\t\t\t\t\teditor = 'code-insiders --wait --reuse-window';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Visual Studio Code - Exploration':\n\t\t\t\t\teditor = 'code-exploration --wait --reuse-window';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'VSCodium':\n\t\t\t\t\teditor = 'codium --wait --reuse-window';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\teditor = 'code --wait --reuse-window';\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconfigs = ['-c', `sequence.editor=\"${editor}\"`];\n\t\t}\n\t\treturn state.repo.rebase(configs, ...state.flags, state.reference.ref);\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.commitsView,\n\t\t\tcache: new Map<string, Promise<GitLog | undefined>>(),\n\t\t\tdestination: undefined!,\n\t\t\tpickCommit: false,\n\t\t\tpickCommitForItem: false,\n\t\t\tselectedBranchOrTag: undefined,\n\t\t\tshowTags: true,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tif (state.repo == null) {\n\t\t\t\t\t\tstate.counter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (context.destination == null) {\n\t\t\t\tconst branch = await state.repo.getBranch();\n\t\t\t\tif (branch == null) break;\n\n\t\t\t\tcontext.destination = branch;\n\t\t\t}\n\n\t\t\tcontext.title = `${this.title} ${GitReference.toString(context.destination, { icon: false })}`;\n\t\t\tcontext.pickCommitForItem = false;\n\n\t\t\tif (state.counter < 2 || state.reference == null) {\n\t\t\t\tconst pickCommitToggle = new QuickCommandButtons.PickCommitToggle(context.pickCommit, context, () => {\n\t\t\t\t\tcontext.pickCommit = !context.pickCommit;\n\t\t\t\t\tpickCommitToggle.on = context.pickCommit;\n\t\t\t\t});\n\n\t\t\t\tconst result: StepResult<GitReference> = yield* pickBranchOrTagStep(state as RebaseStepState, context, {\n\t\t\t\t\tplaceholder: context => `Choose a branch${context.showTags ? ' or tag' : ''} to rebase`,\n\t\t\t\t\tpicked: context.selectedBranchOrTag?.ref,\n\t\t\t\t\tvalue: context.selectedBranchOrTag == null ? state.reference?.ref : undefined,\n\t\t\t\t\tadditionalButtons: [pickCommitToggle],\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.reference = result;\n\t\t\t\tcontext.selectedBranchOrTag = undefined;\n\t\t\t}\n\n\t\t\tif (!GitReference.isRevision(state.reference)) {\n\t\t\t\tcontext.selectedBranchOrTag = state.reference;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tstate.counter < 3 &&\n\t\t\t\tcontext.selectedBranchOrTag != null &&\n\t\t\t\t(context.pickCommit || context.pickCommitForItem || state.reference.ref === context.destination.ref)\n\t\t\t) {\n\t\t\t\tconst ref = context.selectedBranchOrTag.ref;\n\n\t\t\t\tlet log = context.cache.get(ref);\n\t\t\t\tif (log == null) {\n\t\t\t\t\tlog = this.container.git.getLog(state.repo.path, { ref: ref, merges: false });\n\t\t\t\t\tcontext.cache.set(ref, log);\n\t\t\t\t}\n\n\t\t\t\tconst result: StepResult<GitReference> = yield* pickCommitStep(state as RebaseStepState, context, {\n\t\t\t\t\tignoreFocusOut: true,\n\t\t\t\t\tlog: await log,\n\t\t\t\t\tonDidLoadMore: log => context.cache.set(ref, Promise.resolve(log)),\n\t\t\t\t\tplaceholder: (context, log) =>\n\t\t\t\t\t\tlog == null\n\t\t\t\t\t\t\t? `No commits found on ${GitReference.toString(context.selectedBranchOrTag, {\n\t\t\t\t\t\t\t\t\ticon: false,\n\t\t\t\t\t\t\t  })}`\n\t\t\t\t\t\t\t: `Choose a commit to rebase ${GitReference.toString(context.destination, {\n\t\t\t\t\t\t\t\t\ticon: false,\n\t\t\t\t\t\t\t  })} onto`,\n\t\t\t\t\tpicked: state.reference?.ref,\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.reference = result;\n\t\t\t}\n\n\t\t\tconst result = yield* this.confirmStep(state as RebaseStepState, context);\n\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\tstate.flags = result;\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tvoid this.execute(state as RebaseStepState);\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate async *confirmStep(state: RebaseStepState, context: Context): AsyncStepResultGenerator<Flags[]> {\n\t\tconst aheadBehind = await this.container.git.getAheadBehindCommitCount(state.repo.path, [\n\t\t\tstate.reference.refType === 'revision'\n\t\t\t\t? GitRevision.createRange(state.reference.ref, context.destination.ref)\n\t\t\t\t: GitRevision.createRange(context.destination.name, state.reference.name),\n\t\t]);\n\n\t\tconst count = aheadBehind != null ? aheadBehind.ahead + aheadBehind.behind : 0;\n\t\tif (count === 0) {\n\t\t\tconst step: QuickPickStep<DirectiveQuickPickItem> = this.createConfirmStep(\n\t\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t\t[],\n\t\t\t\tDirectiveQuickPickItem.create(Directive.Cancel, true, {\n\t\t\t\t\tlabel: `Cancel ${this.title}`,\n\t\t\t\t\tdetail: `${GitReference.toString(context.destination, {\n\t\t\t\t\t\tcapitalize: true,\n\t\t\t\t\t})} is up to date with ${GitReference.toString(state.reference)}`,\n\t\t\t\t}),\n\t\t\t);\n\t\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\t\tQuickCommand.canPickStepContinue(step, state, selection);\n\t\t\treturn StepResult.Break;\n\t\t}\n\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<Flags>> = this.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, [], {\n\t\t\t\t\tlabel: this.title,\n\t\t\t\t\tdetail: `Will update ${GitReference.toString(context.destination)} by applying ${pluralize(\n\t\t\t\t\t\t'commit',\n\t\t\t\t\t\tcount,\n\t\t\t\t\t)} on top of ${GitReference.toString(state.reference)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--interactive'], {\n\t\t\t\t\tlabel: `Interactive ${this.title}`,\n\t\t\t\t\tdescription: '--interactive',\n\t\t\t\t\tdetail: `Will interactively update ${GitReference.toString(\n\t\t\t\t\t\tcontext.destination,\n\t\t\t\t\t)} by applying ${pluralize('commit', count)} on top of ${GitReference.toString(state.reference)}`,\n\t\t\t\t}),\n\t\t\t],\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n}\n","import { Container } from '../../container';\nimport { GitBranch, GitLog, GitReference, GitRevisionReference, Repository } from '../../git/models';\nimport { FlagsQuickPickItem } from '../../quickpicks/items/flags';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tappendReposToTitle,\n\tPartialStepState,\n\tpickCommitStep,\n\tpickRepositoryStep,\n\tQuickCommand,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepResultGenerator,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\tcache: Map<string, Promise<GitLog | undefined>>;\n\tdestination: GitBranch;\n\ttitle: string;\n}\n\ntype Flags = '--hard' | '--soft';\n\ninterface State {\n\trepo: string | Repository;\n\treference: GitRevisionReference;\n\tflags: Flags[];\n}\n\nexport interface ResetGitCommandArgs {\n\treadonly command: 'reset';\n\tconfirm?: boolean;\n\tstate?: Partial<State>;\n}\n\ntype ResetStepState<T extends State = State> = ExcludeSome<StepState<T>, 'repo', string>;\n\nexport class ResetGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: ResetGitCommandArgs) {\n\t\tsuper(container, 'reset', 'reset', 'Reset', { description: 'resets the current branch to a specified commit' });\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tif (args?.state?.reference != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: args?.confirm ?? true,\n\t\t\t...args?.state,\n\t\t};\n\t\tthis._canSkipConfirm = !this.initialState.confirm;\n\t}\n\n\tprivate _canSkipConfirm: boolean = false;\n\toverride get canSkipConfirm(): boolean {\n\t\treturn this._canSkipConfirm;\n\t}\n\n\texecute(state: ResetStepState) {\n\t\treturn state.repo.reset(...state.flags, state.reference.ref);\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.commitsView,\n\t\t\tcache: new Map<string, Promise<GitLog | undefined>>(),\n\t\t\tdestination: undefined!,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tif (state.repo == null) {\n\t\t\t\t\t\tstate.counter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (context.destination == null) {\n\t\t\t\tconst branch = await state.repo.getBranch();\n\t\t\t\tif (branch == null) break;\n\n\t\t\t\tcontext.destination = branch;\n\t\t\t}\n\n\t\t\tcontext.title = `${this.title} ${GitReference.toString(context.destination, { icon: false })}`;\n\n\t\t\tif (state.counter < 2 || state.reference == null) {\n\t\t\t\tconst ref = context.destination.ref;\n\n\t\t\t\tlet log = context.cache.get(ref);\n\t\t\t\tif (log == null) {\n\t\t\t\t\tlog = this.container.git.getLog(state.repo.path, { ref: ref, merges: false });\n\t\t\t\t\tcontext.cache.set(ref, log);\n\t\t\t\t}\n\n\t\t\t\tconst result: StepResult<GitReference> = yield* pickCommitStep(state as ResetStepState, context, {\n\t\t\t\t\tlog: await log,\n\t\t\t\t\tonDidLoadMore: log => context.cache.set(ref, Promise.resolve(log)),\n\t\t\t\t\tplaceholder: (context, log) =>\n\t\t\t\t\t\tlog == null\n\t\t\t\t\t\t\t? `${context.destination.name} has no commits`\n\t\t\t\t\t\t\t: `Choose a commit to reset ${context.destination.name} to`,\n\t\t\t\t\tpicked: state.reference?.ref,\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.reference = result;\n\t\t\t}\n\n\t\t\tif (this.confirm(state.confirm)) {\n\t\t\t\tconst result = yield* this.confirmStep(state as ResetStepState, context);\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.flags = result;\n\t\t\t}\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tthis.execute(state as ResetStepState);\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate *confirmStep(state: ResetStepState, context: Context): StepResultGenerator<Flags[]> {\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<Flags>> = this.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, [], {\n\t\t\t\t\tlabel: this.title,\n\t\t\t\t\tdetail: `Will reset (leaves changes in the working tree) ${GitReference.toString(\n\t\t\t\t\t\tcontext.destination,\n\t\t\t\t\t)} to ${GitReference.toString(state.reference)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--soft'], {\n\t\t\t\t\tlabel: `Soft ${this.title}`,\n\t\t\t\t\tdescription: '--soft',\n\t\t\t\t\tdetail: `Will soft reset (leaves changes in the index and working tree) ${GitReference.toString(\n\t\t\t\t\t\tcontext.destination,\n\t\t\t\t\t)} to ${GitReference.toString(state.reference)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--hard'], {\n\t\t\t\t\tlabel: `Hard ${this.title}`,\n\t\t\t\t\tdescription: '--hard',\n\t\t\t\t\tdetail: `Will hard reset (discards all changes) ${GitReference.toString(\n\t\t\t\t\t\tcontext.destination,\n\t\t\t\t\t)} to ${GitReference.toString(state.reference)}`,\n\t\t\t\t}),\n\t\t\t],\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n}\n","import { Container } from '../../container';\nimport { GitBranch, GitLog, GitReference, GitRevisionReference, Repository } from '../../git/models';\nimport { FlagsQuickPickItem } from '../../quickpicks/items/flags';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tappendReposToTitle,\n\tPartialStepState,\n\tpickCommitsStep,\n\tpickRepositoryStep,\n\tQuickCommand,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepResultGenerator,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\tcache: Map<string, Promise<GitLog | undefined>>;\n\tdestination: GitBranch;\n\ttitle: string;\n}\n\ntype Flags = '--edit' | '--no-edit';\n\ninterface State<Refs = GitRevisionReference | GitRevisionReference[]> {\n\trepo: string | Repository;\n\treferences: Refs;\n\tflags: Flags[];\n}\n\nexport interface RevertGitCommandArgs {\n\treadonly command: 'revert';\n\tstate?: Partial<State>;\n}\n\ntype RevertStepState<T extends State = State> = ExcludeSome<StepState<T>, 'repo', string>;\n\nexport class RevertGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: RevertGitCommandArgs) {\n\t\tsuper(container, 'revert', 'revert', 'Revert', {\n\t\t\tdescription: 'undoes the changes of specified commits, by creating new commits with inverted changes',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tif (\n\t\t\targs?.state?.references != null &&\n\t\t\t(!Array.isArray(args.state.references) || args.state.references.length !== 0)\n\t\t) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: true,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canSkipConfirm(): boolean {\n\t\treturn false;\n\t}\n\n\texecute(state: RevertStepState<State<GitRevisionReference[]>>) {\n\t\treturn state.repo.revert(...state.flags, ...state.references.map(c => c.ref).reverse());\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.commitsView,\n\t\t\tcache: new Map<string, Promise<GitLog | undefined>>(),\n\t\t\tdestination: undefined!,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\tif (state.references != null && !Array.isArray(state.references)) {\n\t\t\tstate.references = [state.references];\n\t\t}\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tif (state.repo == null) {\n\t\t\t\t\t\tstate.counter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (context.destination == null) {\n\t\t\t\tconst branch = await state.repo.getBranch();\n\t\t\t\tif (branch == null) break;\n\n\t\t\t\tcontext.destination = branch;\n\t\t\t}\n\n\t\t\tif (state.counter < 2 || state.references == null || state.references.length === 0) {\n\t\t\t\tconst ref = context.destination.ref;\n\n\t\t\t\tlet log = context.cache.get(ref);\n\t\t\t\tif (log == null) {\n\t\t\t\t\tlog = this.container.git.getLog(state.repo.path, { ref: ref, merges: false });\n\t\t\t\t\tcontext.cache.set(ref, log);\n\t\t\t\t}\n\n\t\t\t\tconst result: StepResult<GitRevisionReference[]> = yield* pickCommitsStep(\n\t\t\t\t\tstate as RevertStepState,\n\t\t\t\t\tcontext,\n\t\t\t\t\t{\n\t\t\t\t\t\tlog: await log,\n\t\t\t\t\t\tonDidLoadMore: log => context.cache.set(ref, Promise.resolve(log)),\n\t\t\t\t\t\tplaceholder: (context, log) =>\n\t\t\t\t\t\t\tlog == null ? `${context.destination.name} has no commits` : 'Choose commits to revert',\n\t\t\t\t\t\tpicked: state.references?.map(r => r.ref),\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.references = result;\n\t\t\t}\n\n\t\t\tconst result = yield* this.confirmStep(state as RevertStepState, context);\n\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\tstate.flags = result;\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tthis.execute(state as RevertStepState<State<GitRevisionReference[]>>);\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate *confirmStep(state: RevertStepState, context: Context): StepResultGenerator<Flags[]> {\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<Flags>> = this.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--no-edit'], {\n\t\t\t\t\tlabel: this.title,\n\t\t\t\t\tdescription: '--no-edit',\n\t\t\t\t\tdetail: `Will revert ${GitReference.toString(state.references)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<Flags>(state.flags, ['--edit'], {\n\t\t\t\t\tlabel: `${this.title} & Edit`,\n\t\t\t\t\tdescription: '--edit',\n\t\t\t\t\tdetail: `Will revert and edit ${GitReference.toString(state.references)}`,\n\t\t\t\t}),\n\t\t\t],\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n}\n","import { ContextKeys, GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { getContext } from '../../context';\nimport { GitCommit, GitLog, Repository } from '../../git/models';\nimport { searchOperators, SearchOperators, SearchPattern } from '../../git/search';\nimport { ActionQuickPickItem, QuickPickItemOfT } from '../../quickpicks/items/common';\nimport { pluralize } from '../../system/string';\nimport { SearchResultsNode } from '../../views/nodes';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport { getSteps } from '../gitCommands.utils';\nimport {\n\tappendReposToTitle,\n\tPartialStepState,\n\tpickCommitStep,\n\tpickRepositoryStep,\n\tQuickCommand,\n\tQuickCommandButtons,\n\tStepGenerator,\n\tStepResult,\n\tStepResultGenerator,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\tcommit: GitCommit | undefined;\n\thasVirtualFolders: boolean;\n\tresultsKey: string | undefined;\n\tresultsPromise: Promise<GitLog | undefined> | undefined;\n\ttitle: string;\n}\n\ninterface State extends Required<SearchPattern> {\n\trepo: string | Repository;\n\tshowResultsInSideBar: boolean | SearchResultsNode;\n}\n\nexport interface SearchGitCommandArgs {\n\treadonly command: 'search' | 'grep';\n\tprefillOnly?: boolean;\n\tstate?: Partial<State>;\n}\n\nconst searchOperatorToTitleMap = new Map<SearchOperators, string>([\n\t['', 'Search by Message'],\n\t['=:', 'Search by Message'],\n\t['message:', 'Search by Message'],\n\t['@:', 'Search by Author'],\n\t['author:', 'Search by Author'],\n\t['#:', 'Search by Commit SHA'],\n\t['commit:', 'Search by Commit SHA'],\n\t['?:', 'Search by File'],\n\t['file:', 'Search by File'],\n\t['~:', 'Search by Changes'],\n\t['change:', 'Search by Changes'],\n]);\n\ntype SearchStepState<T extends State = State> = ExcludeSome<StepState<T>, 'repo', string>;\n\nexport class SearchGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: SearchGitCommandArgs) {\n\t\tsuper(container, 'search', 'search', 'Commit Search', {\n\t\t\tdescription: 'aka grep, searches for commits',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tif (args?.state?.pattern != null && !args.prefillOnly) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: false,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canConfirm(): boolean {\n\t\treturn false;\n\t}\n\n\toverride isMatch(key: string) {\n\t\treturn super.isMatch(key) || key === 'grep';\n\t}\n\n\toverride isFuzzyMatch(name: string) {\n\t\treturn super.isFuzzyMatch(name) || name === 'grep';\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.searchAndCompareView,\n\t\t\tcommit: undefined,\n\t\t\thasVirtualFolders: getContext<boolean>(ContextKeys.HasVirtualFolders, false),\n\t\t\tresultsKey: undefined,\n\t\t\tresultsPromise: undefined,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tconst cfg = this.container.config.gitCommands.search;\n\t\tif (state.matchAll == null) {\n\t\t\tstate.matchAll = cfg.matchAll;\n\t\t}\n\t\tif (state.matchCase == null) {\n\t\t\tstate.matchCase = cfg.matchCase;\n\t\t}\n\t\tif (state.matchRegex == null) {\n\t\t\tstate.matchRegex = cfg.matchRegex;\n\t\t}\n\t\tif (state.showResultsInSideBar == null) {\n\t\t\tstate.showResultsInSideBar = cfg.showResultsInSideBar ?? undefined;\n\t\t}\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tif (state.repo == null) {\n\t\t\t\t\t\tstate.counter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (state.counter < 2 || state.pattern == null) {\n\t\t\t\tconst result = yield* this.pickSearchOperatorStep(state as SearchStepState, context);\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.pattern = undefined;\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.pattern = result;\n\t\t\t}\n\n\t\t\tconst search: SearchPattern = {\n\t\t\t\tpattern: state.pattern,\n\t\t\t\tmatchAll: state.matchAll,\n\t\t\t\tmatchCase: state.matchCase,\n\t\t\t\tmatchRegex: state.matchRegex,\n\t\t\t};\n\t\t\tconst searchKey = SearchPattern.toKey(search);\n\n\t\t\tif (context.resultsPromise == null || context.resultsKey !== searchKey) {\n\t\t\t\tcontext.resultsPromise = state.repo.searchForCommits(search);\n\t\t\t\tcontext.resultsKey = searchKey;\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\t\tif (state.showResultsInSideBar) {\n\t\t\t\tvoid this.container.searchAndCompareView.search(\n\t\t\t\t\tstate.repo.path,\n\t\t\t\t\tsearch,\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: { label: `for ${state.pattern}` },\n\t\t\t\t\t},\n\t\t\t\t\tcontext.resultsPromise,\n\t\t\t\t\tstate.showResultsInSideBar instanceof SearchResultsNode ? state.showResultsInSideBar : undefined,\n\t\t\t\t);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (state.counter < 3 || context.commit == null) {\n\t\t\t\tconst repoPath = state.repo.path;\n\t\t\t\tconst result = yield* pickCommitStep(state as SearchStepState, context, {\n\t\t\t\t\tignoreFocusOut: true,\n\t\t\t\t\tlog: await context.resultsPromise,\n\t\t\t\t\tonDidLoadMore: log => (context.resultsPromise = Promise.resolve(log)),\n\t\t\t\t\tplaceholder: (context, log) =>\n\t\t\t\t\t\tlog == null\n\t\t\t\t\t\t\t? `No results for ${state.pattern}`\n\t\t\t\t\t\t\t: `${pluralize('result', log.count, {\n\t\t\t\t\t\t\t\t\tformat: c => (log.hasMore ? `${c}+` : undefined),\n\t\t\t\t\t\t\t  })} for ${state.pattern}`,\n\t\t\t\t\tpicked: context.commit?.ref,\n\t\t\t\t\tshowInSideBarCommand: new ActionQuickPickItem(\n\t\t\t\t\t\t'$(link-external)  Show Results in Side Bar',\n\t\t\t\t\t\t() =>\n\t\t\t\t\t\t\tvoid this.container.searchAndCompareView.search(\n\t\t\t\t\t\t\t\trepoPath,\n\t\t\t\t\t\t\t\tsearch,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: { label: `for ${state.pattern}` },\n\t\t\t\t\t\t\t\t\treveal: {\n\t\t\t\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcontext.resultsPromise,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t\tshowInSideBarButton: {\n\t\t\t\t\t\tbutton: QuickCommandButtons.ShowResultsInSideBar,\n\t\t\t\t\t\tonDidClick: () =>\n\t\t\t\t\t\t\tvoid this.container.searchAndCompareView.search(\n\t\t\t\t\t\t\t\trepoPath,\n\t\t\t\t\t\t\t\tsearch,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: { label: `for ${state.pattern}` },\n\t\t\t\t\t\t\t\t\treveal: {\n\t\t\t\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcontext.resultsPromise,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\tstate.counter--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tcontext.commit = result;\n\t\t\t}\n\n\t\t\tconst result = yield* getSteps(\n\t\t\t\tthis.container,\n\t\t\t\t{\n\t\t\t\t\tcommand: 'show',\n\t\t\t\t\tstate: {\n\t\t\t\t\t\trepo: state.repo,\n\t\t\t\t\t\treference: context.commit,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.pickedVia,\n\t\t\t);\n\t\t\tstate.counter--;\n\t\t\tif (result === StepResult.Break) {\n\t\t\t\tQuickCommand.endSteps(state);\n\t\t\t}\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate *pickSearchOperatorStep(state: SearchStepState, context: Context): StepResultGenerator<string> {\n\t\tconst items: QuickPickItemOfT<SearchOperators>[] = [\n\t\t\t{\n\t\t\t\tlabel: searchOperatorToTitleMap.get('')!,\n\t\t\t\tdescription: `pattern or message: pattern or =: pattern ${GlyphChars.Dash} use quotes to search for phrases`,\n\t\t\t\titem: 'message:' as const,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: searchOperatorToTitleMap.get('author:')!,\n\t\t\t\tdescription: 'author: pattern or @: pattern',\n\t\t\t\titem: 'author:' as const,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: searchOperatorToTitleMap.get('commit:')!,\n\t\t\t\tdescription: 'commit: sha or #: sha',\n\t\t\t\titem: 'commit:' as const,\n\t\t\t},\n\t\t\tcontext.hasVirtualFolders\n\t\t\t\t? undefined\n\t\t\t\t: {\n\t\t\t\t\t\tlabel: searchOperatorToTitleMap.get('file:')!,\n\t\t\t\t\t\tdescription: 'file: glob or ?: glob',\n\t\t\t\t\t\titem: 'file:' as const,\n\t\t\t\t  },\n\t\t\tcontext.hasVirtualFolders\n\t\t\t\t? undefined\n\t\t\t\t: {\n\t\t\t\t\t\tlabel: searchOperatorToTitleMap.get('change:')!,\n\t\t\t\t\t\tdescription: 'change: pattern or ~: pattern',\n\t\t\t\t\t\titem: 'change:' as const,\n\t\t\t\t  },\n\t\t].filter(<T>(i?: T): i is T => i != null);\n\n\t\tconst matchCaseButton = new QuickCommandButtons.MatchCaseToggle(state.matchCase);\n\t\tconst matchAllButton = new QuickCommandButtons.MatchAllToggle(state.matchAll);\n\t\tconst matchRegexButton = new QuickCommandButtons.MatchRegexToggle(state.matchRegex);\n\n\t\tconst step = QuickCommand.createPickStep<QuickPickItemOfT<SearchOperators>>({\n\t\t\ttitle: appendReposToTitle(context.title, state, context),\n\t\t\tplaceholder: 'e.g. \"Updates dependencies\" author:eamodio',\n\t\t\tmatchOnDescription: true,\n\t\t\tmatchOnDetail: true,\n\t\t\tadditionalButtons: [matchCaseButton, matchAllButton, matchRegexButton],\n\t\t\titems: items,\n\t\t\tvalue: state.pattern,\n\t\t\tonDidAccept: (quickpick): boolean => {\n\t\t\t\tconst pick = quickpick.selectedItems[0];\n\t\t\t\tif (!searchOperators.has(pick.item)) return true;\n\n\t\t\t\tconst value = quickpick.value.trim();\n\t\t\t\tif (value.length === 0 || searchOperators.has(value)) {\n\t\t\t\t\tquickpick.value = pick.item;\n\t\t\t\t} else {\n\t\t\t\t\tquickpick.value = `${value} ${pick.item}`;\n\t\t\t\t}\n\n\t\t\t\tvoid step.onDidChangeValue!(quickpick);\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tonDidClickButton: (quickpick, button) => {\n\t\t\t\tif (button === matchCaseButton) {\n\t\t\t\t\tstate.matchCase = !state.matchCase;\n\t\t\t\t\tmatchCaseButton.on = state.matchCase;\n\t\t\t\t} else if (button === matchAllButton) {\n\t\t\t\t\tstate.matchAll = !state.matchAll;\n\t\t\t\t\tmatchAllButton.on = state.matchAll;\n\t\t\t\t} else if (button === matchRegexButton) {\n\t\t\t\t\tstate.matchRegex = !state.matchRegex;\n\t\t\t\t\tmatchRegexButton.on = state.matchRegex;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDidChangeValue: (quickpick): boolean => {\n\t\t\t\tconst value = quickpick.value.trim();\n\t\t\t\t// Simulate an extra step if we have a value\n\t\t\t\tstate.counter = value ? 3 : 2;\n\n\t\t\t\tconst operations = SearchPattern.parseSearchOperations(value);\n\n\t\t\t\tquickpick.title = appendReposToTitle(\n\t\t\t\t\toperations.size === 0 || operations.size > 1\n\t\t\t\t\t\t? context.title\n\t\t\t\t\t\t: `Commit ${searchOperatorToTitleMap.get(operations.keys().next().value)!}`,\n\t\t\t\t\tstate,\n\t\t\t\t\tcontext,\n\t\t\t\t);\n\n\t\t\t\tif (quickpick.value.length === 0) {\n\t\t\t\t\tquickpick.items = items;\n\t\t\t\t} else {\n\t\t\t\t\t// If something was typed/selected, keep the quick pick open on focus loss\n\t\t\t\t\tquickpick.ignoreFocusOut = true;\n\t\t\t\t\tstep.ignoreFocusOut = true;\n\n\t\t\t\t\tquickpick.items = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Search for',\n\t\t\t\t\t\t\tdescription: quickpick.value,\n\t\t\t\t\t\t\titem: quickpick.value as SearchOperators,\n\t\t\t\t\t\t},\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t});\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\tif (!QuickCommand.canPickStepContinue(step, state, selection)) {\n\t\t\t// Since we simulated a step above, we need to remove it here\n\t\t\tstate.counter--;\n\t\t\treturn StepResult.Break;\n\t\t}\n\n\t\t// Since we simulated a step above, we need to remove it here\n\t\tstate.counter--;\n\t\treturn selection[0].item.trim();\n\t}\n}\n","import { Container } from '../../container';\nimport { GitCommit, GitRevisionReference, GitStashCommit, Repository } from '../../git/models';\nimport { CommitFilesQuickPickItem } from '../../quickpicks/items/commits';\nimport { CommandQuickPickItem } from '../../quickpicks/items/common';\nimport { GitCommandQuickPickItem } from '../../quickpicks/items/gitCommands';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tPartialStepState,\n\tpickCommitStep,\n\tpickRepositoryStep,\n\tQuickCommand,\n\tshowCommitOrStashFilesStep,\n\tshowCommitOrStashFileStep,\n\tshowCommitOrStashStep,\n\tStepGenerator,\n\tStepResult,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\ttitle: string;\n}\n\ninterface State<Ref = GitRevisionReference | GitCommit | GitStashCommit> {\n\trepo: string | Repository;\n\treference: Ref;\n\tfileName: string;\n}\n\nexport interface ShowGitCommandArgs {\n\treadonly command: 'show';\n\tstate?: Partial<State>;\n}\n\ntype RepositoryStepState<T extends State = State> = SomeNonNullable<\n\tExcludeSome<PartialStepState<T>, 'repo', string>,\n\t'repo'\n>;\nfunction assertStateStepRepository(state: PartialStepState<State>): asserts state is RepositoryStepState {\n\tif (state.repo instanceof Repository) return;\n\n\tdebugger;\n\tthrow new Error('Missing repository');\n}\n\ntype CommitStepState = SomeNonNullable<RepositoryStepState<State<GitCommit | GitStashCommit>>, 'reference'>;\nfunction assertsStateStepCommit(state: RepositoryStepState): asserts state is CommitStepState {\n\tif (GitCommit.is(state.reference)) return;\n\n\tdebugger;\n\tthrow new Error('Missing reference');\n}\n\ntype FileNameStepState = SomeNonNullable<CommitStepState, 'fileName'>;\nfunction assertsStateStepFileName(state: CommitStepState): asserts state is FileNameStepState {\n\tif (state.fileName) return;\n\n\tdebugger;\n\tthrow new Error('Missing filename');\n}\n\nexport class ShowGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: ShowGitCommandArgs) {\n\t\tsuper(container, 'show', 'show', 'Show', {\n\t\t\tdescription: 'shows information about a git reference',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tif (args?.state?.reference != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tif (args?.state?.fileName != null) {\n\t\t\t// Skip past the commit show\n\t\t\tcounter += 2;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: false,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canConfirm() {\n\t\treturn false;\n\t}\n\n\tprotected override getStepState(limitBackNavigation: boolean): PartialStepState<State> {\n\t\t// This command is special since we want to allow backing up all the way to the commit,\n\t\t// so ensure the startingStep is at most 1\n\t\tconst state = super.getStepState(limitBackNavigation);\n\t\treturn {\n\t\t\t...state,\n\t\t\tstartingStep: limitBackNavigation ? Math.min(state.startingStep ?? 0, 1) : 0,\n\t\t};\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.commitsView,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tif (state.repo == null) {\n\t\t\t\t\t\tstate.counter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tassertStateStepRepository(state);\n\n\t\t\tif (\n\t\t\t\tstate.counter < 2 ||\n\t\t\t\tstate.reference == null ||\n\t\t\t\t!GitCommit.is(state.reference) ||\n\t\t\t\tstate.reference.file != null\n\t\t\t) {\n\t\t\t\tif (state.reference != null && !GitCommit.is(state.reference)) {\n\t\t\t\t\tstate.reference = await this.container.git.getCommit(state.reference.repoPath, state.reference.ref);\n\t\t\t\t}\n\n\t\t\t\tif (state.counter < 2 || state.reference == null) {\n\t\t\t\t\tconst result = yield* pickCommitStep(state, context, {\n\t\t\t\t\t\tlog: {\n\t\t\t\t\t\t\trepoPath: state.repo.path,\n\t\t\t\t\t\t\tcommits: new Map<string, GitCommit | GitStashCommit>(),\n\t\t\t\t\t\t\tsha: undefined,\n\t\t\t\t\t\t\trange: undefined,\n\t\t\t\t\t\t\tcount: 0,\n\t\t\t\t\t\t\tlimit: undefined,\n\t\t\t\t\t\t\thasMore: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tplaceholder: 'Enter a reference or commit SHA',\n\t\t\t\t\t\tpicked: state.reference?.ref,\n\t\t\t\t\t});\n\t\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.reference = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tassertsStateStepCommit(state);\n\n\t\t\tif (state.counter < 3) {\n\t\t\t\tif (state.reference.files == null) {\n\t\t\t\t\tawait state.reference.ensureFullDetails();\n\t\t\t\t}\n\n\t\t\t\tconst result = yield* showCommitOrStashStep(state, context);\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tif (result instanceof GitCommandQuickPickItem) {\n\t\t\t\t\tconst r = yield* result.executeSteps(this.pickedVia);\n\t\t\t\t\tstate.counter--;\n\t\t\t\t\tif (r === StepResult.Break) {\n\t\t\t\t\t\tQuickCommand.endSteps(state);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (result instanceof CommandQuickPickItem && !(result instanceof CommitFilesQuickPickItem)) {\n\t\t\t\t\tQuickCommand.endSteps(state);\n\n\t\t\t\t\tvoid result.execute();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (state.counter < 4 || state.fileName == null) {\n\t\t\t\tconst result = yield* showCommitOrStashFilesStep(state, context, {\n\t\t\t\t\tpicked: state.fileName,\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tif (result instanceof CommitFilesQuickPickItem) {\n\t\t\t\t\t// Since this is a sort of toggle button, back up 2 steps\n\t\t\t\t\tstate.counter -= 2;\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.fileName = result.file.path;\n\t\t\t}\n\n\t\t\tassertsStateStepFileName(state);\n\n\t\t\tconst result = yield* showCommitOrStashFileStep(state, context);\n\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\tif (result instanceof CommitFilesQuickPickItem) {\n\t\t\t\t// Since this is a sort of toggle button, back up 2 steps\n\t\t\t\tstate.counter -= 2;\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (result instanceof GitCommandQuickPickItem) {\n\t\t\t\tyield* result.executeSteps(this.pickedVia);\n\t\t\t\tstate.counter--;\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (result instanceof CommandQuickPickItem) {\n\t\t\t\tQuickCommand.endSteps(state);\n\n\t\t\t\tvoid result.execute();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n}\n","import { QuickInputButtons, QuickPickItem, Uri, window } from 'vscode';\nimport { ContextKeys, GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { getContext } from '../../context';\nimport { StashApplyError, StashApplyErrorReason } from '../../git/errors';\nimport { GitReference, GitStashCommit, GitStashReference, Repository } from '../../git/models';\nimport { Logger } from '../../logger';\nimport { Messages } from '../../messages';\nimport { QuickPickItemOfT } from '../../quickpicks/items/common';\nimport { FlagsQuickPickItem } from '../../quickpicks/items/flags';\nimport { formatPath } from '../../system/formatPath';\nimport { pad } from '../../system/string';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport { GitActions } from '../gitCommands.actions';\nimport { getSteps } from '../gitCommands.utils';\nimport {\n\tappendReposToTitle,\n\tAsyncStepResultGenerator,\n\tPartialStepState,\n\tpickRepositoryStep,\n\tpickStashStep,\n\tQuickCommand,\n\tQuickCommandButtons,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepResultGenerator,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\treadonly: boolean;\n\ttitle: string;\n}\n\ninterface ApplyState {\n\tsubcommand: 'apply';\n\trepo: string | Repository;\n\treference: GitStashReference;\n}\n\ninterface DropState {\n\tsubcommand: 'drop';\n\trepo: string | Repository;\n\treference: GitStashReference;\n}\n\ninterface ListState {\n\tsubcommand: 'list';\n\trepo: string | Repository;\n\treference: GitStashReference | GitStashCommit;\n}\n\ninterface PopState {\n\tsubcommand: 'pop';\n\trepo: string | Repository;\n\treference: GitStashReference;\n}\n\ntype PushFlags = '--include-untracked' | '--keep-index';\n\ninterface PushState {\n\tsubcommand: 'push';\n\trepo: string | Repository;\n\tmessage?: string;\n\turis?: Uri[];\n\tflags: PushFlags[];\n}\n\ntype State = ApplyState | DropState | ListState | PopState | PushState;\ntype StashStepState<T extends State> = SomeNonNullable<StepState<T>, 'subcommand'>;\ntype ApplyStepState<T extends ApplyState = ApplyState> = StashStepState<ExcludeSome<T, 'repo', string>>;\ntype DropStepState<T extends DropState = DropState> = StashStepState<ExcludeSome<T, 'repo', string>>;\ntype ListStepState<T extends ListState = ListState> = StashStepState<ExcludeSome<T, 'repo', string>>;\ntype PopStepState<T extends PopState = PopState> = StashStepState<ExcludeSome<T, 'repo', string>>;\ntype PushStepState<T extends PushState = PushState> = StashStepState<ExcludeSome<T, 'repo', string>>;\n\nconst subcommandToTitleMap = new Map<State['subcommand'], string>([\n\t['apply', 'Apply'],\n\t['drop', 'Drop'],\n\t['list', 'List'],\n\t['pop', 'Pop'],\n\t['push', 'Push'],\n]);\nfunction getTitle(title: string, subcommand: State['subcommand'] | undefined) {\n\treturn subcommand == null ? title : `${subcommandToTitleMap.get(subcommand)} ${title}`;\n}\n\nexport interface StashGitCommandArgs {\n\treadonly command: 'stash';\n\tconfirm?: boolean;\n\tstate?: Partial<State>;\n}\n\nexport class StashGitCommand extends QuickCommand<State> {\n\tprivate subcommand: State['subcommand'] | undefined;\n\n\tconstructor(container: Container, args?: StashGitCommandArgs) {\n\t\tsuper(container, 'stash', 'stash', 'Stash', {\n\t\t\tdescription: 'shelves (stashes) local changes to be reapplied later',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.subcommand != null) {\n\t\t\tcounter++;\n\n\t\t\tswitch (args.state.subcommand) {\n\t\t\t\tcase 'apply':\n\t\t\t\tcase 'drop':\n\t\t\t\tcase 'pop':\n\t\t\t\t\tif (args.state.reference != null) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'push':\n\t\t\t\t\tif (args.state.message != null) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: args?.confirm,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canConfirm(): boolean {\n\t\treturn this.subcommand != null && this.subcommand !== 'list';\n\t}\n\n\toverride get canSkipConfirm(): boolean {\n\t\treturn this.subcommand === 'drop' ? false : super.canSkipConfirm;\n\t}\n\n\toverride get skipConfirmKey() {\n\t\treturn `${this.key}${this.subcommand == null ? '' : `-${this.subcommand}`}:${this.pickedVia}`;\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.stashesView,\n\t\t\treadonly:\n\t\t\t\tgetContext<boolean>(ContextKeys.Readonly, false) ||\n\t\t\t\tgetContext<boolean>(ContextKeys.Untrusted, false) ||\n\t\t\t\tgetContext<boolean>(ContextKeys.HasVirtualFolders, false),\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tlet skippedStepTwo = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (context.readonly) {\n\t\t\t\tstate.subcommand = 'list';\n\t\t\t}\n\n\t\t\tif (state.counter < 1 || state.subcommand == null) {\n\t\t\t\tthis.subcommand = undefined;\n\n\t\t\t\tconst result = yield* this.pickSubcommandStep(state);\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.subcommand = result;\n\t\t\t}\n\n\t\t\tthis.subcommand = state.subcommand;\n\n\t\t\tcontext.title = getTitle(this.title, state.subcommand);\n\n\t\t\tif (state.counter < 2 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepTwo = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepTwo = true;\n\t\t\t\t\tstate.counter++;\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tswitch (state.subcommand) {\n\t\t\t\tcase 'apply':\n\t\t\t\tcase 'pop':\n\t\t\t\t\tyield* this.applyOrPopCommandSteps(state as ApplyStepState | PopStepState, context);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'drop':\n\t\t\t\t\tyield* this.dropCommandSteps(state as DropStepState, context);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'list':\n\t\t\t\t\tyield* this.listCommandSteps(state as ListStepState, context);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'push':\n\t\t\t\t\tyield* this.pushCommandSteps(state as PushStepState, context);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tQuickCommand.endSteps(state);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\tif (skippedStepTwo) {\n\t\t\t\tstate.counter--;\n\t\t\t}\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate *pickSubcommandStep(state: PartialStepState<State>): StepResultGenerator<State['subcommand']> {\n\t\tconst step = QuickCommand.createPickStep<QuickPickItemOfT<State['subcommand']>>({\n\t\t\ttitle: this.title,\n\t\t\tplaceholder: `Choose a ${this.label} command`,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'apply',\n\t\t\t\t\tdescription: 'integrates changes from the specified stash into the current branch',\n\t\t\t\t\tpicked: state.subcommand === 'apply',\n\t\t\t\t\titem: 'apply',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'drop',\n\t\t\t\t\tdescription: 'deletes the specified stash',\n\t\t\t\t\tpicked: state.subcommand === 'drop',\n\t\t\t\t\titem: 'drop',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'list',\n\t\t\t\t\tdescription: 'lists the saved stashes',\n\t\t\t\t\tpicked: state.subcommand === 'list',\n\t\t\t\t\titem: 'list',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'pop',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'integrates changes from the specified stash into the current branch and deletes the stash',\n\t\t\t\t\tpicked: state.subcommand === 'pop',\n\t\t\t\t\titem: 'pop',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'push',\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t'saves your local changes to a new stash and discards them from the working tree and index',\n\t\t\t\t\tpicked: state.subcommand === 'push',\n\t\t\t\t\titem: 'push',\n\t\t\t\t},\n\t\t\t],\n\t\t\tbuttons: [QuickInputButtons.Back],\n\t\t});\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n\n\tprivate async *applyOrPopCommandSteps(state: ApplyStepState | PopStepState, context: Context): StepGenerator {\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tif (state.counter < 3 || state.reference == null) {\n\t\t\t\tconst result: StepResult<GitStashReference> = yield* pickStashStep(state, context, {\n\t\t\t\t\tstash: await this.container.git.getStash(state.repo.path),\n\t\t\t\t\tplaceholder: (context, stash) =>\n\t\t\t\t\t\tstash == null\n\t\t\t\t\t\t\t? `No stashes found in ${state.repo.formattedName}`\n\t\t\t\t\t\t\t: 'Choose a stash to apply to your working tree',\n\t\t\t\t\tpicked: state.reference?.ref,\n\t\t\t\t});\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.reference = result;\n\t\t\t}\n\n\t\t\tif (this.confirm(state.confirm)) {\n\t\t\t\tconst result = yield* this.applyOrPopCommandConfirmStep(state, context);\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.subcommand = result;\n\t\t\t}\n\n\t\t\tQuickCommand.endSteps(state);\n\n\t\t\ttry {\n\t\t\t\tvoid (await state.repo.stashApply(\n\t\t\t\t\t// pop can only take a stash index, e.g. `stash@{1}`\n\t\t\t\t\tstate.subcommand === 'pop' ? `stash@{${state.reference.number}}` : state.reference.ref,\n\t\t\t\t\t{ deleteAfter: state.subcommand === 'pop' },\n\t\t\t\t));\n\t\t\t} catch (ex) {\n\t\t\t\tLogger.error(ex, context.title);\n\n\t\t\t\tif (StashApplyError.is(ex, StashApplyErrorReason.WorkingChanges)) {\n\t\t\t\t\tvoid window.showWarningMessage(\n\t\t\t\t\t\t'Unable to apply stash. Your working tree changes would be overwritten. Please commit or stash your changes before trying again',\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tvoid Messages.showGenericErrorMessage(ex.message);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate *applyOrPopCommandConfirmStep(\n\t\tstate: ApplyStepState | PopStepState,\n\t\tcontext: Context,\n\t): StepResultGenerator<'apply' | 'pop'> {\n\t\tconst step = this.createConfirmStep<QuickPickItem & { item: 'apply' | 'pop' }>(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tlabel: context.title,\n\t\t\t\t\tdetail:\n\t\t\t\t\t\tstate.subcommand === 'pop'\n\t\t\t\t\t\t\t? `Will delete ${GitReference.toString(\n\t\t\t\t\t\t\t\t\tstate.reference,\n\t\t\t\t\t\t\t  )} and apply the changes to the working tree`\n\t\t\t\t\t\t\t: `Will apply the changes from ${GitReference.toString(\n\t\t\t\t\t\t\t\t\tstate.reference,\n\t\t\t\t\t\t\t  )} to the working tree`,\n\t\t\t\t\titem: state.subcommand,\n\t\t\t\t},\n\t\t\t\t// Alternate confirmation (if pop then apply, and vice versa)\n\t\t\t\t{\n\t\t\t\t\tlabel: getTitle(this.title, state.subcommand === 'pop' ? 'apply' : 'pop'),\n\t\t\t\t\tdetail:\n\t\t\t\t\t\tstate.subcommand === 'pop'\n\t\t\t\t\t\t\t? `Will apply the changes from ${GitReference.toString(\n\t\t\t\t\t\t\t\t\tstate.reference,\n\t\t\t\t\t\t\t  )} to the working tree`\n\t\t\t\t\t\t\t: `Will delete ${GitReference.toString(\n\t\t\t\t\t\t\t\t\tstate.reference,\n\t\t\t\t\t\t\t  )} and apply the changes to the working tree`,\n\t\t\t\t\titem: state.subcommand === 'pop' ? 'apply' : 'pop',\n\t\t\t\t},\n\t\t\t],\n\t\t\tundefined,\n\t\t\t{\n\t\t\t\tplaceholder: `Confirm ${context.title}`,\n\t\t\t\tadditionalButtons: [QuickCommandButtons.RevealInSideBar],\n\t\t\t\tonDidClickButton: (quickpick, button) => {\n\t\t\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\t\t\tvoid GitActions.Stash.reveal(state.reference, {\n\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n\n\tprivate async *dropCommandSteps(state: DropStepState, context: Context): StepGenerator {\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tif (state.counter < 3 || state.reference == null) {\n\t\t\t\tconst result: StepResult<GitStashReference> = yield* pickStashStep(state, context, {\n\t\t\t\t\tstash: await this.container.git.getStash(state.repo.path),\n\t\t\t\t\tplaceholder: (context, stash) =>\n\t\t\t\t\t\tstash == null ? `No stashes found in ${state.repo.formattedName}` : 'Choose a stash to delete',\n\t\t\t\t\tpicked: state.reference?.ref,\n\t\t\t\t});\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.reference = result;\n\t\t\t}\n\n\t\t\tconst result = yield* this.dropCommandConfirmStep(state, context);\n\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\ttry {\n\t\t\t\t// drop can only take a stash index, e.g. `stash@{1}`\n\t\t\t\tvoid (await state.repo.stashDelete(`stash@{${state.reference.number}}`, state.reference.ref));\n\t\t\t} catch (ex) {\n\t\t\t\tLogger.error(ex, context.title);\n\n\t\t\t\tvoid Messages.showGenericErrorMessage('Unable to delete stash');\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate *dropCommandConfirmStep(state: DropStepState, context: Context): StepResultGenerator<void> {\n\t\tconst step = this.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tlabel: context.title,\n\t\t\t\t\tdetail: `Will delete ${GitReference.toString(state.reference)}`,\n\t\t\t\t},\n\t\t\t],\n\t\t\tundefined,\n\t\t\t{\n\t\t\t\tplaceholder: `Confirm ${context.title}`,\n\t\t\t\tadditionalButtons: [QuickCommandButtons.RevealInSideBar],\n\t\t\t\tonDidClickButton: (quickpick, button) => {\n\t\t\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\t\t\tvoid GitActions.Stash.reveal(state.reference, {\n\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? undefined : StepResult.Break;\n\t}\n\n\tprivate async *listCommandSteps(state: ListStepState, context: Context): StepGenerator {\n\t\tcontext.title = 'Stashes';\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tif (state.counter < 3 || state.reference == null) {\n\t\t\t\tconst result: StepResult<GitStashCommit> = yield* pickStashStep(state, context, {\n\t\t\t\t\tstash: await this.container.git.getStash(state.repo.path),\n\t\t\t\t\tplaceholder: (context, stash) =>\n\t\t\t\t\t\tstash == null ? `No stashes found in ${state.repo.formattedName}` : 'Choose a stash',\n\t\t\t\t\tpicked: state.reference?.ref,\n\t\t\t\t});\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.reference = result;\n\t\t\t}\n\n\t\t\tconst result = yield* getSteps(\n\t\t\t\tthis.container,\n\t\t\t\t{\n\t\t\t\t\tcommand: 'show',\n\t\t\t\t\tstate: {\n\t\t\t\t\t\trepo: state.repo,\n\t\t\t\t\t\treference: state.reference,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.pickedVia,\n\t\t\t);\n\t\t\tstate.counter--;\n\t\t\tif (result === StepResult.Break) {\n\t\t\t\tQuickCommand.endSteps(state);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async *pushCommandSteps(state: PushStepState, context: Context): StepGenerator {\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tif (state.counter < 3 || state.message == null) {\n\t\t\t\tconst result = yield* this.pushCommandInputMessageStep(state, context);\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.message = result;\n\t\t\t}\n\n\t\t\tif (this.confirm(state.confirm)) {\n\t\t\t\tconst result = yield* this.pushCommandConfirmStep(state, context);\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.flags = result;\n\t\t\t}\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\ttry {\n\t\t\t\tvoid (await state.repo.stashSave(state.message, state.uris, {\n\t\t\t\t\tincludeUntracked: state.flags.includes('--include-untracked'),\n\t\t\t\t\tkeepIndex: state.flags.includes('--keep-index'),\n\t\t\t\t}));\n\t\t\t} catch (ex) {\n\t\t\t\tLogger.error(ex, context.title);\n\n\t\t\t\tconst msg: string = ex?.message ?? ex?.toString() ?? '';\n\t\t\t\tif (msg.includes('newer version of Git')) {\n\t\t\t\t\tvoid window.showErrorMessage(`Unable to stash changes. ${msg}`);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvoid Messages.showGenericErrorMessage('Unable to stash changes');\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async *pushCommandInputMessageStep(\n\t\tstate: PushStepState,\n\t\tcontext: Context,\n\t): AsyncStepResultGenerator<string> {\n\t\tconst step = QuickCommand.createInputStep({\n\t\t\ttitle: appendReposToTitle(\n\t\t\t\tcontext.title,\n\t\t\t\tstate,\n\t\t\t\tcontext,\n\t\t\t\tstate.uris != null\n\t\t\t\t\t? `${pad(GlyphChars.Dot, 2, 2)}${\n\t\t\t\t\t\t\tstate.uris.length === 1\n\t\t\t\t\t\t\t\t? formatPath(state.uris[0], { fileOnly: true })\n\t\t\t\t\t\t\t\t: `${state.uris.length} files`\n\t\t\t\t\t  }`\n\t\t\t\t\t: undefined,\n\t\t\t),\n\t\t\tplaceholder: 'Please provide a stash message',\n\t\t\tvalue: state.message,\n\t\t\tprompt: 'Enter stash message',\n\t\t});\n\n\t\tconst value: StepSelection<typeof step> = yield step;\n\t\tif (\n\t\t\t!QuickCommand.canStepContinue(step, state, value) ||\n\t\t\t!(await QuickCommand.canInputStepContinue(step, state, value))\n\t\t) {\n\t\t\treturn StepResult.Break;\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tprivate *pushCommandConfirmStep(state: PushStepState, context: Context): StepResultGenerator<PushFlags[]> {\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<PushFlags>> = this.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\tstate.uris == null || state.uris.length === 0\n\t\t\t\t? [\n\t\t\t\t\t\tFlagsQuickPickItem.create<PushFlags>(state.flags, [], {\n\t\t\t\t\t\t\tlabel: context.title,\n\t\t\t\t\t\t\tdetail: 'Will stash uncommitted changes',\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tFlagsQuickPickItem.create<PushFlags>(state.flags, ['--include-untracked'], {\n\t\t\t\t\t\t\tlabel: `${context.title} & Include Untracked`,\n\t\t\t\t\t\t\tdescription: '--include-untracked',\n\t\t\t\t\t\t\tdetail: 'Will stash uncommitted changes, including untracked files',\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tFlagsQuickPickItem.create<PushFlags>(state.flags, ['--keep-index'], {\n\t\t\t\t\t\t\tlabel: `${context.title} & Keep Staged`,\n\t\t\t\t\t\t\tdescription: '--keep-index',\n\t\t\t\t\t\t\tdetail: 'Will stash uncommitted changes, but will keep staged files intact',\n\t\t\t\t\t\t}),\n\t\t\t\t  ]\n\t\t\t\t: [\n\t\t\t\t\t\tFlagsQuickPickItem.create<PushFlags>(state.flags, [], {\n\t\t\t\t\t\t\tlabel: context.title,\n\t\t\t\t\t\t\tdetail: `Will stash changes from ${\n\t\t\t\t\t\t\t\tstate.uris.length === 1\n\t\t\t\t\t\t\t\t\t? formatPath(state.uris[0], { fileOnly: true })\n\t\t\t\t\t\t\t\t\t: `${state.uris.length} files`\n\t\t\t\t\t\t\t}`,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tFlagsQuickPickItem.create<PushFlags>(state.flags, ['--keep-index'], {\n\t\t\t\t\t\t\tlabel: `${context.title} & Keep Staged`,\n\t\t\t\t\t\t\tdetail: `Will stash changes from ${\n\t\t\t\t\t\t\t\tstate.uris.length === 1\n\t\t\t\t\t\t\t\t\t? formatPath(state.uris[0], { fileOnly: true })\n\t\t\t\t\t\t\t\t\t: `${state.uris.length} files`\n\t\t\t\t\t\t\t}, but will keep staged files intact`,\n\t\t\t\t\t\t}),\n\t\t\t\t  ],\n\t\t\tundefined,\n\t\t\t{ placeholder: `Confirm ${context.title}` },\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n}\n","import { GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { GitReference, GitStatus, Repository } from '../../git/models';\nimport { CommandQuickPickItem } from '../../quickpicks/items/common';\nimport { GitCommandQuickPickItem } from '../../quickpicks/items/gitCommands';\nimport { pad } from '../../system/string';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tPartialStepState,\n\tpickRepositoryStep,\n\tQuickCommand,\n\tshowRepositoryStatusStep,\n\tStepGenerator,\n\tStepResult,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\tstatus: GitStatus;\n\ttitle: string;\n}\n\ninterface State {\n\trepo: string | Repository;\n}\n\nexport interface StatusGitCommandArgs {\n\treadonly command: 'status';\n\tstate?: Partial<State>;\n}\n\ntype StatusStepState<T extends State = State> = ExcludeSome<StepState<T>, 'repo', string>;\n\nexport class StatusGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: StatusGitCommandArgs) {\n\t\tsuper(container, 'status', 'status', 'Status', {\n\t\t\tdescription: 'shows status information about a repository',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: false,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canConfirm() {\n\t\treturn false;\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.commitsView,\n\t\t\tstatus: undefined!,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tif (state.repo == null) {\n\t\t\t\t\t\tstate.counter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcontext.status = (await state.repo.getStatus())!;\n\t\t\tif (context.status == null) return;\n\n\t\t\tcontext.title = `${this.title}${pad(GlyphChars.Dot, 2, 2)}${GitReference.toString(\n\t\t\t\tGitReference.create(context.status.branch, state.repo.path, {\n\t\t\t\t\trefType: 'branch',\n\t\t\t\t\tname: context.status.branch,\n\t\t\t\t\tremote: false,\n\t\t\t\t\tupstream:\n\t\t\t\t\t\tcontext.status.upstream != null ? { name: context.status.upstream, missing: false } : undefined,\n\t\t\t\t}),\n\t\t\t\t{ icon: false },\n\t\t\t)}`;\n\n\t\t\tconst result = yield* showRepositoryStatusStep(state as StatusStepState, context);\n\t\t\tif (result === StepResult.Break) {\n\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\tstate.counter--;\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (result instanceof GitCommandQuickPickItem) {\n\t\t\t\tconst r = yield* result.executeSteps(this.pickedVia);\n\t\t\t\tstate.counter--;\n\t\t\t\tif (r === StepResult.Break) {\n\t\t\t\t\tQuickCommand.endSteps(state);\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (result instanceof CommandQuickPickItem) {\n\t\t\t\tQuickCommand.endSteps(state);\n\n\t\t\t\tvoid result.execute();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n}\n","import { ProgressLocation, QuickPickItem, window } from 'vscode';\nimport { BranchSorting } from '../../config';\nimport { Container } from '../../container';\nimport { GitReference, Repository } from '../../git/models';\nimport { isStringArray } from '../../system/array';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tappendReposToTitle,\n\tinputBranchNameStep,\n\tPartialStepState,\n\tpickBranchOrTagStepMultiRepo,\n\tpickRepositoriesStep,\n\tQuickCommand,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepResultGenerator,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\tshowTags: boolean;\n\ttitle: string;\n}\n\ninterface State {\n\trepos: string | string[] | Repository | Repository[];\n\treference: GitReference;\n\tcreateBranch?: string;\n}\n\ntype SwitchStepState<T extends State = State> = ExcludeSome<StepState<T>, 'repos', string | string[] | Repository>;\n\nexport interface SwitchGitCommandArgs {\n\treadonly command: 'switch' | 'checkout';\n\tconfirm?: boolean;\n\tstate?: Partial<State>;\n}\n\nexport class SwitchGitCommand extends QuickCommand<State> {\n\tconstructor(container: Container, args?: SwitchGitCommandArgs) {\n\t\tsuper(container, 'switch', 'switch', 'Switch', {\n\t\t\tdescription: 'aka checkout, switches the current branch to a specified branch',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.repos != null && (!Array.isArray(args.state.repos) || args.state.repos.length !== 0)) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tif (args?.state?.reference != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: args?.confirm,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\tasync execute(state: SwitchStepState) {\n\t\treturn void (await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Switching ${\n\t\t\t\t\tstate.repos.length === 1 ? state.repos[0].formattedName : `${state.repos.length} repositories`\n\t\t\t\t} to ${state.reference.name}`,\n\t\t\t},\n\t\t\t() =>\n\t\t\t\tPromise.all(\n\t\t\t\t\tstate.repos.map(r =>\n\t\t\t\t\t\tr.switch(state.reference.ref, { createBranch: state.createBranch, progress: false }),\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t));\n\t}\n\n\toverride isMatch(key: string) {\n\t\treturn super.isMatch(key) || key === 'checkout';\n\t}\n\n\toverride isFuzzyMatch(name: string) {\n\t\treturn super.isFuzzyMatch(name) || name === 'checkout';\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.commitsView,\n\t\t\tshowTags: false,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tif (state.repos != null && !Array.isArray(state.repos)) {\n\t\t\tstate.repos = [state.repos] as string[] | Repository[];\n\t\t}\n\n\t\tlet skippedStepOne = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.repos == null || state.repos.length === 0 || isStringArray(state.repos)) {\n\t\t\t\tskippedStepOne = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepOne = true;\n\t\t\t\t\tstate.counter++;\n\n\t\t\t\t\tstate.repos = [context.repos[0]];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoriesStep(\n\t\t\t\t\t\tstate as ExcludeSome<typeof state, 'repos', string | Repository>,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t{ skipIfPossible: state.counter >= 1 },\n\t\t\t\t\t);\n\t\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\t\tstate.repos = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (state.counter < 2 || state.reference == null) {\n\t\t\t\tconst result = yield* pickBranchOrTagStepMultiRepo(state as SwitchStepState, context, {\n\t\t\t\t\tplaceholder: context => `Choose a branch${context.showTags ? ' or tag' : ''} to switch to`,\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\t\t\tif (skippedStepOne) {\n\t\t\t\t\t\tstate.counter--;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.reference = result;\n\t\t\t}\n\n\t\t\tif (GitReference.isBranch(state.reference) && state.reference.remote) {\n\t\t\t\tcontext.title = `Create Branch and ${this.title}`;\n\n\t\t\t\tconst { values: branches } = await this.container.git.getBranches(state.reference.repoPath, {\n\t\t\t\t\tfilter: b => b.upstream?.name === state.reference!.name,\n\t\t\t\t\tsort: { orderBy: BranchSorting.DateDesc },\n\t\t\t\t});\n\n\t\t\t\tif (branches.length === 0) {\n\t\t\t\t\tconst result = yield* inputBranchNameStep(state as SwitchStepState, context, {\n\t\t\t\t\t\tplaceholder: 'Please provide a name for the new branch',\n\t\t\t\t\t\ttitleContext: ` based on ${GitReference.toString(state.reference, {\n\t\t\t\t\t\t\ticon: false,\n\t\t\t\t\t\t})}`,\n\t\t\t\t\t\tvalue: state.createBranch ?? GitReference.getNameWithoutRemote(state.reference),\n\t\t\t\t\t});\n\t\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\t\tstate.createBranch = result;\n\t\t\t\t} else {\n\t\t\t\t\tstate.createBranch = undefined;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tstate.createBranch = undefined;\n\t\t\t}\n\n\t\t\tif (this.confirm(state.confirm)) {\n\t\t\t\tconst result = yield* this.confirmStep(state as SwitchStepState, context);\n\t\t\t\tif (result === StepResult.Break) continue;\n\t\t\t}\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tvoid this.execute(state as SwitchStepState);\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate *confirmStep(state: SwitchStepState, context: Context): StepResultGenerator<void> {\n\t\tconst step: QuickPickStep<QuickPickItem> = this.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tlabel: context.title,\n\t\t\t\t\tdescription: state.createBranch ? '-b' : '',\n\t\t\t\t\tdetail: `Will ${\n\t\t\t\t\t\tstate.createBranch\n\t\t\t\t\t\t\t? `create and switch to a new branch named ${\n\t\t\t\t\t\t\t\t\tstate.createBranch\n\t\t\t\t\t\t\t  } from ${GitReference.toString(state.reference)}`\n\t\t\t\t\t\t\t: `switch to ${GitReference.toString(state.reference)}`\n\t\t\t\t\t} in ${\n\t\t\t\t\t\tstate.repos.length === 1\n\t\t\t\t\t\t\t? `$(repo) ${state.repos[0].formattedName}`\n\t\t\t\t\t\t\t: `${state.repos.length} repositories`\n\t\t\t\t\t}`,\n\t\t\t\t},\n\t\t\t],\n\t\t\tundefined,\n\t\t\t{ placeholder: `Confirm ${context.title}` },\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? undefined : StepResult.Break;\n\t}\n}\n","import { QuickInputButtons, QuickPickItem } from 'vscode';\nimport { Container } from '../../container';\nimport { GitReference, GitTagReference, Repository } from '../../git/models';\nimport { QuickPickItemOfT } from '../../quickpicks/items/common';\nimport { FlagsQuickPickItem } from '../../quickpicks/items/flags';\nimport { pluralize } from '../../system/string';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport {\n\tappendReposToTitle,\n\tAsyncStepResultGenerator,\n\tinputTagNameStep,\n\tPartialStepState,\n\tpickBranchOrTagStep,\n\tpickRepositoryStep,\n\tpickTagsStep,\n\tQuickCommand,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepResultGenerator,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\tshowTags: boolean;\n\ttitle: string;\n}\n\ntype CreateFlags = '--force' | '-m';\n\ninterface CreateState {\n\tsubcommand: 'create';\n\trepo: string | Repository;\n\treference: GitReference;\n\tname: string;\n\tmessage: string;\n\tflags: CreateFlags[];\n}\n\ninterface DeleteState {\n\tsubcommand: 'delete';\n\trepo: string | Repository;\n\treferences: GitTagReference | GitTagReference[];\n}\n\ntype State = CreateState | DeleteState;\ntype TagStepState<T extends State> = SomeNonNullable<StepState<T>, 'subcommand'>;\ntype CreateStepState<T extends CreateState = CreateState> = TagStepState<ExcludeSome<T, 'repo', string>>;\ntype DeleteStepState<T extends DeleteState = DeleteState> = TagStepState<ExcludeSome<T, 'repo', string>>;\n\nconst subcommandToTitleMap = new Map<State['subcommand'], string>([\n\t['create', 'Create'],\n\t['delete', 'Delete'],\n]);\nfunction getTitle(title: string, subcommand: State['subcommand'] | undefined) {\n\treturn subcommand == null ? title : `${subcommandToTitleMap.get(subcommand)} ${title}`;\n}\n\nexport interface TagGitCommandArgs {\n\treadonly command: 'tag';\n\tconfirm?: boolean;\n\tstate?: Partial<State>;\n}\n\nexport class TagGitCommand extends QuickCommand<State> {\n\tprivate subcommand: State['subcommand'] | undefined;\n\n\tconstructor(container: Container, args?: TagGitCommandArgs) {\n\t\tsuper(container, 'tag', 'tag', 'Tag', {\n\t\t\tdescription: 'create, or delete tags',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.subcommand != null) {\n\t\t\tcounter++;\n\n\t\t\tswitch (args.state.subcommand) {\n\t\t\t\tcase 'create':\n\t\t\t\t\tif (args.state.reference != null) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (args.state.name != null) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (args.state.message != null) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'delete':\n\t\t\t\t\tif (\n\t\t\t\t\t\targs.state.references != null &&\n\t\t\t\t\t\t(!Array.isArray(args.state.references) || args.state.references.length !== 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: args?.confirm,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canConfirm(): boolean {\n\t\treturn this.subcommand != null;\n\t}\n\n\toverride get canSkipConfirm(): boolean {\n\t\treturn this.subcommand === 'delete' ? false : super.canSkipConfirm;\n\t}\n\n\toverride get skipConfirmKey() {\n\t\treturn `${this.key}${this.subcommand == null ? '' : `-${this.subcommand}`}:${this.pickedVia}`;\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: this.container.git.openRepositories,\n\t\t\tassociatedView: this.container.tagsView,\n\t\t\tshowTags: false,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tlet skippedStepTwo = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.subcommand == null) {\n\t\t\t\tthis.subcommand = undefined;\n\n\t\t\t\tconst result = yield* this.pickSubcommandStep(state);\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.subcommand = result;\n\t\t\t}\n\n\t\t\tthis.subcommand = state.subcommand;\n\n\t\t\tif (state.counter < 2 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepTwo = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepTwo = true;\n\t\t\t\t\tstate.counter++;\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcontext.title = getTitle(state.subcommand === 'delete' ? 'Tags' : this.title, state.subcommand);\n\n\t\t\tswitch (state.subcommand) {\n\t\t\t\tcase 'create': {\n\t\t\t\t\tyield* this.createCommandSteps(state as CreateStepState, context);\n\t\t\t\t\t// Clear any chosen name, since we are exiting this subcommand\n\t\t\t\t\tstate.name = undefined;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'delete':\n\t\t\t\t\tyield* this.deleteCommandSteps(state as DeleteStepState, context);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tQuickCommand.endSteps(state);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\tif (skippedStepTwo) {\n\t\t\t\tstate.counter--;\n\t\t\t}\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate *pickSubcommandStep(state: PartialStepState<State>): StepResultGenerator<State['subcommand']> {\n\t\tconst step = QuickCommand.createPickStep<QuickPickItemOfT<State['subcommand']>>({\n\t\t\ttitle: this.title,\n\t\t\tplaceholder: `Choose a ${this.label} command`,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'create',\n\t\t\t\t\tdescription: 'creates a new tag',\n\t\t\t\t\tpicked: state.subcommand === 'create',\n\t\t\t\t\titem: 'create',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'delete',\n\t\t\t\t\tdescription: 'deletes the specified tags',\n\t\t\t\t\tpicked: state.subcommand === 'delete',\n\t\t\t\t\titem: 'delete',\n\t\t\t\t},\n\t\t\t],\n\t\t\tbuttons: [QuickInputButtons.Back],\n\t\t});\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n\n\tprivate async *createCommandSteps(state: CreateStepState, context: Context): AsyncStepResultGenerator<void> {\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tif (state.counter < 3 || state.reference == null) {\n\t\t\t\tconst result = yield* pickBranchOrTagStep(state, context, {\n\t\t\t\t\tplaceholder: context =>\n\t\t\t\t\t\t`Choose a branch${context.showTags ? ' or tag' : ''} to create the new tag from`,\n\t\t\t\t\tpicked: state.reference?.ref ?? (await state.repo.getBranch())?.ref,\n\t\t\t\t\ttitleContext: ' from',\n\t\t\t\t\tvalue: GitReference.isRevision(state.reference) ? state.reference.ref : undefined,\n\t\t\t\t});\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.reference = result;\n\t\t\t}\n\n\t\t\tif (state.counter < 4 || state.name == null) {\n\t\t\t\tconst result = yield* inputTagNameStep(state, context, {\n\t\t\t\t\tplaceholder: 'Please provide a name for the new tag',\n\t\t\t\t\ttitleContext: ` at ${GitReference.toString(state.reference, { capitalize: true, icon: false })}`,\n\t\t\t\t\tvalue: state.name ?? GitReference.getNameWithoutRemote(state.reference),\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.name = result;\n\t\t\t}\n\n\t\t\tif (state.counter < 5 || state.message == null) {\n\t\t\t\tconst result = yield* this.createCommandInputMessageStep(state, context);\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.message = result;\n\t\t\t}\n\n\t\t\tif (state.message.length !== 0 && !state.flags.includes('-m')) {\n\t\t\t\tstate.flags.push('-m');\n\t\t\t}\n\n\t\t\tif (this.confirm(state.confirm)) {\n\t\t\t\tconst result = yield* this.createCommandConfirmStep(state, context);\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\tstate.flags = result;\n\t\t\t}\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tvoid state.repo.tag(\n\t\t\t\t...state.flags,\n\t\t\t\t...(state.message.length !== 0 ? [`\"${state.message}\"`] : []),\n\t\t\t\tstate.name,\n\t\t\t\tstate.reference.ref,\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate async *createCommandInputMessageStep(\n\t\tstate: CreateStepState,\n\t\tcontext: Context,\n\t): AsyncStepResultGenerator<string> {\n\t\tconst step = QuickCommand.createInputStep({\n\t\t\ttitle: appendReposToTitle(\n\t\t\t\t`${context.title} at ${GitReference.toString(state.reference, { capitalize: true, icon: false })}`,\n\t\t\t\tstate,\n\t\t\t\tcontext,\n\t\t\t),\n\t\t\tplaceholder: 'Please provide an optional message to annotate the tag',\n\t\t\tvalue: state.message,\n\t\t\tprompt: 'Enter optional message',\n\t\t});\n\n\t\tconst value: StepSelection<typeof step> = yield step;\n\n\t\tif (\n\t\t\t!QuickCommand.canStepContinue(step, state, value) ||\n\t\t\t!(await QuickCommand.canInputStepContinue(step, state, value))\n\t\t) {\n\t\t\treturn StepResult.Break;\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tprivate *createCommandConfirmStep(\n\t\tstate: CreateStepState<CreateState>,\n\t\tcontext: Context,\n\t): StepResultGenerator<CreateFlags[]> {\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<CreateFlags>> = QuickCommand.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\tFlagsQuickPickItem.create<CreateFlags>(state.flags, state.message.length !== 0 ? ['-m'] : [], {\n\t\t\t\t\tlabel: context.title,\n\t\t\t\t\tdescription: state.message.length !== 0 ? '-m' : '',\n\t\t\t\t\tdetail: `Will create a new tag named ${state.name} at ${GitReference.toString(state.reference)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<CreateFlags>(\n\t\t\t\t\tstate.flags,\n\t\t\t\t\tstate.message.length !== 0 ? ['--force', '-m'] : ['--force'],\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: `Force ${context.title}`,\n\t\t\t\t\t\tdescription: `--force${state.message.length !== 0 ? ' -m' : ''}`,\n\t\t\t\t\t\tdetail: `Will forcibly create a new tag named ${state.name} at ${GitReference.toString(\n\t\t\t\t\t\t\tstate.reference,\n\t\t\t\t\t\t)}`,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t],\n\t\t\tcontext,\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n\n\tprivate async *deleteCommandSteps(state: DeleteStepState, context: Context): StepGenerator {\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tif (state.references != null && !Array.isArray(state.references)) {\n\t\t\t\tstate.references = [state.references];\n\t\t\t}\n\n\t\t\tif (state.counter < 3 || state.references == null || state.references.length === 0) {\n\t\t\t\tcontext.title = getTitle('Tags', state.subcommand);\n\n\t\t\t\tconst result = yield* pickTagsStep(state, context, {\n\t\t\t\t\tpicked: state.references?.map(r => r.ref),\n\t\t\t\t\tplaceholder: 'Choose tags to delete',\n\t\t\t\t});\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.references = result;\n\t\t\t}\n\n\t\t\tcontext.title = getTitle(pluralize('Tag', state.references.length, { only: true }), state.subcommand);\n\n\t\t\tconst result = yield* this.deleteCommandConfirmStep(state, context);\n\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t\tvoid state.repo.tagDelete(state.references);\n\t\t}\n\t}\n\n\tprivate *deleteCommandConfirmStep(\n\t\tstate: DeleteStepState<DeleteState>,\n\t\tcontext: Context,\n\t): StepResultGenerator<void> {\n\t\tconst step: QuickPickStep<QuickPickItem> = QuickCommand.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tlabel: context.title,\n\t\t\t\t\tdetail: `Will delete ${GitReference.toString(state.references)}`,\n\t\t\t\t},\n\t\t\t],\n\t\t\tcontext,\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? undefined : StepResult.Break;\n\t}\n}\n","import { MessageItem, QuickInputButtons, Uri, window } from 'vscode';\nimport { configuration } from '../../configuration';\nimport { Container } from '../../container';\nimport { PremiumFeatures } from '../../features';\nimport {\n\tWorktreeCreateError,\n\tWorktreeCreateErrorReason,\n\tWorktreeDeleteError,\n\tWorktreeDeleteErrorReason,\n} from '../../git/errors';\nimport { GitReference, GitWorktree, Repository } from '../../git/models';\nimport { Messages } from '../../messages';\nimport { QuickPickItemOfT, QuickPickSeparator } from '../../quickpicks/items/common';\nimport { Directive } from '../../quickpicks/items/directive';\nimport { FlagsQuickPickItem } from '../../quickpicks/items/flags';\nimport { basename, isDescendent } from '../../system/path';\nimport { pluralize, truncateLeft } from '../../system/string';\nimport { OpenWorkspaceLocation } from '../../system/utils';\nimport { ViewsWithRepositoryFolders } from '../../views/viewBase';\nimport { GitActions } from '../gitCommands.actions';\nimport {\n\tappendReposToTitle,\n\tAsyncStepResultGenerator,\n\tCustomStep,\n\tensureAccessStep,\n\tinputBranchNameStep,\n\tPartialStepState,\n\tpickBranchOrTagStep,\n\tpickRepositoryStep,\n\tpickWorktreesStep,\n\tpickWorktreeStep,\n\tQuickCommand,\n\tQuickPickStep,\n\tStepGenerator,\n\tStepResult,\n\tStepResultGenerator,\n\tStepSelection,\n\tStepState,\n} from '../quickCommand';\n\ninterface Context {\n\trepos: Repository[];\n\tassociatedView: ViewsWithRepositoryFolders;\n\tdefaultUri?: Uri;\n\tpickedUri?: Uri;\n\tshowTags: boolean;\n\ttitle: string;\n\tworktrees?: GitWorktree[];\n}\n\ntype CreateFlags = '--force' | '-b' | '--detach' | '--direct';\n\ninterface CreateState {\n\tsubcommand: 'create';\n\trepo: string | Repository;\n\turi: Uri;\n\treference?: GitReference;\n\tcreateBranch: string;\n\tflags: CreateFlags[];\n}\n\ntype DeleteFlags = '--force';\n\ninterface DeleteState {\n\tsubcommand: 'delete';\n\trepo: string | Repository;\n\turis: Uri[];\n\tflags: DeleteFlags[];\n}\n\ntype OpenFlags = '--new-window' | '--reveal-explorer';\n\ninterface OpenState {\n\tsubcommand: 'open';\n\trepo: string | Repository;\n\turi: Uri;\n\tflags: OpenFlags[];\n}\n\ntype State = CreateState | DeleteState | OpenState;\ntype WorktreeStepState<T extends State> = SomeNonNullable<StepState<T>, 'subcommand'>;\ntype CreateStepState<T extends CreateState = CreateState> = WorktreeStepState<ExcludeSome<T, 'repo', string>>;\ntype DeleteStepState<T extends DeleteState = DeleteState> = WorktreeStepState<ExcludeSome<T, 'repo', string>>;\ntype OpenStepState<T extends OpenState = OpenState> = WorktreeStepState<ExcludeSome<T, 'repo', string>>;\n\nconst subcommandToTitleMap = new Map<State['subcommand'], string>([\n\t['create', 'Create'],\n\t['delete', 'Delete'],\n\t['open', 'Open'],\n]);\nfunction getTitle(title: string, subcommand: State['subcommand'] | undefined) {\n\treturn subcommand == null ? title : `${subcommandToTitleMap.get(subcommand)} ${title}`;\n}\n\nexport interface WorktreeGitCommandArgs {\n\treadonly command: 'worktree';\n\tconfirm?: boolean;\n\tstate?: Partial<State>;\n}\n\nexport class WorktreeGitCommand extends QuickCommand<State> {\n\tprivate subcommand: State['subcommand'] | undefined;\n\tprivate canSkipConfirmOverride: boolean | undefined;\n\n\tconstructor(container: Container, args?: WorktreeGitCommandArgs) {\n\t\tsuper(container, 'worktree', 'worktree', 'Worktree', {\n\t\t\tdescription: 'open, create, or delete worktrees',\n\t\t});\n\n\t\tlet counter = 0;\n\t\tif (args?.state?.subcommand != null) {\n\t\t\tcounter++;\n\n\t\t\tswitch (args.state.subcommand) {\n\t\t\t\tcase 'create':\n\t\t\t\t\tif (args.state.uri != null) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (args.state.reference != null) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'delete':\n\t\t\t\t\tif (args.state.uris != null && (!Array.isArray(args.state.uris) || args.state.uris.length !== 0)) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'open':\n\t\t\t\t\tif (args.state.uri != null) {\n\t\t\t\t\t\tcounter++;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (args?.state?.repo != null) {\n\t\t\tcounter++;\n\t\t}\n\n\t\tthis.initialState = {\n\t\t\tcounter: counter,\n\t\t\tconfirm: args?.confirm,\n\t\t\t...args?.state,\n\t\t};\n\t}\n\n\toverride get canConfirm(): boolean {\n\t\treturn this.subcommand != null;\n\t}\n\n\toverride get canSkipConfirm(): boolean {\n\t\treturn this.canSkipConfirmOverride ?? false;\n\t}\n\n\toverride get skipConfirmKey() {\n\t\treturn `${this.key}${this.subcommand == null ? '' : `-${this.subcommand}`}:${this.pickedVia}`;\n\t}\n\n\tprotected async *steps(state: PartialStepState<State>): StepGenerator {\n\t\tconst context: Context = {\n\t\t\trepos: Container.instance.git.openRepositories,\n\t\t\tassociatedView: Container.instance.worktreesView,\n\t\t\tshowTags: false,\n\t\t\ttitle: this.title,\n\t\t};\n\n\t\tlet skippedStepTwo = false;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tcontext.title = this.title;\n\n\t\t\tif (state.counter < 1 || state.subcommand == null) {\n\t\t\t\tthis.subcommand = undefined;\n\n\t\t\t\tconst result = yield* this.pickSubcommandStep(state);\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.subcommand = result;\n\t\t\t}\n\n\t\t\tthis.subcommand = state.subcommand;\n\n\t\t\tif (state.counter < 2 || state.repo == null || typeof state.repo === 'string') {\n\t\t\t\tskippedStepTwo = false;\n\t\t\t\tif (context.repos.length === 1) {\n\t\t\t\t\tskippedStepTwo = true;\n\t\t\t\t\tstate.counter++;\n\n\t\t\t\t\tstate.repo = context.repos[0];\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* pickRepositoryStep(state, context);\n\t\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\t\tstate.repo = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst result = yield* ensureAccessStep(state as any, context, PremiumFeatures.Worktrees);\n\t\t\tif (result === StepResult.Break) break;\n\n\t\t\tcontext.title = getTitle(state.subcommand === 'delete' ? 'Worktrees' : this.title, state.subcommand);\n\n\t\t\tswitch (state.subcommand) {\n\t\t\t\tcase 'create': {\n\t\t\t\t\tyield* this.createCommandSteps(state as CreateStepState, context);\n\t\t\t\t\t// Clear any chosen path, since we are exiting this subcommand\n\t\t\t\t\tstate.uri = undefined;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'delete': {\n\t\t\t\t\tif (state.uris != null && !Array.isArray(state.uris)) {\n\t\t\t\t\t\tstate.uris = [state.uris];\n\t\t\t\t\t}\n\n\t\t\t\t\tyield* this.deleteCommandSteps(state as DeleteStepState, context);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'open': {\n\t\t\t\t\tyield* this.openCommandSteps(state as OpenStepState, context);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tQuickCommand.endSteps(state);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// If we skipped the previous step, make sure we back up past it\n\t\t\tif (skippedStepTwo) {\n\t\t\t\tstate.counter--;\n\t\t\t}\n\t\t}\n\n\t\treturn state.counter < 0 ? StepResult.Break : undefined;\n\t}\n\n\tprivate *pickSubcommandStep(state: PartialStepState<State>): StepResultGenerator<State['subcommand']> {\n\t\tconst step = QuickCommand.createPickStep<QuickPickItemOfT<State['subcommand']>>({\n\t\t\ttitle: this.title,\n\t\t\tplaceholder: `Choose a ${this.label} command`,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'open',\n\t\t\t\t\tdescription: 'opens the specified worktree',\n\t\t\t\t\tpicked: state.subcommand === 'open',\n\t\t\t\t\titem: 'open',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'create',\n\t\t\t\t\tdescription: 'creates a new worktree',\n\t\t\t\t\tpicked: state.subcommand === 'create',\n\t\t\t\t\titem: 'create',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'delete',\n\t\t\t\t\tdescription: 'deletes the specified worktrees',\n\t\t\t\t\tpicked: state.subcommand === 'delete',\n\t\t\t\t\titem: 'delete',\n\t\t\t\t},\n\t\t\t],\n\t\t\tbuttons: [QuickInputButtons.Back],\n\t\t});\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n\n\tprivate async *createCommandSteps(state: CreateStepState, context: Context): AsyncStepResultGenerator<void> {\n\t\tif (context.defaultUri == null) {\n\t\t\tcontext.defaultUri = await state.repo.getWorktreesDefaultUri();\n\t\t}\n\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\tcontext.pickedUri = undefined;\n\n\t\t// Don't allow skipping the confirm step\n\t\tstate.confirm = true;\n\t\tthis.canSkipConfirmOverride = undefined;\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tif (state.counter < 3 || state.reference == null) {\n\t\t\t\tconst result = yield* pickBranchOrTagStep(state, context, {\n\t\t\t\t\tplaceholder: context =>\n\t\t\t\t\t\t`Choose a branch${context.showTags ? ' or tag' : ''} to create the new worktree for`,\n\t\t\t\t\tpicked: state.reference?.ref ?? (await state.repo.getBranch())?.ref,\n\t\t\t\t\ttitleContext: ' for',\n\t\t\t\t\tvalue: GitReference.isRevision(state.reference) ? state.reference.ref : undefined,\n\t\t\t\t});\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.reference = result;\n\t\t\t}\n\n\t\t\tif (state.counter < 4 || state.uri == null) {\n\t\t\t\tif (\n\t\t\t\t\tstate.reference != null &&\n\t\t\t\t\t!configuration.get('worktrees.promptForLocation', state.repo.folder) &&\n\t\t\t\t\tcontext.defaultUri != null\n\t\t\t\t) {\n\t\t\t\t\tstate.uri = context.defaultUri;\n\t\t\t\t} else {\n\t\t\t\t\tconst result = yield* this.createCommandChoosePathStep(state, context, {\n\t\t\t\t\t\ttitleContext: ` for ${GitReference.toString(state.reference, {\n\t\t\t\t\t\t\tcapitalize: true,\n\t\t\t\t\t\t\ticon: false,\n\t\t\t\t\t\t\tlabel: state.reference.refType !== 'branch',\n\t\t\t\t\t\t})}`,\n\t\t\t\t\t});\n\t\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\t\tstate.uri = result;\n\t\t\t\t\t// Keep track of the actual uri they picked, because we will modify it in later steps\n\t\t\t\t\tcontext.pickedUri = state.uri;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.confirm(state.confirm)) {\n\t\t\t\tconst result = yield* this.createCommandConfirmStep(state, context);\n\t\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\t\t[state.uri, state.flags] = result;\n\t\t\t}\n\n\t\t\t// Reset any confirmation overrides\n\t\t\tstate.confirm = true;\n\t\t\tthis.canSkipConfirmOverride = undefined;\n\n\t\t\tif (state.flags.includes('-b') && state.createBranch == null) {\n\t\t\t\tconst result = yield* inputBranchNameStep(state, context, {\n\t\t\t\t\tplaceholder: 'Please provide a name for the new branch',\n\t\t\t\t\ttitleContext: ` from ${GitReference.toString(state.reference, {\n\t\t\t\t\t\tcapitalize: true,\n\t\t\t\t\t\ticon: false,\n\t\t\t\t\t\tlabel: state.reference.refType !== 'branch',\n\t\t\t\t\t})}`,\n\t\t\t\t\tvalue: state.createBranch ?? GitReference.getNameWithoutRemote(state.reference),\n\t\t\t\t});\n\t\t\t\tif (result === StepResult.Break) {\n\t\t\t\t\t// Clear the flags, since we can backup after the confirm step below (which is non-standard)\n\t\t\t\t\tstate.flags = [];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tstate.createBranch = result;\n\t\t\t}\n\n\t\t\tconst uri = state.flags.includes('--direct')\n\t\t\t\t? state.uri\n\t\t\t\t: Uri.joinPath(\n\t\t\t\t\t\tstate.uri,\n\t\t\t\t\t\t...(state.createBranch ?? state.reference.name).replace(/\\\\/g, '/').split('/'),\n\t\t\t\t  );\n\n\t\t\ttry {\n\t\t\t\tawait state.repo.createWorktree(uri, {\n\t\t\t\t\tcommitish: state.reference?.name,\n\t\t\t\t\tcreateBranch: state.flags.includes('-b') ? state.createBranch : undefined,\n\t\t\t\t\tdetach: state.flags.includes('--detach'),\n\t\t\t\t\tforce: state.flags.includes('--force'),\n\t\t\t\t});\n\t\t\t} catch (ex) {\n\t\t\t\tif (\n\t\t\t\t\tWorktreeCreateError.is(ex, WorktreeCreateErrorReason.AlreadyCheckedOut) &&\n\t\t\t\t\t!state.flags.includes('--force')\n\t\t\t\t) {\n\t\t\t\t\tconst createBranch: MessageItem = { title: 'Create New Branch' };\n\t\t\t\t\tconst force: MessageItem = { title: 'Create Anyway' };\n\t\t\t\t\tconst cancel: MessageItem = { title: 'Cancel', isCloseAffordance: true };\n\t\t\t\t\tconst result = await window.showWarningMessage(\n\t\t\t\t\t\t`Unable to create the new worktree because ${GitReference.toString(state.reference, {\n\t\t\t\t\t\t\ticon: false,\n\t\t\t\t\t\t\tquoted: true,\n\t\t\t\t\t\t})} is already checked out.\\n\\nWould you like to create a new branch for this worktree or forcibly create it anyway?`,\n\t\t\t\t\t\t{ modal: true },\n\t\t\t\t\t\tcreateBranch,\n\t\t\t\t\t\tforce,\n\t\t\t\t\t\tcancel,\n\t\t\t\t\t);\n\n\t\t\t\t\tif (result === createBranch) {\n\t\t\t\t\t\tstate.flags.push('-b');\n\t\t\t\t\t\tthis.canSkipConfirmOverride = true;\n\t\t\t\t\t\tstate.confirm = false;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (result === force) {\n\t\t\t\t\t\tstate.flags.push('--force');\n\t\t\t\t\t\tthis.canSkipConfirmOverride = true;\n\t\t\t\t\t\tstate.confirm = false;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t} else if (WorktreeCreateError.is(ex, WorktreeCreateErrorReason.AlreadyExists)) {\n\t\t\t\t\tvoid window.showErrorMessage(\n\t\t\t\t\t\t`Unable to create a new worktree in '${GitWorktree.getFriendlyPath(\n\t\t\t\t\t\t\turi,\n\t\t\t\t\t\t)}' because the folder already exists and is not empty.`,\n\t\t\t\t\t\t'OK',\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tvoid Messages.showGenericErrorMessage(\n\t\t\t\t\t\t`Unable to create a new worktree in '${GitWorktree.getFriendlyPath(uri)}.`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tQuickCommand.endSteps(state);\n\t\t}\n\t}\n\n\tprivate async *createCommandChoosePathStep(\n\t\tstate: CreateStepState,\n\t\tcontext: Context,\n\t\toptions?: { titleContext?: string },\n\t): AsyncStepResultGenerator<Uri> {\n\t\tconst step = QuickCommand.createCustomStep<Uri>({\n\t\t\tshow: async (_step: CustomStep<Uri>) => {\n\t\t\t\tconst uris = await window.showOpenDialog({\n\t\t\t\t\tcanSelectFiles: false,\n\t\t\t\t\tcanSelectFolders: true,\n\t\t\t\t\tcanSelectMany: false,\n\t\t\t\t\tdefaultUri: context.pickedUri ?? state.uri ?? context.defaultUri,\n\t\t\t\t\topenLabel: 'Select Worktree Location',\n\t\t\t\t\ttitle: `${appendReposToTitle(\n\t\t\t\t\t\t`Choose Worktree Location${options?.titleContext ?? ''}`,\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t)}`,\n\t\t\t\t});\n\n\t\t\t\tif (uris == null || uris.length === 0) return Directive.Back;\n\n\t\t\t\treturn uris[0];\n\t\t\t},\n\t\t});\n\n\t\tconst value: StepSelection<typeof step> = yield step;\n\n\t\tif (\n\t\t\t!QuickCommand.canStepContinue(step, state, value) ||\n\t\t\t!(await QuickCommand.canInputStepContinue(step, state, value))\n\t\t) {\n\t\t\treturn StepResult.Break;\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tprivate *createCommandConfirmStep(\n\t\tstate: CreateStepState,\n\t\tcontext: Context,\n\t): StepResultGenerator<[Uri, CreateFlags[]]> {\n\t\t/**\n\t\t * Here are the rules for creating the recommended path for the new worktree:\n\t\t *\n\t\t * If the user picks a folder outside the repo, it will be `<chosen-path>/<repo>.worktrees/<?branch>`\n\t\t * If the user picks the repo folder, it will be `<repo>/../<repo>.worktrees/<?branch>`\n\t\t * If the user picks a folder inside the repo, it will be `<repo>/../<repo>.worktrees/<?branch>`\n\t\t */\n\n\t\tconst pickedUri = context.pickedUri ?? state.uri;\n\t\tconst pickedFriendlyPath = truncateLeft(GitWorktree.getFriendlyPath(pickedUri), 60);\n\n\t\tlet canCreateDirectlyInPicked = true;\n\t\tlet recommendedRootUri;\n\n\t\tconst repoUri = state.repo.uri;\n\t\tif (repoUri.toString() !== pickedUri.toString()) {\n\t\t\tif (isDescendent(pickedUri, repoUri)) {\n\t\t\t\trecommendedRootUri = Uri.joinPath(repoUri, '..', `${basename(repoUri.path)}.worktrees`);\n\t\t\t} else {\n\t\t\t\trecommendedRootUri = Uri.joinPath(pickedUri, `${basename(repoUri.path)}.worktrees`);\n\t\t\t}\n\t\t} else {\n\t\t\trecommendedRootUri = Uri.joinPath(repoUri, '..', `${basename(repoUri.path)}.worktrees`);\n\t\t\t// Don't allow creating directly into the main worktree folder\n\t\t\tcanCreateDirectlyInPicked = false;\n\t\t}\n\n\t\tconst recommendedUri =\n\t\t\tstate.reference != null\n\t\t\t\t? Uri.joinPath(recommendedRootUri, ...state.reference.name.replace(/\\\\/g, '/').split('/'))\n\t\t\t\t: recommendedRootUri;\n\t\tconst recommendedFriendlyPath = truncateLeft(GitWorktree.getFriendlyPath(recommendedUri), 65);\n\n\t\tconst recommendedNewBranchFriendlyPath = truncateLeft(\n\t\t\tGitWorktree.getFriendlyPath(Uri.joinPath(recommendedRootUri, '<new-branch-name>')),\n\t\t\t60,\n\t\t);\n\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<CreateFlags, Uri>> = QuickCommand.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\tFlagsQuickPickItem.create<CreateFlags, Uri>(\n\t\t\t\t\tstate.flags,\n\t\t\t\t\t[],\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: context.title,\n\t\t\t\t\t\tdescription: ` for ${GitReference.toString(state.reference)}`,\n\t\t\t\t\t\tdetail: `Will create worktree in $(folder) ${recommendedFriendlyPath}`,\n\t\t\t\t\t},\n\t\t\t\t\trecommendedRootUri,\n\t\t\t\t),\n\t\t\t\tFlagsQuickPickItem.create<CreateFlags, Uri>(\n\t\t\t\t\tstate.flags,\n\t\t\t\t\t['-b'],\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Create New Branch and Worktree',\n\t\t\t\t\t\tdescription: ` from ${GitReference.toString(state.reference)}`,\n\t\t\t\t\t\tdetail: `Will create worktree in $(folder) ${recommendedNewBranchFriendlyPath}`,\n\t\t\t\t\t},\n\t\t\t\t\trecommendedRootUri,\n\t\t\t\t),\n\t\t\t\t...(canCreateDirectlyInPicked\n\t\t\t\t\t? [\n\t\t\t\t\t\t\tQuickPickSeparator.create(),\n\t\t\t\t\t\t\tFlagsQuickPickItem.create<CreateFlags, Uri>(\n\t\t\t\t\t\t\t\tstate.flags,\n\t\t\t\t\t\t\t\t['--direct'],\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: `${context.title} (directly in folder)`,\n\t\t\t\t\t\t\t\t\tdescription: ` for ${GitReference.toString(state.reference)}`,\n\t\t\t\t\t\t\t\t\tdetail: `Will create worktree directly in $(folder) ${pickedFriendlyPath}`,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpickedUri,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tFlagsQuickPickItem.create<CreateFlags, Uri>(\n\t\t\t\t\t\t\t\tstate.flags,\n\t\t\t\t\t\t\t\t['-b', '--direct'],\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: 'Create New Branch and Worktree (directly in folder)',\n\t\t\t\t\t\t\t\t\tdescription: ` from ${GitReference.toString(state.reference)}`,\n\t\t\t\t\t\t\t\t\tdetail: `Will create worktree directly in $(folder) ${pickedFriendlyPath}`,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpickedUri,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t  ]\n\t\t\t\t\t: []),\n\t\t\t] as FlagsQuickPickItem<CreateFlags, Uri>[],\n\t\t\tcontext,\n\t\t);\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection)\n\t\t\t? [selection[0].context, selection[0].item]\n\t\t\t: StepResult.Break;\n\t}\n\n\tprivate async *deleteCommandSteps(state: DeleteStepState, context: Context): StepGenerator {\n\t\tcontext.worktrees = await state.repo.getWorktrees();\n\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tif (state.counter < 3 || state.uris == null || state.uris.length === 0) {\n\t\t\t\tcontext.title = getTitle('Worktrees', state.subcommand);\n\n\t\t\t\tconst result = yield* pickWorktreesStep(state, context, {\n\t\t\t\t\tfilter: wt => wt.main || !wt.opened, // Can't delete the main or opened worktree\n\t\t\t\t\tincludeStatus: true,\n\t\t\t\t\tpicked: state.uris?.map(uri => uri.toString()),\n\t\t\t\t\tplaceholder: 'Choose worktrees to delete',\n\t\t\t\t});\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.uris = result.map(w => w.uri);\n\t\t\t}\n\n\t\t\tcontext.title = getTitle(pluralize('Worktree', state.uris.length, { only: true }), state.subcommand);\n\n\t\t\tconst result = yield* this.deleteCommandConfirmStep(state, context);\n\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\tstate.flags = result;\n\n\t\t\tQuickCommand.endSteps(state);\n\n\t\t\tfor (const uri of state.uris) {\n\t\t\t\tlet retry = false;\n\t\t\t\tdo {\n\t\t\t\t\tretry = false;\n\t\t\t\t\tconst force = state.flags.includes('--force');\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (force) {\n\t\t\t\t\t\t\tconst worktree = context.worktrees.find(wt => wt.uri.toString() === uri.toString());\n\t\t\t\t\t\t\tconst status = await worktree?.getStatus();\n\t\t\t\t\t\t\tif (status?.hasChanges ?? false) {\n\t\t\t\t\t\t\t\tconst confirm: MessageItem = { title: 'Force Delete' };\n\t\t\t\t\t\t\t\tconst cancel: MessageItem = { title: 'Cancel', isCloseAffordance: true };\n\t\t\t\t\t\t\t\tconst result = await window.showWarningMessage(\n\t\t\t\t\t\t\t\t\t`The worktree in '${uri.fsPath}' has uncommitted changes.\\n\\nDeleting it will cause those changes to be FOREVER LOST.\\nThis is IRREVERSIBLE!\\n\\nAre you sure you still want to delete it?`,\n\t\t\t\t\t\t\t\t\t{ modal: true },\n\t\t\t\t\t\t\t\t\tconfirm,\n\t\t\t\t\t\t\t\t\tcancel,\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tif (result !== confirm) return;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tawait state.repo.deleteWorktree(uri, { force: force });\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\tif (WorktreeDeleteError.is(ex)) {\n\t\t\t\t\t\t\tif (ex.reason === WorktreeDeleteErrorReason.MainWorkingTree) {\n\t\t\t\t\t\t\t\tvoid window.showErrorMessage('Unable to delete the main worktree');\n\t\t\t\t\t\t\t} else if (!force) {\n\t\t\t\t\t\t\t\tconst confirm: MessageItem = { title: 'Force Delete' };\n\t\t\t\t\t\t\t\tconst cancel: MessageItem = { title: 'Cancel', isCloseAffordance: true };\n\t\t\t\t\t\t\t\tconst result = await window.showErrorMessage(\n\t\t\t\t\t\t\t\t\tex.reason === WorktreeDeleteErrorReason.HasChanges\n\t\t\t\t\t\t\t\t\t\t? `Unable to delete worktree because there are UNCOMMITTED changes in '${uri.fsPath}'.\\n\\nForcibly deleting it will cause those changes to be FOREVER LOST.\\nThis is IRREVERSIBLE!\\n\\nWould you like to forcibly delete it?`\n\t\t\t\t\t\t\t\t\t\t: `Unable to delete worktree in '${uri.fsPath}'.\\n\\nWould you like to try to forcibly delete it?`,\n\t\t\t\t\t\t\t\t\t{ modal: true },\n\t\t\t\t\t\t\t\t\tconfirm,\n\t\t\t\t\t\t\t\t\tcancel,\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tif (result === confirm) {\n\t\t\t\t\t\t\t\t\tstate.flags.push('--force');\n\t\t\t\t\t\t\t\t\tretry = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvoid Messages.showGenericErrorMessage(`Unable to delete worktree in '${uri.fsPath}.`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} while (retry);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate *deleteCommandConfirmStep(state: DeleteStepState, context: Context): StepResultGenerator<DeleteFlags[]> {\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<DeleteFlags>> = QuickCommand.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\tFlagsQuickPickItem.create<DeleteFlags>(state.flags, [], {\n\t\t\t\t\tlabel: context.title,\n\t\t\t\t\tdetail: `Will delete ${pluralize('worktree', state.uris.length, {\n\t\t\t\t\t\tonly: state.uris.length === 1,\n\t\t\t\t\t})}${state.uris.length === 1 ? ` in $(folder) ${GitWorktree.getFriendlyPath(state.uris[0])}` : ''}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<DeleteFlags>(state.flags, ['--force'], {\n\t\t\t\t\tlabel: `Force ${context.title}`,\n\t\t\t\t\tdescription: 'including ANY UNCOMMITTED changes',\n\t\t\t\t\tdetail: `Will forcibly delete ${pluralize('worktree', state.uris.length, {\n\t\t\t\t\t\tonly: state.uris.length === 1,\n\t\t\t\t\t})} ${\n\t\t\t\t\t\tstate.uris.length === 1 ? ` in $(folder) ${GitWorktree.getFriendlyPath(state.uris[0])}` : ''\n\t\t\t\t\t}`,\n\t\t\t\t}),\n\t\t\t],\n\t\t\tcontext,\n\t\t);\n\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n\n\tprivate async *openCommandSteps(state: OpenStepState, context: Context): StepGenerator {\n\t\tcontext.worktrees = await state.repo.getWorktrees();\n\n\t\tif (state.flags == null) {\n\t\t\tstate.flags = [];\n\t\t}\n\n\t\twhile (this.canStepsContinue(state)) {\n\t\t\tif (state.counter < 3 || state.uri == null) {\n\t\t\t\tcontext.title = getTitle('Worktree', state.subcommand);\n\n\t\t\t\tconst result = yield* pickWorktreeStep(state, context, {\n\t\t\t\t\tincludeStatus: true,\n\t\t\t\t\tpicked: state.uri?.toString(),\n\t\t\t\t\tplaceholder: 'Choose worktree to open',\n\t\t\t\t});\n\t\t\t\t// Always break on the first step (so we will go back)\n\t\t\t\tif (result === StepResult.Break) break;\n\n\t\t\t\tstate.uri = result.uri;\n\t\t\t}\n\n\t\t\tcontext.title = getTitle('Worktree', state.subcommand);\n\n\t\t\tconst result = yield* this.openCommandConfirmStep(state, context);\n\t\t\tif (result === StepResult.Break) continue;\n\n\t\t\tstate.flags = result;\n\n\t\t\tQuickCommand.endSteps(state);\n\n\t\t\tconst worktree = context.worktrees.find(wt => wt.uri.toString() === state.uri.toString())!;\n\t\t\tif (state.flags.includes('--reveal-explorer')) {\n\t\t\t\tvoid GitActions.Worktree.revealInFileExplorer(worktree);\n\t\t\t} else {\n\t\t\t\tGitActions.Worktree.open(worktree, {\n\t\t\t\t\tlocation: state.flags.includes('--new-window')\n\t\t\t\t\t\t? OpenWorkspaceLocation.NewWindow\n\t\t\t\t\t\t: OpenWorkspaceLocation.CurrentWindow,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate *openCommandConfirmStep(state: OpenStepState, context: Context): StepResultGenerator<OpenFlags[]> {\n\t\tconst step: QuickPickStep<FlagsQuickPickItem<OpenFlags>> = QuickCommand.createConfirmStep(\n\t\t\tappendReposToTitle(`Confirm ${context.title}`, state, context),\n\t\t\t[\n\t\t\t\tFlagsQuickPickItem.create<OpenFlags>(state.flags, [], {\n\t\t\t\t\tlabel: context.title,\n\t\t\t\t\tdetail: `Will open, in the current window, the worktree in $(folder) ${GitWorktree.getFriendlyPath(\n\t\t\t\t\t\tstate.uri,\n\t\t\t\t\t)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<OpenFlags>(state.flags, ['--new-window'], {\n\t\t\t\t\tlabel: `${context.title} in a New Window`,\n\t\t\t\t\tdetail: `Will open, in a new window, the worktree in $(folder) ${GitWorktree.getFriendlyPath(\n\t\t\t\t\t\tstate.uri,\n\t\t\t\t\t)}`,\n\t\t\t\t}),\n\t\t\t\tFlagsQuickPickItem.create<OpenFlags>(state.flags, ['--reveal-explorer'], {\n\t\t\t\t\tlabel: `Reveal in File Explorer`,\n\t\t\t\t\tdetail: `Will open, in the File Explorer, the worktree in $(folder) ${GitWorktree.getFriendlyPath(\n\t\t\t\t\t\tstate.uri,\n\t\t\t\t\t)}`,\n\t\t\t\t}),\n\t\t\t],\n\t\t\tcontext,\n\t\t);\n\n\t\tconst selection: StepSelection<typeof step> = yield step;\n\t\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n\t}\n}\n","import { GitCommandSorting } from '../config';\nimport { ContextKeys } from '../constants';\nimport type { Container } from '../container';\nimport { getContext } from '../context';\nimport { Usage, WorkspaceStorageKeys } from '../storage';\nimport { BranchGitCommand } from './git/branch';\nimport { CherryPickGitCommand } from './git/cherry-pick';\nimport { CoAuthorsGitCommand } from './git/coauthors';\nimport { FetchGitCommand } from './git/fetch';\nimport { LogGitCommand } from './git/log';\nimport { MergeGitCommand } from './git/merge';\nimport { PullGitCommand } from './git/pull';\nimport { PushGitCommand } from './git/push';\nimport { RebaseGitCommand } from './git/rebase';\nimport { ResetGitCommand } from './git/reset';\nimport { RevertGitCommand } from './git/revert';\nimport { SearchGitCommand } from './git/search';\nimport { ShowGitCommand } from './git/show';\nimport { StashGitCommand } from './git/stash';\nimport { StatusGitCommand } from './git/status';\nimport { SwitchGitCommand } from './git/switch';\nimport { TagGitCommand } from './git/tag';\nimport { WorktreeGitCommand } from './git/worktree';\nimport type { GitCommandsCommandArgs } from './gitCommands';\nimport type { QuickCommand, QuickPickStep, StepGenerator } from './quickCommand';\n\nfunction* nullSteps(): StepGenerator {\n\t/* noop */\n}\n\nexport function getSteps(\n\tcontainer: Container,\n\targs: GitCommandsCommandArgs,\n\tpickedVia: 'menu' | 'command',\n): StepGenerator {\n\tconst commandsStep = new PickCommandStep(container, args);\n\n\tconst command = commandsStep.find(args.command);\n\tif (command == null) return nullSteps();\n\n\tcommandsStep.setCommand(command, pickedVia);\n\n\treturn command.executeSteps();\n}\n\nexport class PickCommandStep implements QuickPickStep {\n\treadonly buttons = [];\n\tprivate readonly hiddenItems: QuickCommand[];\n\tignoreFocusOut = false;\n\treadonly items: QuickCommand[];\n\treadonly matchOnDescription = true;\n\treadonly placeholder = 'Choose a git command';\n\treadonly title = 'GitLens';\n\n\tconstructor(private readonly container: Container, args?: GitCommandsCommandArgs) {\n\t\tconst hasVirtualFolders = getContext<boolean>(ContextKeys.HasVirtualFolders, false);\n\t\tconst readonly =\n\t\t\thasVirtualFolders ||\n\t\t\tgetContext<boolean>(ContextKeys.Readonly, false) ||\n\t\t\tgetContext<boolean>(ContextKeys.Untrusted, false);\n\n\t\tthis.items = [\n\t\t\treadonly ? undefined : new BranchGitCommand(container, args?.command === 'branch' ? args : undefined),\n\t\t\treadonly\n\t\t\t\t? undefined\n\t\t\t\t: new CherryPickGitCommand(container, args?.command === 'cherry-pick' ? args : undefined),\n\t\t\thasVirtualFolders\n\t\t\t\t? undefined\n\t\t\t\t: new CoAuthorsGitCommand(container, args?.command === 'co-authors' ? args : undefined),\n\t\t\treadonly ? undefined : new FetchGitCommand(container, args?.command === 'fetch' ? args : undefined),\n\t\t\tnew LogGitCommand(container, args?.command === 'log' ? args : undefined),\n\t\t\treadonly ? undefined : new MergeGitCommand(container, args?.command === 'merge' ? args : undefined),\n\t\t\treadonly ? undefined : new PullGitCommand(container, args?.command === 'pull' ? args : undefined),\n\t\t\treadonly ? undefined : new PushGitCommand(container, args?.command === 'push' ? args : undefined),\n\t\t\treadonly ? undefined : new RebaseGitCommand(container, args?.command === 'rebase' ? args : undefined),\n\t\t\treadonly ? undefined : new ResetGitCommand(container, args?.command === 'reset' ? args : undefined),\n\t\t\treadonly ? undefined : new RevertGitCommand(container, args?.command === 'revert' ? args : undefined),\n\t\t\tnew SearchGitCommand(container, args?.command === 'search' || args?.command === 'grep' ? args : undefined),\n\n\t\t\tnew ShowGitCommand(container, args?.command === 'show' ? args : undefined),\n\t\t\thasVirtualFolders\n\t\t\t\t? undefined\n\t\t\t\t: new StashGitCommand(container, args?.command === 'stash' ? args : undefined),\n\t\t\thasVirtualFolders\n\t\t\t\t? undefined\n\t\t\t\t: new StatusGitCommand(container, args?.command === 'status' ? args : undefined),\n\t\t\treadonly\n\t\t\t\t? undefined\n\t\t\t\t: new SwitchGitCommand(\n\t\t\t\t\t\tcontainer,\n\t\t\t\t\t\targs?.command === 'switch' || args?.command === 'checkout' ? args : undefined,\n\t\t\t\t  ),\n\t\t\treadonly ? undefined : new TagGitCommand(container, args?.command === 'tag' ? args : undefined),\n\t\t\thasVirtualFolders\n\t\t\t\t? undefined\n\t\t\t\t: new WorktreeGitCommand(container, args?.command === 'worktree' ? args : undefined),\n\t\t].filter(<T>(i: T | undefined): i is T => i != null);\n\n\t\tif (this.container.config.gitCommands.sortBy === GitCommandSorting.Usage) {\n\t\t\tconst usage = this.container.storage.getWorkspace<Usage>(WorkspaceStorageKeys.GitCommandPaletteUsage);\n\t\t\tif (usage != null) {\n\t\t\t\tthis.items.sort((a, b) => (usage[b.key] ?? 0) - (usage[a.key] ?? 0));\n\t\t\t}\n\t\t}\n\n\t\tthis.hiddenItems = [];\n\t}\n\n\tprivate _command: QuickCommand | undefined;\n\tget command(): QuickCommand | undefined {\n\t\treturn this._command;\n\t}\n\n\tfind(commandName: string, fuzzy: boolean = false) {\n\t\tif (fuzzy) {\n\t\t\tconst cmd = commandName.toLowerCase();\n\t\t\treturn this.items.find(c => c.isFuzzyMatch(cmd)) ?? this.hiddenItems.find(c => c.isFuzzyMatch(cmd));\n\t\t}\n\n\t\treturn this.items.find(c => c.isMatch(commandName)) ?? this.hiddenItems.find(c => c.isMatch(commandName));\n\t}\n\n\tsetCommand(command: QuickCommand | undefined, via: 'menu' | 'command'): void {\n\t\tif (this._command != null) {\n\t\t\tthis._command.picked = false;\n\t\t}\n\n\t\tif (command != null) {\n\t\t\tcommand.picked = true;\n\t\t\tcommand.pickedVia = via;\n\t\t}\n\n\t\tthis._command = command;\n\t\tif (command != null) {\n\t\t\tvoid this.updateCommandUsage(command.key, Date.now());\n\t\t}\n\t}\n\n\tprivate async updateCommandUsage(id: string, timestamp: number) {\n\t\tlet usage = this.container.storage.getWorkspace<Usage>(WorkspaceStorageKeys.GitCommandPaletteUsage);\n\t\tif (usage === undefined) {\n\t\t\tusage = Object.create(null) as Usage;\n\t\t}\n\n\t\tusage[id] = timestamp;\n\t\tawait this.container.storage.storeWorkspace(WorkspaceStorageKeys.GitCommandPaletteUsage, usage);\n\t}\n}\n","import { QuickInput, QuickInputButton, ThemeIcon, Uri } from 'vscode';\nimport { Container } from '../container';\n\nexport class ToggleQuickInputButton implements QuickInputButton {\n\tconstructor(\n\t\tprivate readonly state:\n\t\t\t| {\n\t\t\t\t\ton: { icon: string | { light: Uri; dark: Uri } | ThemeIcon; tooltip: string };\n\t\t\t\t\toff: { icon: string | { light: Uri; dark: Uri } | ThemeIcon; tooltip: string };\n\t\t\t  }\n\t\t\t| (() => {\n\t\t\t\t\ton: { icon: string | { light: Uri; dark: Uri } | ThemeIcon; tooltip: string };\n\t\t\t\t\toff: { icon: string | { light: Uri; dark: Uri } | ThemeIcon; tooltip: string };\n\t\t\t  }),\n\t\tprivate _on = false,\n\t) {}\n\n\tget iconPath(): { light: Uri; dark: Uri } | ThemeIcon {\n\t\tconst icon = this.getToggledState().icon;\n\t\treturn typeof icon === 'string'\n\t\t\t? {\n\t\t\t\t\tdark: Uri.file(Container.instance.context.asAbsolutePath(`images/dark/${icon}.svg`)),\n\t\t\t\t\tlight: Uri.file(Container.instance.context.asAbsolutePath(`images/light/${icon}.svg`)),\n\t\t\t  }\n\t\t\t: icon;\n\t}\n\n\tget tooltip(): string {\n\t\treturn this.getToggledState().tooltip;\n\t}\n\n\tget on() {\n\t\treturn this._on;\n\t}\n\tset on(value: boolean) {\n\t\tthis._on = value;\n\t}\n\n\t/**\n\t * @returns `true` if the step should be retried (refreshed)\n\t */\n\tonDidClick?(quickInput: QuickInput): boolean | void | Promise<boolean | void>;\n\n\tprivate getState() {\n\t\treturn typeof this.state === 'function' ? this.state() : this.state;\n\t}\n\n\tprivate getToggledState() {\n\t\treturn this.on ? this.getState().on : this.getState().off;\n\t}\n}\n\nexport class SelectableQuickInputButton extends ToggleQuickInputButton {\n\tconstructor(tooltip: string, icon: { off: string | ThemeIcon; on: string | ThemeIcon }, selected: boolean = false) {\n\t\tsuper({ off: { tooltip: tooltip, icon: icon.off }, on: { tooltip: tooltip, icon: icon.on } }, selected);\n\t}\n}\n\nexport namespace QuickCommandButtons {\n\texport const Fetch: QuickInputButton = {\n\t\ticonPath: new ThemeIcon('sync'),\n\t\ttooltip: 'Fetch',\n\t};\n\n\texport const LoadMore: QuickInputButton = {\n\t\ticonPath: new ThemeIcon('refresh'),\n\t\ttooltip: 'Load More',\n\t};\n\n\texport const MatchCaseToggle = class extends SelectableQuickInputButton {\n\t\tconstructor(on = false) {\n\t\t\tsuper('Match Case', { off: 'icon-match-case', on: 'icon-match-case-selected' }, on);\n\t\t}\n\t};\n\n\texport const MatchAllToggle = class extends SelectableQuickInputButton {\n\t\tconstructor(on = false) {\n\t\t\tsuper('Match All', { off: 'icon-match-all', on: 'icon-match-all-selected' }, on);\n\t\t}\n\t};\n\n\texport const MatchRegexToggle = class extends SelectableQuickInputButton {\n\t\tconstructor(on = false) {\n\t\t\tsuper('Match using Regular Expressions', { off: 'icon-match-regex', on: 'icon-match-regex-selected' }, on);\n\t\t}\n\t};\n\n\texport const PickCommit: QuickInputButton = {\n\t\ticonPath: new ThemeIcon('git-commit'),\n\t\ttooltip: 'Choose a Specific Commit',\n\t};\n\n\texport const PickCommitToggle = class extends ToggleQuickInputButton {\n\t\tconstructor(on = false, context: { showTags: boolean }, onDidClick?: (quickInput: QuickInput) => void) {\n\t\t\tsuper(\n\t\t\t\t() => ({\n\t\t\t\t\ton: { tooltip: 'Choose a Specific Commit', icon: new ThemeIcon('git-commit') },\n\t\t\t\t\toff: {\n\t\t\t\t\t\ttooltip: `Choose a Branch${context.showTags ? ' or Tag' : ''}`,\n\t\t\t\t\t\ticon: new ThemeIcon('git-branch'),\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\ton,\n\t\t\t);\n\n\t\t\tthis.onDidClick = onDidClick;\n\t\t}\n\t};\n\n\texport const OpenInNewWindow: QuickInputButton = {\n\t\ticonPath: new ThemeIcon('empty-window'),\n\t\ttooltip: 'Open in New Window',\n\t};\n\n\texport const RevealInSideBar: QuickInputButton = {\n\t\ticonPath: new ThemeIcon('eye'),\n\t\ttooltip: 'Reveal in Side Bar',\n\t};\n\n\texport const SearchInSideBar: QuickInputButton = {\n\t\ticonPath: new ThemeIcon('search'),\n\t\ttooltip: 'Search in Side Bar',\n\t};\n\n\texport const ShowResultsInSideBar: QuickInputButton = {\n\t\ticonPath: new ThemeIcon('link-external'),\n\t\ttooltip: 'Show Results in Side Bar',\n\t};\n\n\texport const ShowTagsToggle = class extends SelectableQuickInputButton {\n\t\tconstructor(on = false) {\n\t\t\tsuper('Show Tags', { off: new ThemeIcon('tag'), on: 'icon-tag-selected' }, on);\n\t\t}\n\t};\n\n\texport const WillConfirmForced: QuickInputButton = {\n\t\ticonPath: new ThemeIcon('check'),\n\t\ttooltip: 'Will always confirm',\n\t};\n\n\texport const WillConfirmToggle = class extends ToggleQuickInputButton {\n\t\tconstructor(on = false, onDidClick?: (quickInput: QuickInput) => void) {\n\t\t\tsuper(\n\t\t\t\t() => ({\n\t\t\t\t\ton: {\n\t\t\t\t\t\ttooltip: 'Will confirm',\n\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\tdark: Uri.file(Container.instance.context.asAbsolutePath('images/dark/icon-check.svg')),\n\t\t\t\t\t\t\tlight: Uri.file(Container.instance.context.asAbsolutePath('images/light/icon-check.svg')),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\toff: {\n\t\t\t\t\t\ttooltip: 'Skips confirm',\n\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\tdark: Uri.file(Container.instance.context.asAbsolutePath('images/dark/icon-no-check.svg')),\n\t\t\t\t\t\t\tlight: Uri.file(\n\t\t\t\t\t\t\t\tContainer.instance.context.asAbsolutePath('images/light/icon-no-check.svg'),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\ton,\n\t\t\t);\n\n\t\t\tthis.onDidClick = onDidClick;\n\t\t}\n\t};\n}\n","/**\n * The base implementation of `_.isNaN` without support for number objects.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.\n */\nfunction baseIsNaN(value) {\n  return value !== value;\n}\n\nexport default baseIsNaN;\n","/**\n * A specialized version of `_.indexOf` which performs strict equality\n * comparisons of values, i.e. `===`.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} value The value to search for.\n * @param {number} fromIndex The index to search from.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction strictIndexOf(array, value, fromIndex) {\n  var index = fromIndex - 1,\n      length = array.length;\n\n  while (++index < length) {\n    if (array[index] === value) {\n      return index;\n    }\n  }\n  return -1;\n}\n\nexport default strictIndexOf;\n","import baseFindIndex from './_baseFindIndex.js';\nimport baseIsNaN from './_baseIsNaN.js';\nimport strictIndexOf from './_strictIndexOf.js';\n\n/**\n * The base implementation of `_.indexOf` without `fromIndex` bounds checks.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} value The value to search for.\n * @param {number} fromIndex The index to search from.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseIndexOf(array, value, fromIndex) {\n  return value === value\n    ? strictIndexOf(array, value, fromIndex)\n    : baseFindIndex(array, baseIsNaN, fromIndex);\n}\n\nexport default baseIndexOf;\n","import baseIndexOf from './_baseIndexOf.js';\n\n/**\n * A specialized version of `_.includes` for arrays without support for\n * specifying an index to search from.\n *\n * @private\n * @param {Array} [array] The array to inspect.\n * @param {*} target The value to search for.\n * @returns {boolean} Returns `true` if `target` is found, else `false`.\n */\nfunction arrayIncludes(array, value) {\n  var length = array == null ? 0 : array.length;\n  return !!length && baseIndexOf(array, value, 0) > -1;\n}\n\nexport default arrayIncludes;\n","/**\n * This function is like `arrayIncludes` except that it accepts a comparator.\n *\n * @private\n * @param {Array} [array] The array to inspect.\n * @param {*} target The value to search for.\n * @param {Function} comparator The comparator invoked per element.\n * @returns {boolean} Returns `true` if `target` is found, else `false`.\n */\nfunction arrayIncludesWith(array, value, comparator) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (comparator(value, array[index])) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport default arrayIncludesWith;\n","import SetCache from './_SetCache.js';\nimport arrayIncludes from './_arrayIncludes.js';\nimport arrayIncludesWith from './_arrayIncludesWith.js';\nimport arrayMap from './_arrayMap.js';\nimport baseUnary from './_baseUnary.js';\nimport cacheHas from './_cacheHas.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMin = Math.min;\n\n/**\n * The base implementation of methods like `_.intersection`, without support\n * for iteratee shorthands, that accepts an array of arrays to inspect.\n *\n * @private\n * @param {Array} arrays The arrays to inspect.\n * @param {Function} [iteratee] The iteratee invoked per element.\n * @param {Function} [comparator] The comparator invoked per element.\n * @returns {Array} Returns the new array of shared values.\n */\nfunction baseIntersection(arrays, iteratee, comparator) {\n  var includes = comparator ? arrayIncludesWith : arrayIncludes,\n      length = arrays[0].length,\n      othLength = arrays.length,\n      othIndex = othLength,\n      caches = Array(othLength),\n      maxLength = Infinity,\n      result = [];\n\n  while (othIndex--) {\n    var array = arrays[othIndex];\n    if (othIndex && iteratee) {\n      array = arrayMap(array, baseUnary(iteratee));\n    }\n    maxLength = nativeMin(array.length, maxLength);\n    caches[othIndex] = !comparator && (iteratee || (length >= 120 && array.length >= 120))\n      ? new SetCache(othIndex && array)\n      : undefined;\n  }\n  array = arrays[0];\n\n  var index = -1,\n      seen = caches[0];\n\n  outer:\n  while (++index < length && result.length < maxLength) {\n    var value = array[index],\n        computed = iteratee ? iteratee(value) : value;\n\n    value = (comparator || value !== 0) ? value : 0;\n    if (!(seen\n          ? cacheHas(seen, computed)\n          : includes(result, computed, comparator)\n        )) {\n      othIndex = othLength;\n      while (--othIndex) {\n        var cache = caches[othIndex];\n        if (!(cache\n              ? cacheHas(cache, computed)\n              : includes(arrays[othIndex], computed, comparator))\n            ) {\n          continue outer;\n        }\n      }\n      if (seen) {\n        seen.push(computed);\n      }\n      result.push(value);\n    }\n  }\n  return result;\n}\n\nexport default baseIntersection;\n","/**\n * A faster alternative to `Function#apply`, this function invokes `func`\n * with the `this` binding of `thisArg` and the arguments of `args`.\n *\n * @private\n * @param {Function} func The function to invoke.\n * @param {*} thisArg The `this` binding of `func`.\n * @param {Array} args The arguments to invoke `func` with.\n * @returns {*} Returns the result of `func`.\n */\nfunction apply(func, thisArg, args) {\n  switch (args.length) {\n    case 0: return func.call(thisArg);\n    case 1: return func.call(thisArg, args[0]);\n    case 2: return func.call(thisArg, args[0], args[1]);\n    case 3: return func.call(thisArg, args[0], args[1], args[2]);\n  }\n  return func.apply(thisArg, args);\n}\n\nexport default apply;\n","import apply from './_apply.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\n\n/**\n * A specialized version of `baseRest` which transforms the rest array.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @param {Function} transform The rest array transform.\n * @returns {Function} Returns the new function.\n */\nfunction overRest(func, start, transform) {\n  start = nativeMax(start === undefined ? (func.length - 1) : start, 0);\n  return function() {\n    var args = arguments,\n        index = -1,\n        length = nativeMax(args.length - start, 0),\n        array = Array(length);\n\n    while (++index < length) {\n      array[index] = args[start + index];\n    }\n    index = -1;\n    var otherArgs = Array(start + 1);\n    while (++index < start) {\n      otherArgs[index] = args[index];\n    }\n    otherArgs[start] = transform(array);\n    return apply(func, this, otherArgs);\n  };\n}\n\nexport default overRest;\n","/**\n * Creates a function that returns `value`.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Util\n * @param {*} value The value to return from the new function.\n * @returns {Function} Returns the new constant function.\n * @example\n *\n * var objects = _.times(2, _.constant({ 'a': 1 }));\n *\n * console.log(objects);\n * // => [{ 'a': 1 }, { 'a': 1 }]\n *\n * console.log(objects[0] === objects[1]);\n * // => true\n */\nfunction constant(value) {\n  return function() {\n    return value;\n  };\n}\n\nexport default constant;\n","import getNative from './_getNative.js';\n\nvar defineProperty = (function() {\n  try {\n    var func = getNative(Object, 'defineProperty');\n    func({}, '', {});\n    return func;\n  } catch (e) {}\n}());\n\nexport default defineProperty;\n","import constant from './constant.js';\nimport defineProperty from './_defineProperty.js';\nimport identity from './identity.js';\n\n/**\n * The base implementation of `setToString` without support for hot loop shorting.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar baseSetToString = !defineProperty ? identity : function(func, string) {\n  return defineProperty(func, 'toString', {\n    'configurable': true,\n    'enumerable': false,\n    'value': constant(string),\n    'writable': true\n  });\n};\n\nexport default baseSetToString;\n","/** Used to detect hot functions by number of calls within a span of milliseconds. */\nvar HOT_COUNT = 800,\n    HOT_SPAN = 16;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeNow = Date.now;\n\n/**\n * Creates a function that'll short out and invoke `identity` instead\n * of `func` when it's called `HOT_COUNT` or more times in `HOT_SPAN`\n * milliseconds.\n *\n * @private\n * @param {Function} func The function to restrict.\n * @returns {Function} Returns the new shortable function.\n */\nfunction shortOut(func) {\n  var count = 0,\n      lastCalled = 0;\n\n  return function() {\n    var stamp = nativeNow(),\n        remaining = HOT_SPAN - (stamp - lastCalled);\n\n    lastCalled = stamp;\n    if (remaining > 0) {\n      if (++count >= HOT_COUNT) {\n        return arguments[0];\n      }\n    } else {\n      count = 0;\n    }\n    return func.apply(undefined, arguments);\n  };\n}\n\nexport default shortOut;\n","import baseSetToString from './_baseSetToString.js';\nimport shortOut from './_shortOut.js';\n\n/**\n * Sets the `toString` method of `func` to return `string`.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar setToString = shortOut(baseSetToString);\n\nexport default setToString;\n","import identity from './identity.js';\nimport overRest from './_overRest.js';\nimport setToString from './_setToString.js';\n\n/**\n * The base implementation of `_.rest` which doesn't validate or coerce arguments.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @returns {Function} Returns the new function.\n */\nfunction baseRest(func, start) {\n  return setToString(overRest(func, start, identity), func + '');\n}\n\nexport default baseRest;\n","import isArrayLike from './isArrayLike.js';\nimport isObjectLike from './isObjectLike.js';\n\n/**\n * This method is like `_.isArrayLike` except that it also checks if `value`\n * is an object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array-like object,\n *  else `false`.\n * @example\n *\n * _.isArrayLikeObject([1, 2, 3]);\n * // => true\n *\n * _.isArrayLikeObject(document.body.children);\n * // => true\n *\n * _.isArrayLikeObject('abc');\n * // => false\n *\n * _.isArrayLikeObject(_.noop);\n * // => false\n */\nfunction isArrayLikeObject(value) {\n  return isObjectLike(value) && isArrayLike(value);\n}\n\nexport default isArrayLikeObject;\n","import isArrayLikeObject from './isArrayLikeObject.js';\n\n/**\n * Casts `value` to an empty array if it's not an array like object.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {Array|Object} Returns the cast array-like object.\n */\nfunction castArrayLikeObject(value) {\n  return isArrayLikeObject(value) ? value : [];\n}\n\nexport default castArrayLikeObject;\n","/**\n * Gets the last element of `array`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to query.\n * @returns {*} Returns the last element of `array`.\n * @example\n *\n * _.last([1, 2, 3]);\n * // => 3\n */\nfunction last(array) {\n  var length = array == null ? 0 : array.length;\n  return length ? array[length - 1] : undefined;\n}\n\nexport default last;\n","import arrayMap from './_arrayMap.js';\nimport baseIntersection from './_baseIntersection.js';\nimport baseRest from './_baseRest.js';\nimport castArrayLikeObject from './_castArrayLikeObject.js';\nimport last from './last.js';\n\n/**\n * This method is like `_.intersection` except that it accepts `comparator`\n * which is invoked to compare elements of `arrays`. The order and references\n * of result values are determined by the first array. The comparator is\n * invoked with two arguments: (arrVal, othVal).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Array\n * @param {...Array} [arrays] The arrays to inspect.\n * @param {Function} [comparator] The comparator invoked per element.\n * @returns {Array} Returns the new array of intersecting values.\n * @example\n *\n * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];\n * var others = [{ 'x': 1, 'y': 1 }, { 'x': 1, 'y': 2 }];\n *\n * _.intersectionWith(objects, others, _.isEqual);\n * // => [{ 'x': 1, 'y': 2 }]\n */\nvar intersectionWith = baseRest(function(arrays) {\n  var comparator = last(arrays),\n      mapped = arrayMap(arrays, castArrayLikeObject);\n\n  comparator = typeof comparator == 'function' ? comparator : undefined;\n  if (comparator) {\n    mapped.pop();\n  }\n  return (mapped.length && mapped[0] === arrays[0])\n    ? baseIntersection(mapped, undefined, comparator)\n    : [];\n});\n\nexport default intersectionWith;\n","import { QuickInputButton, QuickPick } from 'vscode';\nimport { BranchSorting, configuration, TagSorting } from '../configuration';\nimport { Commands, GlyphChars, quickPickTitleMaxChars } from '../constants';\nimport { Container } from '../container';\nimport type { PremiumFeatures } from '../features';\nimport type { PagedResult } from '../git/gitProvider';\nimport {\n\tBranchSortOptions,\n\tGitBranch,\n\tGitBranchReference,\n\tGitCommit,\n\tGitContributor,\n\tGitLog,\n\tGitReference,\n\tGitRemote,\n\tGitRevision,\n\tGitRevisionReference,\n\tGitStash,\n\tGitStashCommit,\n\tGitStatus,\n\tGitTag,\n\tGitTagReference,\n\tGitWorktree,\n\tRepository,\n\tTagSortOptions,\n} from '../git/models';\nimport { RemoteResourceType } from '../git/remotes/provider';\nimport { SearchPattern } from '../git/search';\nimport {\n\tCommitApplyFileChangesCommandQuickPickItem,\n\tCommitBrowseRepositoryFromHereCommandQuickPickItem,\n\tCommitCompareWithHEADCommandQuickPickItem,\n\tCommitCompareWithWorkingCommandQuickPickItem,\n\tCommitCopyIdQuickPickItem,\n\tCommitCopyMessageQuickPickItem,\n\tCommitFileQuickPickItem,\n\tCommitFilesQuickPickItem,\n\tCommitOpenAllChangesCommandQuickPickItem,\n\tCommitOpenAllChangesWithDiffToolCommandQuickPickItem,\n\tCommitOpenAllChangesWithWorkingCommandQuickPickItem,\n\tCommitOpenChangesCommandQuickPickItem,\n\tCommitOpenChangesWithDiffToolCommandQuickPickItem,\n\tCommitOpenChangesWithWorkingCommandQuickPickItem,\n\tCommitOpenDirectoryCompareCommandQuickPickItem,\n\tCommitOpenDirectoryCompareWithWorkingCommandQuickPickItem,\n\tCommitOpenFileCommandQuickPickItem,\n\tCommitOpenFilesCommandQuickPickItem,\n\tCommitOpenRevisionCommandQuickPickItem,\n\tCommitOpenRevisionsCommandQuickPickItem,\n\tCommitRestoreFileChangesCommandQuickPickItem,\n\tOpenChangedFilesCommandQuickPickItem,\n} from '../quickpicks/items/commits';\nimport { CommandQuickPickItem, QuickPickSeparator } from '../quickpicks/items/common';\nimport { Directive, DirectiveQuickPickItem } from '../quickpicks/items/directive';\nimport {\n\tBranchQuickPickItem,\n\tCommitQuickPickItem,\n\tContributorQuickPickItem,\n\tGitCommandQuickPickItem,\n\tRefQuickPickItem,\n\tRepositoryQuickPickItem,\n\tTagQuickPickItem,\n\tWorktreeQuickPickItem,\n} from '../quickpicks/items/gitCommands';\nimport { ReferencesQuickPickItem } from '../quickpicks/referencePicker';\nimport {\n\tCopyRemoteResourceCommandQuickPickItem,\n\tOpenRemoteResourceCommandQuickPickItem,\n} from '../quickpicks/remoteProviderPicker';\nimport { isSubscriptionPaidPlan, isSubscriptionPreviewTrialExpired } from '../subscription';\nimport { filterMap, intersection, isStringArray } from '../system/array';\nimport { formatPath } from '../system/formatPath';\nimport { map } from '../system/iterable';\nimport { pad, pluralize, truncate } from '../system/string';\nimport { OpenWorkspaceLocation } from '../system/utils';\nimport type { ViewsWithRepositoryFolders } from '../views/viewBase';\nimport { GitActions } from './gitCommands.actions';\nimport {\n\tAsyncStepResultGenerator,\n\tPartialStepState,\n\tQuickCommand,\n\tQuickCommandButtons,\n\tQuickPickStep,\n\tStepResult,\n\tStepResultGenerator,\n\tStepSelection,\n\tStepState,\n} from './quickCommand';\n\nexport function appendReposToTitle<\n\tState extends { repo: Repository } | { repos: Repository[] },\n\tContext extends { repos: Repository[] },\n>(title: string, state: State, context: Context, additionalContext?: string) {\n\tif (context.repos.length === 1) {\n\t\treturn `${title}${truncate(additionalContext ?? '', quickPickTitleMaxChars - title.length)}`;\n\t}\n\n\tlet repoContext;\n\tif ((state as { repo: Repository }).repo != null) {\n\t\trepoContext = `${additionalContext ?? ''}${pad(GlyphChars.Dot, 2, 2)}${\n\t\t\t(state as { repo: Repository }).repo.formattedName\n\t\t}`;\n\t} else if ((state as { repos: Repository[] }).repos.length === 1) {\n\t\trepoContext = `${additionalContext ?? ''}${pad(GlyphChars.Dot, 2, 2)}${\n\t\t\t(state as { repos: Repository[] }).repos[0].formattedName\n\t\t}`;\n\t} else {\n\t\trepoContext = `${pad(GlyphChars.Dot, 2, 2)}${(state as { repos: Repository[] }).repos.length} repositories`;\n\t}\n\n\treturn `${title}${truncate(repoContext, quickPickTitleMaxChars - title.length)}`;\n}\n\nexport async function getBranches(\n\trepos: Repository | Repository[],\n\toptions: {\n\t\tbuttons?: QuickInputButton[];\n\t\tfilter?: (b: GitBranch) => boolean;\n\t\tpicked?: string | string[];\n\t\tsort?: BranchSortOptions;\n\t},\n): Promise<BranchQuickPickItem[]> {\n\treturn getBranchesAndOrTags(repos, ['branches'], {\n\t\tbuttons: options?.buttons,\n\t\tfilter: options?.filter != null ? { branches: options.filter } : undefined,\n\t\tpicked: options?.picked,\n\t\tsort: options?.sort != null ? { branches: options.sort } : true,\n\t}) as Promise<BranchQuickPickItem[]>;\n}\n\nexport async function getTags(\n\trepos: Repository | Repository[],\n\toptions?: {\n\t\tbuttons?: QuickInputButton[];\n\t\tfilter?: (t: GitTag) => boolean;\n\t\tpicked?: string | string[];\n\t\tsort?: TagSortOptions;\n\t},\n): Promise<TagQuickPickItem[]> {\n\treturn getBranchesAndOrTags(repos, ['tags'], {\n\t\tbuttons: options?.buttons,\n\t\tfilter: options?.filter != null ? { tags: options.filter } : undefined,\n\t\tpicked: options?.picked,\n\t\tsort: options?.sort != null ? { tags: options.sort } : true,\n\t}) as Promise<TagQuickPickItem[]>;\n}\n\nexport async function getWorktrees(\n\trepoOrWorktrees: Repository | GitWorktree[],\n\t{\n\t\tbuttons,\n\t\tfilter,\n\t\tincludeStatus,\n\t\tpicked,\n\t}: {\n\t\tbuttons?: QuickInputButton[];\n\t\tfilter?: (t: GitWorktree) => boolean;\n\t\tincludeStatus?: boolean;\n\t\tpicked?: string | string[];\n\t},\n): Promise<WorktreeQuickPickItem[]> {\n\tconst worktrees = repoOrWorktrees instanceof Repository ? await repoOrWorktrees.getWorktrees() : repoOrWorktrees;\n\treturn Promise.all<WorktreeQuickPickItem>([\n\t\t...worktrees\n\t\t\t.filter(w => filter == null || filter(w))\n\t\t\t.map(async w =>\n\t\t\t\tWorktreeQuickPickItem.create(\n\t\t\t\t\tw,\n\t\t\t\t\tpicked != null &&\n\t\t\t\t\t\t(typeof picked === 'string' ? w.uri.toString() === picked : picked.includes(w.uri.toString())),\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttons: buttons,\n\t\t\t\t\t\tpath: true,\n\t\t\t\t\t\tstatus: includeStatus ? await w.getStatus() : undefined,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t),\n\t]);\n}\n\nexport async function getBranchesAndOrTags(\n\trepos: Repository | Repository[] | undefined,\n\tinclude: ('tags' | 'branches')[],\n\t{\n\t\tbuttons,\n\t\tfilter,\n\t\tpicked,\n\t\tsort,\n\t}: {\n\t\tbuttons?: QuickInputButton[];\n\t\tfilter?: { branches?: (b: GitBranch) => boolean; tags?: (t: GitTag) => boolean };\n\t\tpicked?: string | string[];\n\t\tsort?: boolean | { branches?: BranchSortOptions; tags?: TagSortOptions };\n\t} = {},\n): Promise<(BranchQuickPickItem | TagQuickPickItem)[]> {\n\tif (repos == null) return [];\n\n\tlet branches: GitBranch[] | undefined;\n\tlet tags: GitTag[] | undefined;\n\n\tlet singleRepo = false;\n\tif (repos instanceof Repository || repos.length === 1) {\n\t\tsingleRepo = true;\n\t\tconst repo = repos instanceof Repository ? repos : repos[0];\n\n\t\t// TODO@eamodio handle paging\n\t\tconst [branchesResult, tagsResult] = await Promise.allSettled([\n\t\t\tinclude.includes('branches')\n\t\t\t\t? repo.getBranches({\n\t\t\t\t\t\tfilter: filter?.branches,\n\t\t\t\t\t\tsort: typeof sort === 'boolean' ? sort : sort?.branches,\n\t\t\t\t  })\n\t\t\t\t: undefined,\n\t\t\tinclude.includes('tags') ? repo.getTags({ filter: filter?.tags, sort: true }) : undefined,\n\t\t]);\n\n\t\tbranches = (branchesResult.status === 'fulfilled' ? branchesResult.value?.values : undefined) ?? [];\n\t\ttags = (tagsResult.status === 'fulfilled' ? tagsResult.value?.values : undefined) ?? [];\n\t} else {\n\t\t// TODO@eamodio handle paging\n\t\tconst [branchesByRepoResult, tagsByRepoResult] = await Promise.allSettled([\n\t\t\tinclude.includes('branches')\n\t\t\t\t? Promise.allSettled(\n\t\t\t\t\t\trepos.map(r =>\n\t\t\t\t\t\t\tr.getBranches({\n\t\t\t\t\t\t\t\tfilter: filter?.branches,\n\t\t\t\t\t\t\t\tsort: typeof sort === 'boolean' ? sort : sort?.branches,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t),\n\t\t\t\t  )\n\t\t\t\t: undefined,\n\t\t\tinclude.includes('tags')\n\t\t\t\t? Promise.allSettled(\n\t\t\t\t\t\trepos.map(r =>\n\t\t\t\t\t\t\tr.getTags({ filter: filter?.tags, sort: typeof sort === 'boolean' ? sort : sort?.tags }),\n\t\t\t\t\t\t),\n\t\t\t\t  )\n\t\t\t\t: undefined,\n\t\t]);\n\n\t\tconst branchesByRepo =\n\t\t\tbranchesByRepoResult.status === 'fulfilled'\n\t\t\t\t? branchesByRepoResult.value\n\t\t\t\t\t\t?.filter((r): r is PromiseFulfilledResult<PagedResult<GitBranch>> => r.status === 'fulfilled')\n\t\t\t\t\t\t?.map(r => r.value.values)\n\t\t\t\t: undefined;\n\t\tconst tagsByRepo =\n\t\t\ttagsByRepoResult.status === 'fulfilled'\n\t\t\t\t? tagsByRepoResult.value\n\t\t\t\t\t\t?.filter((r): r is PromiseFulfilledResult<PagedResult<GitTag>> => r.status === 'fulfilled')\n\t\t\t\t\t\t?.map(r => r.value.values)\n\t\t\t\t: undefined;\n\n\t\tif (include.includes('branches') && branchesByRepo != null) {\n\t\t\tbranches = GitBranch.sort(\n\t\t\t\tintersection(...branchesByRepo, (b1: GitBranch, b2: GitBranch) => b1.name === b2.name),\n\t\t\t);\n\t\t}\n\n\t\tif (include.includes('tags') && tagsByRepo != null) {\n\t\t\ttags = GitTag.sort(intersection(...tagsByRepo, (t1: GitTag, t2: GitTag) => t1.name === t2.name));\n\t\t}\n\t}\n\n\tif ((branches == null || branches.length === 0) && (tags == null || tags.length === 0)) return [];\n\n\tif (branches != null && branches.length !== 0 && (tags == null || tags.length === 0)) {\n\t\treturn [\n\t\t\tQuickPickSeparator.create('Branches'),\n\t\t\t...(await Promise.all(\n\t\t\t\tbranches\n\t\t\t\t\t.filter(b => !b.remote)\n\t\t\t\t\t.map(b =>\n\t\t\t\t\t\tBranchQuickPickItem.create(\n\t\t\t\t\t\t\tb,\n\t\t\t\t\t\t\tpicked != null && (typeof picked === 'string' ? b.ref === picked : picked.includes(b.ref)),\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbuttons: buttons,\n\t\t\t\t\t\t\t\tcurrent: singleRepo ? 'checkmark' : false,\n\t\t\t\t\t\t\t\tref: singleRepo,\n\t\t\t\t\t\t\t\tstatus: singleRepo,\n\t\t\t\t\t\t\t\ttype: 'remote',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t)),\n\t\t\tQuickPickSeparator.create('Remote Branches'),\n\t\t\t...(await Promise.all(\n\t\t\t\tbranches\n\t\t\t\t\t.filter(b => b.remote)\n\t\t\t\t\t.map(b =>\n\t\t\t\t\t\tBranchQuickPickItem.create(\n\t\t\t\t\t\t\tb,\n\t\t\t\t\t\t\tpicked != null && (typeof picked === 'string' ? b.ref === picked : picked.includes(b.ref)),\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbuttons: buttons,\n\t\t\t\t\t\t\t\tcurrent: singleRepo ? 'checkmark' : false,\n\t\t\t\t\t\t\t\tref: singleRepo,\n\t\t\t\t\t\t\t\tstatus: singleRepo,\n\t\t\t\t\t\t\t\ttype: 'remote',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t)),\n\t\t] as BranchQuickPickItem[];\n\t}\n\n\tif (tags != null && tags.length !== 0 && (branches == null || branches.length === 0)) {\n\t\treturn tags.map(t =>\n\t\t\tTagQuickPickItem.create(\n\t\t\t\tt,\n\t\t\t\tpicked != null && (typeof picked === 'string' ? t.ref === picked : picked.includes(t.ref)),\n\t\t\t\t{\n\t\t\t\t\tbuttons: buttons,\n\t\t\t\t\tmessage: false, //singleRepo,\n\t\t\t\t\tref: singleRepo,\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\treturn [\n\t\tQuickPickSeparator.create('Branches'),\n\t\t...(await Promise.all(\n\t\t\tbranches!\n\t\t\t\t.filter(b => !b.remote)\n\t\t\t\t.map(b =>\n\t\t\t\t\tBranchQuickPickItem.create(\n\t\t\t\t\t\tb,\n\t\t\t\t\t\tpicked != null && (typeof picked === 'string' ? b.ref === picked : picked.includes(b.ref)),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbuttons: buttons,\n\t\t\t\t\t\t\tcurrent: singleRepo ? 'checkmark' : false,\n\t\t\t\t\t\t\tref: singleRepo,\n\t\t\t\t\t\t\tstatus: singleRepo,\n\t\t\t\t\t\t},\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t)),\n\t\tQuickPickSeparator.create('Tags'),\n\t\t...tags!.map(t =>\n\t\t\tTagQuickPickItem.create(\n\t\t\t\tt,\n\t\t\t\tpicked != null && (typeof picked === 'string' ? t.ref === picked : picked.includes(t.ref)),\n\t\t\t\t{\n\t\t\t\t\tbuttons: buttons,\n\t\t\t\t\tmessage: false, //singleRepo,\n\t\t\t\t\tref: singleRepo,\n\t\t\t\t\ttype: true,\n\t\t\t\t},\n\t\t\t),\n\t\t),\n\t\tQuickPickSeparator.create('Remote Branches'),\n\t\t...(await Promise.all(\n\t\t\tbranches!\n\t\t\t\t.filter(b => b.remote)\n\t\t\t\t.map(b =>\n\t\t\t\t\tBranchQuickPickItem.create(\n\t\t\t\t\t\tb,\n\t\t\t\t\t\tpicked != null && (typeof picked === 'string' ? b.ref === picked : picked.includes(b.ref)),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbuttons: buttons,\n\t\t\t\t\t\t\tcurrent: singleRepo ? 'checkmark' : false,\n\t\t\t\t\t\t\tref: singleRepo,\n\t\t\t\t\t\t\tstatus: singleRepo,\n\t\t\t\t\t\t\ttype: 'remote',\n\t\t\t\t\t\t},\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t)),\n\t] as (BranchQuickPickItem | TagQuickPickItem)[];\n}\n\nexport function getValidateGitReferenceFn(\n\trepos: Repository | Repository[] | undefined,\n\toptions?: { buttons?: QuickInputButton[]; ranges?: boolean },\n) {\n\treturn async (quickpick: QuickPick<any>, value: string) => {\n\t\tlet inRefMode = false;\n\t\tif (value.startsWith('#')) {\n\t\t\tinRefMode = true;\n\t\t\tvalue = value.substring(1);\n\t\t}\n\n\t\tif (repos == null) return false;\n\t\tif (Array.isArray(repos)) {\n\t\t\tif (repos.length !== 1) return false;\n\n\t\t\trepos = repos[0];\n\t\t}\n\n\t\tif (inRefMode && options?.ranges && GitRevision.isRange(value)) {\n\t\t\tquickpick.items = [\n\t\t\t\tRefQuickPickItem.create(value, repos.path, true, {\n\t\t\t\t\talwaysShow: true,\n\t\t\t\t\tbuttons: options?.buttons,\n\t\t\t\t\tref: false,\n\t\t\t\t\ticon: false,\n\t\t\t\t}),\n\t\t\t];\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!(await Container.instance.git.validateReference(repos.path, value))) {\n\t\t\tif (inRefMode) {\n\t\t\t\tquickpick.items = [\n\t\t\t\t\tDirectiveQuickPickItem.create(Directive.Back, true, {\n\t\t\t\t\t\tlabel: 'Enter a reference or commit SHA',\n\t\t\t\t\t}),\n\t\t\t\t];\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!inRefMode) {\n\t\t\tif (\n\t\t\t\tawait Container.instance.git.hasBranchOrTag(repos.path, {\n\t\t\t\t\tfilter: { branches: b => b.name.includes(value), tags: t => t.name.includes(value) },\n\t\t\t\t})\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tconst commit = await Container.instance.git.getCommit(repos.path, value);\n\t\tquickpick.items = [\n\t\t\tCommitQuickPickItem.create(commit!, true, {\n\t\t\t\talwaysShow: true,\n\t\t\t\tbuttons: options?.buttons,\n\t\t\t\tcompact: true,\n\t\t\t\ticon: true,\n\t\t\t}),\n\t\t];\n\t\treturn true;\n\t};\n}\n\nexport async function* inputBranchNameStep<\n\tState extends PartialStepState & ({ repo: Repository } | { repos: Repository[] }),\n\tContext extends { repos: Repository[]; showTags?: boolean; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n\toptions: { placeholder: string; titleContext?: string; value?: string },\n): AsyncStepResultGenerator<string> {\n\tconst step = QuickCommand.createInputStep({\n\t\ttitle: appendReposToTitle(`${context.title}${options.titleContext ?? ''}`, state, context),\n\t\tplaceholder: options.placeholder,\n\t\tvalue: options.value,\n\t\tprompt: 'Enter branch name',\n\t\tvalidate: async (value: string | undefined): Promise<[boolean, string | undefined]> => {\n\t\t\tif (value == null) return [false, undefined];\n\n\t\t\tvalue = value.trim();\n\t\t\tif (value.length === 0) return [false, 'Please enter a valid branch name'];\n\n\t\t\tif ('repo' in state) {\n\t\t\t\tconst valid = await Container.instance.git.validateBranchOrTagName(state.repo.path, value);\n\t\t\t\treturn [valid, valid ? undefined : `'${value}' isn't a valid branch name`];\n\t\t\t}\n\n\t\t\tlet valid = true;\n\n\t\t\tfor (const repo of state.repos) {\n\t\t\t\tvalid = await Container.instance.git.validateBranchOrTagName(repo.path, value);\n\t\t\t\tif (!valid) {\n\t\t\t\t\treturn [false, `'${value}' isn't a valid branch name`];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn [true, undefined];\n\t\t},\n\t});\n\n\tconst value: StepSelection<typeof step> = yield step;\n\tif (\n\t\t!QuickCommand.canStepContinue(step, state, value) ||\n\t\t!(await QuickCommand.canInputStepContinue(step, state, value))\n\t) {\n\t\treturn StepResult.Break;\n\t}\n\n\treturn value;\n}\n\nexport async function* inputTagNameStep<\n\tState extends PartialStepState & ({ repo: Repository } | { repos: Repository[] }),\n\tContext extends { repos: Repository[]; showTags?: boolean; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n\toptions: { placeholder: string; titleContext?: string; value?: string },\n): AsyncStepResultGenerator<string> {\n\tconst step = QuickCommand.createInputStep({\n\t\ttitle: appendReposToTitle(`${context.title}${options.titleContext ?? ''}`, state, context),\n\t\tplaceholder: options.placeholder,\n\t\tvalue: options.value,\n\t\tprompt: 'Enter tag name',\n\t\tvalidate: async (value: string | undefined): Promise<[boolean, string | undefined]> => {\n\t\t\tif (value == null) return [false, undefined];\n\n\t\t\tvalue = value.trim();\n\t\t\tif (value.length === 0) return [false, 'Please enter a valid tag name'];\n\n\t\t\tif ('repo' in state) {\n\t\t\t\tconst valid = await Container.instance.git.validateBranchOrTagName(state.repo.path, value);\n\t\t\t\treturn [valid, valid ? undefined : `'${value}' isn't a valid tag name`];\n\t\t\t}\n\n\t\t\tlet valid = true;\n\n\t\t\tfor (const repo of state.repos) {\n\t\t\t\tvalid = await Container.instance.git.validateBranchOrTagName(repo.path, value);\n\t\t\t\tif (!valid) {\n\t\t\t\t\treturn [false, `'${value}' isn't a valid branch name`];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn [true, undefined];\n\t\t},\n\t});\n\n\tconst value: StepSelection<typeof step> = yield step;\n\tif (\n\t\t!QuickCommand.canStepContinue(step, state, value) ||\n\t\t!(await QuickCommand.canInputStepContinue(step, state, value))\n\t) {\n\t\treturn StepResult.Break;\n\t}\n\n\treturn value;\n}\n\nexport async function* pickBranchStep<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; showTags?: boolean; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n\t{\n\t\tfilter,\n\t\tpicked,\n\t\tplaceholder,\n\t\ttitleContext,\n\t}: {\n\t\tfilter?: (b: GitBranch) => boolean;\n\t\tpicked?: string | string[];\n\t\tplaceholder: string;\n\t\ttitleContext?: string;\n\t},\n): AsyncStepResultGenerator<GitBranchReference> {\n\tconst branches = await getBranches(state.repo, {\n\t\tbuttons: [QuickCommandButtons.RevealInSideBar],\n\t\tfilter: filter,\n\t\tpicked: picked,\n\t});\n\n\tconst step = QuickCommand.createPickStep<BranchQuickPickItem>({\n\t\ttitle: appendReposToTitle(`${context.title}${titleContext ?? ''}`, state, context),\n\t\tplaceholder: branches.length === 0 ? `No branches found in ${state.repo.formattedName}` : placeholder,\n\t\tmatchOnDetail: true,\n\t\titems:\n\t\t\tbranches.length === 0\n\t\t\t\t? [DirectiveQuickPickItem.create(Directive.Back, true), DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t\t: branches,\n\t\tonDidClickItemButton: (quickpick, button, { item }) => {\n\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\tvoid GitActions.Branch.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: async quickpick => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tawait GitActions.Branch.reveal(quickpick.activeItems[0].item, {\n\t\t\t\tselect: true,\n\t\t\t\tfocus: false,\n\t\t\t\texpand: true,\n\t\t\t});\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n}\n\nexport async function* pickBranchesStep<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; showTags?: boolean; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n\t{\n\t\tfilter,\n\t\tpicked,\n\t\tplaceholder,\n\t\tsort,\n\t\ttitleContext,\n\t}: {\n\t\tfilter?: (b: GitBranch) => boolean;\n\t\tpicked?: string | string[];\n\t\tplaceholder: string;\n\t\tsort?: BranchSortOptions;\n\t\ttitleContext?: string;\n\t},\n): AsyncStepResultGenerator<GitBranchReference[]> {\n\tconst branches = await getBranches(state.repo, {\n\t\tbuttons: [QuickCommandButtons.RevealInSideBar],\n\t\tfilter: filter,\n\t\tpicked: picked,\n\t\tsort: sort,\n\t});\n\n\tconst step = QuickCommand.createPickStep<BranchQuickPickItem>({\n\t\tmultiselect: branches.length !== 0,\n\t\ttitle: appendReposToTitle(`${context.title}${titleContext ?? ''}`, state, context),\n\t\tplaceholder: branches.length === 0 ? `No branches found in ${state.repo.formattedName}` : placeholder,\n\t\tmatchOnDetail: true,\n\t\titems:\n\t\t\tbranches.length === 0\n\t\t\t\t? [DirectiveQuickPickItem.create(Directive.Back, true), DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t\t: branches,\n\t\tonDidClickItemButton: (quickpick, button, { item }) => {\n\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\tvoid GitActions.Branch.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: async quickpick => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tawait GitActions.Branch.reveal(quickpick.activeItems[0].item, {\n\t\t\t\tselect: true,\n\t\t\t\tfocus: false,\n\t\t\t\texpand: true,\n\t\t\t});\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection.map(i => i.item) : StepResult.Break;\n}\n\nexport async function* pickBranchOrTagStep<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; pickCommitForItem?: boolean; showTags?: boolean; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n\t{\n\t\tfilter,\n\t\tpicked,\n\t\tplaceholder,\n\t\ttitleContext,\n\t\tvalue,\n\t\tadditionalButtons,\n\t\tranges,\n\t}: {\n\t\tfilter?: { branches?: (b: GitBranch) => boolean; tags?: (t: GitTag) => boolean };\n\t\tpicked: string | string[] | undefined;\n\t\tplaceholder: string | ((context: Context) => string);\n\t\ttitleContext?: string;\n\t\tvalue: string | undefined;\n\t\tadditionalButtons?: QuickInputButton[];\n\t\tranges?: boolean;\n\t},\n): AsyncStepResultGenerator<GitReference> {\n\tcontext.showTags = true;\n\n\tconst showTagsButton = new QuickCommandButtons.ShowTagsToggle(context.showTags);\n\n\tconst getBranchesAndOrTagsFn = async () => {\n\t\treturn getBranchesAndOrTags(state.repo, context.showTags ? ['branches', 'tags'] : ['branches'], {\n\t\t\tbuttons:\n\t\t\t\ttypeof context.pickCommitForItem === 'boolean'\n\t\t\t\t\t? [QuickCommandButtons.PickCommit, QuickCommandButtons.RevealInSideBar]\n\t\t\t\t\t: [QuickCommandButtons.RevealInSideBar],\n\t\t\tfilter: filter,\n\t\t\tpicked: picked,\n\t\t\tsort: true,\n\t\t});\n\t};\n\tconst branchesAndOrTags = await getBranchesAndOrTagsFn();\n\n\tconst step = QuickCommand.createPickStep<ReferencesQuickPickItem>({\n\t\ttitle: appendReposToTitle(`${context.title}${titleContext ?? ''}`, state, context),\n\t\tplaceholder:\n\t\t\tbranchesAndOrTags.length === 0\n\t\t\t\t? `No branches${context.showTags ? ' or tags' : ''} found in ${state.repo.formattedName}`\n\t\t\t\t: `${typeof placeholder === 'string' ? placeholder : placeholder(context)}${GlyphChars.Space.repeat(\n\t\t\t\t\t\t3,\n\t\t\t\t  )}(or enter a reference using #)`,\n\t\tmatchOnDescription: true,\n\t\tmatchOnDetail: true,\n\t\tvalue: value,\n\t\titems:\n\t\t\tbranchesAndOrTags.length === 0\n\t\t\t\t? [DirectiveQuickPickItem.create(Directive.Back, true), DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t\t: branchesAndOrTags,\n\t\tadditionalButtons: [...(additionalButtons ?? []), showTagsButton],\n\t\tonDidClickItemButton: (quickpick, button, { item }) => {\n\t\t\tif (button === QuickCommandButtons.PickCommit) {\n\t\t\t\tcontext.pickCommitForItem = true;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\tif (GitReference.isBranch(item)) {\n\t\t\t\t\tvoid GitActions.Branch.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t\t} else if (GitReference.isTag(item)) {\n\t\t\t\t\tvoid GitActions.Tag.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t\t} else if (GitReference.isRevision(item)) {\n\t\t\t\t\tvoid GitActions.Commit.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tonDidClickButton: async (quickpick, button) => {\n\t\t\tif (button === showTagsButton) {\n\t\t\t\tquickpick.busy = true;\n\t\t\t\tquickpick.enabled = false;\n\n\t\t\t\ttry {\n\t\t\t\t\tcontext.showTags = !context.showTags;\n\t\t\t\t\tshowTagsButton.on = context.showTags;\n\n\t\t\t\t\tconst branchesAndOrTags = await getBranchesAndOrTagsFn();\n\t\t\t\t\tquickpick.placeholder =\n\t\t\t\t\t\tbranchesAndOrTags.length === 0\n\t\t\t\t\t\t\t? `${state.repo.formattedName} has no branches${context.showTags ? ' or tags' : ''}`\n\t\t\t\t\t\t\t: `${\n\t\t\t\t\t\t\t\t\ttypeof placeholder === 'string' ? placeholder : placeholder(context)\n\t\t\t\t\t\t\t  }${GlyphChars.Space.repeat(3)}(or enter a reference using #)`;\n\t\t\t\t\tquickpick.items = branchesAndOrTags;\n\t\t\t\t} finally {\n\t\t\t\t\tquickpick.busy = false;\n\t\t\t\t\tquickpick.enabled = true;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: quickpick => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tconst item = quickpick.activeItems[0].item;\n\t\t\tif (GitReference.isBranch(item)) {\n\t\t\t\tvoid GitActions.Branch.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t} else if (GitReference.isTag(item)) {\n\t\t\t\tvoid GitActions.Tag.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t} else if (GitReference.isRevision(item)) {\n\t\t\t\tvoid GitActions.Commit.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t}\n\t\t},\n\t\tonValidateValue: getValidateGitReferenceFn(state.repo, { ranges: ranges }),\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n}\n\nexport async function* pickBranchOrTagStepMultiRepo<\n\tState extends StepState & { repos: Repository[]; reference?: GitReference },\n\tContext extends { repos: Repository[]; showTags?: boolean; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n\t{\n\t\tfilter,\n\t\tpicked,\n\t\tplaceholder,\n\t\ttitleContext,\n\t\tvalue,\n\t}: {\n\t\tfilter?: { branches?: (b: GitBranch) => boolean; tags?: (t: GitTag) => boolean };\n\t\tpicked?: string | string[];\n\t\tplaceholder: string | ((context: Context) => string);\n\t\ttitleContext?: string;\n\t\tvalue?: string;\n\t},\n): AsyncStepResultGenerator<GitReference> {\n\tcontext.showTags = state.repos.length === 1;\n\n\tconst showTagsButton = new QuickCommandButtons.ShowTagsToggle(context.showTags);\n\n\tconst getBranchesAndOrTagsFn = () => {\n\t\treturn getBranchesAndOrTags(state.repos, context.showTags ? ['branches', 'tags'] : ['branches'], {\n\t\t\tbuttons: [QuickCommandButtons.RevealInSideBar],\n\t\t\t// Filter out remote branches if we are going to affect multiple repos\n\t\t\tfilter: { branches: state.repos.length === 1 ? undefined : b => !b.remote, ...filter },\n\t\t\tpicked: picked ?? state.reference?.ref,\n\t\t\tsort: { branches: { orderBy: BranchSorting.DateDesc }, tags: { orderBy: TagSorting.DateDesc } },\n\t\t});\n\t};\n\tconst branchesAndOrTags = await getBranchesAndOrTagsFn();\n\n\tconst step = QuickCommand.createPickStep<ReferencesQuickPickItem>({\n\t\ttitle: appendReposToTitle(`${context.title}${titleContext ?? ''}`, state, context),\n\t\tplaceholder:\n\t\t\tbranchesAndOrTags.length === 0\n\t\t\t\t? `No ${state.repos.length === 1 ? '' : 'common '}branches${\n\t\t\t\t\t\tcontext.showTags ? ' or tags' : ''\n\t\t\t\t  } found in ${\n\t\t\t\t\t\tstate.repos.length === 1 ? state.repos[0].formattedName : `${state.repos.length} repositories`\n\t\t\t\t  }`\n\t\t\t\t: `${typeof placeholder === 'string' ? placeholder : placeholder(context)}${GlyphChars.Space.repeat(\n\t\t\t\t\t\t3,\n\t\t\t\t  )}(or enter a reference using #)`,\n\t\tmatchOnDescription: true,\n\t\tmatchOnDetail: true,\n\t\tvalue: value ?? (GitReference.isRevision(state.reference) ? state.reference.ref : undefined),\n\t\titems:\n\t\t\tbranchesAndOrTags.length === 0\n\t\t\t\t? [DirectiveQuickPickItem.create(Directive.Back, true), DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t\t: branchesAndOrTags,\n\t\tadditionalButtons: [showTagsButton],\n\t\tonDidClickItemButton: (quickpick, button, { item }) => {\n\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\tif (GitReference.isBranch(item)) {\n\t\t\t\t\tvoid GitActions.Branch.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t\t} else if (GitReference.isTag(item)) {\n\t\t\t\t\tvoid GitActions.Tag.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t\t} else if (GitReference.isRevision(item)) {\n\t\t\t\t\tvoid GitActions.Commit.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonDidClickButton: async (quickpick, button) => {\n\t\t\tif (button === showTagsButton) {\n\t\t\t\tquickpick.busy = true;\n\t\t\t\tquickpick.enabled = false;\n\n\t\t\t\ttry {\n\t\t\t\t\tcontext.showTags = !context.showTags;\n\t\t\t\t\tshowTagsButton.on = context.showTags;\n\n\t\t\t\t\tconst branchesAndOrTags = await getBranchesAndOrTagsFn();\n\t\t\t\t\tquickpick.placeholder =\n\t\t\t\t\t\tbranchesAndOrTags.length === 0\n\t\t\t\t\t\t\t? `No ${state.repos.length === 1 ? '' : 'common '}branches${\n\t\t\t\t\t\t\t\t\tcontext.showTags ? ' or tags' : ''\n\t\t\t\t\t\t\t  } found in ${\n\t\t\t\t\t\t\t\t\tstate.repos.length === 1\n\t\t\t\t\t\t\t\t\t\t? state.repos[0].formattedName\n\t\t\t\t\t\t\t\t\t\t: `${state.repos.length} repositories`\n\t\t\t\t\t\t\t  }`\n\t\t\t\t\t\t\t: `${\n\t\t\t\t\t\t\t\t\ttypeof placeholder === 'string' ? placeholder : placeholder(context)\n\t\t\t\t\t\t\t  }${GlyphChars.Space.repeat(3)}(or enter a reference using #)`;\n\t\t\t\t\tquickpick.items = branchesAndOrTags;\n\t\t\t\t} finally {\n\t\t\t\t\tquickpick.busy = false;\n\t\t\t\t\tquickpick.enabled = true;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: quickpick => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tconst item = quickpick.activeItems[0].item;\n\t\t\tif (GitReference.isBranch(item)) {\n\t\t\t\tvoid GitActions.Branch.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t} else if (GitReference.isTag(item)) {\n\t\t\t\tvoid GitActions.Tag.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t} else if (GitReference.isRevision(item)) {\n\t\t\t\tvoid GitActions.Commit.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t}\n\t\t},\n\t\tonValidateValue: getValidateGitReferenceFn(state.repos),\n\t});\n\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n}\n\nexport async function* pickCommitStep<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n\t{\n\t\tignoreFocusOut,\n\t\tlog,\n\t\tonDidLoadMore,\n\t\tpicked,\n\t\tplaceholder,\n\t\tshowInSideBarCommand,\n\t\tshowInSideBarButton: showInSideBar,\n\t\ttitleContext,\n\t}: {\n\t\tignoreFocusOut?: boolean;\n\t\tlog: GitLog | undefined;\n\t\tonDidLoadMore?: (log: GitLog | undefined) => void;\n\t\tpicked?: string | string[] | undefined;\n\t\tplaceholder: string | ((context: Context, log: GitLog | undefined) => string);\n\t\tshowInSideBarCommand?: CommandQuickPickItem;\n\t\tshowInSideBarButton?: {\n\t\t\tbutton: QuickInputButton;\n\t\t\tonDidClick: (items: Readonly<CommitQuickPickItem<GitCommit>[]>) => void;\n\t\t};\n\t\ttitleContext?: string;\n\t},\n): AsyncStepResultGenerator<GitCommit> {\n\tfunction getItems(log: GitLog | undefined) {\n\t\treturn log == null\n\t\t\t? [DirectiveQuickPickItem.create(Directive.Back, true), DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t: [\n\t\t\t\t\t...map(log.commits.values(), commit =>\n\t\t\t\t\t\tCommitQuickPickItem.create(\n\t\t\t\t\t\t\tcommit,\n\t\t\t\t\t\t\tpicked != null &&\n\t\t\t\t\t\t\t\t(typeof picked === 'string' ? commit.ref === picked : picked.includes(commit.ref)),\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbuttons: [QuickCommandButtons.RevealInSideBar, QuickCommandButtons.SearchInSideBar],\n\t\t\t\t\t\t\t\tcompact: true,\n\t\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t\t...(log?.hasMore ? [DirectiveQuickPickItem.create(Directive.LoadMore)] : []),\n\t\t\t  ];\n\t}\n\n\tconst step = QuickCommand.createPickStep<CommandQuickPickItem | CommitQuickPickItem>({\n\t\ttitle: appendReposToTitle(`${context.title}${titleContext ?? ''}`, state, context),\n\t\tplaceholder: typeof placeholder === 'string' ? placeholder : placeholder(context, log),\n\t\tignoreFocusOut: ignoreFocusOut,\n\t\tmatchOnDescription: true,\n\t\tmatchOnDetail: true,\n\t\tvalue: typeof picked === 'string' && log?.count === 0 ? picked : undefined,\n\t\titems: showInSideBarCommand != null ? [showInSideBarCommand, ...getItems(log)] : getItems(log),\n\t\tonDidLoadMore: async quickpick => {\n\t\t\tquickpick.keepScrollPosition = true;\n\t\t\tlog = await log?.more?.(configuration.get('advanced.maxListItems'));\n\t\t\tonDidLoadMore?.(log);\n\t\t\tif (typeof placeholder !== 'string') {\n\t\t\t\tquickpick.placeholder = placeholder(context, log);\n\t\t\t}\n\t\t\treturn getItems(log);\n\t\t},\n\t\tadditionalButtons: [\n\t\t\t...(showInSideBar?.button != null ? [showInSideBar?.button] : []),\n\t\t\t...(log?.hasMore ? [QuickCommandButtons.LoadMore] : []),\n\t\t],\n\t\tonDidClickItemButton: (quickpick, button, item) => {\n\t\t\tif (CommandQuickPickItem.is(item)) return;\n\n\t\t\tswitch (button) {\n\t\t\t\tcase QuickCommandButtons.RevealInSideBar:\n\t\t\t\t\tvoid GitActions.Commit.reveal(item.item, {\n\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\texpand: true,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase QuickCommandButtons.SearchInSideBar:\n\t\t\t\t\tvoid Container.instance.searchAndCompareView.search(\n\t\t\t\t\t\tstate.repo.path,\n\t\t\t\t\t\t{ pattern: SearchPattern.fromCommit(item.item.ref) },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: {\n\t\t\t\t\t\t\t\tlabel: `for ${GitReference.toString(item.item, { icon: false })}`,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\treveal: {\n\t\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tonDidClickButton: (quickpick, button) => {\n\t\t\tif (log == null) return;\n\n\t\t\tconst items = quickpick.activeItems.filter<CommitQuickPickItem<GitCommit>>(\n\t\t\t\t(i): i is CommitQuickPickItem<GitCommit> => !CommandQuickPickItem.is(i),\n\t\t\t);\n\n\t\t\tif (button === showInSideBar?.button) {\n\t\t\t\tshowInSideBar.onDidClick(items);\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: async (quickpick, key) => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tconst items = quickpick.activeItems.filter<CommitQuickPickItem<GitCommit>>(\n\t\t\t\t(i): i is CommitQuickPickItem<GitCommit> => !CommandQuickPickItem.is(i),\n\t\t\t);\n\n\t\t\tif (key === 'ctrl+right') {\n\t\t\t\tawait GitActions.Commit.reveal(items[0].item, {\n\t\t\t\t\tselect: true,\n\t\t\t\t\tfocus: false,\n\t\t\t\t\texpand: true,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst commit = items[0].item;\n\t\t\t\tawait Container.instance.searchAndCompareView.search(\n\t\t\t\t\tcommit.repoPath,\n\t\t\t\t\t{ pattern: SearchPattern.fromCommit(commit) },\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: { label: `for ${GitReference.toString(commit, { icon: false })}` },\n\t\t\t\t\t\treveal: {\n\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tonValidateValue: getValidateGitReferenceFn(state.repo, {\n\t\t\tbuttons: [QuickCommandButtons.RevealInSideBar, QuickCommandButtons.SearchInSideBar],\n\t\t}),\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\tif (!QuickCommand.canPickStepContinue(step, state, selection)) return StepResult.Break;\n\n\tif (CommandQuickPickItem.is(selection[0])) {\n\t\tQuickCommand.endSteps(state);\n\n\t\tawait selection[0].execute();\n\t\treturn StepResult.Break;\n\t}\n\n\treturn selection[0].item;\n}\n\nexport function* pickCommitsStep<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n\t{\n\t\tlog,\n\t\tonDidLoadMore,\n\t\tpicked,\n\t\tplaceholder,\n\t\ttitleContext,\n\t}: {\n\t\tlog: GitLog | undefined;\n\t\tonDidLoadMore?: (log: GitLog | undefined) => void;\n\t\tpicked: string | string[] | undefined;\n\t\tplaceholder: string | ((context: Context, log: GitLog | undefined) => string);\n\t\ttitleContext?: string;\n\t},\n): StepResultGenerator<GitRevisionReference[]> {\n\tfunction getItems(log: GitLog | undefined) {\n\t\treturn log == null\n\t\t\t? [DirectiveQuickPickItem.create(Directive.Back, true), DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t: [\n\t\t\t\t\t...map(log.commits.values(), commit =>\n\t\t\t\t\t\tCommitQuickPickItem.create(\n\t\t\t\t\t\t\tcommit,\n\t\t\t\t\t\t\tpicked != null &&\n\t\t\t\t\t\t\t\t(typeof picked === 'string' ? commit.ref === picked : picked.includes(commit.ref)),\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbuttons: [QuickCommandButtons.RevealInSideBar, QuickCommandButtons.SearchInSideBar],\n\t\t\t\t\t\t\t\tcompact: true,\n\t\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t\t// Since this is multi-select, we can't have a \"Load more\" item\n\t\t\t\t\t// ...(log?.hasMore ? [DirectiveQuickPickItem.create(Directive.LoadMore)] : []),\n\t\t\t  ];\n\t}\n\n\tconst step = QuickCommand.createPickStep<CommitQuickPickItem>({\n\t\ttitle: appendReposToTitle(`${context.title}${titleContext ?? ''}`, state, context),\n\t\tmultiselect: log != null,\n\t\tplaceholder: typeof placeholder === 'string' ? placeholder : placeholder(context, log),\n\t\tmatchOnDescription: true,\n\t\tmatchOnDetail: true,\n\t\titems: getItems(log),\n\t\tonDidLoadMore: async quickpick => {\n\t\t\tquickpick.keepScrollPosition = true;\n\t\t\tlog = await log?.more?.(configuration.get('advanced.maxListItems'));\n\t\t\tonDidLoadMore?.(log);\n\t\t\tif (typeof placeholder !== 'string') {\n\t\t\t\tquickpick.placeholder = placeholder(context, log);\n\t\t\t}\n\t\t\treturn getItems(log);\n\t\t},\n\t\tadditionalButtons: [...(log?.hasMore ? [QuickCommandButtons.LoadMore] : [])],\n\t\tonDidClickItemButton: (quickpick, button, { item }) => {\n\t\t\tswitch (button) {\n\t\t\t\tcase QuickCommandButtons.RevealInSideBar:\n\t\t\t\t\tvoid GitActions.Commit.reveal(item, {\n\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\texpand: true,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase QuickCommandButtons.SearchInSideBar:\n\t\t\t\t\tvoid Container.instance.searchAndCompareView.search(\n\t\t\t\t\t\tstate.repo.path,\n\t\t\t\t\t\t{ pattern: SearchPattern.fromCommit(item.ref) },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: {\n\t\t\t\t\t\t\t\tlabel: `for ${GitReference.toString(item, { icon: false })}`,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\treveal: {\n\t\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: async (quickpick, key) => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tif (key === 'ctrl+right') {\n\t\t\t\tawait GitActions.Commit.reveal(quickpick.activeItems[0].item, {\n\t\t\t\t\tselect: true,\n\t\t\t\t\tfocus: false,\n\t\t\t\t\texpand: true,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst commit = quickpick.activeItems[0].item;\n\t\t\t\tawait Container.instance.searchAndCompareView.search(\n\t\t\t\t\tcommit.repoPath,\n\t\t\t\t\t{ pattern: SearchPattern.fromCommit(commit) },\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: { label: `for ${GitReference.toString(commit, { icon: false })}` },\n\t\t\t\t\t\treveal: {\n\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection.map(i => i.item) : StepResult.Break;\n}\n\nexport async function* pickContributorsStep<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n\tplaceholder: string = 'Choose contributors',\n): AsyncStepResultGenerator<GitContributor[]> {\n\tconst message = (await Container.instance.git.getOrOpenScmRepository(state.repo.path))?.inputBox.value;\n\n\tconst step = QuickCommand.createPickStep<ContributorQuickPickItem>({\n\t\ttitle: appendReposToTitle(context.title, state, context),\n\t\tallowEmpty: true,\n\t\tmultiselect: true,\n\t\tplaceholder: placeholder,\n\t\tmatchOnDescription: true,\n\t\titems: (await Container.instance.git.getContributors(state.repo.path)).map(c =>\n\t\t\tContributorQuickPickItem.create(c, message?.includes(c.getCoauthor()), {\n\t\t\t\tbuttons: [QuickCommandButtons.RevealInSideBar],\n\t\t\t}),\n\t\t),\n\t\tonDidClickItemButton: (quickpick, button, { item }) => {\n\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\tvoid GitActions.Contributor.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: quickpick => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tvoid GitActions.Contributor.reveal(quickpick.activeItems[0].item, {\n\t\t\t\tselect: true,\n\t\t\t\tfocus: false,\n\t\t\t\texpand: true,\n\t\t\t});\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection.map(i => i.item) : StepResult.Break;\n}\n\nexport async function* pickRepositoryStep<\n\tState extends PartialStepState & { repo?: string | Repository },\n\tContext extends { repos: Repository[]; title: string; associatedView: ViewsWithRepositoryFolders },\n>(state: State, context: Context, placeholder: string = 'Choose a repository'): AsyncStepResultGenerator<Repository> {\n\tif (typeof state.repo === 'string') {\n\t\tstate.repo = Container.instance.git.getRepository(state.repo);\n\t\tif (state.repo != null) return state.repo;\n\t}\n\tconst active = state.repo ?? (await Container.instance.git.getOrOpenRepositoryForEditor());\n\n\tconst step = QuickCommand.createPickStep<RepositoryQuickPickItem>({\n\t\ttitle: context.title,\n\t\tplaceholder: placeholder,\n\t\titems:\n\t\t\tcontext.repos.length === 0\n\t\t\t\t? [DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t\t: await Promise.all(\n\t\t\t\t\t\tcontext.repos.map(r =>\n\t\t\t\t\t\t\tRepositoryQuickPickItem.create(r, r.id === active?.id, {\n\t\t\t\t\t\t\t\tbranch: true,\n\t\t\t\t\t\t\t\tbuttons: [QuickCommandButtons.RevealInSideBar],\n\t\t\t\t\t\t\t\tfetched: true,\n\t\t\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t),\n\t\t\t\t  ),\n\t\tonDidClickItemButton: (quickpick, button, { item }) => {\n\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\tvoid GitActions.Repository.reveal(item.path, context.associatedView, {\n\t\t\t\t\tselect: true,\n\t\t\t\t\tfocus: false,\n\t\t\t\t\texpand: true,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: quickpick => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tvoid GitActions.Repository.reveal(quickpick.activeItems[0].item.path, context.associatedView, {\n\t\t\t\tselect: true,\n\t\t\t\tfocus: false,\n\t\t\t\texpand: true,\n\t\t\t});\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n}\n\nexport async function* pickRepositoriesStep<\n\tState extends PartialStepState & { repos?: string[] | Repository[] },\n\tContext extends { repos: Repository[]; title: string; associatedView: ViewsWithRepositoryFolders },\n>(\n\tstate: State,\n\tcontext: Context,\n\toptions?: { placeholder?: string; skipIfPossible?: boolean },\n): AsyncStepResultGenerator<Repository[]> {\n\toptions = { placeholder: 'Choose repositories', skipIfPossible: false, ...options };\n\n\tlet actives: Repository[];\n\tif (state.repos != null) {\n\t\tif (isStringArray(state.repos)) {\n\t\t\tactives = filterMap(state.repos, path => context.repos.find(r => r.path === path));\n\t\t\tif (options.skipIfPossible && actives.length !== 0 && state.repos.length === actives.length) {\n\t\t\t\treturn actives;\n\t\t\t}\n\t\t} else {\n\t\t\tactives = state.repos;\n\t\t}\n\t} else {\n\t\tconst active = await Container.instance.git.getOrOpenRepositoryForEditor();\n\t\tactives = active != null ? [active] : [];\n\t}\n\n\tconst step = QuickCommand.createPickStep<RepositoryQuickPickItem>({\n\t\tmultiselect: true,\n\t\ttitle: context.title,\n\t\tplaceholder: options.placeholder,\n\t\titems:\n\t\t\tcontext.repos.length === 0\n\t\t\t\t? [DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t\t: await Promise.all(\n\t\t\t\t\t\tcontext.repos.map(repo =>\n\t\t\t\t\t\t\tRepositoryQuickPickItem.create(\n\t\t\t\t\t\t\t\trepo,\n\t\t\t\t\t\t\t\tactives.some(r => r.id === repo.id),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbranch: true,\n\t\t\t\t\t\t\t\t\tbuttons: [QuickCommandButtons.RevealInSideBar],\n\t\t\t\t\t\t\t\t\tfetched: true,\n\t\t\t\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t  ),\n\t\tonDidClickItemButton: (quickpick, button, { item }) => {\n\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\tvoid GitActions.Repository.reveal(item.path, context.associatedView, {\n\t\t\t\t\tselect: true,\n\t\t\t\t\tfocus: false,\n\t\t\t\t\texpand: true,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: quickpick => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tvoid GitActions.Repository.reveal(quickpick.activeItems[0].item.path, context.associatedView, {\n\t\t\t\tselect: true,\n\t\t\t\tfocus: false,\n\t\t\t\texpand: true,\n\t\t\t});\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection.map(i => i.item) : StepResult.Break;\n}\n\nexport function* pickStashStep<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n\t{\n\t\tignoreFocusOut,\n\t\tstash,\n\t\tpicked,\n\t\tplaceholder,\n\t\ttitleContext,\n\t}: {\n\t\tignoreFocusOut?: boolean;\n\t\tstash: GitStash | undefined;\n\t\tpicked: string | string[] | undefined;\n\t\tplaceholder: string | ((context: Context, stash: GitStash | undefined) => string);\n\t\ttitleContext?: string;\n\t},\n): StepResultGenerator<GitStashCommit> {\n\tconst step = QuickCommand.createPickStep<CommitQuickPickItem<GitStashCommit>>({\n\t\ttitle: appendReposToTitle(`${context.title}${titleContext ?? ''}`, state, context),\n\t\tplaceholder: typeof placeholder === 'string' ? placeholder : placeholder(context, stash),\n\t\tignoreFocusOut: ignoreFocusOut,\n\t\tmatchOnDescription: true,\n\t\tmatchOnDetail: true,\n\t\titems:\n\t\t\tstash == null\n\t\t\t\t? [DirectiveQuickPickItem.create(Directive.Back, true), DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t\t: [\n\t\t\t\t\t\t...map(stash.commits.values(), commit =>\n\t\t\t\t\t\t\tCommitQuickPickItem.create(\n\t\t\t\t\t\t\t\tcommit,\n\t\t\t\t\t\t\t\tpicked != null &&\n\t\t\t\t\t\t\t\t\t(typeof picked === 'string' ? commit.ref === picked : picked.includes(commit.ref)),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbuttons: [QuickCommandButtons.RevealInSideBar],\n\t\t\t\t\t\t\t\t\tcompact: true,\n\t\t\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t  ],\n\t\tonDidClickItemButton: (_quickpick, button, { item }) => {\n\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\tvoid GitActions.Stash.reveal(item, {\n\t\t\t\t\tselect: true,\n\t\t\t\t\tfocus: false,\n\t\t\t\t\texpand: true,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: async quickpick => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tawait GitActions.Stash.reveal(quickpick.activeItems[0].item, {\n\t\t\t\tselect: true,\n\t\t\t\tfocus: false,\n\t\t\t\texpand: true,\n\t\t\t});\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n}\n\nexport async function* pickTagsStep<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; showTags?: boolean; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n\t{\n\t\tfilter,\n\t\tpicked,\n\t\tplaceholder,\n\t\ttitleContext,\n\t}: {\n\t\tfilter?: (b: GitTag) => boolean;\n\t\tpicked?: string | string[];\n\t\tplaceholder: string;\n\t\ttitleContext?: string;\n\t},\n): AsyncStepResultGenerator<GitTagReference[]> {\n\tconst tags = await getTags(state.repo, {\n\t\tbuttons: [QuickCommandButtons.RevealInSideBar],\n\t\tfilter: filter,\n\t\tpicked: picked,\n\t});\n\n\tconst step = QuickCommand.createPickStep<TagQuickPickItem>({\n\t\tmultiselect: tags.length !== 0,\n\t\ttitle: appendReposToTitle(`${context.title}${titleContext ?? ''}`, state, context),\n\t\tplaceholder: tags.length === 0 ? `No tags found in ${state.repo.formattedName}` : placeholder,\n\t\tmatchOnDetail: true,\n\t\titems:\n\t\t\ttags.length === 0\n\t\t\t\t? [DirectiveQuickPickItem.create(Directive.Back, true), DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t\t: tags,\n\t\tonDidClickItemButton: (quickpick, button, { item }) => {\n\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\tvoid GitActions.Tag.reveal(item, {\n\t\t\t\t\tselect: true,\n\t\t\t\t\tfocus: false,\n\t\t\t\t\texpand: true,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: async quickpick => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tawait GitActions.Tag.reveal(quickpick.activeItems[0].item, {\n\t\t\t\tselect: true,\n\t\t\t\tfocus: false,\n\t\t\t\texpand: true,\n\t\t\t});\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection.map(i => i.item) : StepResult.Break;\n}\n\nexport async function* pickWorktreeStep<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; title: string; worktrees?: GitWorktree[] },\n>(\n\tstate: State,\n\tcontext: Context,\n\t{\n\t\tfilter,\n\t\tincludeStatus,\n\t\tpicked,\n\t\tplaceholder,\n\t\ttitleContext,\n\t}: {\n\t\tfilter?: (b: GitWorktree) => boolean;\n\t\tincludeStatus?: boolean;\n\t\tpicked?: string | string[];\n\t\tplaceholder: string;\n\t\ttitleContext?: string;\n\t},\n): AsyncStepResultGenerator<GitWorktree> {\n\tconst worktrees = await getWorktrees(context.worktrees ?? state.repo, {\n\t\tbuttons: [QuickCommandButtons.OpenInNewWindow, QuickCommandButtons.RevealInSideBar],\n\t\tfilter: filter,\n\t\tincludeStatus: includeStatus,\n\t\tpicked: picked,\n\t});\n\n\tconst step = QuickCommand.createPickStep<WorktreeQuickPickItem>({\n\t\ttitle: appendReposToTitle(`${context.title}${titleContext ?? ''}`, state, context),\n\t\tplaceholder: worktrees.length === 0 ? `No worktrees found in ${state.repo.formattedName}` : placeholder,\n\t\tmatchOnDetail: true,\n\t\titems:\n\t\t\tworktrees.length === 0\n\t\t\t\t? [DirectiveQuickPickItem.create(Directive.Back, true), DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t\t: worktrees,\n\t\tonDidClickItemButton: (quickpick, button, { item }) => {\n\t\t\tswitch (button) {\n\t\t\t\tcase QuickCommandButtons.OpenInNewWindow:\n\t\t\t\t\tvoid GitActions.Worktree.open(item, { location: OpenWorkspaceLocation.NewWindow });\n\t\t\t\t\tbreak;\n\t\t\t\tcase QuickCommandButtons.RevealInSideBar:\n\t\t\t\t\tvoid GitActions.Worktree.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: async quickpick => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tawait GitActions.Worktree.reveal(quickpick.activeItems[0].item, {\n\t\t\t\tselect: true,\n\t\t\t\tfocus: false,\n\t\t\t\texpand: true,\n\t\t\t});\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0].item : StepResult.Break;\n}\n\nexport async function* pickWorktreesStep<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; title: string; worktrees?: GitWorktree[] },\n>(\n\tstate: State,\n\tcontext: Context,\n\t{\n\t\tfilter,\n\t\tincludeStatus,\n\t\tpicked,\n\t\tplaceholder,\n\t\ttitleContext,\n\t}: {\n\t\tfilter?: (b: GitWorktree) => boolean;\n\t\tincludeStatus?: boolean;\n\t\tpicked?: string | string[];\n\t\tplaceholder: string;\n\t\ttitleContext?: string;\n\t},\n): AsyncStepResultGenerator<GitWorktree[]> {\n\tconst worktrees = await getWorktrees(context.worktrees ?? state.repo, {\n\t\tbuttons: [QuickCommandButtons.OpenInNewWindow, QuickCommandButtons.RevealInSideBar],\n\t\tfilter: filter,\n\t\tincludeStatus: includeStatus,\n\t\tpicked: picked,\n\t});\n\n\tconst step = QuickCommand.createPickStep<WorktreeQuickPickItem>({\n\t\tmultiselect: worktrees.length !== 0,\n\t\ttitle: appendReposToTitle(`${context.title}${titleContext ?? ''}`, state, context),\n\t\tplaceholder: worktrees.length === 0 ? `No worktrees found in ${state.repo.formattedName}` : placeholder,\n\t\tmatchOnDetail: true,\n\t\titems:\n\t\t\tworktrees.length === 0\n\t\t\t\t? [DirectiveQuickPickItem.create(Directive.Back, true), DirectiveQuickPickItem.create(Directive.Cancel)]\n\t\t\t\t: worktrees,\n\t\tonDidClickItemButton: (quickpick, button, { item }) => {\n\t\t\tswitch (button) {\n\t\t\t\tcase QuickCommandButtons.OpenInNewWindow:\n\t\t\t\t\tvoid GitActions.Worktree.open(item, { location: OpenWorkspaceLocation.NewWindow });\n\t\t\t\t\tbreak;\n\t\t\t\tcase QuickCommandButtons.RevealInSideBar:\n\t\t\t\t\tvoid GitActions.Worktree.reveal(item, { select: true, focus: false, expand: true });\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: async quickpick => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tawait GitActions.Worktree.reveal(quickpick.activeItems[0].item, {\n\t\t\t\tselect: true,\n\t\t\t\tfocus: false,\n\t\t\t\texpand: true,\n\t\t\t});\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection.map(i => i.item) : StepResult.Break;\n}\n\nexport async function* showCommitOrStashStep<\n\tState extends PartialStepState & { repo: Repository; reference: GitCommit | GitStashCommit },\n\tContext extends { repos: Repository[]; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n): AsyncStepResultGenerator<CommitFilesQuickPickItem | GitCommandQuickPickItem | CommandQuickPickItem> {\n\tconst step: QuickPickStep<CommitFilesQuickPickItem | GitCommandQuickPickItem | CommandQuickPickItem> =\n\t\tQuickCommand.createPickStep({\n\t\t\ttitle: appendReposToTitle(\n\t\t\t\tGitReference.toString(state.reference, {\n\t\t\t\t\tcapitalize: true,\n\t\t\t\t\ticon: false,\n\t\t\t\t}),\n\t\t\t\tstate,\n\t\t\t\tcontext,\n\t\t\t),\n\t\t\tplaceholder: GitReference.toString(state.reference, { capitalize: true, icon: false }),\n\t\t\tignoreFocusOut: true,\n\t\t\titems: await getShowCommitOrStashStepItems(state),\n\t\t\t// additionalButtons: GitReference.isStash(state.reference)\n\t\t\t// \t? [QuickCommandButtons.RevealInSideBar]\n\t\t\t// \t: [QuickCommandButtons.RevealInSideBar, QuickCommandButtons.SearchInSideBar],\n\t\t\tonDidClickItemButton: (quickpick, button, _item) => {\n\t\t\t\tif (button === QuickCommandButtons.SearchInSideBar) {\n\t\t\t\t\tvoid Container.instance.searchAndCompareView.search(\n\t\t\t\t\t\tstate.repo.path,\n\t\t\t\t\t\t{ pattern: SearchPattern.fromCommit(state.reference.ref) },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: { label: `for ${GitReference.toString(state.reference, { icon: false })}` },\n\t\t\t\t\t\t\treveal: {\n\t\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\t\tif (GitReference.isStash(state.reference)) {\n\t\t\t\t\t\tvoid GitActions.Stash.reveal(state.reference, {\n\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvoid GitActions.Commit.reveal(state.reference, {\n\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\t\tonDidPressKey: async (quickpick, key) => {\n\t\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\t\tvoid (await quickpick.activeItems[0].onDidPressKey(key));\n\t\t\t},\n\t\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0] : StepResult.Break;\n}\n\nasync function getShowCommitOrStashStepItems<\n\tState extends PartialStepState & { repo: Repository; reference: GitCommit | GitStashCommit },\n>(state: State): Promise<CommandQuickPickItem[]> {\n\tconst items: (CommandQuickPickItem | QuickPickSeparator)[] = [];\n\n\tlet unpublished: boolean | undefined;\n\n\tif (GitCommit.isStash(state.reference)) {\n\t\titems.push(\n\t\t\tQuickPickSeparator.create('Actions'),\n\t\t\tnew GitCommandQuickPickItem('Apply Stash...', {\n\t\t\t\tcommand: 'stash',\n\t\t\t\tstate: {\n\t\t\t\t\tsubcommand: 'apply',\n\t\t\t\t\trepo: state.repo,\n\t\t\t\t\treference: state.reference,\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew GitCommandQuickPickItem('Delete Stash...', {\n\t\t\t\tcommand: 'stash',\n\t\t\t\tstate: {\n\t\t\t\t\tsubcommand: 'drop',\n\t\t\t\t\trepo: state.repo,\n\t\t\t\t\treference: state.reference,\n\t\t\t\t},\n\t\t\t}),\n\n\t\t\tQuickPickSeparator.create(),\n\t\t\tnew CommitCopyMessageQuickPickItem(state.reference),\n\t\t);\n\t} else {\n\t\tconst remotes = await Container.instance.git.getRemotesWithProviders(state.repo.path, { sort: true });\n\t\tif (remotes?.length) {\n\t\t\titems.push(\n\t\t\t\tQuickPickSeparator.create(GitRemote.getHighlanderProviderName(remotes) ?? 'Remote'),\n\t\t\t\tnew OpenRemoteResourceCommandQuickPickItem(remotes, {\n\t\t\t\t\ttype: RemoteResourceType.Commit,\n\t\t\t\t\tsha: state.reference.sha,\n\t\t\t\t}),\n\t\t\t\tnew CopyRemoteResourceCommandQuickPickItem(remotes, {\n\t\t\t\t\ttype: RemoteResourceType.Commit,\n\t\t\t\t\tsha: state.reference.sha,\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\titems.push(QuickPickSeparator.create('Actions'));\n\n\t\tconst branch = await Container.instance.git.getBranch(state.repo.path);\n\t\tconst [branches, published] = await Promise.all([\n\t\t\tbranch != null\n\t\t\t\t? Container.instance.git.getCommitBranches(state.repo.path, state.reference.ref, {\n\t\t\t\t\t\tbranch: branch.name,\n\t\t\t\t\t\tcommitDate: GitCommit.is(state.reference) ? state.reference.committer.date : undefined,\n\t\t\t\t  })\n\t\t\t\t: undefined,\n\t\t\t!branch?.remote && branch?.upstream != null ? state.reference.isPushed() : undefined,\n\t\t]);\n\n\t\tconst commitOnCurrentBranch = Boolean(branches?.length);\n\t\tif (commitOnCurrentBranch) {\n\t\t\tunpublished = !published;\n\t\t\tif (unpublished) {\n\t\t\t\t// TODO@eamodio Add Undo commit, if HEAD & unpushed\n\n\t\t\t\titems.push(\n\t\t\t\t\tnew GitCommandQuickPickItem('Push to Commit...', {\n\t\t\t\t\t\tcommand: 'push',\n\t\t\t\t\t\tstate: {\n\t\t\t\t\t\t\trepos: state.repo,\n\t\t\t\t\t\t\treference: state.reference,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\titems.push(\n\t\t\t\tnew GitCommandQuickPickItem('Revert Commit...', {\n\t\t\t\t\tcommand: 'revert',\n\t\t\t\t\tstate: {\n\t\t\t\t\t\trepo: state.repo,\n\t\t\t\t\t\treferences: [state.reference],\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew GitCommandQuickPickItem(`Reset ${branch?.name ?? 'Current Branch'} to Commit...`, {\n\t\t\t\t\tcommand: 'reset',\n\t\t\t\t\tstate: {\n\t\t\t\t\t\trepo: state.repo,\n\t\t\t\t\t\treference: state.reference,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew GitCommandQuickPickItem(`Reset ${branch?.name ?? 'Current Branch'} to Previous Commit...`, {\n\t\t\t\t\tcommand: 'reset',\n\t\t\t\t\tstate: {\n\t\t\t\t\t\trepo: state.repo,\n\t\t\t\t\t\treference: GitReference.create(`${state.reference.ref}^`, state.reference.repoPath, {\n\t\t\t\t\t\t\trefType: 'revision',\n\t\t\t\t\t\t\tname: `${state.reference.name}^`,\n\t\t\t\t\t\t\tmessage: state.reference.message,\n\t\t\t\t\t\t}),\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t);\n\t\t} else {\n\t\t\titems.push(\n\t\t\t\tnew GitCommandQuickPickItem('Cherry Pick Commit...', {\n\t\t\t\t\tcommand: 'cherry-pick',\n\t\t\t\t\tstate: {\n\t\t\t\t\t\trepo: state.repo,\n\t\t\t\t\t\treferences: [state.reference],\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\titems.push(\n\t\t\tnew GitCommandQuickPickItem(`Rebase ${branch?.name ?? 'Current Branch'} onto Commit...`, {\n\t\t\t\tcommand: 'rebase',\n\t\t\t\tstate: {\n\t\t\t\t\trepo: state.repo,\n\t\t\t\t\treference: state.reference,\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew GitCommandQuickPickItem('Switch to Commit...', {\n\t\t\t\tcommand: 'switch',\n\t\t\t\tstate: {\n\t\t\t\t\trepos: [state.repo],\n\t\t\t\t\treference: state.reference,\n\t\t\t\t},\n\t\t\t}),\n\n\t\t\tQuickPickSeparator.create(),\n\t\t\tnew GitCommandQuickPickItem('Create Branch at Commit...', {\n\t\t\t\tcommand: 'branch',\n\t\t\t\tstate: {\n\t\t\t\t\tsubcommand: 'create',\n\t\t\t\t\trepo: state.repo,\n\t\t\t\t\treference: state.reference,\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew GitCommandQuickPickItem('Create Tag at Commit...', {\n\t\t\t\tcommand: 'tag',\n\t\t\t\tstate: {\n\t\t\t\t\tsubcommand: 'create',\n\t\t\t\t\trepo: state.repo,\n\t\t\t\t\treference: state.reference,\n\t\t\t\t},\n\t\t\t}),\n\n\t\t\tQuickPickSeparator.create('Copy'),\n\t\t\tnew CommitCopyIdQuickPickItem(state.reference),\n\t\t\tnew CommitCopyMessageQuickPickItem(state.reference),\n\t\t);\n\t}\n\n\titems.push(\n\t\tQuickPickSeparator.create('Open'),\n\t\tnew CommitOpenAllChangesCommandQuickPickItem(state.reference),\n\t\tnew CommitOpenAllChangesWithWorkingCommandQuickPickItem(state.reference),\n\t\tnew CommitOpenAllChangesWithDiffToolCommandQuickPickItem(state.reference),\n\t\tQuickPickSeparator.create(),\n\t\tnew CommitOpenFilesCommandQuickPickItem(state.reference),\n\t\tnew CommitOpenRevisionsCommandQuickPickItem(state.reference),\n\t);\n\n\titems.push(\n\t\tQuickPickSeparator.create('Compare'),\n\t\tnew CommitCompareWithHEADCommandQuickPickItem(state.reference),\n\t\tnew CommitCompareWithWorkingCommandQuickPickItem(state.reference),\n\t);\n\n\titems.push(\n\t\tQuickPickSeparator.create(),\n\t\tnew CommitOpenDirectoryCompareCommandQuickPickItem(state.reference),\n\t\tnew CommitOpenDirectoryCompareWithWorkingCommandQuickPickItem(state.reference),\n\t);\n\n\titems.push(\n\t\tQuickPickSeparator.create('Browse'),\n\t\tnew CommitBrowseRepositoryFromHereCommandQuickPickItem(state.reference, { openInNewWindow: false }),\n\t\tnew CommitBrowseRepositoryFromHereCommandQuickPickItem(state.reference, {\n\t\t\tbefore: true,\n\t\t\topenInNewWindow: false,\n\t\t}),\n\t\tnew CommitBrowseRepositoryFromHereCommandQuickPickItem(state.reference, { openInNewWindow: true }),\n\t\tnew CommitBrowseRepositoryFromHereCommandQuickPickItem(state.reference, {\n\t\t\tbefore: true,\n\t\t\topenInNewWindow: true,\n\t\t}),\n\t);\n\n\titems.splice(\n\t\t0,\n\t\t0,\n\t\tnew CommitFilesQuickPickItem(state.reference, {\n\t\t\tunpublished: unpublished,\n\t\t\thint: 'Click to see all changed files',\n\t\t}),\n\t);\n\treturn items as CommandQuickPickItem[];\n}\n\nexport function* showCommitOrStashFilesStep<\n\tState extends PartialStepState & {\n\t\trepo: Repository;\n\t\treference: GitCommit | GitStashCommit;\n\t\tfileName?: string | undefined;\n\t},\n\tContext extends { repos: Repository[]; title: string },\n>(\n\tstate: State,\n\tcontext: Context,\n\toptions?: { picked?: string },\n): StepResultGenerator<CommitFilesQuickPickItem | CommitFileQuickPickItem> {\n\tif (state.reference.files == null) {\n\t\tdebugger;\n\t}\n\n\tconst step: QuickPickStep<CommitFilesQuickPickItem | CommitFileQuickPickItem> = QuickCommand.createPickStep({\n\t\ttitle: appendReposToTitle(\n\t\t\tGitReference.toString(state.reference, {\n\t\t\t\tcapitalize: true,\n\t\t\t\ticon: false,\n\t\t\t}),\n\t\t\tstate,\n\t\t\tcontext,\n\t\t),\n\t\tplaceholder: GitReference.toString(state.reference, { capitalize: true, icon: false }),\n\t\tignoreFocusOut: true,\n\t\titems: [\n\t\t\tnew CommitFilesQuickPickItem(state.reference, {\n\t\t\t\tpicked: state.fileName == null,\n\t\t\t\thint: `Click to see ${GitCommit.isStash(state.reference) ? 'stash' : 'commit'} actions`,\n\t\t\t}),\n\t\t\tQuickPickSeparator.create('Files'),\n\t\t\t...(state.reference.files?.map(\n\t\t\t\tfs => new CommitFileQuickPickItem(state.reference, fs, options?.picked === fs.path),\n\t\t\t) ?? []),\n\t\t] as (CommitFilesQuickPickItem | CommitFileQuickPickItem)[],\n\t\tmatchOnDescription: true,\n\t\t// additionalButtons: [QuickCommandButtons.RevealInSideBar, QuickCommandButtons.SearchInSideBar],\n\t\tonDidClickItemButton: (quickpick, button, _item) => {\n\t\t\tif (button === QuickCommandButtons.SearchInSideBar) {\n\t\t\t\tvoid Container.instance.searchAndCompareView.search(\n\t\t\t\t\tstate.repo.path,\n\t\t\t\t\t{ pattern: SearchPattern.fromCommit(state.reference.ref) },\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: { label: `for ${GitReference.toString(state.reference, { icon: false })}` },\n\t\t\t\t\t\treveal: {\n\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\tif (GitReference.isStash(state.reference)) {\n\t\t\t\t\tvoid GitActions.Stash.reveal(state.reference, {\n\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\texpand: true,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tvoid GitActions.Commit.reveal(state.reference, {\n\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\texpand: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: async (quickpick, key) => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tvoid (await quickpick.activeItems[0].onDidPressKey(key));\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0] : StepResult.Break;\n}\n\nexport async function* showCommitOrStashFileStep<\n\tState extends PartialStepState & {\n\t\trepo: Repository;\n\t\treference: GitCommit | GitStashCommit;\n\t\tfileName: string;\n\t},\n\tContext extends { repos: Repository[]; title: string },\n>(state: State, context: Context): AsyncStepResultGenerator<CommandQuickPickItem> {\n\tconst step: QuickPickStep<CommandQuickPickItem> = QuickCommand.createPickStep<CommandQuickPickItem>({\n\t\ttitle: appendReposToTitle(\n\t\t\tGitReference.toString(state.reference, {\n\t\t\t\tcapitalize: true,\n\t\t\t\ticon: false,\n\t\t\t}),\n\t\t\tstate,\n\t\t\tcontext,\n\t\t\t`${pad(GlyphChars.Dot, 2, 2)}${formatPath(state.fileName, { fileOnly: true })}`,\n\t\t),\n\t\tplaceholder: `${formatPath(state.fileName, {\n\t\t\trelativeTo: state.repo.path,\n\t\t})} in ${GitReference.toString(state.reference, {\n\t\t\ticon: false,\n\t\t})}`,\n\t\tignoreFocusOut: true,\n\t\titems: await getShowCommitOrStashFileStepItems(state),\n\t\tmatchOnDescription: true,\n\t\t// additionalButtons: [QuickCommandButtons.RevealInSideBar, QuickCommandButtons.SearchInSideBar],\n\t\tonDidClickItemButton: (quickpick, button, _item) => {\n\t\t\tif (button === QuickCommandButtons.SearchInSideBar) {\n\t\t\t\tvoid Container.instance.searchAndCompareView.search(\n\t\t\t\t\tstate.repo.path,\n\t\t\t\t\t{ pattern: SearchPattern.fromCommit(state.reference.ref) },\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: { label: `for ${GitReference.toString(state.reference, { icon: false })}` },\n\t\t\t\t\t\treveal: {\n\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\tif (GitReference.isStash(state.reference)) {\n\t\t\t\t\tvoid GitActions.Stash.reveal(state.reference, {\n\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\texpand: true,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tvoid GitActions.Commit.reveal(state.reference, {\n\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\tfocus: false,\n\t\t\t\t\t\texpand: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: async (quickpick, key) => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tvoid (await quickpick.activeItems[0].onDidPressKey(key));\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0] : StepResult.Break;\n}\n\nasync function getShowCommitOrStashFileStepItems<\n\tState extends PartialStepState & {\n\t\trepo: Repository;\n\t\treference: GitCommit | GitStashCommit;\n\t\tfileName: string;\n\t},\n>(state: State) {\n\tconst file = await state.reference.findFile(state.fileName);\n\tif (file == null) return [];\n\n\tconst items: (CommandQuickPickItem | QuickPickSeparator)[] = [];\n\n\tif (GitCommit.isStash(state.reference)) {\n\t\titems.push(\n\t\t\tQuickPickSeparator.create(),\n\t\t\tnew CommitCopyMessageQuickPickItem(state.reference),\n\t\t\tQuickPickSeparator.create('Actions'),\n\t\t\tnew CommitApplyFileChangesCommandQuickPickItem(state.reference, file),\n\t\t\tnew CommitRestoreFileChangesCommandQuickPickItem(state.reference, file),\n\t\t\tQuickPickSeparator.create(),\n\t\t\tnew CommitCopyMessageQuickPickItem(state.reference),\n\t\t);\n\t} else {\n\t\tconst remotes = await Container.instance.git.getRemotesWithProviders(state.repo.path, { sort: true });\n\t\tif (remotes?.length) {\n\t\t\titems.push(\n\t\t\t\tQuickPickSeparator.create(GitRemote.getHighlanderProviderName(remotes) ?? 'Remote'),\n\t\t\t\tnew OpenRemoteResourceCommandQuickPickItem(remotes, {\n\t\t\t\t\ttype: RemoteResourceType.Revision,\n\t\t\t\t\tfileName: state.fileName,\n\t\t\t\t\tcommit: state.reference,\n\t\t\t\t}),\n\t\t\t\tnew CopyRemoteResourceCommandQuickPickItem(remotes, {\n\t\t\t\t\ttype: RemoteResourceType.Revision,\n\t\t\t\t\tfileName: state.fileName,\n\t\t\t\t\tcommit: state.reference,\n\t\t\t\t}),\n\t\t\t\tQuickPickSeparator.create(),\n\t\t\t\tnew OpenRemoteResourceCommandQuickPickItem(remotes, {\n\t\t\t\t\ttype: RemoteResourceType.Commit,\n\t\t\t\t\tsha: state.reference.ref,\n\t\t\t\t}),\n\t\t\t\tnew CopyRemoteResourceCommandQuickPickItem(remotes, {\n\t\t\t\t\ttype: RemoteResourceType.Commit,\n\t\t\t\t\tsha: state.reference.sha,\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\titems.push(\n\t\t\tQuickPickSeparator.create('Actions'),\n\t\t\tnew CommitApplyFileChangesCommandQuickPickItem(state.reference, file),\n\t\t\tnew CommitRestoreFileChangesCommandQuickPickItem(state.reference, file),\n\t\t\tQuickPickSeparator.create('Copy'),\n\t\t\tnew CommitCopyIdQuickPickItem(state.reference),\n\t\t\tnew CommitCopyMessageQuickPickItem(state.reference),\n\t\t);\n\t}\n\n\titems.push(\n\t\tQuickPickSeparator.create('Open'),\n\t\tnew CommitOpenChangesCommandQuickPickItem(state.reference, state.fileName),\n\t\tnew CommitOpenChangesWithWorkingCommandQuickPickItem(state.reference, state.fileName),\n\t\tnew CommitOpenChangesWithDiffToolCommandQuickPickItem(state.reference, state.fileName),\n\t\tQuickPickSeparator.create(),\n\t);\n\n\tif (file.status !== 'D') {\n\t\titems.push(new CommitOpenFileCommandQuickPickItem(state.reference, file));\n\t}\n\titems.push(new CommitOpenRevisionCommandQuickPickItem(state.reference, file));\n\n\titems.push(\n\t\tQuickPickSeparator.create('Compare'),\n\t\tnew CommitCompareWithHEADCommandQuickPickItem(state.reference),\n\t\tnew CommitCompareWithWorkingCommandQuickPickItem(state.reference),\n\t);\n\n\titems.push(\n\t\tQuickPickSeparator.create('Browse'),\n\t\tnew CommitBrowseRepositoryFromHereCommandQuickPickItem(state.reference, { openInNewWindow: false }),\n\t\tnew CommitBrowseRepositoryFromHereCommandQuickPickItem(state.reference, {\n\t\t\tbefore: true,\n\t\t\topenInNewWindow: false,\n\t\t}),\n\t\tnew CommitBrowseRepositoryFromHereCommandQuickPickItem(state.reference, { openInNewWindow: true }),\n\t\tnew CommitBrowseRepositoryFromHereCommandQuickPickItem(state.reference, {\n\t\t\tbefore: true,\n\t\t\topenInNewWindow: true,\n\t\t}),\n\t);\n\n\titems.splice(\n\t\t0,\n\t\t0,\n\t\tnew CommitFilesQuickPickItem(state.reference, { file: file, hint: 'Click to see all changed files' }),\n\t);\n\treturn items as CommandQuickPickItem[];\n}\n\nexport function* showRepositoryStatusStep<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; title: string; status: GitStatus },\n>(state: State, context: Context): StepResultGenerator<CommandQuickPickItem> {\n\tconst upstream = context.status.getUpstreamStatus({ expand: true, separator: ', ' });\n\tconst working = context.status.getFormattedDiffStatus({ expand: true, separator: ', ' });\n\tconst step: QuickPickStep<CommandQuickPickItem> = QuickCommand.createPickStep<CommandQuickPickItem>({\n\t\ttitle: appendReposToTitle(context.title, state, context),\n\t\tplaceholder: `${upstream ? `${upstream}, ${working}` : working}`, //'Changes to be committed',\n\t\tignoreFocusOut: true,\n\t\titems: getShowRepositoryStatusStepItems(state, context),\n\t\tkeys: ['right', 'alt+right', 'ctrl+right'],\n\t\tonDidPressKey: async (quickpick, key) => {\n\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\tvoid (await quickpick.activeItems[0].onDidPressKey(key));\n\t\t},\n\t});\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? selection[0] : StepResult.Break;\n}\n\nfunction getShowRepositoryStatusStepItems<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; title: string; status: GitStatus },\n>(state: State, context: Context) {\n\tconst items: (DirectiveQuickPickItem | CommandQuickPickItem)[] = [];\n\n\tconst computed = context.status.computeWorkingTreeStatus();\n\n\tlet workingTreeStatus;\n\tif (computed.staged === 0 && computed.unstaged === 0) {\n\t\tworkingTreeStatus = 'No working tree changes';\n\t} else {\n\t\tworkingTreeStatus = `$(files) ${\n\t\t\tcomputed.staged ? `${pluralize('staged file', computed.staged)} (${computed.stagedStatus})` : ''\n\t\t}${\n\t\t\tcomputed.unstaged\n\t\t\t\t? `${computed.staged ? ', ' : ''}${pluralize('unstaged file', computed.unstaged)} (${\n\t\t\t\t\t\tcomputed.unstagedStatus\n\t\t\t\t  })`\n\t\t\t\t: ''\n\t\t}`;\n\t}\n\n\tif (context.status.upstream) {\n\t\tif (context.status.state.ahead === 0 && context.status.state.behind === 0) {\n\t\t\titems.push(\n\t\t\t\tDirectiveQuickPickItem.create(Directive.Noop, true, {\n\t\t\t\t\tlabel: `$(git-branch) ${context.status.branch} is up to date with $(git-branch) ${context.status.upstream}`,\n\t\t\t\t\tdetail: workingTreeStatus,\n\t\t\t\t}),\n\t\t\t);\n\t\t} else if (context.status.state.ahead !== 0 && context.status.state.behind !== 0) {\n\t\t\titems.push(\n\t\t\t\tDirectiveQuickPickItem.create(Directive.Noop, true, {\n\t\t\t\t\tlabel: `$(git-branch) ${context.status.branch} has diverged from $(git-branch) ${context.status.upstream}`,\n\t\t\t\t\tdetail: workingTreeStatus,\n\t\t\t\t}),\n\t\t\t);\n\t\t} else if (context.status.state.ahead !== 0) {\n\t\t\titems.push(\n\t\t\t\tDirectiveQuickPickItem.create(Directive.Noop, true, {\n\t\t\t\t\tlabel: `$(git-branch) ${context.status.branch} is ahead of $(git-branch) ${context.status.upstream}`,\n\t\t\t\t\tdetail: workingTreeStatus,\n\t\t\t\t}),\n\t\t\t);\n\t\t} else if (context.status.state.behind !== 0) {\n\t\t\titems.push(\n\t\t\t\tDirectiveQuickPickItem.create(Directive.Noop, true, {\n\t\t\t\t\tlabel: `$(git-branch) ${context.status.branch} is behind $(git-branch) ${context.status.upstream}`,\n\t\t\t\t\tdetail: workingTreeStatus,\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tif (context.status.state.behind !== 0) {\n\t\t\titems.push(\n\t\t\t\tnew GitCommandQuickPickItem(\n\t\t\t\t\t`$(cloud-download) ${pluralize('commit', context.status.state.behind)} behind`,\n\t\t\t\t\t{\n\t\t\t\t\t\tcommand: 'log',\n\t\t\t\t\t\tstate: {\n\t\t\t\t\t\t\trepo: state.repo,\n\t\t\t\t\t\t\treference: GitReference.create(\n\t\t\t\t\t\t\t\tGitRevision.createRange(context.status.ref, context.status.upstream),\n\t\t\t\t\t\t\t\tstate.repo.path,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tif (context.status.state.ahead !== 0) {\n\t\t\titems.push(\n\t\t\t\tnew GitCommandQuickPickItem(\n\t\t\t\t\t`$(cloud-upload) ${pluralize('commit', context.status.state.ahead)} ahead`,\n\t\t\t\t\t{\n\t\t\t\t\t\tcommand: 'log',\n\t\t\t\t\t\tstate: {\n\t\t\t\t\t\t\trepo: state.repo,\n\t\t\t\t\t\t\treference: GitReference.create(\n\t\t\t\t\t\t\t\tGitRevision.createRange(context.status.upstream, context.status.ref),\n\t\t\t\t\t\t\t\tstate.repo.path,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t} else {\n\t\titems.push(\n\t\t\tDirectiveQuickPickItem.create(Directive.Noop, true, {\n\t\t\t\tlabel: `$(git-branch) ${context.status.branch} has no upstream`,\n\t\t\t\tdetail: workingTreeStatus,\n\t\t\t}),\n\t\t);\n\t}\n\n\tif (context.status.files.length) {\n\t\titems.push(\n\t\t\tnew OpenChangedFilesCommandQuickPickItem(\n\t\t\t\tcomputed.stagedAddsAndChanges.concat(computed.unstagedAddsAndChanges),\n\t\t\t),\n\t\t);\n\t}\n\n\tif (computed.staged > 0) {\n\t\titems.push(\n\t\t\tnew OpenChangedFilesCommandQuickPickItem(computed.stagedAddsAndChanges, {\n\t\t\t\tlabel: '$(files) Open Staged Files',\n\t\t\t}),\n\t\t);\n\t}\n\n\tif (computed.unstaged > 0) {\n\t\titems.push(\n\t\t\tnew OpenChangedFilesCommandQuickPickItem(computed.unstagedAddsAndChanges, {\n\t\t\t\tlabel: '$(files) Open Unstaged Files',\n\t\t\t}),\n\t\t);\n\t}\n\n\tif (context.status.files.length) {\n\t\titems.push(new CommandQuickPickItem('$(x) Close Unchanged Files', Commands.CloseUnchangedFiles));\n\t}\n\n\treturn items;\n}\n\nexport async function* ensureAccessStep<\n\tState extends PartialStepState & { repo: Repository },\n\tContext extends { repos: Repository[]; title: string },\n>(state: State, context: Context, feature: PremiumFeatures): AsyncStepResultGenerator<void> {\n\tconst access = await Container.instance.git.access(feature, state.repo.path);\n\tif (access.allowed) return undefined;\n\n\tconst directives: DirectiveQuickPickItem[] = [];\n\tlet placeholder: string;\n\tif (access.subscription.current.account?.verified === false) {\n\t\tdirectives.push(DirectiveQuickPickItem.create(Directive.RequiresVerification, true));\n\t\tplaceholder = 'You must verify your account email address before you can continue';\n\t} else {\n\t\tif (access.subscription.required == null) return undefined;\n\n\t\tif (isSubscriptionPaidPlan(access.subscription.required) && access.subscription.current.account != null) {\n\t\t\tdirectives.push(DirectiveQuickPickItem.create(Directive.RequiresPaidSubscription, true));\n\t\t\tplaceholder = 'Premium features require an upgraded account';\n\t\t} else {\n\t\t\tif (\n\t\t\t\taccess.subscription.current.account == null &&\n\t\t\t\t!isSubscriptionPreviewTrialExpired(access.subscription.current)\n\t\t\t) {\n\t\t\t\tdirectives.push(\n\t\t\t\t\tDirectiveQuickPickItem.create(Directive.StartPreviewTrial, true),\n\t\t\t\t\tDirectiveQuickPickItem.create(Directive.RequiresFreeSubscription),\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tdirectives.push(DirectiveQuickPickItem.create(Directive.RequiresFreeSubscription));\n\t\t\t}\n\t\t\tplaceholder = 'Premium features require an account';\n\t\t}\n\t}\n\n\tconst step = QuickCommand.createPickStep<DirectiveQuickPickItem>({\n\t\ttitle: appendReposToTitle(context.title, state, context),\n\t\tplaceholder: placeholder,\n\t\titems: [...directives, DirectiveQuickPickItem.create(Directive.Cancel)],\n\t});\n\n\tconst selection: StepSelection<typeof step> = yield step;\n\treturn QuickCommand.canPickStepContinue(step, state, selection) ? undefined : StepResult.Break;\n}\n","import { InputBox, QuickInputButton, QuickPick, QuickPickItem } from 'vscode';\nimport type { Container } from '../container';\nimport { Keys } from '../keyboard';\nimport { Directive, DirectiveQuickPickItem } from '../quickpicks/items/directive';\n\nexport * from './quickCommand.buttons';\nexport * from './quickCommand.steps';\n\nexport interface CustomStep<T = unknown> {\n\tignoreFocusOut?: boolean;\n\n\tshow(step: CustomStep<T>): Promise<StepResult<Directive | T>>;\n}\n\nexport function isCustomStep(\n\tstep: QuickPickStep | QuickInputStep | CustomStep | typeof StepResult.Break,\n): step is CustomStep {\n\treturn typeof step === 'object' && (step as CustomStep).show != null;\n}\n\nexport interface QuickInputStep {\n\tadditionalButtons?: QuickInputButton[];\n\tbuttons?: QuickInputButton[];\n\tignoreFocusOut?: boolean;\n\tkeys?: StepNavigationKeys[];\n\tplaceholder?: string;\n\tprompt?: string;\n\ttitle?: string;\n\tvalue?: string;\n\n\tonDidClickButton?(input: InputBox, button: QuickInputButton): boolean | void | Promise<boolean | void>;\n\tonDidPressKey?(quickpick: InputBox, key: Keys): void | Promise<void>;\n\tvalidate?(value: string | undefined): [boolean, string | undefined] | Promise<[boolean, string | undefined]>;\n}\n\nexport function isQuickInputStep(\n\tstep: QuickPickStep | QuickInputStep | typeof StepResult.Break,\n): step is QuickInputStep {\n\treturn typeof step === 'object' && (step as QuickPickStep).items == null && (step as CustomStep).show == null;\n}\n\nexport interface QuickPickStep<T extends QuickPickItem = QuickPickItem> {\n\tadditionalButtons?: QuickInputButton[];\n\tallowEmpty?: boolean;\n\tbuttons?: QuickInputButton[];\n\tignoreFocusOut?: boolean;\n\titems: (DirectiveQuickPickItem | T)[]; // | DirectiveQuickPickItem[];\n\tkeys?: StepNavigationKeys[];\n\tmatchOnDescription?: boolean;\n\tmatchOnDetail?: boolean;\n\tmultiselect?: boolean;\n\tplaceholder?: string;\n\tselectedItems?: QuickPickItem[];\n\ttitle?: string;\n\tvalue?: string;\n\n\tonDidAccept?(quickpick: QuickPick<T>): boolean | Promise<boolean>;\n\tonDidChangeValue?(quickpick: QuickPick<T>): boolean | Promise<boolean>;\n\tonDidClickButton?(quickpick: QuickPick<T>, button: QuickInputButton): boolean | void | Promise<boolean | void>;\n\t/**\n\t * @returns `true` if the current item should be selected\n\t */\n\tonDidClickItemButton?(\n\t\tquickpick: QuickPick<T>,\n\t\tbutton: QuickInputButton,\n\t\titem: T,\n\t): boolean | void | Promise<boolean | void>;\n\tonDidLoadMore?(quickpick: QuickPick<T>): (DirectiveQuickPickItem | T)[] | Promise<(DirectiveQuickPickItem | T)[]>;\n\tonDidPressKey?(quickpick: QuickPick<T>, key: Keys): void | Promise<void>;\n\tonValidateValue?(quickpick: QuickPick<T>, value: string, items: T[]): boolean | Promise<boolean>;\n\tvalidate?(selection: T[]): boolean;\n}\n\nexport function isQuickPickStep(\n\tstep: QuickPickStep | QuickInputStep | CustomStep | typeof StepResult.Break,\n): step is QuickPickStep {\n\treturn typeof step === 'object' && (step as QuickPickStep).items != null;\n}\n\nexport type StepGenerator =\n\t| Generator<QuickPickStep | QuickInputStep | CustomStep, StepResult<void | undefined>, any | undefined>\n\t| AsyncGenerator<QuickPickStep | QuickInputStep | CustomStep, StepResult<void | undefined>, any | undefined>;\n\nexport type StepItemType<T> = T extends CustomStep<infer U>\n\t? U\n\t: T extends QuickPickStep<infer U>\n\t? U[]\n\t: T extends QuickInputStep\n\t? string\n\t: never;\nexport type StepNavigationKeys = Exclude<Keys, 'left' | 'alt+left' | 'ctrl+left'>;\nexport namespace StepResult {\n\texport const Break = Symbol('BreakStep');\n}\nexport type StepResult<T> = typeof StepResult.Break | T;\nexport type StepResultGenerator<T> = Generator<\n\tQuickPickStep | QuickInputStep | CustomStep,\n\tStepResult<T>,\n\tany | undefined\n>;\nexport type AsyncStepResultGenerator<T> = AsyncGenerator<\n\tQuickPickStep | QuickInputStep | CustomStep,\n\tStepResult<T>,\n\tany | undefined\n>;\n// Can't use this union type because of https://github.com/microsoft/TypeScript/issues/41428\n// export type StepResultGenerator<T> =\n// \t| Generator<QuickPickStep | QuickInputStep, StepResult<T>, any | undefined>\n// \t| AsyncGenerator<QuickPickStep | QuickInputStep, StepResult<T>, any | undefined>;\nexport type StepSelection<T> = T extends CustomStep<infer U>\n\t? U | Directive\n\t: T extends QuickPickStep<infer U>\n\t? U[] | Directive\n\t: T extends QuickInputStep\n\t? string | Directive\n\t: never;\nexport type PartialStepState<T = unknown> = Partial<T> & { counter: number; confirm?: boolean; startingStep?: number };\nexport type StepState<T = Record<string, unknown>> = T & { counter: number; confirm?: boolean; startingStep?: number };\n\nexport abstract class QuickCommand<State = any> implements QuickPickItem {\n\treadonly description?: string;\n\treadonly detail?: string;\n\n\tprotected initialState: PartialStepState<State> | undefined;\n\n\tprivate _currentStep: QuickPickStep | QuickInputStep | CustomStep | undefined;\n\tprivate _stepsIterator: StepGenerator | undefined;\n\n\tconstructor(\n\t\tprotected readonly container: Container,\n\t\tpublic readonly key: string,\n\t\tpublic readonly label: string,\n\t\tpublic readonly title: string,\n\t\toptions: {\n\t\t\tdescription?: string;\n\t\t\tdetail?: string;\n\t\t} = {},\n\t) {\n\t\tthis.description = options.description;\n\t\tthis.detail = options.detail;\n\t}\n\n\tget canConfirm(): boolean {\n\t\treturn true;\n\t}\n\n\tget canSkipConfirm(): boolean {\n\t\treturn true;\n\t}\n\n\tprivate _picked: boolean = false;\n\tget picked() {\n\t\treturn this._picked;\n\t}\n\tset picked(value: boolean) {\n\t\tthis._picked = value;\n\t\tif (!value) {\n\t\t\tthis._pickedVia = 'menu';\n\t\t}\n\t}\n\n\tprivate _pickedVia: 'menu' | 'command' = 'menu';\n\tget pickedVia() {\n\t\treturn this._pickedVia;\n\t}\n\tset pickedVia(value: 'menu' | 'command') {\n\t\tthis._pickedVia = value;\n\t}\n\n\tget skipConfirmKey(): string {\n\t\treturn `${this.key}:${this.pickedVia}`;\n\t}\n\n\tget value(): QuickPickStep | QuickInputStep | CustomStep | undefined {\n\t\treturn this._currentStep;\n\t}\n\n\tconfirm(override?: boolean) {\n\t\tif (!this.canConfirm || !this.canSkipConfirm) return true;\n\n\t\treturn override != null\n\t\t\t? override\n\t\t\t: !this.container.config.gitCommands.skipConfirmations.includes(this.skipConfirmKey);\n\t}\n\n\tisMatch(key: string) {\n\t\treturn this.key === key;\n\t}\n\n\tisFuzzyMatch(name: string) {\n\t\treturn this.label === name;\n\t}\n\n\tprotected abstract steps(state: PartialStepState<State>): StepGenerator;\n\n\texecuteSteps() {\n\t\t// When we are chaining steps together, limit backward navigation to feel more natural\n\t\treturn this.steps(this.getStepState(true));\n\t}\n\n\tasync previous(): Promise<QuickPickStep | QuickInputStep | undefined> {\n\t\treturn (await this.next(Directive.Back)).value;\n\t}\n\n\tasync next(\n\t\tvalue?: StepSelection<any>,\n\t): Promise<IteratorResult<QuickPickStep | QuickInputStep | CustomStep | undefined>> {\n\t\tif (this._stepsIterator == null) {\n\t\t\tthis._stepsIterator = this.steps(this.getStepState(false));\n\t\t}\n\n\t\tconst result = await this._stepsIterator.next(value);\n\t\tif (result.done) {\n\t\t\tthis.initialState = undefined;\n\t\t\tthis._stepsIterator = undefined;\n\t\t}\n\n\t\tif (result.value === StepResult.Break) {\n\t\t\tthis._currentStep = undefined;\n\t\t\treturn { ...result, value: undefined };\n\t\t}\n\n\t\tthis._currentStep = result.value as Exclude<typeof result.value, void | typeof StepResult.Break>;\n\t\treturn result;\n\t}\n\n\tasync retry(): Promise<QuickPickStep | QuickInputStep | CustomStep | undefined> {\n\t\tawait this.next(Directive.Noop);\n\t\treturn this.value;\n\t}\n\n\tprotected canStepsContinue(state: PartialStepState) {\n\t\treturn state.counter >= (state.startingStep ?? 0);\n\t}\n\n\tprotected createConfirmStep<T extends QuickPickItem>(\n\t\ttitle: string,\n\t\tconfirmations: T[],\n\t\tcancel?: DirectiveQuickPickItem,\n\t\toptions: Partial<QuickPickStep<T>> = {},\n\t): QuickPickStep<T> {\n\t\treturn QuickCommand.createConfirmStep(title, confirmations, { title: this.title }, cancel, options);\n\t}\n\n\tprotected getStepState(limitBackNavigation: boolean): PartialStepState<State> {\n\t\t// Set the minimum step to be our initial counter, so that the back button will work as expected\n\t\t// eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n\t\treturn {\n\t\t\tcounter: 0,\n\t\t\t...this.initialState,\n\t\t\tstartingStep: limitBackNavigation ? this.initialState?.counter ?? 0 : 0,\n\t\t} as PartialStepState<State>;\n\t}\n}\n\nexport namespace QuickCommand {\n\texport function is(item: QuickPickItem): item is QuickCommand {\n\t\treturn item instanceof QuickCommand;\n\t}\n\n\texport async function canInputStepContinue<T extends QuickInputStep>(\n\t\tstep: T,\n\t\tstate: PartialStepState,\n\t\tvalue: Directive | StepItemType<T>,\n\t) {\n\t\tif (!canStepContinue(step, state, value)) return false;\n\n\t\tconst [valid] = (await step.validate?.(value)) ?? [true];\n\t\tif (valid) {\n\t\t\tstate.counter++;\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\texport function canPickStepContinue<T extends QuickPickStep>(\n\t\tstep: T,\n\t\tstate: PartialStepState,\n\t\tselection: StepItemType<T> | Directive,\n\t): selection is StepItemType<T> {\n\t\tif (!canStepContinue(step, state, selection)) return false;\n\n\t\tif (step.validate?.(selection) ?? true) {\n\t\t\tstate.counter++;\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\texport function canStepContinue<T extends QuickInputStep | QuickPickStep>(\n\t\tstep: T,\n\t\tstate: PartialStepState,\n\t\tresult: Directive | StepItemType<T>,\n\t): result is StepItemType<T> {\n\t\tif (result == null) return false;\n\t\tif (Directive.is(result)) {\n\t\t\tswitch (result) {\n\t\t\t\tcase Directive.Back:\n\t\t\t\t\tstate.counter--;\n\t\t\t\t\tif (state.counter <= (state.startingStep ?? 0)) {\n\t\t\t\t\t\tstate.counter = 0;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase Directive.Cancel:\n\t\t\t\t\tendSteps(state);\n\t\t\t\t\tbreak;\n\t\t\t\t// case Directive.Noop:\n\t\t\t\t// case Directive.RequiresVerification:\n\t\t\t\t// case Directive.RequiresFreeSubscription:\n\t\t\t\t// case Directive.RequiresProSubscription:\n\t\t\t\t// \tbreak;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\texport function createConfirmStep<T extends QuickPickItem, Context extends { title: string }>(\n\t\ttitle: string,\n\t\tconfirmations: T[],\n\t\tcontext: Context,\n\t\tcancel?: DirectiveQuickPickItem,\n\t\toptions: Partial<QuickPickStep<T>> = {},\n\t): QuickPickStep<T> {\n\t\treturn createPickStep<T>({\n\t\t\tplaceholder: `Confirm ${context.title}`,\n\t\t\ttitle: title,\n\t\t\tignoreFocusOut: true,\n\t\t\titems: [...confirmations, cancel ?? DirectiveQuickPickItem.create(Directive.Cancel)],\n\t\t\tselectedItems: [confirmations.find(c => c.picked) ?? confirmations[0]],\n\t\t\t...options,\n\t\t});\n\t}\n\n\texport function createInputStep(step: QuickInputStep): QuickInputStep {\n\t\t// Make sure any input steps won't close on focus loss\n\t\tstep.ignoreFocusOut = true;\n\t\treturn step;\n\t}\n\n\texport function createPickStep<T extends QuickPickItem>(step: QuickPickStep<T>): QuickPickStep<T> {\n\t\treturn step;\n\t}\n\n\texport function createCustomStep<T>(step: CustomStep<T>): CustomStep<T> {\n\t\treturn step;\n\t}\n\n\texport function endSteps(state: PartialStepState) {\n\t\tstate.counter = -1;\n\t}\n}\n","import { TextEditor, Uri } from 'vscode';\n\nabstract class Comparer<T> {\n\tabstract equals(lhs: T, rhs: T): boolean;\n}\n\nclass UriComparer extends Comparer<Uri> {\n\tequals(lhs: Uri | undefined, rhs: Uri | undefined, options: { exact?: boolean } = { exact: false }) {\n\t\tif (lhs === rhs) return true;\n\t\tif (lhs == null || rhs == null) return false;\n\n\t\tif (options.exact) {\n\t\t\treturn lhs.toString() === rhs.toString();\n\t\t}\n\t\treturn lhs.scheme === rhs.scheme && lhs.fsPath === rhs.fsPath;\n\t}\n}\n\nclass TextEditorComparer extends Comparer<TextEditor> {\n\tequals(\n\t\tlhs: TextEditor | undefined,\n\t\trhs: TextEditor | undefined,\n\t\toptions: { usePosition: boolean } = { usePosition: false },\n\t) {\n\t\tif (lhs === rhs) return true;\n\t\tif (lhs == null || rhs == null) return false;\n\n\t\tif (options.usePosition && lhs.viewColumn !== rhs.viewColumn) return false;\n\n\t\treturn lhs.document === rhs.document;\n\t}\n}\n\nconst textEditorComparer = new TextEditorComparer();\nconst uriComparer = new UriComparer();\nexport { textEditorComparer as TextEditorComparer, uriComparer as UriComparer };\n","import { DateTimeFormat } from './system/date';\n\nexport interface Config {\n\tautolinks: AutolinkReference[] | null;\n\tblame: {\n\t\tavatars: boolean;\n\t\tcompact: boolean;\n\t\tdateFormat: DateTimeFormat | string | null;\n\t\tformat: string;\n\t\theatmap: {\n\t\t\tenabled: boolean;\n\t\t\tlocation: 'left' | 'right';\n\t\t};\n\t\thighlight: {\n\t\t\tenabled: boolean;\n\t\t\tlocations: BlameHighlightLocations[];\n\t\t};\n\t\tignoreWhitespace: boolean;\n\t\tseparateLines: boolean;\n\t\ttoggleMode: AnnotationsToggleMode;\n\t};\n\tchanges: {\n\t\tlocations: ChangesLocations[];\n\t\ttoggleMode: AnnotationsToggleMode;\n\t};\n\tcodeLens: CodeLensConfig;\n\tcurrentLine: {\n\t\tdateFormat: string | null;\n\t\tenabled: boolean;\n\t\tformat: string;\n\t\tpullRequests: {\n\t\t\tenabled: boolean;\n\t\t};\n\t\tscrollable: boolean;\n\t};\n\tdebug: boolean;\n\tdefaultDateFormat: DateTimeFormat | string | null;\n\tdefaultDateShortFormat: DateTimeFormat | string | null;\n\tdefaultDateSource: DateSource;\n\tdefaultDateStyle: DateStyle;\n\tdefaultGravatarsStyle: GravatarDefaultStyle;\n\tdefaultTimeFormat: DateTimeFormat | string | null;\n\tdetectNestedRepositories: boolean;\n\texperimental: {\n\t\tvirtualRepositories: {\n\t\t\tenabled: boolean;\n\t\t};\n\t};\n\tfileAnnotations: {\n\t\tcommand: string | null;\n\t};\n\tgitCommands: {\n\t\tcloseOnFocusOut: boolean;\n\t\tsearch: {\n\t\t\tmatchAll: boolean;\n\t\t\tmatchCase: boolean;\n\t\t\tmatchRegex: boolean;\n\t\t\tshowResultsInSideBar: boolean | null;\n\t\t};\n\t\tskipConfirmations: string[];\n\t\tsortBy: GitCommandSorting;\n\t};\n\theatmap: {\n\t\tageThreshold: number;\n\t\tcoldColor: string;\n\t\thotColor: string;\n\t\tlocations: HeatmapLocations[];\n\t\ttoggleMode: AnnotationsToggleMode;\n\t};\n\thovers: {\n\t\tannotations: {\n\t\t\tchanges: boolean;\n\t\t\tdetails: boolean;\n\t\t\tenabled: boolean;\n\t\t\tover: 'line' | 'annotation';\n\t\t};\n\t\tautolinks: {\n\t\t\tenabled: boolean;\n\t\t\tenhanced: boolean;\n\t\t};\n\t\tcurrentLine: {\n\t\t\tchanges: boolean;\n\t\t\tdetails: boolean;\n\t\t\tenabled: boolean;\n\t\t\tover: 'line' | 'annotation';\n\t\t};\n\t\tavatars: boolean;\n\t\tavatarSize: number;\n\t\tchangesDiff: 'line' | 'hunk';\n\t\tdetailsMarkdownFormat: string;\n\t\tenabled: boolean;\n\t\tpullRequests: {\n\t\t\tenabled: boolean;\n\t\t};\n\t};\n\tintegrations: {\n\t\tenabled: boolean;\n\t};\n\tkeymap: KeyMap;\n\tliveshare: {\n\t\tallowGuestAccess: boolean;\n\t};\n\tmenus: boolean | MenuConfig;\n\tmode: {\n\t\tactive: string;\n\t\tstatusBar: {\n\t\t\tenabled: boolean;\n\t\t\talignment: 'left' | 'right';\n\t\t};\n\t};\n\tmodes: Record<string, ModeConfig> | null;\n\toutputLevel: OutputLevel;\n\tpartners: Record<\n\t\tstring,\n\t\t{\n\t\t\tenabled: boolean;\n\t\t\t[key: string]: any;\n\t\t}\n\t> | null;\n\tremotes: RemotesConfig[] | null;\n\tshowWelcomeOnInstall: boolean;\n\tshowWhatsNewAfterUpgrades: boolean;\n\tsortBranchesBy: BranchSorting;\n\tsortContributorsBy: ContributorSorting;\n\tsortTagsBy: TagSorting;\n\tstatusBar: {\n\t\talignment: 'left' | 'right';\n\t\tcommand: StatusBarCommand;\n\t\tdateFormat: DateTimeFormat | string | null;\n\t\tenabled: boolean;\n\t\tformat: string;\n\t\treduceFlicker: boolean;\n\t\tpullRequests: {\n\t\t\tenabled: boolean;\n\t\t};\n\t\ttooltipFormat: string;\n\t};\n\tstrings: {\n\t\tcodeLens: {\n\t\t\tunsavedChanges: {\n\t\t\t\trecentChangeAndAuthors: string;\n\t\t\t\trecentChangeOnly: string;\n\t\t\t\tauthorsOnly: string;\n\t\t\t};\n\t\t};\n\t};\n\tterminalLinks: {\n\t\tenabled: boolean;\n\t};\n\tviews: ViewsConfig;\n\tvisualHistory: {\n\t\tqueryLimit: number;\n\t};\n\tworktrees: {\n\t\tdefaultLocation: string | null;\n\t\tpromptForLocation: boolean;\n\t};\n\tadvanced: AdvancedConfig;\n}\n\nexport const enum AnnotationsToggleMode {\n\tFile = 'file',\n\tWindow = 'window',\n}\n\nexport interface AutolinkReference {\n\tprefix: string;\n\turl: string;\n\ttitle?: string;\n\talphanumeric?: boolean;\n\tignoreCase?: boolean;\n}\n\nexport const enum BlameHighlightLocations {\n\tGutter = 'gutter',\n\tLine = 'line',\n\tOverview = 'overview',\n}\n\nexport const enum BranchSorting {\n\tDateDesc = 'date:desc',\n\tDateAsc = 'date:asc',\n\tNameAsc = 'name:asc',\n\tNameDesc = 'name:desc',\n}\n\nexport const enum ChangesLocations {\n\tGutter = 'gutter',\n\tOverview = 'overview',\n}\n\nexport const enum CodeLensCommand {\n\tCopyRemoteCommitUrl = 'gitlens.copyRemoteCommitUrl',\n\tCopyRemoteFileUrl = 'gitlens.copyRemoteFileUrl',\n\tDiffWithPrevious = 'gitlens.diffWithPrevious',\n\tOpenCommitOnRemote = 'gitlens.openCommitOnRemote',\n\tOpenFileOnRemote = 'gitlens.openFileOnRemote',\n\tRevealCommitInView = 'gitlens.revealCommitInView',\n\tShowCommitsInView = 'gitlens.showCommitsInView',\n\tShowQuickCommitDetails = 'gitlens.showQuickCommitDetails',\n\tShowQuickCommitFileDetails = 'gitlens.showQuickCommitFileDetails',\n\tShowQuickCurrentBranchHistory = 'gitlens.showQuickRepoHistory',\n\tShowQuickFileHistory = 'gitlens.showQuickFileHistory',\n\tToggleFileBlame = 'gitlens.toggleFileBlame',\n\tToggleFileChanges = 'gitlens.toggleFileChanges',\n\tToggleFileChangesOnly = 'gitlens.toggleFileChangesOnly',\n\tToggleFileHeatmap = 'gitlens.toggleFileHeatmap',\n}\n\nexport const enum CodeLensScopes {\n\tDocument = 'document',\n\tContainers = 'containers',\n\tBlocks = 'blocks',\n}\n\nexport const enum ContributorSorting {\n\tCountDesc = 'count:desc',\n\tCountAsc = 'count:asc',\n\tDateDesc = 'date:desc',\n\tDateAsc = 'date:asc',\n\tNameAsc = 'name:asc',\n\tNameDesc = 'name:desc',\n}\n\nexport const enum CustomRemoteType {\n\tAzureDevOps = 'AzureDevOps',\n\tBitbucket = 'Bitbucket',\n\tBitbucketServer = 'BitbucketServer',\n\tCustom = 'Custom',\n\tGerrit = 'Gerrit',\n\tGitea = 'Gitea',\n\tGitHub = 'GitHub',\n\tGitLab = 'GitLab',\n}\n\nexport const enum DateSource {\n\tAuthored = 'authored',\n\tCommitted = 'committed',\n}\n\nexport const enum DateStyle {\n\tAbsolute = 'absolute',\n\tRelative = 'relative',\n}\n\nexport const enum FileAnnotationType {\n\tBlame = 'blame',\n\tChanges = 'changes',\n\tHeatmap = 'heatmap',\n}\n\nexport const enum GitCommandSorting {\n\tName = 'name',\n\tUsage = 'usage',\n}\n\nexport const enum GravatarDefaultStyle {\n\tFaces = 'wavatar',\n\tGeometric = 'identicon',\n\tMonster = 'monsterid',\n\tMysteryPerson = 'mp',\n\tRetro = 'retro',\n\tRobot = 'robohash',\n}\n\nexport const enum HeatmapLocations {\n\tGutter = 'gutter',\n\tOverview = 'overview',\n}\n\nexport const enum KeyMap {\n\tAlternate = 'alternate',\n\tChorded = 'chorded',\n\tNone = 'none',\n}\n\nexport const enum OutputLevel {\n\tSilent = 'silent',\n\tErrors = 'errors',\n\tVerbose = 'verbose',\n\tDebug = 'debug',\n}\n\nexport const enum StatusBarCommand {\n\tCopyRemoteCommitUrl = 'gitlens.copyRemoteCommitUrl',\n\tCopyRemoteFileUrl = 'gitlens.copyRemoteFileUrl',\n\tDiffWithPrevious = 'gitlens.diffWithPrevious',\n\tDiffWithWorking = 'gitlens.diffWithWorking',\n\tOpenCommitOnRemote = 'gitlens.openCommitOnRemote',\n\tOpenFileOnRemote = 'gitlens.openFileOnRemote',\n\tRevealCommitInView = 'gitlens.revealCommitInView',\n\tShowCommitsInView = 'gitlens.showCommitsInView',\n\tShowQuickCommitDetails = 'gitlens.showQuickCommitDetails',\n\tShowQuickCommitFileDetails = 'gitlens.showQuickCommitFileDetails',\n\tShowQuickCurrentBranchHistory = 'gitlens.showQuickRepoHistory',\n\tShowQuickFileHistory = 'gitlens.showQuickFileHistory',\n\tToggleCodeLens = 'gitlens.toggleCodeLens',\n\tToggleFileBlame = 'gitlens.toggleFileBlame',\n\tToggleFileChanges = 'gitlens.toggleFileChanges',\n\tToggleFileChangesOnly = 'gitlens.toggleFileChangesOnly',\n\tToggleFileHeatmap = 'gitlens.toggleFileHeatmap',\n}\n\nexport const enum TagSorting {\n\tDateDesc = 'date:desc',\n\tDateAsc = 'date:asc',\n\tNameAsc = 'name:asc',\n\tNameDesc = 'name:desc',\n}\n\nexport const enum ViewBranchesLayout {\n\tList = 'list',\n\tTree = 'tree',\n}\n\nexport const enum ViewFilesLayout {\n\tAuto = 'auto',\n\tList = 'list',\n\tTree = 'tree',\n}\n\nexport const enum ViewShowBranchComparison {\n\tBranch = 'branch',\n\tWorking = 'working',\n}\n\nexport interface AdvancedConfig {\n\tabbreviatedShaLength: number;\n\tabbreviateShaOnCopy: boolean;\n\tblame: {\n\t\tcustomArguments: string[] | null;\n\t\tdelayAfterEdit: number;\n\t\tsizeThresholdAfterEdit: number;\n\t};\n\tcaching: {\n\t\tenabled: boolean;\n\t};\n\tcommitOrdering: 'date' | 'author-date' | 'topo' | null;\n\texternalDiffTool: string | null;\n\texternalDirectoryDiffTool: string | null;\n\tfileHistoryFollowsRenames: boolean;\n\tfileHistoryShowAllBranches: boolean;\n\tmaxListItems: number;\n\tmaxSearchItems: number;\n\tmessages: {\n\t\tsuppressCommitHasNoPreviousCommitWarning: boolean;\n\t\tsuppressCommitNotFoundWarning: boolean;\n\t\tsuppressCreatePullRequestPrompt: boolean;\n\t\tsuppressDebugLoggingWarning: boolean;\n\t\tsuppressFileNotUnderSourceControlWarning: boolean;\n\t\tsuppressGitDisabledWarning: boolean;\n\t\tsuppressGitMissingWarning: boolean;\n\t\tsuppressGitVersionWarning: boolean;\n\t\tsuppressLineUncommittedWarning: boolean;\n\t\tsuppressNoRepositoryWarning: boolean;\n\t\tsuppressRebaseSwitchToTextWarning: boolean;\n\t};\n\tquickPick: {\n\t\tcloseOnFocusOut: boolean;\n\t};\n\trepositorySearchDepth: number;\n\tsimilarityThreshold: number | null;\n}\n\nexport interface CodeLensConfig {\n\tauthors: {\n\t\tenabled: boolean;\n\t\tcommand: CodeLensCommand | false;\n\t};\n\tdateFormat: DateTimeFormat | string | null;\n\tenabled: boolean;\n\tincludeSingleLineSymbols: boolean;\n\trecentChange: {\n\t\tenabled: boolean;\n\t\tcommand: CodeLensCommand | false;\n\t};\n\tscopes: CodeLensScopes[];\n\tscopesByLanguage: CodeLensLanguageScope[] | null;\n\tsymbolScopes: string[];\n}\n\nexport interface CodeLensLanguageScope {\n\tlanguage: string | undefined;\n\tscopes?: CodeLensScopes[];\n\tsymbolScopes?: string[];\n}\n\nexport interface MenuConfig {\n\teditor:\n\t\t| false\n\t\t| {\n\t\t\t\tblame: boolean;\n\t\t\t\tclipboard: boolean;\n\t\t\t\tcompare: boolean;\n\t\t\t\thistory: boolean;\n\t\t\t\tremote: boolean;\n\t\t  };\n\teditorGroup:\n\t\t| false\n\t\t| {\n\t\t\t\tblame: boolean;\n\t\t\t\tcompare: boolean;\n\t\t  };\n\teditorTab:\n\t\t| false\n\t\t| {\n\t\t\t\tclipboard: boolean;\n\t\t\t\tcompare: boolean;\n\t\t\t\thistory: boolean;\n\t\t\t\tremote: boolean;\n\t\t  };\n\texplorer:\n\t\t| false\n\t\t| {\n\t\t\t\tclipboard: boolean;\n\t\t\t\tcompare: boolean;\n\t\t\t\thistory: boolean;\n\t\t\t\tremote: boolean;\n\t\t  };\n\tscm:\n\t\t| false\n\t\t| {\n\t\t\t\tauthors: boolean;\n\t\t  };\n\tscmGroupInline:\n\t\t| false\n\t\t| {\n\t\t\t\tstash: boolean;\n\t\t  };\n\tscmGroup:\n\t\t| false\n\t\t| {\n\t\t\t\tcompare: boolean;\n\t\t\t\topenClose: boolean;\n\t\t\t\tstash: boolean;\n\t\t  };\n\tscmItem:\n\t\t| false\n\t\t| {\n\t\t\t\tclipboard: boolean;\n\t\t\t\tcompare: boolean;\n\t\t\t\thistory: boolean;\n\t\t\t\tremote: boolean;\n\t\t\t\tstash: boolean;\n\t\t  };\n}\n\nexport interface ModeConfig {\n\tname: string;\n\tstatusBarItemName?: string;\n\tdescription?: string;\n\tannotations?: 'blame' | 'changes' | 'heatmap';\n\tcodeLens?: boolean;\n\tcurrentLine?: boolean;\n\thovers?: boolean;\n\tstatusBar?: boolean;\n}\n\nexport type RemotesConfig =\n\t| {\n\t\t\tdomain: string;\n\t\t\tregex: null;\n\t\t\tname?: string;\n\t\t\tprotocol?: string;\n\t\t\ttype: CustomRemoteType;\n\t\t\turls?: RemotesUrlsConfig;\n\t  }\n\t| {\n\t\t\tdomain: null;\n\t\t\tregex: string;\n\t\t\tname?: string;\n\t\t\tprotocol?: string;\n\t\t\ttype: CustomRemoteType;\n\t\t\turls?: RemotesUrlsConfig;\n\t  };\n\nexport interface RemotesUrlsConfig {\n\trepository: string;\n\tbranches: string;\n\tbranch: string;\n\tcommit: string;\n\tcomparison?: string;\n\tfile: string;\n\tfileInBranch: string;\n\tfileInCommit: string;\n\tfileLine: string;\n\tfileRange: string;\n}\n\nexport interface ViewsCommonConfig {\n\tdefaultItemLimit: number;\n\tformats: {\n\t\tcommits: {\n\t\t\tlabel: string;\n\t\t\tdescription: string;\n\t\t};\n\t\tfiles: {\n\t\t\tlabel: string;\n\t\t\tdescription: string;\n\t\t};\n\t\tstashes: {\n\t\t\tlabel: string;\n\t\t\tdescription: string;\n\t\t};\n\t};\n\tpageItemLimit: number;\n\tshowRelativeDateMarkers: boolean;\n}\n\nexport const viewsCommonConfigKeys: (keyof ViewsCommonConfig)[] = [\n\t'defaultItemLimit',\n\t'formats',\n\t'pageItemLimit',\n\t'showRelativeDateMarkers',\n];\n\ninterface ViewsConfigs {\n\tbranches: BranchesViewConfig;\n\tcommits: CommitsViewConfig;\n\tcontributors: ContributorsViewConfig;\n\tfileHistory: FileHistoryViewConfig;\n\tlineHistory: LineHistoryViewConfig;\n\tremotes: RemotesViewConfig;\n\trepositories: RepositoriesViewConfig;\n\tsearchAndCompare: SearchAndCompareViewConfig;\n\tstashes: StashesViewConfig;\n\ttags: TagsViewConfig;\n\tworktrees: WorktreesViewConfig;\n}\n\nexport type ViewsConfigKeys = keyof ViewsConfigs;\nexport const viewsConfigKeys: ViewsConfigKeys[] = [\n\t'commits',\n\t'repositories',\n\t'fileHistory',\n\t'lineHistory',\n\t'branches',\n\t'remotes',\n\t'stashes',\n\t'tags',\n\t'contributors',\n\t'searchAndCompare',\n\t'worktrees',\n];\n\nexport type ViewsConfig = ViewsCommonConfig & ViewsConfigs;\n\nexport interface BranchesViewConfig {\n\tavatars: boolean;\n\tbranches: {\n\t\tlayout: ViewBranchesLayout;\n\t};\n\tfiles: ViewsFilesConfig;\n\tpullRequests: {\n\t\tenabled: boolean;\n\t\tshowForBranches: boolean;\n\t\tshowForCommits: boolean;\n\t};\n\treveal: boolean;\n\tshowBranchComparison: false | ViewShowBranchComparison.Branch;\n}\n\nexport interface CommitsViewConfig {\n\tavatars: boolean;\n\tbranches: undefined;\n\tfiles: ViewsFilesConfig;\n\tpullRequests: {\n\t\tenabled: boolean;\n\t\tshowForBranches: boolean;\n\t\tshowForCommits: boolean;\n\t};\n\treveal: boolean;\n\tshowBranchComparison: false | ViewShowBranchComparison;\n}\n\nexport interface ContributorsViewConfig {\n\tavatars: boolean;\n\tfiles: ViewsFilesConfig;\n\tpullRequests: {\n\t\tenabled: boolean;\n\t\tshowForCommits: boolean;\n\t};\n\treveal: boolean;\n\tshowAllBranches: boolean;\n\tshowStatistics: boolean;\n}\n\nexport interface FileHistoryViewConfig {\n\tavatars: boolean;\n\tfiles: ViewsFilesConfig;\n}\n\nexport interface LineHistoryViewConfig {\n\tavatars: boolean;\n}\n\nexport interface RemotesViewConfig {\n\tavatars: boolean;\n\tbranches: {\n\t\tlayout: ViewBranchesLayout;\n\t};\n\tfiles: ViewsFilesConfig;\n\tpullRequests: {\n\t\tenabled: boolean;\n\t\tshowForBranches: boolean;\n\t\tshowForCommits: boolean;\n\t};\n\treveal: boolean;\n}\n\nexport interface RepositoriesViewConfig {\n\tautoRefresh: boolean;\n\tautoReveal: boolean;\n\tavatars: boolean;\n\tbranches: {\n\t\tlayout: ViewBranchesLayout;\n\t\tshowBranchComparison: false | ViewShowBranchComparison.Branch;\n\t};\n\tcompact: boolean;\n\tfiles: ViewsFilesConfig;\n\tincludeWorkingTree: boolean;\n\tpullRequests: {\n\t\tenabled: boolean;\n\t\tshowForBranches: boolean;\n\t\tshowForCommits: boolean;\n\t};\n\tshowBranchComparison: false | ViewShowBranchComparison;\n\tshowBranches: boolean;\n\tshowCommits: boolean;\n\tshowContributors: boolean;\n\tshowIncomingActivity: boolean;\n\tshowRemotes: boolean;\n\tshowStashes: boolean;\n\tshowTags: boolean;\n\tshowUpstreamStatus: boolean;\n\tshowWorktrees: boolean;\n}\n\nexport interface SearchAndCompareViewConfig {\n\tavatars: boolean;\n\tfiles: ViewsFilesConfig;\n\tpullRequests: {\n\t\tenabled: boolean;\n\t\tshowForCommits: boolean;\n\t};\n}\n\nexport interface StashesViewConfig {\n\tfiles: ViewsFilesConfig;\n\treveal: boolean;\n}\n\nexport interface TagsViewConfig {\n\tavatars: boolean;\n\tbranches: {\n\t\tlayout: ViewBranchesLayout;\n\t};\n\tfiles: ViewsFilesConfig;\n\treveal: boolean;\n}\n\nexport interface WorktreesViewConfig {\n\tavatars: boolean;\n\tfiles: ViewsFilesConfig;\n\tpullRequests: {\n\t\tenabled: boolean;\n\t\tshowForBranches: boolean;\n\t\tshowForCommits: boolean;\n\t};\n\treveal: boolean;\n\tshowBranchComparison: false | ViewShowBranchComparison.Branch;\n}\n\nexport interface ViewsFilesConfig {\n\tcompact: boolean;\n\tlayout: ViewFilesLayout;\n\tthreshold: number;\n}\n","import baseIsEqual from './_baseIsEqual.js';\n\n/**\n * Performs a deep comparison between two values to determine if they are\n * equivalent.\n *\n * **Note:** This method supports comparing arrays, array buffers, booleans,\n * date objects, error objects, maps, numbers, `Object` objects, regexes,\n * sets, strings, symbols, and typed arrays. `Object` objects are compared\n * by their own, not inherited, enumerable properties. Functions and DOM\n * nodes are compared by strict equality, i.e. `===`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.isEqual(object, other);\n * // => true\n *\n * object === other;\n * // => false\n */\nfunction isEqual(value, other) {\n  return baseIsEqual(value, other);\n}\n\nexport default isEqual;\n","export * from './config';\n\nimport {\n\tConfigurationChangeEvent,\n\tConfigurationScope,\n\tConfigurationTarget,\n\tEvent,\n\tEventEmitter,\n\tExtensionContext,\n\tworkspace,\n} from 'vscode';\nimport type { Config } from './config';\nimport { areEqual } from './system/object';\n\nconst configPrefix = 'gitlens';\n\nexport interface ConfigurationWillChangeEvent {\n\tchange: ConfigurationChangeEvent;\n\ttransform?(e: ConfigurationChangeEvent): ConfigurationChangeEvent;\n}\n\nexport class Configuration {\n\tstatic configure(context: ExtensionContext): void {\n\t\tcontext.subscriptions.push(\n\t\t\tworkspace.onDidChangeConfiguration(configuration.onConfigurationChanged, configuration),\n\t\t);\n\t}\n\n\tprivate _onDidChange = new EventEmitter<ConfigurationChangeEvent>();\n\tget onDidChange(): Event<ConfigurationChangeEvent> {\n\t\treturn this._onDidChange.event;\n\t}\n\n\tprivate _onDidChangeAny = new EventEmitter<ConfigurationChangeEvent>();\n\tget onDidChangeAny(): Event<ConfigurationChangeEvent> {\n\t\treturn this._onDidChangeAny.event;\n\t}\n\n\tprivate _onWillChange = new EventEmitter<ConfigurationWillChangeEvent>();\n\tget onWillChange(): Event<ConfigurationWillChangeEvent> {\n\t\treturn this._onWillChange.event;\n\t}\n\n\tprivate onConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tif (!e.affectsConfiguration(configPrefix)) {\n\t\t\tthis._onDidChangeAny.fire(e);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst evt: ConfigurationWillChangeEvent = {\n\t\t\tchange: e,\n\t\t};\n\t\tthis._onWillChange.fire(evt);\n\n\t\tif (evt.transform !== undefined) {\n\t\t\te = evt.transform(e);\n\t\t}\n\n\t\tthis._onDidChangeAny.fire(e);\n\t\tthis._onDidChange.fire(e);\n\t}\n\n\tget(): Config;\n\tget<T extends ConfigPath>(\n\t\tsection: T,\n\t\tscope?: ConfigurationScope | null,\n\t\tdefaultValue?: ConfigPathValue<T>,\n\t): ConfigPathValue<T>;\n\tget<T extends ConfigPath>(\n\t\tsection?: T,\n\t\tscope?: ConfigurationScope | null,\n\t\tdefaultValue?: ConfigPathValue<T>,\n\t): Config | ConfigPathValue<T> {\n\t\treturn defaultValue === undefined\n\t\t\t? workspace\n\t\t\t\t\t.getConfiguration(section === undefined ? undefined : configPrefix, scope)\n\t\t\t\t\t.get<ConfigPathValue<T>>(section === undefined ? configPrefix : section)!\n\t\t\t: workspace\n\t\t\t\t\t.getConfiguration(section === undefined ? undefined : configPrefix, scope)\n\t\t\t\t\t.get<ConfigPathValue<T>>(section === undefined ? configPrefix : section, defaultValue)!;\n\t}\n\n\tgetAny<T>(section: string, scope?: ConfigurationScope | null): T | undefined;\n\tgetAny<T>(section: string, scope: ConfigurationScope | null | undefined, defaultValue: T): T;\n\tgetAny<T>(section: string, scope?: ConfigurationScope | null, defaultValue?: T): T | undefined {\n\t\treturn defaultValue === undefined\n\t\t\t? workspace.getConfiguration(undefined, scope).get<T>(section)\n\t\t\t: workspace.getConfiguration(undefined, scope).get<T>(section, defaultValue);\n\t}\n\n\tchanged<T extends ConfigPath>(\n\t\te: ConfigurationChangeEvent | undefined,\n\t\tsection: T,\n\t\tscope?: ConfigurationScope | null | undefined,\n\t): boolean {\n\t\treturn e?.affectsConfiguration(`${configPrefix}.${section}`, scope!) ?? true;\n\t}\n\n\tinspect<T extends ConfigPath, V extends ConfigPathValue<T>>(section: T, scope?: ConfigurationScope | null) {\n\t\treturn workspace\n\t\t\t.getConfiguration(section === undefined ? undefined : configPrefix, scope)\n\t\t\t.inspect<V>(section === undefined ? configPrefix : section);\n\t}\n\n\tinspectAny<T>(section: string, scope?: ConfigurationScope | null) {\n\t\treturn workspace.getConfiguration(undefined, scope).inspect<T>(section);\n\t}\n\n\tasync migrate<T extends ConfigPath>(\n\t\tfrom: string,\n\t\tto: T,\n\t\toptions: { fallbackValue?: ConfigPathValue<T>; migrationFn?(value: any): ConfigPathValue<T> },\n\t): Promise<boolean> {\n\t\tconst inspection = configuration.inspect(from as any);\n\t\tif (inspection === undefined) return false;\n\n\t\tlet migrated = false;\n\t\tif (inspection.globalValue !== undefined) {\n\t\t\tawait this.update(\n\t\t\t\tto,\n\t\t\t\toptions.migrationFn != null ? options.migrationFn(inspection.globalValue) : inspection.globalValue,\n\t\t\t\tConfigurationTarget.Global,\n\t\t\t);\n\t\t\tmigrated = true;\n\t\t\t// Can't delete the old setting currently because it errors with `Unable to write to User Settings because <setting name> is not a registered configuration`\n\t\t\t// if (from !== to) {\n\t\t\t//     try {\n\t\t\t//         await this.update(from, undefined, ConfigurationTarget.Global);\n\t\t\t//     }\n\t\t\t//     catch { }\n\t\t\t// }\n\t\t}\n\n\t\tif (inspection.workspaceValue !== undefined) {\n\t\t\tawait this.update(\n\t\t\t\tto,\n\t\t\t\toptions.migrationFn != null\n\t\t\t\t\t? options.migrationFn(inspection.workspaceValue)\n\t\t\t\t\t: inspection.workspaceValue,\n\t\t\t\tConfigurationTarget.Workspace,\n\t\t\t);\n\t\t\tmigrated = true;\n\t\t\t// Can't delete the old setting currently because it errors with `Unable to write to User Settings because <setting name> is not a registered configuration`\n\t\t\t// if (from !== to) {\n\t\t\t//     try {\n\t\t\t//         await this.update(from, undefined, ConfigurationTarget.Workspace);\n\t\t\t//     }\n\t\t\t//     catch { }\n\t\t\t// }\n\t\t}\n\n\t\tif (inspection.workspaceFolderValue !== undefined) {\n\t\t\tawait this.update(\n\t\t\t\tto,\n\t\t\t\toptions.migrationFn != null\n\t\t\t\t\t? options.migrationFn(inspection.workspaceFolderValue)\n\t\t\t\t\t: inspection.workspaceFolderValue,\n\t\t\t\tConfigurationTarget.WorkspaceFolder,\n\t\t\t);\n\t\t\tmigrated = true;\n\t\t\t// Can't delete the old setting currently because it errors with `Unable to write to User Settings because <setting name> is not a registered configuration`\n\t\t\t// if (from !== to) {\n\t\t\t//     try {\n\t\t\t//         await this.update(from, undefined, ConfigurationTarget.WorkspaceFolder);\n\t\t\t//     }\n\t\t\t//     catch { }\n\t\t\t// }\n\t\t}\n\n\t\tif (!migrated && options.fallbackValue !== undefined) {\n\t\t\tawait this.update(to, options.fallbackValue, ConfigurationTarget.Global);\n\t\t\tmigrated = true;\n\t\t}\n\n\t\treturn migrated;\n\t}\n\n\tasync migrateIfMissing<T extends ConfigPath>(\n\t\tfrom: string,\n\t\tto: T,\n\t\toptions: { migrationFn?(value: any): ConfigPathValue<T> },\n\t): Promise<void> {\n\t\tconst fromInspection = configuration.inspect(from as any);\n\t\tif (fromInspection === undefined) return;\n\n\t\tconst toInspection = configuration.inspect(to);\n\t\tif (fromInspection.globalValue !== undefined) {\n\t\t\tif (toInspection === undefined || toInspection.globalValue === undefined) {\n\t\t\t\tawait this.update(\n\t\t\t\t\tto,\n\t\t\t\t\toptions.migrationFn != null\n\t\t\t\t\t\t? options.migrationFn(fromInspection.globalValue)\n\t\t\t\t\t\t: fromInspection.globalValue,\n\t\t\t\t\tConfigurationTarget.Global,\n\t\t\t\t);\n\t\t\t\t// Can't delete the old setting currently because it errors with `Unable to write to User Settings because <setting name> is not a registered configuration`\n\t\t\t\t// if (from !== to) {\n\t\t\t\t//     try {\n\t\t\t\t//         await this.update(from, undefined, ConfigurationTarget.Global);\n\t\t\t\t//     }\n\t\t\t\t//     catch { }\n\t\t\t\t// }\n\t\t\t}\n\t\t}\n\n\t\tif (fromInspection.workspaceValue !== undefined) {\n\t\t\tif (toInspection === undefined || toInspection.workspaceValue === undefined) {\n\t\t\t\tawait this.update(\n\t\t\t\t\tto,\n\t\t\t\t\toptions.migrationFn != null\n\t\t\t\t\t\t? options.migrationFn(fromInspection.workspaceValue)\n\t\t\t\t\t\t: fromInspection.workspaceValue,\n\t\t\t\t\tConfigurationTarget.Workspace,\n\t\t\t\t);\n\t\t\t\t// Can't delete the old setting currently because it errors with `Unable to write to User Settings because <setting name> is not a registered configuration`\n\t\t\t\t// if (from !== to) {\n\t\t\t\t//     try {\n\t\t\t\t//         await this.update(from, undefined, ConfigurationTarget.Workspace);\n\t\t\t\t//     }\n\t\t\t\t//     catch { }\n\t\t\t\t// }\n\t\t\t}\n\t\t}\n\n\t\tif (fromInspection.workspaceFolderValue !== undefined) {\n\t\t\tif (toInspection === undefined || toInspection.workspaceFolderValue === undefined) {\n\t\t\t\tawait this.update(\n\t\t\t\t\tto,\n\t\t\t\t\toptions.migrationFn != null\n\t\t\t\t\t\t? options.migrationFn(fromInspection.workspaceFolderValue)\n\t\t\t\t\t\t: fromInspection.workspaceFolderValue,\n\t\t\t\t\tConfigurationTarget.WorkspaceFolder,\n\t\t\t\t);\n\t\t\t\t// Can't delete the old setting currently because it errors with `Unable to write to User Settings because <setting name> is not a registered configuration`\n\t\t\t\t// if (from !== to) {\n\t\t\t\t//     try {\n\t\t\t\t//         await this.update(from, undefined, ConfigurationTarget.WorkspaceFolder);\n\t\t\t\t//     }\n\t\t\t\t//     catch { }\n\t\t\t\t// }\n\t\t\t}\n\t\t}\n\t}\n\n\tname<T extends ConfigPath>(section: T): string {\n\t\treturn section;\n\t}\n\n\tupdate<T extends ConfigPath>(\n\t\tsection: T,\n\t\tvalue: ConfigPathValue<T> | undefined,\n\t\ttarget: ConfigurationTarget,\n\t): Thenable<void> {\n\t\treturn workspace.getConfiguration(configPrefix).update(section, value, target);\n\t}\n\n\tupdateAny(\n\t\tsection: string,\n\t\tvalue: any,\n\t\ttarget: ConfigurationTarget,\n\t\tscope?: ConfigurationScope | null,\n\t): Thenable<void> {\n\t\treturn workspace\n\t\t\t.getConfiguration(undefined, target === ConfigurationTarget.Global ? undefined : scope!)\n\t\t\t.update(section, value, target);\n\t}\n\n\tupdateEffective<T extends ConfigPath>(section: T, value: ConfigPathValue<T> | undefined): Thenable<void> {\n\t\tconst inspect = configuration.inspect(section)!;\n\t\tif (inspect.workspaceFolderValue !== undefined) {\n\t\t\tif (value === inspect.workspaceFolderValue) return Promise.resolve(undefined);\n\n\t\t\treturn configuration.update(section, value, ConfigurationTarget.WorkspaceFolder);\n\t\t}\n\n\t\tif (inspect.workspaceValue !== undefined) {\n\t\t\tif (value === inspect.workspaceValue) return Promise.resolve(undefined);\n\n\t\t\treturn configuration.update(section, value, ConfigurationTarget.Workspace);\n\t\t}\n\n\t\tif (inspect.globalValue === value || (inspect.globalValue === undefined && value === inspect.defaultValue)) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\treturn configuration.update(\n\t\t\tsection,\n\t\t\tareEqual(value, inspect.defaultValue) ? undefined : value,\n\t\t\tConfigurationTarget.Global,\n\t\t);\n\t}\n}\n\nexport const configuration = new Configuration();\n\ntype SubPath<T, Key extends keyof T> = Key extends string\n\t? T[Key] extends Record<string, any>\n\t\t?\n\t\t\t\t| `${Key}.${SubPath<T[Key], Exclude<keyof T[Key], keyof any[]>> & string}`\n\t\t\t\t| `${Key}.${Exclude<keyof T[Key], keyof any[]> & string}`\n\t\t: never\n\t: never;\n\ntype Path<T> = SubPath<T, keyof T> | keyof T;\n\ntype PathValue<T, P extends Path<T>> = P extends `${infer Key}.${infer Rest}`\n\t? Key extends keyof T\n\t\t? Rest extends Path<T[Key]>\n\t\t\t? PathValue<T[Key], Rest>\n\t\t\t: never\n\t\t: never\n\t: P extends keyof T\n\t? T[P]\n\t: never;\n\ntype ConfigPath = Path<Config>;\ntype ConfigPathValue<P extends ConfigPath> = PathValue<Config, P>;\n","export const quickPickTitleMaxChars = 80;\nexport const ImageMimetypes: Record<string, string> = {\n\t'.png': 'image/png',\n\t'.gif': 'image/gif',\n\t'.jpg': 'image/jpeg',\n\t'.jpeg': 'image/jpeg',\n\t'.jpe': 'image/jpeg',\n\t'.webp': 'image/webp',\n\t'.tif': 'image/tiff',\n\t'.tiff': 'image/tiff',\n\t'.bmp': 'image/bmp',\n};\n\nexport const enum CharCode {\n\t/**\n\t * The `/` character.\n\t */\n\tSlash = 47,\n\t/**\n\t * The `\\` character.\n\t */\n\tBackslash = 92,\n\tA = 65,\n\tZ = 90,\n\ta = 97,\n\tz = 122,\n}\n\nexport const enum Colors {\n\tGutterBackgroundColor = 'gitlens.gutterBackgroundColor',\n\tGutterForegroundColor = 'gitlens.gutterForegroundColor',\n\tGutterUncommittedForegroundColor = 'gitlens.gutterUncommittedForegroundColor',\n\tTrailingLineBackgroundColor = 'gitlens.trailingLineBackgroundColor',\n\tTrailingLineForegroundColor = 'gitlens.trailingLineForegroundColor',\n\tLineHighlightBackgroundColor = 'gitlens.lineHighlightBackgroundColor',\n\tLineHighlightOverviewRulerColor = 'gitlens.lineHighlightOverviewRulerColor',\n\tClosedAutolinkedIssueIconColor = 'gitlens.closedAutolinkedIssueIconColor',\n\tClosedPullRequestIconColor = 'gitlens.closedPullRequestIconColor',\n\tOpenAutolinkedIssueIconColor = 'gitlens.openAutolinkedIssueIconColor',\n\tOpenPullRequestIconColor = 'gitlens.openPullRequestIconColor',\n\tMergedPullRequestIconColor = 'gitlens.mergedPullRequestIconColor',\n\tUnpublishedChangesIconColor = 'gitlens.unpublishedChangesIconColor',\n\tUnpublishedCommitIconColor = 'gitlens.unpublishedCommitIconColor',\n\tUnpulledChangesIconColor = 'gitlens.unpulledChangesIconColor',\n}\n\nexport const enum Commands {\n\tActionPrefix = 'gitlens.action.',\n\n\tAddAuthors = 'gitlens.addAuthors',\n\tBrowseRepoAtRevision = 'gitlens.browseRepoAtRevision',\n\tBrowseRepoAtRevisionInNewWindow = 'gitlens.browseRepoAtRevisionInNewWindow',\n\tBrowseRepoBeforeRevision = 'gitlens.browseRepoBeforeRevision',\n\tBrowseRepoBeforeRevisionInNewWindow = 'gitlens.browseRepoBeforeRevisionInNewWindow',\n\tClearFileAnnotations = 'gitlens.clearFileAnnotations',\n\tCloseUnchangedFiles = 'gitlens.closeUnchangedFiles',\n\tCloseWelcomeView = 'gitlens.closeWelcomeView',\n\tCompareWith = 'gitlens.compareWith',\n\tCompareHeadWith = 'gitlens.compareHeadWith',\n\tCompareWorkingWith = 'gitlens.compareWorkingWith',\n\tComputingFileAnnotations = 'gitlens.computingFileAnnotations',\n\tConnectRemoteProvider = 'gitlens.connectRemoteProvider',\n\tCopyCurrentBranch = 'gitlens.copyCurrentBranch',\n\tCopyMessageToClipboard = 'gitlens.copyMessageToClipboard',\n\tCopyRemoteBranchesUrl = 'gitlens.copyRemoteBranchesUrl',\n\tCopyRemoteBranchUrl = 'gitlens.copyRemoteBranchUrl',\n\tCopyRemoteCommitUrl = 'gitlens.copyRemoteCommitUrl',\n\tCopyRemoteComparisonUrl = 'gitlens.copyRemoteComparisonUrl',\n\tCopyRemoteFileUrl = 'gitlens.copyRemoteFileUrlToClipboard',\n\tCopyRemoteFileUrlWithoutRange = 'gitlens.copyRemoteFileUrlWithoutRange',\n\tCopyRemoteFileUrlFrom = 'gitlens.copyRemoteFileUrlFrom',\n\tCopyRemoteIssueUrl = 'gitlens.copyRemoteIssueUrl',\n\tCopyRemotePullRequestUrl = 'gitlens.copyRemotePullRequestUrl',\n\tCopyRemoteRepositoryUrl = 'gitlens.copyRemoteRepositoryUrl',\n\tCopyShaToClipboard = 'gitlens.copyShaToClipboard',\n\tCreatePullRequestOnRemote = 'gitlens.createPullRequestOnRemote',\n\tDiffDirectory = 'gitlens.diffDirectory',\n\tDiffDirectoryWithHead = 'gitlens.diffDirectoryWithHead',\n\tDiffWith = 'gitlens.diffWith',\n\tDiffWithNext = 'gitlens.diffWithNext',\n\tDiffWithNextInDiffLeft = 'gitlens.diffWithNextInDiffLeft',\n\tDiffWithNextInDiffRight = 'gitlens.diffWithNextInDiffRight',\n\tDiffWithPrevious = 'gitlens.diffWithPrevious',\n\tDiffWithPreviousInDiffLeft = 'gitlens.diffWithPreviousInDiffLeft',\n\tDiffWithPreviousInDiffRight = 'gitlens.diffWithPreviousInDiffRight',\n\tDiffLineWithPrevious = 'gitlens.diffLineWithPrevious',\n\tDiffWithRevision = 'gitlens.diffWithRevision',\n\tDiffWithRevisionFrom = 'gitlens.diffWithRevisionFrom',\n\tDiffWithWorking = 'gitlens.diffWithWorking',\n\tDiffWithWorkingInDiffLeft = 'gitlens.diffWithWorkingInDiffLeft',\n\tDiffWithWorkingInDiffRight = 'gitlens.diffWithWorkingInDiffRight',\n\tDiffLineWithWorking = 'gitlens.diffLineWithWorking',\n\tDisconnectRemoteProvider = 'gitlens.disconnectRemoteProvider',\n\tDisableDebugLogging = 'gitlens.disableDebugLogging',\n\tEnableDebugLogging = 'gitlens.enableDebugLogging',\n\tDisableRebaseEditor = 'gitlens.disableRebaseEditor',\n\tEnableRebaseEditor = 'gitlens.enableRebaseEditor',\n\tExternalDiff = 'gitlens.externalDiff',\n\tExternalDiffAll = 'gitlens.externalDiffAll',\n\tFetchRepositories = 'gitlens.fetchRepositories',\n\tGetStarted = 'gitlens.getStarted',\n\tInviteToLiveShare = 'gitlens.inviteToLiveShare',\n\tOpenBlamePriorToChange = 'gitlens.openBlamePriorToChange',\n\tOpenBranchesOnRemote = 'gitlens.openBranchesOnRemote',\n\tOpenBranchOnRemote = 'gitlens.openBranchOnRemote',\n\tOpenChangedFiles = 'gitlens.openChangedFiles',\n\tOpenCommitOnRemote = 'gitlens.openCommitOnRemote',\n\tOpenComparisonOnRemote = 'gitlens.openComparisonOnRemote',\n\tOpenFileHistory = 'gitlens.openFileHistory',\n\tOpenFileFromRemote = 'gitlens.openFileFromRemote',\n\tOpenFileOnRemote = 'gitlens.openFileOnRemote',\n\tOpenFileOnRemoteFrom = 'gitlens.openFileOnRemoteFrom',\n\tOpenFileAtRevision = 'gitlens.openFileRevision',\n\tOpenFileAtRevisionFrom = 'gitlens.openFileRevisionFrom',\n\tOpenFolderHistory = 'gitlens.openFolderHistory',\n\tOpenOnRemote = 'gitlens.openOnRemote',\n\tOpenIssueOnRemote = 'gitlens.openIssueOnRemote',\n\tOpenPullRequestOnRemote = 'gitlens.openPullRequestOnRemote',\n\tOpenAssociatedPullRequestOnRemote = 'gitlens.openAssociatedPullRequestOnRemote',\n\tOpenRepoOnRemote = 'gitlens.openRepoOnRemote',\n\tOpenRevisionFile = 'gitlens.openRevisionFile',\n\tOpenRevisionFileInDiffLeft = 'gitlens.openRevisionFileInDiffLeft',\n\tOpenRevisionFileInDiffRight = 'gitlens.openRevisionFileInDiffRight',\n\tOpenWalkthrough = 'gitlens.openWalkthrough',\n\tOpenWorkingFile = 'gitlens.openWorkingFile',\n\tOpenWorkingFileInDiffLeft = 'gitlens.openWorkingFileInDiffLeft',\n\tOpenWorkingFileInDiffRight = 'gitlens.openWorkingFileInDiffRight',\n\tPullRepositories = 'gitlens.pullRepositories',\n\tPushRepositories = 'gitlens.pushRepositories',\n\tGitCommands = 'gitlens.gitCommands',\n\tGitCommandsBranch = 'gitlens.gitCommands.branch',\n\tGitCommandsCherryPick = 'gitlens.gitCommands.cherryPick',\n\tGitCommandsMerge = 'gitlens.gitCommands.merge',\n\tGitCommandsRebase = 'gitlens.gitCommands.rebase',\n\tGitCommandsReset = 'gitlens.gitCommands.reset',\n\tGitCommandsRevert = 'gitlens.gitCommands.revert',\n\tGitCommandsSwitch = 'gitlens.gitCommands.switch',\n\tGitCommandsTag = 'gitlens.gitCommands.tag',\n\tGitCommandsWorktree = 'gitlens.gitCommands.worktree',\n\tPremiumLearn = 'gitlens.premium.learn',\n\tPremiumLoginOrSignUp = 'gitlens.premium.loginOrSignUp',\n\tPremiumLogout = 'gitlens.premium.logout',\n\tPremiumManage = 'gitlens.premium.manage',\n\tPremiumPurchase = 'gitlens.premium.purchase',\n\tPremiumResendVerification = 'gitlens.premium.resendVerification',\n\tPremiumShowPlans = 'gitlens.premium.showPlans',\n\tPremiumStartPreviewTrial = 'gitlens.premium.startPreviewTrial',\n\tPremiumValidate = 'gitlens.premium.validate',\n\tQuickOpenFileHistory = 'gitlens.quickOpenFileHistory',\n\tRefreshHover = 'gitlens.refreshHover',\n\tResetAvatarCache = 'gitlens.resetAvatarCache',\n\tResetSuppressedWarnings = 'gitlens.resetSuppressedWarnings',\n\tRevealCommitInView = 'gitlens.revealCommitInView',\n\tSearchCommits = 'gitlens.showCommitSearch',\n\tSearchCommitsInView = 'gitlens.views.searchAndCompare.searchCommits',\n\tSetViewsLayout = 'gitlens.setViewsLayout',\n\tShowBranchesView = 'gitlens.showBranchesView',\n\tShowCommitInView = 'gitlens.showCommitInView',\n\tShowCommitsInView = 'gitlens.showCommitsInView',\n\tShowCommitsView = 'gitlens.showCommitsView',\n\tShowContributorsView = 'gitlens.showContributorsView',\n\tShowHomeView = 'gitlens.showHomeView',\n\tShowFileHistoryView = 'gitlens.showFileHistoryView',\n\tShowLastQuickPick = 'gitlens.showLastQuickPick',\n\tShowLineHistoryView = 'gitlens.showLineHistoryView',\n\tShowQuickBranchHistory = 'gitlens.showQuickBranchHistory',\n\tShowQuickCommit = 'gitlens.showQuickCommitDetails',\n\tShowQuickCommitFile = 'gitlens.showQuickCommitFileDetails',\n\tShowQuickCurrentBranchHistory = 'gitlens.showQuickRepoHistory',\n\tShowQuickFileHistory = 'gitlens.showQuickFileHistory',\n\tShowQuickRepoStatus = 'gitlens.showQuickRepoStatus',\n\tShowQuickCommitRevision = 'gitlens.showQuickRevisionDetails',\n\tShowQuickCommitRevisionInDiffLeft = 'gitlens.showQuickRevisionDetailsInDiffLeft',\n\tShowQuickCommitRevisionInDiffRight = 'gitlens.showQuickRevisionDetailsInDiffRight',\n\tShowQuickStashList = 'gitlens.showQuickStashList',\n\tShowRemotesView = 'gitlens.showRemotesView',\n\tShowRepositoriesView = 'gitlens.showRepositoriesView',\n\tShowSearchAndCompareView = 'gitlens.showSearchAndCompareView',\n\tShowSettingsPage = 'gitlens.showSettingsPage',\n\tShowSettingsPageAndJumpToBranchesView = 'gitlens.showSettingsPage#branches-view',\n\tShowSettingsPageAndJumpToCommitsView = 'gitlens.showSettingsPage#commits-view',\n\tShowSettingsPageAndJumpToContributorsView = 'gitlens.showSettingsPage#contributors-view',\n\tShowSettingsPageAndJumpToFileHistoryView = 'gitlens.showSettingsPage#file-history-view',\n\tShowSettingsPageAndJumpToLineHistoryView = 'gitlens.showSettingsPage#line-history-view',\n\tShowSettingsPageAndJumpToRemotesView = 'gitlens.showSettingsPage#remotes-view',\n\tShowSettingsPageAndJumpToRepositoriesView = 'gitlens.showSettingsPage#repositories-view',\n\tShowSettingsPageAndJumpToSearchAndCompareView = 'gitlens.showSettingsPage#search-compare-view',\n\tShowSettingsPageAndJumpToStashesView = 'gitlens.showSettingsPage#stashes-view',\n\tShowSettingsPageAndJumpToTagsView = 'gitlens.showSettingsPage#tags-view',\n\tShowSettingsPageAndJumpToWorkTreesView = 'gitlens.showSettingsPage#worktrees-view',\n\tShowSettingsPageAndJumpToViews = 'gitlens.showSettingsPage#views',\n\tShowStashesView = 'gitlens.showStashesView',\n\tShowTagsView = 'gitlens.showTagsView',\n\tShowWorktreesView = 'gitlens.showWorktreesView',\n\tRefreshTimelinePage = 'gitlens.refreshTimelinePage',\n\tShowTimelinePage = 'gitlens.showTimelinePage',\n\tShowTimelineView = 'gitlens.showTimelineView',\n\tShowWelcomePage = 'gitlens.showWelcomePage',\n\tStashApply = 'gitlens.stashApply',\n\tStashSave = 'gitlens.stashSave',\n\tStashSaveFiles = 'gitlens.stashSaveFiles',\n\tSwitchMode = 'gitlens.switchMode',\n\tToggleCodeLens = 'gitlens.toggleCodeLens',\n\tToggleFileBlame = 'gitlens.toggleFileBlame',\n\tToggleFileBlameInDiffLeft = 'gitlens.toggleFileBlameInDiffLeft',\n\tToggleFileBlameInDiffRight = 'gitlens.toggleFileBlameInDiffRight',\n\tToggleFileChanges = 'gitlens.toggleFileChanges',\n\tToggleFileChangesOnly = 'gitlens.toggleFileChangesOnly',\n\tToggleFileHeatmap = 'gitlens.toggleFileHeatmap',\n\tToggleFileHeatmapInDiffLeft = 'gitlens.toggleFileHeatmapInDiffLeft',\n\tToggleFileHeatmapInDiffRight = 'gitlens.toggleFileHeatmapInDiffRight',\n\tToggleLineBlame = 'gitlens.toggleLineBlame',\n\tToggleReviewMode = 'gitlens.toggleReviewMode',\n\tToggleZenMode = 'gitlens.toggleZenMode',\n\tViewsCopy = 'gitlens.views.copy',\n\tViewsOpenDirectoryDiff = 'gitlens.views.openDirectoryDiff',\n\tViewsOpenDirectoryDiffWithWorking = 'gitlens.views.openDirectoryDiffWithWorking',\n\n\tDeprecated_DiffHeadWith = 'gitlens.diffHeadWith',\n\tDeprecated_DiffWorkingWith = 'gitlens.diffWorkingWith',\n\tDeprecated_OpenBranchesInRemote = 'gitlens.openBranchesInRemote',\n\tDeprecated_OpenBranchInRemote = 'gitlens.openBranchInRemote',\n\tDeprecated_OpenCommitInRemote = 'gitlens.openCommitInRemote',\n\tDeprecated_OpenFileInRemote = 'gitlens.openFileInRemote',\n\tDeprecated_OpenInRemote = 'gitlens.openInRemote',\n\tDeprecated_OpenRepoInRemote = 'gitlens.openRepoInRemote',\n\tDeprecated_ShowFileHistoryInView = 'gitlens.showFileHistoryInView',\n}\n\nexport const enum ContextKeys {\n\tActionPrefix = 'gitlens:action:',\n\tKeyPrefix = 'gitlens:key:',\n\n\tActiveFileStatus = 'gitlens:activeFileStatus',\n\tAnnotationStatus = 'gitlens:annotationStatus',\n\tDebugging = 'gitlens:debugging',\n\tDisabledToggleCodeLens = 'gitlens:disabledToggleCodeLens',\n\tDisabled = 'gitlens:disabled',\n\tEnabled = 'gitlens:enabled',\n\tHasConnectedRemotes = 'gitlens:hasConnectedRemotes',\n\tHasRemotes = 'gitlens:hasRemotes',\n\tHasRichRemotes = 'gitlens:hasRichRemotes',\n\tHasVirtualFolders = 'gitlens:hasVirtualFolders',\n\tReadonly = 'gitlens:readonly',\n\tTimelinePageFocused = 'gitlens:timelinePage:focused',\n\tUntrusted = 'gitlens:untrusted',\n\tViewsCanCompare = 'gitlens:views:canCompare',\n\tViewsCanCompareFile = 'gitlens:views:canCompare:file',\n\tViewsCommitsMyCommitsOnly = 'gitlens:views:commits:myCommitsOnly',\n\tViewsFileHistoryCanPin = 'gitlens:views:fileHistory:canPin',\n\tViewsFileHistoryCursorFollowing = 'gitlens:views:fileHistory:cursorFollowing',\n\tViewsFileHistoryEditorFollowing = 'gitlens:views:fileHistory:editorFollowing',\n\tViewsLineHistoryEditorFollowing = 'gitlens:views:lineHistory:editorFollowing',\n\tViewsRepositoriesAutoRefresh = 'gitlens:views:repositories:autoRefresh',\n\tViewsSearchAndCompareKeepResults = 'gitlens:views:searchAndCompare:keepResults',\n\tVsls = 'gitlens:vsls',\n\n\tPremium = 'gitlens:premium',\n\tPremiumAllowed = 'gitlens:premium:allowed',\n\tPremiumRequired = 'gitlens:premium:required',\n\tPremiumState = 'gitlens:premium:state',\n}\n\nexport const enum CoreCommands {\n\tCloseActiveEditor = 'workbench.action.closeActiveEditor',\n\tCloseAllEditors = 'workbench.action.closeAllEditors',\n\tCursorMove = 'cursorMove',\n\tDiff = 'vscode.diff',\n\tEditorScroll = 'editorScroll',\n\tEditorShowHover = 'editor.action.showHover',\n\tExecuteDocumentSymbolProvider = 'vscode.executeDocumentSymbolProvider',\n\tExecuteCodeLensProvider = 'vscode.executeCodeLensProvider',\n\tFocusFilesExplorer = 'workbench.files.action.focusFilesExplorer',\n\tInstallExtension = 'workbench.extensions.installExtension',\n\tMoveViews = 'vscode.moveViews',\n\tOpen = 'vscode.open',\n\tOpenFolder = 'vscode.openFolder',\n\tOpenInTerminal = 'openInTerminal',\n\tOpenWalkthrough = 'workbench.action.openWalkthrough',\n\tOpenWith = 'vscode.openWith',\n\tNextEditor = 'workbench.action.nextEditor',\n\tPreviewHtml = 'vscode.previewHtml',\n\tRevealLine = 'revealLine',\n\tRevealInExplorer = 'revealInExplorer',\n\tRevealInFileExplorer = 'revealFileInOS',\n\tSetContext = 'setContext',\n\tShowExplorer = 'workbench.view.explorer',\n\tShowReferences = 'editor.action.showReferences',\n\tShowSCM = 'workbench.view.scm',\n}\n\nexport const enum CoreGitCommands {\n\tPublish = 'git.publish',\n\tPull = 'git.pull',\n\tPullRebase = 'git.pullRebase',\n\tPush = 'git.push',\n\tPushForce = 'git.pushForce',\n\tUndoCommit = 'git.undoCommit',\n}\n\nexport const enum CoreGitConfiguration {\n\tAutoRepositoryDetection = 'git.autoRepositoryDetection',\n\tFetchOnPull = 'git.fetchOnPull',\n\tUseForcePushWithLease = 'git.useForcePushWithLease',\n}\n\nexport const enum GlyphChars {\n\tAngleBracketLeftHeavy = '\\u2770',\n\tAngleBracketRightHeavy = '\\u2771',\n\tArrowBack = '\\u21a9',\n\tArrowDown = '\\u2193',\n\tArrowDownUp = '\\u21F5',\n\tArrowDropRight = '\\u2937',\n\tArrowHeadRight = '\\u27A4',\n\tArrowLeft = '\\u2190',\n\tArrowLeftDouble = '\\u21d0',\n\tArrowLeftRight = '\\u2194',\n\tArrowLeftRightDouble = '\\u21d4',\n\tArrowLeftRightDoubleStrike = '\\u21ce',\n\tArrowLeftRightLong = '\\u27f7',\n\tArrowRight = '\\u2192',\n\tArrowRightDouble = '\\u21d2',\n\tArrowRightHollow = '\\u21e8',\n\tArrowUp = '\\u2191',\n\tArrowUpDown = '\\u21C5',\n\tArrowUpRight = '\\u2197',\n\tArrowsHalfLeftRight = '\\u21cb',\n\tArrowsHalfRightLeft = '\\u21cc',\n\tArrowsLeftRight = '\\u21c6',\n\tArrowsRightLeft = '\\u21c4',\n\tAsterisk = '\\u2217',\n\tCheck = '',\n\tDash = '\\u2014',\n\tDot = '\\u2022',\n\tEllipsis = '\\u2026',\n\tEnDash = '\\u2013',\n\tEnvelope = '\\u2709',\n\tEqualsTriple = '\\u2261',\n\tFlag = '\\u2691',\n\tFlagHollow = '\\u2690',\n\tMiddleEllipsis = '\\u22EF',\n\tMuchLessThan = '\\u226A',\n\tMuchGreaterThan = '\\u226B',\n\tPencil = '\\u270E',\n\tSpace = '\\u00a0',\n\tSpaceThin = '\\u2009',\n\tSpaceThinnest = '\\u200A',\n\tSquareWithBottomShadow = '\\u274F',\n\tSquareWithTopShadow = '\\u2750',\n\tWarning = '\\u26a0',\n\tZeroWidthSpace = '\\u200b',\n}\n\nexport const enum Schemes {\n\tDebugConsole = 'debug',\n\tFile = 'file',\n\tGit = 'git',\n\tGitHub = 'github',\n\tGitLens = 'gitlens',\n\tOutput = 'output',\n\tPRs = 'pr',\n\tVsls = 'vsls',\n\tVslsScc = 'vsls-scc',\n\tVirtual = 'vscode-vfs',\n}\n","export const enum GitErrorHandling {\n\tThrow = 0,\n\tIgnore = 1,\n}\n\nexport interface GitCommandOptions {\n\t// extends RunOptions<BufferEncoding | 'buffer' | string> {\n\tconfigs?: string[];\n\treadonly correlationKey?: string;\n\terrors?: GitErrorHandling;\n\t// Specifies that this command should always be executed locally if possible\n\tlocal?: boolean;\n\n\t// Below options comes from RunOptions<BufferEncoding | 'buffer' | string>\n\tcwd?: string;\n\treadonly env?: Record<string, any>;\n\treadonly encoding?: BufferEncoding | 'buffer' | string;\n\treadonly maxBuffer?: number;\n\treadonly stdin?: string | Buffer;\n\treadonly stdinEncoding?: string;\n}\n","import type { Container } from '../../container';\nimport { debug } from '../../system/decorators/log';\nimport { getLines } from '../../system/string';\nimport {\n\tGitBlame,\n\tGitBlameAuthor,\n\tGitCommit,\n\tGitCommitIdentity,\n\tGitCommitLine,\n\tGitFileChange,\n\tGitFileIndexStatus,\n\tGitRevision,\n\tGitUser,\n} from '../models';\n\ninterface BlameEntry {\n\tsha: string;\n\n\tline: number;\n\toriginalLine: number;\n\tlineCount: number;\n\n\tauthor: string;\n\tauthorDate?: string;\n\tauthorTimeZone?: string;\n\tauthorEmail?: string;\n\n\tcommitter: string;\n\tcommitterDate?: string;\n\tcommitterTimeZone?: string;\n\tcommitterEmail?: string;\n\n\tpreviousSha?: string;\n\tpreviousPath?: string;\n\n\tpath: string;\n\n\tsummary?: string;\n}\n\nexport class GitBlameParser {\n\t@debug({ args: false, singleLine: true })\n\tstatic parse(\n\t\tcontainer: Container,\n\t\tdata: string,\n\t\trepoPath: string,\n\t\tcurrentUser: GitUser | undefined,\n\t): GitBlame | undefined {\n\t\tif (!data) return undefined;\n\n\t\tconst authors = new Map<string, GitBlameAuthor>();\n\t\tconst commits = new Map<string, GitCommit>();\n\t\tconst lines: GitCommitLine[] = [];\n\n\t\tlet entry: BlameEntry | undefined = undefined;\n\t\tlet key: string;\n\t\tlet line: string;\n\t\tlet lineParts: string[];\n\n\t\tfor (line of getLines(data)) {\n\t\t\tlineParts = line.split(' ');\n\t\t\tif (lineParts.length < 2) continue;\n\n\t\t\t[key] = lineParts;\n\t\t\tif (entry == null) {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n\t\t\t\tentry = {\n\t\t\t\t\tsha: key,\n\t\t\t\t\toriginalLine: parseInt(lineParts[1], 10),\n\t\t\t\t\tline: parseInt(lineParts[2], 10),\n\t\t\t\t\tlineCount: parseInt(lineParts[3], 10),\n\t\t\t\t} as BlameEntry;\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (key) {\n\t\t\t\tcase 'author':\n\t\t\t\t\tif (entry.sha === GitRevision.uncommitted) {\n\t\t\t\t\t\tentry.author = 'You';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tentry.author = line.slice(key.length + 1).trim();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'author-mail': {\n\t\t\t\t\tif (entry.sha === GitRevision.uncommitted) {\n\t\t\t\t\t\tentry.authorEmail = currentUser?.email;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tentry.authorEmail = line.slice(key.length + 1).trim();\n\t\t\t\t\tconst start = entry.authorEmail.indexOf('<');\n\t\t\t\t\tif (start >= 0) {\n\t\t\t\t\t\tconst end = entry.authorEmail.indexOf('>', start);\n\t\t\t\t\t\tif (end > start) {\n\t\t\t\t\t\t\tentry.authorEmail = entry.authorEmail.substring(start + 1, end);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tentry.authorEmail = entry.authorEmail.substring(start + 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'author-time':\n\t\t\t\t\tentry.authorDate = lineParts[1];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'author-tz':\n\t\t\t\t\tentry.authorTimeZone = lineParts[1];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'committer':\n\t\t\t\t\tif (GitRevision.isUncommitted(entry.sha)) {\n\t\t\t\t\t\tentry.committer = 'You';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tentry.committer = line.slice(key.length + 1).trim();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'committer-mail': {\n\t\t\t\t\tif (GitRevision.isUncommitted(entry.sha)) {\n\t\t\t\t\t\tentry.committerEmail = currentUser?.email;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tentry.committerEmail = line.slice(key.length + 1).trim();\n\t\t\t\t\tconst start = entry.committerEmail.indexOf('<');\n\t\t\t\t\tif (start >= 0) {\n\t\t\t\t\t\tconst end = entry.committerEmail.indexOf('>', start);\n\t\t\t\t\t\tif (end > start) {\n\t\t\t\t\t\t\tentry.committerEmail = entry.committerEmail.substring(start + 1, end);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tentry.committerEmail = entry.committerEmail.substring(start + 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'committer-time':\n\t\t\t\t\tentry.committerDate = lineParts[1];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'committer-tz':\n\t\t\t\t\tentry.committerTimeZone = lineParts[1];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'summary':\n\t\t\t\t\tentry.summary = line.slice(key.length + 1).trim();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'previous':\n\t\t\t\t\tentry.previousSha = lineParts[1];\n\t\t\t\t\tentry.previousPath = lineParts.slice(2).join(' ');\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'filename':\n\t\t\t\t\t// Don't trim to allow spaces in the filename\n\t\t\t\t\tentry.path = line.slice(key.length + 1);\n\n\t\t\t\t\t// Since the filename marks the end of a commit, parse the entry and clear it for the next\n\t\t\t\t\tGitBlameParser.parseEntry(container, entry, repoPath, commits, authors, lines, currentUser);\n\n\t\t\t\t\tentry = undefined;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tfor (const [, c] of commits) {\n\t\t\tif (!c.author.name) continue;\n\n\t\t\tconst author = authors.get(c.author.name);\n\t\t\tif (author == undefined) return undefined;\n\n\t\t\tauthor.lineCount += c.lines.length;\n\t\t}\n\n\t\tconst sortedAuthors = new Map([...authors.entries()].sort((a, b) => b[1].lineCount - a[1].lineCount));\n\n\t\tconst blame: GitBlame = {\n\t\t\trepoPath: repoPath,\n\t\t\tauthors: sortedAuthors,\n\t\t\tcommits: commits,\n\t\t\tlines: lines,\n\t\t};\n\t\treturn blame;\n\t}\n\n\tprivate static parseEntry(\n\t\tcontainer: Container,\n\t\tentry: BlameEntry,\n\t\trepoPath: string,\n\t\tcommits: Map<string, GitCommit>,\n\t\tauthors: Map<string, GitBlameAuthor>,\n\t\tlines: GitCommitLine[],\n\t\tcurrentUser: { name?: string; email?: string } | undefined,\n\t) {\n\t\tlet commit = commits.get(entry.sha);\n\t\tif (commit == null) {\n\t\t\tif (entry.author != null) {\n\t\t\t\tif (\n\t\t\t\t\tcurrentUser != null &&\n\t\t\t\t\t// Name or e-mail is configured\n\t\t\t\t\t(currentUser.name != null || currentUser.email != null) &&\n\t\t\t\t\t// Match on name if configured\n\t\t\t\t\t(currentUser.name == null || currentUser.name === entry.author) &&\n\t\t\t\t\t// Match on email if configured\n\t\t\t\t\t(currentUser.email == null || currentUser.email === entry.authorEmail)\n\t\t\t\t) {\n\t\t\t\t\tentry.author = 'You';\n\t\t\t\t}\n\n\t\t\t\tlet author = authors.get(entry.author);\n\t\t\t\tif (author == null) {\n\t\t\t\t\tauthor = {\n\t\t\t\t\t\tname: entry.author,\n\t\t\t\t\t\tlineCount: 0,\n\t\t\t\t\t};\n\t\t\t\t\tauthors.set(entry.author, author);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcommit = new GitCommit(\n\t\t\t\tcontainer,\n\t\t\t\trepoPath,\n\t\t\t\tentry.sha,\n\t\t\t\tnew GitCommitIdentity(entry.author, entry.authorEmail, new Date((entry.authorDate as any) * 1000)),\n\t\t\t\tnew GitCommitIdentity(\n\t\t\t\t\tentry.committer,\n\t\t\t\t\tentry.committerEmail,\n\t\t\t\t\tnew Date((entry.committerDate as any) * 1000),\n\t\t\t\t),\n\t\t\t\tentry.summary!,\n\t\t\t\t[],\n\t\t\t\tundefined,\n\t\t\t\tnew GitFileChange(\n\t\t\t\t\trepoPath,\n\t\t\t\t\tentry.path,\n\t\t\t\t\tGitFileIndexStatus.Modified,\n\t\t\t\t\tentry.previousPath && entry.previousPath !== entry.path ? entry.previousPath : undefined,\n\t\t\t\t\tentry.previousSha,\n\t\t\t\t),\n\t\t\t\tundefined,\n\t\t\t\t[],\n\t\t\t);\n\n\t\t\tcommits.set(entry.sha, commit);\n\t\t}\n\n\t\tfor (let i = 0, len = entry.lineCount; i < len; i++) {\n\t\t\tconst line: GitCommitLine = {\n\t\t\t\tsha: entry.sha,\n\t\t\t\tpreviousSha: commit.file!.previousSha,\n\t\t\t\toriginalLine: entry.originalLine + i,\n\t\t\t\tline: entry.line + i,\n\t\t\t};\n\n\t\t\tcommit.lines.push(line);\n\t\t\tlines[line.line - 1] = line;\n\t\t}\n\t}\n}\n","import { debug } from '../../system/decorators/log';\nimport { GitBranch } from '../models/branch';\n\nconst branchWithTrackingRegex =\n\t/^<h>(.+)<n>(.+)<u>(.*)<t>(?:\\[(?:ahead ([0-9]+))?[,\\s]*(?:behind ([0-9]+))?]|\\[(gone)])?<r>(.*)<d>(.*)$/gm;\n\n// Using %x00 codes because some shells seem to try to expand things if not\nconst lb = '%3c'; // `%${'<'.charCodeAt(0).toString(16)}`;\nconst rb = '%3e'; // `%${'>'.charCodeAt(0).toString(16)}`;\n\nexport class GitBranchParser {\n\tstatic defaultFormat = [\n\t\t`${lb}h${rb}%(HEAD)`, // HEAD indicator\n\t\t`${lb}n${rb}%(refname)`, // branch name\n\t\t`${lb}u${rb}%(upstream:short)`, // branch upstream\n\t\t`${lb}t${rb}%(upstream:track)`, // branch upstream tracking state\n\t\t`${lb}r${rb}%(objectname)`, // ref\n\t\t`${lb}d${rb}%(committerdate:iso8601)`, // committer date\n\t].join('');\n\n\t@debug({ args: false, singleLine: true })\n\tstatic parse(data: string, repoPath: string): GitBranch[] {\n\t\tconst branches: GitBranch[] = [];\n\n\t\tif (!data) return branches;\n\n\t\tlet current;\n\t\tlet name;\n\t\tlet upstream;\n\t\tlet ahead;\n\t\tlet behind;\n\t\tlet missing;\n\t\tlet ref;\n\t\tlet date;\n\n\t\tlet remote;\n\n\t\tlet match;\n\t\tdo {\n\t\t\tmatch = branchWithTrackingRegex.exec(data);\n\t\t\tif (match == null) break;\n\n\t\t\t[, current, name, upstream, ahead, behind, missing, ref, date] = match;\n\n\t\t\tif (name.startsWith('refs/remotes/')) {\n\t\t\t\t// Strip off refs/remotes/\n\t\t\t\tname = name.substr(13);\n\t\t\t\tif (name.endsWith('/HEAD')) continue;\n\n\t\t\t\tremote = true;\n\t\t\t} else {\n\t\t\t\t// Strip off refs/heads/\n\t\t\t\tname = name.substr(11);\n\t\t\t\tremote = false;\n\t\t\t}\n\n\t\t\tbranches.push(\n\t\t\t\tnew GitBranch(\n\t\t\t\t\trepoPath,\n\t\t\t\t\tname,\n\t\t\t\t\tremote,\n\t\t\t\t\tcurrent.charCodeAt(0) === 42, // '*',\n\t\t\t\t\tnew Date(date),\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\tref == null || ref.length === 0 ? undefined : ` ${ref}`.substr(1),\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\tupstream == null || upstream.length === 0\n\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t: { name: ` ${upstream}`.substr(1), missing: Boolean(missing) },\n\t\t\t\t\tNumber(ahead) || 0,\n\t\t\t\t\tNumber(behind) || 0,\n\t\t\t\t),\n\t\t\t);\n\t\t} while (true);\n\n\t\treturn branches;\n\t}\n}\n","import { Range } from 'vscode';\nimport type { Container } from '../../container';\nimport { filterMap } from '../../system/array';\nimport { debug } from '../../system/decorators/log';\nimport { normalizePath, relative } from '../../system/path';\nimport { getLines } from '../../system/string';\nimport {\n\tGitCommit,\n\tGitCommitIdentity,\n\tGitCommitLine,\n\tGitFile,\n\tGitFileChange,\n\tGitFileChangeStats,\n\tGitFileIndexStatus,\n\tGitLog,\n\tGitRevision,\n\tGitUser,\n\tisUserMatch,\n} from '../models';\n\nconst diffRegex = /diff --git a\\/(.*) b\\/(.*)/;\nconst diffRangeRegex = /^@@ -(\\d+?),(\\d+?) \\+(\\d+?),(\\d+?) @@/;\n\nexport const fileStatusRegex = /(\\S)\\S*\\t([^\\t\\n]+)(?:\\t(.+))?/;\nconst fileStatusAndSummaryRegex = /^(\\d+?|-)\\s+?(\\d+?|-)\\s+?(.*)(?:\\n\\s(delete|rename|copy|create))?/;\nconst fileStatusAndSummaryRenamedFileRegex = /(.+)\\s=>\\s(.+)/;\nconst fileStatusAndSummaryRenamedFilePathRegex = /(.*?){(.+?)\\s=>\\s(.*?)}(.*)/;\n\nconst logFileSimpleRegex = /^<r> (.*)\\s*(?:(?:diff --git a\\/(.*) b\\/(.*))|(?:(\\S)\\S*\\t([^\\t\\n]+)(?:\\t(.+))?))/gm;\nconst logFileSimpleRenamedRegex = /^<r> (\\S+)\\s*(.*)$/s;\nconst logFileSimpleRenamedFilesRegex = /^(\\S)\\S*\\t([^\\t\\n]+)(?:\\t(.+)?)?$/gm;\n\n// Using %x00 codes because some shells seem to try to expand things if not\nconst lb = '%x3c'; // `%x${'<'.charCodeAt(0).toString(16)}`;\nconst rb = '%x3e'; // `%x${'>'.charCodeAt(0).toString(16)}`;\nconst sl = '%x2f'; // `%x${'/'.charCodeAt(0).toString(16)}`;\nconst sp = '%x20'; // `%x${' '.charCodeAt(0).toString(16)}`;\n\nexport const enum LogType {\n\tLog = 0,\n\tLogFile = 1,\n}\n\ninterface LogEntry {\n\tsha?: string;\n\n\tauthor?: string;\n\tauthorDate?: string;\n\tauthorEmail?: string;\n\n\tcommitter?: string;\n\tcommittedDate?: string;\n\tcommitterEmail?: string;\n\n\tparentShas?: string[];\n\n\t/** @deprecated */\n\tpath?: string;\n\t/** @deprecated */\n\toriginalPath?: string;\n\n\tfile?: GitFile;\n\tfiles?: GitFile[];\n\n\tstatus?: GitFileIndexStatus;\n\tfileStats?: GitFileChangeStats;\n\n\tsummary?: string;\n\n\tline?: GitCommitLine;\n}\n\nexport type Parser<T> = {\n\targuments: string[];\n\tparse: (data: string) => Generator<T>;\n};\n\ntype ParsedEntryFile = { status: string; path: string; originalPath?: string };\ntype ParsedEntryWithFiles<T> = { [K in keyof T]: string } & { files: ParsedEntryFile[] };\ntype ParserWithFiles<T> = {\n\targuments: string[];\n\tparse: (data: string) => Generator<ParsedEntryWithFiles<T>>;\n};\n\nexport class GitLogParser {\n\tstatic readonly shortstatRegex =\n\t\t/(?<files>\\d+) files? changed(?:, (?<additions>\\d+) insertions?\\(\\+\\))?(?:, (?<deletions>\\d+) deletions?\\(-\\))?/;\n\n\tprivate static _defaultParser: ParserWithFiles<{\n\t\tsha: string;\n\t\tauthor: string;\n\t\tauthorEmail: string;\n\t\tauthorDate: string;\n\t\tcommitter: string;\n\t\tcommitterEmail: string;\n\t\tcommitterDate: string;\n\t\tmessage: string;\n\t\tparents: string[];\n\t}>;\n\tstatic get defaultParser() {\n\t\tif (this._defaultParser == null) {\n\t\t\tthis._defaultParser = GitLogParser.createWithFiles({\n\t\t\t\tsha: '%H',\n\t\t\t\tauthor: '%aN',\n\t\t\t\tauthorEmail: '%aE',\n\t\t\t\tauthorDate: '%at',\n\t\t\t\tcommitter: '%cN',\n\t\t\t\tcommitterEmail: '%cE',\n\t\t\t\tcommitterDate: '%ct',\n\t\t\t\tmessage: '%B',\n\t\t\t\tparents: '%P',\n\t\t\t});\n\t\t}\n\t\treturn this._defaultParser;\n\t}\n\n\tstatic defaultFormat = [\n\t\t`${lb}${sl}f${rb}`,\n\t\t`${lb}r${rb}${sp}%H`, // ref\n\t\t`${lb}a${rb}${sp}%aN`, // author\n\t\t`${lb}e${rb}${sp}%aE`, // author email\n\t\t`${lb}d${rb}${sp}%at`, // author date\n\t\t`${lb}n${rb}${sp}%cN`, // committer\n\t\t`${lb}m${rb}${sp}%cE`, // committer email\n\t\t`${lb}c${rb}${sp}%ct`, // committer date\n\t\t`${lb}p${rb}${sp}%P`, // parents\n\t\t`${lb}s${rb}`,\n\t\t'%B', // summary\n\t\t`${lb}${sl}s${rb}`,\n\t\t`${lb}f${rb}`,\n\t].join('%n');\n\n\tstatic simpleRefs = `${lb}r${rb}${sp}%H`;\n\tstatic simpleFormat = `${lb}r${rb}${sp}%H`;\n\n\tstatic shortlog = '%H%x00%aN%x00%aE%x00%at';\n\n\tstatic create<T extends Record<string, unknown>>(\n\t\tfieldMapping: ExtractAll<T, string>,\n\t\toptions?: {\n\t\t\tadditionalArgs?: string[];\n\t\t\tparseEntry?: (fields: IterableIterator<string>, entry: T) => void;\n\t\t\tprefix?: string;\n\t\t\tfieldPrefix?: string;\n\t\t\tfieldSuffix?: string;\n\t\t\tseparator?: string;\n\t\t\tskip?: number;\n\t\t},\n\t): Parser<T> {\n\t\tlet format = options?.prefix ?? '';\n\t\tconst keys: (keyof ExtractAll<T, string>)[] = [];\n\t\tfor (const key in fieldMapping) {\n\t\t\tkeys.push(key);\n\t\t\tformat += `${options?.fieldPrefix ?? ''}${fieldMapping[key]}${\n\t\t\t\toptions?.fieldSuffix ?? (options?.fieldPrefix == null ? '%x00' : '')\n\t\t\t}`;\n\t\t}\n\n\t\tconst args = ['-z', `--format=${format}`];\n\t\tif (options?.additionalArgs != null && options.additionalArgs.length > 0) {\n\t\t\targs.push(...options.additionalArgs);\n\t\t}\n\n\t\tfunction* parse(data: string): Generator<T> {\n\t\t\tlet entry: T = {} as any;\n\t\t\tlet fieldCount = 0;\n\t\t\tlet field;\n\n\t\t\tconst fields = getLines(data, options?.separator ?? '\\0');\n\t\t\tif (options?.skip) {\n\t\t\t\tfor (let i = 0; i < options.skip; i++) {\n\t\t\t\t\tfield = fields.next();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (true) {\n\t\t\t\tfield = fields.next();\n\t\t\t\tif (field.done) break;\n\n\t\t\t\tentry[keys[fieldCount++]] = field.value as T[keyof T];\n\n\t\t\t\tif (fieldCount === keys.length) {\n\t\t\t\t\tfieldCount = 0;\n\t\t\t\t\tfield = fields.next();\n\n\t\t\t\t\toptions?.parseEntry?.(fields, entry);\n\t\t\t\t\tyield entry;\n\n\t\t\t\t\tentry = {} as any;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn { arguments: args, parse: parse };\n\t}\n\n\tstatic createSingle(field: string): Parser<string> {\n\t\tconst format = field;\n\t\tconst args = ['-z', `--format=${format}`];\n\n\t\tfunction* parse(data: string): Generator<string> {\n\t\t\tlet field;\n\n\t\t\tconst fields = getLines(data, '\\0');\n\t\t\twhile (true) {\n\t\t\t\tfield = fields.next();\n\t\t\t\tif (field.done) break;\n\n\t\t\t\tyield field.value;\n\t\t\t}\n\t\t}\n\n\t\treturn { arguments: args, parse: parse };\n\t}\n\n\tstatic createWithFiles<T extends Record<string, string>>(fieldMapping: T): ParserWithFiles<T> {\n\t\tlet format = '%x00%x00';\n\t\tconst keys: (keyof T)[] = [];\n\t\tfor (const key in fieldMapping) {\n\t\t\tkeys.push(key);\n\t\t\tformat += `%x00${fieldMapping[key]}`;\n\t\t}\n\n\t\tconst args = ['-z', `--format=${format}`, '--name-status'];\n\n\t\tfunction* parse(data: string): Generator<ParsedEntryWithFiles<T>> {\n\t\t\tconst records = getLines(data, '\\0\\0\\0\\0');\n\n\t\t\tlet entry: ParsedEntryWithFiles<T>;\n\t\t\tlet files: ParsedEntryFile[];\n\t\t\tlet fields: IterableIterator<string>;\n\n\t\t\tlet first = true;\n\t\t\tfor (let record of records) {\n\t\t\t\tif (first) {\n\t\t\t\t\tfirst = false;\n\t\t\t\t\t// Fix the first record (since it only has 3 nulls)\n\t\t\t\t\trecord = record.slice(3);\n\t\t\t\t}\n\n\t\t\t\tentry = {} as any;\n\t\t\t\tfiles = [];\n\t\t\t\tfields = getLines(record, '\\0');\n\n\t\t\t\tlet fieldCount = 0;\n\t\t\t\tlet field;\n\t\t\t\twhile (true) {\n\t\t\t\t\tfield = fields.next();\n\t\t\t\t\tif (field.done) break;\n\n\t\t\t\t\tif (fieldCount < keys.length) {\n\t\t\t\t\t\tentry[keys[fieldCount++]] = field.value as ParsedEntryWithFiles<T>[keyof T];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst file: ParsedEntryFile = { status: field.value.trim(), path: undefined! };\n\t\t\t\t\t\tfield = fields.next();\n\t\t\t\t\t\tfile.path = field.value;\n\n\t\t\t\t\t\tif (file.status[0] === 'R' || file.status[0] === 'C') {\n\t\t\t\t\t\t\tfield = fields.next();\n\t\t\t\t\t\t\tfile.originalPath = field.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tentry.files = files;\n\t\t\t\tyield entry;\n\t\t\t}\n\t\t}\n\n\t\treturn { arguments: args, parse: parse };\n\t}\n\n\t@debug({ args: false })\n\tstatic parse(\n\t\tcontainer: Container,\n\t\tdata: string,\n\t\ttype: LogType,\n\t\trepoPath: string | undefined,\n\t\tfileName: string | undefined,\n\t\tsha: string | undefined,\n\t\tcurrentUser: GitUser | undefined,\n\t\tlimit: number | undefined,\n\t\treverse: boolean,\n\t\trange: Range | undefined,\n\t): GitLog | undefined {\n\t\tif (!data) return undefined;\n\n\t\tlet relativeFileName: string;\n\n\t\tlet entry: LogEntry = {};\n\t\tlet line: string | undefined = undefined;\n\t\tlet token: number;\n\n\t\tlet i = 0;\n\t\tlet first = true;\n\n\t\tconst lines = getLines(`${data}</f>`);\n\t\t// Skip the first line since it will always be </f>\n\t\tlet next = lines.next();\n\t\tif (next.done) return undefined;\n\n\t\tif (repoPath !== undefined) {\n\t\t\trepoPath = normalizePath(repoPath);\n\t\t}\n\n\t\tconst commits = new Map<string, GitCommit>();\n\t\tlet truncationCount = limit;\n\n\t\tlet match;\n\t\tlet renamedFileName;\n\t\tlet renamedMatch;\n\n\t\tloop: while (true) {\n\t\t\tnext = lines.next();\n\t\t\tif (next.done) break;\n\n\t\t\tline = next.value;\n\n\t\t\t// Since log --reverse doesn't properly honor a max count -- enforce it here\n\t\t\tif (reverse && limit && i >= limit) break;\n\n\t\t\t// <1-char token> data\n\t\t\t// e.g. <r> bd1452a2dc\n\t\t\ttoken = line.charCodeAt(1);\n\n\t\t\tswitch (token) {\n\t\t\t\tcase 114: // 'r': // ref\n\t\t\t\t\tentry = {\n\t\t\t\t\t\tsha: line.substring(4),\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 97: // 'a': // author\n\t\t\t\t\tif (GitRevision.uncommitted === entry.sha) {\n\t\t\t\t\t\tentry.author = 'You';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tentry.author = line.substring(4);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 101: // 'e': // author-mail\n\t\t\t\t\tentry.authorEmail = line.substring(4);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 100: // 'd': // author-date\n\t\t\t\t\tentry.authorDate = line.substring(4);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 110: // 'n': // committer\n\t\t\t\t\tentry.committer = line.substring(4);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 109: // 'm': // committer-mail\n\t\t\t\t\tentry.committedDate = line.substring(4);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 99: // 'c': // committer-date\n\t\t\t\t\tentry.committedDate = line.substring(4);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 112: // 'p': // parents\n\t\t\t\t\tentry.parentShas = line.substring(4).split(' ');\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 115: // 's': // summary\n\t\t\t\t\twhile (true) {\n\t\t\t\t\t\tnext = lines.next();\n\t\t\t\t\t\tif (next.done) break;\n\n\t\t\t\t\t\tline = next.value;\n\t\t\t\t\t\tif (line === '</s>') break;\n\n\t\t\t\t\t\tif (entry.summary === undefined) {\n\t\t\t\t\t\t\tentry.summary = line;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tentry.summary += `\\n${line}`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove the trailing newline\n\t\t\t\t\tif (entry.summary != null && entry.summary.charCodeAt(entry.summary.length - 1) === 10) {\n\t\t\t\t\t\tentry.summary = entry.summary.slice(0, -1);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 102: {\n\t\t\t\t\t// 'f': // files\n\t\t\t\t\t// Skip the blank line git adds before the files\n\t\t\t\t\tnext = lines.next();\n\n\t\t\t\t\tlet hasFiles = true;\n\t\t\t\t\tif (next.done || next.value === '</f>') {\n\t\t\t\t\t\t// If this is a merge commit and there are no files returned, skip the commit and reduce our truncationCount to ensure accurate truncation detection\n\t\t\t\t\t\tif ((entry.parentShas?.length ?? 0) > 1) {\n\t\t\t\t\t\t\tif (truncationCount) {\n\t\t\t\t\t\t\t\ttruncationCount--;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thasFiles = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// eslint-disable-next-line no-unmodified-loop-condition\n\t\t\t\t\twhile (hasFiles) {\n\t\t\t\t\t\tnext = lines.next();\n\t\t\t\t\t\tif (next.done) break;\n\n\t\t\t\t\t\tline = next.value;\n\t\t\t\t\t\tif (line === '</f>') break;\n\n\t\t\t\t\t\tif (line.startsWith('warning:')) continue;\n\n\t\t\t\t\t\tif (type === LogType.Log) {\n\t\t\t\t\t\t\tmatch = fileStatusRegex.exec(line);\n\t\t\t\t\t\t\tif (match != null) {\n\t\t\t\t\t\t\t\tif (entry.files === undefined) {\n\t\t\t\t\t\t\t\t\tentry.files = [];\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\trenamedFileName = match[3];\n\t\t\t\t\t\t\t\tif (renamedFileName !== undefined) {\n\t\t\t\t\t\t\t\t\tentry.files.push({\n\t\t\t\t\t\t\t\t\t\tstatus: match[1] as GitFileIndexStatus,\n\t\t\t\t\t\t\t\t\t\tpath: renamedFileName,\n\t\t\t\t\t\t\t\t\t\toriginalPath: match[2],\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tentry.files.push({\n\t\t\t\t\t\t\t\t\t\tstatus: match[1] as GitFileIndexStatus,\n\t\t\t\t\t\t\t\t\t\tpath: match[2],\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmatch = diffRegex.exec(line);\n\t\t\t\t\t\t\tif (match != null) {\n\t\t\t\t\t\t\t\t[, entry.originalPath, entry.path] = match;\n\t\t\t\t\t\t\t\tif (entry.path === entry.originalPath) {\n\t\t\t\t\t\t\t\t\tentry.originalPath = undefined;\n\t\t\t\t\t\t\t\t\tentry.status = GitFileIndexStatus.Modified;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tentry.status = GitFileIndexStatus.Renamed;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvoid lines.next();\n\t\t\t\t\t\t\t\tvoid lines.next();\n\t\t\t\t\t\t\t\tnext = lines.next();\n\n\t\t\t\t\t\t\t\tmatch = diffRangeRegex.exec(next.value);\n\t\t\t\t\t\t\t\tif (match !== null) {\n\t\t\t\t\t\t\t\t\tentry.line = {\n\t\t\t\t\t\t\t\t\t\tsha: entry.sha!,\n\t\t\t\t\t\t\t\t\t\toriginalLine: parseInt(match[1], 10),\n\t\t\t\t\t\t\t\t\t\t// count: parseInt(match[2], 10),\n\t\t\t\t\t\t\t\t\t\tline: parseInt(match[3], 10),\n\t\t\t\t\t\t\t\t\t\t// count: parseInt(match[4], 10),\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\twhile (true) {\n\t\t\t\t\t\t\t\t\tnext = lines.next();\n\t\t\t\t\t\t\t\t\tif (next.done || next.value === '</f>') break;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnext = lines.next();\n\t\t\t\t\t\t\t\tmatch = fileStatusAndSummaryRegex.exec(`${line}\\n${next.value}`);\n\t\t\t\t\t\t\t\tif (match != null) {\n\t\t\t\t\t\t\t\t\tentry.fileStats = {\n\t\t\t\t\t\t\t\t\t\tadditions: Number(match[1]) || 0,\n\t\t\t\t\t\t\t\t\t\tdeletions: Number(match[2]) || 0,\n\t\t\t\t\t\t\t\t\t\tchanges: 0,\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tswitch (match[4]) {\n\t\t\t\t\t\t\t\t\t\tcase undefined:\n\t\t\t\t\t\t\t\t\t\t\tentry.status = 'M' as GitFileIndexStatus;\n\t\t\t\t\t\t\t\t\t\t\tentry.path = match[3];\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\tcase 'copy':\n\t\t\t\t\t\t\t\t\t\tcase 'rename':\n\t\t\t\t\t\t\t\t\t\t\tentry.status = (match[4] === 'copy' ? 'C' : 'R') as GitFileIndexStatus;\n\n\t\t\t\t\t\t\t\t\t\t\trenamedFileName = match[3];\n\t\t\t\t\t\t\t\t\t\t\trenamedMatch =\n\t\t\t\t\t\t\t\t\t\t\t\tfileStatusAndSummaryRenamedFilePathRegex.exec(renamedFileName);\n\t\t\t\t\t\t\t\t\t\t\tif (renamedMatch != null) {\n\t\t\t\t\t\t\t\t\t\t\t\t// If there is no new path, the path part was removed so ensure we don't end up with //\n\t\t\t\t\t\t\t\t\t\t\t\tentry.path =\n\t\t\t\t\t\t\t\t\t\t\t\t\trenamedMatch[3] === ''\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? `${renamedMatch[1]}${renamedMatch[4]}`.replace('//', '/')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: `${renamedMatch[1]}${renamedMatch[3]}${renamedMatch[4]}`;\n\t\t\t\t\t\t\t\t\t\t\t\tentry.originalPath = `${renamedMatch[1]}${renamedMatch[2]}${renamedMatch[4]}`;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\trenamedMatch =\n\t\t\t\t\t\t\t\t\t\t\t\t\tfileStatusAndSummaryRenamedFileRegex.exec(renamedFileName);\n\t\t\t\t\t\t\t\t\t\t\t\tif (renamedMatch != null) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tentry.path = renamedMatch[2];\n\t\t\t\t\t\t\t\t\t\t\t\t\tentry.originalPath = renamedMatch[1];\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tentry.path = renamedFileName;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\tcase 'create':\n\t\t\t\t\t\t\t\t\t\t\tentry.status = 'A' as GitFileIndexStatus;\n\t\t\t\t\t\t\t\t\t\t\tentry.path = match[3];\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\tcase 'delete':\n\t\t\t\t\t\t\t\t\t\t\tentry.status = 'D' as GitFileIndexStatus;\n\t\t\t\t\t\t\t\t\t\t\tentry.path = match[3];\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\tentry.status = 'M' as GitFileIndexStatus;\n\t\t\t\t\t\t\t\t\t\t\tentry.path = match[3];\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (next.done || next.value === '</f>') break;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (entry.files !== undefined) {\n\t\t\t\t\t\tentry.path = filterMap(entry.files, f => (f.path ? f.path : undefined)).join(', ');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (first && repoPath === undefined && type === LogType.LogFile && fileName !== undefined) {\n\t\t\t\t\t\t// Try to get the repoPath from the most recent commit\n\t\t\t\t\t\trepoPath = normalizePath(\n\t\t\t\t\t\t\tfileName.replace(fileName.startsWith('/') ? `/${entry.path}` : entry.path!, ''),\n\t\t\t\t\t\t);\n\t\t\t\t\t\trelativeFileName = normalizePath(relative(repoPath, fileName));\n\t\t\t\t\t} else {\n\t\t\t\t\t\trelativeFileName = entry.path!;\n\t\t\t\t\t}\n\t\t\t\t\tfirst = false;\n\n\t\t\t\t\tconst commit = commits.get(entry.sha!);\n\t\t\t\t\tif (commit === undefined) {\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tif (limit && i > limit) break loop;\n\t\t\t\t\t} else if (truncationCount) {\n\t\t\t\t\t\t// Since this matches an existing commit it will be skipped, so reduce our truncationCount to ensure accurate truncation detection\n\t\t\t\t\t\ttruncationCount--;\n\t\t\t\t\t}\n\n\t\t\t\t\tGitLogParser.parseEntry(\n\t\t\t\t\t\tcontainer,\n\t\t\t\t\t\tentry,\n\t\t\t\t\t\tcommit,\n\t\t\t\t\t\ttype,\n\t\t\t\t\t\trepoPath,\n\t\t\t\t\t\trelativeFileName,\n\t\t\t\t\t\tcommits,\n\t\t\t\t\t\tcurrentUser,\n\t\t\t\t\t);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst log: GitLog = {\n\t\t\trepoPath: repoPath!,\n\t\t\tcommits: commits,\n\t\t\tsha: sha,\n\t\t\tcount: i,\n\t\t\tlimit: limit,\n\t\t\trange: range,\n\t\t\thasMore: Boolean(truncationCount && i > truncationCount && truncationCount !== 1),\n\t\t};\n\t\treturn log;\n\t}\n\n\tprivate static parseEntry(\n\t\tcontainer: Container,\n\t\tentry: LogEntry,\n\t\tcommit: GitCommit | undefined,\n\t\ttype: LogType,\n\t\trepoPath: string | undefined,\n\t\trelativeFileName: string,\n\t\tcommits: Map<string, GitCommit>,\n\t\tcurrentUser: GitUser | undefined,\n\t): void {\n\t\tif (commit == null) {\n\t\t\tif (entry.author != null) {\n\t\t\t\tif (isUserMatch(currentUser, entry.author, entry.authorEmail)) {\n\t\t\t\t\tentry.author = 'You';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (entry.committer != null) {\n\t\t\t\tif (isUserMatch(currentUser, entry.committer, entry.committerEmail)) {\n\t\t\t\t\tentry.committer = 'You';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst originalFileName = entry.originalPath ?? (relativeFileName !== entry.path ? entry.path : undefined);\n\n\t\t\tconst files: { file?: GitFileChange; files?: GitFileChange[] } = {\n\t\t\t\tfiles: entry.files?.map(f => new GitFileChange(repoPath!, f.path, f.status, f.originalPath)),\n\t\t\t};\n\t\t\tif (type === LogType.LogFile) {\n\t\t\t\tfiles.file = new GitFileChange(\n\t\t\t\t\trepoPath!,\n\t\t\t\t\trelativeFileName,\n\t\t\t\t\tentry.status!,\n\t\t\t\t\toriginalFileName,\n\t\t\t\t\tundefined,\n\t\t\t\t\tentry.fileStats,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tcommit = new GitCommit(\n\t\t\t\tcontainer,\n\t\t\t\trepoPath!,\n\t\t\t\tentry.sha!,\n\t\t\t\tnew GitCommitIdentity(entry.author!, entry.authorEmail, new Date((entry.authorDate! as any) * 1000)),\n\t\t\t\tnew GitCommitIdentity(\n\t\t\t\t\tentry.committer!,\n\t\t\t\t\tentry.committerEmail,\n\t\t\t\t\tnew Date((entry.committedDate! as any) * 1000),\n\t\t\t\t),\n\t\t\t\tentry.summary?.split('\\n', 1)[0] ?? '',\n\t\t\t\tentry.parentShas ?? [],\n\t\t\t\tentry.summary ?? '',\n\t\t\t\tfiles,\n\t\t\t\tundefined,\n\t\t\t\tentry.line != null ? [entry.line] : [],\n\t\t\t);\n\n\t\t\tcommits.set(entry.sha!, commit);\n\t\t}\n\t}\n\n\t@debug({ args: false })\n\tstatic parseSimple(\n\t\tdata: string,\n\t\tskip: number,\n\t\tskipRef?: string,\n\t): [string | undefined, string | undefined, GitFileIndexStatus | undefined] {\n\t\tlet ref;\n\t\tlet diffFile;\n\t\tlet diffRenamed;\n\t\tlet status;\n\t\tlet file;\n\t\tlet renamed;\n\n\t\tlet match;\n\t\tdo {\n\t\t\tmatch = logFileSimpleRegex.exec(data);\n\t\t\tif (match == null) break;\n\n\t\t\tif (match[1] === skipRef) continue;\n\t\t\tif (skip-- > 0) continue;\n\n\t\t\t[, ref, diffFile, diffRenamed, status, file, renamed] = match;\n\n\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\tfile = ` ${diffRenamed || diffFile || renamed || file}`.substr(1);\n\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\tstatus = status == null || status.length === 0 ? undefined : ` ${status}`.substr(1);\n\t\t} while (skip >= 0);\n\n\t\t// Ensure the regex state is reset\n\t\tlogFileSimpleRegex.lastIndex = 0;\n\n\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\treturn [\n\t\t\tref == null || ref.length === 0 ? undefined : ` ${ref}`.substr(1),\n\t\t\tfile,\n\t\t\tstatus as GitFileIndexStatus | undefined,\n\t\t];\n\t}\n\n\t@debug({ args: false })\n\tstatic parseSimpleRenamed(\n\t\tdata: string,\n\t\toriginalFileName: string,\n\t): [string | undefined, string | undefined, GitFileIndexStatus | undefined] {\n\t\tlet match = logFileSimpleRenamedRegex.exec(data);\n\t\tif (match == null) return [undefined, undefined, undefined];\n\n\t\tconst [, ref, files] = match;\n\n\t\tlet status;\n\t\tlet file;\n\t\tlet renamed;\n\n\t\tdo {\n\t\t\tmatch = logFileSimpleRenamedFilesRegex.exec(files);\n\t\t\tif (match == null) break;\n\n\t\t\t[, status, file, renamed] = match;\n\n\t\t\tif (originalFileName !== file) {\n\t\t\t\tstatus = undefined;\n\t\t\t\tfile = undefined;\n\t\t\t\trenamed = undefined;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\tfile = ` ${renamed || file}`.substr(1);\n\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\tstatus = status == null || status.length === 0 ? undefined : ` ${status}`.substr(1);\n\n\t\t\tbreak;\n\t\t} while (true);\n\n\t\t// Ensure the regex state is reset\n\t\tlogFileSimpleRenamedFilesRegex.lastIndex = 0;\n\n\t\treturn [\n\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\tref == null || ref.length === 0 || file == null ? undefined : ` ${ref}`.substr(1),\n\t\t\tfile,\n\t\t\tstatus as GitFileIndexStatus | undefined,\n\t\t];\n\t}\n}\n","import { debug } from '../../system/decorators/log';\nimport { GitReflog, GitReflogRecord } from '../models/reflog';\n\nconst reflogRegex = /^<r>(.+)<d>(.+?)@{(.+)}<s>(\\w*)(.*?)(?::(.*))?$/gm;\n// const reflogRegex = /^<r>(.+)<d>(.+?)@{(.+)}<s>(\\w*)(.*?)(?::(.*))?<n>(.*)$/gm;\nconst reflogHEADRegex = /.*?\\/?HEAD$/;\n\n// Using %x00 codes because some shells seem to try to expand things if not\nconst lb = '%x3c'; // `%x${'<'.charCodeAt(0).toString(16)}`;\nconst rb = '%x3e'; // `%x${'>'.charCodeAt(0).toString(16)}`;\n\nexport class GitReflogParser {\n\tstatic defaultFormat = [\n\t\t`${lb}r${rb}%H`, // ref\n\t\t`${lb}d${rb}%gD`, // reflog selector (with iso8601 timestamp)\n\t\t`${lb}s${rb}%gs`, // reflog subject\n\t\t// `${lb}n${rb}%D` // ref names\n\t].join('');\n\n\t@debug({ args: false })\n\tstatic parse(\n\t\tdata: string,\n\t\trepoPath: string,\n\t\tcommands: string[],\n\t\tlimit: number,\n\t\ttotalLimit: number,\n\t): GitReflog | undefined {\n\t\tif (!data) return undefined;\n\n\t\tconst records: GitReflogRecord[] = [];\n\n\t\tlet sha;\n\t\tlet selector;\n\t\tlet date;\n\t\tlet command;\n\t\tlet commandArgs;\n\t\tlet details;\n\n\t\tlet head;\n\t\tlet headDate;\n\t\tlet headSha;\n\n\t\tlet count = 0;\n\t\tlet total = 0;\n\t\tlet recordDate;\n\t\tlet record: GitReflogRecord | undefined;\n\n\t\tlet match;\n\t\tdo {\n\t\t\tmatch = reflogRegex.exec(data);\n\t\t\tif (match == null) break;\n\n\t\t\t[, sha, selector, date, command, commandArgs, details] = match;\n\n\t\t\ttotal++;\n\n\t\t\tif (record !== undefined) {\n\t\t\t\t// If the next record has the same sha as the previous, use it if it is not pointing to just HEAD and the previous is\n\t\t\t\tif (\n\t\t\t\t\tsha === record.sha &&\n\t\t\t\t\t(date !== recordDate || !reflogHEADRegex.test(record.selector) || reflogHEADRegex.test(selector))\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (sha !== record.sha) {\n\t\t\t\t\tif (\n\t\t\t\t\t\thead != null &&\n\t\t\t\t\t\theadDate === recordDate &&\n\t\t\t\t\t\theadSha == record.sha &&\n\t\t\t\t\t\treflogHEADRegex.test(record.selector)\n\t\t\t\t\t) {\n\t\t\t\t\t\trecord.update(sha, head);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trecord.update(sha);\n\t\t\t\t\t}\n\n\t\t\t\t\trecords.push(record);\n\t\t\t\t\trecord = undefined;\n\t\t\t\t\trecordDate = undefined;\n\n\t\t\t\t\tcount++;\n\t\t\t\t\tif (limit !== 0 && count >= limit) break;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (command === 'HEAD') {\n\t\t\t\thead = selector;\n\t\t\t\theadDate = date;\n\t\t\t\theadSha = sha;\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (commands.includes(command)) {\n\t\t\t\trecord = new GitReflogRecord(\n\t\t\t\t\trepoPath,\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\t` ${sha}`.substr(1),\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\t` ${selector}`.substr(1),\n\t\t\t\t\tnew Date(date),\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\t` ${command}`.substr(1),\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\tcommandArgs == null || commandArgs.length === 0 ? undefined : commandArgs.substr(1),\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\tdetails == null || details.length === 0 ? undefined : details.substr(1),\n\t\t\t\t);\n\t\t\t\trecordDate = date;\n\t\t\t}\n\t\t} while (true);\n\n\t\t// Ensure the regex state is reset\n\t\treflogRegex.lastIndex = 0;\n\n\t\treturn {\n\t\t\trepoPath: repoPath,\n\t\t\trecords: records,\n\t\t\tcount: count,\n\t\t\ttotal: total,\n\t\t\tlimit: limit,\n\t\t\thasMore: (limit !== 0 && count >= limit) || (totalLimit !== 0 && total >= totalLimit),\n\t\t};\n\t}\n}\n","import { debug } from '../../system/decorators/log';\nimport { GitRemote } from '../models';\nimport { GitRemoteType } from '../models/remote';\nimport { RemoteProvider } from '../remotes/provider';\n\nconst emptyStr = '';\n\nconst remoteRegex = /^(.*)\\t(.*)\\s\\((.*)\\)$/gm;\nconst urlRegex =\n\t/^(?:(git:\\/\\/)(.*?)\\/|(https?:\\/\\/)(?:.*?@)?(.*?)\\/|git@(.*):|(ssh:\\/\\/)(?:.*@)?(.*?)(?::.*?)?(?:\\/|(?=~))|(?:.*?@)(.*?):)(.*)$/;\n\n// Test git urls\n/*\nhttp://host.xz/user/project.git\nhttp://host.xz/path/to/repo.git\nhttp://host.xz/path/to/repo.git/\nhttp://username@host.xz/user/project.git\nhttp://username:password@host.xz/user/project.git\nhttps://host.xz/user/project.git\nhttps://host.xz/path/to/repo.git\nhttps://host.xz/path/to/repo.git/\nhttps://username@host.xz/user/project.git\nhttps://username:password@host.xz/user/project.git\n\ngit@host.xz:user/project.git\ngit://host.xz/path/to/repo.git/\ngit://host.xz/~user/path/to/repo.git/\n\nssh://host.xz/project.git\nssh://host.xz/path/to/repo.git\nssh://host.xz/path/to/repo.git/\nssh://host.xz:~project.git\nssh://host.xz:port/path/to/repo.git/\nssh://user@host.xz/project.git\nssh://user@host.xz/path/to/repo.git\nssh://user@host.xz/path/to/repo.git/\nssh://user@host.xz:port/path/to/repo.git/\nssh://user:password@host.xz/project.git\nssh://user:password@host.xz/path/to/repo.git\nssh://user:password@host.xz/path/to/repo.git/\n\nuser@host.xz:project.git\nuser@host.xz:path/to/repo.git\nuser@host.xz:/path/to/repo.git/\nuser:password@host.xz:project.git\nuser:password@host.xz:/path/to/repo.git\nuser:password@host.xz:/path/to/repo.git/\n*/\n\nexport class GitRemoteParser {\n\t@debug({ args: false, singleLine: true })\n\tstatic parse(\n\t\tdata: string,\n\t\trepoPath: string,\n\t\tproviderFactory: (url: string, domain: string, path: string) => RemoteProvider | undefined,\n\t): GitRemote[] | undefined {\n\t\tif (!data) return undefined;\n\n\t\tconst remotes: GitRemote[] = [];\n\t\tconst groups = Object.create(null) as Record<string, GitRemote | undefined>;\n\n\t\tlet name;\n\t\tlet url;\n\t\tlet type;\n\n\t\tlet scheme;\n\t\tlet domain;\n\t\tlet path;\n\n\t\tlet uniqueness;\n\t\tlet remote: GitRemote | undefined;\n\n\t\tlet match;\n\t\tdo {\n\t\t\tmatch = remoteRegex.exec(data);\n\t\t\tif (match == null) break;\n\n\t\t\t[, name, url, type] = match;\n\n\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\turl = ` ${url}`.substr(1);\n\n\t\t\t[scheme, domain, path] = this.parseGitUrl(url);\n\n\t\t\tuniqueness = `${domain ? `${domain}/` : ''}${path}`;\n\t\t\tremote = groups[uniqueness];\n\t\t\tif (remote === undefined) {\n\t\t\t\tconst provider = providerFactory(url, domain, path);\n\n\t\t\t\tremote = new GitRemote(\n\t\t\t\t\trepoPath,\n\t\t\t\t\tuniqueness,\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\t` ${name}`.substr(1),\n\t\t\t\t\tscheme,\n\t\t\t\t\tprovider !== undefined ? provider.domain : domain,\n\t\t\t\t\tprovider !== undefined ? provider.path : path,\n\t\t\t\t\tprovider,\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\t[{ url: url, type: ` ${type}`.substr(1) as GitRemoteType }],\n\t\t\t\t);\n\t\t\t\tremotes.push(remote);\n\t\t\t\tgroups[uniqueness] = remote;\n\t\t\t} else {\n\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\tremote.urls.push({ url: url, type: ` ${type}`.substr(1) as GitRemoteType });\n\t\t\t}\n\t\t} while (true);\n\n\t\treturn remotes;\n\t}\n\n\tstatic parseGitUrl(url: string): [string, string, string] {\n\t\tconst match = urlRegex.exec(url);\n\t\tif (match == null) return [emptyStr, emptyStr, url];\n\n\t\treturn [\n\t\t\tmatch[1] || match[3] || match[6],\n\t\t\tmatch[2] || match[4] || match[5] || match[7] || match[8],\n\t\t\tmatch[9].replace(/\\.git\\/?$/, emptyStr),\n\t\t];\n\t}\n}\n","import type { Container } from '../../container';\nimport { filterMap } from '../../system/array';\nimport { debug } from '../../system/decorators/log';\nimport { normalizePath } from '../../system/path';\nimport { getLines } from '../../system/string';\nimport {\n\tGitCommit,\n\tGitCommitIdentity,\n\tGitFile,\n\tGitFileChange,\n\tGitFileIndexStatus,\n\tGitStash,\n\tGitStashCommit,\n} from '../models';\nimport { fileStatusRegex } from './logParser';\n// import { Logger } from './logger';\n\n// Using %x00 codes because some shells seem to try to expand things if not\nconst lb = '%x3c'; // `%x${'<'.charCodeAt(0).toString(16)}`;\nconst rb = '%x3e'; // `%x${'>'.charCodeAt(0).toString(16)}`;\nconst sl = '%x2f'; // `%x${'/'.charCodeAt(0).toString(16)}`;\nconst sp = '%x20'; // `%x${' '.charCodeAt(0).toString(16)}`;\n\ninterface StashEntry {\n\tref?: string;\n\tdate?: string;\n\tcommittedDate?: string;\n\tfileNames?: string;\n\tfiles?: GitFile[];\n\tsummary?: string;\n\tstashName?: string;\n}\n\nexport class GitStashParser {\n\tstatic defaultFormat = [\n\t\t`${lb}${sl}f${rb}`,\n\t\t`${lb}r${rb}${sp}%H`, // ref\n\t\t`${lb}d${rb}${sp}%at`, // date\n\t\t`${lb}c${rb}${sp}%ct`, // committed date\n\t\t`${lb}l${rb}${sp}%gd`, // reflog-selector\n\t\t`${lb}s${rb}`,\n\t\t'%B', // summary\n\t\t`${lb}${sl}s${rb}`,\n\t\t`${lb}f${rb}`,\n\t].join('%n');\n\n\t@debug({ args: false, singleLine: true })\n\tstatic parse(container: Container, data: string, repoPath: string): GitStash | undefined {\n\t\tif (!data) return undefined;\n\n\t\tconst lines = getLines(`${data}</f>`);\n\t\t// Skip the first line since it will always be </f>\n\t\tlet next = lines.next();\n\t\tif (next.done) return undefined;\n\n\t\tif (repoPath !== undefined) {\n\t\t\trepoPath = normalizePath(repoPath);\n\t\t}\n\n\t\tconst commits = new Map<string, GitStashCommit>();\n\n\t\tlet entry: StashEntry = {};\n\t\tlet line: string | undefined = undefined;\n\t\tlet token: number;\n\n\t\tlet match;\n\t\tlet renamedFileName;\n\n\t\twhile (true) {\n\t\t\tnext = lines.next();\n\t\t\tif (next.done) break;\n\n\t\t\tline = next.value;\n\n\t\t\t// <<1-char token>> <data>\n\t\t\t// e.g. <r> bd1452a2dc\n\t\t\ttoken = line.charCodeAt(1);\n\n\t\t\tswitch (token) {\n\t\t\t\tcase 114: // 'r': // ref\n\t\t\t\t\tentry = {\n\t\t\t\t\t\tref: line.substring(4),\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 100: // 'd': // author-date\n\t\t\t\t\tentry.date = line.substring(4);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 99: // 'c': // committer-date\n\t\t\t\t\tentry.committedDate = line.substring(4);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 108: // 'l': // reflog-selector\n\t\t\t\t\tentry.stashName = line.substring(4);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 115: // 's': // summary\n\t\t\t\t\twhile (true) {\n\t\t\t\t\t\tnext = lines.next();\n\t\t\t\t\t\tif (next.done) break;\n\n\t\t\t\t\t\tline = next.value;\n\t\t\t\t\t\tif (line === '</s>') break;\n\n\t\t\t\t\t\tif (entry.summary === undefined) {\n\t\t\t\t\t\t\tentry.summary = line;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tentry.summary += `\\n${line}`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove the trailing newline\n\t\t\t\t\tif (entry.summary != null && entry.summary.charCodeAt(entry.summary.length - 1) === 10) {\n\t\t\t\t\t\tentry.summary = entry.summary.slice(0, -1);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 102: // 'f': // files\n\t\t\t\t\t// Skip the blank line git adds before the files\n\t\t\t\t\tnext = lines.next();\n\t\t\t\t\tif (!next.done && next.value !== '</f>') {\n\t\t\t\t\t\twhile (true) {\n\t\t\t\t\t\t\tnext = lines.next();\n\t\t\t\t\t\t\tif (next.done) break;\n\n\t\t\t\t\t\t\tline = next.value;\n\t\t\t\t\t\t\tif (line === '</f>') break;\n\n\t\t\t\t\t\t\tif (line.startsWith('warning:')) continue;\n\n\t\t\t\t\t\t\tmatch = fileStatusRegex.exec(line);\n\t\t\t\t\t\t\tif (match != null) {\n\t\t\t\t\t\t\t\tif (entry.files === undefined) {\n\t\t\t\t\t\t\t\t\tentry.files = [];\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\trenamedFileName = match[3];\n\t\t\t\t\t\t\t\tif (renamedFileName !== undefined) {\n\t\t\t\t\t\t\t\t\tentry.files.push({\n\t\t\t\t\t\t\t\t\t\tstatus: match[1] as GitFileIndexStatus,\n\t\t\t\t\t\t\t\t\t\tpath: renamedFileName,\n\t\t\t\t\t\t\t\t\t\toriginalPath: match[2],\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tentry.files.push({\n\t\t\t\t\t\t\t\t\t\tstatus: match[1] as GitFileIndexStatus,\n\t\t\t\t\t\t\t\t\t\tpath: match[2],\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (entry.files != null) {\n\t\t\t\t\t\t\tentry.fileNames = filterMap(entry.files, f => (f.path ? f.path : undefined)).join(', ');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tGitStashParser.parseEntry(container, entry, repoPath, commits);\n\t\t\t\t\tentry = {};\n\t\t\t}\n\t\t}\n\n\t\tconst stash: GitStash = {\n\t\t\trepoPath: repoPath,\n\t\t\tcommits: commits,\n\t\t};\n\t\treturn stash;\n\t}\n\n\tprivate static parseEntry(\n\t\tcontainer: Container,\n\t\tentry: StashEntry,\n\t\trepoPath: string,\n\t\tcommits: Map<string, GitStashCommit>,\n\t) {\n\t\tlet commit = commits.get(entry.ref!);\n\t\tif (commit == null) {\n\t\t\tcommit = new GitCommit(\n\t\t\t\tcontainer,\n\t\t\t\trepoPath,\n\t\t\t\tentry.ref!,\n\t\t\t\tnew GitCommitIdentity('You', undefined, new Date((entry.date! as any) * 1000)),\n\t\t\t\tnew GitCommitIdentity('You', undefined, new Date((entry.committedDate! as any) * 1000)),\n\t\t\t\tentry.summary?.split('\\n', 1)[0] ?? '',\n\t\t\t\t[],\n\t\t\t\tentry.summary ?? '',\n\t\t\t\tentry.files?.map(f => new GitFileChange(repoPath, f.path, f.status, f.originalPath)) ?? [],\n\t\t\t\tundefined,\n\t\t\t\t[],\n\t\t\t\tentry.stashName,\n\t\t\t) as GitStashCommit;\n\t\t}\n\n\t\tcommits.set(entry.ref!, commit);\n\t}\n}\n","import { debug } from '../../system/decorators/log';\nimport { normalizePath } from '../../system/path';\nimport { GitStatus, GitStatusFile } from '../models';\n\nconst emptyStr = '';\n\nconst aheadStatusV1Regex = /(?:ahead ([0-9]+))/;\nconst behindStatusV1Regex = /(?:behind ([0-9]+))/;\n\nexport class GitStatusParser {\n\t@debug({ args: false, singleLine: true })\n\tstatic parse(data: string, repoPath: string, porcelainVersion: number): GitStatus | undefined {\n\t\tif (!data) return undefined;\n\n\t\tconst lines = data.split('\\n').filter(<T>(i?: T): i is T => Boolean(i));\n\t\tif (lines.length === 0) return undefined;\n\n\t\tif (porcelainVersion < 2) return this.parseV1(lines, repoPath);\n\n\t\treturn this.parseV2(lines, repoPath);\n\t}\n\n\t@debug({ args: false, singleLine: true })\n\tprivate static parseV1(lines: string[], repoPath: string): GitStatus {\n\t\tlet branch: string | undefined;\n\t\tconst files = [];\n\t\tconst state = {\n\t\t\tahead: 0,\n\t\t\tbehind: 0,\n\t\t};\n\t\tlet upstream;\n\n\t\tlet position = -1;\n\t\twhile (++position < lines.length) {\n\t\t\tconst line = lines[position];\n\t\t\t// Header\n\t\t\tif (line.startsWith('##')) {\n\t\t\t\tconst lineParts = line.split(' ');\n\t\t\t\t[branch, upstream] = lineParts[1].split('...');\n\t\t\t\tif (lineParts.length > 2) {\n\t\t\t\t\tconst upstreamStatus = lineParts.slice(2).join(' ');\n\n\t\t\t\t\tconst aheadStatus = aheadStatusV1Regex.exec(upstreamStatus);\n\t\t\t\t\tstate.ahead = aheadStatus == null ? 0 : Number(aheadStatus[1]) || 0;\n\n\t\t\t\t\tconst behindStatus = behindStatusV1Regex.exec(upstreamStatus);\n\t\t\t\t\tstate.behind = behindStatus == null ? 0 : Number(behindStatus[1]) || 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst rawStatus = line.substring(0, 2);\n\t\t\t\tconst fileName = line.substring(3);\n\t\t\t\tif (rawStatus.startsWith('R') || rawStatus.startsWith('C')) {\n\t\t\t\t\tconst [file1, file2] = fileName.replace(/\"/g, emptyStr).split('->');\n\t\t\t\t\tfiles.push(this.parseStatusFile(repoPath, rawStatus, file2.trim(), file1.trim()));\n\t\t\t\t} else {\n\t\t\t\t\tfiles.push(this.parseStatusFile(repoPath, rawStatus, fileName));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn new GitStatus(normalizePath(repoPath), branch ?? emptyStr, emptyStr, files, state, upstream);\n\t}\n\n\t@debug({ args: false, singleLine: true })\n\tprivate static parseV2(lines: string[], repoPath: string): GitStatus {\n\t\tlet branch: string | undefined;\n\t\tconst files = [];\n\t\tlet sha: string | undefined;\n\t\tconst state = {\n\t\t\tahead: 0,\n\t\t\tbehind: 0,\n\t\t};\n\t\tlet upstream;\n\n\t\tlet position = -1;\n\t\twhile (++position < lines.length) {\n\t\t\tconst line = lines[position];\n\t\t\t// Headers\n\t\t\tif (line.startsWith('#')) {\n\t\t\t\tconst lineParts = line.split(' ');\n\t\t\t\tswitch (lineParts[1]) {\n\t\t\t\t\tcase 'branch.oid':\n\t\t\t\t\t\tsha = lineParts[2];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'branch.head':\n\t\t\t\t\t\tbranch = lineParts[2];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'branch.upstream':\n\t\t\t\t\t\tupstream = lineParts[2];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'branch.ab':\n\t\t\t\t\t\tstate.ahead = Number(lineParts[2].substring(1));\n\t\t\t\t\t\tstate.behind = Number(lineParts[3].substring(1));\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst lineParts = line.split(' ');\n\t\t\t\tswitch (lineParts[0][0]) {\n\t\t\t\t\tcase '1': // normal\n\t\t\t\t\t\tfiles.push(this.parseStatusFile(repoPath, lineParts[1], lineParts.slice(8).join(' ')));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase '2': {\n\t\t\t\t\t\t// rename\n\t\t\t\t\t\tconst file = lineParts.slice(9).join(' ').split('\\t');\n\t\t\t\t\t\tfiles.push(this.parseStatusFile(repoPath, lineParts[1], file[0], file[1]));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase 'u': // unmerged\n\t\t\t\t\t\tfiles.push(this.parseStatusFile(repoPath, lineParts[1], lineParts.slice(10).join(' ')));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase '?': // untracked\n\t\t\t\t\t\tfiles.push(this.parseStatusFile(repoPath, '??', lineParts.slice(1).join(' ')));\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn new GitStatus(normalizePath(repoPath), branch ?? emptyStr, sha ?? emptyStr, files, state, upstream);\n\t}\n\n\tstatic parseStatusFile(\n\t\trepoPath: string,\n\t\trawStatus: string,\n\t\tfileName: string,\n\t\toriginalFileName?: string,\n\t): GitStatusFile {\n\t\tlet x = !rawStatus.startsWith('.') ? rawStatus[0].trim() : undefined;\n\t\tif (x == null || x.length === 0) {\n\t\t\tx = undefined;\n\t\t}\n\n\t\tlet y = undefined;\n\t\tif (rawStatus.length > 1) {\n\t\t\ty = rawStatus[1] !== '.' ? rawStatus[1].trim() : undefined;\n\t\t\tif (y == null || y.length === 0) {\n\t\t\t\ty = undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn new GitStatusFile(repoPath, x, y, fileName, originalFileName);\n\t}\n}\n","import { debug } from '../../system/decorators/log';\nimport { GitTag } from '../models';\n\nconst tagRegex = /^<n>(.+)<\\*r>(.*)<r>(.*)<d>(.*)<ad>(.*)<s>(.*)$/gm;\n\n// Using %x00 codes because some shells seem to try to expand things if not\nconst lb = '%3c'; // `%${'<'.charCodeAt(0).toString(16)}`;\nconst rb = '%3e'; // `%${'>'.charCodeAt(0).toString(16)}`;\n\nexport class GitTagParser {\n\tstatic defaultFormat = [\n\t\t`${lb}n${rb}%(refname)`, // tag name\n\t\t`${lb}*r${rb}%(*objectname)`, // ref\n\t\t`${lb}r${rb}%(objectname)`, // ref\n\t\t`${lb}d${rb}%(creatordate:iso8601)`, // created date\n\t\t`${lb}ad${rb}%(authordate:iso8601)`, // author date\n\t\t`${lb}s${rb}%(subject)`, // message\n\t].join('');\n\n\t@debug({ args: false, singleLine: true })\n\tstatic parse(data: string, repoPath: string): GitTag[] | undefined {\n\t\tif (!data) return undefined;\n\n\t\tconst tags: GitTag[] = [];\n\n\t\tlet name;\n\t\tlet ref1;\n\t\tlet ref2;\n\t\tlet date;\n\t\tlet commitDate;\n\t\tlet message;\n\n\t\tlet match;\n\t\tdo {\n\t\t\tmatch = tagRegex.exec(data);\n\t\t\tif (match == null) break;\n\n\t\t\t[, name, ref1, ref2, date, commitDate, message] = match;\n\n\t\t\t// Strip off refs/tags/\n\t\t\tname = name.substr(10);\n\n\t\t\ttags.push(\n\t\t\t\tnew GitTag(\n\t\t\t\t\trepoPath,\n\t\t\t\t\tname,\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\t` ${ref1 || ref2}`.substr(1),\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\t` ${message}`.substr(1),\n\t\t\t\t\tnew Date(date),\n\t\t\t\t\tcommitDate == null || commitDate.length === 0 ? undefined : new Date(commitDate),\n\t\t\t\t),\n\t\t\t);\n\t\t} while (true);\n\n\t\treturn tags;\n\t}\n}\n","import { debug } from '../../system/decorators/log';\nimport { GitTreeEntry } from '../models';\n\nconst emptyStr = '';\nconst treeRegex = /(?:.+?)\\s+(.+?)\\s+(.+?)\\s+(.+?)\\s+(.+)/gm;\n\nexport class GitTreeParser {\n\t@debug({ args: false, singleLine: true })\n\tstatic parse(data: string | undefined): GitTreeEntry[] | undefined {\n\t\tif (!data) return undefined;\n\n\t\tconst trees: GitTreeEntry[] = [];\n\n\t\tlet type;\n\t\tlet sha;\n\t\tlet size;\n\t\tlet filePath;\n\n\t\tlet match;\n\t\tdo {\n\t\t\tmatch = treeRegex.exec(data);\n\t\t\tif (match == null) break;\n\n\t\t\t[, type, sha, size, filePath] = match;\n\n\t\t\ttrees.push({\n\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\tcommitSha: sha == null || sha.length === 0 ? emptyStr : ` ${sha}`.substr(1),\n\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\tpath: filePath == null || filePath.length === 0 ? emptyStr : ` ${filePath}`.substr(1),\n\t\t\t\tsize: Number(size) || 0,\n\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\ttype: (type == null || type.length === 0 ? emptyStr : ` ${type}`.substr(1)) as 'blob' | 'tree',\n\t\t\t});\n\t\t} while (true);\n\n\t\treturn trees;\n\t}\n}\n","import { Uri } from 'vscode';\nimport { debug } from '../../system/decorators/log';\nimport { normalizePath } from '../../system/path';\nimport { getLines } from '../../system/string';\nimport { GitWorktree } from '../models/worktree';\n\ninterface WorktreeEntry {\n\tpath: string;\n\tsha?: string;\n\tbranch?: string;\n\tbare: boolean;\n\tdetached: boolean;\n\tlocked?: boolean | string;\n\tprunable?: boolean | string;\n}\n\nexport class GitWorktreeParser {\n\t@debug({ args: false, singleLine: true })\n\tstatic parse(data: string, repoPath: string): GitWorktree[] {\n\t\tif (!data) return [];\n\n\t\tif (repoPath != null) {\n\t\t\trepoPath = normalizePath(repoPath);\n\t\t}\n\n\t\tconst worktrees: GitWorktree[] = [];\n\n\t\tlet entry: Partial<WorktreeEntry> | undefined = undefined;\n\t\tlet line: string;\n\t\tlet key: string;\n\t\tlet value: string;\n\t\tlet locked: string;\n\t\tlet prunable: string;\n\t\tlet main = true; // the first worktree is the main worktree\n\n\t\tfor (line of getLines(data)) {\n\t\t\t[key, value] = line.split(' ', 2);\n\n\t\t\tif (key.length === 0 && entry != null) {\n\t\t\t\tworktrees.push(\n\t\t\t\t\tnew GitWorktree(\n\t\t\t\t\t\tmain,\n\t\t\t\t\t\tentry.bare ? 'bare' : entry.detached ? 'detached' : 'branch',\n\t\t\t\t\t\trepoPath,\n\t\t\t\t\t\tUri.file(entry.path!),\n\t\t\t\t\t\tentry.locked ?? false,\n\t\t\t\t\t\tentry.prunable ?? false,\n\t\t\t\t\t\tentry.sha,\n\t\t\t\t\t\tentry.branch,\n\t\t\t\t\t),\n\t\t\t\t);\n\n\t\t\t\tentry = undefined;\n\t\t\t\tmain = false;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (entry == null) {\n\t\t\t\tentry = {};\n\t\t\t}\n\n\t\t\tswitch (key) {\n\t\t\t\tcase 'worktree':\n\t\t\t\t\tentry.path = value;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'bare':\n\t\t\t\t\tentry.bare = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'HEAD':\n\t\t\t\t\tentry.sha = value;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'branch':\n\t\t\t\t\t// Strip off refs/heads/\n\t\t\t\t\tentry.branch = value.substr(11);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'detached':\n\t\t\t\t\tentry.detached = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'locked':\n\t\t\t\t\t[, locked] = value.split(' ', 2);\n\t\t\t\t\tentry.locked = locked?.trim() || true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'prunable':\n\t\t\t\t\t[, prunable] = value.split(' ', 2);\n\t\t\t\t\tentry.prunable = prunable?.trim() || true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn worktrees;\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"child_process\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"fs\");","import { ExecException, execFile } from 'child_process';\nimport { exists, existsSync, Stats, statSync } from 'fs';\nimport { join as joinPaths } from 'path';\nimport { decode } from 'iconv-lite';\nimport { Logger } from '../../../logger';\n\nexport const isWindows = process.platform === 'win32';\n\nconst slashesRegex = /[\\\\/]/;\nconst ps1Regex = /\\.ps1$/i;\nconst batOrCmdRegex = /\\.(bat|cmd)$/i;\nconst jsRegex = /\\.(js)$/i;\n\n/**\n * Search PATH to see if a file exists in any of the path folders.\n *\n * @param  {string} exe The file to search for\n * @return {string}     A fully qualified path, or the original path if nothing\n *                      is found\n *\n * @private\n */\nfunction runDownPath(exe: string): string {\n\t// NB: Windows won't search PATH looking for executables in spawn like\n\t// Posix does\n\n\t// Files with any directory path don't get this applied\n\tif (slashesRegex.test(exe)) return exe;\n\n\tconst target = joinPaths('.', exe);\n\ttry {\n\t\tconst stats = statSync(target);\n\t\tif (stats?.isFile() && isExecutable(stats)) return target;\n\t} catch {}\n\n\tconst path = process.env.PATH;\n\tif (path != null && path.length !== 0) {\n\t\tconst haystack = path.split(isWindows ? ';' : ':');\n\t\tlet stats;\n\t\tfor (const p of haystack) {\n\t\t\tconst needle = joinPaths(p, exe);\n\t\t\ttry {\n\t\t\t\tstats = statSync(needle);\n\t\t\t\tif (stats?.isFile() && isExecutable(stats)) return needle;\n\t\t\t} catch {}\n\t\t}\n\t}\n\n\treturn exe;\n}\n\nfunction isExecutable(stats: Stats) {\n\tif (isWindows) return true;\n\n\tconst isGroup = stats.gid ? process.getgid != null && stats.gid === process.getgid() : true;\n\tconst isUser = stats.uid ? process.getuid != null && stats.uid === process.getuid() : true;\n\n\treturn Boolean(stats.mode & 0o0001 || (stats.mode & 0o0010 && isGroup) || (stats.mode & 0o0100 && isUser));\n}\n\n/**\n * Finds the executable and parameters to run on Windows. This method\n * mimics the POSIX behavior of being able to run scripts as executables by\n * replacing the passed-in executable with the script runner, for PowerShell,\n * CMD, and node scripts.\n *\n * This method also does the work of running down PATH, which spawn on Windows\n * also doesn't do, unlike on POSIX.\n */\nexport function findExecutable(exe: string, args: string[]): { cmd: string; args: string[] } {\n\t// POSIX can just execute scripts directly, no need for silly goosery\n\tif (!isWindows) return { cmd: runDownPath(exe), args: args };\n\n\tif (!existsSync(exe)) {\n\t\t// NB: When you write something like `surf-client ... -- surf-build` on Windows,\n\t\t// a shell would normally convert that to surf-build.cmd, but since it's passed\n\t\t// in as an argument, it doesn't happen\n\t\tconst possibleExts = ['.exe', '.bat', '.cmd', '.ps1'];\n\t\tfor (const ext of possibleExts) {\n\t\t\tconst possibleFullPath = runDownPath(`${exe}${ext}`);\n\n\t\t\tif (existsSync(possibleFullPath)) return findExecutable(possibleFullPath, args);\n\t\t}\n\t}\n\n\tif (ps1Regex.test(exe)) {\n\t\tconst cmd = joinPaths(\n\t\t\tprocess.env.SYSTEMROOT ?? 'C:\\\\WINDOWS',\n\t\t\t'System32',\n\t\t\t'WindowsPowerShell',\n\t\t\t'v1.0',\n\t\t\t'PowerShell.exe',\n\t\t);\n\t\tconst psargs = ['-ExecutionPolicy', 'Unrestricted', '-NoLogo', '-NonInteractive', '-File', exe];\n\n\t\treturn { cmd: cmd, args: psargs.concat(args) };\n\t}\n\n\tif (batOrCmdRegex.test(exe)) {\n\t\tconst cmd = joinPaths(process.env.SYSTEMROOT ?? 'C:\\\\WINDOWS', 'System32', 'cmd.exe');\n\t\tconst cmdArgs = ['/C', exe, ...args];\n\n\t\treturn { cmd: cmd, args: cmdArgs };\n\t}\n\n\tif (jsRegex.test(exe)) {\n\t\tconst cmd = process.execPath;\n\t\tconst nodeArgs = [exe];\n\n\t\treturn { cmd: cmd, args: nodeArgs.concat(args) };\n\t}\n\n\treturn { cmd: exe, args: args };\n}\n\nexport interface RunOptions<TEncoding = BufferEncoding | 'buffer'> {\n\tcwd?: string;\n\treadonly env?: Record<string, any>;\n\treadonly encoding?: TEncoding;\n\t/**\n\t * The size the output buffer to allocate to the spawned process. Set this\n\t * if you are anticipating a large amount of output.\n\t *\n\t * If not specified, this will be 10MB (10485760 bytes) which should be\n\t * enough for most Git operations.\n\t */\n\treadonly maxBuffer?: number;\n\t/**\n\t * An optional string or buffer which will be written to\n\t * the child process stdin stream immediately immediately\n\t * after spawning the process.\n\t */\n\treadonly stdin?: string | Buffer;\n\t/**\n\t * The encoding to use when writing to stdin, if the stdin\n\t * parameter is a string.\n\t */\n\treadonly stdinEncoding?: string;\n}\n\nconst bufferExceededRegex = /stdout maxBuffer( length)? exceeded/;\n\nexport class RunError extends Error {\n\tconstructor(\n\t\tprivate readonly original: ExecException,\n\t\tpublic readonly stdout: string,\n\t\tpublic readonly stderr: string,\n\t) {\n\t\tsuper(original.message);\n\n\t\tstdout = stdout.trim();\n\t\tstderr = stderr.trim();\n\t\tError.captureStackTrace?.(this, RunError);\n\t}\n\n\tget cmd(): string | undefined {\n\t\treturn this.original.cmd;\n\t}\n\n\tget killed(): boolean | undefined {\n\t\treturn this.original.killed;\n\t}\n\n\tget code(): number | undefined {\n\t\treturn this.original.code;\n\t}\n\n\tget signal(): NodeJS.Signals | undefined {\n\t\treturn this.original.signal;\n\t}\n}\n\ntype ExitCodeOnlyRunOptions = RunOptions & { exitCodeOnly: true };\n\nexport function run(\n\tcommand: string,\n\targs: any[],\n\tencoding: BufferEncoding | 'buffer' | string,\n\toptions: ExitCodeOnlyRunOptions,\n): Promise<number>;\nexport function run<T extends string | Buffer>(\n\tcommand: string,\n\targs: any[],\n\tencoding: BufferEncoding | 'buffer' | string,\n\toptions?: RunOptions,\n): Promise<T>;\nexport function run<T extends number | string | Buffer>(\n\tcommand: string,\n\targs: any[],\n\tencoding: BufferEncoding | 'buffer' | string,\n\toptions?: RunOptions & { exitCodeOnly?: boolean },\n): Promise<T> {\n\tconst { stdin, stdinEncoding, ...opts }: RunOptions = { maxBuffer: 100 * 1024 * 1024, ...options };\n\n\treturn new Promise<T>((resolve, reject) => {\n\t\tconst proc = execFile(command, args, opts, (error: ExecException | null, stdout, stderr) => {\n\t\t\tif (options?.exitCodeOnly) {\n\t\t\t\tresolve((error?.code ?? proc.exitCode) as T);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (error != null) {\n\t\t\t\tif (bufferExceededRegex.test(error.message)) {\n\t\t\t\t\terror.message = `Command output exceeded the allocated stdout buffer. Set 'options.maxBuffer' to a larger value than ${opts.maxBuffer} bytes`;\n\t\t\t\t}\n\n\t\t\t\treject(\n\t\t\t\t\tnew RunError(\n\t\t\t\t\t\terror,\n\t\t\t\t\t\tencoding === 'utf8' || encoding === 'binary' || encoding === 'buffer'\n\t\t\t\t\t\t\t? stdout\n\t\t\t\t\t\t\t: decode(Buffer.from(stdout, 'binary'), encoding),\n\t\t\t\t\t\tencoding === 'utf8' || encoding === 'binary' || encoding === 'buffer'\n\t\t\t\t\t\t\t? stderr\n\t\t\t\t\t\t\t: decode(Buffer.from(stderr, 'binary'), encoding),\n\t\t\t\t\t),\n\t\t\t\t);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (stderr) {\n\t\t\t\tLogger.warn(`Warning(${command} ${args.join(' ')}): ${stderr}`);\n\t\t\t}\n\n\t\t\tresolve(\n\t\t\t\tencoding === 'utf8' || encoding === 'binary' || encoding === 'buffer'\n\t\t\t\t\t? (stdout as T)\n\t\t\t\t\t: (decode(Buffer.from(stdout, 'binary'), encoding) as T),\n\t\t\t);\n\t\t});\n\n\t\tif (stdin != null) {\n\t\t\tproc.stdin?.end(stdin, (stdinEncoding ?? 'utf8') as BufferEncoding);\n\t\t}\n\t});\n}\n\nexport function fsExists(path: string) {\n\treturn new Promise<boolean>(resolve => exists(path, exists => resolve(exists)));\n}\n","import { Uri, window, workspace } from 'vscode';\nimport { hrtime } from '@env/hrtime';\nimport { GlyphChars } from '../../../constants';\nimport { GitCommandOptions, GitErrorHandling } from '../../../git/commandOptions';\nimport { GitDiffFilter, GitRevision, GitUser } from '../../../git/models';\nimport { GitBranchParser, GitLogParser, GitReflogParser, GitStashParser, GitTagParser } from '../../../git/parsers';\nimport { Logger } from '../../../logger';\nimport { dirname, isAbsolute, isFolderGlob, joinPaths, normalizePath, splitPath } from '../../../system/path';\nimport { getDurationMilliseconds } from '../../../system/string';\nimport { compare, fromString } from '../../../system/version';\nimport { GitLocation } from './locator';\nimport { fsExists, run, RunError, RunOptions } from './shell';\n\nconst emptyArray = Object.freeze([]) as unknown as any[];\nconst emptyObj = Object.freeze({});\n\nexport const maxGitCliLength = 30000;\n\nconst textDecoder = new TextDecoder('utf8');\n\n// This is a root sha of all git repo's if using sha1\nconst rootSha = '4b825dc642cb6eb9a060e54bf8d69288fbee4904';\n\nexport const GitErrors = {\n\tbadRevision: /bad revision '(.*?)'/i,\n\tnoFastForward: /\\(non-fast-forward\\)/i,\n\tnoMergeBase: /no merge base/i,\n\tnotAValidObjectName: /Not a valid object name/i,\n\tinvalidLineCount: /file .+? has only \\d+ lines/i,\n\tuncommittedChanges: /contains modified or untracked files/i,\n\talreadyExists: /already exists/i,\n\talreadyCheckedOut: /already checked out/i,\n\tmainWorkingTree: /is a main working tree/i,\n};\n\nconst GitWarnings = {\n\tnotARepository: /Not a git repository/i,\n\toutsideRepository: /is outside repository/i,\n\tnoPath: /no such path/i,\n\tnoCommits: /does not have any commits/i,\n\tnotFound: /Path '.*?' does not exist in/i,\n\tfoundButNotInRevision: /Path '.*?' exists on disk, but not in/i,\n\theadNotABranch: /HEAD does not point to a branch/i,\n\tnoUpstream: /no upstream configured for branch '(.*?)'/i,\n\tunknownRevision:\n\t\t/ambiguous argument '.*?': unknown revision or path not in the working tree|not stored as a remote-tracking branch/i,\n\tmustRunInWorkTree: /this operation must be run in a work tree/i,\n\tpatchWithConflicts: /Applied patch to '.*?' with conflicts/i,\n\tnoRemoteRepositorySpecified: /No remote repository specified\\./i,\n\tremoteConnectionError: /Could not read from remote repository/i,\n\tnotAGitCommand: /'.+' is not a git command/i,\n};\n\nfunction defaultExceptionHandler(ex: Error, cwd: string | undefined, start?: [number, number]): string {\n\tconst msg = ex.message || ex.toString();\n\tif (msg != null && msg.length !== 0) {\n\t\tfor (const warning of Object.values(GitWarnings)) {\n\t\t\tif (warning.test(msg)) {\n\t\t\t\tconst duration = start !== undefined ? `${getDurationMilliseconds(start)} ms` : '';\n\t\t\t\tLogger.warn(\n\t\t\t\t\t`[${cwd}] Git ${msg\n\t\t\t\t\t\t.trim()\n\t\t\t\t\t\t.replace(/fatal: /g, '')\n\t\t\t\t\t\t.replace(/\\r?\\n|\\r/g, ` ${GlyphChars.Dot} `)} ${GlyphChars.Dot} ${duration}`,\n\t\t\t\t);\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\n\t\tconst match = GitErrors.badRevision.exec(msg);\n\t\tif (match != null) {\n\t\t\tconst [, ref] = match;\n\n\t\t\t// Since looking up a ref with ^3 (e.g. looking for untracked files in a stash) can error on some versions of git just ignore it\n\t\t\tif (ref?.endsWith('^3')) return '';\n\t\t}\n\t}\n\n\tthrow ex;\n}\n\ntype ExitCodeOnlyGitCommandOptions = GitCommandOptions & { exitCodeOnly: true };\n\nexport class Git {\n\t// A map of running git commands -- avoids running duplicate overlaping commands\n\tprivate readonly pendingCommands = new Map<string, Promise<string | Buffer>>();\n\n\tasync git(options: ExitCodeOnlyGitCommandOptions, ...args: any[]): Promise<number>;\n\tasync git<T extends string | Buffer>(options: GitCommandOptions, ...args: any[]): Promise<T>;\n\tasync git<T extends string | Buffer>(options: GitCommandOptions, ...args: any[]): Promise<T> {\n\t\tconst start = hrtime();\n\n\t\tconst { configs, correlationKey, errors: errorHandling, encoding, ...opts } = options;\n\n\t\tconst runOpts: RunOptions = {\n\t\t\t...opts,\n\t\t\tencoding: (encoding ?? 'utf8') === 'utf8' ? 'utf8' : 'buffer',\n\t\t\t// Adds GCM environment variables to avoid any possible credential issues -- from https://github.com/Microsoft/vscode/issues/26573#issuecomment-338686581\n\t\t\t// Shouldn't *really* be needed but better safe than sorry\n\t\t\tenv: {\n\t\t\t\t...process.env,\n\t\t\t\t...(options.env ?? emptyObj),\n\t\t\t\tGCM_INTERACTIVE: 'NEVER',\n\t\t\t\tGCM_PRESERVE_CREDS: 'TRUE',\n\t\t\t\tLC_ALL: 'C',\n\t\t\t},\n\t\t};\n\n\t\tconst gitCommand = `[${runOpts.cwd}] git ${args.join(' ')}`;\n\n\t\tconst command = `${correlationKey !== undefined ? `${correlationKey}:` : ''}${gitCommand}`;\n\n\t\tlet waiting;\n\t\tlet promise = this.pendingCommands.get(command);\n\t\tif (promise === undefined) {\n\t\t\twaiting = false;\n\n\t\t\t// Fixes https://github.com/gitkraken/vscode-gitlens/issues/73 & https://github.com/gitkraken/vscode-gitlens/issues/161\n\t\t\t// See https://stackoverflow.com/questions/4144417/how-to-handle-asian-characters-in-file-names-in-git-on-os-x\n\t\t\targs.splice(\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\t'-c',\n\t\t\t\t'core.quotepath=false',\n\t\t\t\t'-c',\n\t\t\t\t'color.ui=false',\n\t\t\t\t...(configs !== undefined ? configs : emptyArray),\n\t\t\t);\n\n\t\t\tif (process.platform === 'win32') {\n\t\t\t\targs.splice(0, 0, '-c', 'core.longpaths=true');\n\t\t\t}\n\n\t\t\tpromise = run<T>(await this.path(), args, encoding ?? 'utf8', runOpts);\n\n\t\t\tthis.pendingCommands.set(command, promise);\n\t\t} else {\n\t\t\twaiting = true;\n\t\t\tLogger.debug(`[GIT  ] ${gitCommand} ${GlyphChars.Dot} waiting...`);\n\t\t}\n\n\t\tlet exception: Error | undefined;\n\t\ttry {\n\t\t\treturn (await promise) as T;\n\t\t} catch (ex) {\n\t\t\texception = ex;\n\n\t\t\tswitch (errorHandling) {\n\t\t\t\tcase GitErrorHandling.Ignore:\n\t\t\t\t\texception = undefined;\n\t\t\t\t\treturn '' as T;\n\n\t\t\t\tcase GitErrorHandling.Throw:\n\t\t\t\t\tthrow ex;\n\n\t\t\t\tdefault: {\n\t\t\t\t\tconst result = defaultExceptionHandler(ex, options.cwd, start);\n\t\t\t\t\texception = undefined;\n\t\t\t\t\treturn result as T;\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tthis.pendingCommands.delete(command);\n\n\t\t\tconst duration = getDurationMilliseconds(start);\n\t\t\tconst slow = duration > Logger.slowCallWarningThreshold;\n\t\t\tconst status =\n\t\t\t\tslow || waiting\n\t\t\t\t\t? ` (${slow ? `slow${waiting ? ', waiting' : ''}` : ''}${waiting ? 'waiting' : ''})`\n\t\t\t\t\t: '';\n\n\t\t\tif (exception != null) {\n\t\t\t\tLogger.error(\n\t\t\t\t\t'',\n\t\t\t\t\t`[GIT  ] ${gitCommand} ${GlyphChars.Dot} ${(exception.message || String(exception) || '')\n\t\t\t\t\t\t.trim()\n\t\t\t\t\t\t.replace(/fatal: /g, '')\n\t\t\t\t\t\t.replace(/\\r?\\n|\\r/g, ` ${GlyphChars.Dot} `)} ${GlyphChars.Dot} ${duration} ms${status}`,\n\t\t\t\t);\n\t\t\t} else if (slow) {\n\t\t\t\tLogger.warn(`[GIT  ] ${gitCommand} ${GlyphChars.Dot} ${duration} ms${status}`);\n\t\t\t} else {\n\t\t\t\tLogger.log(`[GIT  ] ${gitCommand} ${GlyphChars.Dot} ${duration} ms${status}`);\n\t\t\t}\n\t\t\tLogger.logGitCommand(\n\t\t\t\t`${gitCommand}${exception != null ? ` ${GlyphChars.Dot} FAILED` : ''}${waiting ? ' (waited)' : ''}`,\n\t\t\t\tduration,\n\t\t\t\texception,\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate gitLocator!: () => Promise<GitLocation>;\n\tsetLocator(locator: () => Promise<GitLocation>): void {\n\t\tthis.gitLocator = locator;\n\t}\n\n\tasync path(): Promise<string> {\n\t\treturn (await this.gitLocator()).path;\n\t}\n\n\tasync version(): Promise<string> {\n\t\treturn (await this.gitLocator()).version;\n\t}\n\n\tasync isAtLeastVersion(minimum: string): Promise<boolean> {\n\t\tconst result = compare(fromString(await this.version()), fromString(minimum));\n\t\treturn result !== -1;\n\t}\n\n\t// Git commands\n\n\tadd(repoPath: string | undefined, pathspec: string) {\n\t\treturn this.git<string>({ cwd: repoPath }, 'add', '-A', '--', pathspec);\n\t}\n\n\tapply(repoPath: string | undefined, patch: string, options: { allowConflicts?: boolean } = {}) {\n\t\tconst params = ['apply', '--whitespace=warn'];\n\t\tif (options.allowConflicts) {\n\t\t\tparams.push('-3');\n\t\t}\n\t\treturn this.git<string>({ cwd: repoPath, stdin: patch }, ...params);\n\t}\n\n\tprivate readonly ignoreRevsFileMap = new Map<string, boolean>();\n\n\tasync blame(\n\t\trepoPath: string | undefined,\n\t\tfileName: string,\n\t\tref?: string,\n\t\toptions: { args?: string[] | null; ignoreWhitespace?: boolean; startLine?: number; endLine?: number } = {},\n\t) {\n\t\tconst [file, root] = splitPath(fileName, repoPath, true);\n\n\t\tconst params = ['blame', '--root', '--incremental'];\n\n\t\tif (options.ignoreWhitespace) {\n\t\t\tparams.push('-w');\n\t\t}\n\t\tif (options.startLine != null && options.endLine != null) {\n\t\t\tparams.push(`-L ${options.startLine},${options.endLine}`);\n\t\t}\n\t\tif (options.args != null) {\n\t\t\tparams.push(...options.args);\n\n\t\t\tconst index = params.indexOf('--ignore-revs-file');\n\t\t\tif (index !== -1) {\n\t\t\t\t// Ensure the version of Git supports the --ignore-revs-file flag, otherwise the blame will fail\n\t\t\t\tlet supported = await this.isAtLeastVersion('2.23');\n\t\t\t\tif (supported) {\n\t\t\t\t\tlet ignoreRevsFile = params[index + 1];\n\t\t\t\t\tif (!isAbsolute(ignoreRevsFile)) {\n\t\t\t\t\t\tignoreRevsFile = joinPaths(repoPath ?? '', ignoreRevsFile);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst exists = this.ignoreRevsFileMap.get(ignoreRevsFile);\n\t\t\t\t\tif (exists !== undefined) {\n\t\t\t\t\t\tsupported = exists;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Ensure the specified --ignore-revs-file exists, otherwise the blame will fail\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tsupported = await fsExists(ignoreRevsFile);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tsupported = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.ignoreRevsFileMap.set(ignoreRevsFile, supported);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!supported) {\n\t\t\t\t\tparams.splice(index, 2);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet stdin;\n\t\tif (ref) {\n\t\t\tif (GitRevision.isUncommittedStaged(ref)) {\n\t\t\t\t// Pipe the blame contents to stdin\n\t\t\t\tparams.push('--contents', '-');\n\n\t\t\t\t// Get the file contents for the staged version using `:`\n\t\t\t\tstdin = await this.show<string>(repoPath, fileName, ':');\n\t\t\t} else {\n\t\t\t\tparams.push(ref);\n\t\t\t}\n\t\t}\n\n\t\treturn this.git<string>({ cwd: root, stdin: stdin }, ...params, '--', file);\n\t}\n\n\tblame__contents(\n\t\trepoPath: string | undefined,\n\t\tfileName: string,\n\t\tcontents: string,\n\t\toptions: {\n\t\t\targs?: string[] | null;\n\t\t\tcorrelationKey?: string;\n\t\t\tignoreWhitespace?: boolean;\n\t\t\tstartLine?: number;\n\t\t\tendLine?: number;\n\t\t} = {},\n\t) {\n\t\tconst [file, root] = splitPath(fileName, repoPath, true);\n\n\t\tconst params = ['blame', '--root', '--incremental'];\n\n\t\tif (options.ignoreWhitespace) {\n\t\t\tparams.push('-w');\n\t\t}\n\t\tif (options.startLine != null && options.endLine != null) {\n\t\t\tparams.push(`-L ${options.startLine},${options.endLine}`);\n\t\t}\n\t\tif (options.args != null) {\n\t\t\tparams.push(...options.args);\n\t\t}\n\n\t\t// Pipe the blame contents to stdin\n\t\tparams.push('--contents', '-');\n\n\t\treturn this.git<string>(\n\t\t\t{ cwd: root, stdin: contents, correlationKey: options.correlationKey },\n\t\t\t...params,\n\t\t\t'--',\n\t\t\tfile,\n\t\t);\n\t}\n\n\tbranch__containsOrPointsAt(\n\t\trepoPath: string,\n\t\tref: string,\n\t\t{\n\t\t\tmode = 'contains',\n\t\t\tname = undefined,\n\t\t\tremotes = false,\n\t\t}: { mode?: 'contains' | 'pointsAt'; name?: string; remotes?: boolean } = {},\n\t) {\n\t\tconst params = ['branch'];\n\t\tif (remotes) {\n\t\t\tparams.push('-r');\n\t\t}\n\t\tparams.push(mode === 'pointsAt' ? `--points-at=${ref}` : `--contains=${ref}`, '--format=%(refname:short)');\n\t\tif (name != null) {\n\t\t\tparams.push(name);\n\t\t}\n\n\t\treturn this.git<string>(\n\t\t\t{ cwd: repoPath, configs: ['-c', 'color.branch=false'], errors: GitErrorHandling.Ignore },\n\t\t\t...params,\n\t\t);\n\t}\n\n\tcheck_ignore(repoPath: string, ...files: string[]) {\n\t\treturn this.git<string>(\n\t\t\t{ cwd: repoPath, errors: GitErrorHandling.Ignore, stdin: files.join('\\0') },\n\t\t\t'check-ignore',\n\t\t\t'-z',\n\t\t\t'--stdin',\n\t\t);\n\t}\n\n\tcheck_mailmap(repoPath: string, author: string) {\n\t\treturn this.git<string>({ cwd: repoPath, errors: GitErrorHandling.Ignore }, 'check-mailmap', author);\n\t}\n\n\tasync check_ref_format(ref: string, repoPath?: string, options: { branch?: boolean } = { branch: true }) {\n\t\tconst params = ['check-ref-format'];\n\t\tif (options.branch) {\n\t\t\tparams.push('--branch');\n\t\t} else {\n\t\t\tparams.push('--normalize');\n\t\t}\n\n\t\ttry {\n\t\t\tconst data = await this.git<string>(\n\t\t\t\t{ cwd: repoPath ?? '', errors: GitErrorHandling.Throw },\n\t\t\t\t...params,\n\t\t\t\tref,\n\t\t\t);\n\t\t\treturn Boolean(data.trim());\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tcheckout(\n\t\trepoPath: string,\n\t\tref: string,\n\t\t{ createBranch, fileName }: { createBranch?: string; fileName?: string } = {},\n\t) {\n\t\tconst params = ['checkout'];\n\t\tif (createBranch) {\n\t\t\tparams.push('-b', createBranch, ref, '--');\n\t\t} else {\n\t\t\tparams.push(ref, '--');\n\n\t\t\tif (fileName) {\n\t\t\t\t[fileName, repoPath] = splitPath(fileName, repoPath, true);\n\n\t\t\t\tparams.push(fileName);\n\t\t\t}\n\t\t}\n\n\t\treturn this.git<string>({ cwd: repoPath }, ...params);\n\t}\n\n\tasync config__get(key: string, repoPath?: string, options: { local?: boolean } = {}) {\n\t\tconst data = await this.git<string>(\n\t\t\t{ cwd: repoPath ?? '', errors: GitErrorHandling.Ignore, local: options.local },\n\t\t\t'config',\n\t\t\t'--get',\n\t\t\tkey,\n\t\t);\n\t\treturn data.length === 0 ? undefined : data.trim();\n\t}\n\n\tasync config__get_regex(pattern: string, repoPath?: string, options: { local?: boolean } = {}) {\n\t\tconst data = await this.git<string>(\n\t\t\t{ cwd: repoPath ?? '', errors: GitErrorHandling.Ignore, local: options.local },\n\t\t\t'config',\n\t\t\t'--get-regex',\n\t\t\tpattern,\n\t\t);\n\t\treturn data.length === 0 ? undefined : data.trim();\n\t}\n\n\tasync diff(\n\t\trepoPath: string,\n\t\tfileName: string,\n\t\tref1?: string,\n\t\tref2?: string,\n\t\toptions: {\n\t\t\tencoding?: string;\n\t\t\tfilters?: GitDiffFilter[];\n\t\t\tlinesOfContext?: number;\n\t\t\trenames?: boolean;\n\t\t\tsimilarityThreshold?: number | null;\n\t\t} = {},\n\t): Promise<string> {\n\t\tconst params = ['diff', '--no-ext-diff', '--minimal'];\n\n\t\tif (options.linesOfContext != null) {\n\t\t\tparams.push(`-U${options.linesOfContext}`);\n\t\t}\n\n\t\tif (options.renames) {\n\t\t\tparams.push(`-M${options.similarityThreshold == null ? '' : `${options.similarityThreshold}%`}`);\n\t\t}\n\n\t\tif (options.filters != null && options.filters.length !== 0) {\n\t\t\tparams.push(`--diff-filter=${options.filters.join('')}`);\n\t\t}\n\n\t\tif (ref1) {\n\t\t\t// <sha>^3 signals an untracked file in a stash and if we are trying to find its parent, use the root sha\n\t\t\tif (ref1.endsWith('^3^')) {\n\t\t\t\tref1 = rootSha;\n\t\t\t}\n\t\t\tparams.push(GitRevision.isUncommittedStaged(ref1) ? '--staged' : ref1);\n\t\t}\n\t\tif (ref2) {\n\t\t\tparams.push(GitRevision.isUncommittedStaged(ref2) ? '--staged' : ref2);\n\t\t}\n\n\t\ttry {\n\t\t\treturn await this.git<string>(\n\t\t\t\t{\n\t\t\t\t\tcwd: repoPath,\n\t\t\t\t\tconfigs: ['-c', 'color.diff=false'],\n\t\t\t\t\tencoding: options.encoding,\n\t\t\t\t},\n\t\t\t\t...params,\n\t\t\t\t'--',\n\t\t\t\tfileName,\n\t\t\t);\n\t\t} catch (ex) {\n\t\t\tconst match = GitErrors.badRevision.exec(ex.message);\n\t\t\tif (match !== null) {\n\t\t\t\tconst [, ref] = match;\n\n\t\t\t\t// If the bad ref is trying to find a parent ref, assume we hit to the last commit, so try again using the root sha\n\t\t\t\tif (ref === ref1 && ref != null && ref.endsWith('^')) {\n\t\t\t\t\treturn this.diff(repoPath, fileName, rootSha, ref2, options);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthrow ex;\n\t\t}\n\t}\n\n\tasync diff__contents(\n\t\trepoPath: string,\n\t\tfileName: string,\n\t\tref: string,\n\t\tcontents: string,\n\t\toptions: { encoding?: string; filters?: GitDiffFilter[]; similarityThreshold?: number | null } = {},\n\t): Promise<string> {\n\t\tconst params = [\n\t\t\t'diff',\n\t\t\t`-M${options.similarityThreshold == null ? '' : `${options.similarityThreshold}%`}`,\n\t\t\t'--no-ext-diff',\n\t\t\t'-U0',\n\t\t\t'--minimal',\n\t\t];\n\n\t\tif (options.filters != null && options.filters.length !== 0) {\n\t\t\tparams.push(`--diff-filter=${options.filters.join('')}`);\n\t\t}\n\n\t\t// // <sha>^3 signals an untracked file in a stash and if we are trying to find its parent, use the root sha\n\t\t// if (ref.endsWith('^3^')) {\n\t\t// \tref = rootSha;\n\t\t// }\n\t\t// params.push(GitRevision.isUncommittedStaged(ref) ? '--staged' : ref);\n\n\t\tparams.push('--no-index');\n\n\t\ttry {\n\t\t\treturn await this.git<string>(\n\t\t\t\t{\n\t\t\t\t\tcwd: repoPath,\n\t\t\t\t\tconfigs: ['-c', 'color.diff=false'],\n\t\t\t\t\tencoding: options.encoding,\n\t\t\t\t\tstdin: contents,\n\t\t\t\t},\n\t\t\t\t...params,\n\t\t\t\t'--',\n\t\t\t\tfileName,\n\t\t\t\t// Pipe the contents to stdin\n\t\t\t\t'-',\n\t\t\t);\n\t\t} catch (ex) {\n\t\t\tif (ex instanceof RunError && ex.stdout) {\n\t\t\t\treturn ex.stdout;\n\t\t\t}\n\n\t\t\tconst match = GitErrors.badRevision.exec(ex.message);\n\t\t\tif (match !== null) {\n\t\t\t\tconst [, matchedRef] = match;\n\n\t\t\t\t// If the bad ref is trying to find a parent ref, assume we hit to the last commit, so try again using the root sha\n\t\t\t\tif (matchedRef === ref && matchedRef != null && matchedRef.endsWith('^')) {\n\t\t\t\t\treturn this.diff__contents(repoPath, fileName, rootSha, contents, options);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthrow ex;\n\t\t}\n\t}\n\n\tdiff__name_status(\n\t\trepoPath: string,\n\t\tref1?: string,\n\t\tref2?: string,\n\t\t{ filters, similarityThreshold }: { filters?: GitDiffFilter[]; similarityThreshold?: number | null } = {},\n\t) {\n\t\tconst params = [\n\t\t\t'diff',\n\t\t\t'--name-status',\n\t\t\t`-M${similarityThreshold == null ? '' : `${similarityThreshold}%`}`,\n\t\t\t'--no-ext-diff',\n\t\t];\n\t\tif (filters != null && filters.length !== 0) {\n\t\t\tparams.push(`--diff-filter=${filters.join('')}`);\n\t\t}\n\t\tif (ref1) {\n\t\t\tparams.push(ref1);\n\t\t}\n\t\tif (ref2) {\n\t\t\tparams.push(ref2);\n\t\t}\n\n\t\treturn this.git<string>({ cwd: repoPath, configs: ['-c', 'color.diff=false'] }, ...params, '--');\n\t}\n\n\tasync diff__shortstat(repoPath: string, ref?: string) {\n\t\tconst params = ['diff', '--shortstat', '--no-ext-diff'];\n\t\tif (ref) {\n\t\t\tparams.push(ref);\n\t\t}\n\n\t\ttry {\n\t\t\treturn await this.git<string>({ cwd: repoPath, configs: ['-c', 'color.diff=false'] }, ...params, '--');\n\t\t} catch (ex) {\n\t\t\tconst msg: string = ex?.toString() ?? '';\n\t\t\tif (GitErrors.noMergeBase.test(msg)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tthrow ex;\n\t\t}\n\t}\n\n\tdifftool(\n\t\trepoPath: string,\n\t\tfileName: string,\n\t\ttool: string,\n\t\toptions: { ref1?: string; ref2?: string; staged?: boolean } = {},\n\t) {\n\t\tconst params = ['difftool', '--no-prompt', `--tool=${tool}`];\n\t\tif (options.staged) {\n\t\t\tparams.push('--staged');\n\t\t}\n\t\tif (options.ref1) {\n\t\t\tparams.push(options.ref1);\n\t\t}\n\t\tif (options.ref2) {\n\t\t\tparams.push(options.ref2);\n\t\t}\n\n\t\treturn this.git<string>({ cwd: repoPath }, ...params, '--', fileName);\n\t}\n\n\tdifftool__dir_diff(repoPath: string, tool: string, ref1: string, ref2?: string) {\n\t\tconst params = ['difftool', '--dir-diff', `--tool=${tool}`, ref1];\n\t\tif (ref2) {\n\t\t\tparams.push(ref2);\n\t\t}\n\n\t\treturn this.git<string>({ cwd: repoPath }, ...params);\n\t}\n\n\tasync fetch(\n\t\trepoPath: string,\n\t\toptions:\n\t\t\t| { all?: boolean; branch?: undefined; prune?: boolean; remote?: string }\n\t\t\t| {\n\t\t\t\t\tall?: undefined;\n\t\t\t\t\tbranch: string;\n\t\t\t\t\tprune?: undefined;\n\t\t\t\t\tpull?: boolean;\n\t\t\t\t\tremote: string;\n\t\t\t\t\tupstream: string;\n\t\t\t  } = {},\n\t): Promise<void> {\n\t\tconst params = ['fetch'];\n\n\t\tif (options.prune) {\n\t\t\tparams.push('--prune');\n\t\t}\n\n\t\tif (options.branch && options.remote) {\n\t\t\tif (options.upstream && options.pull) {\n\t\t\t\tparams.push('-u', options.remote, `${options.upstream}:${options.branch}`);\n\n\t\t\t\ttry {\n\t\t\t\t\tvoid (await this.git<string>({ cwd: repoPath }, ...params));\n\t\t\t\t\treturn;\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tconst msg: string = ex?.toString() ?? '';\n\t\t\t\t\tif (GitErrors.noFastForward.test(msg)) {\n\t\t\t\t\t\tvoid window.showErrorMessage(\n\t\t\t\t\t\t\t`Unable to pull the '${options.branch}' branch, as it can't be fast-forwarded.`,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow ex;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparams.push(options.remote, options.branch);\n\t\t\t}\n\t\t} else if (options.remote) {\n\t\t\tparams.push(options.remote);\n\t\t} else if (options.all) {\n\t\t\tparams.push('--all');\n\t\t}\n\n\t\tvoid (await this.git<string>({ cwd: repoPath }, ...params));\n\t}\n\n\tfor_each_ref__branch(repoPath: string, options: { all: boolean } = { all: false }) {\n\t\tconst params = ['for-each-ref', `--format=${GitBranchParser.defaultFormat}`, 'refs/heads'];\n\t\tif (options.all) {\n\t\t\tparams.push('refs/remotes');\n\t\t}\n\n\t\treturn this.git<string>({ cwd: repoPath }, ...params);\n\t}\n\n\tlog(\n\t\trepoPath: string,\n\t\tref: string | undefined,\n\t\t{\n\t\t\tall,\n\t\t\targsOrFormat,\n\t\t\tauthors,\n\t\t\tlimit,\n\t\t\tmerges,\n\t\t\tordering,\n\t\t\tsimilarityThreshold,\n\t\t\tsince,\n\t\t}: {\n\t\t\tall?: boolean;\n\t\t\targsOrFormat?: string | string[];\n\t\t\tauthors?: GitUser[];\n\t\t\tlimit?: number;\n\t\t\tmerges?: boolean;\n\t\t\tordering?: string | null;\n\t\t\tsimilarityThreshold?: number | null;\n\t\t\tsince?: string;\n\t\t},\n\t) {\n\t\tif (argsOrFormat == null) {\n\t\t\targsOrFormat = ['--name-status', `--format=${GitLogParser.defaultFormat}`];\n\t\t}\n\n\t\tif (typeof argsOrFormat === 'string') {\n\t\t\targsOrFormat = [`--format=${argsOrFormat}`];\n\t\t}\n\n\t\tconst params = [\n\t\t\t'log',\n\t\t\t...argsOrFormat,\n\t\t\t'--full-history',\n\t\t\t`-M${similarityThreshold == null ? '' : `${similarityThreshold}%`}`,\n\t\t\t'-m',\n\t\t];\n\n\t\tif (ordering) {\n\t\t\tparams.push(`--${ordering}-order`);\n\t\t}\n\n\t\tif (limit) {\n\t\t\tparams.push(`-n${limit + 1}`);\n\t\t}\n\n\t\tif (since) {\n\t\t\tparams.push(`--since=\"${since}\"`);\n\t\t}\n\n\t\tif (!merges) {\n\t\t\tparams.push('--first-parent');\n\t\t}\n\n\t\tif (authors != null && authors.length !== 0) {\n\t\t\tif (!params.includes('--use-mailmap')) {\n\t\t\t\tparams.push('--use-mailmap');\n\t\t\t}\n\t\t\tparams.push(...authors.map(a => `--author=^${a.name} <${a.email}>$`));\n\t\t}\n\n\t\tif (all) {\n\t\t\tparams.push('--all');\n\t\t}\n\n\t\tif (ref && !GitRevision.isUncommittedStaged(ref)) {\n\t\t\tparams.push(ref);\n\t\t}\n\n\t\treturn this.git<string>(\n\t\t\t{ cwd: repoPath, configs: ['-c', 'diff.renameLimit=0', '-c', 'log.showSignature=false'] },\n\t\t\t...params,\n\t\t\t'--',\n\t\t);\n\t}\n\n\tlog__file(\n\t\trepoPath: string,\n\t\tfileName: string,\n\t\tref: string | undefined,\n\t\t{\n\t\t\tall,\n\t\t\targsOrFormat,\n\t\t\t// TODO@eamodio remove this in favor of argsOrFormat\n\t\t\tfileMode = 'full',\n\t\t\tfilters,\n\t\t\tfirstParent = false,\n\t\t\tlimit,\n\t\t\tordering,\n\t\t\trenames = true,\n\t\t\treverse = false,\n\t\t\tsince,\n\t\t\tskip,\n\t\t\tstartLine,\n\t\t\tendLine,\n\t\t}: {\n\t\t\tall?: boolean;\n\t\t\targsOrFormat?: string | string[];\n\t\t\t// TODO@eamodio remove this in favor of argsOrFormat\n\t\t\tfileMode?: 'full' | 'simple' | 'none';\n\t\t\tfilters?: GitDiffFilter[];\n\t\t\tfirstParent?: boolean;\n\t\t\tlimit?: number;\n\t\t\tordering?: string | null;\n\t\t\trenames?: boolean;\n\t\t\treverse?: boolean;\n\t\t\tsince?: string;\n\t\t\tskip?: number;\n\t\t\tstartLine?: number;\n\t\t\tendLine?: number;\n\t\t} = {},\n\t) {\n\t\tconst [file, root] = splitPath(fileName, repoPath, true);\n\n\t\tif (argsOrFormat == null) {\n\t\t\targsOrFormat = [`--format=${GitLogParser.defaultFormat}`];\n\t\t}\n\n\t\tif (typeof argsOrFormat === 'string') {\n\t\t\targsOrFormat = [`--format=${argsOrFormat}`];\n\t\t}\n\n\t\tconst params = ['log', ...argsOrFormat];\n\n\t\tif (ordering) {\n\t\t\tparams.push(`--${ordering}-order`);\n\t\t}\n\n\t\tif (limit && !reverse) {\n\t\t\tparams.push(`-n${limit + 1}`);\n\t\t}\n\n\t\tif (skip) {\n\t\t\tparams.push(`--skip=${skip}`);\n\t\t}\n\n\t\tif (since) {\n\t\t\tparams.push(`--since=\"${since}\"`);\n\t\t}\n\n\t\tif (all) {\n\t\t\tparams.push('--all');\n\t\t}\n\n\t\t// Can't allow rename detection (`--follow`) if `all` or a `startLine` is specified\n\t\tif (renames && (all || startLine != null)) {\n\t\t\trenames = false;\n\t\t}\n\n\t\tparams.push(renames ? '--follow' : '-m');\n\t\tif (/*renames ||*/ firstParent) {\n\t\t\tparams.push('--first-parent');\n\t\t\t// In Git >= 2.29.0 `--first-parent` implies `-m`, so lets include it for consistency\n\t\t\tif (renames) {\n\t\t\t\tparams.push('-m');\n\t\t\t}\n\t\t}\n\n\t\tif (filters != null && filters.length !== 0) {\n\t\t\tparams.push(`--diff-filter=${filters.join('')}`);\n\t\t}\n\n\t\tif (fileMode !== 'none') {\n\t\t\tif (startLine == null) {\n\t\t\t\t// If this is the log of a folder, use `--name-status` to match non-file logs (for parsing)\n\t\t\t\tif (fileMode === 'simple' || isFolderGlob(file)) {\n\t\t\t\t\tparams.push('--name-status');\n\t\t\t\t} else {\n\t\t\t\t\tparams.push('--numstat', '--summary');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Don't include `--name-status`, `--numstat`, or `--summary` because they aren't supported with `-L`\n\t\t\t\tparams.push(`-L ${startLine},${endLine == null ? startLine : endLine}:${file}`);\n\t\t\t}\n\t\t}\n\n\t\tif (ref && !GitRevision.isUncommittedStaged(ref)) {\n\t\t\t// If we are reversing, we must add a range (with HEAD) because we are using --ancestry-path for better reverse walking\n\t\t\tif (reverse) {\n\t\t\t\tparams.push('--reverse', '--ancestry-path', `${ref}..HEAD`);\n\t\t\t} else {\n\t\t\t\tparams.push(ref);\n\t\t\t}\n\t\t}\n\n\t\t// Don't specify a file spec when using a line number (so say the git docs)\n\t\tif (startLine == null) {\n\t\t\tparams.push('--', file);\n\t\t}\n\n\t\treturn this.git<string>({ cwd: root, configs: ['-c', 'log.showSignature=false'] }, ...params);\n\t}\n\n\tasync log__file_recent(\n\t\trepoPath: string,\n\t\tfileName: string,\n\t\t{\n\t\t\tordering,\n\t\t\tref,\n\t\t\tsimilarityThreshold,\n\t\t}: { ordering?: string | null; ref?: string; similarityThreshold?: number | null } = {},\n\t) {\n\t\tconst params = [\n\t\t\t'log',\n\t\t\t`-M${similarityThreshold == null ? '' : `${similarityThreshold}%`}`,\n\t\t\t'-n1',\n\t\t\t'--format=%H',\n\t\t];\n\n\t\tif (ordering) {\n\t\t\tparams.push(`--${ordering}-order`);\n\t\t}\n\n\t\tif (ref) {\n\t\t\tparams.push(ref);\n\t\t}\n\n\t\tconst data = await this.git<string>(\n\t\t\t{ cwd: repoPath, configs: ['-c', 'log.showSignature=false'], errors: GitErrorHandling.Ignore },\n\t\t\t...params,\n\t\t\t'--',\n\t\t\tfileName,\n\t\t);\n\t\treturn data.length === 0 ? undefined : data.trim();\n\t}\n\n\tasync log__find_object(repoPath: string, objectId: string, ref: string, ordering: string | null, file?: string) {\n\t\tconst params = ['log', '-n1', '--no-renames', '--format=%H', `--find-object=${objectId}`, ref];\n\n\t\tif (ordering) {\n\t\t\tparams.push(`--${ordering}-order`);\n\t\t}\n\n\t\tif (file) {\n\t\t\tparams.push('--', file);\n\t\t}\n\n\t\tconst data = await this.git<string>(\n\t\t\t{ cwd: repoPath, configs: ['-c', 'log.showSignature=false'], errors: GitErrorHandling.Ignore },\n\t\t\t...params,\n\t\t);\n\t\treturn data.length === 0 ? undefined : data.trim();\n\t}\n\n\tasync log__recent(repoPath: string, ordering?: string | null) {\n\t\tconst params = ['log', '-n1', '--format=%H'];\n\n\t\tif (ordering) {\n\t\t\tparams.push(`--${ordering}-order`);\n\t\t}\n\n\t\tconst data = await this.git<string>(\n\t\t\t{ cwd: repoPath, configs: ['-c', 'log.showSignature=false'], errors: GitErrorHandling.Ignore },\n\t\t\t...params,\n\t\t\t'--',\n\t\t);\n\n\t\treturn data.length === 0 ? undefined : data.trim();\n\t}\n\n\tasync log__recent_committerdate(repoPath: string, ordering?: string | null) {\n\t\tconst params = ['log', '-n1', '--format=%ct'];\n\n\t\tif (ordering) {\n\t\t\tparams.push(`--${ordering}-order`);\n\t\t}\n\n\t\tconst data = await this.git<string>(\n\t\t\t{ cwd: repoPath, configs: ['-c', 'log.showSignature=false'], errors: GitErrorHandling.Ignore },\n\t\t\t...params,\n\t\t\t'--',\n\t\t);\n\n\t\treturn data.length === 0 ? undefined : data.trim();\n\t}\n\n\tlog__search(\n\t\trepoPath: string,\n\t\tsearch: string[] = emptyArray,\n\t\t{\n\t\t\tlimit,\n\t\t\tordering,\n\t\t\tskip,\n\t\t\tuseShow,\n\t\t}: { limit?: number; ordering?: string | null; skip?: number; useShow?: boolean } = {},\n\t) {\n\t\tconst params = [\n\t\t\tuseShow ? 'show' : 'log',\n\t\t\t'--name-status',\n\t\t\t`--format=${GitLogParser.defaultFormat}`,\n\t\t\t'--use-mailmap',\n\t\t];\n\n\t\tif (limit && !useShow) {\n\t\t\tparams.push(`-n${limit + 1}`);\n\t\t}\n\n\t\tif (skip && !useShow) {\n\t\t\tparams.push(`--skip=${skip}`);\n\t\t}\n\n\t\tif (ordering && !useShow) {\n\t\t\tparams.push(`--${ordering}-order`);\n\t\t}\n\n\t\treturn this.git<string>(\n\t\t\t{ cwd: repoPath, configs: useShow ? undefined : ['-c', 'log.showSignature=false'] },\n\t\t\t...params,\n\t\t\t...search,\n\t\t);\n\t}\n\n\t//  log__shortstat(repoPath: string, options: { ref?: string }) {\n\t//     const params = ['log', '--shortstat', '--oneline'];\n\t//     if (options.ref && !GitRevision.isUncommittedStaged(options.ref)) {\n\t//         params.push(options.ref);\n\t//     }\n\t//     return this.git<string>({ cwd: repoPath, configs: ['-c', 'log.showSignature=false'] }, ...params, '--');\n\t// }\n\n\tasync ls_files(\n\t\trepoPath: string,\n\t\tfileName: string,\n\t\t{ ref, untracked }: { ref?: string; untracked?: boolean } = {},\n\t): Promise<string | undefined> {\n\t\tconst params = ['ls-files'];\n\t\tif (ref && !GitRevision.isUncommitted(ref)) {\n\t\t\tparams.push(`--with-tree=${ref}`);\n\t\t}\n\n\t\tif (!ref && untracked) {\n\t\t\tparams.push('-o');\n\t\t}\n\n\t\tconst data = await this.git<string>(\n\t\t\t{ cwd: repoPath, errors: GitErrorHandling.Ignore },\n\t\t\t...params,\n\t\t\t'--',\n\t\t\tfileName,\n\t\t);\n\t\treturn data.length === 0 ? undefined : data.trim();\n\t}\n\n\tls_remote(repoPath: string, remote: string, ref?: string) {\n\t\treturn this.git<string>({ cwd: repoPath }, 'ls-remote', remote, ref);\n\t}\n\n\tls_remote__HEAD(repoPath: string, remote: string) {\n\t\treturn this.git<string>({ cwd: repoPath }, 'ls-remote', '--symref', remote, 'HEAD');\n\t}\n\n\tasync ls_tree(repoPath: string, ref: string, path?: string) {\n\t\tconst params = ['ls-tree'];\n\t\tif (path) {\n\t\t\tparams.push('-l', ref, '--', path);\n\t\t} else {\n\t\t\tparams.push('-lrt', ref, '--');\n\t\t}\n\t\tconst data = await this.git<string>({ cwd: repoPath, errors: GitErrorHandling.Ignore }, ...params);\n\t\treturn data.length === 0 ? undefined : data.trim();\n\t}\n\n\tmerge_base(repoPath: string, ref1: string, ref2: string, options?: { forkPoint?: boolean }) {\n\t\tconst params = ['merge-base'];\n\t\tif (options?.forkPoint) {\n\t\t\tparams.push('--fork-point');\n\t\t}\n\n\t\treturn this.git<string>({ cwd: repoPath }, ...params, ref1, ref2);\n\t}\n\n\tasync merge_base__is_ancestor(repoPath: string, ref1: string, ref2: string): Promise<boolean> {\n\t\tconst params = ['merge-base', '--is-ancestor'];\n\t\tconst exitCode = await this.git({ cwd: repoPath, exitCodeOnly: true }, ...params, ref1, ref2);\n\t\treturn exitCode === 0;\n\t}\n\n\treflog(\n\t\trepoPath: string,\n\t\t{\n\t\t\tall,\n\t\t\tbranch,\n\t\t\tlimit,\n\t\t\tordering,\n\t\t\tskip,\n\t\t}: { all?: boolean; branch?: string; limit?: number; ordering?: string | null; skip?: number } = {},\n\t): Promise<string> {\n\t\tconst params = ['log', '--walk-reflogs', `--format=${GitReflogParser.defaultFormat}`, '--date=iso8601'];\n\n\t\tif (ordering) {\n\t\t\tparams.push(`--${ordering}-order`);\n\t\t}\n\n\t\tif (all) {\n\t\t\tparams.push('--all');\n\t\t}\n\n\t\tif (limit) {\n\t\t\tparams.push(`-n${limit}`);\n\t\t}\n\n\t\tif (skip) {\n\t\t\tparams.push(`--skip=${skip}`);\n\t\t}\n\n\t\tif (branch) {\n\t\t\tparams.push(branch);\n\t\t}\n\n\t\treturn this.git<string>({ cwd: repoPath, configs: ['-c', 'log.showSignature=false'] }, ...params, '--');\n\t}\n\n\tremote(repoPath: string): Promise<string> {\n\t\treturn this.git<string>({ cwd: repoPath }, 'remote', '-v');\n\t}\n\n\tremote__add(repoPath: string, name: string, url: string) {\n\t\treturn this.git<string>({ cwd: repoPath }, 'remote', 'add', name, url);\n\t}\n\n\tremote__prune(repoPath: string, remoteName: string) {\n\t\treturn this.git<string>({ cwd: repoPath }, 'remote', 'prune', remoteName);\n\t}\n\n\tremote__get_url(repoPath: string, remote: string): Promise<string> {\n\t\treturn this.git<string>({ cwd: repoPath }, 'remote', 'get-url', remote);\n\t}\n\n\treset(repoPath: string | undefined, fileName: string) {\n\t\treturn this.git<string>({ cwd: repoPath }, 'reset', '-q', '--', fileName);\n\t}\n\n\tasync rev_list__count(repoPath: string, ref: string): Promise<number | undefined> {\n\t\tlet data = await this.git<string>(\n\t\t\t{ cwd: repoPath, errors: GitErrorHandling.Ignore },\n\t\t\t'rev-list',\n\t\t\t'--count',\n\t\t\tref,\n\t\t\t'--',\n\t\t);\n\t\tdata = data.trim();\n\t\tif (data.length === 0) return undefined;\n\n\t\tconst result = parseInt(data, 10);\n\t\treturn isNaN(result) ? undefined : result;\n\t}\n\n\tasync rev_list__left_right(\n\t\trepoPath: string,\n\t\trefs: string[],\n\t): Promise<{ ahead: number; behind: number } | undefined> {\n\t\tconst data = await this.git<string>(\n\t\t\t{ cwd: repoPath, errors: GitErrorHandling.Ignore },\n\t\t\t'rev-list',\n\t\t\t'--left-right',\n\t\t\t'--count',\n\t\t\t...refs,\n\t\t\t'--',\n\t\t);\n\t\tif (data.length === 0) return undefined;\n\n\t\tconst parts = data.split('\\t');\n\t\tif (parts.length !== 2) return undefined;\n\n\t\tconst [ahead, behind] = parts;\n\t\tconst result = {\n\t\t\tahead: parseInt(ahead, 10),\n\t\t\tbehind: parseInt(behind, 10),\n\t\t};\n\n\t\tif (isNaN(result.ahead) || isNaN(result.behind)) return undefined;\n\n\t\treturn result;\n\t}\n\n\tasync rev_parse__currentBranch(\n\t\trepoPath: string,\n\t\tordering: string | null,\n\t): Promise<[string, string | undefined] | undefined> {\n\t\ttry {\n\t\t\tconst data = await this.git<string>(\n\t\t\t\t{ cwd: repoPath, errors: GitErrorHandling.Throw },\n\t\t\t\t'rev-parse',\n\t\t\t\t'--abbrev-ref',\n\t\t\t\t'--symbolic-full-name',\n\t\t\t\t'--end-of-options',\n\t\t\t\t'@',\n\t\t\t\t'@{u}',\n\t\t\t\t'--',\n\t\t\t);\n\t\t\treturn [data, undefined];\n\t\t} catch (ex) {\n\t\t\tconst msg: string = ex?.toString() ?? '';\n\t\t\tif (GitErrors.badRevision.test(msg) || GitWarnings.noUpstream.test(msg)) {\n\t\t\t\tif (ex.stdout != null && ex.stdout.length !== 0) {\n\t\t\t\t\treturn [ex.stdout, undefined];\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tconst data = await this.symbolic_ref(repoPath, 'HEAD');\n\t\t\t\t\tif (data != null) return [data.trim(), undefined];\n\t\t\t\t} catch {}\n\n\t\t\t\ttry {\n\t\t\t\t\tconst data = await this.symbolic_ref(repoPath, 'refs/remotes/origin/HEAD');\n\t\t\t\t\tif (data != null) return [data.trim().substr('origin/'.length), undefined];\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tif (/is not a symbolic ref/.test(ex.stderr)) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst data = await this.ls_remote__HEAD(repoPath, 'origin');\n\t\t\t\t\t\t\tif (data != null) {\n\t\t\t\t\t\t\t\tconst match = /ref:\\s(\\S+)\\s+HEAD/m.exec(data);\n\t\t\t\t\t\t\t\tif (match != null) {\n\t\t\t\t\t\t\t\t\tconst [, branch] = match;\n\t\t\t\t\t\t\t\t\treturn [branch.substr('refs/heads/'.length), undefined];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch {}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst defaultBranch = (await this.config__get('init.defaultBranch', repoPath)) ?? 'main';\n\t\t\t\tconst branchConfig = await this.config__get_regex(`branch\\\\.${defaultBranch}\\\\.+`, repoPath, {\n\t\t\t\t\tlocal: true,\n\t\t\t\t});\n\n\t\t\t\tlet remote;\n\t\t\t\tlet remoteBranch;\n\n\t\t\t\tif (branchConfig) {\n\t\t\t\t\tlet match = /^branch\\..+\\.remote\\s(.+)$/m.exec(branchConfig);\n\t\t\t\t\tif (match != null) {\n\t\t\t\t\t\tremote = match[1];\n\t\t\t\t\t}\n\n\t\t\t\t\tmatch = /^branch\\..+\\.merge\\srefs\\/heads\\/(.+)$/m.exec(branchConfig);\n\t\t\t\t\tif (match != null) {\n\t\t\t\t\t\tremoteBranch = match[1];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn [`${defaultBranch}${remote && remoteBranch ? `\\n${remote}/${remoteBranch}` : ''}`, undefined];\n\t\t\t}\n\n\t\t\tif (GitWarnings.headNotABranch.test(msg)) {\n\t\t\t\tconst sha = await this.log__recent(repoPath, ordering);\n\t\t\t\tif (sha === undefined) return undefined;\n\n\t\t\t\treturn [`(HEAD detached at ${GitRevision.shorten(sha)})`, sha];\n\t\t\t}\n\n\t\t\tdefaultExceptionHandler(ex, repoPath);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tasync rev_parse__git_dir(cwd: string): Promise<string | undefined> {\n\t\tconst data = await this.git<string>({ cwd: cwd, errors: GitErrorHandling.Ignore }, 'rev-parse', '--git-dir');\n\t\t// Make sure to normalize: https://github.com/git-for-windows/git/issues/2478\n\t\t// Keep trailing spaces which are part of the directory name\n\t\treturn data.length === 0 ? undefined : normalizePath(data.trimLeft().replace(/[\\r|\\n]+$/, ''));\n\t}\n\n\tasync rev_parse__show_toplevel(cwd: string): Promise<string | undefined> {\n\t\ttry {\n\t\t\tconst data = await this.git<string>(\n\t\t\t\t{ cwd: cwd, errors: GitErrorHandling.Throw },\n\t\t\t\t'rev-parse',\n\t\t\t\t'--show-toplevel',\n\t\t\t);\n\t\t\t// Make sure to normalize: https://github.com/git-for-windows/git/issues/2478\n\t\t\t// Keep trailing spaces which are part of the directory name\n\t\t\treturn data.length === 0 ? undefined : normalizePath(data.trimLeft().replace(/[\\r|\\n]+$/, ''));\n\t\t} catch (ex) {\n\t\t\tconst inDotGit = /this operation must be run in a work tree/.test(ex.stderr);\n\t\t\tif (inDotGit || ex.code === 'ENOENT') {\n\t\t\t\t// If the `cwd` doesn't exist, walk backward to see if any parent folder exists\n\t\t\t\tlet exists = inDotGit ? false : await fsExists(cwd);\n\t\t\t\tif (!exists) {\n\t\t\t\t\tdo {\n\t\t\t\t\t\tconst parent = dirname(cwd);\n\t\t\t\t\t\tif (parent === cwd || parent.length === 0) return undefined;\n\n\t\t\t\t\t\tcwd = parent;\n\t\t\t\t\t\texists = await fsExists(cwd);\n\t\t\t\t\t} while (!exists);\n\n\t\t\t\t\treturn this.rev_parse__show_toplevel(cwd);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tasync rev_parse__verify(repoPath: string, ref: string, fileName?: string): Promise<string | undefined> {\n\t\tconst data = await this.git<string>(\n\t\t\t{ cwd: repoPath, errors: GitErrorHandling.Ignore },\n\t\t\t'rev-parse',\n\t\t\t'--verify',\n\t\t\t'--end-of-options',\n\t\t\tfileName ? `${ref}:./${fileName}` : `${ref}^{commit}`,\n\t\t);\n\t\treturn data.length === 0 ? undefined : data.trim();\n\t}\n\n\tasync show<TOut extends string | Buffer>(\n\t\trepoPath: string | undefined,\n\t\tfileName: string,\n\t\tref: string,\n\t\toptions: {\n\t\t\tencoding?: 'binary' | 'ascii' | 'utf8' | 'utf16le' | 'ucs2' | 'base64' | 'latin1' | 'hex' | 'buffer';\n\t\t} = {},\n\t): Promise<TOut | undefined> {\n\t\tconst [file, root] = splitPath(fileName, repoPath, true);\n\n\t\tif (GitRevision.isUncommittedStaged(ref)) {\n\t\t\tref = ':';\n\t\t}\n\t\tif (GitRevision.isUncommitted(ref)) throw new Error(`ref=${ref} is uncommitted`);\n\n\t\tconst opts: GitCommandOptions = {\n\t\t\tconfigs: ['-c', 'log.showSignature=false'],\n\t\t\tcwd: root,\n\t\t\tencoding: options.encoding ?? 'utf8',\n\t\t\terrors: GitErrorHandling.Throw,\n\t\t};\n\t\tconst args = ref.endsWith(':') ? `${ref}./${file}` : `${ref}:./${file}`;\n\n\t\ttry {\n\t\t\tconst data = await this.git<TOut>(opts, 'show', '--textconv', args, '--');\n\t\t\treturn data;\n\t\t} catch (ex) {\n\t\t\tconst msg: string = ex?.toString() ?? '';\n\t\t\tif (ref === ':' && GitErrors.badRevision.test(msg)) {\n\t\t\t\treturn this.show<TOut>(repoPath, fileName, 'HEAD:', options);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tGitErrors.badRevision.test(msg) ||\n\t\t\t\tGitWarnings.notFound.test(msg) ||\n\t\t\t\tGitWarnings.foundButNotInRevision.test(msg)\n\t\t\t) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn defaultExceptionHandler(ex, opts.cwd) as TOut;\n\t\t}\n\t}\n\n\tshow__diff(\n\t\trepoPath: string,\n\t\tfileName: string,\n\t\tref: string,\n\t\toriginalFileName?: string,\n\t\t{ similarityThreshold }: { similarityThreshold?: number | null } = {},\n\t) {\n\t\tconst params = [\n\t\t\t'show',\n\t\t\t`-M${similarityThreshold == null ? '' : `${similarityThreshold}%`}`,\n\t\t\t'--format=',\n\t\t\t'--minimal',\n\t\t\t'-U0',\n\t\t\tref,\n\t\t\t'--',\n\t\t\tfileName,\n\t\t];\n\t\tif (originalFileName != null && originalFileName.length !== 0) {\n\t\t\tparams.push(originalFileName);\n\t\t}\n\n\t\treturn this.git<string>({ cwd: repoPath }, ...params);\n\t}\n\n\tshow__name_status(repoPath: string, fileName: string, ref: string) {\n\t\treturn this.git<string>({ cwd: repoPath }, 'show', '--name-status', '--format=', ref, '--', fileName);\n\t}\n\n\tshow_ref__tags(repoPath: string) {\n\t\treturn this.git<string>({ cwd: repoPath, errors: GitErrorHandling.Ignore }, 'show-ref', '--tags');\n\t}\n\n\tstash__apply(repoPath: string, stashName: string, deleteAfter: boolean): Promise<string | undefined> {\n\t\tif (!stashName) return Promise.resolve(undefined);\n\t\treturn this.git<string>({ cwd: repoPath }, 'stash', deleteAfter ? 'pop' : 'apply', stashName);\n\t}\n\n\tasync stash__delete(repoPath: string, stashName: string, ref?: string) {\n\t\tif (!stashName) return undefined;\n\n\t\tif (ref) {\n\t\t\tconst stashRef = await this.git<string>(\n\t\t\t\t{ cwd: repoPath, errors: GitErrorHandling.Ignore },\n\t\t\t\t'show',\n\t\t\t\t'--format=%H',\n\t\t\t\t'--no-patch',\n\t\t\t\tstashName,\n\t\t\t);\n\t\t\tif (stashRef?.trim() !== ref) {\n\t\t\t\tthrow new Error('Unable to delete stash; mismatch with stash number');\n\t\t\t}\n\t\t}\n\n\t\treturn this.git<string>({ cwd: repoPath }, 'stash', 'drop', stashName);\n\t}\n\n\tstash__list(\n\t\trepoPath: string,\n\t\t{\n\t\t\tformat = GitStashParser.defaultFormat,\n\t\t\tsimilarityThreshold,\n\t\t}: { format?: string; similarityThreshold?: number | null } = {},\n\t) {\n\t\treturn this.git<string>(\n\t\t\t{ cwd: repoPath },\n\t\t\t'stash',\n\t\t\t'list',\n\t\t\t'--name-status',\n\t\t\t`-M${similarityThreshold == null ? '' : `${similarityThreshold}%`}`,\n\t\t\t`--format=${format}`,\n\t\t);\n\t}\n\n\tasync stash__push(\n\t\trepoPath: string,\n\t\tmessage?: string,\n\t\t{\n\t\t\tincludeUntracked,\n\t\t\tkeepIndex,\n\t\t\tpathspecs,\n\t\t\tstdin,\n\t\t}: { includeUntracked?: boolean; keepIndex?: boolean; pathspecs?: string[]; stdin?: boolean } = {},\n\t): Promise<void> {\n\t\tconst params = ['stash', 'push'];\n\n\t\tif (includeUntracked || (pathspecs != null && pathspecs.length !== 0)) {\n\t\t\tparams.push('-u');\n\t\t}\n\n\t\tif (keepIndex) {\n\t\t\tparams.push('-k');\n\t\t}\n\n\t\tif (message) {\n\t\t\tparams.push('-m', message);\n\t\t}\n\n\t\tif (stdin && pathspecs != null && pathspecs.length !== 0) {\n\t\t\tvoid (await this.git<string>(\n\t\t\t\t{ cwd: repoPath, stdin: pathspecs.join('\\0') },\n\t\t\t\t...params,\n\t\t\t\t'--pathspec-from-file=-',\n\t\t\t\t'--pathspec-file-nul',\n\t\t\t));\n\n\t\t\treturn;\n\t\t}\n\n\t\tparams.push('--');\n\t\tif (pathspecs != null && pathspecs.length !== 0) {\n\t\t\tparams.push(...pathspecs);\n\t\t}\n\n\t\tvoid (await this.git<string>({ cwd: repoPath }, ...params));\n\t}\n\n\tasync status(\n\t\trepoPath: string,\n\t\tporcelainVersion: number = 1,\n\t\t{ similarityThreshold }: { similarityThreshold?: number | null } = {},\n\t): Promise<string> {\n\t\tconst params = [\n\t\t\t'status',\n\t\t\tporcelainVersion >= 2 ? `--porcelain=v${porcelainVersion}` : '--porcelain',\n\t\t\t'--branch',\n\t\t\t'-u',\n\t\t];\n\t\tif (await this.isAtLeastVersion('2.18')) {\n\t\t\tparams.push(`--find-renames${similarityThreshold == null ? '' : `=${similarityThreshold}%`}`);\n\t\t}\n\n\t\treturn this.git<string>(\n\t\t\t{ cwd: repoPath, configs: ['-c', 'color.status=false'], env: { GIT_OPTIONAL_LOCKS: '0' } },\n\t\t\t...params,\n\t\t\t'--',\n\t\t);\n\t}\n\n\tasync status__file(\n\t\trepoPath: string,\n\t\tfileName: string,\n\t\tporcelainVersion: number = 1,\n\t\t{ similarityThreshold }: { similarityThreshold?: number | null } = {},\n\t): Promise<string> {\n\t\tconst [file, root] = splitPath(fileName, repoPath, true);\n\n\t\tconst params = ['status', porcelainVersion >= 2 ? `--porcelain=v${porcelainVersion}` : '--porcelain'];\n\t\tif (await this.isAtLeastVersion('2.18')) {\n\t\t\tparams.push(`--find-renames${similarityThreshold == null ? '' : `=${similarityThreshold}%`}`);\n\t\t}\n\n\t\treturn this.git<string>(\n\t\t\t{ cwd: root, configs: ['-c', 'color.status=false'], env: { GIT_OPTIONAL_LOCKS: '0' } },\n\t\t\t...params,\n\t\t\t'--',\n\t\t\tfile,\n\t\t);\n\t}\n\n\tsymbolic_ref(repoPath: string, ref: string) {\n\t\treturn this.git<string>({ cwd: repoPath }, 'symbolic-ref', '--short', ref);\n\t}\n\n\ttag(repoPath: string) {\n\t\treturn this.git<string>({ cwd: repoPath }, 'tag', '-l', `--format=${GitTagParser.defaultFormat}`);\n\t}\n\n\tworktree__add(\n\t\trepoPath: string,\n\t\tpath: string,\n\t\t{\n\t\t\tcommitish,\n\t\t\tcreateBranch,\n\t\t\tdetach,\n\t\t\tforce,\n\t\t}: { commitish?: string; createBranch?: string; detach?: boolean; force?: boolean } = {},\n\t) {\n\t\tconst params = ['worktree', 'add'];\n\t\tif (force) {\n\t\t\tparams.push('--force');\n\t\t}\n\t\tif (createBranch) {\n\t\t\tparams.push('-b', createBranch);\n\t\t}\n\t\tif (detach) {\n\t\t\tparams.push('--detach');\n\t\t}\n\t\tparams.push(path);\n\t\tif (commitish) {\n\t\t\tparams.push(commitish);\n\t\t}\n\t\treturn this.git<string>({ cwd: repoPath }, ...params);\n\t}\n\n\tworktree__list(repoPath: string) {\n\t\treturn this.git<string>({ cwd: repoPath }, 'worktree', 'list', '--porcelain');\n\t}\n\n\tworktree__remove(repoPath: string, worktree: string, { force }: { force?: boolean } = {}) {\n\t\tconst params = ['worktree', 'remove'];\n\t\tif (force) {\n\t\t\tparams.push('--force');\n\t\t}\n\t\tparams.push(worktree);\n\n\t\treturn this.git<string>({ cwd: repoPath, errors: GitErrorHandling.Throw }, ...params);\n\t}\n\n\tasync readDotGitFile(\n\t\trepoPath: string,\n\t\tpaths: string[],\n\t\toptions?: { numeric?: false; throw?: boolean; trim?: boolean },\n\t): Promise<string | undefined>;\n\tasync readDotGitFile(\n\t\trepoPath: string,\n\t\tpath: string[],\n\t\toptions?: { numeric: true; throw?: boolean; trim?: boolean },\n\t): Promise<number | undefined>;\n\tasync readDotGitFile(\n\t\trepoPath: string,\n\t\tpathParts: string[],\n\t\toptions?: { numeric?: boolean; throw?: boolean; trim?: boolean },\n\t): Promise<string | number | undefined> {\n\t\ttry {\n\t\t\tconst bytes = await workspace.fs.readFile(Uri.file(joinPaths(repoPath, '.git', ...pathParts)));\n\t\t\tlet contents = textDecoder.decode(bytes);\n\t\t\tcontents = options?.trim ?? true ? contents.trim() : contents;\n\n\t\t\tif (options?.numeric) {\n\t\t\t\tconst number = Number.parseInt(contents, 10);\n\t\t\t\treturn isNaN(number) ? undefined : number;\n\t\t\t}\n\n\t\t\treturn contents;\n\t\t} catch (ex) {\n\t\t\tif (options?.throw) throw ex;\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"os\");","import { join as joinPaths } from 'path';\nimport { GlyphChars } from '../../../constants';\nimport { LogLevel } from '../../../logger';\nimport { any } from '../../../system/promise';\nimport { Stopwatch } from '../../../system/stopwatch';\nimport { findExecutable, run } from './shell';\n\nexport class UnableToFindGitError extends Error {\n\tconstructor(public readonly original?: Error) {\n\t\tsuper('Unable to find git');\n\n\t\tError.captureStackTrace?.(this, UnableToFindGitError);\n\t}\n}\n\nexport class InvalidGitConfigError extends Error {\n\tconstructor(public readonly original: Error) {\n\t\tsuper('Invalid Git configuration');\n\n\t\tError.captureStackTrace?.(this, InvalidGitConfigError);\n\t}\n}\n\nexport interface GitLocation {\n\tpath: string;\n\tversion: string;\n}\n\nfunction parseVersion(raw: string): string {\n\treturn raw?.replace(/^git version /, '');\n}\n\nasync function findSpecificGit(path: string): Promise<GitLocation> {\n\tconst sw = new Stopwatch(`findSpecificGit(${path})`, { logLevel: LogLevel.Debug });\n\n\tlet version;\n\ttry {\n\t\tversion = await run<string>(path, ['--version'], 'utf8');\n\t} catch (ex) {\n\t\tsw.stop({ message: ` ${GlyphChars.Dot} Unable to find git` });\n\n\t\tif (/bad config/i.test(ex.message)) throw new InvalidGitConfigError(ex);\n\t\tthrow ex;\n\t}\n\n\t// If needed, let's update our path to avoid the search on every command\n\tif (!path || path === 'git') {\n\t\tconst foundPath = findExecutable(path, ['--version']).cmd;\n\n\t\t// Ensure that the path we found works\n\t\ttry {\n\t\t\tversion = await run<string>(foundPath, ['--version'], 'utf8');\n\t\t} catch (ex) {\n\t\t\tsw.stop({ message: ` ${GlyphChars.Dot} Unable to find git` });\n\n\t\t\tif (/bad config/i.test(ex.message)) throw new InvalidGitConfigError(ex);\n\t\t\tthrow ex;\n\t\t}\n\n\t\tpath = foundPath;\n\t}\n\n\tsw.stop({ message: ` ${GlyphChars.Dot} Found git @ ${path}` });\n\n\treturn {\n\t\tpath: path,\n\t\tversion: parseVersion(version.trim()),\n\t};\n}\n\nasync function findGitDarwin(): Promise<GitLocation> {\n\ttry {\n\t\tconst path = (await run<string>('which', ['git'], 'utf8')).trim();\n\t\tif (path !== '/usr/bin/git') return findSpecificGit(path);\n\n\t\ttry {\n\t\t\tawait run<string>('xcode-select', ['-p'], 'utf8');\n\t\t\treturn findSpecificGit(path);\n\t\t} catch (ex) {\n\t\t\tif (ex.code === 2) {\n\t\t\t\treturn Promise.reject(new UnableToFindGitError(ex));\n\t\t\t}\n\t\t\treturn findSpecificGit(path);\n\t\t}\n\t} catch (ex) {\n\t\treturn Promise.reject(\n\t\t\tex instanceof InvalidGitConfigError || ex instanceof UnableToFindGitError\n\t\t\t\t? ex\n\t\t\t\t: new UnableToFindGitError(ex),\n\t\t);\n\t}\n}\n\nfunction findSystemGitWin32(basePath: string | null | undefined): Promise<GitLocation> {\n\tif (basePath == null || basePath.length === 0) return Promise.reject(new UnableToFindGitError());\n\treturn findSpecificGit(joinPaths(basePath, 'Git', 'cmd', 'git.exe'));\n}\n\nfunction findGitWin32(): Promise<GitLocation> {\n\treturn findSystemGitWin32(process.env['ProgramW6432'])\n\t\t.then(null, () => findSystemGitWin32(process.env['ProgramFiles(x86)']))\n\t\t.then(null, () => findSystemGitWin32(process.env['ProgramFiles']))\n\t\t.then(null, () => findSpecificGit('git'));\n}\n\nexport async function findGitPath(\n\tpaths: string | string[] | null | undefined,\n\tsearch: boolean = true,\n): Promise<GitLocation> {\n\ttry {\n\t\tif (paths == null || typeof paths === 'string') {\n\t\t\treturn await findSpecificGit(paths ?? 'git');\n\t\t}\n\n\t\ttry {\n\t\t\treturn any(...paths.map(p => findSpecificGit(p)));\n\t\t} catch (ex) {\n\t\t\tthrow new UnableToFindGitError(ex);\n\t\t}\n\t} catch (ex) {\n\t\tif (!search) {\n\t\t\treturn Promise.reject(\n\t\t\t\tex instanceof InvalidGitConfigError || ex instanceof UnableToFindGitError\n\t\t\t\t\t? ex\n\t\t\t\t\t: new UnableToFindGitError(ex),\n\t\t\t);\n\t\t}\n\n\t\ttry {\n\t\t\tswitch (process.platform) {\n\t\t\t\tcase 'darwin':\n\t\t\t\t\treturn await findGitDarwin();\n\t\t\t\tcase 'win32':\n\t\t\t\t\treturn await findGitWin32();\n\t\t\t\tdefault:\n\t\t\t\t\treturn Promise.reject(new UnableToFindGitError());\n\t\t\t}\n\t\t} catch (ex) {\n\t\t\treturn Promise.reject(\n\t\t\t\tex instanceof InvalidGitConfigError || ex instanceof UnableToFindGitError\n\t\t\t\t\t? ex\n\t\t\t\t\t: new UnableToFindGitError(ex),\n\t\t\t);\n\t\t}\n\t}\n}\n","import { readdir, realpath } from 'fs';\nimport { homedir, hostname, userInfo } from 'os';\nimport { resolve as resolvePath } from 'path';\nimport {\n\tDisposable,\n\tenv,\n\tEvent,\n\tEventEmitter,\n\textensions,\n\tFileType,\n\tRange,\n\tTextDocument,\n\tUri,\n\twindow,\n\tworkspace,\n\tWorkspaceFolder,\n} from 'vscode';\nimport { fetch } from '@env/fetch';\nimport { hrtime } from '@env/hrtime';\nimport { isLinux, isWindows } from '@env/platform';\nimport type {\n\tAPI as BuiltInGitApi,\n\tRepository as BuiltInGitRepository,\n\tGitExtension,\n} from '../../../@types/vscode.git';\nimport { configuration } from '../../../configuration';\nimport { CoreGitConfiguration, GlyphChars, Schemes } from '../../../constants';\nimport type { Container } from '../../../container';\nimport { Features, PremiumFeatures } from '../../../features';\nimport {\n\tStashApplyError,\n\tStashApplyErrorReason,\n\tWorktreeCreateError,\n\tWorktreeCreateErrorReason,\n\tWorktreeDeleteError,\n\tWorktreeDeleteErrorReason,\n} from '../../../git/errors';\nimport {\n\tGitProvider,\n\tGitProviderDescriptor,\n\tGitProviderId,\n\tNextComparisionUrisResult,\n\tPagedResult,\n\tPreviousComparisionUrisResult,\n\tPreviousLineComparisionUrisResult,\n\tRepositoryCloseEvent,\n\tRepositoryInitWatcher,\n\tRepositoryOpenEvent,\n\tRepositoryVisibility,\n\tRevisionUriData,\n\tScmRepository,\n} from '../../../git/gitProvider';\nimport { GitProviderService } from '../../../git/gitProviderService';\nimport { encodeGitLensRevisionUriAuthority, GitUri } from '../../../git/gitUri';\nimport {\n\tBranchSortOptions,\n\tGitBlame,\n\tGitBlameAuthor,\n\tGitBlameLine,\n\tGitBlameLines,\n\tGitBranch,\n\tGitBranchReference,\n\tGitCommit,\n\tGitContributor,\n\tGitDiff,\n\tGitDiffFilter,\n\tGitDiffHunkLine,\n\tGitDiffShortStat,\n\tGitFile,\n\tGitLog,\n\tGitMergeStatus,\n\tGitRebaseStatus,\n\tGitReference,\n\tGitReflog,\n\tGitRemote,\n\tGitRevision,\n\tGitStash,\n\tGitStatus,\n\tGitStatusFile,\n\tGitTag,\n\tGitTreeEntry,\n\tGitUser,\n\tGitWorktree,\n\tisUserMatch,\n\tRepository,\n\tRepositoryChange,\n\tRepositoryChangeComparisonMode,\n\tRepositoryChangeEvent,\n\tTagSortOptions,\n} from '../../../git/models';\nimport {\n\tGitBlameParser,\n\tGitBranchParser,\n\tGitDiffParser,\n\tGitLogParser,\n\tGitReflogParser,\n\tGitRemoteParser,\n\tGitStashParser,\n\tGitStatusParser,\n\tGitTagParser,\n\tGitTreeParser,\n\tGitWorktreeParser,\n\tLogType,\n} from '../../../git/parsers';\nimport { RemoteProviderFactory, RemoteProviders } from '../../../git/remotes/factory';\nimport { RemoteProvider, RemoteResourceType, RichRemoteProvider } from '../../../git/remotes/provider';\nimport { SearchPattern } from '../../../git/search';\nimport { LogCorrelationContext, Logger } from '../../../logger';\nimport { Messages } from '../../../messages';\nimport { WorkspaceStorageKeys } from '../../../storage';\nimport { SubscriptionPlanId } from '../../../subscription';\nimport { countStringLength, filterMap } from '../../../system/array';\nimport { gate } from '../../../system/decorators/gate';\nimport { debug, log } from '../../../system/decorators/log';\nimport { filterMap as filterMapIterable, find, first, last, some } from '../../../system/iterable';\nimport {\n\tdirname,\n\tgetBestPath,\n\tisAbsolute,\n\tisFolderGlob,\n\tjoinPaths,\n\tmaybeUri,\n\tnormalizePath,\n\trelative,\n\tsplitPath,\n} from '../../../system/path';\nimport { any, PromiseOrValue, wait } from '../../../system/promise';\nimport { equalsIgnoreCase, getDurationMilliseconds, md5, splitSingle } from '../../../system/string';\nimport { PathTrie } from '../../../system/trie';\nimport { compare, fromString } from '../../../system/version';\nimport {\n\tCachedBlame,\n\tCachedDiff,\n\tCachedLog,\n\tGitDocumentState,\n\tTrackedDocument,\n} from '../../../trackers/gitDocumentTracker';\nimport { Git, GitErrors, maxGitCliLength } from './git';\nimport { findGitPath, GitLocation, InvalidGitConfigError, UnableToFindGitError } from './locator';\nimport { fsExists, RunError } from './shell';\n\nconst emptyPromise: Promise<GitBlame | GitDiff | GitLog | undefined> = Promise.resolve(undefined);\nconst emptyPagedResult: PagedResult<any> = Object.freeze({ values: [] });\nconst slash = 47;\n\nconst RepoSearchWarnings = {\n\tdoesNotExist: /no such file or directory/i,\n};\n\nconst doubleQuoteRegex = /\"/g;\nconst driveLetterRegex = /(?<=^\\/?)([a-zA-Z])(?=:\\/)/;\nconst userConfigRegex = /^user\\.(name|email) (.*)$/gm;\nconst mappedAuthorRegex = /(.+)\\s<(.+)>/;\n\nconst reflogCommands = ['merge', 'pull'];\n\ninterface RepositoryInfo {\n\tgitDir?: string;\n\tuser?: GitUser | null;\n}\n\nexport class LocalGitProvider implements GitProvider, Disposable {\n\treadonly descriptor: GitProviderDescriptor = { id: GitProviderId.Git, name: 'Git' };\n\treadonly supportedSchemes: Set<string> = new Set([\n\t\tSchemes.File,\n\t\tSchemes.Git,\n\t\tSchemes.GitLens,\n\t\tSchemes.PRs,\n\t\t// DocumentSchemes.Vsls,\n\t]);\n\n\tprivate _onDidChangeRepository = new EventEmitter<RepositoryChangeEvent>();\n\tget onDidChangeRepository(): Event<RepositoryChangeEvent> {\n\t\treturn this._onDidChangeRepository.event;\n\t}\n\n\tprivate _onDidCloseRepository = new EventEmitter<RepositoryCloseEvent>();\n\tget onDidCloseRepository(): Event<RepositoryCloseEvent> {\n\t\treturn this._onDidCloseRepository.event;\n\t}\n\n\tprivate _onDidOpenRepository = new EventEmitter<RepositoryOpenEvent>();\n\tget onDidOpenRepository(): Event<RepositoryOpenEvent> {\n\t\treturn this._onDidOpenRepository.event;\n\t}\n\n\tprivate readonly _branchesCache = new Map<string, Promise<PagedResult<GitBranch>>>();\n\tprivate readonly _contributorsCache = new Map<string, Promise<GitContributor[]>>();\n\tprivate readonly _mergeStatusCache = new Map<string, GitMergeStatus | null>();\n\tprivate readonly _rebaseStatusCache = new Map<string, GitRebaseStatus | null>();\n\tprivate readonly _repoInfoCache = new Map<string, RepositoryInfo>();\n\tprivate readonly _stashesCache = new Map<string, GitStash | null>();\n\tprivate readonly _tagsCache = new Map<string, Promise<PagedResult<GitTag>>>();\n\tprivate readonly _trackedPaths = new PathTrie<PromiseOrValue<[string, string] | undefined>>();\n\n\tprivate _disposables: Disposable[] = [];\n\n\tconstructor(protected readonly container: Container, protected readonly git: Git) {\n\t\tthis.git.setLocator(this.ensureGit.bind(this));\n\t}\n\n\tdispose() {\n\t\tDisposable.from(...this._disposables).dispose();\n\t}\n\n\tprivate get useCaching() {\n\t\treturn this.container.config.advanced.caching.enabled;\n\t}\n\n\tprivate onRepositoryChanged(repo: Repository, e: RepositoryChangeEvent) {\n\t\tif (e.changed(RepositoryChange.Config, RepositoryChangeComparisonMode.Any)) {\n\t\t\tthis._repoInfoCache.delete(repo.path);\n\t\t}\n\n\t\tif (e.changed(RepositoryChange.Heads, RepositoryChange.Remotes, RepositoryChangeComparisonMode.Any)) {\n\t\t\tthis._branchesCache.delete(repo.path);\n\t\t\tthis._contributorsCache.delete(repo.path);\n\t\t\tthis._contributorsCache.delete(`stats|${repo.path}`);\n\t\t}\n\n\t\tif (e.changed(RepositoryChange.Index, RepositoryChange.Unknown, RepositoryChangeComparisonMode.Any)) {\n\t\t\tthis._trackedPaths.clear();\n\t\t}\n\n\t\tif (e.changed(RepositoryChange.Merge, RepositoryChangeComparisonMode.Any)) {\n\t\t\tthis._mergeStatusCache.delete(repo.path);\n\t\t}\n\n\t\tif (e.changed(RepositoryChange.Rebase, RepositoryChangeComparisonMode.Any)) {\n\t\t\tthis._rebaseStatusCache.delete(repo.path);\n\t\t}\n\n\t\tif (e.changed(RepositoryChange.Stash, RepositoryChangeComparisonMode.Any)) {\n\t\t\tthis._stashesCache.delete(repo.path);\n\t\t}\n\n\t\tif (e.changed(RepositoryChange.Tags, RepositoryChangeComparisonMode.Any)) {\n\t\t\tthis._tagsCache.delete(repo.path);\n\t\t}\n\n\t\tthis._onDidChangeRepository.fire(e);\n\t}\n\n\tprivate _gitLocator: Promise<GitLocation> | undefined;\n\tprivate async ensureGit(): Promise<GitLocation> {\n\t\tif (this._gitLocator == null) {\n\t\t\tthis._gitLocator = this.findGit();\n\t\t}\n\n\t\treturn this._gitLocator;\n\t}\n\n\t@log()\n\tprivate async findGit(): Promise<GitLocation> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tif (!configuration.getAny<boolean>('git.enabled', null, true)) {\n\t\t\tLogger.log(cc, 'Built-in Git is disabled (\"git.enabled\": false)');\n\t\t\tvoid Messages.showGitDisabledErrorMessage();\n\n\t\t\tthrow new UnableToFindGitError();\n\t\t}\n\n\t\tconst scmGitPromise = this.getScmGitApi();\n\n\t\tasync function subscribeToScmOpenCloseRepository(this: LocalGitProvider) {\n\t\t\tconst scmGit = await scmGitPromise;\n\t\t\tif (scmGit == null) return;\n\n\t\t\tthis._disposables.push(\n\t\t\t\tscmGit.onDidCloseRepository(e => this._onDidCloseRepository.fire({ uri: e.rootUri })),\n\t\t\t\tscmGit.onDidOpenRepository(e => this._onDidOpenRepository.fire({ uri: e.rootUri })),\n\t\t\t);\n\n\t\t\tfor (const scmRepository of scmGit.repositories) {\n\t\t\t\tthis._onDidOpenRepository.fire({ uri: scmRepository.rootUri });\n\t\t\t}\n\t\t}\n\t\tvoid subscribeToScmOpenCloseRepository.call(this);\n\n\t\tconst potentialGitPaths =\n\t\t\tconfiguration.getAny<string | string[]>('git.path') ??\n\t\t\tthis.container.storage.getWorkspace(WorkspaceStorageKeys.GitPath, undefined);\n\n\t\tconst start = hrtime();\n\n\t\tconst findGitPromise = findGitPath(potentialGitPaths);\n\t\t// Try to use the same git as the built-in vscode git extension, but don't wait for it if we find something faster\n\t\tconst findGitFromSCMPromise = scmGitPromise.then(gitApi => {\n\t\t\tconst path = gitApi?.git.path;\n\t\t\tif (!path) return findGitPromise;\n\n\t\t\tif (potentialGitPaths != null) {\n\t\t\t\tif (typeof potentialGitPaths === 'string') {\n\t\t\t\t\tif (path === potentialGitPaths) return findGitPromise;\n\t\t\t\t} else if (potentialGitPaths.includes(path)) {\n\t\t\t\t\treturn findGitPromise;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn findGitPath(path, false);\n\t\t});\n\n\t\tconst location = await any<GitLocation>(findGitPromise, findGitFromSCMPromise);\n\t\t// Save the found git path, but let things settle first to not impact startup performance\n\t\tsetTimeout(() => {\n\t\t\tvoid this.container.storage.storeWorkspace(WorkspaceStorageKeys.GitPath, location.path);\n\t\t}, 1000);\n\n\t\tif (cc != null) {\n\t\t\tcc.exitDetails = ` ${GlyphChars.Dot} Git found (${getDurationMilliseconds(start)} ms): ${\n\t\t\t\tlocation.version\n\t\t\t} @ ${location.path === 'git' ? 'PATH' : location.path}`;\n\t\t} else {\n\t\t\tLogger.log(\n\t\t\t\tcc,\n\t\t\t\t`Git found: ${location.version} @ ${location.path === 'git' ? 'PATH' : location.path} ${\n\t\t\t\t\tGlyphChars.Dot\n\t\t\t\t} ${getDurationMilliseconds(start)} ms`,\n\t\t\t);\n\t\t}\n\n\t\t// Warn if git is less than v2.7.2\n\t\tif (compare(fromString(location.version), fromString('2.7.2')) === -1) {\n\t\t\tLogger.log(cc, `Git version (${location.version}) is outdated`);\n\t\t\tvoid Messages.showGitVersionUnsupportedErrorMessage(location.version, '2.7.2');\n\t\t}\n\n\t\treturn location;\n\t}\n\n\tasync discoverRepositories(uri: Uri): Promise<Repository[]> {\n\t\tif (uri.scheme !== Schemes.File) return [];\n\n\t\ttry {\n\t\t\tvoid (await this.ensureGit());\n\n\t\t\tconst autoRepositoryDetection =\n\t\t\t\tconfiguration.getAny<boolean | 'subFolders' | 'openEditors'>(\n\t\t\t\t\tCoreGitConfiguration.AutoRepositoryDetection,\n\t\t\t\t) ?? true;\n\t\t\tif (autoRepositoryDetection === false || autoRepositoryDetection === 'openEditors') return [];\n\n\t\t\tconst repositories = await this.repositorySearch(workspace.getWorkspaceFolder(uri)!);\n\t\t\tif (autoRepositoryDetection === true || autoRepositoryDetection === 'subFolders') {\n\t\t\t\tfor (const repository of repositories) {\n\t\t\t\t\tvoid this.openScmRepository(repository.uri);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (repositories.length > 0) {\n\t\t\t\tthis._trackedPaths.clear();\n\t\t\t}\n\n\t\t\treturn repositories;\n\t\t} catch (ex) {\n\t\t\tif (ex instanceof InvalidGitConfigError) {\n\t\t\t\tvoid Messages.showGitInvalidConfigErrorMessage();\n\t\t\t} else if (ex instanceof UnableToFindGitError) {\n\t\t\t\tvoid Messages.showGitMissingErrorMessage();\n\t\t\t} else {\n\t\t\t\tconst msg: string = ex?.message ?? '';\n\t\t\t\tif (msg) {\n\t\t\t\t\tvoid window.showErrorMessage(`Unable to initialize Git; ${msg}`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthrow ex;\n\t\t}\n\t}\n\n\topenRepository(\n\t\tfolder: WorkspaceFolder | undefined,\n\t\turi: Uri,\n\t\troot: boolean,\n\t\tsuspended?: boolean,\n\t\tclosed?: boolean,\n\t): Repository {\n\t\tvoid this.openScmRepository(uri);\n\t\treturn new Repository(\n\t\t\tthis.container,\n\t\t\tthis.onRepositoryChanged.bind(this),\n\t\t\tthis.descriptor,\n\t\t\tfolder,\n\t\t\turi,\n\t\t\troot,\n\t\t\tsuspended ?? !window.state.focused,\n\t\t\tclosed,\n\t\t);\n\t}\n\n\topenRepositoryInitWatcher(): RepositoryInitWatcher {\n\t\tconst watcher = workspace.createFileSystemWatcher('**/.git', false, true, true);\n\t\treturn {\n\t\t\tonDidCreate: watcher.onDidCreate,\n\t\t\tdispose: () => watcher.dispose(),\n\t\t};\n\t}\n\n\tprivate _allowedFeatures = new Map<string, Map<PremiumFeatures, boolean>>();\n\tasync allows(feature: PremiumFeatures, plan: SubscriptionPlanId, repoPath?: string): Promise<boolean> {\n\t\tif (plan === SubscriptionPlanId.Free) return false;\n\t\tif (plan === SubscriptionPlanId.Pro) return true;\n\n\t\tif (repoPath == null) {\n\t\t\tconst repositories = [...this.container.git.getOpenRepositories(this.descriptor.id)];\n\t\t\tconst results = await Promise.allSettled(repositories.map(r => this.allows(feature, plan, r.path)));\n\t\t\treturn results.every(r => r.status === 'fulfilled' && r.value);\n\t\t}\n\n\t\tlet allowedByRepo = this._allowedFeatures.get(repoPath);\n\t\tlet allowed = allowedByRepo?.get(feature);\n\t\tif (allowed != null) return allowed;\n\n\t\tallowed = GitProviderService.previewFeatures?.get(feature)\n\t\t\t? true\n\t\t\t: (await this.visibility(repoPath)) === RepositoryVisibility.Public;\n\t\tif (allowedByRepo == null) {\n\t\t\tallowedByRepo = new Map<PremiumFeatures, boolean>();\n\t\t\tthis._allowedFeatures.set(repoPath, allowedByRepo);\n\t\t}\n\n\t\tallowedByRepo.set(feature, allowed);\n\t\treturn allowed;\n\t}\n\n\tprivate _supportedFeatures = new Map<Features, boolean>();\n\tasync supports(feature: Features): Promise<boolean> {\n\t\tlet supported = this._supportedFeatures.get(feature);\n\t\tif (supported != null) return supported;\n\n\t\tswitch (feature) {\n\t\t\tcase Features.Worktrees:\n\t\t\t\tsupported = await this.git.isAtLeastVersion('2.17.0');\n\t\t\t\tthis._supportedFeatures.set(feature, supported);\n\t\t\t\treturn supported;\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t}\n\n\tasync visibility(repoPath: string): Promise<RepositoryVisibility> {\n\t\tconst remotes = await this.getRemotes(repoPath);\n\t\tif (remotes.length === 0) return RepositoryVisibility.Private;\n\n\t\tconst origin = remotes.find(r => r.name === 'origin');\n\t\tif (origin != null) {\n\t\t\treturn this.getRemoteVisibility(origin);\n\t\t}\n\n\t\tconst upstream = remotes.find(r => r.name === 'upstream');\n\t\tif (upstream != null) {\n\t\t\treturn this.getRemoteVisibility(upstream);\n\t\t}\n\n\t\tconst results = await Promise.allSettled(remotes.map(r => this.getRemoteVisibility(r)));\n\t\tfor (const result of results) {\n\t\t\tif (result.status !== 'fulfilled') continue;\n\n\t\t\tif (result.value === RepositoryVisibility.Public) return RepositoryVisibility.Public;\n\t\t}\n\n\t\treturn RepositoryVisibility.Private;\n\t}\n\n\tprivate async getRemoteVisibility(\n\t\tremote: GitRemote<RemoteProvider | RichRemoteProvider | undefined>,\n\t): Promise<RepositoryVisibility> {\n\t\tswitch (remote.provider?.id) {\n\t\t\tcase 'github':\n\t\t\tcase 'gitlab':\n\t\t\tcase 'bitbucket':\n\t\t\tcase 'azure-devops':\n\t\t\tcase 'gitea':\n\t\t\tcase 'gerrit': {\n\t\t\t\tconst url = remote.provider.url({ type: RemoteResourceType.Repo });\n\t\t\t\tif (url == null) return RepositoryVisibility.Private;\n\n\t\t\t\t// Check if the url returns a 200 status code\n\t\t\t\ttry {\n\t\t\t\t\tconst response = await fetch(url, { method: 'HEAD' });\n\t\t\t\t\tif (response.status === 200) {\n\t\t\t\t\t\treturn RepositoryVisibility.Public;\n\t\t\t\t\t}\n\t\t\t\t} catch {}\n\t\t\t\treturn RepositoryVisibility.Private;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\treturn RepositoryVisibility.Private;\n\t\t}\n\t}\n\n\t@log<LocalGitProvider['repositorySearch']>({\n\t\targs: false,\n\t\tsingleLine: true,\n\t\tprefix: (context, folder) => `${context.prefix}(${folder.uri.fsPath})`,\n\t\texit: result =>\n\t\t\t`returned ${result.length} repositories${\n\t\t\t\tresult.length !== 0 ? ` (${result.map(r => r.path).join(', ')})` : ''\n\t\t\t}`,\n\t})\n\tprivate async repositorySearch(folder: WorkspaceFolder): Promise<Repository[]> {\n\t\tconst cc = Logger.getCorrelationContext();\n\t\tconst depth = configuration.get('advanced.repositorySearchDepth', folder.uri);\n\n\t\tLogger.log(cc, `searching (depth=${depth})...`);\n\n\t\tconst repositories: Repository[] = [];\n\n\t\tconst uri = await this.findRepositoryUri(folder.uri, true);\n\t\tif (uri != null) {\n\t\t\tLogger.log(cc, `found root repository in '${uri.fsPath}'`);\n\t\t\trepositories.push(this.openRepository(folder, uri, true));\n\t\t}\n\n\t\tif (depth <= 0) return repositories;\n\n\t\t// Get any specified excludes -- this is a total hack, but works for some simple cases and something is better than nothing :)\n\t\tconst excludedConfig = {\n\t\t\t...configuration.getAny<Record<string, boolean>>('files.exclude', folder.uri, {}),\n\t\t\t...configuration.getAny<Record<string, boolean>>('search.exclude', folder.uri, {}),\n\t\t};\n\n\t\tconst excludedPaths = [\n\t\t\t...filterMapIterable(Object.entries(excludedConfig), ([key, value]) => {\n\t\t\t\tif (!value) return undefined;\n\t\t\t\tif (key.startsWith('**/')) return key.substring(3);\n\t\t\t\treturn key;\n\t\t\t}),\n\t\t];\n\n\t\tconst excludes = excludedPaths.reduce((accumulator, current) => {\n\t\t\taccumulator.add(current);\n\t\t\treturn accumulator;\n\t\t}, new Set<string>());\n\n\t\tlet repoPaths;\n\t\ttry {\n\t\t\trepoPaths = await this.repositorySearchCore(folder.uri.fsPath, depth, excludes);\n\t\t} catch (ex) {\n\t\t\tconst msg: string = ex?.toString() ?? '';\n\t\t\tif (RepoSearchWarnings.doesNotExist.test(msg)) {\n\t\t\t\tLogger.log(cc, `FAILED${msg ? ` Error: ${msg}` : ''}`);\n\t\t\t} else {\n\t\t\t\tLogger.error(ex, cc, 'FAILED');\n\t\t\t}\n\n\t\t\treturn repositories;\n\t\t}\n\n\t\tconst rootPath = uri != null ? normalizePath(uri.fsPath) : undefined;\n\t\tfor (let p of repoPaths) {\n\t\t\tp = dirname(p);\n\t\t\tconst normalized = normalizePath(p);\n\n\t\t\t// If we are the same as the root, skip it\n\t\t\tif (isLinux) {\n\t\t\t\tif (normalized === rootPath) continue;\n\t\t\t} else if (equalsIgnoreCase(normalized, rootPath)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tLogger.log(cc, `searching in '${p}'...`);\n\t\t\tLogger.debug(cc, `normalizedRepoPath=${normalized}, rootPath=${rootPath}`);\n\n\t\t\tconst rp = await this.findRepositoryUri(Uri.file(p), true);\n\t\t\tif (rp == null) continue;\n\n\t\t\tLogger.log(cc, `found repository in '${rp.fsPath}'`);\n\t\t\trepositories.push(this.openRepository(folder, rp, false));\n\t\t}\n\n\t\treturn repositories;\n\t}\n\n\t@debug<LocalGitProvider['repositorySearchCore']>({ args: { 2: false, 3: false } })\n\tprivate repositorySearchCore(\n\t\troot: string,\n\t\tdepth: number,\n\t\texcludes: Set<string>,\n\t\trepositories: string[] = [],\n\t): Promise<string[]> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\treturn new Promise<string[]>((resolve, reject) => {\n\t\t\treaddir(root, { withFileTypes: true }, async (err, files) => {\n\t\t\t\tif (err != null) {\n\t\t\t\t\treject(err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (files.length === 0) {\n\t\t\t\t\tresolve(repositories);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdepth--;\n\n\t\t\t\tlet f;\n\t\t\t\tfor (f of files) {\n\t\t\t\t\tif (f.name === '.git') {\n\t\t\t\t\t\trepositories.push(resolvePath(root, f.name));\n\t\t\t\t\t} else if (depth >= 0 && f.isDirectory() && !excludes.has(f.name)) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait this.repositorySearchCore(resolvePath(root, f.name), depth, excludes, repositories);\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\tLogger.error(ex, cc, 'FAILED');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresolve(repositories);\n\t\t\t});\n\t\t});\n\t}\n\n\tcanHandlePathOrUri(scheme: string, pathOrUri: string | Uri): string | undefined {\n\t\tif (!this.supportedSchemes.has(scheme)) return undefined;\n\t\treturn getBestPath(pathOrUri);\n\t}\n\n\tgetAbsoluteUri(pathOrUri: string | Uri, base: string | Uri): Uri {\n\t\t// Convert the base to a Uri if it isn't one\n\t\tif (typeof base === 'string') {\n\t\t\t// If it looks like a Uri parse it\n\t\t\tif (maybeUri(base)) {\n\t\t\t\tbase = Uri.parse(base, true);\n\t\t\t} else {\n\t\t\t\tif (!isAbsolute(base)) {\n\t\t\t\t\tdebugger;\n\t\t\t\t\tvoid window.showErrorMessage(\n\t\t\t\t\t\t`Unable to get absolute uri between ${\n\t\t\t\t\t\t\ttypeof pathOrUri === 'string' ? pathOrUri : pathOrUri.toString(false)\n\t\t\t\t\t\t} and ${base}; Base path '${base}' must be an absolute path`,\n\t\t\t\t\t);\n\t\t\t\t\tthrow new Error(`Base path '${base}' must be an absolute path`);\n\t\t\t\t}\n\n\t\t\t\tbase = Uri.file(base);\n\t\t\t}\n\t\t}\n\n\t\t// Short-circuit if the path is relative\n\t\tif (typeof pathOrUri === 'string' && !isAbsolute(pathOrUri)) {\n\t\t\treturn Uri.joinPath(base, normalizePath(pathOrUri));\n\t\t}\n\n\t\tconst relativePath = this.getRelativePath(pathOrUri, base);\n\t\treturn Uri.joinPath(base, relativePath);\n\t}\n\n\t@log()\n\tasync getBestRevisionUri(repoPath: string, path: string, ref: string | undefined): Promise<Uri | undefined> {\n\t\tif (ref === GitRevision.deletedOrMissing) return undefined;\n\n\t\t// TODO@eamodio Align this with isTrackedCore?\n\t\tif (!ref || (GitRevision.isUncommitted(ref) && !GitRevision.isUncommittedStaged(ref))) {\n\t\t\t// Make sure the file exists in the repo\n\t\t\tlet data = await this.git.ls_files(repoPath, path);\n\t\t\tif (data != null) return this.getAbsoluteUri(path, repoPath);\n\n\t\t\t// Check if the file exists untracked\n\t\t\tdata = await this.git.ls_files(repoPath, path, { untracked: true });\n\t\t\tif (data != null) return this.getAbsoluteUri(path, repoPath);\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (GitRevision.isUncommittedStaged(ref)) return this.getScmGitUri(path, repoPath);\n\n\t\treturn this.getRevisionUri(repoPath, path, ref);\n\t}\n\n\tgetRelativePath(pathOrUri: string | Uri, base: string | Uri): string {\n\t\t// Convert the base to a Uri if it isn't one\n\t\tif (typeof base === 'string') {\n\t\t\t// If it looks like a Uri parse it\n\t\t\tif (maybeUri(base)) {\n\t\t\t\tbase = Uri.parse(base, true);\n\t\t\t} else {\n\t\t\t\tif (!isAbsolute(base)) {\n\t\t\t\t\tdebugger;\n\t\t\t\t\tvoid window.showErrorMessage(\n\t\t\t\t\t\t`Unable to get relative path between ${\n\t\t\t\t\t\t\ttypeof pathOrUri === 'string' ? pathOrUri : pathOrUri.toString(false)\n\t\t\t\t\t\t} and ${base}; Base path '${base}' must be an absolute path`,\n\t\t\t\t\t);\n\t\t\t\t\tthrow new Error(`Base path '${base}' must be an absolute path`);\n\t\t\t\t}\n\n\t\t\t\tbase = Uri.file(base);\n\t\t\t}\n\t\t}\n\n\t\t// Convert the path to a Uri if it isn't one\n\t\tif (typeof pathOrUri === 'string') {\n\t\t\tif (maybeUri(pathOrUri)) {\n\t\t\t\tpathOrUri = Uri.parse(pathOrUri, true);\n\t\t\t} else {\n\t\t\t\tif (!isAbsolute(pathOrUri)) return normalizePath(pathOrUri);\n\n\t\t\t\tpathOrUri = Uri.file(pathOrUri);\n\t\t\t}\n\t\t}\n\n\t\tconst relativePath = relative(base.fsPath, pathOrUri.fsPath);\n\t\treturn normalizePath(relativePath);\n\t}\n\n\tgetRevisionUri(repoPath: string, path: string, ref: string): Uri {\n\t\tif (GitRevision.isUncommitted(ref)) {\n\t\t\treturn GitRevision.isUncommittedStaged(ref)\n\t\t\t\t? this.getScmGitUri(path, repoPath)\n\t\t\t\t: this.getAbsoluteUri(path, repoPath);\n\t\t}\n\n\t\tpath = normalizePath(this.getAbsoluteUri(path, repoPath).fsPath);\n\t\tif (path.charCodeAt(0) !== slash) {\n\t\t\tpath = `/${path}`;\n\t\t}\n\n\t\tconst metadata: RevisionUriData = {\n\t\t\tref: ref,\n\t\t\trepoPath: normalizePath(repoPath),\n\t\t};\n\n\t\tconst uri = Uri.from({\n\t\t\tscheme: Schemes.GitLens,\n\t\t\tauthority: encodeGitLensRevisionUriAuthority(metadata),\n\t\t\tpath: path,\n\t\t\tquery: ref ? JSON.stringify({ ref: GitRevision.shorten(ref) }) : undefined,\n\t\t});\n\t\treturn uri;\n\t}\n\n\t@log()\n\tasync getWorkingUri(repoPath: string, uri: Uri) {\n\t\tlet relativePath = this.getRelativePath(uri, repoPath);\n\n\t\tlet data;\n\t\tlet ref;\n\t\tdo {\n\t\t\tdata = await this.git.ls_files(repoPath, relativePath);\n\t\t\tif (data != null) {\n\t\t\t\trelativePath = splitSingle(data, '\\n')[0];\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// TODO: Add caching\n\t\t\t// Get the most recent commit for this file name\n\t\t\tref = await this.git.log__file_recent(repoPath, relativePath, {\n\t\t\t\tordering: this.container.config.advanced.commitOrdering,\n\t\t\t\tsimilarityThreshold: this.container.config.advanced.similarityThreshold,\n\t\t\t});\n\t\t\tif (ref == null) return undefined;\n\n\t\t\t// Now check if that commit had any renames\n\t\t\tdata = await this.git.log__file(repoPath, '.', ref, {\n\t\t\t\targsOrFormat: GitLogParser.simpleFormat,\n\t\t\t\tfileMode: 'simple',\n\t\t\t\tfilters: ['R', 'C', 'D'],\n\t\t\t\tlimit: 1,\n\t\t\t\tordering: this.container.config.advanced.commitOrdering,\n\t\t\t});\n\t\t\tif (data == null || data.length === 0) break;\n\n\t\t\tconst [foundRef, foundFile, foundStatus] = GitLogParser.parseSimpleRenamed(data, relativePath);\n\t\t\tif (foundStatus === 'D' && foundFile != null) return undefined;\n\t\t\tif (foundRef == null || foundFile == null) break;\n\n\t\t\trelativePath = foundFile;\n\t\t} while (true);\n\n\t\turi = this.getAbsoluteUri(relativePath, repoPath);\n\t\treturn (await fsExists(uri.fsPath)) ? uri : undefined;\n\t}\n\n\t@log()\n\tasync addRemote(repoPath: string, name: string, url: string): Promise<void> {\n\t\tawait this.git.remote__add(repoPath, name, url);\n\t}\n\n\t@log()\n\tasync pruneRemote(repoPath: string, remoteName: string): Promise<void> {\n\t\tawait this.git.remote__prune(repoPath, remoteName);\n\t}\n\n\t@log()\n\tasync applyChangesToWorkingFile(uri: GitUri, ref1?: string, ref2?: string) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tref1 = ref1 ?? uri.sha;\n\t\tif (ref1 == null || uri.repoPath == null) return;\n\n\t\tif (ref2 == null) {\n\t\t\tref2 = ref1;\n\t\t\tref1 = `${ref1}^`;\n\t\t}\n\n\t\tconst [relativePath, root] = splitPath(uri, uri.repoPath);\n\n\t\tlet patch;\n\t\ttry {\n\t\t\tpatch = await this.git.diff(root, relativePath, ref1, ref2);\n\t\t\tvoid (await this.git.apply(root, patch));\n\t\t} catch (ex) {\n\t\t\tconst msg: string = ex?.toString() ?? '';\n\t\t\tif (patch && /patch does not apply/i.test(msg)) {\n\t\t\t\tconst result = await window.showWarningMessage(\n\t\t\t\t\t'Unable to apply changes cleanly. Retry and allow conflicts?',\n\t\t\t\t\t{ title: 'Yes' },\n\t\t\t\t\t{ title: 'No', isCloseAffordance: true },\n\t\t\t\t);\n\n\t\t\t\tif (result == null || result.title !== 'Yes') return;\n\n\t\t\t\tif (result.title === 'Yes') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvoid (await this.git.apply(root, patch, { allowConflicts: true }));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t// eslint-disable-next-line no-ex-assign\n\t\t\t\t\t\tex = e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tLogger.error(ex, cc);\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to apply changes');\n\t\t}\n\t}\n\n\t@log()\n\tasync checkout(\n\t\trepoPath: string,\n\t\tref: string,\n\t\toptions?: { createBranch?: string } | { fileName?: string },\n\t): Promise<void> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\ttry {\n\t\t\tawait this.git.checkout(repoPath, ref, options);\n\t\t} catch (ex) {\n\t\t\tconst msg: string = ex?.toString() ?? '';\n\t\t\tif (/overwritten by checkout/i.test(msg)) {\n\t\t\t\tvoid Messages.showGenericErrorMessage(\n\t\t\t\t\t`Unable to checkout '${ref}'. Please commit or stash your changes before switching branches`,\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tLogger.error(ex, cc);\n\t\t\tvoid void Messages.showGenericErrorMessage(`Unable to checkout '${ref}'`);\n\t\t}\n\t}\n\n\t@log()\n\tresetCaches(...affects: ('branches' | 'contributors' | 'providers' | 'remotes' | 'stashes' | 'status' | 'tags')[]) {\n\t\tif (affects.length === 0 || affects.includes('branches')) {\n\t\t\tthis._branchesCache.clear();\n\t\t}\n\n\t\tif (affects.length === 0 || affects.includes('contributors')) {\n\t\t\tthis._contributorsCache.clear();\n\t\t}\n\n\t\tif (affects.length === 0 || affects.includes('stashes')) {\n\t\t\tthis._stashesCache.clear();\n\t\t}\n\n\t\tif (affects.length === 0 || affects.includes('status')) {\n\t\t\tthis._mergeStatusCache.clear();\n\t\t\tthis._rebaseStatusCache.clear();\n\t\t}\n\n\t\tif (affects.length === 0 || affects.includes('tags')) {\n\t\t\tthis._tagsCache.clear();\n\t\t}\n\n\t\tif (affects.length === 0) {\n\t\t\tthis._trackedPaths.clear();\n\t\t\tthis._repoInfoCache.clear();\n\t\t}\n\t}\n\n\t@log<LocalGitProvider['excludeIgnoredUris']>({ args: { 1: uris => uris.length } })\n\tasync excludeIgnoredUris(repoPath: string, uris: Uri[]): Promise<Uri[]> {\n\t\tconst paths = new Map<string, Uri>(uris.map(u => [normalizePath(u.fsPath), u]));\n\n\t\tconst data = await this.git.check_ignore(repoPath, ...paths.keys());\n\t\tif (data == null) return uris;\n\n\t\tconst ignored = data.split('\\0').filter(<T>(i?: T): i is T => Boolean(i));\n\t\tif (ignored.length === 0) return uris;\n\n\t\tfor (const file of ignored) {\n\t\t\tpaths.delete(file);\n\t\t}\n\n\t\treturn [...paths.values()];\n\t}\n\n\t@gate()\n\t@log()\n\tasync fetch(\n\t\trepoPath: string,\n\t\toptions?: { all?: boolean; branch?: GitBranchReference; prune?: boolean; pull?: boolean; remote?: string },\n\t): Promise<void> {\n\t\tconst { branch: branchRef, ...opts } = options ?? {};\n\t\tif (GitReference.isBranch(branchRef)) {\n\t\t\tconst repo = this.container.git.getRepository(repoPath);\n\t\t\tconst branch = await repo?.getBranch(branchRef?.name);\n\t\t\tif (!branch?.remote && branch?.upstream == null) return undefined;\n\n\t\t\treturn this.git.fetch(repoPath, {\n\t\t\t\tbranch: branch.getNameWithoutRemote(),\n\t\t\t\tremote: branch.getRemoteName()!,\n\t\t\t\tupstream: branch.getTrackingWithoutRemote()!,\n\t\t\t\tpull: options?.pull,\n\t\t\t});\n\t\t}\n\n\t\treturn this.git.fetch(repoPath, opts);\n\t}\n\n\t@gate()\n\t@debug()\n\tasync findRepositoryUri(uri: Uri, isDirectory?: boolean): Promise<Uri | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tlet repoPath: string | undefined;\n\t\ttry {\n\t\t\tif (!isDirectory) {\n\t\t\t\tconst stats = await workspace.fs.stat(uri);\n\t\t\t\turi = stats?.type === FileType.Directory ? uri : Uri.file(dirname(uri.fsPath));\n\t\t\t}\n\n\t\t\trepoPath = await this.git.rev_parse__show_toplevel(uri.fsPath);\n\t\t\tif (!repoPath) return undefined;\n\n\t\t\tif (isWindows) {\n\t\t\t\t// On Git 2.25+ if you call `rev-parse --show-toplevel` on a mapped drive, instead of getting the mapped drive path back, you get the UNC path for the mapped drive.\n\t\t\t\t// So try to normalize it back to the mapped drive path, if possible\n\n\t\t\t\tconst repoUri = Uri.file(repoPath);\n\n\t\t\t\tif (repoUri.authority.length !== 0 && uri.authority.length === 0) {\n\t\t\t\t\tconst match = driveLetterRegex.exec(uri.path);\n\t\t\t\t\tif (match != null) {\n\t\t\t\t\t\tconst [, letter] = match;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst networkPath = await new Promise<string | undefined>(resolve =>\n\t\t\t\t\t\t\t\trealpath.native(`${letter}:\\\\`, { encoding: 'utf8' }, (err, resolvedPath) =>\n\t\t\t\t\t\t\t\t\tresolve(err != null ? undefined : resolvedPath),\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (networkPath != null) {\n\t\t\t\t\t\t\t\trepoPath = normalizePath(\n\t\t\t\t\t\t\t\t\trepoUri.fsPath.replace(\n\t\t\t\t\t\t\t\t\t\tnetworkPath,\n\t\t\t\t\t\t\t\t\t\t`${letter.toLowerCase()}:${networkPath.endsWith('\\\\') ? '\\\\' : ''}`,\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\treturn Uri.file(repoPath);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch {}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Uri.file(normalizePath(uri.fsPath));\n\t\t\t\t}\n\n\t\t\t\treturn repoUri;\n\t\t\t}\n\n\t\t\t// If we are not on Windows (symlinks don't seem to have the same issue on Windows), check if we are a symlink and if so, use the symlink path (not its resolved path)\n\t\t\t// This is because VS Code will provide document Uris using the symlinked path\n\t\t\trepoPath = await new Promise<string | undefined>(resolve => {\n\t\t\t\trealpath(uri.fsPath, { encoding: 'utf8' }, (err, resolvedPath) => {\n\t\t\t\t\tif (err != null) {\n\t\t\t\t\t\tLogger.debug(cc, `fs.realpath failed; repoPath=${repoPath}`);\n\t\t\t\t\t\tresolve(repoPath);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (equalsIgnoreCase(uri.fsPath, resolvedPath)) {\n\t\t\t\t\t\tLogger.debug(cc, `No symlink detected; repoPath=${repoPath}`);\n\t\t\t\t\t\tresolve(repoPath);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst linkPath = normalizePath(resolvedPath);\n\t\t\t\t\trepoPath = repoPath!.replace(linkPath, uri.fsPath);\n\t\t\t\t\tLogger.debug(\n\t\t\t\t\t\tcc,\n\t\t\t\t\t\t`Symlink detected; repoPath=${repoPath}, path=${uri.fsPath}, resolvedPath=${resolvedPath}`,\n\t\t\t\t\t);\n\t\t\t\t\tresolve(repoPath);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn repoPath ? Uri.file(repoPath) : undefined;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log<LocalGitProvider['getAheadBehindCommitCount']>({ args: { 1: refs => refs.join(',') } })\n\tgetAheadBehindCommitCount(\n\t\trepoPath: string,\n\t\trefs: string[],\n\t): Promise<{ ahead: number; behind: number } | undefined> {\n\t\treturn this.git.rev_list__left_right(repoPath, refs);\n\t}\n\n\t@gate()\n\t@log()\n\tasync getBlame(uri: GitUri, document?: TextDocument | undefined): Promise<GitBlame | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tif (document?.isDirty) return this.getBlameContents(uri, document.getText());\n\n\t\tlet key = 'blame';\n\t\tif (uri.sha != null) {\n\t\t\tkey += `:${uri.sha}`;\n\t\t}\n\n\t\tconst doc = await this.container.tracker.getOrAdd(uri);\n\t\tif (this.useCaching) {\n\t\t\tif (doc.state != null) {\n\t\t\t\tconst cachedBlame = doc.state.getBlame(key);\n\t\t\t\tif (cachedBlame != null) {\n\t\t\t\t\tLogger.debug(cc, `Cache hit: '${key}'`);\n\t\t\t\t\treturn cachedBlame.item;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tLogger.debug(cc, `Cache miss: '${key}'`);\n\n\t\t\tif (doc.state == null) {\n\t\t\t\tdoc.state = new GitDocumentState(doc.key);\n\t\t\t}\n\t\t}\n\n\t\tconst promise = this.getBlameCore(uri, doc, key, cc);\n\n\t\tif (doc.state != null) {\n\t\t\tLogger.debug(cc, `Cache add: '${key}'`);\n\n\t\t\tconst value: CachedBlame = {\n\t\t\t\titem: promise as Promise<GitBlame>,\n\t\t\t};\n\t\t\tdoc.state.setBlame(key, value);\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tprivate async getBlameCore(\n\t\turi: GitUri,\n\t\tdocument: TrackedDocument<GitDocumentState>,\n\t\tkey: string,\n\t\tcc: LogCorrelationContext | undefined,\n\t): Promise<GitBlame | undefined> {\n\t\tconst paths = await this.isTracked(uri);\n\t\tif (paths == null) {\n\t\t\tLogger.log(cc, `Skipping blame; '${uri.fsPath}' is not tracked`);\n\t\t\treturn emptyPromise as Promise<GitBlame>;\n\t\t}\n\n\t\tconst [relativePath, root] = paths;\n\n\t\ttry {\n\t\t\tconst data = await this.git.blame(root, relativePath, uri.sha, {\n\t\t\t\targs: this.container.config.advanced.blame.customArguments,\n\t\t\t\tignoreWhitespace: this.container.config.blame.ignoreWhitespace,\n\t\t\t});\n\t\t\tconst blame = GitBlameParser.parse(this.container, data, root, await this.getCurrentUser(root));\n\t\t\treturn blame;\n\t\t} catch (ex) {\n\t\t\t// Trap and cache expected blame errors\n\t\t\tif (document.state != null) {\n\t\t\t\tconst msg = ex?.toString() ?? '';\n\t\t\t\tLogger.debug(cc, `Cache replace (with empty promise): '${key}'`);\n\n\t\t\t\tconst value: CachedBlame = {\n\t\t\t\t\titem: emptyPromise as Promise<GitBlame>,\n\t\t\t\t\terrorMessage: msg,\n\t\t\t\t};\n\t\t\t\tdocument.state.setBlame(key, value);\n\n\t\t\t\tdocument.setBlameFailure();\n\n\t\t\t\treturn emptyPromise as Promise<GitBlame>;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log<LocalGitProvider['getBlameContents']>({ args: { 1: '<contents>' } })\n\tasync getBlameContents(uri: GitUri, contents: string): Promise<GitBlame | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst key = `blame:${md5(contents)}`;\n\n\t\tconst doc = await this.container.tracker.getOrAdd(uri);\n\t\tif (this.useCaching) {\n\t\t\tif (doc.state != null) {\n\t\t\t\tconst cachedBlame = doc.state.getBlame(key);\n\t\t\t\tif (cachedBlame != null) {\n\t\t\t\t\tLogger.debug(cc, `Cache hit: ${key}`);\n\t\t\t\t\treturn cachedBlame.item;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tLogger.debug(cc, `Cache miss: ${key}`);\n\n\t\t\tif (doc.state == null) {\n\t\t\t\tdoc.state = new GitDocumentState(doc.key);\n\t\t\t}\n\t\t}\n\n\t\tconst promise = this.getBlameContentsCore(uri, contents, doc, key, cc);\n\n\t\tif (doc.state != null) {\n\t\t\tLogger.debug(cc, `Cache add: '${key}'`);\n\n\t\t\tconst value: CachedBlame = {\n\t\t\t\titem: promise as Promise<GitBlame>,\n\t\t\t};\n\t\t\tdoc.state.setBlame(key, value);\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tprivate async getBlameContentsCore(\n\t\turi: GitUri,\n\t\tcontents: string,\n\t\tdocument: TrackedDocument<GitDocumentState>,\n\t\tkey: string,\n\t\tcc: LogCorrelationContext | undefined,\n\t): Promise<GitBlame | undefined> {\n\t\tconst paths = await this.isTracked(uri);\n\t\tif (paths == null) {\n\t\t\tLogger.log(cc, `Skipping blame; '${uri.fsPath}' is not tracked`);\n\t\t\treturn emptyPromise as Promise<GitBlame>;\n\t\t}\n\n\t\tconst [relativePath, root] = paths;\n\n\t\ttry {\n\t\t\tconst data = await this.git.blame__contents(root, relativePath, contents, {\n\t\t\t\targs: this.container.config.advanced.blame.customArguments,\n\t\t\t\tcorrelationKey: `:${key}`,\n\t\t\t\tignoreWhitespace: this.container.config.blame.ignoreWhitespace,\n\t\t\t});\n\t\t\tconst blame = GitBlameParser.parse(this.container, data, root, await this.getCurrentUser(root));\n\t\t\treturn blame;\n\t\t} catch (ex) {\n\t\t\t// Trap and cache expected blame errors\n\t\t\tif (document.state != null) {\n\t\t\t\tconst msg = ex?.toString() ?? '';\n\t\t\t\tLogger.debug(cc, `Cache replace (with empty promise): '${key}'`);\n\n\t\t\t\tconst value: CachedBlame = {\n\t\t\t\t\titem: emptyPromise as Promise<GitBlame>,\n\t\t\t\t\terrorMessage: msg,\n\t\t\t\t};\n\t\t\t\tdocument.state.setBlame(key, value);\n\n\t\t\t\tdocument.setBlameFailure();\n\t\t\t\treturn emptyPromise as Promise<GitBlame>;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@gate()\n\t@log()\n\tasync getBlameForLine(\n\t\turi: GitUri,\n\t\teditorLine: number, // 0-based, Git is 1-based\n\t\tdocument?: TextDocument | undefined,\n\t\toptions?: { forceSingleLine?: boolean },\n\t): Promise<GitBlameLine | undefined> {\n\t\tif (document?.isDirty) return this.getBlameForLineContents(uri, editorLine, document.getText(), options);\n\n\t\tif (!options?.forceSingleLine && this.useCaching) {\n\t\t\tconst blame = await this.getBlame(uri);\n\t\t\tif (blame == null) return undefined;\n\n\t\t\tlet blameLine = blame.lines[editorLine];\n\t\t\tif (blameLine == null) {\n\t\t\t\tif (blame.lines.length !== editorLine) return undefined;\n\t\t\t\tblameLine = blame.lines[editorLine - 1];\n\t\t\t}\n\n\t\t\tconst commit = blame.commits.get(blameLine.sha);\n\t\t\tif (commit == null) return undefined;\n\n\t\t\tconst author = blame.authors.get(commit.author.name)!;\n\t\t\treturn {\n\t\t\t\tauthor: { ...author, lineCount: commit.lines.length },\n\t\t\t\tcommit: commit,\n\t\t\t\tline: blameLine,\n\t\t\t};\n\t\t}\n\n\t\tconst lineToBlame = editorLine + 1;\n\t\tconst [relativePath, root] = splitPath(uri, uri.repoPath);\n\n\t\ttry {\n\t\t\tconst data = await this.git.blame(root, relativePath, uri.sha, {\n\t\t\t\targs: this.container.config.advanced.blame.customArguments,\n\t\t\t\tignoreWhitespace: this.container.config.blame.ignoreWhitespace,\n\t\t\t\tstartLine: lineToBlame,\n\t\t\t\tendLine: lineToBlame,\n\t\t\t});\n\t\t\tconst blame = GitBlameParser.parse(this.container, data, root, await this.getCurrentUser(root));\n\t\t\tif (blame == null) return undefined;\n\n\t\t\treturn {\n\t\t\t\tauthor: first(blame.authors.values()),\n\t\t\t\tcommit: first(blame.commits.values()),\n\t\t\t\tline: blame.lines[editorLine],\n\t\t\t};\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log<LocalGitProvider['getBlameForLineContents']>({ args: { 2: '<contents>' } })\n\tasync getBlameForLineContents(\n\t\turi: GitUri,\n\t\teditorLine: number, // 0-based, Git is 1-based\n\t\tcontents: string,\n\t\toptions?: { forceSingleLine?: boolean },\n\t): Promise<GitBlameLine | undefined> {\n\t\tif (!options?.forceSingleLine && this.useCaching) {\n\t\t\tconst blame = await this.getBlameContents(uri, contents);\n\t\t\tif (blame == null) return undefined;\n\n\t\t\tlet blameLine = blame.lines[editorLine];\n\t\t\tif (blameLine == null) {\n\t\t\t\tif (blame.lines.length !== editorLine) return undefined;\n\t\t\t\tblameLine = blame.lines[editorLine - 1];\n\t\t\t}\n\n\t\t\tconst commit = blame.commits.get(blameLine.sha);\n\t\t\tif (commit == null) return undefined;\n\n\t\t\tconst author = blame.authors.get(commit.author.name)!;\n\t\t\treturn {\n\t\t\t\tauthor: { ...author, lineCount: commit.lines.length },\n\t\t\t\tcommit: commit,\n\t\t\t\tline: blameLine,\n\t\t\t};\n\t\t}\n\n\t\tconst lineToBlame = editorLine + 1;\n\t\tconst [relativePath, root] = splitPath(uri, uri.repoPath);\n\n\t\ttry {\n\t\t\tconst data = await this.git.blame__contents(root, relativePath, contents, {\n\t\t\t\targs: this.container.config.advanced.blame.customArguments,\n\t\t\t\tignoreWhitespace: this.container.config.blame.ignoreWhitespace,\n\t\t\t\tstartLine: lineToBlame,\n\t\t\t\tendLine: lineToBlame,\n\t\t\t});\n\t\t\tconst blame = GitBlameParser.parse(this.container, data, root, await this.getCurrentUser(root));\n\t\t\tif (blame == null) return undefined;\n\n\t\t\treturn {\n\t\t\t\tauthor: first(blame.authors.values()),\n\t\t\t\tcommit: first(blame.commits.values()),\n\t\t\t\tline: blame.lines[editorLine],\n\t\t\t};\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log()\n\tasync getBlameForRange(uri: GitUri, range: Range): Promise<GitBlameLines | undefined> {\n\t\tconst blame = await this.getBlame(uri);\n\t\tif (blame == null) return undefined;\n\n\t\treturn this.getBlameRange(blame, uri, range);\n\t}\n\n\t@log<LocalGitProvider['getBlameForRangeContents']>({ args: { 2: '<contents>' } })\n\tasync getBlameForRangeContents(uri: GitUri, range: Range, contents: string): Promise<GitBlameLines | undefined> {\n\t\tconst blame = await this.getBlameContents(uri, contents);\n\t\tif (blame == null) return undefined;\n\n\t\treturn this.getBlameRange(blame, uri, range);\n\t}\n\n\t@log<LocalGitProvider['getBlameRange']>({ args: { 0: '<blame>' } })\n\tgetBlameRange(blame: GitBlame, uri: GitUri, range: Range): GitBlameLines | undefined {\n\t\tif (blame.lines.length === 0) return { allLines: blame.lines, ...blame };\n\n\t\tif (range.start.line === 0 && range.end.line === blame.lines.length - 1) {\n\t\t\treturn { allLines: blame.lines, ...blame };\n\t\t}\n\n\t\tconst lines = blame.lines.slice(range.start.line, range.end.line + 1);\n\t\tconst shas = new Set(lines.map(l => l.sha));\n\n\t\t// ranges are 0-based\n\t\tconst startLine = range.start.line + 1;\n\t\tconst endLine = range.end.line + 1;\n\n\t\tconst authors = new Map<string, GitBlameAuthor>();\n\t\tconst commits = new Map<string, GitCommit>();\n\t\tfor (const c of blame.commits.values()) {\n\t\t\tif (!shas.has(c.sha)) continue;\n\n\t\t\tconst commit = c.with({\n\t\t\t\tlines: c.lines.filter(l => l.line >= startLine && l.line <= endLine),\n\t\t\t});\n\t\t\tcommits.set(c.sha, commit);\n\n\t\t\tlet author = authors.get(commit.author.name);\n\t\t\tif (author == null) {\n\t\t\t\tauthor = {\n\t\t\t\t\tname: commit.author.name,\n\t\t\t\t\tlineCount: 0,\n\t\t\t\t};\n\t\t\t\tauthors.set(author.name, author);\n\t\t\t}\n\n\t\t\tauthor.lineCount += commit.lines.length;\n\t\t}\n\n\t\tconst sortedAuthors = new Map([...authors.entries()].sort((a, b) => b[1].lineCount - a[1].lineCount));\n\n\t\treturn {\n\t\t\trepoPath: uri.repoPath!,\n\t\t\tauthors: sortedAuthors,\n\t\t\tcommits: commits,\n\t\t\tlines: lines,\n\t\t\tallLines: blame.lines,\n\t\t};\n\t}\n\n\t@log()\n\tasync getBranch(repoPath: string): Promise<GitBranch | undefined> {\n\t\tlet {\n\t\t\tvalues: [branch],\n\t\t} = await this.getBranches(repoPath, { filter: b => b.current });\n\t\tif (branch != null) return branch;\n\n\t\tconst data = await this.git.rev_parse__currentBranch(repoPath, this.container.config.advanced.commitOrdering);\n\t\tif (data == null) return undefined;\n\n\t\tconst [name, upstream] = data[0].split('\\n');\n\t\tif (GitBranch.isDetached(name)) {\n\t\t\tconst [rebaseStatus, committerDate] = await Promise.all([\n\t\t\t\tthis.getRebaseStatus(repoPath),\n\t\t\t\tthis.git.log__recent_committerdate(repoPath, this.container.config.advanced.commitOrdering),\n\t\t\t]);\n\n\t\t\tbranch = new GitBranch(\n\t\t\t\trepoPath,\n\t\t\t\trebaseStatus?.incoming.name ?? name,\n\t\t\t\tfalse,\n\t\t\t\ttrue,\n\t\t\t\tcommitterDate != null ? new Date(Number(committerDate) * 1000) : undefined,\n\t\t\t\tdata[1],\n\t\t\t\tupstream ? { name: upstream, missing: false } : undefined,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\trebaseStatus != null,\n\t\t\t);\n\t\t}\n\n\t\treturn branch;\n\t}\n\n\t@log({ args: { 1: false } })\n\tasync getBranches(\n\t\trepoPath: string | undefined,\n\t\toptions?: {\n\t\t\tcursor?: string;\n\t\t\tfilter?: (b: GitBranch) => boolean;\n\t\t\tsort?: boolean | BranchSortOptions;\n\t\t},\n\t): Promise<PagedResult<GitBranch>> {\n\t\tif (repoPath == null) return emptyPagedResult;\n\n\t\tlet resultsPromise = this.useCaching ? this._branchesCache.get(repoPath) : undefined;\n\t\tif (resultsPromise == null) {\n\t\t\tasync function load(this: LocalGitProvider): Promise<PagedResult<GitBranch>> {\n\t\t\t\ttry {\n\t\t\t\t\tconst data = await this.git.for_each_ref__branch(repoPath!, { all: true });\n\t\t\t\t\t// If we don't get any data, assume the repo doesn't have any commits yet so check if we have a current branch\n\t\t\t\t\tif (data == null || data.length === 0) {\n\t\t\t\t\t\tlet current;\n\n\t\t\t\t\t\tconst data = await this.git.rev_parse__currentBranch(\n\t\t\t\t\t\t\trepoPath!,\n\t\t\t\t\t\t\tthis.container.config.advanced.commitOrdering,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (data != null) {\n\t\t\t\t\t\t\tconst [name, upstream] = data[0].split('\\n');\n\t\t\t\t\t\t\tconst [rebaseStatus, committerDate] = await Promise.all([\n\t\t\t\t\t\t\t\tGitBranch.isDetached(name) ? this.getRebaseStatus(repoPath!) : undefined,\n\t\t\t\t\t\t\t\tthis.git.log__recent_committerdate(\n\t\t\t\t\t\t\t\t\trepoPath!,\n\t\t\t\t\t\t\t\t\tthis.container.config.advanced.commitOrdering,\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t]);\n\n\t\t\t\t\t\t\tcurrent = new GitBranch(\n\t\t\t\t\t\t\t\trepoPath!,\n\t\t\t\t\t\t\t\trebaseStatus?.incoming.name ?? name,\n\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\tcommitterDate != null ? new Date(Number(committerDate) * 1000) : undefined,\n\t\t\t\t\t\t\t\tdata[1],\n\t\t\t\t\t\t\t\t{ name: upstream, missing: false },\n\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\trebaseStatus != null,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn current != null ? { values: [current] } : emptyPagedResult;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn { values: GitBranchParser.parse(data, repoPath!) };\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tthis._branchesCache.delete(repoPath!);\n\n\t\t\t\t\treturn emptyPagedResult;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresultsPromise = load.call(this);\n\n\t\t\tif (this.useCaching) {\n\t\t\t\tif (options?.cursor == null) {\n\t\t\t\t\tthis._branchesCache.set(repoPath, resultsPromise);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet result = await resultsPromise;\n\t\tif (options?.filter != null) {\n\t\t\tresult = {\n\t\t\t\t...result,\n\t\t\t\tvalues: result.values.filter(options.filter),\n\t\t\t};\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\tif (options?.sort) {\n\t\t\tGitBranch.sort(result.values, typeof options.sort === 'boolean' ? undefined : options.sort);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t@log()\n\tasync getChangedFilesCount(repoPath: string, ref?: string): Promise<GitDiffShortStat | undefined> {\n\t\tconst data = await this.git.diff__shortstat(repoPath, ref);\n\t\tif (!data) return undefined;\n\n\t\treturn GitDiffParser.parseShortStat(data);\n\t}\n\n\t@log()\n\tasync getCommit(repoPath: string, ref: string): Promise<GitCommit | undefined> {\n\t\tconst log = await this.getLog(repoPath, { limit: 2, ref: ref });\n\t\tif (log == null) return undefined;\n\n\t\treturn log.commits.get(ref) ?? first(log.commits.values());\n\t}\n\n\t@log()\n\tasync getCommitBranches(\n\t\trepoPath: string,\n\t\tref: string,\n\t\toptions?: { branch?: string; commitDate?: Date; mode?: 'contains' | 'pointsAt'; remotes?: boolean },\n\t): Promise<string[]> {\n\t\tif (options?.branch) {\n\t\t\tconst data = await this.git.branch__containsOrPointsAt(repoPath, ref, {\n\t\t\t\tmode: 'contains',\n\t\t\t\tname: options.branch,\n\t\t\t});\n\t\t\tif (!data) return [];\n\n\t\t\treturn [data?.trim()];\n\t\t}\n\n\t\tconst data = await this.git.branch__containsOrPointsAt(repoPath, ref, options);\n\t\tif (!data) return [];\n\n\t\treturn filterMap(data.split('\\n'), b => b.trim() || undefined);\n\t}\n\n\t@log()\n\tgetCommitCount(repoPath: string, ref: string): Promise<number | undefined> {\n\t\treturn this.git.rev_list__count(repoPath, ref);\n\t}\n\n\t@log()\n\tasync getCommitForFile(\n\t\trepoPath: string | undefined,\n\t\turi: Uri,\n\t\toptions?: { ref?: string; firstIfNotFound?: boolean; range?: Range },\n\t): Promise<GitCommit | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst [relativePath, root] = splitPath(uri, repoPath);\n\n\t\ttry {\n\t\t\tconst log = await this.getLogForFile(root, relativePath, {\n\t\t\t\tlimit: 2,\n\t\t\t\tref: options?.ref,\n\t\t\t\trange: options?.range,\n\t\t\t});\n\t\t\tif (log == null) return undefined;\n\n\t\t\tlet commit;\n\t\t\tif (options?.ref) {\n\t\t\t\tconst commit = log.commits.get(options.ref);\n\t\t\t\tif (commit == null && !options?.firstIfNotFound) {\n\t\t\t\t\t// If the ref isn't a valid sha we will never find it, so let it fall through so we return the first\n\t\t\t\t\tif (GitRevision.isSha(options.ref) || GitRevision.isUncommitted(options.ref)) return undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn commit ?? first(log.commits.values());\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log()\n\tasync getOldestUnpushedRefForFile(repoPath: string, uri: Uri): Promise<string | undefined> {\n\t\tconst [relativePath, root] = splitPath(uri, repoPath);\n\n\t\tconst data = await this.git.log__file(root, relativePath, '@{push}..', {\n\t\t\targsOrFormat: ['-z', '--format=%H'],\n\t\t\tfileMode: 'none',\n\t\t\tordering: this.container.config.advanced.commitOrdering,\n\t\t\trenames: true,\n\t\t});\n\t\tif (!data) return undefined;\n\n\t\t// -2 to skip the ending null\n\t\tconst index = data.lastIndexOf('\\0', data.length - 2);\n\t\treturn index === -1 ? undefined : data.slice(index + 1, data.length - 2);\n\t}\n\n\t@log()\n\tasync getContributors(\n\t\trepoPath: string,\n\t\toptions?: { all?: boolean; ref?: string; stats?: boolean },\n\t): Promise<GitContributor[]> {\n\t\tif (repoPath == null) return [];\n\n\t\tconst key = options?.stats ? `stats|${repoPath}` : repoPath;\n\n\t\tlet contributors = this.useCaching ? this._contributorsCache.get(key) : undefined;\n\t\tif (contributors == null) {\n\t\t\tasync function load(this: LocalGitProvider) {\n\t\t\t\ttry {\n\t\t\t\t\trepoPath = normalizePath(repoPath);\n\t\t\t\t\tconst currentUser = await this.getCurrentUser(repoPath);\n\n\t\t\t\t\tconst parser = GitLogParser.create<{\n\t\t\t\t\t\tsha: string;\n\t\t\t\t\t\tauthor: string;\n\t\t\t\t\t\temail: string;\n\t\t\t\t\t\tdate: string;\n\t\t\t\t\t\tstats?: { files: number; additions: number; deletions: number };\n\t\t\t\t\t}>(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsha: '%H',\n\t\t\t\t\t\t\tauthor: '%aN',\n\t\t\t\t\t\t\temail: '%aE',\n\t\t\t\t\t\t\tdate: '%at',\n\t\t\t\t\t\t},\n\t\t\t\t\t\toptions?.stats\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tadditionalArgs: ['--shortstat', '--use-mailmap'],\n\t\t\t\t\t\t\t\t\tparseEntry: (fields, entry) => {\n\t\t\t\t\t\t\t\t\t\tconst line = fields.next().value;\n\t\t\t\t\t\t\t\t\t\tconst match = GitLogParser.shortstatRegex.exec(line);\n\t\t\t\t\t\t\t\t\t\tif (match?.groups != null) {\n\t\t\t\t\t\t\t\t\t\t\tconst { files, additions, deletions } = match.groups;\n\t\t\t\t\t\t\t\t\t\t\tentry.stats = {\n\t\t\t\t\t\t\t\t\t\t\t\tfiles: Number(files || 0),\n\t\t\t\t\t\t\t\t\t\t\t\tadditions: Number(additions || 0),\n\t\t\t\t\t\t\t\t\t\t\t\tdeletions: Number(deletions || 0),\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treturn entry;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tprefix: '%x00',\n\t\t\t\t\t\t\t\t\tfieldSuffix: '%x00',\n\t\t\t\t\t\t\t\t\tskip: 1,\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t);\n\n\t\t\t\t\tconst data = await this.git.log(repoPath, options?.ref, {\n\t\t\t\t\t\tall: options?.all,\n\t\t\t\t\t\targsOrFormat: parser.arguments,\n\t\t\t\t\t});\n\n\t\t\t\t\tconst contributors = new Map<string, GitContributor>();\n\n\t\t\t\t\tconst commits = parser.parse(data);\n\t\t\t\t\tfor (const c of commits) {\n\t\t\t\t\t\tconst key = `${c.author}|${c.email}`;\n\t\t\t\t\t\tlet contributor = contributors.get(key);\n\t\t\t\t\t\tif (contributor == null) {\n\t\t\t\t\t\t\tcontributor = new GitContributor(\n\t\t\t\t\t\t\t\trepoPath,\n\t\t\t\t\t\t\t\tc.author,\n\t\t\t\t\t\t\t\tc.email,\n\t\t\t\t\t\t\t\t1,\n\t\t\t\t\t\t\t\tnew Date(Number(c.date) * 1000),\n\t\t\t\t\t\t\t\tisUserMatch(currentUser, c.author, c.email),\n\t\t\t\t\t\t\t\tc.stats,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcontributors.set(key, contributor);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t(contributor as PickMutable<GitContributor, 'count'>).count++;\n\t\t\t\t\t\t\tconst date = new Date(Number(c.date) * 1000);\n\t\t\t\t\t\t\tif (date > contributor.date!) {\n\t\t\t\t\t\t\t\t(contributor as PickMutable<GitContributor, 'date'>).date = date;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn [...contributors.values()];\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tthis._contributorsCache.delete(key);\n\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcontributors = load.call(this);\n\n\t\t\tif (this.useCaching) {\n\t\t\t\tthis._contributorsCache.set(key, contributors);\n\t\t\t}\n\t\t}\n\n\t\treturn contributors;\n\t}\n\n\t@gate()\n\t@log()\n\tasync getCurrentUser(repoPath: string): Promise<GitUser | undefined> {\n\t\tif (!repoPath) return undefined;\n\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst repo = this._repoInfoCache.get(repoPath);\n\n\t\tlet user = repo?.user;\n\t\tif (user != null) return user;\n\t\t// If we found the repo, but no user data was found just return\n\t\tif (user === null) return undefined;\n\n\t\tuser = { name: undefined, email: undefined };\n\n\t\ttry {\n\t\t\tconst data = await this.git.config__get_regex('^user\\\\.', repoPath, { local: true });\n\t\t\tif (data) {\n\t\t\t\tlet key: string;\n\t\t\t\tlet value: string;\n\n\t\t\t\tlet match;\n\t\t\t\tdo {\n\t\t\t\t\tmatch = userConfigRegex.exec(data);\n\t\t\t\t\tif (match == null) break;\n\n\t\t\t\t\t[, key, value] = match;\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\tuser[key as 'name' | 'email'] = ` ${value}`.substr(1);\n\t\t\t\t} while (true);\n\t\t\t} else {\n\t\t\t\tuser.name =\n\t\t\t\t\tprocess.env.GIT_AUTHOR_NAME || process.env.GIT_COMMITTER_NAME || userInfo()?.username || undefined;\n\t\t\t\tif (!user.name) {\n\t\t\t\t\t// If we found no user data, mark it so we won't bother trying again\n\t\t\t\t\tthis._repoInfoCache.set(repoPath, { ...repo, user: null });\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tuser.email =\n\t\t\t\t\tprocess.env.GIT_AUTHOR_EMAIL ||\n\t\t\t\t\tprocess.env.GIT_COMMITTER_EMAIL ||\n\t\t\t\t\tprocess.env.EMAIL ||\n\t\t\t\t\t`${user.name}@${hostname()}`;\n\t\t\t}\n\n\t\t\tconst author = `${user.name} <${user.email}>`;\n\t\t\t// Check if there is a mailmap for the current user\n\t\t\tconst mappedAuthor = await this.git.check_mailmap(repoPath, author);\n\t\t\tif (mappedAuthor != null && mappedAuthor.length !== 0 && author !== mappedAuthor) {\n\t\t\t\tconst match = mappedAuthorRegex.exec(mappedAuthor);\n\t\t\t\tif (match != null) {\n\t\t\t\t\t[, user.name, user.email] = match;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._repoInfoCache.set(repoPath, { ...repo, user: user });\n\t\t\treturn user;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\tdebugger;\n\n\t\t\t// Mark it so we won't bother trying again\n\t\t\tthis._repoInfoCache.set(repoPath, { ...repo, user: null });\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log()\n\tasync getDefaultBranchName(repoPath: string | undefined, remote?: string): Promise<string | undefined> {\n\t\tif (repoPath == null) return undefined;\n\n\t\tif (!remote) {\n\t\t\ttry {\n\t\t\t\tconst data = await this.git.symbolic_ref(repoPath, 'HEAD');\n\t\t\t\tif (data != null) return data.trim();\n\t\t\t} catch {}\n\t\t}\n\n\t\tremote = remote ?? 'origin';\n\t\ttry {\n\t\t\tconst data = await this.git.ls_remote__HEAD(repoPath, remote);\n\t\t\tif (data == null) return undefined;\n\n\t\t\tconst match = /ref:\\s(\\S+)\\s+HEAD/m.exec(data);\n\t\t\tif (match == null) return undefined;\n\n\t\t\tconst [, branch] = match;\n\t\t\treturn branch.substr('refs/heads/'.length);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log()\n\tasync getDiffForFile(uri: GitUri, ref1: string | undefined, ref2?: string): Promise<GitDiff | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tlet key = 'diff';\n\t\tif (ref1 != null) {\n\t\t\tkey += `:${ref1}`;\n\t\t}\n\t\tif (ref2 != null) {\n\t\t\tkey += `:${ref2}`;\n\t\t}\n\n\t\tconst doc = await this.container.tracker.getOrAdd(uri);\n\t\tif (this.useCaching) {\n\t\t\tif (doc.state != null) {\n\t\t\t\tconst cachedDiff = doc.state.getDiff(key);\n\t\t\t\tif (cachedDiff != null) {\n\t\t\t\t\tLogger.debug(cc, `Cache hit: '${key}'`);\n\t\t\t\t\treturn cachedDiff.item;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tLogger.debug(cc, `Cache miss: '${key}'`);\n\n\t\t\tif (doc.state == null) {\n\t\t\t\tdoc.state = new GitDocumentState(doc.key);\n\t\t\t}\n\t\t}\n\n\t\tconst promise = this.getDiffForFileCore(\n\t\t\turi.repoPath,\n\t\t\turi.fsPath,\n\t\t\tref1,\n\t\t\tref2,\n\t\t\t{ encoding: GitProviderService.getEncoding(uri) },\n\t\t\tdoc,\n\t\t\tkey,\n\t\t\tcc,\n\t\t);\n\n\t\tif (doc.state != null) {\n\t\t\tLogger.debug(cc, `Cache add: '${key}'`);\n\n\t\t\tconst value: CachedDiff = {\n\t\t\t\titem: promise as Promise<GitDiff>,\n\t\t\t};\n\t\t\tdoc.state.setDiff(key, value);\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tprivate async getDiffForFileCore(\n\t\trepoPath: string | undefined,\n\t\tpath: string,\n\t\tref1: string | undefined,\n\t\tref2: string | undefined,\n\t\toptions: { encoding?: string },\n\t\tdocument: TrackedDocument<GitDocumentState>,\n\t\tkey: string,\n\t\tcc: LogCorrelationContext | undefined,\n\t): Promise<GitDiff | undefined> {\n\t\tconst [relativePath, root] = splitPath(path, repoPath);\n\n\t\ttry {\n\t\t\tconst data = await this.git.diff(root, relativePath, ref1, ref2, {\n\t\t\t\t...options,\n\t\t\t\tfilters: ['M'],\n\t\t\t\tlinesOfContext: 0,\n\t\t\t\trenames: true,\n\t\t\t\tsimilarityThreshold: this.container.config.advanced.similarityThreshold,\n\t\t\t});\n\n\t\t\tconst diff = GitDiffParser.parse(data);\n\t\t\treturn diff;\n\t\t} catch (ex) {\n\t\t\t// Trap and cache expected diff errors\n\t\t\tif (document.state != null) {\n\t\t\t\tconst msg = ex?.toString() ?? '';\n\t\t\t\tLogger.debug(cc, `Cache replace (with empty promise): '${key}'`);\n\n\t\t\t\tconst value: CachedDiff = {\n\t\t\t\t\titem: emptyPromise as Promise<GitDiff>,\n\t\t\t\t\terrorMessage: msg,\n\t\t\t\t};\n\t\t\t\tdocument.state.setDiff(key, value);\n\n\t\t\t\treturn emptyPromise as Promise<GitDiff>;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log<LocalGitProvider['getDiffForFileContents']>({ args: { 1: '<contents>' } })\n\tasync getDiffForFileContents(uri: GitUri, ref: string, contents: string): Promise<GitDiff | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst key = `diff:${md5(contents)}`;\n\n\t\tconst doc = await this.container.tracker.getOrAdd(uri);\n\t\tif (this.useCaching) {\n\t\t\tif (doc.state != null) {\n\t\t\t\tconst cachedDiff = doc.state.getDiff(key);\n\t\t\t\tif (cachedDiff != null) {\n\t\t\t\t\tLogger.debug(cc, `Cache hit: ${key}`);\n\t\t\t\t\treturn cachedDiff.item;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tLogger.debug(cc, `Cache miss: ${key}`);\n\n\t\t\tif (doc.state == null) {\n\t\t\t\tdoc.state = new GitDocumentState(doc.key);\n\t\t\t}\n\t\t}\n\n\t\tconst promise = this.getDiffForFileContentsCore(\n\t\t\turi.repoPath,\n\t\t\turi.fsPath,\n\t\t\tref,\n\t\t\tcontents,\n\t\t\t{ encoding: GitProviderService.getEncoding(uri) },\n\t\t\tdoc,\n\t\t\tkey,\n\t\t\tcc,\n\t\t);\n\n\t\tif (doc.state != null) {\n\t\t\tLogger.debug(cc, `Cache add: '${key}'`);\n\n\t\t\tconst value: CachedDiff = {\n\t\t\t\titem: promise as Promise<GitDiff>,\n\t\t\t};\n\t\t\tdoc.state.setDiff(key, value);\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tprivate async getDiffForFileContentsCore(\n\t\trepoPath: string | undefined,\n\t\tpath: string,\n\t\tref: string,\n\t\tcontents: string,\n\t\toptions: { encoding?: string },\n\t\tdocument: TrackedDocument<GitDocumentState>,\n\t\tkey: string,\n\t\tcc: LogCorrelationContext | undefined,\n\t): Promise<GitDiff | undefined> {\n\t\tconst [relativePath, root] = splitPath(path, repoPath);\n\n\t\ttry {\n\t\t\tconst data = await this.git.diff__contents(root, relativePath, ref, contents, {\n\t\t\t\t...options,\n\t\t\t\tfilters: ['M'],\n\t\t\t\tsimilarityThreshold: this.container.config.advanced.similarityThreshold,\n\t\t\t});\n\n\t\t\tconst diff = GitDiffParser.parse(data);\n\t\t\treturn diff;\n\t\t} catch (ex) {\n\t\t\t// Trap and cache expected diff errors\n\t\t\tif (document.state != null) {\n\t\t\t\tconst msg = ex?.toString() ?? '';\n\t\t\t\tLogger.debug(cc, `Cache replace (with empty promise): '${key}'`);\n\n\t\t\t\tconst value: CachedDiff = {\n\t\t\t\t\titem: emptyPromise as Promise<GitDiff>,\n\t\t\t\t\terrorMessage: msg,\n\t\t\t\t};\n\t\t\t\tdocument.state.setDiff(key, value);\n\n\t\t\t\treturn emptyPromise as Promise<GitDiff>;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log()\n\tasync getDiffForLine(\n\t\turi: GitUri,\n\t\teditorLine: number, // 0-based, Git is 1-based\n\t\tref1: string | undefined,\n\t\tref2?: string,\n\t): Promise<GitDiffHunkLine | undefined> {\n\t\ttry {\n\t\t\tconst diff = await this.getDiffForFile(uri, ref1, ref2);\n\t\t\tif (diff == null) return undefined;\n\n\t\t\tconst line = editorLine + 1;\n\t\t\tconst hunk = diff.hunks.find(c => c.current.position.start <= line && c.current.position.end >= line);\n\t\t\tif (hunk == null) return undefined;\n\n\t\t\treturn hunk.lines[line - Math.min(hunk.current.position.start, hunk.previous.position.start)];\n\t\t} catch (ex) {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log()\n\tasync getDiffStatus(\n\t\trepoPath: string,\n\t\tref1?: string,\n\t\tref2?: string,\n\t\toptions?: { filters?: GitDiffFilter[]; similarityThreshold?: number },\n\t): Promise<GitFile[] | undefined> {\n\t\ttry {\n\t\t\tconst data = await this.git.diff__name_status(repoPath, ref1, ref2, {\n\t\t\t\tsimilarityThreshold: this.container.config.advanced.similarityThreshold,\n\t\t\t\t...options,\n\t\t\t});\n\t\t\tconst files = GitDiffParser.parseNameStatus(data, repoPath);\n\t\t\treturn files == null || files.length === 0 ? undefined : files;\n\t\t} catch (ex) {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log()\n\tasync getFileStatusForCommit(repoPath: string, uri: Uri, ref: string): Promise<GitFile | undefined> {\n\t\tif (ref === GitRevision.deletedOrMissing || GitRevision.isUncommitted(ref)) return undefined;\n\n\t\tconst [relativePath, root] = splitPath(uri, repoPath);\n\n\t\tconst data = await this.git.show__name_status(root, relativePath, ref);\n\t\tif (!data) return undefined;\n\n\t\tconst files = GitDiffParser.parseNameStatus(data, repoPath);\n\t\tif (files == null || files.length === 0) return undefined;\n\n\t\treturn files[0];\n\t}\n\n\t@debug()\n\tasync getLastFetchedTimestamp(repoPath: string): Promise<number | undefined> {\n\t\ttry {\n\t\t\tconst gitDir = await this.getGitDir(repoPath);\n\t\t\tconst stats = await workspace.fs.stat(this.container.git.getAbsoluteUri(`${gitDir}/FETCH_HEAD`, repoPath));\n\t\t\t// If the file is empty, assume the fetch failed, and don't update the timestamp\n\t\t\tif (stats.size > 0) return stats.mtime;\n\t\t} catch {}\n\n\t\treturn undefined;\n\t}\n\n\tprivate async getGitDir(repoPath: string): Promise<string> {\n\t\tconst repo = this._repoInfoCache.get(repoPath);\n\t\tif (repo?.gitDir != null) return repo.gitDir;\n\n\t\tconst gitDir = normalizePath((await this.git.rev_parse__git_dir(repoPath)) || '.git');\n\t\tthis._repoInfoCache.set(repoPath, { ...repo, gitDir: gitDir });\n\n\t\treturn gitDir;\n\t}\n\n\t@log()\n\tasync getLog(\n\t\trepoPath: string,\n\t\toptions?: {\n\t\t\tall?: boolean;\n\t\t\tauthors?: GitUser[];\n\t\t\tcursor?: string;\n\t\t\tlimit?: number;\n\t\t\tmerges?: boolean;\n\t\t\tordering?: string | null;\n\t\t\tref?: string;\n\t\t\tsince?: string;\n\t\t},\n\t): Promise<GitLog | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst limit = options?.limit ?? this.container.config.advanced.maxListItems ?? 0;\n\n\t\ttry {\n\t\t\t// const parser = GitLogParser.defaultParser;\n\n\t\t\tconst data = await this.git.log(repoPath, options?.ref, {\n\t\t\t\t...options,\n\t\t\t\t// args: parser.arguments,\n\t\t\t\tlimit: limit,\n\t\t\t\tmerges: options?.merges == null ? true : options.merges,\n\t\t\t\tordering: options?.ordering ?? this.container.config.advanced.commitOrdering,\n\t\t\t\tsimilarityThreshold: this.container.config.advanced.similarityThreshold,\n\t\t\t});\n\n\t\t\t// const commits = [];\n\t\t\t// const entries = parser.parse(data);\n\t\t\t// for (const entry of entries) {\n\t\t\t// \tcommits.push(\n\t\t\t// \t\tnew GitCommit2(\n\t\t\t// \t\t\trepoPath,\n\t\t\t// \t\t\tentry.sha,\n\t\t\t// \t\t\tnew GitCommitIdentity(\n\t\t\t// \t\t\t\tentry.author,\n\t\t\t// \t\t\t\tentry.authorEmail,\n\t\t\t// \t\t\t\tnew Date((entry.authorDate as any) * 1000),\n\t\t\t// \t\t\t),\n\t\t\t// \t\t\tnew GitCommitIdentity(\n\t\t\t// \t\t\t\tentry.committer,\n\t\t\t// \t\t\t\tentry.committerEmail,\n\t\t\t// \t\t\t\tnew Date((entry.committerDate as any) * 1000),\n\t\t\t// \t\t\t),\n\t\t\t// \t\t\tentry.message.split('\\n', 1)[0],\n\t\t\t// \t\t\tentry.parents.split(' '),\n\t\t\t// \t\t\tentry.message,\n\t\t\t// \t\t\tentry.files.map(f => new GitFileChange(repoPath, f.path, f.status as any, f.originalPath)),\n\t\t\t// \t\t\t[],\n\t\t\t// \t\t),\n\t\t\t// \t);\n\t\t\t// }\n\n\t\t\tconst log = GitLogParser.parse(\n\t\t\t\tthis.container,\n\t\t\t\tdata,\n\t\t\t\tLogType.Log,\n\t\t\t\trepoPath,\n\t\t\t\tundefined,\n\t\t\t\toptions?.ref,\n\t\t\t\tawait this.getCurrentUser(repoPath),\n\t\t\t\tlimit,\n\t\t\t\tfalse,\n\t\t\t\tundefined,\n\t\t\t);\n\n\t\t\tif (log != null) {\n\t\t\t\tlog.query = (limit: number | undefined) => this.getLog(repoPath, { ...options, limit: limit });\n\t\t\t\tif (log.hasMore) {\n\t\t\t\t\tlog.more = this.getLogMoreFn(log, options);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn log;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\tdebugger;\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log()\n\tasync getLogRefsOnly(\n\t\trepoPath: string,\n\t\toptions?: {\n\t\t\tauthors?: GitUser[];\n\t\t\tcursor?: string;\n\t\t\tlimit?: number;\n\t\t\tmerges?: boolean;\n\t\t\tordering?: string | null;\n\t\t\tref?: string;\n\t\t\tsince?: string;\n\t\t},\n\t): Promise<Set<string> | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst limit = options?.limit ?? this.container.config.advanced.maxListItems ?? 0;\n\n\t\ttry {\n\t\t\tconst parser = GitLogParser.createSingle('%H');\n\n\t\t\tconst data = await this.git.log(repoPath, options?.ref, {\n\t\t\t\tauthors: options?.authors,\n\t\t\t\targsOrFormat: parser.arguments,\n\t\t\t\tlimit: limit,\n\t\t\t\tmerges: options?.merges == null ? true : options.merges,\n\t\t\t\tsimilarityThreshold: this.container.config.advanced.similarityThreshold,\n\t\t\t\tsince: options?.since,\n\t\t\t\tordering: options?.ordering ?? this.container.config.advanced.commitOrdering,\n\t\t\t});\n\n\t\t\tconst commits = new Set(parser.parse(data));\n\t\t\treturn commits;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\tdebugger;\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprivate getLogMoreFn(\n\t\tlog: GitLog,\n\t\toptions?: {\n\t\t\tauthors?: GitUser[];\n\t\t\tlimit?: number;\n\t\t\tmerges?: boolean;\n\t\t\tordering?: string | null;\n\t\t\tref?: string;\n\t\t},\n\t): (limit: number | { until: string } | undefined) => Promise<GitLog> {\n\t\treturn async (limit: number | { until: string } | undefined) => {\n\t\t\tconst moreUntil = limit != null && typeof limit === 'object' ? limit.until : undefined;\n\t\t\tlet moreLimit = typeof limit === 'number' ? limit : undefined;\n\n\t\t\tif (moreUntil && some(log.commits.values(), c => c.ref === moreUntil)) {\n\t\t\t\treturn log;\n\t\t\t}\n\n\t\t\tmoreLimit = moreLimit ?? this.container.config.advanced.maxSearchItems ?? 0;\n\n\t\t\t// If the log is for a range, then just get everything prior + more\n\t\t\tif (GitRevision.isRange(log.sha)) {\n\t\t\t\tconst moreLog = await this.getLog(log.repoPath, {\n\t\t\t\t\t...options,\n\t\t\t\t\tlimit: moreLimit === 0 ? 0 : (options?.limit ?? 0) + moreLimit,\n\t\t\t\t});\n\t\t\t\t// If we can't find any more, assume we have everything\n\t\t\t\tif (moreLog == null) return { ...log, hasMore: false };\n\n\t\t\t\treturn moreLog;\n\t\t\t}\n\n\t\t\tconst ref = last(log.commits.values())?.ref;\n\t\t\tconst moreLog = await this.getLog(log.repoPath, {\n\t\t\t\t...options,\n\t\t\t\tlimit: moreUntil == null ? moreLimit : 0,\n\t\t\t\tref: moreUntil == null ? `${ref}^` : `${moreUntil}^..${ref}^`,\n\t\t\t});\n\t\t\t// If we can't find any more, assume we have everything\n\t\t\tif (moreLog == null) return { ...log, hasMore: false };\n\n\t\t\tconst commits = new Map([...log.commits, ...moreLog.commits]);\n\n\t\t\tconst mergedLog: GitLog = {\n\t\t\t\trepoPath: log.repoPath,\n\t\t\t\tcommits: commits,\n\t\t\t\tsha: log.sha,\n\t\t\t\trange: undefined,\n\t\t\t\tcount: commits.size,\n\t\t\t\tlimit: moreUntil == null ? (log.limit ?? 0) + moreLimit : undefined,\n\t\t\t\thasMore: moreUntil == null ? moreLog.hasMore : true,\n\t\t\t\tquery: (limit: number | undefined) => this.getLog(log.repoPath, { ...options, limit: limit }),\n\t\t\t};\n\t\t\tmergedLog.more = this.getLogMoreFn(mergedLog, options);\n\n\t\t\treturn mergedLog;\n\t\t};\n\t}\n\n\t@log()\n\tasync getLogForSearch(\n\t\trepoPath: string,\n\t\tsearch: SearchPattern,\n\t\toptions?: { limit?: number; ordering?: 'date' | 'author-date' | 'topo' | null; skip?: number },\n\t): Promise<GitLog | undefined> {\n\t\tsearch = { matchAll: false, matchCase: false, matchRegex: true, ...search };\n\n\t\ttry {\n\t\t\tconst limit = options?.limit ?? this.container.config.advanced.maxSearchItems ?? 0;\n\t\t\tconst similarityThreshold = this.container.config.advanced.similarityThreshold;\n\n\t\t\tconst operations = SearchPattern.parseSearchOperations(search.pattern);\n\n\t\t\tconst searchArgs = new Set<string>();\n\t\t\tconst files: string[] = [];\n\n\t\t\tlet useShow = false;\n\n\t\t\tlet op;\n\t\t\tlet values = operations.get('commit:');\n\t\t\tif (values != null) {\n\t\t\t\tuseShow = true;\n\n\t\t\t\tsearchArgs.add('-m');\n\t\t\t\tsearchArgs.add(`-M${similarityThreshold == null ? '' : `${similarityThreshold}%`}`);\n\t\t\t\tfor (const value of values) {\n\t\t\t\t\tsearchArgs.add(value.replace(doubleQuoteRegex, ''));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsearchArgs.add(`-M${similarityThreshold == null ? '' : `${similarityThreshold}%`}`);\n\t\t\t\tsearchArgs.add('--all');\n\t\t\t\tsearchArgs.add('--full-history');\n\t\t\t\tsearchArgs.add(search.matchRegex ? '--extended-regexp' : '--fixed-strings');\n\t\t\t\tif (search.matchRegex && !search.matchCase) {\n\t\t\t\t\tsearchArgs.add('--regexp-ignore-case');\n\t\t\t\t}\n\n\t\t\t\tfor ([op, values] of operations.entries()) {\n\t\t\t\t\tswitch (op) {\n\t\t\t\t\t\tcase 'message:':\n\t\t\t\t\t\t\tsearchArgs.add('-m');\n\t\t\t\t\t\t\tif (search.matchAll) {\n\t\t\t\t\t\t\t\tsearchArgs.add('--all-match');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor (const value of values) {\n\t\t\t\t\t\t\t\tsearchArgs.add(\n\t\t\t\t\t\t\t\t\t`--grep=${value.replace(doubleQuoteRegex, search.matchRegex ? '\\\\b' : '')}`,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'author:':\n\t\t\t\t\t\t\tsearchArgs.add('-m');\n\t\t\t\t\t\t\tfor (const value of values) {\n\t\t\t\t\t\t\t\tsearchArgs.add(\n\t\t\t\t\t\t\t\t\t`--author=${value.replace(doubleQuoteRegex, search.matchRegex ? '\\\\b' : '')}`,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'change:':\n\t\t\t\t\t\t\tfor (const value of values) {\n\t\t\t\t\t\t\t\tsearchArgs.add(\n\t\t\t\t\t\t\t\t\tsearch.matchRegex\n\t\t\t\t\t\t\t\t\t\t? `-G${value.replace(doubleQuoteRegex, '')}`\n\t\t\t\t\t\t\t\t\t\t: `-S${value.replace(doubleQuoteRegex, '')}`,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'file:':\n\t\t\t\t\t\t\tfor (const value of values) {\n\t\t\t\t\t\t\t\tfiles.push(value.replace(doubleQuoteRegex, ''));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst args = [...searchArgs.values(), '--'];\n\t\t\tif (files.length !== 0) {\n\t\t\t\targs.push(...files);\n\t\t\t}\n\n\t\t\tconst data = await this.git.log__search(repoPath, args, {\n\t\t\t\tordering: this.container.config.advanced.commitOrdering,\n\t\t\t\t...options,\n\t\t\t\tlimit: limit,\n\t\t\t\tuseShow: useShow,\n\t\t\t});\n\t\t\tconst log = GitLogParser.parse(\n\t\t\t\tthis.container,\n\t\t\t\tdata,\n\t\t\t\tLogType.Log,\n\t\t\t\trepoPath,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\tawait this.getCurrentUser(repoPath),\n\t\t\t\tlimit,\n\t\t\t\tfalse,\n\t\t\t\tundefined,\n\t\t\t);\n\n\t\t\tif (log != null) {\n\t\t\t\tlog.query = (limit: number | undefined) =>\n\t\t\t\t\tthis.getLogForSearch(repoPath, search, { ...options, limit: limit });\n\t\t\t\tif (log.hasMore) {\n\t\t\t\t\tlog.more = this.getLogForSearchMoreFn(log, search, options);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn log;\n\t\t} catch (ex) {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprivate getLogForSearchMoreFn(\n\t\tlog: GitLog,\n\t\tsearch: SearchPattern,\n\t\toptions?: { limit?: number; ordering?: 'date' | 'author-date' | 'topo' | null },\n\t): (limit: number | undefined) => Promise<GitLog> {\n\t\treturn async (limit: number | undefined) => {\n\t\t\tlimit = limit ?? this.container.config.advanced.maxSearchItems ?? 0;\n\n\t\t\tconst moreLog = await this.getLogForSearch(log.repoPath, search, {\n\t\t\t\t...options,\n\t\t\t\tlimit: limit,\n\t\t\t\tskip: log.count,\n\t\t\t});\n\t\t\t// If we can't find any more, assume we have everything\n\t\t\tif (moreLog == null) return { ...log, hasMore: false };\n\n\t\t\tconst commits = new Map([...log.commits, ...moreLog.commits]);\n\n\t\t\tconst mergedLog: GitLog = {\n\t\t\t\trepoPath: log.repoPath,\n\t\t\t\tcommits: commits,\n\t\t\t\tsha: log.sha,\n\t\t\t\trange: log.range,\n\t\t\t\tcount: commits.size,\n\t\t\t\tlimit: (log.limit ?? 0) + limit,\n\t\t\t\thasMore: moreLog.hasMore,\n\t\t\t\tquery: (limit: number | undefined) =>\n\t\t\t\t\tthis.getLogForSearch(log.repoPath, search, { ...options, limit: limit }),\n\t\t\t};\n\t\t\tmergedLog.more = this.getLogForSearchMoreFn(mergedLog, search, options);\n\n\t\t\treturn mergedLog;\n\t\t};\n\t}\n\t@log()\n\tasync getLogForFile(\n\t\trepoPath: string | undefined,\n\t\tpathOrUri: string | Uri,\n\t\toptions?: {\n\t\t\tall?: boolean;\n\t\t\tcursor?: string;\n\t\t\tforce?: boolean | undefined;\n\t\t\tlimit?: number;\n\t\t\tordering?: string | null;\n\t\t\trange?: Range;\n\t\t\tref?: string;\n\t\t\trenames?: boolean;\n\t\t\treverse?: boolean;\n\t\t\tsince?: string;\n\t\t\tskip?: number;\n\t\t},\n\t): Promise<GitLog | undefined> {\n\t\tif (repoPath == null) return undefined;\n\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst relativePath = this.getRelativePath(pathOrUri, repoPath);\n\n\t\tif (repoPath != null && repoPath === relativePath) {\n\t\t\tthrow new Error(`File name cannot match the repository path; path=${relativePath}`);\n\t\t}\n\n\t\toptions = { reverse: false, ...options };\n\n\t\tif (options.renames == null) {\n\t\t\toptions.renames = this.container.config.advanced.fileHistoryFollowsRenames;\n\t\t}\n\n\t\tlet key = 'log';\n\t\tif (options.ref != null) {\n\t\t\tkey += `:${options.ref}`;\n\t\t}\n\n\t\tif (options.all == null) {\n\t\t\toptions.all = this.container.config.advanced.fileHistoryShowAllBranches;\n\t\t}\n\t\tif (options.all) {\n\t\t\tkey += ':all';\n\t\t}\n\n\t\toptions.limit = options.limit ?? this.container.config.advanced.maxListItems ?? 0;\n\t\tif (options.limit) {\n\t\t\tkey += `:n${options.limit}`;\n\t\t}\n\n\t\tif (options.renames) {\n\t\t\tkey += ':follow';\n\t\t}\n\n\t\tif (options.reverse) {\n\t\t\tkey += ':reverse';\n\t\t}\n\n\t\tif (options.since) {\n\t\t\tkey += `:since=${options.since}`;\n\t\t}\n\n\t\tif (options.skip) {\n\t\t\tkey += `:skip${options.skip}`;\n\t\t}\n\n\t\tconst doc = await this.container.tracker.getOrAdd(GitUri.fromFile(relativePath, repoPath, options.ref));\n\t\tif (!options.force && this.useCaching && options.range == null) {\n\t\t\tif (doc.state != null) {\n\t\t\t\tconst cachedLog = doc.state.getLog(key);\n\t\t\t\tif (cachedLog != null) {\n\t\t\t\t\tLogger.debug(cc, `Cache hit: '${key}'`);\n\t\t\t\t\treturn cachedLog.item;\n\t\t\t\t}\n\n\t\t\t\tif (options.ref != null || options.limit != null) {\n\t\t\t\t\t// Since we are looking for partial log, see if we have the log of the whole file\n\t\t\t\t\tconst cachedLog = doc.state.getLog(\n\t\t\t\t\t\t`log${options.renames ? ':follow' : ''}${options.reverse ? ':reverse' : ''}`,\n\t\t\t\t\t);\n\t\t\t\t\tif (cachedLog != null) {\n\t\t\t\t\t\tif (options.ref == null) {\n\t\t\t\t\t\t\tLogger.debug(cc, `Cache hit: ~'${key}'`);\n\t\t\t\t\t\t\treturn cachedLog.item;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tLogger.debug(cc, `Cache ?: '${key}'`);\n\t\t\t\t\t\tlet log = await cachedLog.item;\n\t\t\t\t\t\tif (log != null && !log.hasMore && log.commits.has(options.ref)) {\n\t\t\t\t\t\t\tLogger.debug(cc, `Cache hit: '${key}'`);\n\n\t\t\t\t\t\t\t// Create a copy of the log starting at the requested commit\n\t\t\t\t\t\t\tlet skip = true;\n\t\t\t\t\t\t\tlet i = 0;\n\t\t\t\t\t\t\tconst commits = new Map(\n\t\t\t\t\t\t\t\tfilterMapIterable<[string, GitCommit], [string, GitCommit]>(\n\t\t\t\t\t\t\t\t\tlog.commits.entries(),\n\t\t\t\t\t\t\t\t\t([ref, c]) => {\n\t\t\t\t\t\t\t\t\t\tif (skip) {\n\t\t\t\t\t\t\t\t\t\t\tif (ref !== options?.ref) return undefined;\n\t\t\t\t\t\t\t\t\t\t\tskip = false;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\t\t\t\tif (options?.limit != null && i > options.limit) {\n\t\t\t\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\treturn [ref, c];\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst opts = { ...options };\n\t\t\t\t\t\t\tlog = {\n\t\t\t\t\t\t\t\t...log,\n\t\t\t\t\t\t\t\tlimit: options.limit,\n\t\t\t\t\t\t\t\tcount: commits.size,\n\t\t\t\t\t\t\t\tcommits: commits,\n\t\t\t\t\t\t\t\tquery: (limit: number | undefined) =>\n\t\t\t\t\t\t\t\t\tthis.getLogForFile(repoPath, pathOrUri, { ...opts, limit: limit }),\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\treturn log;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tLogger.debug(cc, `Cache miss: '${key}'`);\n\n\t\t\tif (doc.state == null) {\n\t\t\t\tdoc.state = new GitDocumentState(doc.key);\n\t\t\t}\n\t\t}\n\n\t\tconst promise = this.getLogForFileCore(repoPath, relativePath, options, doc, key, cc);\n\n\t\tif (doc.state != null && options.range == null) {\n\t\t\tLogger.debug(cc, `Cache add: '${key}'`);\n\n\t\t\tconst value: CachedLog = {\n\t\t\t\titem: promise as Promise<GitLog>,\n\t\t\t};\n\t\t\tdoc.state.setLog(key, value);\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tprivate async getLogForFileCore(\n\t\trepoPath: string | undefined,\n\t\tpath: string,\n\t\t{\n\t\t\tref,\n\t\t\trange,\n\t\t\t...options\n\t\t}: {\n\t\t\tall?: boolean;\n\t\t\tcursor?: string;\n\t\t\tlimit?: number;\n\t\t\tordering?: string | null;\n\t\t\trange?: Range;\n\t\t\tref?: string;\n\t\t\trenames?: boolean;\n\t\t\treverse?: boolean;\n\t\t\tsince?: string;\n\t\t\tskip?: number;\n\t\t},\n\t\tdocument: TrackedDocument<GitDocumentState>,\n\t\tkey: string,\n\t\tcc: LogCorrelationContext | undefined,\n\t): Promise<GitLog | undefined> {\n\t\tconst paths = await this.isTracked(path, repoPath, ref);\n\t\tif (paths == null) {\n\t\t\tLogger.log(cc, `Skipping blame; '${path}' is not tracked`);\n\t\t\treturn emptyPromise as Promise<GitLog>;\n\t\t}\n\n\t\tconst [relativePath, root] = paths;\n\n\t\ttry {\n\t\t\tif (range != null && range.start.line > range.end.line) {\n\t\t\t\trange = new Range(range.end, range.start);\n\t\t\t}\n\n\t\t\tconst data = await this.git.log__file(root, relativePath, ref, {\n\t\t\t\tordering: this.container.config.advanced.commitOrdering,\n\t\t\t\t...options,\n\t\t\t\tfirstParent: options.renames,\n\t\t\t\tstartLine: range == null ? undefined : range.start.line + 1,\n\t\t\t\tendLine: range == null ? undefined : range.end.line + 1,\n\t\t\t});\n\t\t\tconst log = GitLogParser.parse(\n\t\t\t\tthis.container,\n\t\t\t\tdata,\n\t\t\t\t// If this is the log of a folder, parse it as a normal log rather than a file log\n\t\t\t\tisFolderGlob(relativePath) ? LogType.Log : LogType.LogFile,\n\t\t\t\troot,\n\t\t\t\trelativePath,\n\t\t\t\tref,\n\t\t\t\tawait this.getCurrentUser(root),\n\t\t\t\toptions.limit,\n\t\t\t\toptions.reverse ?? false,\n\t\t\t\trange,\n\t\t\t);\n\n\t\t\tif (log != null) {\n\t\t\t\tconst opts = { ...options, ref: ref, range: range };\n\t\t\t\tlog.query = (limit: number | undefined) =>\n\t\t\t\t\tthis.getLogForFile(repoPath, path, { ...opts, limit: limit });\n\t\t\t\tif (log.hasMore) {\n\t\t\t\t\tlog.more = this.getLogForFileMoreFn(log, path, opts);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn log;\n\t\t} catch (ex) {\n\t\t\t// Trap and cache expected log errors\n\t\t\tif (document.state != null && range == null && !options.reverse) {\n\t\t\t\tconst msg: string = ex?.toString() ?? '';\n\t\t\t\tLogger.debug(cc, `Cache replace (with empty promise): '${key}'`);\n\n\t\t\t\tconst value: CachedLog = {\n\t\t\t\t\titem: emptyPromise as Promise<GitLog>,\n\t\t\t\t\terrorMessage: msg,\n\t\t\t\t};\n\t\t\t\tdocument.state.setLog(key, value);\n\n\t\t\t\treturn emptyPromise as Promise<GitLog>;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprivate getLogForFileMoreFn(\n\t\tlog: GitLog,\n\t\trelativePath: string,\n\t\toptions: {\n\t\t\tall?: boolean;\n\t\t\tlimit?: number;\n\t\t\tordering?: string | null;\n\t\t\trange?: Range;\n\t\t\tref?: string;\n\t\t\trenames?: boolean;\n\t\t\treverse?: boolean;\n\t\t},\n\t): (limit: number | { until: string } | undefined) => Promise<GitLog> {\n\t\treturn async (limit: number | { until: string } | undefined) => {\n\t\t\tconst moreUntil = limit != null && typeof limit === 'object' ? limit.until : undefined;\n\t\t\tlet moreLimit = typeof limit === 'number' ? limit : undefined;\n\n\t\t\tif (moreUntil && some(log.commits.values(), c => c.ref === moreUntil)) {\n\t\t\t\treturn log;\n\t\t\t}\n\n\t\t\tmoreLimit = moreLimit ?? this.container.config.advanced.maxSearchItems ?? 0;\n\n\t\t\tconst ref = last(log.commits.values())?.ref;\n\t\t\tconst moreLog = await this.getLogForFile(log.repoPath, relativePath, {\n\t\t\t\t...options,\n\t\t\t\tlimit: moreUntil == null ? moreLimit : 0,\n\t\t\t\tref: options.all ? undefined : moreUntil == null ? `${ref}^` : `${moreUntil}^..${ref}^`,\n\t\t\t\tskip: options.all ? log.count : undefined,\n\t\t\t});\n\t\t\t// If we can't find any more, assume we have everything\n\t\t\tif (moreLog == null) return { ...log, hasMore: false };\n\n\t\t\tconst commits = new Map([...log.commits, ...moreLog.commits]);\n\n\t\t\tconst mergedLog: GitLog = {\n\t\t\t\trepoPath: log.repoPath,\n\t\t\t\tcommits: commits,\n\t\t\t\tsha: log.sha,\n\t\t\t\trange: log.range,\n\t\t\t\tcount: commits.size,\n\t\t\t\tlimit: moreUntil == null ? (log.limit ?? 0) + moreLimit : undefined,\n\t\t\t\thasMore: moreUntil == null ? moreLog.hasMore : true,\n\t\t\t\tquery: (limit: number | undefined) =>\n\t\t\t\t\tthis.getLogForFile(log.repoPath, relativePath, { ...options, limit: limit }),\n\t\t\t};\n\n\t\t\tif (options.renames) {\n\t\t\t\tconst renamed = find(\n\t\t\t\t\tmoreLog.commits.values(),\n\t\t\t\t\tc => Boolean(c.file?.originalPath) && c.file?.originalPath !== relativePath,\n\t\t\t\t);\n\t\t\t\trelativePath = renamed?.file?.originalPath ?? relativePath;\n\t\t\t}\n\n\t\t\tmergedLog.more = this.getLogForFileMoreFn(mergedLog, relativePath, options);\n\n\t\t\treturn mergedLog;\n\t\t};\n\t}\n\n\t@log()\n\tasync getMergeBase(repoPath: string, ref1: string, ref2: string, options?: { forkPoint?: boolean }) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\ttry {\n\t\t\tconst data = await this.git.merge_base(repoPath, ref1, ref2, options);\n\t\t\tif (data == null) return undefined;\n\n\t\t\treturn data.split('\\n')[0].trim() || undefined;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@gate()\n\t@log()\n\tasync getMergeStatus(repoPath: string): Promise<GitMergeStatus | undefined> {\n\t\tlet status = this.useCaching ? this._mergeStatusCache.get(repoPath) : undefined;\n\t\tif (status === undefined) {\n\t\t\tconst merge = await this.git.rev_parse__verify(repoPath, 'MERGE_HEAD');\n\t\t\tif (merge != null) {\n\t\t\t\tconst [branch, mergeBase, possibleSourceBranches] = await Promise.all([\n\t\t\t\t\tthis.getBranch(repoPath),\n\t\t\t\t\tthis.getMergeBase(repoPath, 'MERGE_HEAD', 'HEAD'),\n\t\t\t\t\tthis.getCommitBranches(repoPath, 'MERGE_HEAD', { mode: 'pointsAt' }),\n\t\t\t\t]);\n\n\t\t\t\tstatus = {\n\t\t\t\t\ttype: 'merge',\n\t\t\t\t\trepoPath: repoPath,\n\t\t\t\t\tmergeBase: mergeBase,\n\t\t\t\t\tHEAD: GitReference.create(merge, repoPath, { refType: 'revision' }),\n\t\t\t\t\tcurrent: GitReference.fromBranch(branch!),\n\t\t\t\t\tincoming:\n\t\t\t\t\t\tpossibleSourceBranches?.length === 1\n\t\t\t\t\t\t\t? GitReference.create(possibleSourceBranches[0], repoPath, {\n\t\t\t\t\t\t\t\t\trefType: 'branch',\n\t\t\t\t\t\t\t\t\tname: possibleSourceBranches[0],\n\t\t\t\t\t\t\t\t\tremote: false,\n\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (this.useCaching) {\n\t\t\t\tthis._mergeStatusCache.set(repoPath, status ?? null);\n\t\t\t}\n\t\t}\n\n\t\treturn status ?? undefined;\n\t}\n\n\t@gate()\n\t@log()\n\tasync getRebaseStatus(repoPath: string): Promise<GitRebaseStatus | undefined> {\n\t\tlet status = this.useCaching ? this._rebaseStatusCache.get(repoPath) : undefined;\n\t\tif (status === undefined) {\n\t\t\tconst rebase = await this.git.rev_parse__verify(repoPath, 'REBASE_HEAD');\n\t\t\tif (rebase != null) {\n\t\t\t\tlet [mergeBase, branch, onto, stepsNumber, stepsMessage, stepsTotal] = await Promise.all([\n\t\t\t\t\tthis.getMergeBase(repoPath, 'REBASE_HEAD', 'HEAD'),\n\t\t\t\t\tthis.git.readDotGitFile(repoPath, ['rebase-merge', 'head-name']),\n\t\t\t\t\tthis.git.readDotGitFile(repoPath, ['rebase-merge', 'onto']),\n\t\t\t\t\tthis.git.readDotGitFile(repoPath, ['rebase-merge', 'msgnum'], { numeric: true }),\n\t\t\t\t\tthis.git\n\t\t\t\t\t\t.readDotGitFile(repoPath, ['rebase-merge', 'message'], { throw: true })\n\t\t\t\t\t\t.catch(() => this.git.readDotGitFile(repoPath, ['rebase-merge', 'message-squashed'])),\n\t\t\t\t\tthis.git.readDotGitFile(repoPath, ['rebase-merge', 'end'], { numeric: true }),\n\t\t\t\t]);\n\n\t\t\t\tif (branch == null || onto == null) return undefined;\n\n\t\t\t\tif (branch.startsWith('refs/heads/')) {\n\t\t\t\t\tbranch = branch.substr(11).trim();\n\t\t\t\t}\n\n\t\t\t\tconst possibleSourceBranches = await this.getCommitBranches(repoPath, onto, { mode: 'pointsAt' });\n\n\t\t\t\tlet possibleSourceBranch: string | undefined;\n\t\t\t\tfor (const b of possibleSourceBranches) {\n\t\t\t\t\tif (b.startsWith('(no branch, rebasing')) continue;\n\n\t\t\t\t\tpossibleSourceBranch = b;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tstatus = {\n\t\t\t\t\ttype: 'rebase',\n\t\t\t\t\trepoPath: repoPath,\n\t\t\t\t\tmergeBase: mergeBase,\n\t\t\t\t\tHEAD: GitReference.create(rebase, repoPath, { refType: 'revision' }),\n\t\t\t\t\tonto: GitReference.create(onto, repoPath, { refType: 'revision' }),\n\t\t\t\t\tcurrent:\n\t\t\t\t\t\tpossibleSourceBranch != null\n\t\t\t\t\t\t\t? GitReference.create(possibleSourceBranch, repoPath, {\n\t\t\t\t\t\t\t\t\trefType: 'branch',\n\t\t\t\t\t\t\t\t\tname: possibleSourceBranch,\n\t\t\t\t\t\t\t\t\tremote: false,\n\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t: undefined,\n\n\t\t\t\t\tincoming: GitReference.create(branch, repoPath, {\n\t\t\t\t\t\trefType: 'branch',\n\t\t\t\t\t\tname: branch,\n\t\t\t\t\t\tremote: false,\n\t\t\t\t\t}),\n\t\t\t\t\tsteps: {\n\t\t\t\t\t\tcurrent: {\n\t\t\t\t\t\t\tnumber: stepsNumber ?? 0,\n\t\t\t\t\t\t\tcommit: GitReference.create(rebase, repoPath, {\n\t\t\t\t\t\t\t\trefType: 'revision',\n\t\t\t\t\t\t\t\tmessage: stepsMessage,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttotal: stepsTotal ?? 0,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (this.useCaching) {\n\t\t\t\tthis._rebaseStatusCache.set(repoPath, status ?? null);\n\t\t\t}\n\t\t}\n\n\t\treturn status ?? undefined;\n\t}\n\n\t@log()\n\tasync getNextComparisonUris(\n\t\trepoPath: string,\n\t\turi: Uri,\n\t\tref: string | undefined,\n\t\tskip: number = 0,\n\t): Promise<NextComparisionUrisResult | undefined> {\n\t\t// If we have no ref (or staged ref) there is no next commit\n\t\tif (!ref) return undefined;\n\n\t\tconst relativePath = this.getRelativePath(uri, repoPath);\n\n\t\tif (GitRevision.isUncommittedStaged(ref)) {\n\t\t\treturn {\n\t\t\t\tcurrent: GitUri.fromFile(relativePath, repoPath, ref),\n\t\t\t\tnext: GitUri.fromFile(relativePath, repoPath, undefined),\n\t\t\t};\n\t\t}\n\n\t\tconst next = await this.getNextUri(repoPath, uri, ref, skip);\n\t\tif (next == null) {\n\t\t\tconst status = await this.getStatusForFile(repoPath, uri);\n\t\t\tif (status != null) {\n\t\t\t\t// If the file is staged, diff with the staged version\n\t\t\t\tif (status.indexStatus != null) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcurrent: GitUri.fromFile(relativePath, repoPath, ref),\n\t\t\t\t\t\tnext: GitUri.fromFile(relativePath, repoPath, GitRevision.uncommittedStaged),\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tcurrent: GitUri.fromFile(relativePath, repoPath, ref),\n\t\t\t\tnext: GitUri.fromFile(relativePath, repoPath, undefined),\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tcurrent:\n\t\t\t\tskip === 0\n\t\t\t\t\t? GitUri.fromFile(relativePath, repoPath, ref)\n\t\t\t\t\t: (await this.getNextUri(repoPath, uri, ref, skip - 1))!,\n\t\t\tnext: next,\n\t\t};\n\t}\n\n\t@log()\n\tprivate async getNextUri(\n\t\trepoPath: string,\n\t\turi: Uri,\n\t\tref?: string,\n\t\tskip: number = 0,\n\t\t// editorLine?: number\n\t): Promise<GitUri | undefined> {\n\t\t// If we have no ref (or staged ref) there is no next commit\n\t\tif (!ref || GitRevision.isUncommittedStaged(ref)) return undefined;\n\n\t\tlet filters: GitDiffFilter[] | undefined;\n\t\tif (ref === GitRevision.deletedOrMissing) {\n\t\t\t// If we are trying to move next from a deleted or missing ref then get the first commit\n\t\t\tref = undefined;\n\t\t\tfilters = ['A'];\n\t\t}\n\n\t\tconst relativePath = this.getRelativePath(uri, repoPath);\n\t\tlet data = await this.git.log__file(repoPath, relativePath, ref, {\n\t\t\targsOrFormat: GitLogParser.simpleFormat,\n\t\t\tfileMode: 'simple',\n\t\t\tfilters: filters,\n\t\t\tlimit: skip + 1,\n\t\t\tordering: this.container.config.advanced.commitOrdering,\n\t\t\treverse: true,\n\t\t\t// startLine: editorLine != null ? editorLine + 1 : undefined,\n\t\t});\n\t\tif (data == null || data.length === 0) return undefined;\n\n\t\tconst [nextRef, file, status] = GitLogParser.parseSimple(data, skip);\n\t\t// If the file was deleted, check for a possible rename\n\t\tif (status === 'D') {\n\t\t\tdata = await this.git.log__file(repoPath, '.', nextRef, {\n\t\t\t\targsOrFormat: GitLogParser.simpleFormat,\n\t\t\t\tfileMode: 'simple',\n\t\t\t\tfilters: ['R', 'C'],\n\t\t\t\tlimit: 1,\n\t\t\t\tordering: this.container.config.advanced.commitOrdering,\n\t\t\t\t// startLine: editorLine != null ? editorLine + 1 : undefined\n\t\t\t});\n\t\t\tif (data == null || data.length === 0) {\n\t\t\t\treturn GitUri.fromFile(file ?? relativePath, repoPath, nextRef);\n\t\t\t}\n\n\t\t\tconst [nextRenamedRef, renamedFile] = GitLogParser.parseSimpleRenamed(data, file ?? relativePath);\n\t\t\treturn GitUri.fromFile(\n\t\t\t\trenamedFile ?? file ?? relativePath,\n\t\t\t\trepoPath,\n\t\t\t\tnextRenamedRef ?? nextRef ?? GitRevision.deletedOrMissing,\n\t\t\t);\n\t\t}\n\n\t\treturn GitUri.fromFile(file ?? relativePath, repoPath, nextRef);\n\t}\n\n\t@log()\n\tasync getPreviousComparisonUris(\n\t\trepoPath: string,\n\t\turi: Uri,\n\t\tref: string | undefined,\n\t\tskip: number = 0,\n\t\tfirstParent: boolean = false,\n\t): Promise<PreviousComparisionUrisResult | undefined> {\n\t\tif (ref === GitRevision.deletedOrMissing) return undefined;\n\n\t\tconst relativePath = this.getRelativePath(uri, repoPath);\n\n\t\t// If we are at the working tree (i.e. no ref), we need to dig deeper to figure out where to go\n\t\tif (!ref) {\n\t\t\t// First, check the file status to see if there is anything staged\n\t\t\tconst status = await this.getStatusForFile(repoPath, uri);\n\t\t\tif (status != null) {\n\t\t\t\t// If the file is staged with working changes, diff working with staged (index)\n\t\t\t\t// If the file is staged without working changes, diff staged with HEAD\n\t\t\t\tif (status.indexStatus != null) {\n\t\t\t\t\t// Backs up to get to HEAD\n\t\t\t\t\tif (status.workingTreeStatus == null) {\n\t\t\t\t\t\tskip++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (skip === 0) {\n\t\t\t\t\t\t// Diff working with staged\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcurrent: GitUri.fromFile(relativePath, repoPath, undefined),\n\t\t\t\t\t\t\tprevious: GitUri.fromFile(relativePath, repoPath, GitRevision.uncommittedStaged),\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\t// Diff staged with HEAD (or prior if more skips)\n\t\t\t\t\t\tcurrent: GitUri.fromFile(relativePath, repoPath, GitRevision.uncommittedStaged),\n\t\t\t\t\t\tprevious: await this.getPreviousUri(repoPath, uri, ref, skip - 1, undefined, firstParent),\n\t\t\t\t\t};\n\t\t\t\t} else if (status.workingTreeStatus != null) {\n\t\t\t\t\tif (skip === 0) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcurrent: GitUri.fromFile(relativePath, repoPath, undefined),\n\t\t\t\t\t\t\tprevious: await this.getPreviousUri(repoPath, uri, undefined, skip, undefined, firstParent),\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (skip === 0) {\n\t\t\t\tskip++;\n\t\t\t}\n\t\t}\n\t\t// If we are at the index (staged), diff staged with HEAD\n\t\telse if (GitRevision.isUncommittedStaged(ref)) {\n\t\t\tconst current =\n\t\t\t\tskip === 0\n\t\t\t\t\t? GitUri.fromFile(relativePath, repoPath, ref)\n\t\t\t\t\t: (await this.getPreviousUri(repoPath, uri, undefined, skip - 1, undefined, firstParent))!;\n\t\t\tif (current == null || current.sha === GitRevision.deletedOrMissing) return undefined;\n\n\t\t\treturn {\n\t\t\t\tcurrent: current,\n\t\t\t\tprevious: await this.getPreviousUri(repoPath, uri, undefined, skip, undefined, firstParent),\n\t\t\t};\n\t\t}\n\n\t\t// If we are at a commit, diff commit with previous\n\t\tconst current =\n\t\t\tskip === 0\n\t\t\t\t? GitUri.fromFile(relativePath, repoPath, ref)\n\t\t\t\t: (await this.getPreviousUri(repoPath, uri, ref, skip - 1, undefined, firstParent))!;\n\t\tif (current == null || current.sha === GitRevision.deletedOrMissing) return undefined;\n\n\t\treturn {\n\t\t\tcurrent: current,\n\t\t\tprevious: await this.getPreviousUri(repoPath, uri, ref, skip, undefined, firstParent),\n\t\t};\n\t}\n\n\t@log()\n\tasync getPreviousComparisonUrisForLine(\n\t\trepoPath: string,\n\t\turi: Uri,\n\t\teditorLine: number, // 0-based, Git is 1-based\n\t\tref: string | undefined,\n\t\tskip: number = 0,\n\t): Promise<PreviousLineComparisionUrisResult | undefined> {\n\t\tif (ref === GitRevision.deletedOrMissing) return undefined;\n\n\t\tlet relativePath = this.getRelativePath(uri, repoPath);\n\n\t\tlet previous;\n\n\t\t// If we are at the working tree (i.e. no ref), we need to dig deeper to figure out where to go\n\t\tif (!ref) {\n\t\t\t// First, check the blame on the current line to see if there are any working/staged changes\n\t\t\tconst gitUri = new GitUri(uri, repoPath);\n\n\t\t\tconst document = await workspace.openTextDocument(uri);\n\t\t\tconst blameLine = document.isDirty\n\t\t\t\t? await this.getBlameForLineContents(gitUri, editorLine, document.getText())\n\t\t\t\t: await this.getBlameForLine(gitUri, editorLine);\n\t\t\tif (blameLine == null) return undefined;\n\n\t\t\t// If line is uncommitted, we need to dig deeper to figure out where to go (because blame can't be trusted)\n\t\t\tif (blameLine.commit.isUncommitted) {\n\t\t\t\t// If the document is dirty (unsaved), use the status to determine where to go\n\t\t\t\tif (document.isDirty) {\n\t\t\t\t\t// Check the file status to see if there is anything staged\n\t\t\t\t\tconst status = await this.getStatusForFile(repoPath, uri);\n\t\t\t\t\tif (status != null) {\n\t\t\t\t\t\t// If the file is staged, diff working with staged (index)\n\t\t\t\t\t\t// If the file is not staged, diff working with HEAD\n\t\t\t\t\t\tif (status.indexStatus != null) {\n\t\t\t\t\t\t\t// Diff working with staged\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tcurrent: GitUri.fromFile(relativePath, repoPath, undefined),\n\t\t\t\t\t\t\t\tprevious: GitUri.fromFile(relativePath, repoPath, GitRevision.uncommittedStaged),\n\t\t\t\t\t\t\t\tline: editorLine,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Diff working with HEAD (or prior if more skips)\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcurrent: GitUri.fromFile(relativePath, repoPath, undefined),\n\t\t\t\t\t\tprevious: await this.getPreviousUri(repoPath, uri, undefined, skip, editorLine),\n\t\t\t\t\t\tline: editorLine,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// First, check if we have a diff in the working tree\n\t\t\t\tlet hunkLine = await this.getDiffForLine(gitUri, editorLine, undefined);\n\t\t\t\tif (hunkLine == null) {\n\t\t\t\t\t// Next, check if we have a diff in the index (staged)\n\t\t\t\t\thunkLine = await this.getDiffForLine(gitUri, editorLine, undefined, GitRevision.uncommittedStaged);\n\n\t\t\t\t\tif (hunkLine != null) {\n\t\t\t\t\t\tref = GitRevision.uncommittedStaged;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tskip++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// If line is committed, diff with line ref with previous\n\t\t\telse {\n\t\t\t\tref = blameLine.commit.sha;\n\t\t\t\trelativePath = blameLine.commit.file?.path ?? blameLine.commit.file?.originalPath ?? relativePath;\n\t\t\t\turi = this.getAbsoluteUri(relativePath, repoPath);\n\t\t\t\teditorLine = blameLine.line.originalLine - 1;\n\n\t\t\t\tif (skip === 0 && blameLine.commit.file?.previousSha) {\n\t\t\t\t\tprevious = GitUri.fromFile(relativePath, repoPath, blameLine.commit.file.previousSha);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (GitRevision.isUncommittedStaged(ref)) {\n\t\t\t\tconst current =\n\t\t\t\t\tskip === 0\n\t\t\t\t\t\t? GitUri.fromFile(relativePath, repoPath, ref)\n\t\t\t\t\t\t: (await this.getPreviousUri(repoPath, uri, undefined, skip - 1, editorLine))!;\n\t\t\t\tif (current.sha === GitRevision.deletedOrMissing) return undefined;\n\n\t\t\t\treturn {\n\t\t\t\t\tcurrent: current,\n\t\t\t\t\tprevious: await this.getPreviousUri(repoPath, uri, undefined, skip, editorLine),\n\t\t\t\t\tline: editorLine,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst gitUri = new GitUri(uri, { repoPath: repoPath, sha: ref });\n\t\t\tconst blameLine = await this.getBlameForLine(gitUri, editorLine);\n\t\t\tif (blameLine == null) return undefined;\n\n\t\t\t// Diff with line ref with previous\n\t\t\tref = blameLine.commit.sha;\n\t\t\trelativePath = blameLine.commit.file?.path ?? blameLine.commit.file?.originalPath ?? relativePath;\n\t\t\turi = this.getAbsoluteUri(relativePath, repoPath);\n\t\t\teditorLine = blameLine.line.originalLine - 1;\n\n\t\t\tif (skip === 0 && blameLine.commit.file?.previousSha) {\n\t\t\t\tprevious = GitUri.fromFile(relativePath, repoPath, blameLine.commit.file.previousSha);\n\t\t\t}\n\t\t}\n\n\t\tconst current =\n\t\t\tskip === 0\n\t\t\t\t? GitUri.fromFile(relativePath, repoPath, ref)\n\t\t\t\t: (await this.getPreviousUri(repoPath, uri, ref, skip - 1, editorLine))!;\n\t\tif (current.sha === GitRevision.deletedOrMissing) return undefined;\n\n\t\treturn {\n\t\t\tcurrent: current,\n\t\t\tprevious: previous ?? (await this.getPreviousUri(repoPath, uri, ref, skip, editorLine)),\n\t\t\tline: editorLine,\n\t\t};\n\t}\n\n\t@log()\n\tprivate async getPreviousUri(\n\t\trepoPath: string,\n\t\turi: Uri,\n\t\tref?: string,\n\t\tskip: number = 0,\n\t\teditorLine?: number,\n\t\tfirstParent: boolean = false,\n\t): Promise<GitUri | undefined> {\n\t\tif (ref === GitRevision.deletedOrMissing) return undefined;\n\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tif (ref === GitRevision.uncommitted) {\n\t\t\tref = undefined;\n\t\t}\n\n\t\tconst relativePath = this.getRelativePath(uri, repoPath);\n\n\t\t// TODO: Add caching\n\t\tlet data;\n\t\ttry {\n\t\t\tdata = await this.git.log__file(repoPath, relativePath, ref, {\n\t\t\t\targsOrFormat: GitLogParser.simpleFormat,\n\t\t\t\tfileMode: 'simple',\n\t\t\t\tfirstParent: firstParent,\n\t\t\t\tlimit: skip + 2,\n\t\t\t\tordering: this.container.config.advanced.commitOrdering,\n\t\t\t\tstartLine: editorLine != null ? editorLine + 1 : undefined,\n\t\t\t});\n\t\t} catch (ex) {\n\t\t\tconst msg: string = ex?.toString() ?? '';\n\t\t\t// If the line count is invalid just fallback to the most recent commit\n\t\t\tif ((ref == null || GitRevision.isUncommittedStaged(ref)) && GitErrors.invalidLineCount.test(msg)) {\n\t\t\t\tif (ref == null) {\n\t\t\t\t\tconst status = await this.getStatusForFile(repoPath, uri);\n\t\t\t\t\tif (status?.indexStatus != null) {\n\t\t\t\t\t\treturn GitUri.fromFile(relativePath, repoPath, GitRevision.uncommittedStaged);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tref = await this.git.log__file_recent(repoPath, relativePath, {\n\t\t\t\t\tordering: this.container.config.advanced.commitOrdering,\n\t\t\t\t});\n\t\t\t\treturn GitUri.fromFile(relativePath, repoPath, ref ?? GitRevision.deletedOrMissing);\n\t\t\t}\n\n\t\t\tLogger.error(ex, cc);\n\t\t\tthrow ex;\n\t\t}\n\t\tif (data == null || data.length === 0) return undefined;\n\n\t\tconst [previousRef, file] = GitLogParser.parseSimple(data, skip, ref);\n\t\t// If the previous ref matches the ref we asked for assume we are at the end of the history\n\t\tif (ref != null && ref === previousRef) return undefined;\n\n\t\treturn GitUri.fromFile(file ?? relativePath, repoPath, previousRef ?? GitRevision.deletedOrMissing);\n\t}\n\n\t@log()\n\tasync getIncomingActivity(\n\t\trepoPath: string,\n\t\toptions?: { all?: boolean; branch?: string; limit?: number; ordering?: string | null; skip?: number },\n\t): Promise<GitReflog | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst limit = options?.limit ?? this.container.config.advanced.maxListItems ?? 0;\n\t\ttry {\n\t\t\t// Pass a much larger limit to reflog, because we aggregate the data and we won't know how many lines we'll need\n\t\t\tconst data = await this.git.reflog(repoPath, {\n\t\t\t\tordering: this.container.config.advanced.commitOrdering,\n\t\t\t\t...options,\n\t\t\t\tlimit: limit * 100,\n\t\t\t});\n\t\t\tif (data == null) return undefined;\n\n\t\t\tconst reflog = GitReflogParser.parse(data, repoPath, reflogCommands, limit, limit * 100);\n\t\t\tif (reflog?.hasMore) {\n\t\t\t\treflog.more = this.getReflogMoreFn(reflog, options);\n\t\t\t}\n\n\t\t\treturn reflog;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprivate getReflogMoreFn(\n\t\treflog: GitReflog,\n\t\toptions?: { all?: boolean; branch?: string; limit?: number; ordering?: string | null; skip?: number },\n\t): (limit: number) => Promise<GitReflog> {\n\t\treturn async (limit: number | undefined) => {\n\t\t\tlimit = limit ?? this.container.config.advanced.maxSearchItems ?? 0;\n\n\t\t\tconst moreLog = await this.getIncomingActivity(reflog.repoPath, {\n\t\t\t\t...options,\n\t\t\t\tlimit: limit,\n\t\t\t\tskip: reflog.total,\n\t\t\t});\n\t\t\tif (moreLog == null) {\n\t\t\t\t// If we can't find any more, assume we have everything\n\t\t\t\treturn { ...reflog, hasMore: false };\n\t\t\t}\n\n\t\t\tconst mergedLog: GitReflog = {\n\t\t\t\trepoPath: reflog.repoPath,\n\t\t\t\trecords: [...reflog.records, ...moreLog.records],\n\t\t\t\tcount: reflog.count + moreLog.count,\n\t\t\t\ttotal: reflog.total + moreLog.total,\n\t\t\t\tlimit: (reflog.limit ?? 0) + limit,\n\t\t\t\thasMore: moreLog.hasMore,\n\t\t\t};\n\t\t\tmergedLog.more = this.getReflogMoreFn(mergedLog, options);\n\n\t\t\treturn mergedLog;\n\t\t};\n\t}\n\n\t@log({ args: { 1: false } })\n\tasync getRemotes(\n\t\trepoPath: string | undefined,\n\t\toptions?: { providers?: RemoteProviders; sort?: boolean },\n\t): Promise<GitRemote<RemoteProvider | RichRemoteProvider | undefined>[]> {\n\t\tif (repoPath == null) return [];\n\n\t\tconst providers = options?.providers ?? RemoteProviderFactory.loadProviders(configuration.get('remotes', null));\n\n\t\ttry {\n\t\t\tconst data = await this.git.remote(repoPath);\n\t\t\tconst remotes = GitRemoteParser.parse(data, repoPath, RemoteProviderFactory.factory(providers));\n\t\t\tif (remotes == null) return [];\n\n\t\t\tif (options?.sort) {\n\t\t\t\tGitRemote.sort(remotes);\n\t\t\t}\n\n\t\t\treturn remotes;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t@gate()\n\t@log()\n\tgetRevisionContent(repoPath: string, path: string, ref: string): Promise<Uint8Array | undefined> {\n\t\tconst [relativePath, root] = splitPath(path, repoPath);\n\n\t\treturn this.git.show<Buffer>(root, relativePath, ref, { encoding: 'buffer' });\n\t}\n\n\t@gate()\n\t@log()\n\tasync getStash(repoPath: string | undefined): Promise<GitStash | undefined> {\n\t\tif (repoPath == null) return undefined;\n\n\t\tlet stash = this.useCaching ? this._stashesCache.get(repoPath) : undefined;\n\t\tif (stash === undefined) {\n\t\t\tconst data = await this.git.stash__list(repoPath, {\n\t\t\t\tsimilarityThreshold: this.container.config.advanced.similarityThreshold,\n\t\t\t});\n\t\t\tstash = GitStashParser.parse(this.container, data, repoPath);\n\n\t\t\tif (this.useCaching) {\n\t\t\t\tthis._stashesCache.set(repoPath, stash ?? null);\n\t\t\t}\n\t\t}\n\n\t\treturn stash ?? undefined;\n\t}\n\n\t@log()\n\tasync getStatusForFile(repoPath: string, uri: Uri): Promise<GitStatusFile | undefined> {\n\t\tconst porcelainVersion = (await this.git.isAtLeastVersion('2.11')) ? 2 : 1;\n\n\t\tconst [relativePath, root] = splitPath(uri, repoPath);\n\n\t\tconst data = await this.git.status__file(root, relativePath, porcelainVersion, {\n\t\t\tsimilarityThreshold: this.container.config.advanced.similarityThreshold,\n\t\t});\n\t\tconst status = GitStatusParser.parse(data, root, porcelainVersion);\n\t\tif (status == null || !status.files.length) return undefined;\n\n\t\treturn status.files[0];\n\t}\n\n\t@log()\n\tasync getStatusForFiles(repoPath: string, pathOrGlob: Uri): Promise<GitStatusFile[] | undefined> {\n\t\tconst porcelainVersion = (await this.git.isAtLeastVersion('2.11')) ? 2 : 1;\n\n\t\tconst [relativePath, root] = splitPath(pathOrGlob, repoPath);\n\n\t\tconst data = await this.git.status__file(root, relativePath, porcelainVersion, {\n\t\t\tsimilarityThreshold: this.container.config.advanced.similarityThreshold,\n\t\t});\n\t\tconst status = GitStatusParser.parse(data, root, porcelainVersion);\n\t\tif (status == null || !status.files.length) return [];\n\n\t\treturn status.files;\n\t}\n\n\t@log()\n\tasync getStatusForRepo(repoPath: string | undefined): Promise<GitStatus | undefined> {\n\t\tif (repoPath == null) return undefined;\n\n\t\tconst porcelainVersion = (await this.git.isAtLeastVersion('2.11')) ? 2 : 1;\n\n\t\tconst data = await this.git.status(repoPath, porcelainVersion, {\n\t\t\tsimilarityThreshold: this.container.config.advanced.similarityThreshold,\n\t\t});\n\t\tconst status = GitStatusParser.parse(data, repoPath, porcelainVersion);\n\n\t\tif (status?.detached) {\n\t\t\tconst rebaseStatus = await this.getRebaseStatus(repoPath);\n\t\t\tif (rebaseStatus != null) {\n\t\t\t\treturn new GitStatus(\n\t\t\t\t\trepoPath,\n\t\t\t\t\trebaseStatus.incoming.name,\n\t\t\t\t\tstatus.sha,\n\t\t\t\t\tstatus.files,\n\t\t\t\t\tstatus.state,\n\t\t\t\t\tstatus.upstream,\n\t\t\t\t\ttrue,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn status;\n\t}\n\n\t@log({ args: { 1: false } })\n\tasync getTags(\n\t\trepoPath: string | undefined,\n\t\toptions?: { cursor?: string; filter?: (t: GitTag) => boolean; sort?: boolean | TagSortOptions },\n\t): Promise<PagedResult<GitTag>> {\n\t\tif (repoPath == null) return emptyPagedResult;\n\n\t\tlet resultsPromise = this.useCaching ? this._tagsCache.get(repoPath) : undefined;\n\t\tif (resultsPromise == null) {\n\t\t\tasync function load(this: LocalGitProvider): Promise<PagedResult<GitTag>> {\n\t\t\t\ttry {\n\t\t\t\t\tconst data = await this.git.tag(repoPath!);\n\t\t\t\t\treturn { values: GitTagParser.parse(data, repoPath!) ?? [] };\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tthis._tagsCache.delete(repoPath!);\n\n\t\t\t\t\treturn emptyPagedResult;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresultsPromise = load.call(this);\n\n\t\t\tif (this.useCaching) {\n\t\t\t\tthis._tagsCache.set(repoPath, resultsPromise);\n\t\t\t}\n\t\t}\n\n\t\tlet result = await resultsPromise;\n\t\tif (options?.filter != null) {\n\t\t\tresult = {\n\t\t\t\t...result,\n\t\t\t\tvalues: result.values.filter(options.filter),\n\t\t\t};\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\tif (options?.sort) {\n\t\t\tGitTag.sort(result.values, typeof options.sort === 'boolean' ? undefined : options.sort);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t@log()\n\tasync getTreeEntryForRevision(repoPath: string, path: string, ref: string): Promise<GitTreeEntry | undefined> {\n\t\tif (repoPath == null || !path) return undefined;\n\n\t\tconst [relativePath, root] = splitPath(path, repoPath);\n\n\t\tconst data = await this.git.ls_tree(root, ref, relativePath);\n\t\tconst trees = GitTreeParser.parse(data);\n\t\treturn trees?.length ? trees[0] : undefined;\n\t}\n\n\t@log()\n\tasync getTreeForRevision(repoPath: string, ref: string): Promise<GitTreeEntry[]> {\n\t\tif (repoPath == null) return [];\n\n\t\tconst data = await this.git.ls_tree(repoPath, ref);\n\t\treturn GitTreeParser.parse(data) ?? [];\n\t}\n\n\t@log({ args: { 1: false } })\n\tasync hasBranchOrTag(\n\t\trepoPath: string | undefined,\n\t\toptions?: {\n\t\t\tfilter?: { branches?: (b: GitBranch) => boolean; tags?: (t: GitTag) => boolean };\n\t\t},\n\t) {\n\t\tconst [{ values: branches }, { values: tags }] = await Promise.all([\n\t\t\tthis.getBranches(repoPath, {\n\t\t\t\tfilter: options?.filter?.branches,\n\t\t\t\tsort: false,\n\t\t\t}),\n\t\t\tthis.getTags(repoPath, {\n\t\t\t\tfilter: options?.filter?.tags,\n\t\t\t\tsort: false,\n\t\t\t}),\n\t\t]);\n\n\t\treturn branches.length !== 0 || tags.length !== 0;\n\t}\n\n\t@log()\n\tasync hasCommitBeenPushed(repoPath: string, ref: string): Promise<boolean> {\n\t\tif (repoPath == null) return false;\n\n\t\treturn this.git.merge_base__is_ancestor(repoPath, ref, '@{u}');\n\t}\n\n\tisTrackable(uri: Uri): boolean {\n\t\treturn this.supportedSchemes.has(uri.scheme);\n\t}\n\n\tprivate async isTracked(uri: GitUri): Promise<[string, string] | undefined>;\n\tprivate async isTracked(path: string, repoPath?: string, ref?: string): Promise<[string, string] | undefined>;\n\t@log<LocalGitProvider['isTracked']>({ exit: tracked => `returned ${Boolean(tracked)}` })\n\tprivate async isTracked(\n\t\tpathOrUri: string | GitUri,\n\t\trepoPath?: string,\n\t\tref?: string,\n\t): Promise<[string, string] | undefined> {\n\t\tlet relativePath: string;\n\t\tlet repository: Repository | undefined;\n\n\t\tif (typeof pathOrUri === 'string') {\n\t\t\tif (ref === GitRevision.deletedOrMissing) return undefined;\n\n\t\t\trepository = this.container.git.getRepository(Uri.file(pathOrUri));\n\t\t\trepoPath = repoPath || repository?.path;\n\n\t\t\t[relativePath, repoPath] = splitPath(pathOrUri, repoPath);\n\t\t} else {\n\t\t\tif (!this.isTrackable(pathOrUri)) return undefined;\n\n\t\t\t// Always use the ref of the GitUri\n\t\t\tref = pathOrUri.sha;\n\t\t\tif (ref === GitRevision.deletedOrMissing) return undefined;\n\n\t\t\trepository = this.container.git.getRepository(pathOrUri);\n\t\t\trepoPath = repoPath || repository?.path;\n\n\t\t\t[relativePath, repoPath] = splitPath(pathOrUri, repoPath);\n\t\t}\n\n\t\tconst path = repoPath ? `${repoPath}/${relativePath}` : relativePath;\n\n\t\tlet key = path;\n\t\tkey = `${ref ?? ''}:${key[0] === '/' ? key : `/${key}`}`;\n\n\t\tlet tracked = this._trackedPaths.get(key);\n\t\tif (tracked != null) return tracked;\n\n\t\ttracked = this.isTrackedCore(path, relativePath, repoPath ?? '', ref, repository);\n\t\tthis._trackedPaths.set(key, tracked);\n\n\t\ttracked = await tracked;\n\t\tthis._trackedPaths.set(key, tracked);\n\t\treturn tracked;\n\t}\n\n\t@debug()\n\tprivate async isTrackedCore(\n\t\tpath: string,\n\t\trelativePath: string,\n\t\trepoPath: string,\n\t\tref: string | undefined,\n\t\trepository: Repository | undefined,\n\t): Promise<[string, string] | undefined> {\n\t\tif (ref === GitRevision.deletedOrMissing) return undefined;\n\n\t\ttry {\n\t\t\twhile (true) {\n\t\t\t\tif (!repoPath) {\n\t\t\t\t\t[relativePath, repoPath] = splitPath(path, '', true);\n\t\t\t\t}\n\n\t\t\t\t// Even if we have a ref, check first to see if the file exists (that way the cache will be better reused)\n\t\t\t\tlet tracked = Boolean(await this.git.ls_files(repoPath, relativePath));\n\t\t\t\tif (tracked) return [relativePath, repoPath];\n\n\t\t\t\tif (repoPath) {\n\t\t\t\t\tconst [newRelativePath, newRepoPath] = splitPath(path, '', true);\n\t\t\t\t\tif (newRelativePath !== relativePath) {\n\t\t\t\t\t\t// If we didn't find it, check it as close to the file as possible (will find nested repos)\n\t\t\t\t\t\ttracked = Boolean(await this.git.ls_files(newRepoPath, newRelativePath));\n\t\t\t\t\t\tif (tracked) {\n\t\t\t\t\t\t\trepository = await this.container.git.getOrOpenRepository(Uri.file(path), true);\n\t\t\t\t\t\t\tif (repository != null) {\n\t\t\t\t\t\t\t\treturn splitPath(path, repository.path);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn [newRelativePath, newRepoPath];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!tracked && ref && !GitRevision.isUncommitted(ref)) {\n\t\t\t\t\ttracked = Boolean(await this.git.ls_files(repoPath, relativePath, { ref: ref }));\n\t\t\t\t\t// If we still haven't found this file, make sure it wasn't deleted in that ref (i.e. check the previous)\n\t\t\t\t\tif (!tracked) {\n\t\t\t\t\t\ttracked = Boolean(await this.git.ls_files(repoPath, relativePath, { ref: `${ref}^` }));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Since the file isn't tracked, make sure it isn't part of a nested repository we don't know about yet\n\t\t\t\tif (!tracked) {\n\t\t\t\t\tif (repository != null) {\n\t\t\t\t\t\t// Don't look for a nested repository if the file isn't at least one folder deep\n\t\t\t\t\t\tconst index = relativePath.indexOf('/');\n\t\t\t\t\t\tif (index < 0 || index === relativePath.length - 1) return undefined;\n\n\t\t\t\t\t\tconst nested = await this.container.git.getOrOpenRepository(Uri.file(path), true);\n\t\t\t\t\t\tif (nested != null && nested !== repository) {\n\t\t\t\t\t\t\t[relativePath, repoPath] = splitPath(path, repository.path);\n\t\t\t\t\t\t\trepository = undefined;\n\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\treturn [relativePath, repoPath];\n\t\t\t}\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log()\n\tasync getDiffTool(repoPath?: string): Promise<string | undefined> {\n\t\treturn (\n\t\t\t(await this.git.config__get('diff.guitool', repoPath, { local: true })) ??\n\t\t\tthis.git.config__get('diff.tool', repoPath, { local: true })\n\t\t);\n\t}\n\n\t@log()\n\tasync openDiffTool(\n\t\trepoPath: string,\n\t\turi: Uri,\n\t\toptions?: { ref1?: string; ref2?: string; staged?: boolean; tool?: string },\n\t): Promise<void> {\n\t\tconst [relativePath, root] = splitPath(uri, repoPath);\n\n\t\ttry {\n\t\t\tlet tool = options?.tool;\n\t\t\tif (!tool) {\n\t\t\t\tconst cc = Logger.getCorrelationContext();\n\n\t\t\t\ttool = this.container.config.advanced.externalDiffTool || (await this.getDiffTool(root));\n\t\t\t\tif (tool == null) throw new Error('No diff tool found');\n\n\t\t\t\tLogger.log(cc, `Using tool=${tool}`);\n\t\t\t}\n\n\t\t\tawait this.git.difftool(root, relativePath, tool, options);\n\t\t} catch (ex) {\n\t\t\tconst msg: string = ex?.toString() ?? '';\n\t\t\tif (msg === 'No diff tool found' || /Unknown .+? tool/.test(msg)) {\n\t\t\t\tconst viewDocs = 'View Git Docs';\n\t\t\t\tconst result = await window.showWarningMessage(\n\t\t\t\t\t'Unable to open changes because the specified diff tool cannot be found or no Git diff tool is configured',\n\t\t\t\t\tviewDocs,\n\t\t\t\t);\n\t\t\t\tif (result === viewDocs) {\n\t\t\t\t\tvoid env.openExternal(\n\t\t\t\t\t\tUri.parse('https://git-scm.com/docs/git-config#Documentation/git-config.txt-difftool'),\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tLogger.error(ex, 'openDiffTool');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open compare');\n\t\t}\n\t}\n\n\t@log()\n\tasync openDirectoryCompare(repoPath: string, ref1: string, ref2?: string, tool?: string): Promise<void> {\n\t\ttry {\n\t\t\tif (!tool) {\n\t\t\t\tconst cc = Logger.getCorrelationContext();\n\n\t\t\t\ttool = this.container.config.advanced.externalDirectoryDiffTool || (await this.getDiffTool(repoPath));\n\t\t\t\tif (tool == null) throw new Error('No diff tool found');\n\n\t\t\t\tLogger.log(cc, `Using tool=${tool}`);\n\t\t\t}\n\n\t\t\tawait this.git.difftool__dir_diff(repoPath, tool, ref1, ref2);\n\t\t} catch (ex) {\n\t\t\tconst msg: string = ex?.toString() ?? '';\n\t\t\tif (msg === 'No diff tool found' || /Unknown .+? tool/.test(msg)) {\n\t\t\t\tconst viewDocs = 'View Git Docs';\n\t\t\t\tconst result = await window.showWarningMessage(\n\t\t\t\t\t'Unable to open directory compare because the specified diff tool cannot be found or no Git diff tool is configured',\n\t\t\t\t\tviewDocs,\n\t\t\t\t);\n\t\t\t\tif (result === viewDocs) {\n\t\t\t\t\tvoid env.openExternal(\n\t\t\t\t\t\tUri.parse('https://git-scm.com/docs/git-config#Documentation/git-config.txt-difftool'),\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tLogger.error(ex, 'openDirectoryCompare');\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to open directory compare');\n\t\t}\n\t}\n\n\t@log()\n\tasync resolveReference(repoPath: string, ref: string, pathOrUri?: string | Uri, options?: { timeout?: number }) {\n\t\tif (\n\t\t\t!ref ||\n\t\t\tref === GitRevision.deletedOrMissing ||\n\t\t\t(pathOrUri == null && GitRevision.isSha(ref)) ||\n\t\t\t(pathOrUri != null && GitRevision.isUncommitted(ref))\n\t\t) {\n\t\t\treturn ref;\n\t\t}\n\n\t\tif (pathOrUri == null) {\n\t\t\t// If it doesn't look like a sha at all (e.g. branch name) or is a stash ref (^3) don't try to resolve it\n\t\t\tif (!GitRevision.isShaLike(ref) || ref.endsWith('^3')) return ref;\n\n\t\t\treturn (await this.git.rev_parse__verify(repoPath, ref)) ?? ref;\n\t\t}\n\n\t\tconst relativePath = this.getRelativePath(pathOrUri, repoPath);\n\n\t\tconst blob = await this.git.rev_parse__verify(repoPath, ref, relativePath);\n\t\tif (blob == null) return GitRevision.deletedOrMissing;\n\n\t\tlet promise: Promise<string | void | undefined> = this.git.log__find_object(\n\t\t\trepoPath,\n\t\t\tblob,\n\t\t\tref,\n\t\t\tthis.container.config.advanced.commitOrdering,\n\t\t\trelativePath,\n\t\t);\n\t\tif (options?.timeout != null) {\n\t\t\tpromise = Promise.race([promise, wait(options.timeout)]);\n\t\t}\n\n\t\treturn (await promise) ?? ref;\n\t}\n\n\t@log()\n\tvalidateBranchOrTagName(repoPath: string, ref: string): Promise<boolean> {\n\t\treturn this.git.check_ref_format(ref, repoPath);\n\t}\n\n\t@log()\n\tasync validateReference(repoPath: string, ref: string): Promise<boolean> {\n\t\tif (ref == null || ref.length === 0) return false;\n\t\tif (ref === GitRevision.deletedOrMissing || GitRevision.isUncommitted(ref)) return true;\n\n\t\treturn (await this.git.rev_parse__verify(repoPath, ref)) != null;\n\t}\n\n\t@log()\n\tasync stageFile(repoPath: string, pathOrUri: string | Uri): Promise<void> {\n\t\tawait this.git.add(repoPath, typeof pathOrUri === 'string' ? pathOrUri : splitPath(pathOrUri, repoPath)[0]);\n\t}\n\n\t@log()\n\tasync stageDirectory(repoPath: string, directoryOrUri: string | Uri): Promise<void> {\n\t\tawait this.git.add(\n\t\t\trepoPath,\n\t\t\ttypeof directoryOrUri === 'string' ? directoryOrUri : splitPath(directoryOrUri, repoPath)[0],\n\t\t);\n\t}\n\n\t@log()\n\tasync unStageFile(repoPath: string, pathOrUri: string | Uri): Promise<void> {\n\t\tawait this.git.reset(repoPath, typeof pathOrUri === 'string' ? pathOrUri : splitPath(pathOrUri, repoPath)[0]);\n\t}\n\n\t@log()\n\tasync unStageDirectory(repoPath: string, directoryOrUri: string | Uri): Promise<void> {\n\t\tawait this.git.reset(\n\t\t\trepoPath,\n\t\t\ttypeof directoryOrUri === 'string' ? directoryOrUri : splitPath(directoryOrUri, repoPath)[0],\n\t\t);\n\t}\n\n\t@log()\n\tasync stashApply(repoPath: string, stashName: string, options?: { deleteAfter?: boolean }): Promise<void> {\n\t\ttry {\n\t\t\tawait this.git.stash__apply(repoPath, stashName, Boolean(options?.deleteAfter));\n\t\t} catch (ex) {\n\t\t\tif (ex instanceof Error) {\n\t\t\t\tconst msg: string = ex.message ?? '';\n\t\t\t\tif (msg.includes('Your local changes to the following files would be overwritten by merge')) {\n\t\t\t\t\tthrow new StashApplyError(StashApplyErrorReason.WorkingChanges, ex);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\t(msg.includes('Auto-merging') && msg.includes('CONFLICT')) ||\n\t\t\t\t\t(ex instanceof RunError &&\n\t\t\t\t\t\t((ex.stdout.includes('Auto-merging') && ex.stdout.includes('CONFLICT')) ||\n\t\t\t\t\t\t\tex.stdout.includes('needs merge')))\n\t\t\t\t) {\n\t\t\t\t\tvoid window.showInformationMessage('Stash applied with conflicts');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrow new StashApplyError(`Unable to apply stash \\u2014 ${msg.trim().replace(/\\n+?/g, '; ')}`, ex);\n\t\t\t}\n\n\t\t\tthrow new StashApplyError(`Unable to apply stash \\u2014 ${String(ex)}`, ex);\n\t\t}\n\t}\n\n\t@log()\n\tasync stashDelete(repoPath: string, stashName: string, ref?: string): Promise<void> {\n\t\tawait this.git.stash__delete(repoPath, stashName, ref);\n\t}\n\n\t@log<LocalGitProvider['stashSave']>({ args: { 2: uris => uris?.length } })\n\tasync stashSave(\n\t\trepoPath: string,\n\t\tmessage?: string,\n\t\turis?: Uri[],\n\t\toptions?: { includeUntracked?: boolean; keepIndex?: boolean },\n\t): Promise<void> {\n\t\tif (uris == null) return this.git.stash__push(repoPath, message, options);\n\n\t\tawait this.ensureGitVersion(\n\t\t\t'2.13.2',\n\t\t\t'Stashing individual files',\n\t\t\t' Please retry by stashing everything or install a more recent version of Git and try again.',\n\t\t);\n\n\t\tconst pathspecs = uris.map(u => `./${splitPath(u, repoPath)[0]}`);\n\n\t\tconst stdinVersion = '2.30.0';\n\t\tconst stdin = await this.git.isAtLeastVersion(stdinVersion);\n\t\t// If we don't support stdin, then error out if we are over the maximum allowed git cli length\n\t\tif (!stdin && countStringLength(pathspecs) > maxGitCliLength) {\n\t\t\tawait this.ensureGitVersion(\n\t\t\t\tstdinVersion,\n\t\t\t\t`Stashing so many files (${pathspecs.length}) at once`,\n\t\t\t\t' Please retry by stashing fewer files or install a more recent version of Git and try again.',\n\t\t\t);\n\t\t}\n\n\t\treturn this.git.stash__push(repoPath, message, {\n\t\t\t...options,\n\t\t\tpathspecs: pathspecs,\n\t\t\tstdin: stdin,\n\t\t});\n\t}\n\n\t@log()\n\tasync createWorktree(\n\t\trepoPath: string,\n\t\tpath: string,\n\t\toptions?: { commitish?: string; createBranch?: string; detach?: boolean; force?: boolean },\n\t) {\n\t\ttry {\n\t\t\tawait this.git.worktree__add(repoPath, path, options);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\n\t\t\tconst msg = String(ex);\n\n\t\t\tif (GitErrors.alreadyCheckedOut.test(msg)) {\n\t\t\t\tthrow new WorktreeCreateError(WorktreeCreateErrorReason.AlreadyCheckedOut, ex);\n\t\t\t}\n\n\t\t\tif (GitErrors.alreadyExists.test(msg)) {\n\t\t\t\tthrow new WorktreeCreateError(WorktreeCreateErrorReason.AlreadyExists, ex);\n\t\t\t}\n\n\t\t\tthrow new WorktreeCreateError(undefined, ex);\n\t\t}\n\t}\n\n\t@gate()\n\t@log()\n\tasync getWorktrees(repoPath: string): Promise<GitWorktree[]> {\n\t\tawait this.ensureGitVersion(\n\t\t\t'2.7.6',\n\t\t\t'Displaying worktrees',\n\t\t\t' Please install a more recent version of Git and try again.',\n\t\t);\n\n\t\tconst data = await this.git.worktree__list(repoPath);\n\t\treturn GitWorktreeParser.parse(data, repoPath);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/require-await\n\t@log()\n\tasync getWorktreesDefaultUri(repoPath: string): Promise<Uri | undefined> {\n\t\tlet location = configuration.get('worktrees.defaultLocation');\n\t\tif (location == null) return undefined;\n\n\t\tif (location.startsWith('~')) {\n\t\t\tlocation = joinPaths(homedir(), location.slice(1));\n\t\t}\n\n\t\treturn this.getAbsoluteUri(location, repoPath); //isAbsolute(location) ? GitUri.file(location) : ;\n\t}\n\n\t@log()\n\tasync deleteWorktree(repoPath: string, path: string, options?: { force?: boolean }) {\n\t\tawait this.ensureGitVersion(\n\t\t\t'2.17.0',\n\t\t\t'Deleting worktrees',\n\t\t\t' Please install a more recent version of Git and try again.',\n\t\t);\n\n\t\ttry {\n\t\t\tawait this.git.worktree__remove(repoPath, path, options);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\n\t\t\tconst msg = String(ex);\n\n\t\t\tif (GitErrors.mainWorkingTree.test(msg)) {\n\t\t\t\tthrow new WorktreeDeleteError(WorktreeDeleteErrorReason.MainWorkingTree, ex);\n\t\t\t}\n\n\t\t\tif (GitErrors.uncommittedChanges.test(msg)) {\n\t\t\t\tthrow new WorktreeDeleteError(WorktreeDeleteErrorReason.HasChanges, ex);\n\t\t\t}\n\n\t\t\tthrow new WorktreeDeleteError(undefined, ex);\n\t\t}\n\t}\n\n\tprivate _scmGitApi: Promise<BuiltInGitApi | undefined> | undefined;\n\tprivate async getScmGitApi(): Promise<BuiltInGitApi | undefined> {\n\t\treturn this._scmGitApi ?? (this._scmGitApi = this.getScmGitApiCore());\n\t}\n\n\t@log()\n\tprivate async getScmGitApiCore(): Promise<BuiltInGitApi | undefined> {\n\t\ttry {\n\t\t\tconst extension = extensions.getExtension<GitExtension>('vscode.git');\n\t\t\tif (extension == null) return undefined;\n\n\t\t\tconst gitExtension = extension.isActive ? extension.exports : await extension.activate();\n\t\t\treturn gitExtension?.getAPI(1);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprivate getScmGitUri(path: string, repoPath: string): Uri {\n\t\tconst uri = this.getAbsoluteUri(path, repoPath);\n\t\treturn Uri.from({\n\t\t\tscheme: Schemes.Git,\n\t\t\tpath: uri.path,\n\t\t\tquery: JSON.stringify({\n\t\t\t\t// Ensure we use the fsPath here, otherwise the url won't open properly\n\t\t\t\tpath: uri.fsPath,\n\t\t\t\tref: '~',\n\t\t\t}),\n\t\t});\n\t}\n\n\t@log()\n\tasync getOpenScmRepositories(): Promise<ScmRepository[]> {\n\t\tconst cc = Logger.getCorrelationContext();\n\t\ttry {\n\t\t\tconst gitApi = await this.getScmGitApi();\n\t\t\treturn gitApi?.repositories ?? [];\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t@log()\n\tasync getOrOpenScmRepository(repoPath: string): Promise<ScmRepository | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\t\ttry {\n\t\t\tconst gitApi = await this.getScmGitApi();\n\t\t\tif (gitApi?.openRepository != null) {\n\t\t\t\treturn (await gitApi?.openRepository?.(Uri.file(repoPath))) ?? undefined;\n\t\t\t}\n\n\t\t\treturn gitApi?.getRepository(Uri.file(repoPath)) ?? undefined;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log()\n\tprivate async openScmRepository(uri: Uri): Promise<BuiltInGitRepository | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\t\ttry {\n\t\t\tconst gitApi = await this.getScmGitApi();\n\t\t\treturn (await gitApi?.openRepository?.(uri)) ?? undefined;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprivate async ensureGitVersion(version: string, prefix: string, suffix: string): Promise<void> {\n\t\tif (await this.git.isAtLeastVersion(version)) return;\n\n\t\tthrow new Error(\n\t\t\t`${prefix} requires a newer version of Git (>= ${version}) than is currently installed (${await this.git.version()}).${suffix}`,\n\t\t);\n\t}\n}\n","import { FileType, Uri, workspace } from 'vscode';\nimport { Schemes } from '../../../constants';\nimport { Container } from '../../../container';\nimport { GitCommandOptions } from '../../../git/commandOptions';\nimport { GitProviderDescriptor, GitProviderId } from '../../../git/gitProvider';\nimport { Repository } from '../../../git/models/repository';\nimport { Logger } from '../../../logger';\nimport { addVslsPrefixIfNeeded, dirname } from '../../../system/path';\nimport { Git } from './git';\nimport { LocalGitProvider } from './localGitProvider';\n\nexport class VslsGit extends Git {\n\tconstructor(private readonly localGit: Git) {\n\t\tsuper();\n\t}\n\n\toverride async git<TOut extends string | Buffer>(options: GitCommandOptions, ...args: any[]): Promise<TOut> {\n\t\tif (options.local) {\n\t\t\t// Since we will have a live share path here, just blank it out\n\t\t\toptions.cwd = '';\n\t\t\treturn this.localGit.git<TOut>(options, ...args);\n\t\t}\n\n\t\tconst guest = await Container.instance.vsls.guest();\n\t\tif (guest == null) {\n\t\t\tdebugger;\n\t\t\tthrow new Error('No guest');\n\t\t}\n\n\t\treturn guest.git<TOut>(options, ...args);\n\t}\n}\n\nexport class VslsGitProvider extends LocalGitProvider {\n\toverride readonly descriptor: GitProviderDescriptor = { id: GitProviderId.Vsls, name: 'Live Share' };\n\toverride readonly supportedSchemes: Set<string> = new Set([Schemes.Vsls, Schemes.VslsScc]);\n\n\toverride async discoverRepositories(uri: Uri): Promise<Repository[]> {\n\t\tif (!this.supportedSchemes.has(uri.scheme)) return [];\n\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\ttry {\n\t\t\tconst guest = await this.container.vsls.guest();\n\t\t\tconst repositories = await guest?.getRepositoriesForUri(uri);\n\t\t\tif (repositories == null || repositories.length === 0) return [];\n\n\t\t\treturn repositories.map(r =>\n\t\t\t\tthis.openRepository(undefined, Uri.parse(r.folderUri, true), r.root, undefined, r.closed),\n\t\t\t);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\tdebugger;\n\n\t\t\treturn [];\n\t\t}\n\t}\n\n\toverride canHandlePathOrUri(scheme: string, pathOrUri: string | Uri): string | undefined {\n\t\t// TODO@eamodio To support virtual repositories, we need to verify that the path is local here (by converting the shared path to a local path)\n\t\treturn super.canHandlePathOrUri(scheme, pathOrUri);\n\t}\n\n\toverride getAbsoluteUri(pathOrUri: string | Uri, base: string | Uri): Uri {\n\t\tpathOrUri = addVslsPrefixIfNeeded(pathOrUri);\n\n\t\tconst scheme =\n\t\t\t(typeof base !== 'string' ? base.scheme : undefined) ??\n\t\t\t(typeof pathOrUri !== 'string' ? pathOrUri.scheme : undefined) ??\n\t\t\tSchemes.Vsls;\n\n\t\treturn super.getAbsoluteUri(pathOrUri, base).with({ scheme: scheme });\n\t}\n\n\toverride async findRepositoryUri(uri: Uri, isDirectory?: boolean): Promise<Uri | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tlet repoPath: string | undefined;\n\t\ttry {\n\t\t\tif (!isDirectory) {\n\t\t\t\ttry {\n\t\t\t\t\tconst stats = await workspace.fs.stat(uri);\n\t\t\t\t\turi = stats?.type === FileType.Directory ? uri : uri.with({ path: dirname(uri.fsPath) });\n\t\t\t\t} catch {}\n\t\t\t}\n\n\t\t\trepoPath = await this.git.rev_parse__show_toplevel(uri.fsPath);\n\t\t\tif (!repoPath) return undefined;\n\n\t\t\treturn repoPath ? Uri.parse(repoPath, true) : undefined;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\toverride getLastFetchedTimestamp(_repoPath: string): Promise<number | undefined> {\n\t\treturn Promise.resolve(undefined);\n\t}\n}\n","import { Container } from '../../container';\nimport { GitCommandOptions } from '../../git/commandOptions';\nimport { GitProvider } from '../../git/gitProvider';\n// import { GitHubGitProvider } from '../../premium/github/githubGitProvider';\nimport { Git } from './git/git';\nimport { LocalGitProvider } from './git/localGitProvider';\nimport { VslsGit, VslsGitProvider } from './git/vslsGitProvider';\n\nlet gitInstance: Git | undefined;\nfunction ensureGit() {\n\tif (gitInstance == null) {\n\t\tgitInstance = new Git();\n\t}\n\treturn gitInstance;\n}\n\nexport function git(_options: GitCommandOptions, ..._args: any[]): Promise<string | Buffer> {\n\treturn ensureGit().git(_options, ..._args);\n}\n\nexport async function getSupportedGitProviders(container: Container): Promise<GitProvider[]> {\n\tconst git = ensureGit();\n\n\tconst providers: GitProvider[] = [\n\t\tnew LocalGitProvider(container, git),\n\t\tnew VslsGitProvider(container, new VslsGit(git)),\n\t];\n\n\tif (container.config.experimental.virtualRepositories.enabled) {\n\t\tconst GitHubGitProvider = (\n\t\t\tawait import(/* webpackChunkName: \"github\" */ '../../premium/github/githubGitProvider')\n\t\t).GitHubGitProvider;\n\t\tproviders.push(new GitHubGitProvider(container));\n\t}\n\n\treturn providers;\n}\n","import { ConfigurationChangeEvent, Disposable } from 'vscode';\nimport { AutolinkReference, configuration } from '../configuration';\nimport { GlyphChars } from '../constants';\nimport { Container } from '../container';\nimport { GitRemote, IssueOrPullRequest } from '../git/models';\nimport { Logger } from '../logger';\nimport { fromNow } from '../system/date';\nimport { debug } from '../system/decorators/log';\nimport { encodeUrl } from '../system/encoding';\nimport { every, join, map } from '../system/iterable';\nimport { PromiseCancelledError, raceAll } from '../system/promise';\nimport { escapeMarkdown, escapeRegex, getSuperscript } from '../system/string';\n\nconst numRegex = /<num>/g;\n\nexport interface CacheableAutolinkReference extends AutolinkReference {\n\tlinkify?: ((text: string, markdown: boolean, footnotes?: Map<number, string>) => string) | null;\n\tmessageMarkdownRegex?: RegExp;\n\tmessageRegex?: RegExp;\n}\n\nexport interface DynamicAutolinkReference {\n\tlinkify: (text: string, markdown: boolean, footnotes?: Map<number, string>) => string;\n}\n\nfunction isDynamic(ref: AutolinkReference | DynamicAutolinkReference): ref is DynamicAutolinkReference {\n\treturn (ref as AutolinkReference).prefix === undefined && (ref as AutolinkReference).url === undefined;\n}\n\nfunction isCacheable(ref: AutolinkReference | DynamicAutolinkReference): ref is CacheableAutolinkReference {\n\treturn (ref as AutolinkReference).prefix !== undefined && (ref as AutolinkReference).url !== undefined;\n}\n\nexport class Autolinks implements Disposable {\n\tprotected _disposable: Disposable | undefined;\n\tprivate _references: CacheableAutolinkReference[] = [];\n\n\tconstructor(private readonly container: Container) {\n\t\tthis._disposable = Disposable.from(configuration.onDidChange(this.onConfigurationChanged, this));\n\n\t\tthis.onConfigurationChanged();\n\t}\n\n\tdispose() {\n\t\tthis._disposable?.dispose();\n\t}\n\n\tprivate onConfigurationChanged(e?: ConfigurationChangeEvent) {\n\t\tif (configuration.changed(e, 'autolinks')) {\n\t\t\tthis._references = this.container.config.autolinks ?? [];\n\t\t}\n\t}\n\n\t@debug<Autolinks['getIssueOrPullRequestLinks']>({\n\t\targs: {\n\t\t\t0: '<message>',\n\t\t\t1: false,\n\t\t\t2: options => options?.timeout,\n\t\t},\n\t})\n\tasync getIssueOrPullRequestLinks(message: string, remote: GitRemote, { timeout }: { timeout?: number } = {}) {\n\t\tif (!remote.hasRichProvider()) return undefined;\n\n\t\tconst { provider } = remote;\n\t\tconst connected = provider.maybeConnected ?? (await provider.isConnected());\n\t\tif (!connected) return undefined;\n\n\t\tconst ids = new Set<string>();\n\n\t\tlet match;\n\t\tlet num;\n\t\tfor (const ref of provider.autolinks) {\n\t\t\tif (!isCacheable(ref)) continue;\n\n\t\t\tif (ref.messageRegex === undefined) {\n\t\t\t\tref.messageRegex = new RegExp(\n\t\t\t\t\t`(?<=^|\\\\s|\\\\(|\\\\\\\\\\\\[)(${escapeRegex(ref.prefix)}([${ref.alphanumeric ? '\\\\w' : '0-9'}]+))\\\\b`,\n\t\t\t\t\tref.ignoreCase ? 'gi' : 'g',\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tdo {\n\t\t\t\tmatch = ref.messageRegex.exec(message);\n\t\t\t\tif (match == null) break;\n\n\t\t\t\t[, , num] = match;\n\n\t\t\t\tids.add(num);\n\t\t\t} while (true);\n\t\t}\n\n\t\tif (ids.size === 0) return undefined;\n\n\t\tconst issuesOrPullRequests = await raceAll(ids.values(), id => provider.getIssueOrPullRequest(id), timeout);\n\t\tif (issuesOrPullRequests.size === 0 || every(issuesOrPullRequests.values(), pr => pr === undefined)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn issuesOrPullRequests;\n\t}\n\n\t@debug<Autolinks['linkify']>({\n\t\targs: {\n\t\t\t0: '<text>',\n\t\t\t2: remotes => remotes?.length,\n\t\t\t3: issuesOrPullRequests => issuesOrPullRequests?.size,\n\t\t\t4: footnotes => footnotes?.size,\n\t\t},\n\t})\n\tlinkify(\n\t\ttext: string,\n\t\tmarkdown: boolean,\n\t\tremotes?: GitRemote[],\n\t\tissuesOrPullRequests?: Map<string, IssueOrPullRequest | PromiseCancelledError | undefined>,\n\t\tfootnotes?: Map<number, string>,\n\t) {\n\t\tfor (const ref of this._references) {\n\t\t\tif (this.ensureAutolinkCached(ref, issuesOrPullRequests)) {\n\t\t\t\tif (ref.linkify != null) {\n\t\t\t\t\ttext = ref.linkify(text, markdown, footnotes);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (remotes != null && remotes.length !== 0) {\n\t\t\tfor (const r of remotes) {\n\t\t\t\tif (r.provider === undefined) continue;\n\n\t\t\t\tfor (const ref of r.provider.autolinks) {\n\t\t\t\t\tif (this.ensureAutolinkCached(ref, issuesOrPullRequests)) {\n\t\t\t\t\t\tif (ref.linkify != null) {\n\t\t\t\t\t\t\ttext = ref.linkify(text, markdown, footnotes);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn text;\n\t}\n\n\tprivate ensureAutolinkCached(\n\t\tref: CacheableAutolinkReference | DynamicAutolinkReference,\n\t\tissuesOrPullRequests?: Map<string, IssueOrPullRequest | PromiseCancelledError | undefined>,\n\t): ref is CacheableAutolinkReference | DynamicAutolinkReference {\n\t\tif (isDynamic(ref)) return true;\n\n\t\ttry {\n\t\t\tif (ref.messageMarkdownRegex === undefined) {\n\t\t\t\tref.messageMarkdownRegex = new RegExp(\n\t\t\t\t\t`(?<=^|\\\\s|\\\\(|\\\\\\\\\\\\[)(${escapeRegex(escapeMarkdown(ref.prefix))}([${\n\t\t\t\t\t\tref.alphanumeric ? '\\\\w' : '0-9'\n\t\t\t\t\t}]+))\\\\b`,\n\t\t\t\t\tref.ignoreCase ? 'gi' : 'g',\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (issuesOrPullRequests == null || issuesOrPullRequests.size === 0) {\n\t\t\t\tconst replacement = `[$1](${encodeUrl(ref.url.replace(numRegex, '$2'))}${\n\t\t\t\t\tref.title ? ` \"${ref.title.replace(numRegex, '$2')}\"` : ''\n\t\t\t\t})`;\n\t\t\t\tref.linkify = (text: string, markdown: boolean) =>\n\t\t\t\t\tmarkdown ? text.replace(ref.messageMarkdownRegex!, replacement) : text;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tref.linkify = (text: string, markdown: boolean, footnotes?: Map<number, string>) => {\n\t\t\t\tconst includeFootnotes = footnotes == null;\n\t\t\t\tlet index;\n\n\t\t\t\tif (markdown) {\n\t\t\t\t\treturn text.replace(ref.messageMarkdownRegex!, (_substring, linkText, num) => {\n\t\t\t\t\t\tconst issue = issuesOrPullRequests?.get(num);\n\n\t\t\t\t\t\tconst issueUrl = encodeUrl(ref.url.replace(numRegex, num));\n\n\t\t\t\t\t\tlet title = '';\n\t\t\t\t\t\tif (ref.title) {\n\t\t\t\t\t\t\ttitle = ` \"${ref.title.replace(numRegex, num)}`;\n\n\t\t\t\t\t\t\tif (issue != null) {\n\t\t\t\t\t\t\t\tif (issue instanceof PromiseCancelledError) {\n\t\t\t\t\t\t\t\t\ttitle += `\\n${GlyphChars.Dash.repeat(2)}\\nDetails timed out`;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tconst issueTitle = issue.title.replace(/([\")\\\\])/g, '\\\\$1').trim();\n\n\t\t\t\t\t\t\t\t\tif (footnotes != null) {\n\t\t\t\t\t\t\t\t\t\tindex = footnotes.size + 1;\n\t\t\t\t\t\t\t\t\t\tfootnotes.set(\n\t\t\t\t\t\t\t\t\t\t\tindex,\n\t\t\t\t\t\t\t\t\t\t\t`${IssueOrPullRequest.getMarkdownIcon(\n\t\t\t\t\t\t\t\t\t\t\t\tissue,\n\t\t\t\t\t\t\t\t\t\t\t)} [**${issueTitle}**](${issueUrl}${title}\")\\\\\\n${GlyphChars.Space.repeat(\n\t\t\t\t\t\t\t\t\t\t\t\t5,\n\t\t\t\t\t\t\t\t\t\t\t)}${linkText} ${issue.closed ? 'closed' : 'opened'} ${fromNow(\n\t\t\t\t\t\t\t\t\t\t\t\tissue.closedDate ?? issue.date,\n\t\t\t\t\t\t\t\t\t\t\t)}`,\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\ttitle += `\\n${GlyphChars.Dash.repeat(2)}\\n${issueTitle}\\n${\n\t\t\t\t\t\t\t\t\t\tissue.closed ? 'Closed' : 'Opened'\n\t\t\t\t\t\t\t\t\t}, ${fromNow(issue.closedDate ?? issue.date)}`;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttitle += '\"';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn `[${linkText}](${issueUrl}${title})`;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\ttext = text.replace(ref.messageRegex!, (_substring, linkText, num) => {\n\t\t\t\t\tconst issue = issuesOrPullRequests?.get(num);\n\t\t\t\t\tif (issue == null) return linkText;\n\n\t\t\t\t\tif (footnotes === undefined) {\n\t\t\t\t\t\tfootnotes = new Map<number, string>();\n\t\t\t\t\t}\n\n\t\t\t\t\tindex = footnotes.size + 1;\n\t\t\t\t\tfootnotes.set(\n\t\t\t\t\t\tindex,\n\t\t\t\t\t\t`${linkText}: ${\n\t\t\t\t\t\t\tissue instanceof PromiseCancelledError\n\t\t\t\t\t\t\t\t? 'Details timed out'\n\t\t\t\t\t\t\t\t: `${issue.title}  ${GlyphChars.Dot}  ${issue.closed ? 'Closed' : 'Opened'}, ${fromNow(\n\t\t\t\t\t\t\t\t\t\tissue.closedDate ?? issue.date,\n\t\t\t\t\t\t\t\t  )}`\n\t\t\t\t\t\t}`,\n\t\t\t\t\t);\n\t\t\t\t\treturn `${linkText}${getSuperscript(index)}`;\n\t\t\t\t});\n\n\t\t\t\treturn includeFootnotes && footnotes != null && footnotes.size !== 0\n\t\t\t\t\t? `${text}\\n${GlyphChars.Dash.repeat(2)}\\n${join(\n\t\t\t\t\t\t\tmap(footnotes, ([i, footnote]) => `${getSuperscript(i)} ${footnote}`),\n\t\t\t\t\t\t\t'\\n',\n\t\t\t\t\t  )}`\n\t\t\t\t\t: text;\n\t\t\t};\n\t\t} catch (ex) {\n\t\t\tLogger.error(\n\t\t\t\tex,\n\t\t\t\t`Failed to create autolink generator: prefix=${ref.prefix}, url=${ref.url}, title=${ref.title}`,\n\t\t\t);\n\t\t\tref.linkify = null;\n\t\t}\n\n\t\treturn true;\n\t}\n}\n","import {\n\tDecorationOptions,\n\tDisposable,\n\tRange,\n\tTextDocument,\n\tTextEditor,\n\tTextEditorDecorationType,\n\tTextEditorSelectionChangeEvent,\n\tUri,\n\twindow,\n} from 'vscode';\nimport { FileAnnotationType } from '../configuration';\nimport { ContextKeys } from '../constants';\nimport { setContext } from '../context';\nimport { Logger } from '../logger';\nimport { GitDocumentState, TrackedDocument } from '../trackers/gitDocumentTracker';\n\nexport const enum AnnotationStatus {\n\tComputing = 'computing',\n\tComputed = 'computed',\n}\n\nexport interface AnnotationContext {\n\tselection?: { sha?: string; line?: undefined } | { sha?: undefined; line?: number } | false;\n}\n\nexport type TextEditorCorrelationKey = string;\n\nexport abstract class AnnotationProviderBase<TContext extends AnnotationContext = AnnotationContext>\n\timplements Disposable\n{\n\tstatic getCorrelationKey(editor: TextEditor | undefined): TextEditorCorrelationKey {\n\t\treturn `${editor?.document.uri.toString()}|${editor?.viewColumn}`;\n\t}\n\n\tannotationContext: TContext | undefined;\n\tcorrelationKey: TextEditorCorrelationKey;\n\tdocument: TextDocument;\n\tstatus: AnnotationStatus | undefined;\n\n\tprivate decorations:\n\t\t| { decorationType: TextEditorDecorationType; rangesOrOptions: Range[] | DecorationOptions[] }[]\n\t\t| undefined;\n\tprotected disposable: Disposable;\n\n\tconstructor(\n\t\tpublic readonly annotationType: FileAnnotationType,\n\t\tpublic editor: TextEditor,\n\t\tprotected readonly trackedDocument: TrackedDocument<GitDocumentState>,\n\t) {\n\t\tthis.correlationKey = AnnotationProviderBase.getCorrelationKey(this.editor);\n\t\tthis.document = this.editor.document;\n\n\t\tthis.disposable = Disposable.from(\n\t\t\twindow.onDidChangeTextEditorSelection(this.onTextEditorSelectionChanged, this),\n\t\t);\n\t}\n\n\tdispose() {\n\t\tthis.clear();\n\n\t\tthis.disposable.dispose();\n\t}\n\n\tprivate onTextEditorSelectionChanged(e: TextEditorSelectionChangeEvent) {\n\t\tif (this.document !== e.textEditor.document) return;\n\n\t\tvoid this.selection({ line: e.selections[0].active.line });\n\t}\n\n\tget editorUri(): Uri | undefined {\n\t\treturn this.editor?.document?.uri;\n\t}\n\n\tclear() {\n\t\tthis.annotationContext = undefined;\n\t\tthis.status = undefined;\n\t\tif (this.editor == null) return;\n\n\t\tif (this.decorations?.length) {\n\t\t\tfor (const d of this.decorations) {\n\t\t\t\ttry {\n\t\t\t\t\tthis.editor.setDecorations(d.decorationType, []);\n\t\t\t\t} catch {}\n\t\t\t}\n\n\t\t\tthis.decorations = undefined;\n\t\t}\n\t}\n\n\tmustReopen(_context?: TContext): boolean {\n\t\treturn false;\n\t}\n\n\tasync restore(editor: TextEditor) {\n\t\t// If the editor isn't disposed then we don't need to do anything\n\t\t// Explicitly check for `false`\n\t\tif ((this.editor as any)._disposed === false) return;\n\n\t\tthis.status = AnnotationStatus.Computing;\n\t\tif (editor === window.activeTextEditor) {\n\t\t\tawait setContext(ContextKeys.AnnotationStatus, this.status);\n\t\t}\n\n\t\tthis.editor = editor;\n\t\tthis.correlationKey = AnnotationProviderBase.getCorrelationKey(editor);\n\t\tthis.document = editor.document;\n\n\t\tif (this.decorations?.length) {\n\t\t\tfor (const d of this.decorations) {\n\t\t\t\tthis.editor.setDecorations(d.decorationType, d.rangesOrOptions);\n\t\t\t}\n\t\t}\n\n\t\tthis.status = AnnotationStatus.Computed;\n\t\tif (editor === window.activeTextEditor) {\n\t\t\tawait setContext(ContextKeys.AnnotationStatus, this.status);\n\t\t}\n\t}\n\n\tasync provideAnnotation(context?: TContext): Promise<boolean> {\n\t\tthis.status = AnnotationStatus.Computing;\n\t\ttry {\n\t\t\tif (await this.onProvideAnnotation(context)) {\n\t\t\t\tthis.status = AnnotationStatus.Computed;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\t\t}\n\n\t\tthis.status = undefined;\n\t\treturn false;\n\t}\n\n\tprotected abstract onProvideAnnotation(context?: TContext): Promise<boolean>;\n\n\tabstract selection(selection?: TContext['selection']): Promise<void>;\n\n\tprotected setDecorations(\n\t\tdecorations: { decorationType: TextEditorDecorationType; rangesOrOptions: Range[] | DecorationOptions[] }[],\n\t) {\n\t\tif (this.decorations?.length) {\n\t\t\tthis.clear();\n\t\t}\n\n\t\tthis.decorations = decorations;\n\t\tif (this.decorations?.length) {\n\t\t\tfor (const d of this.decorations) {\n\t\t\t\tthis.editor.setDecorations(d.decorationType, d.rangesOrOptions);\n\t\t\t}\n\t\t}\n\t}\n\n\tabstract validate(): Promise<boolean>;\n}\n","const cssColorRegex =\n\t/^(?:(#?)([0-9a-f]{3}|[0-9a-f]{6})|((?:rgb|hsl)a?)\\((-?\\d+%?)[,\\s]+(-?\\d+%?)[,\\s]+(-?\\d+%?)[,\\s]*(-?[\\d.]+%?)?\\))$/i;\n\nfunction adjustLight(color: number, amount: number) {\n\tconst cc = color + amount;\n\tconst c = amount < 0 ? (cc < 0 ? 0 : cc) : cc > 255 ? 255 : cc;\n\n\treturn Math.round(c);\n}\n\nexport function darken(color: string, percentage: number) {\n\treturn lighten(color, -percentage);\n}\n\nexport function lighten(color: string, percentage: number) {\n\tconst rgba = toRgba(color);\n\tif (rgba == null) return color;\n\n\tconst [r, g, b, a] = rgba;\n\tconst amount = (255 * percentage) / 100;\n\treturn `rgba(${adjustLight(r, amount)}, ${adjustLight(g, amount)}, ${adjustLight(b, amount)}, ${a})`;\n}\n\nexport function opacity(color: string, percentage: number) {\n\tconst rgba = toRgba(color);\n\tif (rgba == null) return color;\n\n\tconst [r, g, b, a] = rgba;\n\treturn `rgba(${r}, ${g}, ${b}, ${a * (percentage / 100)})`;\n}\n\nexport function toRgba(color: string) {\n\tcolor = color.trim();\n\n\tconst result = cssColorRegex.exec(color);\n\tif (result == null) return null;\n\n\tif (result[1] === '#') {\n\t\tconst hex = result[2];\n\t\tswitch (hex.length) {\n\t\t\tcase 3:\n\t\t\t\treturn [parseInt(hex[0] + hex[0], 16), parseInt(hex[1] + hex[1], 16), parseInt(hex[2] + hex[2], 16), 1];\n\t\t\tcase 6:\n\t\t\t\treturn [\n\t\t\t\t\tparseInt(hex.substring(0, 2), 16),\n\t\t\t\t\tparseInt(hex.substring(2, 4), 16),\n\t\t\t\t\tparseInt(hex.substring(4, 6), 16),\n\t\t\t\t\t1,\n\t\t\t\t];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tswitch (result[3]) {\n\t\tcase 'rgb':\n\t\t\treturn [parseInt(result[4], 10), parseInt(result[5], 10), parseInt(result[6], 10), 1];\n\t\tcase 'rgba':\n\t\t\treturn [parseInt(result[4], 10), parseInt(result[5], 10), parseInt(result[6], 10), parseFloat(result[7])];\n\t\tdefault:\n\t\t\treturn null;\n\t}\n}\n","import {\n\tDecorationInstanceRenderOptions,\n\tDecorationOptions,\n\tOverviewRulerLane,\n\tRange,\n\tTextEditorDecorationType,\n\tThemableDecorationAttachmentRenderOptions,\n\tThemableDecorationRenderOptions,\n\tThemeColor,\n\tUri,\n\twindow,\n} from 'vscode';\nimport { HeatmapLocations } from '../config';\nimport { Config, configuration } from '../configuration';\nimport { Colors, GlyphChars } from '../constants';\nimport { Container } from '../container';\nimport { CommitFormatOptions, CommitFormatter } from '../git/formatters';\nimport { GitCommit } from '../git/models';\nimport { getWidth, interpolate, pad } from '../system/string';\nimport { toRgba } from '../webviews/apps/shared/colors';\n\nexport interface ComputedHeatmap {\n\tcoldThresholdTimestamp: number;\n\tcolors: { hot: string[]; cold: string[] };\n\tcomputeRelativeAge(date: Date): number;\n}\n\ninterface RenderOptions\n\textends DecorationInstanceRenderOptions,\n\t\tThemableDecorationRenderOptions,\n\t\tThemableDecorationAttachmentRenderOptions {\n\theight?: string;\n\tuncommittedColor?: string | ThemeColor;\n}\n\nconst defaultHeatmapHotColor = '#f66a0a';\nconst defaultHeatmapColdColor = '#0a60f6';\nconst defaultHeatmapColors = [\n\t'#f66a0a',\n\t'#ef6939',\n\t'#e96950',\n\t'#e26862',\n\t'#db6871',\n\t'#d3677e',\n\t'#cc678a',\n\t'#c46696',\n\t'#bb66a0',\n\t'#b365a9',\n\t'#a965b3',\n\t'#a064bb',\n\t'#9664c4',\n\t'#8a63cc',\n\t'#7e63d3',\n\t'#7162db',\n\t'#6262e2',\n\t'#5061e9',\n\t'#3961ef',\n\t'#0a60f6',\n];\n\nlet heatmapColors: { hot: string[]; cold: string[] } | undefined;\nexport async function getHeatmapColors() {\n\tif (heatmapColors == null) {\n\t\tlet colors;\n\t\tif (\n\t\t\tContainer.instance.config.heatmap.coldColor === defaultHeatmapColdColor &&\n\t\t\tContainer.instance.config.heatmap.hotColor === defaultHeatmapHotColor\n\t\t) {\n\t\t\tcolors = defaultHeatmapColors;\n\t\t} else {\n\t\t\tconst chroma = (await import(/* webpackChunkName: \"heatmap-chroma\" */ 'chroma-js')).default;\n\t\t\tcolors = chroma\n\t\t\t\t.scale([Container.instance.config.heatmap.hotColor, Container.instance.config.heatmap.coldColor])\n\t\t\t\t.mode('lrgb')\n\t\t\t\t.classes(20)\n\t\t\t\t.colors(20);\n\t\t}\n\n\t\theatmapColors = {\n\t\t\thot: colors.slice(0, 10),\n\t\t\tcold: colors.slice(10, 20),\n\t\t};\n\n\t\tconst disposable = configuration.onDidChange(e => {\n\t\t\tif (\n\t\t\t\tconfiguration.changed(e, 'heatmap.ageThreshold') ||\n\t\t\t\tconfiguration.changed(e, 'heatmap.hotColor') ||\n\t\t\t\tconfiguration.changed(e, 'heatmap.coldColor')\n\t\t\t) {\n\t\t\t\tdisposable.dispose();\n\t\t\t\theatmapColors = undefined;\n\t\t\t}\n\t\t});\n\t}\n\n\treturn heatmapColors;\n}\n\nexport class Annotations {\n\tstatic applyHeatmap(decoration: Partial<DecorationOptions>, date: Date, heatmap: ComputedHeatmap) {\n\t\tconst [r, g, b, a] = this.getHeatmapColor(date, heatmap);\n\t\tdecoration.renderOptions!.before!.borderColor = `rgba(${r},${g},${b},${a})`;\n\t}\n\n\tstatic addOrUpdateGutterHeatmapDecoration(\n\t\tdate: Date,\n\t\theatmap: ComputedHeatmap,\n\t\trange: Range,\n\t\tmap: Map<string, { decorationType: TextEditorDecorationType; rangesOrOptions: Range[] }>,\n\t) {\n\t\tconst [r, g, b, a] = this.getHeatmapColor(date, heatmap);\n\n\t\tconst { locations } = Container.instance.config.heatmap;\n\t\tconst gutter = locations.includes(HeatmapLocations.Gutter);\n\t\tconst overview = locations.includes(HeatmapLocations.Overview);\n\n\t\tconst key = `${r},${g},${b},${a}`;\n\t\tlet colorDecoration = map.get(key);\n\t\tif (colorDecoration == null) {\n\t\t\tcolorDecoration = {\n\t\t\t\tdecorationType: window.createTextEditorDecorationType({\n\t\t\t\t\tgutterIconPath: gutter\n\t\t\t\t\t\t? Uri.parse(\n\t\t\t\t\t\t\t\t`data:image/svg+xml,${encodeURIComponent(\n\t\t\t\t\t\t\t\t\t`<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 18 18'><rect fill='rgb(${r},${g},${b})' fill-opacity='${a}' x='7' y='0' width='2' height='18'/></svg>`,\n\t\t\t\t\t\t\t\t)}`,\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tgutterIconSize: gutter ? 'contain' : undefined,\n\t\t\t\t\toverviewRulerLane: overview ? OverviewRulerLane.Center : undefined,\n\t\t\t\t\toverviewRulerColor: overview ? `rgba(${r},${g},${b},${a})` : undefined,\n\t\t\t\t}),\n\t\t\t\trangesOrOptions: [range],\n\t\t\t};\n\t\t\tmap.set(key, colorDecoration);\n\t\t} else {\n\t\t\tcolorDecoration.rangesOrOptions.push(range);\n\t\t}\n\n\t\treturn colorDecoration.decorationType;\n\t}\n\n\tstatic gutter(\n\t\tcommit: GitCommit,\n\t\tformat: string,\n\t\tdateFormatOrFormatOptions: string | null | CommitFormatOptions,\n\t\trenderOptions: RenderOptions,\n\t): Partial<DecorationOptions> {\n\t\tconst decoration: Partial<DecorationOptions> = {\n\t\t\trenderOptions: {\n\t\t\t\tbefore: { ...renderOptions },\n\t\t\t},\n\t\t};\n\n\t\tif (commit.isUncommitted) {\n\t\t\tdecoration.renderOptions!.before!.color = renderOptions.uncommittedColor;\n\t\t}\n\n\t\tconst message = CommitFormatter.fromTemplate(format, commit, dateFormatOrFormatOptions);\n\t\tdecoration.renderOptions!.before!.contentText = pad(message.replace(/ /g, GlyphChars.Space), 1, 1);\n\n\t\treturn decoration;\n\t}\n\n\tstatic gutterRenderOptions(\n\t\tseparateLines: boolean,\n\t\theatmap: Config['blame']['heatmap'],\n\t\tavatars: boolean,\n\t\tformat: string,\n\t\toptions: CommitFormatOptions,\n\t): RenderOptions {\n\t\t// Get the character count of all the tokens, assuming there there is a cap (bail if not)\n\t\tlet chars = 0;\n\t\tfor (const token of Object.values(options.tokenOptions!)) {\n\t\t\tif (token === undefined) continue;\n\n\t\t\t// If any token is uncapped, kick out and set no max\n\t\t\tif (token.truncateTo == null) {\n\t\t\t\tchars = -1;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tchars += token.truncateTo;\n\t\t}\n\n\t\tif (chars >= 0) {\n\t\t\t// Add the chars of the template string (without tokens)\n\t\t\tchars += getWidth(interpolate(format, undefined));\n\t\t\t// If we have chars, add a bit of padding\n\t\t\tif (chars > 0) {\n\t\t\t\tchars += 3;\n\t\t\t}\n\t\t}\n\n\t\tlet borderStyle = undefined;\n\t\tlet borderWidth = undefined;\n\t\tif (heatmap.enabled) {\n\t\t\tborderStyle = 'solid';\n\t\t\tborderWidth = heatmap.location === 'left' ? '0 0 0 2px' : '0 2px 0 0';\n\t\t}\n\n\t\tlet width;\n\t\tif (chars >= 0) {\n\t\t\tconst spacing = configuration.getAny<number>('editor.letterSpacing');\n\t\t\tif (spacing != null && spacing !== 0) {\n\t\t\t\twidth = `calc(${chars}ch + ${Math.round(chars * spacing) + (avatars ? 13 : -6)}px)`;\n\t\t\t} else {\n\t\t\t\twidth = `calc(${chars}ch ${avatars ? '+ 13px' : '- 6px'})`;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tbackgroundColor: new ThemeColor(Colors.GutterBackgroundColor),\n\t\t\tborderStyle: borderStyle,\n\t\t\tborderWidth: borderWidth,\n\t\t\tcolor: new ThemeColor(Colors.GutterForegroundColor),\n\t\t\tfontWeight: 'normal',\n\t\t\tfontStyle: 'normal',\n\t\t\theight: '100%',\n\t\t\tmargin: '0 26px -1px 0',\n\t\t\ttextDecoration: `${separateLines ? 'overline solid rgba(0, 0, 0, .2)' : 'none'};box-sizing: border-box${\n\t\t\t\tavatars ? ';padding: 0 0 0 18px' : ''\n\t\t\t}`,\n\t\t\twidth: width,\n\t\t\tuncommittedColor: new ThemeColor(Colors.GutterUncommittedForegroundColor),\n\t\t};\n\t}\n\n\tstatic trailing(\n\t\tcommit: GitCommit,\n\t\t// uri: GitUri,\n\t\t// editorLine: number,\n\t\tformat: string,\n\t\tformatOptions?: CommitFormatOptions,\n\t\tscrollable: boolean = true,\n\t): Partial<DecorationOptions> {\n\t\t// TODO: Enable this once there is better caching\n\t\t// let diffUris;\n\t\t// if (commit.isUncommitted) {\n\t\t//     diffUris = await commit.getPreviousLineDiffUris(uri, editorLine, uri.sha);\n\t\t// }\n\n\t\tconst message = CommitFormatter.fromTemplate(format, commit, {\n\t\t\t...formatOptions,\n\t\t\t// previousLineDiffUris: diffUris,\n\t\t\tmessageTruncateAtNewLine: true,\n\t\t});\n\n\t\treturn {\n\t\t\trenderOptions: {\n\t\t\t\tafter: {\n\t\t\t\t\tbackgroundColor: new ThemeColor(Colors.TrailingLineBackgroundColor),\n\t\t\t\t\tcolor: new ThemeColor(Colors.TrailingLineForegroundColor),\n\t\t\t\t\tcontentText: pad(message.replace(/ /g, GlyphChars.Space), 1, 1),\n\t\t\t\t\tfontWeight: 'normal',\n\t\t\t\t\tfontStyle: 'normal',\n\t\t\t\t\t// Pull the decoration out of the document flow if we want to be scrollable\n\t\t\t\t\ttextDecoration: `none;${scrollable ? '' : ' position: absolute;'}`,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tprivate static getHeatmapColor(date: Date, heatmap: ComputedHeatmap) {\n\t\tconst age = heatmap.computeRelativeAge(date);\n\t\tconst colors = date.getTime() < heatmap.coldThresholdTimestamp ? heatmap.colors.cold : heatmap.colors.hot;\n\n\t\tconst color = toRgba(colors[age]);\n\t\tconst a = color == null ? 0 : age === 0 ? 1 : age <= 5 ? 0.8 : 0.6;\n\n\t\treturn [...(color ?? [0, 0, 0]), a];\n\t}\n}\n","import { CancellationToken, MarkdownString, TextDocument } from 'vscode';\nimport { hrtime } from '@env/hrtime';\nimport { DiffWithCommand, ShowQuickCommitCommand } from '../commands';\nimport { GlyphChars } from '../constants';\nimport { Container } from '../container';\nimport { CommitFormatter } from '../git/formatters';\nimport { GitUri } from '../git/gitUri';\nimport { GitCommit, GitDiffHunk, GitDiffHunkLine, GitRemote, GitRevision, PullRequest } from '../git/models';\nimport { Logger, LogLevel } from '../logger';\nimport { count } from '../system/iterable';\nimport { PromiseCancelledError } from '../system/promise';\nimport { getDurationMilliseconds } from '../system/string';\n\nexport namespace Hovers {\n\texport async function changesMessage(\n\t\tcommit: GitCommit,\n\t\turi: GitUri,\n\t\teditorLine: number, // 0-based, Git is 1-based\n\t\tdocument: TextDocument,\n\t): Promise<MarkdownString | undefined> {\n\t\tconst documentRef = uri.sha;\n\n\t\tlet previousSha = null;\n\n\t\tasync function getDiff() {\n\t\t\tif (commit.file == null) return undefined;\n\n\t\t\t// TODO: Figure out how to optimize this\n\t\t\tlet ref;\n\t\t\tif (commit.isUncommitted) {\n\t\t\t\tif (GitRevision.isUncommittedStaged(documentRef)) {\n\t\t\t\t\tref = documentRef;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpreviousSha = await commit.getPreviousSha();\n\t\t\t\tref = previousSha;\n\t\t\t\tif (ref == null) {\n\t\t\t\t\treturn `\\`\\`\\`diff\\n+ ${document.lineAt(editorLine).text}\\n\\`\\`\\``;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst line = editorLine + 1;\n\t\t\tconst commitLine = commit.lines.find(l => l.line === line) ?? commit.lines[0];\n\n\t\t\tlet originalPath = commit.file.originalPath;\n\t\t\tif (originalPath == null) {\n\t\t\t\tif (uri.fsPath !== commit.file.uri.fsPath) {\n\t\t\t\t\toriginalPath = commit.file.path;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\teditorLine = commitLine.line - 1;\n\t\t\t// TODO: Doesn't work with dirty files -- pass in editor? or contents?\n\t\t\tlet hunkLine = await Container.instance.git.getDiffForLine(uri, editorLine, ref, documentRef);\n\n\t\t\t// If we didn't find a diff & ref is undefined (meaning uncommitted), check for a staged diff\n\t\t\tif (hunkLine == null && ref == null && documentRef !== GitRevision.uncommittedStaged) {\n\t\t\t\thunkLine = await Container.instance.git.getDiffForLine(\n\t\t\t\t\turi,\n\t\t\t\t\teditorLine,\n\t\t\t\t\tundefined,\n\t\t\t\t\tGitRevision.uncommittedStaged,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn hunkLine != null ? getDiffFromHunkLine(hunkLine) : undefined;\n\t\t}\n\n\t\tconst diff = await getDiff();\n\t\tif (diff == null) return undefined;\n\n\t\tlet message;\n\t\tlet previous;\n\t\tlet current;\n\t\tif (commit.isUncommitted) {\n\t\t\tconst compareUris = await commit.getPreviousComparisonUrisForLine(editorLine, documentRef);\n\t\t\tif (compareUris?.previous == null) return undefined;\n\n\t\t\tmessage = `[$(compare-changes)](${DiffWithCommand.getMarkdownCommandArgs({\n\t\t\t\tlhs: {\n\t\t\t\t\tsha: compareUris.previous.sha ?? '',\n\t\t\t\t\turi: compareUris.previous.documentUri(),\n\t\t\t\t},\n\t\t\t\trhs: {\n\t\t\t\t\tsha: compareUris.current.sha ?? '',\n\t\t\t\t\turi: compareUris.current.documentUri(),\n\t\t\t\t},\n\t\t\t\trepoPath: commit.repoPath,\n\t\t\t\tline: editorLine,\n\t\t\t})} \"Open Changes\")`;\n\n\t\t\tprevious =\n\t\t\t\tcompareUris.previous.sha == null || compareUris.previous.isUncommitted\n\t\t\t\t\t? `  &nbsp;_${GitRevision.shorten(compareUris.previous.sha, {\n\t\t\t\t\t\t\tstrings: { working: 'Working Tree' },\n\t\t\t\t\t  })}_ &nbsp;${GlyphChars.ArrowLeftRightLong}&nbsp; `\n\t\t\t\t\t: `  &nbsp;[$(git-commit) ${GitRevision.shorten(\n\t\t\t\t\t\t\tcompareUris.previous.sha || '',\n\t\t\t\t\t  )}](${ShowQuickCommitCommand.getMarkdownCommandArgs(\n\t\t\t\t\t\t\tcompareUris.previous.sha || '',\n\t\t\t\t\t  )} \"Show Commit\") &nbsp;${GlyphChars.ArrowLeftRightLong}&nbsp; `;\n\n\t\t\tcurrent =\n\t\t\t\tcompareUris.current.sha == null || compareUris.current.isUncommitted\n\t\t\t\t\t? `_${GitRevision.shorten(compareUris.current.sha, {\n\t\t\t\t\t\t\tstrings: {\n\t\t\t\t\t\t\t\tworking: 'Working Tree',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t  })}_`\n\t\t\t\t\t: `[$(git-commit) ${GitRevision.shorten(\n\t\t\t\t\t\t\tcompareUris.current.sha || '',\n\t\t\t\t\t  )}](${ShowQuickCommitCommand.getMarkdownCommandArgs(\n\t\t\t\t\t\t\tcompareUris.current.sha || '',\n\t\t\t\t\t  )} \"Show Commit\")`;\n\t\t} else {\n\t\t\tmessage = `[$(compare-changes)](${DiffWithCommand.getMarkdownCommandArgs(\n\t\t\t\tcommit,\n\t\t\t\teditorLine,\n\t\t\t)} \"Open Changes\")`;\n\n\t\t\tif (previousSha === null) {\n\t\t\t\tpreviousSha = await commit.getPreviousSha();\n\t\t\t}\n\t\t\tif (previousSha) {\n\t\t\t\tprevious = `  &nbsp;[$(git-commit) ${GitRevision.shorten(\n\t\t\t\t\tpreviousSha,\n\t\t\t\t)}](${ShowQuickCommitCommand.getMarkdownCommandArgs(previousSha)} \"Show Commit\") &nbsp;${\n\t\t\t\t\tGlyphChars.ArrowLeftRightLong\n\t\t\t\t}&nbsp;`;\n\t\t\t}\n\n\t\t\tcurrent = `[$(git-commit) ${commit.shortSha}](${ShowQuickCommitCommand.getMarkdownCommandArgs(\n\t\t\t\tcommit.sha,\n\t\t\t)} \"Show Commit\")`;\n\t\t}\n\n\t\tmessage = `${diff}\\n---\\n\\nChanges${previous ?? ' added in '}${current} &nbsp;&nbsp;|&nbsp;&nbsp; ${message}`;\n\n\t\tconst markdown = new MarkdownString(message, true);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\t\treturn markdown;\n\t}\n\n\texport async function localChangesMessage(\n\t\tfromCommit: GitCommit | undefined,\n\t\turi: GitUri,\n\t\teditorLine: number, // 0-based, Git is 1-based\n\t\thunk: GitDiffHunk,\n\t): Promise<MarkdownString | undefined> {\n\t\tconst diff = getDiffFromHunk(hunk);\n\n\t\tlet message;\n\t\tlet previous;\n\t\tlet current;\n\t\tif (fromCommit == null) {\n\t\t\tprevious = '_Working Tree_';\n\t\t\tcurrent = '_Unsaved_';\n\t\t} else {\n\t\t\tconst file = await fromCommit.findFile(uri);\n\t\t\tif (file == null) return undefined;\n\n\t\t\tmessage = `[$(compare-changes)](${DiffWithCommand.getMarkdownCommandArgs({\n\t\t\t\tlhs: {\n\t\t\t\t\tsha: fromCommit.sha,\n\t\t\t\t\turi: GitUri.fromFile(file, uri.repoPath!, undefined, true).toFileUri(),\n\t\t\t\t},\n\t\t\t\trhs: {\n\t\t\t\t\tsha: '',\n\t\t\t\t\turi: uri.toFileUri(),\n\t\t\t\t},\n\t\t\t\trepoPath: uri.repoPath!,\n\t\t\t\tline: editorLine,\n\t\t\t})} \"Open Changes\")`;\n\n\t\t\tprevious = `[$(git-commit) ${fromCommit.shortSha}](${ShowQuickCommitCommand.getMarkdownCommandArgs(\n\t\t\t\tfromCommit.sha,\n\t\t\t)} \"Show Commit\")`;\n\n\t\t\tcurrent = '_Working Tree_';\n\t\t}\n\t\tmessage = `${diff}\\n---\\n\\nLocal Changes  &nbsp;${previous} &nbsp;${\n\t\t\tGlyphChars.ArrowLeftRightLong\n\t\t}&nbsp; ${current}${message == null ? '' : ` &nbsp;&nbsp;|&nbsp;&nbsp; ${message}`}`;\n\n\t\tconst markdown = new MarkdownString(message, true);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\t\treturn markdown;\n\t}\n\n\texport async function detailsMessage(\n\t\tcommit: GitCommit,\n\t\turi: GitUri,\n\t\teditorLine: number, // 0-based, Git is 1-based\n\t\tformat: string,\n\t\tdateFormat: string | null,\n\t\toptions?: {\n\t\t\tautolinks?: boolean;\n\t\t\tcancellationToken?: CancellationToken;\n\t\t\tpullRequests?: {\n\t\t\t\tenabled: boolean;\n\t\t\t\tpr?: PullRequest | PromiseCancelledError<Promise<PullRequest | undefined>>;\n\t\t\t};\n\t\t\tgetBranchAndTagTips?: (\n\t\t\t\tsha: string,\n\t\t\t\toptions?: { compact?: boolean | undefined; icons?: boolean | undefined },\n\t\t\t) => string | undefined;\n\t\t},\n\t): Promise<MarkdownString> {\n\t\tif (dateFormat === null) {\n\t\t\tdateFormat = 'MMMM Do, YYYY h:mma';\n\t\t}\n\n\t\tlet message = commit.message ?? commit.summary;\n\t\tif (commit.message == null && !commit.isUncommitted) {\n\t\t\tawait commit.ensureFullDetails();\n\t\t\tmessage = commit.message ?? commit.summary;\n\n\t\t\tif (options?.cancellationToken?.isCancellationRequested) return new MarkdownString();\n\t\t}\n\n\t\tconst remotes = await Container.instance.git.getRemotesWithProviders(commit.repoPath, { sort: true });\n\n\t\tif (options?.cancellationToken?.isCancellationRequested) return new MarkdownString();\n\n\t\tconst [previousLineComparisonUris, autolinkedIssuesOrPullRequests, pr, presence] = await Promise.all([\n\t\t\tcommit.isUncommitted ? commit.getPreviousComparisonUrisForLine(editorLine, uri.sha) : undefined,\n\t\t\tgetAutoLinkedIssuesOrPullRequests(message, remotes),\n\t\t\toptions?.pullRequests?.pr ??\n\t\t\t\tgetPullRequestForCommit(commit.ref, remotes, {\n\t\t\t\t\tpullRequests:\n\t\t\t\t\t\toptions?.pullRequests?.enabled ||\n\t\t\t\t\t\tCommitFormatter.has(\n\t\t\t\t\t\t\tformat,\n\t\t\t\t\t\t\t'pullRequest',\n\t\t\t\t\t\t\t'pullRequestAgo',\n\t\t\t\t\t\t\t'pullRequestAgoOrDate',\n\t\t\t\t\t\t\t'pullRequestDate',\n\t\t\t\t\t\t\t'pullRequestState',\n\t\t\t\t\t\t),\n\t\t\t\t}),\n\t\t\tContainer.instance.vsls.maybeGetPresence(commit.author.email),\n\t\t]);\n\n\t\tif (options?.cancellationToken?.isCancellationRequested) return new MarkdownString();\n\n\t\tconst details = await CommitFormatter.fromTemplateAsync(format, commit, {\n\t\t\tautolinkedIssuesOrPullRequests: autolinkedIssuesOrPullRequests,\n\t\t\tdateFormat: dateFormat,\n\t\t\teditor: {\n\t\t\t\tline: editorLine,\n\t\t\t\turi: uri,\n\t\t\t},\n\t\t\tgetBranchAndTagTips: options?.getBranchAndTagTips,\n\t\t\tmarkdown: true,\n\t\t\tmessageAutolinks: options?.autolinks,\n\t\t\tpullRequestOrRemote: pr,\n\t\t\tpresence: presence,\n\t\t\tpreviousLineComparisonUris: previousLineComparisonUris,\n\t\t\tremotes: remotes,\n\t\t});\n\n\t\tconst markdown = new MarkdownString(details, true);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\t\treturn markdown;\n\t}\n\n\tfunction getDiffFromHunk(hunk: GitDiffHunk): string {\n\t\treturn `\\`\\`\\`diff\\n${hunk.diff.trim()}\\n\\`\\`\\``;\n\t}\n\n\tfunction getDiffFromHunkLine(hunkLine: GitDiffHunkLine, diffStyle?: 'line' | 'hunk'): string {\n\t\tif (diffStyle === 'hunk' || (diffStyle == null && Container.instance.config.hovers.changesDiff === 'hunk')) {\n\t\t\treturn getDiffFromHunk(hunkLine.hunk);\n\t\t}\n\n\t\treturn `\\`\\`\\`diff${hunkLine.previous == null ? '' : `\\n- ${hunkLine.previous.line.trim()}`}${\n\t\t\thunkLine.current == null ? '' : `\\n+ ${hunkLine.current.line.trim()}`\n\t\t}\\n\\`\\`\\``;\n\t}\n\n\tasync function getAutoLinkedIssuesOrPullRequests(message: string, remotes: GitRemote[]) {\n\t\tconst cc = Logger.getNewCorrelationContext('Hovers.getAutoLinkedIssuesOrPullRequests');\n\t\tLogger.debug(cc, `${GlyphChars.Dash} message=<message>`);\n\n\t\tconst start = hrtime();\n\n\t\tif (\n\t\t\t!Container.instance.config.hovers.autolinks.enabled ||\n\t\t\t!Container.instance.config.hovers.autolinks.enhanced ||\n\t\t\t!CommitFormatter.has(Container.instance.config.hovers.detailsMarkdownFormat, 'message')\n\t\t) {\n\t\t\tLogger.debug(cc, `completed ${GlyphChars.Dot} ${getDurationMilliseconds(start)} ms`);\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst remote = await Container.instance.git.getRichRemoteProvider(remotes);\n\t\tif (remote?.provider == null) {\n\t\t\tLogger.debug(cc, `completed ${GlyphChars.Dot} ${getDurationMilliseconds(start)} ms`);\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// TODO: Make this configurable?\n\t\tconst timeout = 250;\n\n\t\ttry {\n\t\t\tconst autolinks = await Container.instance.autolinks.getIssueOrPullRequestLinks(message, remote, {\n\t\t\t\ttimeout: timeout,\n\t\t\t});\n\n\t\t\tif (autolinks != null && Logger.enabled(LogLevel.Debug)) {\n\t\t\t\t// If there are any issues/PRs that timed out, log it\n\t\t\t\tconst prCount = count(autolinks.values(), pr => pr instanceof PromiseCancelledError);\n\t\t\t\tif (prCount !== 0) {\n\t\t\t\t\tLogger.debug(\n\t\t\t\t\t\tcc,\n\t\t\t\t\t\t`timed out ${\n\t\t\t\t\t\t\tGlyphChars.Dash\n\t\t\t\t\t\t} ${prCount} issue/pull request queries took too long (over ${timeout} ms) ${\n\t\t\t\t\t\t\tGlyphChars.Dot\n\t\t\t\t\t\t} ${getDurationMilliseconds(start)} ms`,\n\t\t\t\t\t);\n\n\t\t\t\t\t// const pending = [\n\t\t\t\t\t// \t...Iterables.map(autolinks.values(), issueOrPullRequest =>\n\t\t\t\t\t// \t\tissueOrPullRequest instanceof CancelledPromiseError\n\t\t\t\t\t// \t\t\t? issueOrPullRequest.promise\n\t\t\t\t\t// \t\t\t: undefined,\n\t\t\t\t\t// \t),\n\t\t\t\t\t// ];\n\t\t\t\t\t// void Promise.all(pending).then(() => {\n\t\t\t\t\t// \tLogger.debug(\n\t\t\t\t\t// \t\tcc,\n\t\t\t\t\t// \t\t`${GlyphChars.Dot} ${count} issue/pull request queries completed; refreshing...`,\n\t\t\t\t\t// \t);\n\t\t\t\t\t// \tvoid executeCoreCommand(CoreCommands.EditorShowHover);\n\t\t\t\t\t// });\n\n\t\t\t\t\treturn autolinks;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tLogger.debug(cc, `completed ${GlyphChars.Dot} ${getDurationMilliseconds(start)} ms`);\n\n\t\t\treturn autolinks;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc, `failed ${GlyphChars.Dot} ${getDurationMilliseconds(start)} ms`);\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tasync function getPullRequestForCommit(\n\t\tref: string,\n\t\tremotes: GitRemote[],\n\t\toptions?: {\n\t\t\tpullRequests?: boolean;\n\t\t},\n\t) {\n\t\tconst cc = Logger.getNewCorrelationContext('Hovers.getPullRequestForCommit');\n\t\tLogger.debug(cc, `${GlyphChars.Dash} ref=${ref}`);\n\n\t\tconst start = hrtime();\n\n\t\tif (!options?.pullRequests) {\n\t\t\tLogger.debug(cc, `completed ${GlyphChars.Dot} ${getDurationMilliseconds(start)} ms`);\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst remote = await Container.instance.git.getRichRemoteProvider(remotes, { includeDisconnected: true });\n\t\tif (remote?.provider == null) {\n\t\t\tLogger.debug(cc, `completed ${GlyphChars.Dot} ${getDurationMilliseconds(start)} ms`);\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { provider } = remote;\n\t\tconst connected = provider.maybeConnected ?? (await provider.isConnected());\n\t\tif (!connected) {\n\t\t\tLogger.debug(cc, `completed ${GlyphChars.Dot} ${getDurationMilliseconds(start)} ms`);\n\n\t\t\treturn remote;\n\t\t}\n\n\t\ttry {\n\t\t\tconst pr = await Container.instance.git.getPullRequestForCommit(ref, provider, { timeout: 250 });\n\n\t\t\tLogger.debug(cc, `completed ${GlyphChars.Dot} ${getDurationMilliseconds(start)} ms`);\n\n\t\t\treturn pr;\n\t\t} catch (ex) {\n\t\t\tif (ex instanceof PromiseCancelledError) {\n\t\t\t\tLogger.debug(cc, `timed out ${GlyphChars.Dot} ${getDurationMilliseconds(start)} ms`);\n\n\t\t\t\treturn ex;\n\t\t\t}\n\n\t\t\tLogger.error(ex, cc, `failed ${GlyphChars.Dot} ${getDurationMilliseconds(start)} ms`);\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n}\n","import { CancellationToken, Disposable, Hover, languages, Position, Range, TextDocument, TextEditor } from 'vscode';\nimport { FileAnnotationType } from '../config';\nimport { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitBlame, GitCommit } from '../git/models';\nimport { Hovers } from '../hovers/hovers';\nimport { log } from '../system/decorators/log';\nimport { GitDocumentState, TrackedDocument } from '../trackers/gitDocumentTracker';\nimport { AnnotationProviderBase } from './annotationProvider';\nimport { ComputedHeatmap, getHeatmapColors } from './annotations';\n\nexport abstract class BlameAnnotationProviderBase extends AnnotationProviderBase {\n\tprotected blame: Promise<GitBlame | undefined>;\n\tprotected hoverProviderDisposable: Disposable | undefined;\n\n\tconstructor(\n\t\tannotationType: FileAnnotationType,\n\t\teditor: TextEditor,\n\t\ttrackedDocument: TrackedDocument<GitDocumentState>,\n\t\tprotected readonly container: Container,\n\t) {\n\t\tsuper(annotationType, editor, trackedDocument);\n\n\t\tthis.blame = this.container.git.getBlame(this.trackedDocument.uri, editor.document);\n\n\t\tif (editor.document.isDirty) {\n\t\t\ttrackedDocument.setForceDirtyStateChangeOnNextDocumentChange();\n\t\t}\n\t}\n\n\toverride clear() {\n\t\tif (this.hoverProviderDisposable != null) {\n\t\t\tthis.hoverProviderDisposable.dispose();\n\t\t\tthis.hoverProviderDisposable = undefined;\n\t\t}\n\t\tsuper.clear();\n\t}\n\n\tasync validate(): Promise<boolean> {\n\t\tconst blame = await this.blame;\n\t\treturn blame != null && blame.lines.length !== 0;\n\t}\n\n\tprotected async getBlame(): Promise<GitBlame | undefined> {\n\t\tconst blame = await this.blame;\n\t\tif (blame == null || blame.lines.length === 0) return undefined;\n\n\t\treturn blame;\n\t}\n\n\t@log({ args: false })\n\tprotected async getComputedHeatmap(blame: GitBlame): Promise<ComputedHeatmap> {\n\t\tconst dates: Date[] = [];\n\n\t\tlet commit;\n\t\tlet previousSha;\n\t\tfor (const l of blame.lines) {\n\t\t\tif (previousSha === l.sha) continue;\n\t\t\tpreviousSha = l.sha;\n\n\t\t\tcommit = blame.commits.get(l.sha);\n\t\t\tif (commit == null) continue;\n\n\t\t\tdates.push(commit.date);\n\t\t}\n\n\t\tdates.sort((a, b) => a.getTime() - b.getTime());\n\n\t\tconst coldThresholdDate = new Date();\n\t\tcoldThresholdDate.setDate(coldThresholdDate.getDate() - (this.container.config.heatmap.ageThreshold || 90));\n\t\tconst coldThresholdTimestamp = coldThresholdDate.getTime();\n\n\t\tconst hotDates: Date[] = [];\n\t\tconst coldDates: Date[] = [];\n\n\t\tfor (const d of dates) {\n\t\t\tif (d.getTime() < coldThresholdTimestamp) {\n\t\t\t\tcoldDates.push(d);\n\t\t\t} else {\n\t\t\t\thotDates.push(d);\n\t\t\t}\n\t\t}\n\n\t\tlet lookupTable:\n\t\t\t| number[]\n\t\t\t| {\n\t\t\t\t\thot: number[];\n\t\t\t\t\tcold: number[];\n\t\t\t  };\n\t\tif (hotDates.length && coldDates.length) {\n\t\t\tlookupTable = {\n\t\t\t\thot: getRelativeAgeLookupTable(hotDates),\n\t\t\t\tcold: getRelativeAgeLookupTable(coldDates),\n\t\t\t};\n\t\t} else {\n\t\t\tlookupTable = getRelativeAgeLookupTable(dates);\n\t\t}\n\n\t\treturn {\n\t\t\tcoldThresholdTimestamp: coldThresholdTimestamp,\n\t\t\tcolors: await getHeatmapColors(),\n\t\t\tcomputeRelativeAge: (date: Date) => {\n\t\t\t\tconst lookup = Array.isArray(lookupTable)\n\t\t\t\t\t? lookupTable\n\t\t\t\t\t: date.getTime() < coldThresholdTimestamp\n\t\t\t\t\t? lookupTable.cold\n\t\t\t\t\t: lookupTable.hot;\n\n\t\t\t\tconst time = date.getTime();\n\t\t\t\tlet index = 0;\n\t\t\t\tfor (let i = 0; i < lookup.length; i++) {\n\t\t\t\t\tindex = i;\n\t\t\t\t\tif (time >= lookup[i]) break;\n\t\t\t\t}\n\n\t\t\t\treturn index;\n\t\t\t},\n\t\t};\n\t}\n\n\tregisterHoverProviders(providers: { details: boolean; changes: boolean }) {\n\t\tif (\n\t\t\t!this.container.config.hovers.enabled ||\n\t\t\t!this.container.config.hovers.annotations.enabled ||\n\t\t\t(!providers.details && !providers.changes)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hoverProviderDisposable = languages.registerHoverProvider(\n\t\t\t{ pattern: this.document.uri.fsPath },\n\t\t\t{\n\t\t\t\tprovideHover: (document: TextDocument, position: Position, token: CancellationToken) =>\n\t\t\t\t\tthis.provideHover(providers, document, position, token),\n\t\t\t},\n\t\t);\n\t}\n\n\tasync provideHover(\n\t\tproviders: { details: boolean; changes: boolean },\n\t\tdocument: TextDocument,\n\t\tposition: Position,\n\t\t_token: CancellationToken,\n\t): Promise<Hover | undefined> {\n\t\tif (this.container.config.hovers.annotations.over !== 'line' && position.character !== 0) return undefined;\n\n\t\tif (this.document.uri.toString() !== document.uri.toString()) return undefined;\n\n\t\tconst blame = await this.getBlame();\n\t\tif (blame == null) return undefined;\n\n\t\tconst line = blame.lines[position.line];\n\n\t\tconst commit = blame.commits.get(line.sha);\n\t\tif (commit == null) return undefined;\n\n\t\tconst messages = (\n\t\t\tawait Promise.all([\n\t\t\t\tproviders.details ? this.getDetailsHoverMessage(commit, document) : undefined,\n\t\t\t\tproviders.changes\n\t\t\t\t\t? Hovers.changesMessage(commit, await GitUri.fromUri(document.uri), position.line, document)\n\t\t\t\t\t: undefined,\n\t\t\t])\n\t\t).filter(<T>(m?: T): m is T => Boolean(m));\n\n\t\treturn new Hover(\n\t\t\tmessages,\n\t\t\tdocument.validateRange(new Range(position.line, 0, position.line, Number.MAX_SAFE_INTEGER)),\n\t\t);\n\t}\n\n\tprivate async getDetailsHoverMessage(commit: GitCommit, document: TextDocument) {\n\t\tlet editorLine = this.editor.selection.active.line;\n\t\tconst line = editorLine + 1;\n\t\tconst commitLine = commit.lines.find(l => l.line === line) ?? commit.lines[0];\n\t\teditorLine = commitLine.originalLine - 1;\n\n\t\treturn Hovers.detailsMessage(\n\t\t\tcommit,\n\t\t\tawait GitUri.fromUri(document.uri),\n\t\t\teditorLine,\n\t\t\tthis.container.config.hovers.detailsMarkdownFormat,\n\t\t\tthis.container.config.defaultDateFormat,\n\t\t\t{\n\t\t\t\tautolinks: this.container.config.hovers.autolinks.enabled,\n\t\t\t\tpullRequests: {\n\t\t\t\t\tenabled: this.container.config.hovers.pullRequests.enabled,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n}\n\nfunction getRelativeAgeLookupTable(dates: Date[]) {\n\tconst lookup: number[] = [];\n\n\tconst half = Math.floor(dates.length / 2);\n\tconst median = dates.length % 2 ? dates[half].getTime() : (dates[half - 1].getTime() + dates[half].getTime()) / 2.0;\n\n\tconst newest = dates[dates.length - 1].getTime();\n\tlet step = (newest - median) / 5;\n\tfor (let i = 5; i > 0; i--) {\n\t\tlookup.push(median + step * i);\n\t}\n\n\tlookup.push(median);\n\n\tconst oldest = dates[0].getTime();\n\tstep = (median - oldest) / 4;\n\tfor (let i = 1; i <= 4; i++) {\n\t\tlookup.push(median - step * i);\n\t}\n\n\treturn lookup;\n}\n","import { DecorationOptions, Range, TextEditor, ThemableDecorationAttachmentRenderOptions } from 'vscode';\nimport { FileAnnotationType, GravatarDefaultStyle } from '../configuration';\nimport { GlyphChars } from '../constants';\nimport { Container } from '../container';\nimport { CommitFormatOptions, CommitFormatter } from '../git/formatters';\nimport { GitBlame, GitCommit } from '../git/models';\nimport { Logger } from '../logger';\nimport { filterMap } from '../system/array';\nimport { log } from '../system/decorators/log';\nimport { first } from '../system/iterable';\nimport { Stopwatch } from '../system/stopwatch';\nimport { getTokensFromTemplate, getWidth, TokenOptions } from '../system/string';\nimport { GitDocumentState } from '../trackers/gitDocumentTracker';\nimport { TrackedDocument } from '../trackers/trackedDocument';\nimport { AnnotationContext } from './annotationProvider';\nimport { Annotations } from './annotations';\nimport { BlameAnnotationProviderBase } from './blameAnnotationProvider';\nimport { Decorations } from './fileAnnotationController';\n\nexport class GutterBlameAnnotationProvider extends BlameAnnotationProviderBase {\n\tconstructor(editor: TextEditor, trackedDocument: TrackedDocument<GitDocumentState>, container: Container) {\n\t\tsuper(FileAnnotationType.Blame, editor, trackedDocument, container);\n\t}\n\n\toverride clear() {\n\t\tsuper.clear();\n\n\t\tif (Decorations.gutterBlameHighlight != null) {\n\t\t\ttry {\n\t\t\t\tthis.editor.setDecorations(Decorations.gutterBlameHighlight, []);\n\t\t\t} catch {}\n\t\t}\n\t}\n\n\t@log()\n\tasync onProvideAnnotation(context?: AnnotationContext, _type?: FileAnnotationType): Promise<boolean> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tthis.annotationContext = context;\n\n\t\tconst blame = await this.getBlame();\n\t\tif (blame == null) return false;\n\n\t\tconst sw = new Stopwatch(cc!);\n\n\t\tconst cfg = this.container.config.blame;\n\n\t\t// Precalculate the formatting options so we don't need to do it on each iteration\n\t\tconst tokenOptions = getTokensFromTemplate(cfg.format).reduce<{\n\t\t\t[token: string]: TokenOptions | undefined;\n\t\t}>((map, token) => {\n\t\t\tmap[token.key] = token.options;\n\t\t\treturn map;\n\t\t}, Object.create(null));\n\n\t\tlet getBranchAndTagTips;\n\t\tif (CommitFormatter.has(cfg.format, 'tips')) {\n\t\t\tgetBranchAndTagTips = await this.container.git.getBranchesAndTagsTipsFn(blame.repoPath);\n\t\t}\n\n\t\tconst options: CommitFormatOptions = {\n\t\t\tdateFormat: cfg.dateFormat === null ? this.container.config.defaultDateFormat : cfg.dateFormat,\n\t\t\tgetBranchAndTagTips: getBranchAndTagTips,\n\t\t\ttokenOptions: tokenOptions,\n\t\t};\n\n\t\tconst avatars = cfg.avatars;\n\t\tconst gravatarDefault = this.container.config.defaultGravatarsStyle;\n\t\tconst separateLines = cfg.separateLines;\n\t\tconst renderOptions = Annotations.gutterRenderOptions(\n\t\t\tseparateLines,\n\t\t\tcfg.heatmap,\n\t\t\tcfg.avatars,\n\t\t\tcfg.format,\n\t\t\toptions,\n\t\t);\n\n\t\tconst decorationOptions = [];\n\t\tconst decorationsMap = new Map<string, DecorationOptions | undefined>();\n\t\tconst avatarDecorationsMap = avatars ? new Map<string, ThemableDecorationAttachmentRenderOptions>() : undefined;\n\n\t\tlet commit: GitCommit | undefined;\n\t\tlet compacted = false;\n\t\tlet gutter: DecorationOptions | undefined;\n\t\tlet previousSha: string | undefined;\n\n\t\tlet computedHeatmap;\n\t\tif (cfg.heatmap.enabled) {\n\t\t\tcomputedHeatmap = await this.getComputedHeatmap(blame);\n\t\t}\n\n\t\tfor (const l of blame.lines) {\n\t\t\t// editor lines are 0-based\n\t\t\tconst editorLine = l.line - 1;\n\n\t\t\tif (previousSha === l.sha) {\n\t\t\t\tif (gutter == null) continue;\n\n\t\t\t\t// Use a shallow copy of the previous decoration options\n\t\t\t\tgutter = { ...gutter };\n\n\t\t\t\tif (cfg.compact && !compacted) {\n\t\t\t\t\t// Since we are wiping out the contextText make sure to copy the objects\n\t\t\t\t\tgutter.renderOptions = {\n\t\t\t\t\t\tbefore: {\n\t\t\t\t\t\t\t...gutter.renderOptions!.before,\n\t\t\t\t\t\t\tcontentText: GlyphChars.Space.repeat(getWidth(gutter.renderOptions!.before!.contentText!)),\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\n\t\t\t\t\tif (separateLines) {\n\t\t\t\t\t\tgutter.renderOptions.before!.textDecoration = `none;box-sizing: border-box${\n\t\t\t\t\t\t\tavatars ? ';padding: 0 0 0 18px' : ''\n\t\t\t\t\t\t}`;\n\t\t\t\t\t}\n\n\t\t\t\t\tcompacted = true;\n\t\t\t\t}\n\n\t\t\t\tgutter.range = new Range(editorLine, 0, editorLine, 0);\n\n\t\t\t\tdecorationOptions.push(gutter);\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tcompacted = false;\n\t\t\tpreviousSha = l.sha;\n\n\t\t\tcommit = blame.commits.get(l.sha);\n\t\t\tif (commit == null) continue;\n\n\t\t\tgutter = decorationsMap.get(l.sha);\n\t\t\tif (gutter != null) {\n\t\t\t\tgutter = {\n\t\t\t\t\t...gutter,\n\t\t\t\t\trange: new Range(editorLine, 0, editorLine, 0),\n\t\t\t\t};\n\n\t\t\t\tdecorationOptions.push(gutter);\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tgutter = Annotations.gutter(commit, cfg.format, options, renderOptions) as DecorationOptions;\n\n\t\t\tif (computedHeatmap != null) {\n\t\t\t\tAnnotations.applyHeatmap(gutter, commit.date, computedHeatmap);\n\t\t\t}\n\n\t\t\tgutter.range = new Range(editorLine, 0, editorLine, 0);\n\n\t\t\tdecorationOptions.push(gutter);\n\n\t\t\tif (avatars && commit.author.email != null) {\n\t\t\t\tawait this.applyAvatarDecoration(commit, gutter, gravatarDefault, avatarDecorationsMap!);\n\t\t\t}\n\n\t\t\tdecorationsMap.set(l.sha, gutter);\n\t\t}\n\n\t\tsw.restart({ suffix: ' to compute gutter blame annotations' });\n\n\t\tif (decorationOptions.length) {\n\t\t\tthis.setDecorations([\n\t\t\t\t{ decorationType: Decorations.gutterBlameAnnotation, rangesOrOptions: decorationOptions },\n\t\t\t]);\n\n\t\t\tsw.stop({ suffix: ' to apply all gutter blame annotations' });\n\t\t}\n\n\t\tthis.registerHoverProviders(this.container.config.hovers.annotations);\n\t\treturn true;\n\t}\n\n\t@log({ args: false })\n\tasync selection(selection?: AnnotationContext['selection'], blame?: GitBlame): Promise<void> {\n\t\tif (selection === false || Decorations.gutterBlameHighlight == null) return;\n\n\t\tif (blame == null) {\n\t\t\tblame = await this.blame;\n\t\t\tif (!blame?.lines.length) return;\n\t\t}\n\n\t\tlet sha: string | undefined = undefined;\n\t\tif (selection?.sha != null) {\n\t\t\tsha = selection.sha;\n\t\t} else if (selection?.line != null) {\n\t\t\tif (selection.line >= 0) {\n\t\t\t\tconst commitLine = blame.lines[selection.line];\n\t\t\t\tsha = commitLine?.sha;\n\t\t\t}\n\t\t} else {\n\t\t\tsha = first(blame.commits.values()).sha;\n\t\t}\n\n\t\tif (!sha) {\n\t\t\tthis.editor.setDecorations(Decorations.gutterBlameHighlight, []);\n\t\t\treturn;\n\t\t}\n\n\t\tconst highlightDecorationRanges = filterMap(blame.lines, l =>\n\t\t\tl.sha === sha\n\t\t\t\t? // editor lines are 0-based\n\t\t\t\t  this.editor.document.validateRange(new Range(l.line - 1, 0, l.line - 1, Number.MAX_SAFE_INTEGER))\n\t\t\t\t: undefined,\n\t\t);\n\n\t\tthis.editor.setDecorations(Decorations.gutterBlameHighlight, highlightDecorationRanges);\n\t}\n\n\tprivate async applyAvatarDecoration(\n\t\tcommit: GitCommit,\n\t\tgutter: DecorationOptions,\n\t\tgravatarDefault: GravatarDefaultStyle,\n\t\tmap: Map<string, ThemableDecorationAttachmentRenderOptions>,\n\t) {\n\t\tlet avatarDecoration = map.get(commit.author.email ?? '');\n\t\tif (avatarDecoration == null) {\n\t\t\tconst url = (await commit.getAvatarUri({ defaultStyle: gravatarDefault, size: 16 })).toString(true);\n\t\t\tavatarDecoration = {\n\t\t\t\tcontentText: '',\n\t\t\t\theight: '16px',\n\t\t\t\twidth: '16px',\n\t\t\t\ttextDecoration: `none;position:absolute;top:1px;left:5px;background:url(${encodeURI(\n\t\t\t\t\turl,\n\t\t\t\t)});background-size:16px 16px;margin-left: 0 !important`,\n\t\t\t};\n\t\t\tmap.set(commit.author.email ?? '', avatarDecoration);\n\t\t}\n\n\t\tgutter.renderOptions!.after = avatarDecoration;\n\t}\n}\n","import {\n\tCancellationToken,\n\tDecorationOptions,\n\tDisposable,\n\tHover,\n\tlanguages,\n\tPosition,\n\tRange,\n\tSelection,\n\tTextDocument,\n\tTextEditor,\n\tTextEditorDecorationType,\n\tTextEditorRevealType,\n} from 'vscode';\nimport { FileAnnotationType } from '../configuration';\nimport { Container } from '../container';\nimport { GitCommit, GitDiff } from '../git/models';\nimport { Hovers } from '../hovers/hovers';\nimport { Logger } from '../logger';\nimport { log } from '../system/decorators/log';\nimport { Stopwatch } from '../system/stopwatch';\nimport { GitDocumentState, TrackedDocument } from '../trackers/gitDocumentTracker';\nimport { AnnotationContext, AnnotationProviderBase } from './annotationProvider';\nimport { Decorations } from './fileAnnotationController';\n\nexport interface ChangesAnnotationContext extends AnnotationContext {\n\tsha?: string;\n\tonly?: boolean;\n}\n\nexport class GutterChangesAnnotationProvider extends AnnotationProviderBase<ChangesAnnotationContext> {\n\tprivate state: { commit: GitCommit | undefined; diffs: GitDiff[] } | undefined;\n\tprivate hoverProviderDisposable: Disposable | undefined;\n\n\tconstructor(\n\t\teditor: TextEditor,\n\t\ttrackedDocument: TrackedDocument<GitDocumentState>,\n\t\tprivate readonly container: Container,\n\t) {\n\t\tsuper(FileAnnotationType.Changes, editor, trackedDocument);\n\t}\n\n\toverride mustReopen(context?: ChangesAnnotationContext): boolean {\n\t\treturn this.annotationContext?.sha !== context?.sha || this.annotationContext?.only !== context?.only;\n\t}\n\n\toverride clear() {\n\t\tthis.state = undefined;\n\t\tif (this.hoverProviderDisposable != null) {\n\t\t\tthis.hoverProviderDisposable.dispose();\n\t\t\tthis.hoverProviderDisposable = undefined;\n\t\t}\n\t\tsuper.clear();\n\t}\n\n\tselection(_selection?: AnnotationContext['selection']): Promise<void> {\n\t\treturn Promise.resolve();\n\t}\n\n\tvalidate(): Promise<boolean> {\n\t\treturn Promise.resolve(true);\n\t}\n\n\t@log()\n\tasync onProvideAnnotation(context?: ChangesAnnotationContext): Promise<boolean> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tif (this.mustReopen(context)) {\n\t\t\tthis.clear();\n\t\t}\n\n\t\tthis.annotationContext = context;\n\n\t\tlet ref1 = this.trackedDocument.uri.sha;\n\t\tlet ref2 = context?.sha != null && context.sha !== ref1 ? `${context.sha}^` : undefined;\n\n\t\tlet commit: GitCommit | undefined;\n\n\t\tlet localChanges = ref1 == null && ref2 == null;\n\t\tif (localChanges) {\n\t\t\tlet ref = await this.container.git.getOldestUnpushedRefForFile(\n\t\t\t\tthis.trackedDocument.uri.repoPath!,\n\t\t\t\tthis.trackedDocument.uri,\n\t\t\t);\n\t\t\tif (ref != null) {\n\t\t\t\tref = `${ref}^`;\n\t\t\t\tcommit = await this.container.git.getCommitForFile(\n\t\t\t\t\tthis.trackedDocument.uri.repoPath,\n\t\t\t\t\tthis.trackedDocument.uri,\n\t\t\t\t\t{ ref: ref },\n\t\t\t\t);\n\t\t\t\tif (commit != null) {\n\t\t\t\t\tif (ref2 != null) {\n\t\t\t\t\t\tref2 = ref;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tref1 = ref;\n\t\t\t\t\t\tref2 = '';\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlocalChanges = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst status = await this.container.git.getStatusForFile(\n\t\t\t\t\tthis.trackedDocument.uri.repoPath!,\n\t\t\t\t\tthis.trackedDocument.uri,\n\t\t\t\t);\n\t\t\t\tconst commits = status?.getPseudoCommits(\n\t\t\t\t\tthis.container,\n\t\t\t\t\tawait this.container.git.getCurrentUser(this.trackedDocument.uri.repoPath!),\n\t\t\t\t);\n\t\t\t\tif (commits?.length) {\n\t\t\t\t\tcommit = await this.container.git.getCommitForFile(\n\t\t\t\t\t\tthis.trackedDocument.uri.repoPath,\n\t\t\t\t\t\tthis.trackedDocument.uri,\n\t\t\t\t\t);\n\t\t\t\t\tref1 = 'HEAD';\n\t\t\t\t} else if (this.trackedDocument.dirty) {\n\t\t\t\t\tref1 = 'HEAD';\n\t\t\t\t} else {\n\t\t\t\t\tlocalChanges = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!localChanges) {\n\t\t\tcommit = await this.container.git.getCommitForFile(\n\t\t\t\tthis.trackedDocument.uri.repoPath,\n\t\t\t\tthis.trackedDocument.uri,\n\t\t\t\t{\n\t\t\t\t\tref: ref2 ?? ref1,\n\t\t\t\t},\n\t\t\t);\n\t\t\tif (commit == null) return false;\n\n\t\t\tif (ref2 != null) {\n\t\t\t\tref2 = commit.ref;\n\t\t\t} else {\n\t\t\t\tref1 = `${commit.ref}^`;\n\t\t\t\tref2 = commit.ref;\n\t\t\t}\n\t\t}\n\n\t\tconst diffs = (\n\t\t\tawait Promise.all(\n\t\t\t\tref2 == null && this.editor.document.isDirty\n\t\t\t\t\t? [\n\t\t\t\t\t\t\tthis.container.git.getDiffForFileContents(\n\t\t\t\t\t\t\t\tthis.trackedDocument.uri,\n\t\t\t\t\t\t\t\tref1!,\n\t\t\t\t\t\t\t\tthis.editor.document.getText(),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tthis.container.git.getDiffForFile(this.trackedDocument.uri, ref1, ref2),\n\t\t\t\t\t  ]\n\t\t\t\t\t: [this.container.git.getDiffForFile(this.trackedDocument.uri, ref1, ref2)],\n\t\t\t)\n\t\t).filter(<T>(d?: T): d is T => Boolean(d));\n\t\tif (!diffs?.length) return false;\n\n\t\tconst sw = new Stopwatch(cc!);\n\n\t\tconst decorationsMap = new Map<\n\t\t\tstring,\n\t\t\t{ decorationType: TextEditorDecorationType; rangesOrOptions: DecorationOptions[] }\n\t\t>();\n\n\t\t// If we want to only show changes from the specified sha, get the blame so we can compare with \"visible\" shas\n\t\tconst blame =\n\t\t\tcontext?.sha != null && context?.only\n\t\t\t\t? await this.container.git.getBlame(this.trackedDocument.uri, this.editor?.document)\n\t\t\t\t: undefined;\n\n\t\tlet selection: Selection | undefined;\n\n\t\tfor (const diff of diffs) {\n\t\t\tfor (const hunk of diff.hunks) {\n\t\t\t\t// Only show \"visible\" hunks\n\t\t\t\tif (blame != null) {\n\t\t\t\t\tlet skip = true;\n\n\t\t\t\t\tconst sha = context!.sha;\n\t\t\t\t\tfor (let i = hunk.current.position.start - 1; i < hunk.current.position.end; i++) {\n\t\t\t\t\t\tif (blame.lines[i].sha === sha) {\n\t\t\t\t\t\t\tskip = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (skip) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Subtract 2 because editor lines are 0-based and we will be adding 1 in the first iteration of the loop\n\t\t\t\tlet count = Math.max(hunk.current.position.start - 2, -1);\n\t\t\t\tlet index = -1;\n\t\t\t\tfor (const hunkLine of hunk.lines) {\n\t\t\t\t\tindex++;\n\t\t\t\t\tcount++;\n\n\t\t\t\t\tif (hunkLine.current?.state === 'unchanged') continue;\n\n\t\t\t\t\t// Uncomment this if we want to only show \"visible\" lines, rather than just visible hunks\n\t\t\t\t\t// if (blame != null && blame.lines[count].sha !== context!.sha) {\n\t\t\t\t\t// \tcontinue;\n\t\t\t\t\t// }\n\n\t\t\t\t\tconst range = this.editor.document.validateRange(\n\t\t\t\t\t\tnew Range(new Position(count, 0), new Position(count, Number.MAX_SAFE_INTEGER)),\n\t\t\t\t\t);\n\t\t\t\t\tif (selection == null) {\n\t\t\t\t\t\tselection = new Selection(range.start, range.end);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet state;\n\t\t\t\t\tif (hunkLine.current == null) {\n\t\t\t\t\t\tconst previous = hunk.lines[index - 1];\n\t\t\t\t\t\tif (hunkLine.previous != null && (previous == null || previous.current != null)) {\n\t\t\t\t\t\t\t// Check if there are more deleted lines than added lines show a deleted indicator\n\t\t\t\t\t\t\tif (hunk.previous.count > hunk.current.count) {\n\t\t\t\t\t\t\t\tstate = 'removed';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (hunkLine.current?.state === 'added') {\n\t\t\t\t\t\tif (hunkLine.previous?.state === 'removed') {\n\t\t\t\t\t\t\tstate = 'changed';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstate = 'added';\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (hunkLine?.current.state === 'removed') {\n\t\t\t\t\t\t// Check if there are more deleted lines than added lines show a deleted indicator\n\t\t\t\t\t\tif (hunk.previous.count > hunk.current.count) {\n\t\t\t\t\t\t\tstate = 'removed';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstate = 'changed';\n\t\t\t\t\t}\n\n\t\t\t\t\tlet decoration = decorationsMap.get(state);\n\t\t\t\t\tif (decoration == null) {\n\t\t\t\t\t\tdecoration = {\n\t\t\t\t\t\t\tdecorationType: (state === 'added'\n\t\t\t\t\t\t\t\t? Decorations.changesLineAddedAnnotation\n\t\t\t\t\t\t\t\t: state === 'removed'\n\t\t\t\t\t\t\t\t? Decorations.changesLineDeletedAnnotation\n\t\t\t\t\t\t\t\t: Decorations.changesLineChangedAnnotation)!,\n\t\t\t\t\t\t\trangesOrOptions: [{ range: range }],\n\t\t\t\t\t\t};\n\t\t\t\t\t\tdecorationsMap.set(state, decoration);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdecoration.rangesOrOptions.push({ range: range });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tsw.restart({ suffix: ' to compute recent changes annotations' });\n\n\t\tif (decorationsMap.size) {\n\t\t\tthis.setDecorations([...decorationsMap.values()]);\n\n\t\t\tsw.stop({ suffix: ' to apply all recent changes annotations' });\n\n\t\t\tif (selection != null && context?.selection !== false) {\n\t\t\t\tthis.editor.selection = selection;\n\t\t\t\tthis.editor.revealRange(selection, TextEditorRevealType.InCenterIfOutsideViewport);\n\t\t\t}\n\t\t}\n\n\t\tthis.state = { commit: commit, diffs: diffs };\n\t\tthis.registerHoverProvider();\n\t\treturn true;\n\t}\n\n\tregisterHoverProvider() {\n\t\tif (!this.container.config.hovers.enabled || !this.container.config.hovers.annotations.enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hoverProviderDisposable = languages.registerHoverProvider(\n\t\t\t{ pattern: this.document.uri.fsPath },\n\t\t\t{\n\t\t\t\tprovideHover: (document: TextDocument, position: Position, token: CancellationToken) =>\n\t\t\t\t\tthis.provideHover(document, position, token),\n\t\t\t},\n\t\t);\n\t}\n\n\tasync provideHover(\n\t\tdocument: TextDocument,\n\t\tposition: Position,\n\t\t_token: CancellationToken,\n\t): Promise<Hover | undefined> {\n\t\tif (this.state == null) return undefined;\n\t\tif (this.container.config.hovers.annotations.over !== 'line' && position.character !== 0) return undefined;\n\n\t\tconst { commit, diffs } = this.state;\n\n\t\tfor (const diff of diffs) {\n\t\t\tfor (const hunk of diff.hunks) {\n\t\t\t\t// If we have a \"mixed\" diff hunk, check if we have more deleted lines than added, to include a trailing line for the deleted indicator\n\t\t\t\tconst hasMoreDeletedLines = hunk.state === 'changed' && hunk.previous.count > hunk.current.count;\n\t\t\t\tif (\n\t\t\t\t\tposition.line >= hunk.current.position.start - 1 &&\n\t\t\t\t\tposition.line <= hunk.current.position.end - (hasMoreDeletedLines ? 0 : 1)\n\t\t\t\t) {\n\t\t\t\t\tconst markdown = await Hovers.localChangesMessage(\n\t\t\t\t\t\tcommit,\n\t\t\t\t\t\tthis.trackedDocument.uri,\n\t\t\t\t\t\tposition.line,\n\t\t\t\t\t\thunk,\n\t\t\t\t\t);\n\t\t\t\t\tif (markdown == null) return undefined;\n\n\t\t\t\t\treturn new Hover(\n\t\t\t\t\t\tmarkdown,\n\t\t\t\t\t\tdocument.validateRange(\n\t\t\t\t\t\t\tnew Range(\n\t\t\t\t\t\t\t\thunk.current.position.start - 1,\n\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\thunk.current.position.end - (hasMoreDeletedLines ? 0 : 1),\n\t\t\t\t\t\t\t\tNumber.MAX_SAFE_INTEGER,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n}\n","import { Range, TextEditor, TextEditorDecorationType } from 'vscode';\nimport { FileAnnotationType } from '../configuration';\nimport { Container } from '../container';\nimport { GitCommit } from '../git/models';\nimport { Logger } from '../logger';\nimport { log } from '../system/decorators/log';\nimport { Stopwatch } from '../system/stopwatch';\nimport { GitDocumentState } from '../trackers/gitDocumentTracker';\nimport { TrackedDocument } from '../trackers/trackedDocument';\nimport { AnnotationContext } from './annotationProvider';\nimport { Annotations } from './annotations';\nimport { BlameAnnotationProviderBase } from './blameAnnotationProvider';\n\nexport class GutterHeatmapBlameAnnotationProvider extends BlameAnnotationProviderBase {\n\tconstructor(editor: TextEditor, trackedDocument: TrackedDocument<GitDocumentState>, container: Container) {\n\t\tsuper(FileAnnotationType.Heatmap, editor, trackedDocument, container);\n\t}\n\n\t@log()\n\tasync onProvideAnnotation(context?: AnnotationContext, _type?: FileAnnotationType): Promise<boolean> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tthis.annotationContext = context;\n\n\t\tconst blame = await this.getBlame();\n\t\tif (blame == null) return false;\n\n\t\tconst sw = new Stopwatch(cc!);\n\n\t\tconst decorationsMap = new Map<\n\t\t\tstring,\n\t\t\t{ decorationType: TextEditorDecorationType; rangesOrOptions: Range[] }\n\t\t>();\n\t\tconst computedHeatmap = await this.getComputedHeatmap(blame);\n\n\t\tlet commit: GitCommit | undefined;\n\t\tfor (const l of blame.lines) {\n\t\t\t// editor lines are 0-based\n\t\t\tconst editorLine = l.line - 1;\n\n\t\t\tcommit = blame.commits.get(l.sha);\n\t\t\tif (commit == null) continue;\n\n\t\t\tAnnotations.addOrUpdateGutterHeatmapDecoration(\n\t\t\t\tcommit.date,\n\t\t\t\tcomputedHeatmap,\n\t\t\t\tnew Range(editorLine, 0, editorLine, 0),\n\t\t\t\tdecorationsMap,\n\t\t\t);\n\t\t}\n\n\t\tsw.restart({ suffix: ' to compute heatmap annotations' });\n\n\t\tif (decorationsMap.size) {\n\t\t\tthis.setDecorations([...decorationsMap.values()]);\n\n\t\t\tsw.stop({ suffix: ' to apply all heatmap annotations' });\n\t\t}\n\n\t\t// this.registerHoverProviders(this.container.config.hovers.annotations);\n\t\treturn true;\n\t}\n\n\tselection(_selection?: AnnotationContext['selection']): Promise<void> {\n\t\treturn Promise.resolve();\n\t}\n}\n","import {\n\tConfigurationChangeEvent,\n\tDecorationRangeBehavior,\n\tDisposable,\n\tEvent,\n\tEventEmitter,\n\tOverviewRulerLane,\n\tProgress,\n\tProgressLocation,\n\tTextDocument,\n\tTextEditor,\n\tTextEditorDecorationType,\n\tTextEditorViewColumnChangeEvent,\n\tThemeColor,\n\tUri,\n\twindow,\n\tworkspace,\n} from 'vscode';\nimport {\n\tAnnotationsToggleMode,\n\tBlameHighlightLocations,\n\tChangesLocations,\n\tconfiguration,\n\tFileAnnotationType,\n} from '../configuration';\nimport { Colors, ContextKeys } from '../constants';\nimport { Container } from '../container';\nimport { setContext } from '../context';\nimport { KeyboardScope } from '../keyboard';\nimport { Logger } from '../logger';\nimport { once } from '../system/event';\nimport { debounce } from '../system/function';\nimport { find } from '../system/iterable';\nimport { basename } from '../system/path';\nimport { isTextEditor } from '../system/utils';\nimport {\n\tDocumentBlameStateChangeEvent,\n\tDocumentDirtyStateChangeEvent,\n\tGitDocumentState,\n} from '../trackers/gitDocumentTracker';\nimport {\n\tAnnotationContext,\n\tAnnotationProviderBase,\n\tAnnotationStatus,\n\tTextEditorCorrelationKey,\n} from './annotationProvider';\nimport { GutterBlameAnnotationProvider } from './gutterBlameAnnotationProvider';\nimport { ChangesAnnotationContext, GutterChangesAnnotationProvider } from './gutterChangesAnnotationProvider';\nimport { GutterHeatmapBlameAnnotationProvider } from './gutterHeatmapBlameAnnotationProvider';\n\nexport const enum AnnotationClearReason {\n\tUser = 'User',\n\tBlameabilityChanged = 'BlameabilityChanged',\n\tColumnChanged = 'ColumnChanged',\n\tDisposing = 'Disposing',\n\tDocumentChanged = 'DocumentChanged',\n\tDocumentClosed = 'DocumentClosed',\n}\n\nexport const Decorations = {\n\tgutterBlameAnnotation: window.createTextEditorDecorationType({\n\t\trangeBehavior: DecorationRangeBehavior.ClosedOpen,\n\t\ttextDecoration: 'none',\n\t}),\n\tgutterBlameHighlight: undefined as TextEditorDecorationType | undefined,\n\tchangesLineChangedAnnotation: undefined as TextEditorDecorationType | undefined,\n\tchangesLineAddedAnnotation: undefined as TextEditorDecorationType | undefined,\n\tchangesLineDeletedAnnotation: undefined as TextEditorDecorationType | undefined,\n};\n\nexport class FileAnnotationController implements Disposable {\n\tprivate _onDidToggleAnnotations = new EventEmitter<void>();\n\tget onDidToggleAnnotations(): Event<void> {\n\t\treturn this._onDidToggleAnnotations.event;\n\t}\n\n\tprivate _annotationsDisposable: Disposable | undefined;\n\tprivate _annotationProviders = new Map<TextEditorCorrelationKey, AnnotationProviderBase>();\n\tprivate _disposable: Disposable;\n\tprivate _editor: TextEditor | undefined;\n\tprivate _keyboardScope: KeyboardScope | undefined = undefined;\n\tprivate readonly _toggleModes: Map<FileAnnotationType, AnnotationsToggleMode>;\n\tprivate _windowAnnotationType?: FileAnnotationType | undefined = undefined;\n\n\tconstructor(private readonly container: Container) {\n\t\tthis._disposable = Disposable.from(\n\t\t\tonce(container.onReady)(this.onReady, this),\n\t\t\tconfiguration.onDidChange(this.onConfigurationChanged, this),\n\t\t);\n\n\t\tthis._toggleModes = new Map<FileAnnotationType, AnnotationsToggleMode>();\n\t}\n\n\tdispose() {\n\t\tvoid this.clearAll();\n\n\t\tDecorations.gutterBlameAnnotation?.dispose();\n\t\tDecorations.gutterBlameHighlight?.dispose();\n\t\tDecorations.changesLineChangedAnnotation?.dispose();\n\t\tDecorations.changesLineAddedAnnotation?.dispose();\n\t\tDecorations.changesLineDeletedAnnotation?.dispose();\n\n\t\tthis._annotationsDisposable?.dispose();\n\t\tthis._disposable?.dispose();\n\t}\n\n\tprivate onReady(): void {\n\t\tthis.onConfigurationChanged();\n\t}\n\n\tprivate onConfigurationChanged(e?: ConfigurationChangeEvent) {\n\t\tconst cfg = this.container.config;\n\n\t\tif (configuration.changed(e, 'blame.highlight')) {\n\t\t\tDecorations.gutterBlameHighlight?.dispose();\n\t\t\tDecorations.gutterBlameHighlight = undefined;\n\n\t\t\tconst highlight = cfg.blame.highlight;\n\n\t\t\tif (highlight.enabled) {\n\t\t\t\tconst { locations } = highlight;\n\n\t\t\t\t// TODO@eamodio: Read from the theme color when the API exists\n\t\t\t\tconst gutterHighlightColor = '#00bcf2'; // new ThemeColor(Colors.LineHighlightOverviewRulerColor)\n\t\t\t\tconst gutterHighlightUri = locations.includes(BlameHighlightLocations.Gutter)\n\t\t\t\t\t? Uri.parse(\n\t\t\t\t\t\t\t`data:image/svg+xml,${encodeURIComponent(\n\t\t\t\t\t\t\t\t`<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 18 18'><rect fill='${gutterHighlightColor}' fill-opacity='0.6' x='7' y='0' width='3' height='18'/></svg>`,\n\t\t\t\t\t\t\t)}`,\n\t\t\t\t\t  )\n\t\t\t\t\t: undefined;\n\n\t\t\t\tDecorations.gutterBlameHighlight = window.createTextEditorDecorationType({\n\t\t\t\t\tgutterIconPath: gutterHighlightUri,\n\t\t\t\t\tgutterIconSize: 'contain',\n\t\t\t\t\tisWholeLine: true,\n\t\t\t\t\toverviewRulerLane: OverviewRulerLane.Right,\n\t\t\t\t\tbackgroundColor: locations.includes(BlameHighlightLocations.Line)\n\t\t\t\t\t\t? new ThemeColor(Colors.LineHighlightBackgroundColor)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\toverviewRulerColor: locations.includes(BlameHighlightLocations.Overview)\n\t\t\t\t\t\t? new ThemeColor(Colors.LineHighlightOverviewRulerColor)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (configuration.changed(e, 'changes.locations')) {\n\t\t\tDecorations.changesLineAddedAnnotation?.dispose();\n\t\t\tDecorations.changesLineChangedAnnotation?.dispose();\n\t\t\tDecorations.changesLineDeletedAnnotation?.dispose();\n\n\t\t\tconst { locations } = cfg.changes;\n\n\t\t\tDecorations.changesLineAddedAnnotation = window.createTextEditorDecorationType({\n\t\t\t\tgutterIconPath: locations.includes(ChangesLocations.Gutter)\n\t\t\t\t\t? Uri.parse(\n\t\t\t\t\t\t\t`data:image/svg+xml,${encodeURIComponent(\n\t\t\t\t\t\t\t\t\"<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 18 18'><rect fill='#587c0c' x='13' y='0' width='3' height='18'/></svg>\",\n\t\t\t\t\t\t\t)}`,\n\t\t\t\t\t  )\n\t\t\t\t\t: undefined,\n\t\t\t\tgutterIconSize: 'contain',\n\t\t\t\toverviewRulerLane: OverviewRulerLane.Left,\n\t\t\t\toverviewRulerColor: locations.includes(ChangesLocations.Overview)\n\t\t\t\t\t? new ThemeColor('editorOverviewRuler.addedForeground')\n\t\t\t\t\t: undefined,\n\t\t\t});\n\n\t\t\tDecorations.changesLineChangedAnnotation = window.createTextEditorDecorationType({\n\t\t\t\tgutterIconPath: locations.includes(ChangesLocations.Gutter)\n\t\t\t\t\t? Uri.parse(\n\t\t\t\t\t\t\t`data:image/svg+xml,${encodeURIComponent(\n\t\t\t\t\t\t\t\t\"<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 18 18'><rect fill='#0c7d9d' x='13' y='0' width='3' height='18'/></svg>\",\n\t\t\t\t\t\t\t)}`,\n\t\t\t\t\t  )\n\t\t\t\t\t: undefined,\n\t\t\t\tgutterIconSize: 'contain',\n\t\t\t\toverviewRulerLane: OverviewRulerLane.Left,\n\t\t\t\toverviewRulerColor: locations.includes(ChangesLocations.Overview)\n\t\t\t\t\t? new ThemeColor('editorOverviewRuler.modifiedForeground')\n\t\t\t\t\t: undefined,\n\t\t\t});\n\n\t\t\tDecorations.changesLineDeletedAnnotation = window.createTextEditorDecorationType({\n\t\t\t\tgutterIconPath: locations.includes(ChangesLocations.Gutter)\n\t\t\t\t\t? Uri.parse(\n\t\t\t\t\t\t\t`data:image/svg+xml,${encodeURIComponent(\n\t\t\t\t\t\t\t\t\"<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 18 18'><polygon fill='#94151b' points='13,10 13,18 17,14'/></svg>\",\n\t\t\t\t\t\t\t)}`,\n\t\t\t\t\t  )\n\t\t\t\t\t: undefined,\n\t\t\t\tgutterIconSize: 'contain',\n\t\t\t\toverviewRulerLane: OverviewRulerLane.Left,\n\t\t\t\toverviewRulerColor: locations.includes(ChangesLocations.Overview)\n\t\t\t\t\t? new ThemeColor('editorOverviewRuler.deletedForeground')\n\t\t\t\t\t: undefined,\n\t\t\t});\n\t\t}\n\n\t\tconst initializing = e == null;\n\n\t\tif (configuration.changed(e, 'blame.toggleMode')) {\n\t\t\tthis._toggleModes.set(FileAnnotationType.Blame, cfg.blame.toggleMode);\n\t\t\tif (!initializing && cfg.blame.toggleMode === AnnotationsToggleMode.File) {\n\t\t\t\tvoid this.clearAll();\n\t\t\t}\n\t\t}\n\n\t\tif (configuration.changed(e, 'changes.toggleMode')) {\n\t\t\tthis._toggleModes.set(FileAnnotationType.Changes, cfg.changes.toggleMode);\n\t\t\tif (!initializing && cfg.changes.toggleMode === AnnotationsToggleMode.File) {\n\t\t\t\tvoid this.clearAll();\n\t\t\t}\n\t\t}\n\n\t\tif (configuration.changed(e, 'heatmap.toggleMode')) {\n\t\t\tthis._toggleModes.set(FileAnnotationType.Heatmap, cfg.heatmap.toggleMode);\n\t\t\tif (!initializing && cfg.heatmap.toggleMode === AnnotationsToggleMode.File) {\n\t\t\t\tvoid this.clearAll();\n\t\t\t}\n\t\t}\n\n\t\tif (initializing) return;\n\n\t\tif (\n\t\t\tconfiguration.changed(e, 'blame') ||\n\t\t\tconfiguration.changed(e, 'changes') ||\n\t\t\tconfiguration.changed(e, 'heatmap') ||\n\t\t\tconfiguration.changed(e, 'hovers') ||\n\t\t\tconfiguration.changed(e, 'defaultDateFormat') ||\n\t\t\tconfiguration.changed(e, 'defaultDateSource') ||\n\t\t\tconfiguration.changed(e, 'defaultDateStyle') ||\n\t\t\tconfiguration.changed(e, 'defaultGravatarsStyle')\n\t\t) {\n\t\t\t// Since the configuration has changed -- reset any visible annotations\n\t\t\tfor (const provider of this._annotationProviders.values()) {\n\t\t\t\tif (provider == null) continue;\n\n\t\t\t\tvoid this.show(provider.editor, provider.annotationType ?? FileAnnotationType.Blame);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async onActiveTextEditorChanged(editor: TextEditor | undefined) {\n\t\tif (editor != null && !isTextEditor(editor)) return;\n\n\t\tthis._editor = editor;\n\t\t// Logger.log('AnnotationController.onActiveTextEditorChanged', editor && editor.document.uri.fsPath);\n\n\t\tif (this.isInWindowToggle()) {\n\t\t\tawait this.show(editor, this._windowAnnotationType!);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst provider = this.getProvider(editor);\n\t\tif (provider == null) {\n\t\t\tvoid setContext(ContextKeys.AnnotationStatus, undefined);\n\t\t\tvoid this.detachKeyboardHook();\n\t\t} else {\n\t\t\tvoid setContext(ContextKeys.AnnotationStatus, provider.status);\n\t\t\tvoid this.attachKeyboardHook();\n\t\t}\n\t}\n\n\tprivate onBlameStateChanged(e: DocumentBlameStateChangeEvent<GitDocumentState>) {\n\t\t// Only care if we are becoming un-blameable\n\t\tif (e.blameable) return;\n\n\t\tconst editor = window.activeTextEditor;\n\t\tif (editor == null) return;\n\n\t\tvoid this.clear(editor, AnnotationClearReason.BlameabilityChanged);\n\t}\n\n\tprivate onDirtyStateChanged(e: DocumentDirtyStateChangeEvent<GitDocumentState>) {\n\t\tfor (const [key, p] of this._annotationProviders) {\n\t\t\tif (!e.document.is(p.document)) continue;\n\n\t\t\tvoid this.clearCore(key, AnnotationClearReason.DocumentChanged);\n\t\t}\n\t}\n\n\tprivate onTextDocumentClosed(document: TextDocument) {\n\t\tif (!this.container.git.isTrackable(document.uri)) return;\n\n\t\tfor (const [key, p] of this._annotationProviders) {\n\t\t\tif (p.document !== document) continue;\n\n\t\t\tvoid this.clearCore(key, AnnotationClearReason.DocumentClosed);\n\t\t}\n\t}\n\n\tprivate onTextEditorViewColumnChanged(e: TextEditorViewColumnChangeEvent) {\n\t\t// FYI https://github.com/Microsoft/vscode/issues/35602\n\t\tconst provider = this.getProvider(e.textEditor);\n\t\tif (provider == null) {\n\t\t\t// If we don't find an exact match, do a fuzzy match (since we can't properly track editors)\n\t\t\tconst fuzzyProvider = find(\n\t\t\t\tthis._annotationProviders.values(),\n\t\t\t\tp => p.editor.document === e.textEditor.document,\n\t\t\t);\n\t\t\tif (fuzzyProvider == null) return;\n\n\t\t\tvoid this.clearCore(fuzzyProvider.correlationKey, AnnotationClearReason.ColumnChanged);\n\n\t\t\treturn;\n\t\t}\n\n\t\tvoid provider.restore(e.textEditor);\n\t}\n\n\tprivate onVisibleTextEditorsChanged(editors: readonly TextEditor[]) {\n\t\tlet provider: AnnotationProviderBase | undefined;\n\t\tfor (const e of editors) {\n\t\t\tprovider = this.getProvider(e);\n\t\t\tif (provider == null) continue;\n\n\t\t\tvoid provider.restore(e);\n\t\t}\n\t}\n\tisInWindowToggle(): boolean {\n\t\treturn this.getToggleMode(this._windowAnnotationType) === AnnotationsToggleMode.Window;\n\t}\n\n\tprivate getToggleMode(annotationType: FileAnnotationType | undefined): AnnotationsToggleMode {\n\t\tif (annotationType == null) return AnnotationsToggleMode.File;\n\n\t\treturn this._toggleModes.get(annotationType) ?? AnnotationsToggleMode.File;\n\t}\n\n\tclear(editor: TextEditor, reason: AnnotationClearReason = AnnotationClearReason.User) {\n\t\tif (this.isInWindowToggle()) {\n\t\t\treturn this.clearAll();\n\t\t}\n\n\t\treturn this.clearCore(AnnotationProviderBase.getCorrelationKey(editor), reason);\n\t}\n\n\tasync clearAll() {\n\t\tthis._windowAnnotationType = undefined;\n\t\tfor (const [key] of this._annotationProviders) {\n\t\t\tawait this.clearCore(key, AnnotationClearReason.Disposing);\n\t\t}\n\t}\n\n\tasync getAnnotationType(editor: TextEditor | undefined): Promise<FileAnnotationType | undefined> {\n\t\tconst provider = this.getProvider(editor);\n\t\tif (provider == null) return undefined;\n\n\t\tconst trackedDocument = await this.container.tracker.get(editor!.document);\n\t\tif (trackedDocument == null || !trackedDocument.isBlameable) return undefined;\n\n\t\treturn provider.annotationType;\n\t}\n\n\tgetProvider(editor: TextEditor | undefined): AnnotationProviderBase | undefined {\n\t\tif (editor == null || editor.document == null) return undefined;\n\t\treturn this._annotationProviders.get(AnnotationProviderBase.getCorrelationKey(editor));\n\t}\n\n\tasync show(editor: TextEditor | undefined, type: FileAnnotationType, context?: AnnotationContext): Promise<boolean>;\n\tasync show(\n\t\teditor: TextEditor | undefined,\n\t\ttype: FileAnnotationType.Changes,\n\t\tcontext?: ChangesAnnotationContext,\n\t): Promise<boolean>;\n\tasync show(\n\t\teditor: TextEditor | undefined,\n\t\ttype: FileAnnotationType,\n\t\tcontext?: AnnotationContext | ChangesAnnotationContext,\n\t): Promise<boolean> {\n\t\tif (this.getToggleMode(type) === AnnotationsToggleMode.Window) {\n\t\t\tlet first = this._windowAnnotationType == null;\n\t\t\tconst reset = !first && this._windowAnnotationType !== type;\n\n\t\t\tthis._windowAnnotationType = type;\n\n\t\t\tif (reset) {\n\t\t\t\tawait this.clearAll();\n\t\t\t\tfirst = true;\n\t\t\t}\n\n\t\t\tif (first) {\n\t\t\t\tfor (const e of window.visibleTextEditors) {\n\t\t\t\t\tif (e === editor) continue;\n\n\t\t\t\t\tvoid this.show(e, type);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (editor == null) return false; // || editor.viewColumn == null) return false;\n\t\tthis._editor = editor;\n\n\t\tconst trackedDocument = await this.container.tracker.getOrAdd(editor.document);\n\t\tif (!trackedDocument.isBlameable) return false;\n\n\t\tconst currentProvider = this.getProvider(editor);\n\t\tif (currentProvider?.annotationType === type) {\n\t\t\tawait currentProvider.provideAnnotation(context);\n\t\t\tawait currentProvider.selection(context?.selection);\n\t\t\treturn true;\n\t\t}\n\n\t\tconst provider = await window.withProgress(\n\t\t\t{ location: ProgressLocation.Window },\n\t\t\tasync (progress: Progress<{ message: string }>) => {\n\t\t\t\tawait setContext(ContextKeys.AnnotationStatus, AnnotationStatus.Computing);\n\n\t\t\t\tconst computingAnnotations = this.showAnnotationsCore(currentProvider, editor, type, context, progress);\n\t\t\t\tconst provider = await computingAnnotations;\n\n\t\t\t\tif (editor === this._editor) {\n\t\t\t\t\tawait setContext(ContextKeys.AnnotationStatus, provider?.status);\n\t\t\t\t}\n\n\t\t\t\treturn computingAnnotations;\n\t\t\t},\n\t\t);\n\n\t\treturn provider != null;\n\t}\n\n\tasync toggle(\n\t\teditor: TextEditor | undefined,\n\t\ttype: FileAnnotationType,\n\t\tcontext?: AnnotationContext,\n\t\ton?: boolean,\n\t): Promise<boolean>;\n\tasync toggle(\n\t\teditor: TextEditor | undefined,\n\t\ttype: FileAnnotationType.Changes,\n\t\tcontext?: ChangesAnnotationContext,\n\t\ton?: boolean,\n\t): Promise<boolean>;\n\tasync toggle(\n\t\teditor: TextEditor | undefined,\n\t\ttype: FileAnnotationType,\n\t\tcontext?: AnnotationContext | ChangesAnnotationContext,\n\t\ton?: boolean,\n\t): Promise<boolean> {\n\t\tif (editor != null) {\n\t\t\tconst trackedDocument = await this.container.tracker.getOrAdd(editor.document);\n\t\t\tif ((type === FileAnnotationType.Changes && !trackedDocument.isTracked) || !trackedDocument.isBlameable) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tconst provider = this.getProvider(editor);\n\t\tif (provider == null) return this.show(editor, type, context);\n\n\t\tconst reopen = provider.annotationType !== type || provider.mustReopen(context);\n\t\tif (on === true && !reopen) return true;\n\n\t\tif (this.isInWindowToggle()) {\n\t\t\tawait this.clearAll();\n\t\t} else {\n\t\t\tawait this.clearCore(provider.correlationKey, AnnotationClearReason.User);\n\t\t}\n\n\t\tif (!reopen) return false;\n\n\t\treturn this.show(editor, type, context);\n\t}\n\n\tprivate async attachKeyboardHook() {\n\t\t// Allows pressing escape to exit the annotations\n\t\tif (this._keyboardScope == null) {\n\t\t\tthis._keyboardScope = await this.container.keyboard.beginScope({\n\t\t\t\tescape: {\n\t\t\t\t\tonDidPressKey: async () => {\n\t\t\t\t\t\tconst e = this._editor;\n\t\t\t\t\t\tif (e == null) return undefined;\n\n\t\t\t\t\t\tawait this.clear(e, AnnotationClearReason.User);\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate async clearCore(key: TextEditorCorrelationKey, reason: AnnotationClearReason) {\n\t\tconst provider = this._annotationProviders.get(key);\n\t\tif (provider == null) return;\n\n\t\tLogger.log(`${reason}:`, `Clear annotations for ${key}`);\n\n\t\tthis._annotationProviders.delete(key);\n\t\tprovider.dispose();\n\n\t\tif (this._annotationProviders.size === 0 || key === AnnotationProviderBase.getCorrelationKey(this._editor)) {\n\t\t\tawait setContext(ContextKeys.AnnotationStatus, undefined);\n\t\t\tawait this.detachKeyboardHook();\n\t\t}\n\n\t\tif (this._annotationProviders.size === 0) {\n\t\t\tLogger.log('Remove all listener registrations for annotations');\n\n\t\t\tthis._annotationsDisposable?.dispose();\n\t\t\tthis._annotationsDisposable = undefined;\n\t\t}\n\n\t\tthis._onDidToggleAnnotations.fire();\n\t}\n\n\tprivate async detachKeyboardHook() {\n\t\tif (this._keyboardScope == null) return;\n\n\t\tawait this._keyboardScope.dispose();\n\t\tthis._keyboardScope = undefined;\n\t}\n\n\tprivate async showAnnotationsCore(\n\t\tcurrentProvider: AnnotationProviderBase | undefined,\n\t\teditor: TextEditor,\n\t\ttype: FileAnnotationType,\n\t\tcontext?: AnnotationContext | ChangesAnnotationContext,\n\t\tprogress?: Progress<{ message: string }>,\n\t): Promise<AnnotationProviderBase | undefined> {\n\t\tif (progress != null) {\n\t\t\tlet annotationsLabel = 'annotations';\n\t\t\tswitch (type) {\n\t\t\t\tcase FileAnnotationType.Blame:\n\t\t\t\t\tannotationsLabel = 'blame annotations';\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase FileAnnotationType.Changes:\n\t\t\t\t\tannotationsLabel = 'changes annotations';\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase FileAnnotationType.Heatmap:\n\t\t\t\t\tannotationsLabel = 'heatmap annotations';\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tprogress.report({\n\t\t\t\tmessage: `Computing ${annotationsLabel} for ${basename(editor.document.fileName)}`,\n\t\t\t});\n\t\t}\n\n\t\t// Allows pressing escape to exit the annotations\n\t\tawait this.attachKeyboardHook();\n\n\t\tconst trackedDocument = await this.container.tracker.getOrAdd(editor.document);\n\n\t\tlet provider: AnnotationProviderBase | undefined = undefined;\n\t\tswitch (type) {\n\t\t\tcase FileAnnotationType.Blame:\n\t\t\t\tprovider = new GutterBlameAnnotationProvider(editor, trackedDocument, this.container);\n\t\t\t\tbreak;\n\n\t\t\tcase FileAnnotationType.Changes:\n\t\t\t\tprovider = new GutterChangesAnnotationProvider(editor, trackedDocument, this.container);\n\t\t\t\tbreak;\n\n\t\t\tcase FileAnnotationType.Heatmap:\n\t\t\t\tprovider = new GutterHeatmapBlameAnnotationProvider(editor, trackedDocument, this.container);\n\t\t\t\tbreak;\n\t\t}\n\t\tif (provider == null || !(await provider.validate())) return undefined;\n\n\t\tif (currentProvider != null) {\n\t\t\tawait this.clearCore(currentProvider.correlationKey, AnnotationClearReason.User);\n\t\t}\n\n\t\tif (this._annotationsDisposable == null && this._annotationProviders.size === 0) {\n\t\t\tLogger.log('Add listener registrations for annotations');\n\n\t\t\tthis._annotationsDisposable = Disposable.from(\n\t\t\t\twindow.onDidChangeActiveTextEditor(debounce(this.onActiveTextEditorChanged, 50), this),\n\t\t\t\twindow.onDidChangeTextEditorViewColumn(this.onTextEditorViewColumnChanged, this),\n\t\t\t\twindow.onDidChangeVisibleTextEditors(debounce(this.onVisibleTextEditorsChanged, 50), this),\n\t\t\t\tworkspace.onDidCloseTextDocument(this.onTextDocumentClosed, this),\n\t\t\t\tthis.container.tracker.onDidChangeBlameState(this.onBlameStateChanged, this),\n\t\t\t\tthis.container.tracker.onDidChangeDirtyState(this.onDirtyStateChanged, this),\n\t\t\t);\n\t\t}\n\n\t\tthis._annotationProviders.set(provider.correlationKey, provider);\n\t\tif (await provider.provideAnnotation(context)) {\n\t\t\tthis._onDidToggleAnnotations.fire();\n\t\t\treturn provider;\n\t\t}\n\n\t\tawait this.clearCore(provider.correlationKey, AnnotationClearReason.Disposing);\n\n\t\treturn undefined;\n\t}\n}\n","import {\n\tCancellationToken,\n\tCancellationTokenSource,\n\tConfigurationChangeEvent,\n\tDecorationOptions,\n\tDecorationRangeBehavior,\n\tDisposable,\n\tRange,\n\tTextEditor,\n\tTextEditorDecorationType,\n\twindow,\n} from 'vscode';\nimport { configuration } from '../configuration';\nimport { GlyphChars } from '../constants';\nimport { Container } from '../container';\nimport { CommitFormatter } from '../git/formatters';\nimport { GitCommit, PullRequest } from '../git/models';\nimport { Authentication } from '../git/remotes/provider';\nimport { LogCorrelationContext, Logger } from '../logger';\nimport { debug, log } from '../system/decorators/log';\nimport { once } from '../system/event';\nimport { count, every, filterMap } from '../system/iterable';\nimport { PromiseCancelledError, PromiseCancelledErrorWithId, raceAll } from '../system/promise';\nimport { isTextEditor } from '../system/utils';\nimport { LinesChangeEvent, LineSelection } from '../trackers/gitLineTracker';\nimport { Annotations } from './annotations';\n\nconst annotationDecoration: TextEditorDecorationType = window.createTextEditorDecorationType({\n\tafter: {\n\t\tmargin: '0 0 0 3em',\n\t\ttextDecoration: 'none',\n\t},\n\trangeBehavior: DecorationRangeBehavior.ClosedOpen,\n});\n\nexport class LineAnnotationController implements Disposable {\n\tprivate _cancellation: CancellationTokenSource | undefined;\n\tprivate readonly _disposable: Disposable;\n\tprivate _editor: TextEditor | undefined;\n\tprivate _enabled: boolean = false;\n\n\tconstructor(private readonly container: Container) {\n\t\tthis._disposable = Disposable.from(\n\t\t\tonce(container.onReady)(this.onReady, this),\n\t\t\tconfiguration.onDidChange(this.onConfigurationChanged, this),\n\t\t\tcontainer.fileAnnotations.onDidToggleAnnotations(this.onFileAnnotationsToggled, this),\n\t\t\tAuthentication.onDidChange(() => void this.refresh(window.activeTextEditor)),\n\t\t);\n\t}\n\n\tdispose() {\n\t\tthis.clearAnnotations(this._editor);\n\n\t\tthis.container.lineTracker.unsubscribe(this);\n\t\tthis._disposable.dispose();\n\t}\n\n\tprivate onReady(): void {\n\t\tthis.onConfigurationChanged();\n\t}\n\n\tprivate onConfigurationChanged(e?: ConfigurationChangeEvent) {\n\t\tif (!configuration.changed(e, 'currentLine')) return;\n\n\t\tif (configuration.changed(e, 'currentLine.enabled')) {\n\t\t\tif (this.container.config.currentLine.enabled) {\n\t\t\t\tthis._enabled = true;\n\t\t\t\tthis.resume();\n\t\t\t} else {\n\t\t\t\tthis._enabled = false;\n\t\t\t\tthis.setLineTracker(false);\n\t\t\t}\n\t\t}\n\n\t\tvoid this.refresh(window.activeTextEditor);\n\t}\n\n\tprivate _suspended: boolean = false;\n\tget suspended() {\n\t\treturn !this._enabled || this._suspended;\n\t}\n\n\t@log()\n\tresume() {\n\t\tthis.setLineTracker(true);\n\n\t\tif (this._suspended) {\n\t\t\tthis._suspended = false;\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t@log()\n\tsuspend() {\n\t\tthis.setLineTracker(false);\n\n\t\tif (!this._suspended) {\n\t\t\tthis._suspended = true;\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t@debug({\n\t\targs: {\n\t\t\t0: (e: LinesChangeEvent) =>\n\t\t\t\t`editor=${e.editor?.document.uri.toString(true)}, selections=${e.selections\n\t\t\t\t\t?.map(s => `[${s.anchor}-${s.active}]`)\n\t\t\t\t\t.join(',')}, pending=${Boolean(e.pending)}, reason=${e.reason}`,\n\t\t},\n\t})\n\tprivate onActiveLinesChanged(e: LinesChangeEvent) {\n\t\tif (!e.pending && e.selections !== undefined) {\n\t\t\tvoid this.refresh(e.editor);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.clear(e.editor);\n\t}\n\n\tprivate onFileAnnotationsToggled() {\n\t\tvoid this.refresh(window.activeTextEditor);\n\t}\n\n\t@debug({ args: false, singleLine: true })\n\tclear(editor: TextEditor | undefined) {\n\t\tthis._cancellation?.cancel();\n\t\tif (this._editor !== editor && this._editor != null) {\n\t\t\tthis.clearAnnotations(this._editor);\n\t\t}\n\t\tthis.clearAnnotations(editor);\n\t}\n\n\t@log({ args: false })\n\tasync toggle(editor: TextEditor | undefined) {\n\t\tthis._enabled = !(this._enabled && !this.suspended);\n\n\t\tif (this._enabled) {\n\t\t\tif (this.resume()) {\n\t\t\t\tawait this.refresh(editor);\n\t\t\t}\n\t\t} else if (this.suspend()) {\n\t\t\tawait this.refresh(editor);\n\t\t}\n\t}\n\n\tprivate clearAnnotations(editor: TextEditor | undefined) {\n\t\tif (editor === undefined || (editor as any)._disposed === true) return;\n\n\t\teditor.setDecorations(annotationDecoration, []);\n\t}\n\n\tprivate async getPullRequests(\n\t\trepoPath: string,\n\t\tlines: [number, GitCommit][],\n\t\t{ timeout }: { timeout?: number } = {},\n\t) {\n\t\tif (lines.length === 0) return undefined;\n\n\t\tconst remote = await this.container.git.getRichRemoteProvider(repoPath);\n\t\tif (remote?.provider == null) return undefined;\n\n\t\tconst refs = new Set<string>();\n\n\t\tfor (const [, commit] of lines) {\n\t\t\trefs.add(commit.ref);\n\t\t}\n\n\t\tif (refs.size === 0) return undefined;\n\n\t\tconst { provider } = remote;\n\t\tconst prs = await raceAll(\n\t\t\trefs.values(),\n\t\t\tref => this.container.git.getPullRequestForCommit(ref, provider),\n\t\t\ttimeout,\n\t\t);\n\t\tif (prs.size === 0 || every(prs.values(), pr => pr == null)) return undefined;\n\n\t\treturn prs;\n\t}\n\n\t@debug({ args: false })\n\tprivate async refresh(editor: TextEditor | undefined, options?: { prs?: Map<string, PullRequest | undefined> }) {\n\t\tif (editor == null && this._editor == null) return;\n\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst selections = this.container.lineTracker.selections;\n\t\tif (editor == null || selections == null || !isTextEditor(editor)) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = ` ${GlyphChars.Dot} Skipped because there is no valid editor or no valid selections`;\n\t\t\t}\n\n\t\t\tthis.clear(this._editor);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._editor !== editor) {\n\t\t\t// Clear any annotations on the previously active editor\n\t\t\tthis.clear(this._editor);\n\n\t\t\tthis._editor = editor;\n\t\t}\n\n\t\tconst cfg = this.container.config.currentLine;\n\t\tif (this.suspended) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = ` ${GlyphChars.Dot} Skipped because the controller is suspended`;\n\t\t\t}\n\n\t\t\tthis.clear(editor);\n\t\t\treturn;\n\t\t}\n\n\t\tconst trackedDocument = await this.container.tracker.getOrAdd(editor.document);\n\t\tif (!trackedDocument.isBlameable && this.suspended) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = ` ${GlyphChars.Dot} Skipped because the ${\n\t\t\t\t\tthis.suspended\n\t\t\t\t\t\t? 'controller is suspended'\n\t\t\t\t\t\t: `document(${trackedDocument.uri.toString(true)}) is not blameable`\n\t\t\t\t}`;\n\t\t\t}\n\n\t\t\tthis.clear(editor);\n\t\t\treturn;\n\t\t}\n\n\t\t// Make sure the editor hasn't died since the await above and that we are still on the same line(s)\n\t\tif (editor.document == null || !this.container.lineTracker.includes(selections)) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = ` ${GlyphChars.Dot} Skipped because the ${\n\t\t\t\t\teditor.document == null\n\t\t\t\t\t\t? 'editor is gone'\n\t\t\t\t\t\t: `selection(s)=${selections\n\t\t\t\t\t\t\t\t.map(s => `[${s.anchor}-${s.active}]`)\n\t\t\t\t\t\t\t\t.join()} are no longer current`\n\t\t\t\t}`;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (cc != null) {\n\t\t\tcc.exitDetails = ` ${GlyphChars.Dot} selection(s)=${selections\n\t\t\t\t.map(s => `[${s.anchor}-${s.active}]`)\n\t\t\t\t.join()}`;\n\t\t}\n\n\t\tconst commitLines = [\n\t\t\t...filterMap<LineSelection, [number, GitCommit]>(selections, selection => {\n\t\t\t\tconst state = this.container.lineTracker.getState(selection.active);\n\t\t\t\tif (state?.commit == null) {\n\t\t\t\t\tLogger.debug(cc, `Line ${selection.active} returned no commit`);\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\treturn [selection.active, state.commit];\n\t\t\t}),\n\t\t];\n\n\t\tconst repoPath = trackedDocument.uri.repoPath;\n\n\t\t// TODO: Make this configurable?\n\t\tconst timeout = 100;\n\t\tconst [getBranchAndTagTips, prs] = await Promise.all([\n\t\t\tCommitFormatter.has(cfg.format, 'tips') ? this.container.git.getBranchesAndTagsTipsFn(repoPath) : undefined,\n\t\t\trepoPath != null &&\n\t\t\tcfg.pullRequests.enabled &&\n\t\t\tCommitFormatter.has(\n\t\t\t\tcfg.format,\n\t\t\t\t'pullRequest',\n\t\t\t\t'pullRequestAgo',\n\t\t\t\t'pullRequestAgoOrDate',\n\t\t\t\t'pullRequestDate',\n\t\t\t\t'pullRequestState',\n\t\t\t)\n\t\t\t\t? options?.prs ??\n\t\t\t\t  this.getPullRequests(\n\t\t\t\t\t\trepoPath,\n\t\t\t\t\t\tcommitLines.filter(([, commit]) => !commit.isUncommitted),\n\t\t\t\t\t\t{ timeout: timeout },\n\t\t\t\t  )\n\t\t\t\t: undefined,\n\t\t]);\n\n\t\tif (prs != null) {\n\t\t\tthis._cancellation?.cancel();\n\t\t\tthis._cancellation = new CancellationTokenSource();\n\t\t\tvoid this.waitForAnyPendingPullRequests(editor, prs, this._cancellation.token, timeout, cc);\n\t\t}\n\n\t\tconst decorations = [];\n\n\t\tfor (const [l, commit] of commitLines) {\n\t\t\tconst decoration = Annotations.trailing(\n\t\t\t\tcommit,\n\t\t\t\t// await GitUri.fromUri(editor.document.uri),\n\t\t\t\t// l,\n\t\t\t\tcfg.format,\n\t\t\t\t{\n\t\t\t\t\tdateFormat: cfg.dateFormat === null ? this.container.config.defaultDateFormat : cfg.dateFormat,\n\t\t\t\t\tgetBranchAndTagTips: getBranchAndTagTips,\n\t\t\t\t\tpullRequestOrRemote: prs?.get(commit.ref),\n\t\t\t\t\tpullRequestPendingMessage: `PR ${GlyphChars.Ellipsis}`,\n\t\t\t\t},\n\t\t\t\tcfg.scrollable,\n\t\t\t) as DecorationOptions;\n\t\t\tdecoration.range = editor.document.validateRange(\n\t\t\t\tnew Range(l, Number.MAX_SAFE_INTEGER, l, Number.MAX_SAFE_INTEGER),\n\t\t\t);\n\n\t\t\tdecorations.push(decoration);\n\t\t}\n\n\t\teditor.setDecorations(annotationDecoration, decorations);\n\t}\n\n\tprivate setLineTracker(enabled: boolean) {\n\t\tif (enabled) {\n\t\t\tif (!this.container.lineTracker.subscribed(this)) {\n\t\t\t\tthis.container.lineTracker.subscribe(\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.container.lineTracker.onDidChangeActiveLines(this.onActiveLinesChanged, this),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.container.lineTracker.unsubscribe(this);\n\t}\n\n\tprivate async waitForAnyPendingPullRequests(\n\t\teditor: TextEditor,\n\t\tprs: Map<\n\t\t\tstring,\n\t\t\tPullRequest | PromiseCancelledErrorWithId<string, Promise<PullRequest | undefined>> | undefined\n\t\t>,\n\t\tcancellationToken: CancellationToken,\n\t\ttimeout: number,\n\t\tcc: LogCorrelationContext | undefined,\n\t) {\n\t\t// If there are any PRs that timed out, refresh the annotation(s) once they complete\n\t\tconst prCount = count(prs.values(), pr => pr instanceof PromiseCancelledError);\n\t\tif (cancellationToken.isCancellationRequested || prCount === 0) return;\n\n\t\tLogger.debug(cc, `${GlyphChars.Dot} ${prCount} pull request queries took too long (over ${timeout} ms)`);\n\n\t\tconst resolved = new Map<string, PullRequest | undefined>();\n\t\tfor (const [key, value] of prs) {\n\t\t\tresolved.set(key, value instanceof PromiseCancelledError ? await value.promise : value);\n\t\t}\n\n\t\tif (cancellationToken.isCancellationRequested || editor !== this._editor) return;\n\n\t\tLogger.debug(cc, `${GlyphChars.Dot} ${prCount} pull request queries completed; refreshing...`);\n\n\t\tvoid this.refresh(editor, { prs: resolved });\n\t}\n}\n","import {\n\tCancellationToken,\n\tCodeLens,\n\tCodeLensProvider,\n\tCommand,\n\tDocumentSelector,\n\tDocumentSymbol,\n\tEvent,\n\tEventEmitter,\n\tLocation,\n\tPosition,\n\tRange,\n\tSymbolInformation,\n\tSymbolKind,\n\tTextDocument,\n\tUri,\n} from 'vscode';\nimport type {\n\tDiffWithPreviousCommandArgs,\n\tOpenOnRemoteCommandArgs,\n\tShowCommitsInViewCommandArgs,\n\tShowQuickCommitCommandArgs,\n\tShowQuickCommitFileCommandArgs,\n\tShowQuickFileHistoryCommandArgs,\n\tToggleFileChangesAnnotationCommandArgs,\n} from '../commands';\nimport {\n\tCodeLensCommand,\n\tCodeLensConfig,\n\tCodeLensLanguageScope,\n\tCodeLensScopes,\n\tconfiguration,\n\tFileAnnotationType,\n} from '../configuration';\nimport { Commands, CoreCommands, Schemes } from '../constants';\nimport { Container } from '../container';\nimport type { GitUri } from '../git/gitUri';\nimport { GitBlame, GitBlameLines, GitCommit } from '../git/models';\nimport { RemoteResourceType } from '../git/remotes/provider';\nimport { Logger } from '../logger';\nimport { asCommand, executeCoreCommand } from '../system/command';\nimport { is, once } from '../system/function';\nimport { filterMap, find, first, join, map } from '../system/iterable';\n\nexport class GitRecentChangeCodeLens extends CodeLens {\n\tconstructor(\n\t\tpublic readonly languageId: string,\n\t\tpublic readonly symbol: DocumentSymbol | SymbolInformation,\n\t\tpublic readonly uri: GitUri | undefined,\n\t\tpublic readonly dateFormat: string | null,\n\t\tprivate readonly blame: (() => GitBlameLines | undefined) | undefined,\n\t\tpublic readonly blameRange: Range,\n\t\tpublic readonly isFullRange: boolean,\n\t\trange: Range,\n\t\tpublic readonly desiredCommand: CodeLensCommand | false,\n\t\tcommand?: Command | undefined,\n\t) {\n\t\tsuper(range, command);\n\t}\n\n\tgetBlame(): GitBlameLines | undefined {\n\t\treturn this.blame?.();\n\t}\n}\n\nexport class GitAuthorsCodeLens extends CodeLens {\n\tconstructor(\n\t\tpublic readonly languageId: string,\n\t\tpublic readonly symbol: DocumentSymbol | SymbolInformation,\n\t\tpublic readonly uri: GitUri | undefined,\n\t\tprivate readonly blame: () => GitBlameLines | undefined,\n\t\tpublic readonly blameRange: Range,\n\t\tpublic readonly isFullRange: boolean,\n\t\trange: Range,\n\t\tpublic readonly desiredCommand: CodeLensCommand | false,\n\t) {\n\t\tsuper(range);\n\t}\n\n\tgetBlame(): GitBlameLines | undefined {\n\t\treturn this.blame();\n\t}\n}\n\nexport class GitCodeLensProvider implements CodeLensProvider {\n\tstatic selector: DocumentSelector = [\n\t\t{ scheme: Schemes.File },\n\t\t{ scheme: Schemes.Git },\n\t\t{ scheme: Schemes.GitLens },\n\t\t{ scheme: Schemes.PRs },\n\t\t{ scheme: Schemes.Vsls },\n\t\t{ scheme: Schemes.VslsScc },\n\t\t{ scheme: Schemes.Virtual },\n\t\t{ scheme: Schemes.GitHub },\n\t];\n\n\tprivate _onDidChangeCodeLenses = new EventEmitter<void>();\n\tget onDidChangeCodeLenses(): Event<void> {\n\t\treturn this._onDidChangeCodeLenses.event;\n\t}\n\n\tconstructor(private readonly container: Container) {}\n\n\treset(_reason?: 'idle' | 'saved') {\n\t\tthis._onDidChangeCodeLenses.fire();\n\t}\n\n\tasync provideCodeLenses(document: TextDocument, token: CancellationToken): Promise<CodeLens[]> {\n\t\tconst trackedDocument = await this.container.tracker.getOrAdd(document);\n\t\tif (!trackedDocument.isBlameable) return [];\n\n\t\tlet dirty = false;\n\t\tif (document.isDirty) {\n\t\t\t// Only allow dirty blames if we are idle\n\t\t\tif (trackedDocument.isDirtyIdle) {\n\t\t\t\tconst maxLines = this.container.config.advanced.blame.sizeThresholdAfterEdit;\n\t\t\t\tif (maxLines > 0 && document.lineCount > maxLines) {\n\t\t\t\t\tdirty = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdirty = true;\n\t\t\t}\n\t\t}\n\n\t\tconst cfg = configuration.get('codeLens', document);\n\n\t\tlet languageScope = cfg.scopesByLanguage?.find(ll => ll.language?.toLowerCase() === document.languageId);\n\t\tif (languageScope == null) {\n\t\t\tlanguageScope = {\n\t\t\t\tlanguage: document.languageId,\n\t\t\t};\n\t\t}\n\t\tif (languageScope.scopes == null) {\n\t\t\tlanguageScope.scopes = cfg.scopes;\n\t\t}\n\t\tif (languageScope.symbolScopes == null) {\n\t\t\tlanguageScope.symbolScopes = cfg.symbolScopes;\n\t\t}\n\n\t\tlanguageScope.symbolScopes =\n\t\t\tlanguageScope.symbolScopes != null\n\t\t\t\t? (languageScope.symbolScopes = languageScope.symbolScopes.map(s => s.toLowerCase()))\n\t\t\t\t: [];\n\n\t\tconst lenses: CodeLens[] = [];\n\n\t\tconst gitUri = trackedDocument.uri;\n\t\tlet blame: GitBlame | undefined;\n\t\tlet symbols;\n\n\t\tif (!dirty) {\n\t\t\tif (token.isCancellationRequested) return lenses;\n\n\t\t\tif (languageScope.scopes.length === 1 && languageScope.scopes.includes(CodeLensScopes.Document)) {\n\t\t\t\tblame = await this.container.git.getBlame(gitUri, document);\n\t\t\t} else {\n\t\t\t\t[blame, symbols] = await Promise.all([\n\t\t\t\t\tthis.container.git.getBlame(gitUri, document),\n\t\t\t\t\texecuteCoreCommand<[Uri], SymbolInformation[]>(\n\t\t\t\t\t\tCoreCommands.ExecuteDocumentSymbolProvider,\n\t\t\t\t\t\tdocument.uri,\n\t\t\t\t\t),\n\t\t\t\t]);\n\t\t\t}\n\n\t\t\tif (blame == null || blame?.lines.length === 0) return lenses;\n\t\t} else if (languageScope.scopes.length !== 1 || !languageScope.scopes.includes(CodeLensScopes.Document)) {\n\t\t\tsymbols = await executeCoreCommand<[Uri], SymbolInformation[]>(\n\t\t\t\tCoreCommands.ExecuteDocumentSymbolProvider,\n\t\t\t\tdocument.uri,\n\t\t\t);\n\t\t}\n\n\t\tif (token.isCancellationRequested) return lenses;\n\n\t\tconst documentRangeFn = once(() => document.validateRange(new Range(0, 0, 1000000, 1000000)));\n\n\t\t// Since blame information isn't valid when there are unsaved changes -- update the lenses appropriately\n\t\tconst dirtyCommand: Command | undefined = dirty\n\t\t\t? { command: undefined!, title: this.getDirtyTitle(cfg) }\n\t\t\t: undefined;\n\n\t\tif (symbols !== undefined) {\n\t\t\tLogger.log('GitCodeLensProvider.provideCodeLenses:', `${symbols.length} symbol(s) found`);\n\t\t\tfor (const sym of symbols) {\n\t\t\t\tthis.provideCodeLens(\n\t\t\t\t\tlenses,\n\t\t\t\t\tdocument,\n\t\t\t\t\tsym,\n\t\t\t\t\tlanguageScope as Required<CodeLensLanguageScope>,\n\t\t\t\t\tdocumentRangeFn,\n\t\t\t\t\tblame,\n\t\t\t\t\tgitUri,\n\t\t\t\t\tcfg,\n\t\t\t\t\tdirty,\n\t\t\t\t\tdirtyCommand,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\t(languageScope.scopes.includes(CodeLensScopes.Document) || languageScope.symbolScopes.includes('file')) &&\n\t\t\t!languageScope.symbolScopes.includes('!file')\n\t\t) {\n\t\t\t// Check if we have a lens for the whole document -- if not add one\n\t\t\tif (lenses.find(l => l.range.start.line === 0 && l.range.end.line === 0) == null) {\n\t\t\t\tconst blameRange = documentRangeFn();\n\n\t\t\t\tlet blameForRangeFn: (() => GitBlameLines | undefined) | undefined = undefined;\n\t\t\t\tif (dirty || cfg.recentChange.enabled) {\n\t\t\t\t\tif (!dirty) {\n\t\t\t\t\t\tblameForRangeFn = once(() => this.container.git.getBlameRange(blame!, gitUri, blameRange));\n\t\t\t\t\t}\n\n\t\t\t\t\tconst fileSymbol = new SymbolInformation(\n\t\t\t\t\t\tgitUri.fileName,\n\t\t\t\t\t\tSymbolKind.File,\n\t\t\t\t\t\t'',\n\t\t\t\t\t\tnew Location(gitUri.documentUri(), new Range(0, 0, 0, blameRange.start.character)),\n\t\t\t\t\t);\n\t\t\t\t\tlenses.push(\n\t\t\t\t\t\tnew GitRecentChangeCodeLens(\n\t\t\t\t\t\t\tdocument.languageId,\n\t\t\t\t\t\t\tfileSymbol,\n\t\t\t\t\t\t\tgitUri,\n\t\t\t\t\t\t\tcfg.dateFormat,\n\t\t\t\t\t\t\tblameForRangeFn,\n\t\t\t\t\t\t\tblameRange,\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\tgetRangeFromSymbol(fileSymbol),\n\t\t\t\t\t\t\tcfg.recentChange.command,\n\t\t\t\t\t\t\tdirtyCommand,\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (!dirty && cfg.authors.enabled) {\n\t\t\t\t\tif (blameForRangeFn === undefined) {\n\t\t\t\t\t\tblameForRangeFn = once(() => this.container.git.getBlameRange(blame!, gitUri, blameRange));\n\t\t\t\t\t}\n\n\t\t\t\t\tconst fileSymbol = new SymbolInformation(\n\t\t\t\t\t\tgitUri.fileName,\n\t\t\t\t\t\tSymbolKind.File,\n\t\t\t\t\t\t'',\n\t\t\t\t\t\tnew Location(gitUri.documentUri(), new Range(0, 1, 0, blameRange.start.character)),\n\t\t\t\t\t);\n\t\t\t\t\tlenses.push(\n\t\t\t\t\t\tnew GitAuthorsCodeLens(\n\t\t\t\t\t\t\tdocument.languageId,\n\t\t\t\t\t\t\tfileSymbol,\n\t\t\t\t\t\t\tgitUri,\n\t\t\t\t\t\t\tblameForRangeFn,\n\t\t\t\t\t\t\tblameRange,\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\tgetRangeFromSymbol(fileSymbol),\n\t\t\t\t\t\t\tcfg.authors.command,\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn lenses;\n\t}\n\n\tprivate getValidateSymbolRange(\n\t\tsymbol: SymbolInformation | DocumentSymbol,\n\t\tlanguageScope: Required<CodeLensLanguageScope>,\n\t\tdocumentRangeFn: () => Range,\n\t\tincludeSingleLineSymbols: boolean,\n\t): Range | undefined {\n\t\tlet valid = false;\n\t\tlet range: Range | undefined;\n\n\t\tconst symbolName = SymbolKind[symbol.kind].toLowerCase();\n\t\tswitch (symbol.kind) {\n\t\t\tcase SymbolKind.File:\n\t\t\t\tif (\n\t\t\t\t\tlanguageScope.scopes.includes(CodeLensScopes.Containers) ||\n\t\t\t\t\tlanguageScope.symbolScopes.includes(symbolName)\n\t\t\t\t) {\n\t\t\t\t\tvalid = !languageScope.symbolScopes.includes(`!${symbolName}`);\n\t\t\t\t}\n\n\t\t\t\tif (valid) {\n\t\t\t\t\t// Adjust the range to be for the whole file\n\t\t\t\t\trange = documentRangeFn();\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase SymbolKind.Package:\n\t\t\t\tif (\n\t\t\t\t\tlanguageScope.scopes.includes(CodeLensScopes.Containers) ||\n\t\t\t\t\tlanguageScope.symbolScopes.includes(symbolName)\n\t\t\t\t) {\n\t\t\t\t\tvalid = !languageScope.symbolScopes.includes(`!${symbolName}`);\n\t\t\t\t}\n\n\t\t\t\tif (valid) {\n\t\t\t\t\t// Adjust the range to be for the whole file\n\t\t\t\t\trange = getRangeFromSymbol(symbol);\n\t\t\t\t\tif (range.start.line === 0 && range.end.line === 0) {\n\t\t\t\t\t\trange = documentRangeFn();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase SymbolKind.Class:\n\t\t\tcase SymbolKind.Interface:\n\t\t\tcase SymbolKind.Module:\n\t\t\tcase SymbolKind.Namespace:\n\t\t\tcase SymbolKind.Struct:\n\t\t\t\tif (\n\t\t\t\t\tlanguageScope.scopes.includes(CodeLensScopes.Containers) ||\n\t\t\t\t\tlanguageScope.symbolScopes.includes(symbolName)\n\t\t\t\t) {\n\t\t\t\t\trange = getRangeFromSymbol(symbol);\n\t\t\t\t\tvalid =\n\t\t\t\t\t\t!languageScope.symbolScopes.includes(`!${symbolName}`) &&\n\t\t\t\t\t\t(includeSingleLineSymbols || !range.isSingleLine);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase SymbolKind.Constructor:\n\t\t\tcase SymbolKind.Enum:\n\t\t\tcase SymbolKind.Function:\n\t\t\tcase SymbolKind.Method:\n\t\t\tcase SymbolKind.Property:\n\t\t\t\tif (\n\t\t\t\t\tlanguageScope.scopes.includes(CodeLensScopes.Blocks) ||\n\t\t\t\t\tlanguageScope.symbolScopes.includes(symbolName)\n\t\t\t\t) {\n\t\t\t\t\trange = getRangeFromSymbol(symbol);\n\t\t\t\t\tvalid =\n\t\t\t\t\t\t!languageScope.symbolScopes.includes(`!${symbolName}`) &&\n\t\t\t\t\t\t(includeSingleLineSymbols || !range.isSingleLine);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase SymbolKind.String:\n\t\t\t\tif (\n\t\t\t\t\tlanguageScope.symbolScopes.includes(symbolName) ||\n\t\t\t\t\t// A special case for markdown files, SymbolKind.String seems to be returned for headers, so consider those containers\n\t\t\t\t\t(languageScope.language === 'markdown' && languageScope.scopes.includes(CodeLensScopes.Containers))\n\t\t\t\t) {\n\t\t\t\t\trange = getRangeFromSymbol(symbol);\n\t\t\t\t\tvalid =\n\t\t\t\t\t\t!languageScope.symbolScopes.includes(`!${symbolName}`) &&\n\t\t\t\t\t\t(includeSingleLineSymbols || !range.isSingleLine);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (languageScope.symbolScopes.includes(symbolName)) {\n\t\t\t\t\trange = getRangeFromSymbol(symbol);\n\t\t\t\t\tvalid =\n\t\t\t\t\t\t!languageScope.symbolScopes.includes(`!${symbolName}`) &&\n\t\t\t\t\t\t(includeSingleLineSymbols || !range.isSingleLine);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn valid ? range ?? getRangeFromSymbol(symbol) : undefined;\n\t}\n\n\tprivate provideCodeLens(\n\t\tlenses: CodeLens[],\n\t\tdocument: TextDocument,\n\t\tsymbol: SymbolInformation | DocumentSymbol,\n\t\tlanguageScope: Required<CodeLensLanguageScope>,\n\t\tdocumentRangeFn: () => Range,\n\t\tblame: GitBlame | undefined,\n\t\tgitUri: GitUri | undefined,\n\t\tcfg: CodeLensConfig,\n\t\tdirty: boolean,\n\t\tdirtyCommand: Command | undefined,\n\t): void {\n\t\ttry {\n\t\t\tconst blameRange = this.getValidateSymbolRange(\n\t\t\t\tsymbol,\n\t\t\t\tlanguageScope,\n\t\t\t\tdocumentRangeFn,\n\t\t\t\tcfg.includeSingleLineSymbols,\n\t\t\t);\n\t\t\tif (blameRange === undefined) return;\n\n\t\t\tconst line = document.lineAt(getRangeFromSymbol(symbol).start);\n\t\t\t// Make sure there is only 1 lens per line\n\t\t\tif (lenses.length && lenses[lenses.length - 1].range.start.line === line.lineNumber) return;\n\n\t\t\t// Anchor the CodeLens to the start of the line -- so that the range won't change with edits (otherwise the CodeLens will be removed and re-added)\n\t\t\tlet startChar = 0;\n\n\t\t\tlet blameForRangeFn: (() => GitBlameLines | undefined) | undefined;\n\t\t\tif (dirty || cfg.recentChange.enabled) {\n\t\t\t\tif (!dirty) {\n\t\t\t\t\tblameForRangeFn = once(() => this.container.git.getBlameRange(blame!, gitUri!, blameRange));\n\t\t\t\t}\n\t\t\t\tlenses.push(\n\t\t\t\t\tnew GitRecentChangeCodeLens(\n\t\t\t\t\t\tdocument.languageId,\n\t\t\t\t\t\tsymbol,\n\t\t\t\t\t\tgitUri,\n\t\t\t\t\t\tcfg.dateFormat,\n\t\t\t\t\t\tblameForRangeFn,\n\t\t\t\t\t\tblameRange,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tline.range.with(new Position(line.range.start.line, startChar)),\n\t\t\t\t\t\tcfg.recentChange.command,\n\t\t\t\t\t\tdirtyCommand,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t\tstartChar++;\n\t\t\t}\n\n\t\t\tif (cfg.authors.enabled) {\n\t\t\t\tlet multiline = !blameRange.isSingleLine;\n\t\t\t\t// HACK for Omnisharp, since it doesn't return full ranges\n\t\t\t\tif (!multiline && document.languageId === 'csharp') {\n\t\t\t\t\tswitch (symbol.kind) {\n\t\t\t\t\t\tcase SymbolKind.File:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase SymbolKind.Package:\n\t\t\t\t\t\tcase SymbolKind.Module:\n\t\t\t\t\t\tcase SymbolKind.Namespace:\n\t\t\t\t\t\tcase SymbolKind.Class:\n\t\t\t\t\t\tcase SymbolKind.Interface:\n\t\t\t\t\t\tcase SymbolKind.Constructor:\n\t\t\t\t\t\tcase SymbolKind.Method:\n\t\t\t\t\t\tcase SymbolKind.Function:\n\t\t\t\t\t\tcase SymbolKind.Enum:\n\t\t\t\t\t\t\tmultiline = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (multiline && !dirty) {\n\t\t\t\t\tif (blameForRangeFn === undefined) {\n\t\t\t\t\t\tblameForRangeFn = once(() => this.container.git.getBlameRange(blame!, gitUri!, blameRange));\n\t\t\t\t\t}\n\t\t\t\t\tlenses.push(\n\t\t\t\t\t\tnew GitAuthorsCodeLens(\n\t\t\t\t\t\t\tdocument.languageId,\n\t\t\t\t\t\t\tsymbol,\n\t\t\t\t\t\t\tgitUri,\n\t\t\t\t\t\t\tblameForRangeFn,\n\t\t\t\t\t\t\tblameRange,\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tline.range.with(new Position(line.range.start.line, startChar)),\n\t\t\t\t\t\t\tcfg.authors.command,\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tif (isDocumentSymbol(symbol)) {\n\t\t\t\tfor (const child of symbol.children) {\n\t\t\t\t\tthis.provideCodeLens(\n\t\t\t\t\t\tlenses,\n\t\t\t\t\t\tdocument,\n\t\t\t\t\t\tchild,\n\t\t\t\t\t\tlanguageScope,\n\t\t\t\t\t\tdocumentRangeFn,\n\t\t\t\t\t\tblame,\n\t\t\t\t\t\tgitUri,\n\t\t\t\t\t\tcfg,\n\t\t\t\t\t\tdirty,\n\t\t\t\t\t\tdirtyCommand,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tresolveCodeLens(lens: CodeLens, token: CancellationToken): CodeLens | Promise<CodeLens> {\n\t\tif (lens instanceof GitRecentChangeCodeLens) return this.resolveGitRecentChangeCodeLens(lens, token);\n\t\tif (lens instanceof GitAuthorsCodeLens) return this.resolveGitAuthorsCodeLens(lens, token);\n\t\treturn Promise.reject<CodeLens>(undefined);\n\t}\n\n\tprivate resolveGitRecentChangeCodeLens(lens: GitRecentChangeCodeLens, _token: CancellationToken): CodeLens {\n\t\tconst blame = lens.getBlame();\n\t\tif (blame === undefined) return lens;\n\n\t\tconst recentCommit = first(blame.commits.values());\n\t\t// TODO@eamodio This is FAR too expensive, but this accounts for commits that delete lines -- is there another way?\n\t\t// if (lens.uri != null) {\n\t\t// \tconst commit = await this.container.git.getCommitForFile(lens.uri.repoPath, lens.uri.fsPath, {\n\t\t// \t\trange: lens.blameRange,\n\t\t// \t});\n\t\t// \tif (\n\t\t// \t\tcommit != null &&\n\t\t// \t\tcommit.sha !== recentCommit.sha &&\n\t\t// \t\tcommit.date.getTime() > recentCommit.date.getTime()\n\t\t// \t) {\n\t\t// \t\trecentCommit = commit;\n\t\t// \t}\n\t\t// }\n\n\t\tlet title = `${recentCommit.author.name}, ${\n\t\t\tlens.dateFormat == null ? recentCommit.formattedDate : recentCommit.formatDate(lens.dateFormat)\n\t\t}`;\n\t\tif (this.container.config.debug) {\n\t\t\ttitle += ` [${lens.languageId}: ${SymbolKind[lens.symbol.kind]}(${lens.range.start.character}-${\n\t\t\t\tlens.range.end.character\n\t\t\t}${\n\t\t\t\t(lens.symbol as SymbolInformation).containerName\n\t\t\t\t\t? `|${(lens.symbol as SymbolInformation).containerName}`\n\t\t\t\t\t: ''\n\t\t\t}), Lines (${lens.blameRange.start.line + 1}-${lens.blameRange.end.line + 1}), Commit (${\n\t\t\t\trecentCommit.shortSha\n\t\t\t})]`;\n\t\t}\n\n\t\tif (lens.desiredCommand === false) {\n\t\t\treturn this.applyCommandWithNoClickAction(title, lens);\n\t\t}\n\n\t\tswitch (lens.desiredCommand) {\n\t\t\tcase CodeLensCommand.CopyRemoteCommitUrl:\n\t\t\t\treturn this.applyCopyOrOpenCommitOnRemoteCommand<GitRecentChangeCodeLens>(\n\t\t\t\t\ttitle,\n\t\t\t\t\tlens,\n\t\t\t\t\trecentCommit,\n\t\t\t\t\ttrue,\n\t\t\t\t);\n\t\t\tcase CodeLensCommand.CopyRemoteFileUrl:\n\t\t\t\treturn this.applyCopyOrOpenFileOnRemoteCommand<GitRecentChangeCodeLens>(\n\t\t\t\t\ttitle,\n\t\t\t\t\tlens,\n\t\t\t\t\trecentCommit,\n\t\t\t\t\ttrue,\n\t\t\t\t);\n\t\t\tcase CodeLensCommand.DiffWithPrevious:\n\t\t\t\treturn this.applyDiffWithPreviousCommand<GitRecentChangeCodeLens>(title, lens, recentCommit);\n\t\t\tcase CodeLensCommand.OpenCommitOnRemote:\n\t\t\t\treturn this.applyCopyOrOpenCommitOnRemoteCommand<GitRecentChangeCodeLens>(title, lens, recentCommit);\n\t\t\tcase CodeLensCommand.OpenFileOnRemote:\n\t\t\t\treturn this.applyCopyOrOpenFileOnRemoteCommand<GitRecentChangeCodeLens>(title, lens, recentCommit);\n\t\t\tcase CodeLensCommand.RevealCommitInView:\n\t\t\t\treturn this.applyRevealCommitInViewCommand<GitRecentChangeCodeLens>(title, lens, recentCommit);\n\t\t\tcase CodeLensCommand.ShowCommitsInView:\n\t\t\t\treturn this.applyShowCommitsInViewCommand<GitRecentChangeCodeLens>(title, lens, blame, recentCommit);\n\t\t\tcase CodeLensCommand.ShowQuickCommitDetails:\n\t\t\t\treturn this.applyShowQuickCommitDetailsCommand<GitRecentChangeCodeLens>(title, lens, recentCommit);\n\t\t\tcase CodeLensCommand.ShowQuickCommitFileDetails:\n\t\t\t\treturn this.applyShowQuickCommitFileDetailsCommand<GitRecentChangeCodeLens>(title, lens, recentCommit);\n\t\t\tcase CodeLensCommand.ShowQuickCurrentBranchHistory:\n\t\t\t\treturn this.applyShowQuickCurrentBranchHistoryCommand<GitRecentChangeCodeLens>(title, lens);\n\t\t\tcase CodeLensCommand.ShowQuickFileHistory:\n\t\t\t\treturn this.applyShowQuickFileHistoryCommand<GitRecentChangeCodeLens>(title, lens);\n\t\t\tcase CodeLensCommand.ToggleFileBlame:\n\t\t\t\treturn this.applyToggleFileBlameCommand<GitRecentChangeCodeLens>(title, lens);\n\t\t\tcase CodeLensCommand.ToggleFileChanges:\n\t\t\t\treturn this.applyToggleFileChangesCommand<GitRecentChangeCodeLens>(title, lens, recentCommit);\n\t\t\tcase CodeLensCommand.ToggleFileChangesOnly:\n\t\t\t\treturn this.applyToggleFileChangesCommand<GitRecentChangeCodeLens>(title, lens, recentCommit, true);\n\t\t\tcase CodeLensCommand.ToggleFileHeatmap:\n\t\t\t\treturn this.applyToggleFileHeatmapCommand<GitRecentChangeCodeLens>(title, lens);\n\t\t\tdefault:\n\t\t\t\treturn lens;\n\t\t}\n\t}\n\n\tprivate resolveGitAuthorsCodeLens(lens: GitAuthorsCodeLens, _token: CancellationToken): CodeLens {\n\t\tconst blame = lens.getBlame();\n\t\tif (blame === undefined) return lens;\n\n\t\tconst count = blame.authors.size;\n\n\t\tconst author = first(blame.authors.values()).name;\n\n\t\tlet title = `${count} ${count > 1 ? 'authors' : 'author'} (${author}${count > 1 ? ' and others' : ''})`;\n\t\tif (this.container.config.debug) {\n\t\t\ttitle += ` [${lens.languageId}: ${SymbolKind[lens.symbol.kind]}(${lens.range.start.character}-${\n\t\t\t\tlens.range.end.character\n\t\t\t}${\n\t\t\t\t(lens.symbol as SymbolInformation).containerName\n\t\t\t\t\t? `|${(lens.symbol as SymbolInformation).containerName}`\n\t\t\t\t\t: ''\n\t\t\t}), Lines (${lens.blameRange.start.line + 1}-${lens.blameRange.end.line + 1}), Authors (${join(\n\t\t\t\tmap(blame.authors.values(), a => a.name),\n\t\t\t\t', ',\n\t\t\t)})]`;\n\t\t}\n\n\t\tif (lens.desiredCommand === false) {\n\t\t\treturn this.applyCommandWithNoClickAction(title, lens);\n\t\t}\n\n\t\tconst commit = find(blame.commits.values(), c => c.author.name === author) ?? first(blame.commits.values());\n\n\t\tswitch (lens.desiredCommand) {\n\t\t\tcase CodeLensCommand.CopyRemoteCommitUrl:\n\t\t\t\treturn this.applyCopyOrOpenCommitOnRemoteCommand<GitAuthorsCodeLens>(title, lens, commit, true);\n\t\t\tcase CodeLensCommand.CopyRemoteFileUrl:\n\t\t\t\treturn this.applyCopyOrOpenFileOnRemoteCommand<GitAuthorsCodeLens>(title, lens, commit, true);\n\t\t\tcase CodeLensCommand.DiffWithPrevious:\n\t\t\t\treturn this.applyDiffWithPreviousCommand<GitAuthorsCodeLens>(title, lens, commit);\n\t\t\tcase CodeLensCommand.OpenCommitOnRemote:\n\t\t\t\treturn this.applyCopyOrOpenCommitOnRemoteCommand<GitAuthorsCodeLens>(title, lens, commit);\n\t\t\tcase CodeLensCommand.OpenFileOnRemote:\n\t\t\t\treturn this.applyCopyOrOpenFileOnRemoteCommand<GitAuthorsCodeLens>(title, lens, commit);\n\t\t\tcase CodeLensCommand.RevealCommitInView:\n\t\t\t\treturn this.applyRevealCommitInViewCommand<GitAuthorsCodeLens>(title, lens, commit);\n\t\t\tcase CodeLensCommand.ShowCommitsInView:\n\t\t\t\treturn this.applyShowCommitsInViewCommand<GitAuthorsCodeLens>(title, lens, blame);\n\t\t\tcase CodeLensCommand.ShowQuickCommitDetails:\n\t\t\t\treturn this.applyShowQuickCommitDetailsCommand<GitAuthorsCodeLens>(title, lens, commit);\n\t\t\tcase CodeLensCommand.ShowQuickCommitFileDetails:\n\t\t\t\treturn this.applyShowQuickCommitFileDetailsCommand<GitAuthorsCodeLens>(title, lens, commit);\n\t\t\tcase CodeLensCommand.ShowQuickCurrentBranchHistory:\n\t\t\t\treturn this.applyShowQuickCurrentBranchHistoryCommand<GitAuthorsCodeLens>(title, lens);\n\t\t\tcase CodeLensCommand.ShowQuickFileHistory:\n\t\t\t\treturn this.applyShowQuickFileHistoryCommand<GitAuthorsCodeLens>(title, lens);\n\t\t\tcase CodeLensCommand.ToggleFileBlame:\n\t\t\t\treturn this.applyToggleFileBlameCommand<GitAuthorsCodeLens>(title, lens);\n\t\t\tcase CodeLensCommand.ToggleFileChanges:\n\t\t\t\treturn this.applyToggleFileChangesCommand<GitAuthorsCodeLens>(title, lens, commit);\n\t\t\tcase CodeLensCommand.ToggleFileChangesOnly:\n\t\t\t\treturn this.applyToggleFileChangesCommand<GitAuthorsCodeLens>(title, lens, commit, true);\n\t\t\tcase CodeLensCommand.ToggleFileHeatmap:\n\t\t\t\treturn this.applyToggleFileHeatmapCommand<GitAuthorsCodeLens>(title, lens);\n\t\t\tdefault:\n\t\t\t\treturn lens;\n\t\t}\n\t}\n\n\tprivate applyDiffWithPreviousCommand<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t\tcommit: GitCommit | undefined,\n\t): T {\n\t\tlens.command = asCommand<[undefined, DiffWithPreviousCommandArgs]>({\n\t\t\ttitle: title,\n\t\t\tcommand: Commands.DiffWithPrevious,\n\t\t\targuments: [\n\t\t\t\tundefined,\n\t\t\t\t{\n\t\t\t\t\tcommit: commit,\n\t\t\t\t\turi: lens.uri!.toFileUri(),\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\treturn lens;\n\t}\n\n\tprivate applyCopyOrOpenCommitOnRemoteCommand<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t\tcommit: GitCommit,\n\t\tclipboard: boolean = false,\n\t): T {\n\t\tlens.command = asCommand<[OpenOnRemoteCommandArgs]>({\n\t\t\ttitle: title,\n\t\t\tcommand: Commands.OpenOnRemote,\n\t\t\targuments: [\n\t\t\t\t{\n\t\t\t\t\tresource: {\n\t\t\t\t\t\ttype: RemoteResourceType.Commit,\n\t\t\t\t\t\tsha: commit.sha,\n\t\t\t\t\t},\n\t\t\t\t\trepoPath: commit.repoPath,\n\t\t\t\t\tclipboard: clipboard,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\treturn lens;\n\t}\n\n\tprivate applyCopyOrOpenFileOnRemoteCommand<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t\tcommit: GitCommit,\n\t\tclipboard: boolean = false,\n\t): T {\n\t\tlens.command = asCommand<[OpenOnRemoteCommandArgs]>({\n\t\t\ttitle: title,\n\t\t\tcommand: Commands.OpenOnRemote,\n\t\t\targuments: [\n\t\t\t\t{\n\t\t\t\t\tresource: {\n\t\t\t\t\t\ttype: RemoteResourceType.Revision,\n\t\t\t\t\t\tfileName: commit.file?.path ?? '',\n\t\t\t\t\t\tsha: commit.sha,\n\t\t\t\t\t},\n\t\t\t\t\trepoPath: commit.repoPath,\n\t\t\t\t\tclipboard: clipboard,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\treturn lens;\n\t}\n\n\tprivate applyRevealCommitInViewCommand<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t\tcommit: GitCommit | undefined,\n\t): T {\n\t\tlens.command = asCommand<[Uri, ShowQuickCommitCommandArgs]>({\n\t\t\ttitle: title,\n\t\t\tcommand: commit?.isUncommitted ? '' : CodeLensCommand.RevealCommitInView,\n\t\t\targuments: [\n\t\t\t\tlens.uri!.toFileUri(),\n\t\t\t\t{\n\t\t\t\t\tcommit: commit,\n\t\t\t\t\tsha: commit === undefined ? undefined : commit.sha,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\treturn lens;\n\t}\n\n\tprivate applyShowCommitsInViewCommand<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t\tblame: GitBlameLines,\n\t\tcommit?: GitCommit,\n\t): T {\n\t\tlet refs;\n\t\tif (commit === undefined) {\n\t\t\trefs = [...filterMap(blame.commits.values(), c => (c.isUncommitted ? undefined : c.ref))];\n\t\t} else {\n\t\t\trefs = [commit.ref];\n\t\t}\n\n\t\tlens.command = asCommand<[ShowCommitsInViewCommandArgs]>({\n\t\t\ttitle: title,\n\t\t\tcommand: refs.length === 0 ? '' : Commands.ShowCommitsInView,\n\t\t\targuments: [\n\t\t\t\t{\n\t\t\t\t\trepoPath: blame.repoPath,\n\t\t\t\t\trefs: refs,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\treturn lens;\n\t}\n\n\tprivate applyShowQuickCommitDetailsCommand<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t\tcommit: GitCommit | undefined,\n\t): T {\n\t\tlens.command = asCommand<[Uri, ShowQuickCommitCommandArgs]>({\n\t\t\ttitle: title,\n\t\t\tcommand: commit?.isUncommitted ? '' : CodeLensCommand.ShowQuickCommitDetails,\n\t\t\targuments: [\n\t\t\t\tlens.uri!.toFileUri(),\n\t\t\t\t{\n\t\t\t\t\tcommit: commit,\n\t\t\t\t\tsha: commit === undefined ? undefined : commit.sha,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\treturn lens;\n\t}\n\n\tprivate applyShowQuickCommitFileDetailsCommand<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t\tcommit: GitCommit | undefined,\n\t): T {\n\t\tlens.command = asCommand<[Uri, ShowQuickCommitFileCommandArgs]>({\n\t\t\ttitle: title,\n\t\t\tcommand: commit?.isUncommitted ? '' : CodeLensCommand.ShowQuickCommitFileDetails,\n\t\t\targuments: [\n\t\t\t\tlens.uri!.toFileUri(),\n\t\t\t\t{\n\t\t\t\t\tcommit: commit,\n\t\t\t\t\tsha: commit === undefined ? undefined : commit.sha,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\treturn lens;\n\t}\n\n\tprivate applyShowQuickCurrentBranchHistoryCommand<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t): T {\n\t\tlens.command = asCommand<[Uri]>({\n\t\t\ttitle: title,\n\t\t\tcommand: CodeLensCommand.ShowQuickCurrentBranchHistory,\n\t\t\targuments: [lens.uri!.toFileUri()],\n\t\t});\n\t\treturn lens;\n\t}\n\n\tprivate applyShowQuickFileHistoryCommand<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t): T {\n\t\tlens.command = asCommand<[Uri, ShowQuickFileHistoryCommandArgs]>({\n\t\t\ttitle: title,\n\t\t\tcommand: CodeLensCommand.ShowQuickFileHistory,\n\t\t\targuments: [\n\t\t\t\tlens.uri!.toFileUri(),\n\t\t\t\t{\n\t\t\t\t\trange: lens.isFullRange ? undefined : lens.blameRange,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\treturn lens;\n\t}\n\n\tprivate applyToggleFileBlameCommand<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t): T {\n\t\tlens.command = asCommand<[Uri]>({\n\t\t\ttitle: title,\n\t\t\tcommand: Commands.ToggleFileBlame,\n\t\t\targuments: [lens.uri!.toFileUri()],\n\t\t});\n\t\treturn lens;\n\t}\n\n\tprivate applyToggleFileChangesCommand<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t\tcommit: GitCommit,\n\t\tonly?: boolean,\n\t): T {\n\t\tlens.command = asCommand<[Uri, ToggleFileChangesAnnotationCommandArgs]>({\n\t\t\ttitle: title,\n\t\t\tcommand: Commands.ToggleFileChanges,\n\t\t\targuments: [\n\t\t\t\tlens.uri!.toFileUri(),\n\t\t\t\t{\n\t\t\t\t\ttype: FileAnnotationType.Changes,\n\t\t\t\t\tcontext: { sha: commit.sha, only: only, selection: false },\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\treturn lens;\n\t}\n\n\tprivate applyToggleFileHeatmapCommand<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t): T {\n\t\tlens.command = asCommand<[Uri]>({\n\t\t\ttitle: title,\n\t\t\tcommand: Commands.ToggleFileHeatmap,\n\t\t\targuments: [lens.uri!.toFileUri()],\n\t\t});\n\t\treturn lens;\n\t}\n\n\tprivate applyCommandWithNoClickAction<T extends GitRecentChangeCodeLens | GitAuthorsCodeLens>(\n\t\ttitle: string,\n\t\tlens: T,\n\t): T {\n\t\tlens.command = {\n\t\t\ttitle: title,\n\t\t\tcommand: '',\n\t\t};\n\t\treturn lens;\n\t}\n\n\tprivate getDirtyTitle(cfg: CodeLensConfig) {\n\t\tif (cfg.recentChange.enabled && cfg.authors.enabled) {\n\t\t\treturn this.container.config.strings.codeLens.unsavedChanges.recentChangeAndAuthors;\n\t\t}\n\t\tif (cfg.recentChange.enabled) return this.container.config.strings.codeLens.unsavedChanges.recentChangeOnly;\n\t\treturn this.container.config.strings.codeLens.unsavedChanges.authorsOnly;\n\t}\n}\n\nfunction getRangeFromSymbol(symbol: DocumentSymbol | SymbolInformation) {\n\treturn isDocumentSymbol(symbol) ? symbol.range : symbol.location.range;\n}\n\nfunction isDocumentSymbol(symbol: DocumentSymbol | SymbolInformation): symbol is DocumentSymbol {\n\treturn is<DocumentSymbol>(symbol, 'children');\n}\n","import { ConfigurationChangeEvent, Disposable, languages } from 'vscode';\nimport { configuration } from '../configuration';\nimport { ContextKeys } from '../constants';\nimport { Container } from '../container';\nimport { setContext } from '../context';\nimport { Logger } from '../logger';\nimport { once } from '../system/event';\nimport {\n\tDocumentBlameStateChangeEvent,\n\tDocumentDirtyIdleTriggerEvent,\n\tGitDocumentState,\n} from '../trackers/gitDocumentTracker';\nimport { GitCodeLensProvider } from './codeLensProvider';\n\nexport class GitCodeLensController implements Disposable {\n\tprivate _canToggle: boolean = false;\n\tprivate _disposable: Disposable | undefined;\n\tprivate _provider: GitCodeLensProvider | undefined;\n\tprivate _providerDisposable: Disposable | undefined;\n\n\tconstructor(private readonly container: Container) {\n\t\tthis._disposable = Disposable.from(\n\t\t\tonce(container.onReady)(this.onReady, this),\n\t\t\tconfiguration.onDidChange(this.onConfigurationChanged, this),\n\t\t);\n\t}\n\n\tdispose() {\n\t\tthis._providerDisposable?.dispose();\n\t\tthis._disposable?.dispose();\n\t}\n\n\tprivate onReady(): void {\n\t\tthis.onConfigurationChanged();\n\t}\n\n\tprivate onConfigurationChanged(e?: ConfigurationChangeEvent) {\n\t\tif (\n\t\t\tconfiguration.changed(e, 'codeLens') ||\n\t\t\tconfiguration.changed(e, 'defaultDateFormat') ||\n\t\t\tconfiguration.changed(e, 'defaultDateSource') ||\n\t\t\tconfiguration.changed(e, 'defaultDateStyle')\n\t\t) {\n\t\t\tif (e != null) {\n\t\t\t\tLogger.log('CodeLens config changed; resetting CodeLens provider');\n\t\t\t}\n\n\t\t\tconst cfg = this.container.config.codeLens;\n\t\t\tif (cfg.enabled && (cfg.recentChange.enabled || cfg.authors.enabled)) {\n\t\t\t\tthis.ensureProvider();\n\t\t\t} else {\n\t\t\t\tthis._providerDisposable?.dispose();\n\t\t\t\tthis._provider = undefined;\n\t\t\t}\n\n\t\t\tthis._canToggle = cfg.recentChange.enabled || cfg.authors.enabled;\n\t\t\tvoid setContext(ContextKeys.DisabledToggleCodeLens, !this._canToggle);\n\t\t}\n\t}\n\n\tprivate onBlameStateChanged(e: DocumentBlameStateChangeEvent<GitDocumentState>) {\n\t\t// Only reset if we have saved, since the CodeLens won't naturally be re-rendered\n\t\tif (this._provider === undefined || !e.blameable) return;\n\n\t\tLogger.log('Blame state changed; resetting CodeLens provider');\n\t\tthis._provider.reset('saved');\n\t}\n\n\tprivate onDirtyIdleTriggered(e: DocumentDirtyIdleTriggerEvent<GitDocumentState>) {\n\t\tif (this._provider === undefined || !e.document.isBlameable) return;\n\n\t\tconst maxLines = this.container.config.advanced.blame.sizeThresholdAfterEdit;\n\t\tif (maxLines > 0 && e.document.lineCount > maxLines) return;\n\n\t\tLogger.log('Dirty idle triggered; resetting CodeLens provider');\n\t\tthis._provider.reset('idle');\n\t}\n\n\ttoggleCodeLens() {\n\t\tif (!this._canToggle) return;\n\n\t\tLogger.log('toggleCodeLens()');\n\t\tif (this._provider !== undefined) {\n\t\t\tthis._providerDisposable?.dispose();\n\t\t\tthis._provider = undefined;\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ensureProvider();\n\t}\n\n\tprivate ensureProvider() {\n\t\tif (this._provider !== undefined) {\n\t\t\tthis._provider.reset();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._providerDisposable?.dispose();\n\n\t\tthis._provider = new GitCodeLensProvider(this.container);\n\t\tthis._providerDisposable = Disposable.from(\n\t\t\tlanguages.registerCodeLensProvider(GitCodeLensProvider.selector, this._provider),\n\t\t\tthis.container.tracker.onDidChangeBlameState(this.onBlameStateChanged, this),\n\t\t\tthis.container.tracker.onDidTriggerDirtyIdle(this.onDirtyIdleTriggered, this),\n\t\t);\n\t}\n}\n","/* eslint-disable @typescript-eslint/strict-boolean-expressions */\nimport { CharCode } from '../constants';\nimport { count, map, some } from './iterable';\nimport { compareSubstring, compareSubstringIgnoreCase } from './string';\n\nconst FIN = { done: true, value: undefined };\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface IKeyIterator<K> {\n\treset(key: K): this;\n\tnext(): this;\n\n\thasNext(): boolean;\n\tcmp(a: string): number;\n\tvalue(): string;\n}\n\nexport class StringIterator implements IKeyIterator<string> {\n\tprivate _value: string = '';\n\tprivate _pos: number = 0;\n\n\treset(key: string): this {\n\t\tthis._value = key;\n\t\tthis._pos = 0;\n\t\treturn this;\n\t}\n\n\tnext(): this {\n\t\tthis._pos += 1;\n\t\treturn this;\n\t}\n\n\thasNext(): boolean {\n\t\treturn this._pos < this._value.length - 1;\n\t}\n\n\tcmp(a: string): number {\n\t\tconst aCode = a.charCodeAt(0);\n\t\tconst thisCode = this._value.charCodeAt(this._pos);\n\t\treturn aCode - thisCode;\n\t}\n\n\tvalue(): string {\n\t\treturn this._value[this._pos];\n\t}\n}\n\nexport class PathIterator implements IKeyIterator<string> {\n\tprivate _value!: string;\n\tprivate _from!: number;\n\tprivate _to!: number;\n\n\tconstructor(private readonly _splitOnBackslash: boolean = true, private readonly _caseSensitive: boolean = true) {}\n\n\treset(key: string): this {\n\t\tthis._value = key.replace(/\\\\$|\\/$/, '');\n\t\tthis._from = 0;\n\t\tthis._to = 0;\n\t\treturn this.next();\n\t}\n\n\thasNext(): boolean {\n\t\treturn this._to < this._value.length;\n\t}\n\n\tnext(): this {\n\t\t// this._data = key.split(/[\\\\/]/).filter(s => !!s);\n\t\tthis._from = this._to;\n\t\tlet justSeps = true;\n\t\tfor (; this._to < this._value.length; this._to++) {\n\t\t\tconst ch = this._value.charCodeAt(this._to);\n\t\t\tif (ch === CharCode.Slash || (this._splitOnBackslash && ch === CharCode.Backslash)) {\n\t\t\t\tif (justSeps) {\n\t\t\t\t\tthis._from++;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tjustSeps = false;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tcmp(a: string): number {\n\t\treturn this._caseSensitive\n\t\t\t? compareSubstring(a, this._value, 0, a.length, this._from, this._to)\n\t\t\t: compareSubstringIgnoreCase(a, this._value, 0, a.length, this._from, this._to);\n\t}\n\n\tvalue(): string {\n\t\treturn this._value.substring(this._from, this._to);\n\t}\n}\n\nclass TernarySearchTreeNode<K, V> {\n\tsegment!: string;\n\tvalue: V | undefined;\n\tkey!: K;\n\tleft: TernarySearchTreeNode<K, V> | undefined;\n\tmid: TernarySearchTreeNode<K, V> | undefined;\n\tright: TernarySearchTreeNode<K, V> | undefined;\n\n\tisEmpty(): boolean {\n\t\treturn !this.left && !this.mid && !this.right && !this.value;\n\t}\n}\n\nexport class TernarySearchTree<K, V> {\n\tstatic forPaths<E>(): TernarySearchTree<string, E> {\n\t\treturn new TernarySearchTree<string, E>(new PathIterator());\n\t}\n\n\tstatic forStrings<E>(): TernarySearchTree<string, E> {\n\t\treturn new TernarySearchTree<string, E>(new StringIterator());\n\t}\n\n\tprivate _iter: IKeyIterator<K>;\n\tprivate _root: TernarySearchTreeNode<K, V> | undefined;\n\n\tconstructor(segments: IKeyIterator<K>) {\n\t\tthis._iter = segments;\n\t}\n\n\tclear(): void {\n\t\tthis._root = undefined;\n\t}\n\n\tset(key: K, element: V): V | undefined {\n\t\tconst iter = this._iter.reset(key);\n\t\tlet node: TernarySearchTreeNode<K, V>;\n\n\t\tif (!this._root) {\n\t\t\tthis._root = new TernarySearchTreeNode<K, V>();\n\t\t\tthis._root.segment = iter.value();\n\t\t}\n\n\t\tnode = this._root;\n\t\twhile (true) {\n\t\t\tconst val = iter.cmp(node.segment);\n\t\t\tif (val > 0) {\n\t\t\t\t// left\n\t\t\t\tif (!node.left) {\n\t\t\t\t\tnode.left = new TernarySearchTreeNode<K, V>();\n\t\t\t\t\tnode.left.segment = iter.value();\n\t\t\t\t}\n\t\t\t\tnode = node.left;\n\t\t\t} else if (val < 0) {\n\t\t\t\t// right\n\t\t\t\tif (!node.right) {\n\t\t\t\t\tnode.right = new TernarySearchTreeNode<K, V>();\n\t\t\t\t\tnode.right.segment = iter.value();\n\t\t\t\t}\n\t\t\t\tnode = node.right;\n\t\t\t} else if (iter.hasNext()) {\n\t\t\t\t// mid\n\t\t\t\titer.next();\n\t\t\t\tif (!node.mid) {\n\t\t\t\t\tnode.mid = new TernarySearchTreeNode<K, V>();\n\t\t\t\t\tnode.mid.segment = iter.value();\n\t\t\t\t}\n\t\t\t\tnode = node.mid;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tconst oldElement = node.value;\n\t\tnode.value = element;\n\t\tnode.key = key;\n\t\treturn oldElement;\n\t}\n\n\tget(key: K): V | undefined {\n\t\treturn this._getNode(key)?.value;\n\t}\n\n\tprivate _getNode(key: K) {\n\t\tconst iter = this._iter.reset(key);\n\t\tlet node = this._root;\n\t\twhile (node) {\n\t\t\tconst val = iter.cmp(node.segment);\n\t\t\tif (val > 0) {\n\t\t\t\t// left\n\t\t\t\tnode = node.left;\n\t\t\t} else if (val < 0) {\n\t\t\t\t// right\n\t\t\t\tnode = node.right;\n\t\t\t} else if (iter.hasNext()) {\n\t\t\t\t// mid\n\t\t\t\titer.next();\n\t\t\t\tnode = node.mid;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn node;\n\t}\n\n\thas(key: K): boolean {\n\t\tconst node = this._getNode(key);\n\t\treturn !(node?.value === undefined && node?.mid === undefined);\n\t}\n\n\tdelete(key: K): void {\n\t\treturn this._delete(key, false);\n\t}\n\n\tdeleteSuperstr(key: K): void {\n\t\treturn this._delete(key, true);\n\t}\n\n\tprivate _delete(key: K, superStr: boolean): void {\n\t\tconst iter = this._iter.reset(key);\n\t\tconst stack: [-1 | 0 | 1, TernarySearchTreeNode<K, V>][] = [];\n\t\tlet node = this._root;\n\n\t\t// find and unset node\n\t\twhile (node) {\n\t\t\tconst val = iter.cmp(node.segment);\n\t\t\tif (val > 0) {\n\t\t\t\t// left\n\t\t\t\tstack.push([1, node]);\n\t\t\t\tnode = node.left;\n\t\t\t} else if (val < 0) {\n\t\t\t\t// right\n\t\t\t\tstack.push([-1, node]);\n\t\t\t\tnode = node.right;\n\t\t\t} else if (iter.hasNext()) {\n\t\t\t\t// mid\n\t\t\t\titer.next();\n\t\t\t\tstack.push([0, node]);\n\t\t\t\tnode = node.mid;\n\t\t\t} else {\n\t\t\t\tif (superStr) {\n\t\t\t\t\t// remove children\n\t\t\t\t\tnode.left = undefined;\n\t\t\t\t\tnode.mid = undefined;\n\t\t\t\t\tnode.right = undefined;\n\t\t\t\t} else {\n\t\t\t\t\t// remove element\n\t\t\t\t\tnode.value = undefined;\n\t\t\t\t}\n\n\t\t\t\t// clean up empty nodes\n\t\t\t\twhile (stack.length > 0 && node.isEmpty()) {\n\t\t\t\t\tconst [dir, parent] = stack.pop()!;\n\t\t\t\t\tswitch (dir) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tparent.left = undefined;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\tparent.mid = undefined;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase -1:\n\t\t\t\t\t\t\tparent.right = undefined;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tnode = parent;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tfindSubstr(key: K): V | undefined {\n\t\tconst iter = this._iter.reset(key);\n\t\tlet node = this._root;\n\t\tlet candidate: V | undefined;\n\t\twhile (node) {\n\t\t\tconst val = iter.cmp(node.segment);\n\t\t\tif (val > 0) {\n\t\t\t\t// left\n\t\t\t\tnode = node.left;\n\t\t\t} else if (val < 0) {\n\t\t\t\t// right\n\t\t\t\tnode = node.right;\n\t\t\t} else if (iter.hasNext()) {\n\t\t\t\t// mid\n\t\t\t\titer.next();\n\t\t\t\tcandidate = node.value || candidate;\n\t\t\t\tnode = node.mid;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn node?.value || candidate;\n\t}\n\n\tfindSuperstr(key: K, limit: boolean = false): Iterable<V> | undefined {\n\t\tconst iter = this._iter.reset(key);\n\t\tlet node = this._root;\n\t\twhile (node) {\n\t\t\tconst val = iter.cmp(node.segment);\n\t\t\tif (val > 0) {\n\t\t\t\t// left\n\t\t\t\tnode = node.left;\n\t\t\t} else if (val < 0) {\n\t\t\t\t// right\n\t\t\t\tnode = node.right;\n\t\t\t} else if (iter.hasNext()) {\n\t\t\t\t// mid\n\t\t\t\titer.next();\n\t\t\t\tnode = node.mid;\n\t\t\t} else {\n\t\t\t\t// collect\n\t\t\t\tif (!node.mid) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tnode = node.mid;\n\t\t\t\treturn {\n\t\t\t\t\t// eslint-disable-next-line no-loop-func\n\t\t\t\t\t[Symbol.iterator]: () => this._nodeIterator(node!, limit),\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate _nodeIterator(node: TernarySearchTreeNode<K, V>, limit: boolean = false): Iterator<V> {\n\t\tlet res: { done: false; value: V };\n\t\tlet idx: number;\n\t\tlet data: V[];\n\t\tconst next = (): IteratorResult<V> => {\n\t\t\tif (!data) {\n\t\t\t\t// lazy till first invocation\n\t\t\t\tdata = [];\n\t\t\t\tidx = 0;\n\t\t\t\tthis._forEach(node, value => data.push(value), limit);\n\t\t\t}\n\t\t\tif (idx >= data.length) {\n\t\t\t\treturn FIN as unknown as IteratorResult<V>;\n\t\t\t}\n\n\t\t\tif (!res) {\n\t\t\t\tres = { done: false, value: data[idx++] };\n\t\t\t} else {\n\t\t\t\tres.value = data[idx++];\n\t\t\t}\n\t\t\treturn res;\n\t\t};\n\t\treturn { next: next };\n\t}\n\n\tforEach(callback: (value: V, index: K) => any) {\n\t\tthis._forEach(this._root, callback);\n\t}\n\n\tprivate _forEach(\n\t\tnode: TernarySearchTreeNode<K, V> | undefined,\n\t\tcallback: (value: V, index: K) => any,\n\t\tlimit: boolean = false,\n\t) {\n\t\tif (node === undefined) return;\n\n\t\t// left\n\t\tthis._forEach(node.left, callback, limit);\n\n\t\t// node\n\t\tif (node.value) {\n\t\t\tcallback(node.value, node.key);\n\t\t}\n\n\t\tif (!limit) {\n\t\t\t// mid\n\t\t\tthis._forEach(node.mid, callback, limit);\n\t\t}\n\n\t\t// right\n\t\tthis._forEach(node.right, callback, limit);\n\t}\n\n\tany(): boolean {\n\t\treturn this._root !== undefined && !this._root.isEmpty();\n\t}\n\n\tcount(predicate?: (entry: V) => boolean): number {\n\t\tif (this._root === undefined || this._root.isEmpty()) return 0;\n\n\t\treturn count(this.entries(), predicate === undefined ? undefined : ([, e]) => predicate(e));\n\t}\n\n\tentries(): Iterable<[K, V]> {\n\t\treturn this._iterator(this._root);\n\t}\n\n\tvalues(): Iterable<V> {\n\t\treturn map(this.entries(), ([, e]) => e);\n\t}\n\n\thighlander(): [K, V] | undefined {\n\t\tif (this._root === undefined || this._root.isEmpty()) return undefined;\n\n\t\tconst entries = this.entries() as IterableIterator<[K, V]>;\n\n\t\tlet count = 0;\n\t\tlet next: IteratorResult<[K, V]>;\n\t\tlet value: [K, V] | undefined;\n\n\t\twhile (true) {\n\t\t\tnext = entries.next();\n\t\t\tif (next.done) break;\n\n\t\t\tvalue = next.value;\n\n\t\t\tcount++;\n\t\t\tif (count > 1) return undefined;\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tsome(predicate: (entry: V) => boolean): boolean {\n\t\tif (this._root === undefined || this._root.isEmpty()) return false;\n\n\t\treturn some(this.entries(), ([, e]) => predicate(e));\n\t}\n\n\t*[Symbol.iterator](): IterableIterator<[K, V]> {\n\t\tyield* this._iterator(this._root);\n\t}\n\n\tprivate *_iterator(node: TernarySearchTreeNode<K, V> | undefined): IterableIterator<[K, V]> {\n\t\tif (node) {\n\t\t\t// left\n\t\t\tyield* this._iterator(node.left);\n\n\t\t\t// node\n\t\t\tif (node.value) {\n\t\t\t\tyield [node.key, node.value];\n\t\t\t}\n\n\t\t\t// mid\n\t\t\tyield* this._iterator(node.mid);\n\n\t\t\t// right\n\t\t\tyield* this._iterator(node.right);\n\t\t}\n\t}\n}\n","import {\n\tDisposable,\n\tEvent,\n\tEventEmitter,\n\tFileChangeEvent,\n\tFileStat,\n\tFileSystemError,\n\tFileSystemProvider,\n\tFileType,\n\tUri,\n\tworkspace,\n} from 'vscode';\nimport { isLinux } from '@env/platform';\nimport { Schemes } from '../constants';\nimport { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { debug } from '../system/decorators/log';\nimport { map } from '../system/iterable';\nimport { normalizePath, relative } from '../system/path';\nimport { TernarySearchTree } from '../system/searchTree';\nimport { GitRevision, GitTreeEntry } from './models';\n\nconst emptyArray = new Uint8Array(0);\n\nexport function fromGitLensFSUri(uri: Uri): { path: string; ref: string; repoPath: string } {\n\tconst gitUri = GitUri.is(uri) ? uri : GitUri.fromRevisionUri(uri);\n\treturn { path: gitUri.relativePath, ref: gitUri.sha!, repoPath: gitUri.repoPath! };\n}\n\nexport class GitFileSystemProvider implements FileSystemProvider, Disposable {\n\tprivate readonly _disposable: Disposable;\n\tprivate readonly _searchTreeMap = new Map<string, Promise<TernarySearchTree<string, GitTreeEntry>>>();\n\n\tconstructor(private readonly container: Container) {\n\t\tthis._disposable = Disposable.from(\n\t\t\tworkspace.registerFileSystemProvider(Schemes.GitLens, this, {\n\t\t\t\tisCaseSensitive: isLinux,\n\t\t\t\tisReadonly: true,\n\t\t\t}),\n\t\t);\n\t}\n\n\tdispose() {\n\t\tthis._disposable.dispose();\n\t}\n\n\tprivate _onDidChangeFile = new EventEmitter<FileChangeEvent[]>();\n\tget onDidChangeFile(): Event<FileChangeEvent[]> {\n\t\treturn this._onDidChangeFile.event;\n\t}\n\n\tcopy?(): void | Thenable<void> {\n\t\tthrow FileSystemError.NoPermissions;\n\t}\n\tcreateDirectory(): void | Thenable<void> {\n\t\tthrow FileSystemError.NoPermissions;\n\t}\n\tdelete(): void | Thenable<void> {\n\t\tthrow FileSystemError.NoPermissions;\n\t}\n\n\t@debug()\n\tasync readDirectory(uri: Uri): Promise<[string, FileType][]> {\n\t\tconst { path, ref, repoPath } = fromGitLensFSUri(uri);\n\n\t\tconst tree = await this.getTree(path, ref, repoPath);\n\t\tif (tree === undefined) throw FileSystemError.FileNotFound(uri);\n\n\t\tconst items = [\n\t\t\t...map<GitTreeEntry, [string, FileType]>(tree, t => [\n\t\t\t\tpath != null && path.length !== 0 ? normalizePath(relative(path, t.path)) : t.path,\n\t\t\t\ttypeToFileType(t.type),\n\t\t\t]),\n\t\t];\n\t\treturn items;\n\t}\n\n\t@debug()\n\tasync readFile(uri: Uri): Promise<Uint8Array> {\n\t\tconst { path, ref, repoPath } = fromGitLensFSUri(uri);\n\n\t\tif (ref === GitRevision.deletedOrMissing) return emptyArray;\n\n\t\tconst data = await this.container.git.getRevisionContent(repoPath, path, ref);\n\t\treturn data != null ? data : emptyArray;\n\t}\n\n\trename(): void | Thenable<void> {\n\t\tthrow FileSystemError.NoPermissions;\n\t}\n\n\t@debug()\n\tasync stat(uri: Uri): Promise<FileStat> {\n\t\tconst { path, ref, repoPath } = fromGitLensFSUri(uri);\n\n\t\tif (ref === GitRevision.deletedOrMissing) {\n\t\t\treturn {\n\t\t\t\ttype: FileType.File,\n\t\t\t\tsize: 0,\n\t\t\t\tctime: 0,\n\t\t\t\tmtime: 0,\n\t\t\t};\n\t\t}\n\n\t\tlet treeItem;\n\n\t\tconst searchTree = this._searchTreeMap.get(ref);\n\t\tif (searchTree !== undefined) {\n\t\t\t// Add the fake root folder to the path\n\t\t\ttreeItem = (await searchTree).get(`/~/${path}`);\n\t\t} else {\n\t\t\tif (path == null || path.length === 0) {\n\t\t\t\tconst tree = await this.getTree(path, ref, repoPath);\n\t\t\t\tif (tree === undefined) throw FileSystemError.FileNotFound(uri);\n\n\t\t\t\treturn {\n\t\t\t\t\ttype: FileType.Directory,\n\t\t\t\t\tsize: 0,\n\t\t\t\t\tctime: 0,\n\t\t\t\t\tmtime: 0,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttreeItem = await this.container.git.getTreeEntryForRevision(repoPath, path, ref);\n\t\t}\n\n\t\tif (treeItem === undefined) {\n\t\t\tthrow FileSystemError.FileNotFound(uri);\n\t\t}\n\n\t\treturn {\n\t\t\ttype: typeToFileType(treeItem.type),\n\t\t\tsize: treeItem.size,\n\t\t\tctime: 0,\n\t\t\tmtime: 0,\n\t\t};\n\t}\n\n\twatch(): Disposable {\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\t// nothing to dispose\n\t\t\t},\n\t\t};\n\t}\n\n\twriteFile(): void | Thenable<void> {\n\t\tthrow FileSystemError.NoPermissions;\n\t}\n\n\tprivate async createSearchTree(ref: string, repoPath: string) {\n\t\tconst searchTree = TernarySearchTree.forPaths<GitTreeEntry>();\n\t\tconst trees = await this.container.git.getTreeForRevision(repoPath, ref);\n\n\t\t// Add a fake root folder so that searches will work\n\t\tsearchTree.set('~', { commitSha: '', path: '~', size: 0, type: 'tree' });\n\t\tfor (const item of trees) {\n\t\t\tsearchTree.set(`~/${item.path}`, item);\n\t\t}\n\n\t\treturn searchTree;\n\t}\n\n\tprivate getOrCreateSearchTree(ref: string, repoPath: string) {\n\t\tlet searchTree = this._searchTreeMap.get(ref);\n\t\tif (searchTree === undefined) {\n\t\t\tsearchTree = this.createSearchTree(ref, repoPath);\n\t\t\tthis._searchTreeMap.set(ref, searchTree);\n\t\t}\n\n\t\treturn searchTree;\n\t}\n\n\tprivate async getTree(path: string, ref: string, repoPath: string) {\n\t\tconst searchTree = await this.getOrCreateSearchTree(ref, repoPath);\n\t\t// Add the fake root folder to the path\n\t\treturn searchTree.findSuperstr(`/~/${path}`, true);\n\t}\n}\n\nfunction typeToFileType(type: 'blob' | 'tree' | undefined | null) {\n\tswitch (type) {\n\t\tcase 'blob':\n\t\t\treturn FileType.File;\n\t\tcase 'tree':\n\t\t\treturn FileType.Directory;\n\t\tdefault:\n\t\t\treturn FileType.Unknown;\n\t}\n}\n","import {\n\tCancellationToken,\n\tConfigurationChangeEvent,\n\tDisposable,\n\tHover,\n\tlanguages,\n\tPosition,\n\tRange,\n\tTextDocument,\n\tTextEditor,\n\tUri,\n\twindow,\n} from 'vscode';\nimport { UriComparer } from '../comparers';\nimport { configuration, FileAnnotationType } from '../configuration';\nimport { Container } from '../container';\nimport { Logger } from '../logger';\nimport { debug } from '../system/decorators/log';\nimport { once } from '../system/event';\nimport { LinesChangeEvent } from '../trackers/gitLineTracker';\nimport { Hovers } from './hovers';\n\nexport class LineHoverController implements Disposable {\n\tprivate readonly _disposable: Disposable;\n\tprivate _hoverProviderDisposable: Disposable | undefined;\n\tprivate _uri: Uri | undefined;\n\n\tconstructor(private readonly container: Container) {\n\t\tthis._disposable = Disposable.from(\n\t\t\tonce(container.onReady)(this.onReady, this),\n\t\t\tconfiguration.onDidChange(this.onConfigurationChanged, this),\n\t\t);\n\t}\n\n\tdispose() {\n\t\tthis.unregister();\n\n\t\tthis.container.lineTracker.unsubscribe(this);\n\t\tthis._disposable.dispose();\n\t}\n\n\tprivate onReady(): void {\n\t\tthis.onConfigurationChanged();\n\t}\n\n\tprivate onConfigurationChanged(e?: ConfigurationChangeEvent) {\n\t\tif (!configuration.changed(e, 'hovers.enabled') && !configuration.changed(e, 'hovers.currentLine.enabled')) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.container.config.hovers.enabled && this.container.config.hovers.currentLine.enabled) {\n\t\t\tthis.container.lineTracker.subscribe(\n\t\t\t\tthis,\n\t\t\t\tthis.container.lineTracker.onDidChangeActiveLines(this.onActiveLinesChanged, this),\n\t\t\t);\n\n\t\t\tthis.register(window.activeTextEditor);\n\t\t} else {\n\t\t\tthis.container.lineTracker.unsubscribe(this);\n\t\t\tthis.unregister();\n\t\t}\n\t}\n\n\t@debug<LineHoverController['onActiveLinesChanged']>({\n\t\targs: {\n\t\t\t0: e =>\n\t\t\t\t`editor=${e.editor?.document.uri.toString(true)}, selections=${e.selections\n\t\t\t\t\t?.map(s => `[${s.anchor}-${s.active}]`)\n\t\t\t\t\t.join(',')}, pending=${Boolean(e.pending)}, reason=${e.reason}`,\n\t\t},\n\t})\n\tprivate onActiveLinesChanged(e: LinesChangeEvent) {\n\t\tif (e.pending) return;\n\n\t\tif (e.editor == null || e.selections == null) {\n\t\t\tthis.unregister();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isRegistered(e.editor?.document.uri)) return;\n\n\t\tthis.register(e.editor);\n\t}\n\n\t@debug<LineHoverController['provideDetailsHover']>({\n\t\targs: {\n\t\t\t0: document => Logger.toLoggable(document.uri),\n\t\t\t1: position => `${position.line}:${position.character}`,\n\t\t\t2: false,\n\t\t},\n\t})\n\tasync provideDetailsHover(\n\t\tdocument: TextDocument,\n\t\tposition: Position,\n\t\t_token: CancellationToken,\n\t): Promise<Hover | undefined> {\n\t\tif (!this.container.lineTracker.includes(position.line)) return undefined;\n\n\t\tconst lineState = this.container.lineTracker.getState(position.line);\n\t\tconst commit = lineState?.commit;\n\t\tif (commit == null) return undefined;\n\n\t\t// Avoid double annotations if we are showing the whole-file hover blame annotations\n\t\tif (this.container.config.hovers.annotations.details) {\n\t\t\tconst fileAnnotations = await this.container.fileAnnotations.getAnnotationType(window.activeTextEditor);\n\t\t\tif (fileAnnotations === FileAnnotationType.Blame) return undefined;\n\t\t}\n\n\t\tconst wholeLine = this.container.config.hovers.currentLine.over === 'line';\n\t\t// If we aren't showing the hover over the whole line, make sure the annotation is on\n\t\tif (!wholeLine && this.container.lineAnnotations.suspended) return undefined;\n\n\t\tconst range = document.validateRange(\n\t\t\tnew Range(position.line, wholeLine ? 0 : Number.MAX_SAFE_INTEGER, position.line, Number.MAX_SAFE_INTEGER),\n\t\t);\n\t\tif (!wholeLine && range.start.character !== position.character) return undefined;\n\n\t\tlet editorLine = position.line;\n\t\tconst line = editorLine + 1;\n\t\tconst commitLine = commit.lines.find(l => l.line === line) ?? commit.lines[0];\n\t\teditorLine = commitLine.originalLine - 1;\n\n\t\tconst trackedDocument = await this.container.tracker.get(document);\n\t\tif (trackedDocument == null) return undefined;\n\n\t\tconst message = await Hovers.detailsMessage(\n\t\t\tcommit,\n\t\t\ttrackedDocument.uri,\n\t\t\teditorLine,\n\t\t\tthis.container.config.hovers.detailsMarkdownFormat,\n\t\t\tthis.container.config.defaultDateFormat,\n\t\t\t{\n\t\t\t\tautolinks: this.container.config.hovers.autolinks.enabled,\n\t\t\t\tpullRequests: {\n\t\t\t\t\tenabled: this.container.config.hovers.pullRequests.enabled,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t\treturn new Hover(message, range);\n\t}\n\n\t@debug<LineHoverController['provideChangesHover']>({\n\t\targs: {\n\t\t\t0: document => Logger.toLoggable(document.uri),\n\t\t\t1: position => `${position.line}:${position.character}`,\n\t\t\t2: false,\n\t\t},\n\t})\n\tasync provideChangesHover(\n\t\tdocument: TextDocument,\n\t\tposition: Position,\n\t\t_token: CancellationToken,\n\t): Promise<Hover | undefined> {\n\t\tif (!this.container.lineTracker.includes(position.line)) return undefined;\n\n\t\tconst lineState = this.container.lineTracker.getState(position.line);\n\t\tconst commit = lineState?.commit;\n\t\tif (commit == null) return undefined;\n\n\t\t// Avoid double annotations if we are showing the whole-file hover blame annotations\n\t\tif (this.container.config.hovers.annotations.changes) {\n\t\t\tconst fileAnnotations = await this.container.fileAnnotations.getAnnotationType(window.activeTextEditor);\n\t\t\tif (fileAnnotations === FileAnnotationType.Blame) return undefined;\n\t\t}\n\n\t\tconst wholeLine = this.container.config.hovers.currentLine.over === 'line';\n\t\t// If we aren't showing the hover over the whole line, make sure the annotation is on\n\t\tif (!wholeLine && this.container.lineAnnotations.suspended) return undefined;\n\n\t\tconst range = document.validateRange(\n\t\t\tnew Range(position.line, wholeLine ? 0 : Number.MAX_SAFE_INTEGER, position.line, Number.MAX_SAFE_INTEGER),\n\t\t);\n\t\tif (!wholeLine && range.start.character !== position.character) return undefined;\n\n\t\tconst trackedDocument = await this.container.tracker.get(document);\n\t\tif (trackedDocument == null) return undefined;\n\n\t\tconst message = await Hovers.changesMessage(\n\t\t\tcommit,\n\t\t\ttrackedDocument.uri,\n\t\t\tposition.line,\n\t\t\ttrackedDocument.document,\n\t\t);\n\t\tif (message == null) return undefined;\n\n\t\treturn new Hover(message, range);\n\t}\n\n\tprivate isRegistered(uri: Uri | undefined) {\n\t\treturn this._hoverProviderDisposable != null && UriComparer.equals(this._uri, uri);\n\t}\n\n\tprivate register(editor: TextEditor | undefined) {\n\t\tthis.unregister();\n\n\t\tif (editor == null) return;\n\n\t\tconst cfg = this.container.config.hovers;\n\t\tif (!cfg.enabled || !cfg.currentLine.enabled || (!cfg.currentLine.details && !cfg.currentLine.changes)) return;\n\n\t\tthis._uri = editor.document.uri;\n\n\t\tconst subscriptions = [];\n\t\tif (cfg.currentLine.changes) {\n\t\t\tsubscriptions.push(\n\t\t\t\tlanguages.registerHoverProvider(\n\t\t\t\t\t{ pattern: this._uri.fsPath },\n\t\t\t\t\t{\n\t\t\t\t\t\tprovideHover: this.provideChangesHover.bind(this),\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t\tif (cfg.currentLine.details) {\n\t\t\tsubscriptions.push(\n\t\t\t\tlanguages.registerHoverProvider(\n\t\t\t\t\t{ pattern: this._uri.fsPath },\n\t\t\t\t\t{\n\t\t\t\t\t\tprovideHover: this.provideDetailsHover.bind(this),\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tthis._hoverProviderDisposable = Disposable.from(...subscriptions);\n\t}\n\n\tprivate unregister() {\n\t\tthis._uri = undefined;\n\t\tif (this._hoverProviderDisposable != null) {\n\t\t\tthis._hoverProviderDisposable.dispose();\n\t\t\tthis._hoverProviderDisposable = undefined;\n\t\t}\n\t}\n}\n","import { commands, Disposable } from 'vscode';\nimport { ContextKeys } from './constants';\nimport { setContext } from './context';\nimport { Logger } from './logger';\nimport { log } from './system/decorators/log';\n\nexport declare interface KeyCommand {\n\tonDidPressKey?(key: Keys): void | Promise<void>;\n}\n\nconst keyNoopCommand = Object.create(null) as KeyCommand;\nexport { keyNoopCommand as KeyNoopCommand };\n\nexport const keys = [\n\t'left',\n\t'alt+left',\n\t'ctrl+left',\n\t'right',\n\t'alt+right',\n\t'ctrl+right',\n\t'alt+,',\n\t'alt+.',\n\t'escape',\n] as const;\nexport type Keys = typeof keys[number];\n\nexport type KeyMapping = { [K in Keys]?: KeyCommand | (() => Promise<KeyCommand>) };\ntype IndexableKeyMapping = KeyMapping & {\n\t[index: string]: KeyCommand | (() => Promise<KeyCommand>) | undefined;\n};\n\nconst mappings: KeyMapping[] = [];\n\nexport class KeyboardScope implements Disposable {\n\tprivate readonly _mapping: IndexableKeyMapping;\n\tconstructor(mapping: KeyMapping) {\n\t\tthis._mapping = mapping;\n\t\tfor (const key in this._mapping) {\n\t\t\tthis._mapping[key] = this._mapping[key] ?? keyNoopCommand;\n\t\t}\n\n\t\tmappings.push(this._mapping);\n\t}\n\n\t@log({\n\t\targs: false,\n\t\tprefix: context => `${context.prefix}[${mappings.length}]`,\n\t})\n\tasync dispose() {\n\t\tconst index = mappings.indexOf(this._mapping);\n\n\t\tconst cc = Logger.getCorrelationContext();\n\t\tif (cc != null) {\n\t\t\tcc.exitDetails = ` \\u2022 index=${index}`;\n\t\t}\n\n\t\tif (index === mappings.length - 1) {\n\t\t\tmappings.pop();\n\t\t\tawait this.updateKeyCommandsContext(mappings[mappings.length - 1]);\n\t\t} else {\n\t\t\tmappings.splice(index, 1);\n\t\t}\n\t}\n\n\tprivate _paused = true;\n\tget paused() {\n\t\treturn this._paused;\n\t}\n\n\t@log<KeyboardScope['clearKeyCommand']>({\n\t\targs: false,\n\t\tprefix: (context, key) => `${context.prefix}[${mappings.length}](${key})`,\n\t})\n\tasync clearKeyCommand(key: Keys) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst mapping = mappings[mappings.length - 1];\n\t\tif (mapping !== this._mapping || mapping[key] == null) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = ' \\u2022 skipped';\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tmapping[key] = undefined;\n\t\tawait setContext(`${ContextKeys.KeyPrefix}${key}`, false);\n\t}\n\n\t@log({\n\t\targs: false,\n\t\tprefix: context => `${context.prefix}(paused=${context.instance._paused})`,\n\t})\n\tasync pause(keys?: Keys[]) {\n\t\tif (this._paused) return;\n\n\t\tthis._paused = true;\n\t\tconst mapping = (Object.keys(this._mapping) as Keys[]).reduce((accumulator, key) => {\n\t\t\taccumulator[key] = keys == null || keys.includes(key) ? undefined : this._mapping[key];\n\t\t\treturn accumulator;\n\t\t}, Object.create(null) as KeyMapping);\n\n\t\tawait this.updateKeyCommandsContext(mapping);\n\t}\n\n\t@log({\n\t\targs: false,\n\t\tprefix: context => `${context.prefix}(paused=${context.instance._paused})`,\n\t})\n\tasync resume() {\n\t\tif (!this._paused) return;\n\n\t\tthis._paused = false;\n\t\tawait this.updateKeyCommandsContext(this._mapping);\n\t}\n\n\tasync start() {\n\t\tawait this.resume();\n\t}\n\n\t@log<KeyboardScope['setKeyCommand']>({\n\t\targs: false,\n\t\tprefix: (context, key) => `${context.prefix}[${mappings.length}](${key})`,\n\t})\n\tasync setKeyCommand(key: Keys, command: KeyCommand | (() => Promise<KeyCommand>)) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst mapping = mappings[mappings.length - 1];\n\t\tif (mapping !== this._mapping) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = ' \\u2022 skipped';\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst set = Boolean(mapping[key]);\n\n\t\tmapping[key] = command;\n\t\tif (!set) {\n\t\t\tawait setContext(`${ContextKeys.KeyPrefix}${key}`, true);\n\t\t}\n\t}\n\n\tprivate async updateKeyCommandsContext(mapping: KeyMapping) {\n\t\tawait Promise.all(keys.map(key => setContext(`${ContextKeys.KeyPrefix}${key}`, Boolean(mapping?.[key]))));\n\t}\n}\n\nexport class Keyboard implements Disposable {\n\tprivate readonly _disposable: Disposable;\n\n\tconstructor() {\n\t\tconst subscriptions = keys.map(key =>\n\t\t\tcommands.registerCommand(`gitlens.key.${key}`, () => this.execute(key), this),\n\t\t);\n\t\tthis._disposable = Disposable.from(...subscriptions);\n\t}\n\n\tdispose() {\n\t\tthis._disposable.dispose();\n\t}\n\n\t@log<Keyboard['createScope']>({\n\t\targs: false,\n\t\tprefix: (context, mapping) =>\n\t\t\t`${context.prefix}[${mappings.length}](${mapping === undefined ? '' : Object.keys(mapping).join(',')})`,\n\t})\n\tcreateScope(mapping?: KeyMapping): KeyboardScope {\n\t\treturn new KeyboardScope({ ...mapping });\n\t}\n\n\t@log<Keyboard['beginScope']>({\n\t\targs: false,\n\t\tprefix: (context, mapping) =>\n\t\t\t`${context.prefix}[${mappings.length}](${mapping === undefined ? '' : Object.keys(mapping).join(',')})`,\n\t})\n\tasync beginScope(mapping?: KeyMapping): Promise<KeyboardScope> {\n\t\tconst scope = this.createScope(mapping);\n\t\tawait scope.start();\n\t\treturn scope;\n\t}\n\n\t@log()\n\tasync execute(key: Keys): Promise<void> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tif (!mappings.length) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = ' \\u2022 skipped, no mappings';\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst mapping = mappings[mappings.length - 1];\n\n\t\t\tlet command = mapping[key] as KeyCommand | (() => Promise<KeyCommand>);\n\t\t\tif (typeof command === 'function') {\n\t\t\t\tcommand = await command();\n\t\t\t}\n\t\t\tif (typeof command?.onDidPressKey !== 'function') {\n\t\t\t\tif (cc != null) {\n\t\t\t\t\tcc.exitDetails = ' \\u2022 skipped, no callback';\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid (await command.onDidPressKey(key));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t}\n\t}\n}\n","import {\n\tauthentication,\n\tAuthenticationSession,\n\tAuthenticationSessionsChangeEvent,\n\tversion as codeVersion,\n\tcommands,\n\tDisposable,\n\tenv,\n\tEvent,\n\tEventEmitter,\n\tMarkdownString,\n\tMessageItem,\n\tStatusBarAlignment,\n\tStatusBarItem,\n\tThemeColor,\n\tUri,\n\twindow,\n} from 'vscode';\nimport { fetch } from '@env/fetch';\nimport { getPlatform } from '@env/platform';\nimport { Commands, ContextKeys } from '../../constants';\nimport type { Container } from '../../container';\nimport { setContext } from '../../context';\nimport { AccountValidationError } from '../../errors';\nimport { RepositoriesChangeEvent } from '../../git/gitProviderService';\nimport { Logger } from '../../logger';\nimport { StorageKeys, WorkspaceStorageKeys } from '../../storage';\nimport {\n\tcomputeSubscriptionState,\n\tgetSubscriptionPlan,\n\tgetSubscriptionPlanPriority,\n\tgetSubscriptionTimeRemaining,\n\tgetTimeRemaining,\n\tisSubscriptionExpired,\n\tisSubscriptionPaidPlan,\n\tisSubscriptionTrial,\n\tSubscription,\n\tSubscriptionPlanId,\n\tSubscriptionState,\n} from '../../subscription';\nimport { executeCommand } from '../../system/command';\nimport { createFromDateDelta } from '../../system/date';\nimport { gate } from '../../system/decorators/gate';\nimport { debug, log } from '../../system/decorators/log';\nimport { memoize } from '../../system/decorators/memoize';\nimport { once } from '../../system/function';\nimport { pluralize } from '../../system/string';\nimport { openWalkthrough } from '../../system/utils';\n\n// TODO: What user-agent should we use?\nconst userAgent = 'Visual-Studio-Code-GitLens';\n\nexport interface SubscriptionChangeEvent {\n\treadonly current: Subscription;\n\treadonly previous: Subscription;\n\treadonly etag: number;\n}\n\nexport class SubscriptionService implements Disposable {\n\tprivate static authenticationProviderId = 'gitkraken';\n\tprivate static authenticationScopes = ['gitlens'];\n\n\tprivate _onDidChange = new EventEmitter<SubscriptionChangeEvent>();\n\tget onDidChange(): Event<SubscriptionChangeEvent> {\n\t\treturn this._onDidChange.event;\n\t}\n\n\tprivate _disposable: Disposable;\n\tprivate _subscription!: Subscription;\n\tprivate _statusBarSubscription: StatusBarItem | undefined;\n\n\tconstructor(private readonly container: Container) {\n\t\tthis._disposable = Disposable.from(\n\t\t\tonce(container.onReady)(this.onReady, this),\n\t\t\tauthentication.onDidChangeSessions(this.onAuthenticationChanged, this),\n\t\t);\n\n\t\tthis.changeSubscription(this.getStoredSubscription(), true);\n\t\tsetTimeout(() => void this.ensureSession(false), 10000);\n\t}\n\n\tdispose(): void {\n\t\tthis._statusBarSubscription?.dispose();\n\n\t\tthis._disposable.dispose();\n\t}\n\n\tprivate onAuthenticationChanged(e: AuthenticationSessionsChangeEvent): void {\n\t\tif (e.provider.id !== SubscriptionService.authenticationProviderId) return;\n\n\t\tvoid this.ensureSession(false, true);\n\t}\n\n\t@memoize()\n\tprivate get baseApiUri(): Uri {\n\t\tconst { env } = this.container;\n\t\tif (env === 'staging') {\n\t\t\treturn Uri.parse('https://stagingapi.gitkraken.com');\n\t\t}\n\n\t\tif (env === 'dev') {\n\t\t\treturn Uri.parse('https://devapi.gitkraken.com');\n\t\t}\n\n\t\treturn Uri.parse('https://api.gitkraken.com');\n\t}\n\n\t@memoize()\n\tprivate get baseAccountUri(): Uri {\n\t\tconst { env } = this.container;\n\t\tif (env === 'staging') {\n\t\t\treturn Uri.parse('https://stagingaccount.gitkraken.com');\n\t\t}\n\n\t\tif (env === 'dev') {\n\t\t\treturn Uri.parse('https://devaccount.gitkraken.com');\n\t\t}\n\n\t\treturn Uri.parse('https://account.gitkraken.com');\n\t}\n\n\t@memoize()\n\tprivate get baseSiteUri(): Uri {\n\t\tconst { env } = this.container;\n\t\tif (env === 'staging') {\n\t\t\treturn Uri.parse('https://staging.gitkraken.com');\n\t\t}\n\n\t\tif (env === 'dev') {\n\t\t\treturn Uri.parse('https://dev.gitkraken.com');\n\t\t}\n\n\t\treturn Uri.parse('https://gitkraken.com');\n\t}\n\n\tprivate get connectedKey(): `${WorkspaceStorageKeys.ConnectedPrefix}${string}` {\n\t\treturn `${WorkspaceStorageKeys.ConnectedPrefix}gitkraken`;\n\t}\n\n\tprivate _etag: number = 0;\n\tget etag(): number {\n\t\treturn this._etag;\n\t}\n\n\tprivate onReady() {\n\t\tthis._disposable = Disposable.from(\n\t\t\tthis._disposable,\n\t\t\tthis.container.git.onDidChangeRepositories(this.onRepositoriesChanged, this),\n\t\t\t...this.registerCommands(),\n\t\t);\n\t\tthis.updateContext();\n\t}\n\n\tprivate onRepositoriesChanged(_e: RepositoriesChangeEvent): void {\n\t\tthis.updateContext();\n\t}\n\n\tprivate registerCommands(): Disposable[] {\n\t\tvoid this.container.viewCommands;\n\n\t\treturn [\n\t\t\tcommands.registerCommand(Commands.PremiumLearn, openToSide => this.learn(openToSide)),\n\t\t\tcommands.registerCommand(Commands.PremiumLoginOrSignUp, () => this.loginOrSignUp()),\n\t\t\tcommands.registerCommand(Commands.PremiumLogout, () => this.logout()),\n\n\t\t\tcommands.registerCommand(Commands.PremiumStartPreviewTrial, () => this.startPreviewTrial()),\n\t\t\tcommands.registerCommand(Commands.PremiumManage, () => this.manage()),\n\t\t\tcommands.registerCommand(Commands.PremiumPurchase, () => this.purchase()),\n\n\t\t\tcommands.registerCommand(Commands.PremiumResendVerification, () => this.resendVerification()),\n\t\t\tcommands.registerCommand(Commands.PremiumValidate, () => this.validate()),\n\n\t\t\tcommands.registerCommand(Commands.PremiumShowPlans, () => this.showPlans()),\n\n\t\t\tcommands.registerCommand('gitlens.premium.reset', () => this.logout(true)),\n\t\t];\n\t}\n\n\tasync getSubscription(): Promise<Subscription> {\n\t\tvoid (await this.ensureSession(false));\n\t\treturn this._subscription;\n\t}\n\n\t@debug()\n\tlearn(openToSide: boolean = true): void {\n\t\tvoid openWalkthrough(this.container.context.extension.id, 'gitlens.premium', undefined, openToSide);\n\t}\n\n\t@gate()\n\t@log()\n\tasync loginOrSignUp(): Promise<boolean> {\n\t\tvoid this.showHomeView();\n\n\t\tawait this.container.storage.deleteWorkspace(this.connectedKey);\n\n\t\tconst session = await this.ensureSession(true);\n\t\tconst loggedIn = Boolean(session);\n\t\tif (loggedIn) {\n\t\t\tconst {\n\t\t\t\taccount,\n\t\t\t\tplan: { actual },\n\t\t\t} = this._subscription;\n\n\t\t\tif (account?.verified === false) {\n\t\t\t\tconst confirm: MessageItem = { title: 'Resend Verification', isCloseAffordance: true };\n\t\t\t\tconst cancel: MessageItem = { title: 'Cancel' };\n\t\t\t\tconst result = await window.showInformationMessage(\n\t\t\t\t\t`Before you can access your ${actual.name} account, you must verify your email address.`,\n\t\t\t\t\tconfirm,\n\t\t\t\t\tcancel,\n\t\t\t\t);\n\n\t\t\t\tif (result === confirm) {\n\t\t\t\t\tvoid this.resendVerification();\n\t\t\t\t}\n\t\t\t} else if (isSubscriptionTrial(this._subscription)) {\n\t\t\t\tconst remaining = getSubscriptionTimeRemaining(this._subscription, 'days');\n\n\t\t\t\tconst confirm: MessageItem = { title: 'OK', isCloseAffordance: true };\n\t\t\t\tconst learn: MessageItem = { title: 'Learn More' };\n\t\t\t\tconst result = await window.showInformationMessage(\n\t\t\t\t\t`You are now signed in to your ${\n\t\t\t\t\t\tactual.name\n\t\t\t\t\t} account which gives you access to premium features for public repos.\\n\\nYou were also granted a trial of premium features for both public and private repos for ${pluralize(\n\t\t\t\t\t\t'more day',\n\t\t\t\t\t\tremaining ?? 0,\n\t\t\t\t\t)}.`,\n\t\t\t\t\t{ modal: true },\n\t\t\t\t\tconfirm,\n\t\t\t\t\tlearn,\n\t\t\t\t);\n\n\t\t\t\tif (result === learn) {\n\t\t\t\t\tvoid this.learn();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvoid window.showInformationMessage(`You are now signed in to your ${actual.name} account.`, 'OK');\n\t\t\t}\n\t\t}\n\t\treturn loggedIn;\n\t}\n\n\t@gate()\n\t@log()\n\tlogout(reset: boolean = false): void {\n\t\tthis._sessionPromise = undefined;\n\t\tthis._session = undefined;\n\t\tvoid this.container.storage.storeWorkspace(this.connectedKey, false);\n\n\t\tif (reset && this.container.debugging) {\n\t\t\tthis.changeSubscription(undefined);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.changeSubscription({\n\t\t\t...this._subscription,\n\t\t\tplan: {\n\t\t\t\tactual: getSubscriptionPlan(SubscriptionPlanId.Free),\n\t\t\t\teffective: getSubscriptionPlan(SubscriptionPlanId.Free),\n\t\t\t},\n\t\t\taccount: undefined,\n\t\t});\n\t}\n\n\t@log()\n\tmanage(): void {\n\t\tvoid env.openExternal(this.baseAccountUri);\n\t}\n\n\t@log()\n\tasync purchase(): Promise<void> {\n\t\tif (this._subscription.account == null) {\n\t\t\tvoid this.showPlans();\n\t\t} else {\n\t\t\tvoid env.openExternal(\n\t\t\t\tUri.joinPath(this.baseAccountUri, 'create-organization').with({ query: 'product=gitlens' }),\n\t\t\t);\n\t\t}\n\t\tawait this.showHomeView();\n\t}\n\n\t@gate()\n\t@log()\n\tasync resendVerification(): Promise<void> {\n\t\tif (this._subscription.account?.verified) return;\n\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tvoid this.showHomeView();\n\n\t\tconst session = await this.ensureSession(false);\n\t\tif (session == null) return;\n\n\t\ttry {\n\t\t\tconst rsp = await fetch(Uri.joinPath(this.baseApiUri, 'resend-email').toString(), {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${session.accessToken}`,\n\t\t\t\t\t'User-Agent': userAgent,\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({ id: session.account.id }),\n\t\t\t});\n\n\t\t\tif (!rsp.ok) {\n\t\t\t\tdebugger;\n\t\t\t\tLogger.error('', cc, `Unable to resend verification email; status=(${rsp.status}): ${rsp.statusText}`);\n\n\t\t\t\tvoid window.showErrorMessage(`Unable to resend verification email; Status: ${rsp.statusText}`, 'OK');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst confirm = { title: 'Recheck' };\n\t\t\tconst cancel = { title: 'Cancel' };\n\t\t\tconst result = await window.showInformationMessage(\n\t\t\t\t\"Once you have verified your email address, click 'Recheck'.\",\n\t\t\t\tconfirm,\n\t\t\t\tcancel,\n\t\t\t);\n\t\t\tif (result === confirm) {\n\t\t\t\tawait this.validate();\n\t\t\t}\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\tdebugger;\n\n\t\t\tvoid window.showErrorMessage('Unable to resend verification email', 'OK');\n\t\t}\n\t}\n\n\t@log()\n\tasync showHomeView(): Promise<void> {\n\t\tif (!this.container.homeView.visible) {\n\t\t\tawait executeCommand(Commands.ShowHomeView);\n\t\t}\n\t}\n\n\tprivate showPlans(): void {\n\t\tvoid env.openExternal(Uri.joinPath(this.baseSiteUri, 'gitlens/pricing'));\n\t}\n\n\t@gate()\n\t@log()\n\tasync startPreviewTrial(): Promise<void> {\n\t\tlet { plan, previewTrial } = this._subscription;\n\t\tif (previewTrial != null || plan.effective.id !== SubscriptionPlanId.Free) {\n\t\t\tvoid this.showHomeView();\n\n\t\t\tif (plan.effective.id === SubscriptionPlanId.Free) {\n\t\t\t\tconst confirm: MessageItem = { title: 'Sign In', isCloseAffordance: true };\n\t\t\t\tconst cancel: MessageItem = { title: 'Cancel' };\n\t\t\t\tconst result = await window.showInformationMessage(\n\t\t\t\t\t'Your GitLens premium features trial has ended.\\nPlease sign in to use premium features on public repos and get a free 7-day trial for both public and private repos.',\n\t\t\t\t\t{ modal: true },\n\t\t\t\t\tconfirm,\n\t\t\t\t\tcancel,\n\t\t\t\t);\n\n\t\t\t\tif (result === confirm) {\n\t\t\t\t\tvoid this.loginOrSignUp();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst startedOn = new Date();\n\n\t\tlet days;\n\t\tlet expiresOn = new Date(startedOn);\n\t\tif (!this.container.debugging) {\n\t\t\t// Normalize the date to just before midnight on the same day\n\t\t\texpiresOn.setHours(23, 59, 59, 999);\n\t\t\texpiresOn = createFromDateDelta(expiresOn, { days: 3 });\n\t\t\tdays = 3;\n\t\t} else {\n\t\t\texpiresOn = createFromDateDelta(expiresOn, { minutes: 1 });\n\t\t\tdays = 0;\n\t\t}\n\n\t\tpreviewTrial = {\n\t\t\tstartedOn: startedOn.toISOString(),\n\t\t\texpiresOn: expiresOn.toISOString(),\n\t\t};\n\n\t\tthis.changeSubscription({\n\t\t\t...this._subscription,\n\t\t\tplan: {\n\t\t\t\t...this._subscription.plan,\n\t\t\t\teffective: getSubscriptionPlan(SubscriptionPlanId.Pro, startedOn, expiresOn),\n\t\t\t},\n\t\t\tpreviewTrial: previewTrial,\n\t\t});\n\n\t\tconst confirm: MessageItem = { title: 'OK', isCloseAffordance: true };\n\t\tconst learn: MessageItem = { title: 'Learn More' };\n\t\tconst result = await window.showInformationMessage(\n\t\t\t`You have started a ${days} day trial of GitLens premium features for both public and private repos.`,\n\t\t\t{ modal: true },\n\t\t\tconfirm,\n\t\t\tlearn,\n\t\t);\n\n\t\tif (result === learn) {\n\t\t\tvoid this.learn();\n\t\t}\n\t}\n\n\t@gate()\n\t@log()\n\tasync validate(): Promise<void> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst session = await this.ensureSession(false);\n\t\tif (session == null) return;\n\n\t\ttry {\n\t\t\tawait this.checkInAndValidate(session);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\tdebugger;\n\t\t}\n\t}\n\n\tprivate _lastCheckInDate: Date | undefined;\n\t@debug<SubscriptionService['checkInAndValidate']>({ args: { 0: s => s?.account.label } })\n\tprivate async checkInAndValidate(session: AuthenticationSession): Promise<void> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\ttry {\n\t\t\tconst checkInData = {\n\t\t\t\tid: session.account.id,\n\t\t\t\tplatform: getPlatform(),\n\t\t\t\tgitlensVersion: this.container.version,\n\t\t\t\tvscodeEdition: env.appName,\n\t\t\t\tvscodeHost: env.appHost,\n\t\t\t\tvscodeVersion: codeVersion,\n\t\t\t\tpreviewStartedOn: this._subscription.previewTrial?.startedOn,\n\t\t\t\tpreviewExpiresOn: this._subscription.previewTrial?.expiresOn,\n\t\t\t};\n\n\t\t\tconst rsp = await fetch(Uri.joinPath(this.baseApiUri, 'gitlens/checkin').toString(), {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${session.accessToken}`,\n\t\t\t\t\t'User-Agent': userAgent,\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify(checkInData),\n\t\t\t});\n\n\t\t\tif (!rsp.ok) {\n\t\t\t\tthrow new AccountValidationError('Unable to validate account', undefined, rsp.status, rsp.statusText);\n\t\t\t}\n\n\t\t\tconst data: GKLicenseInfo = await rsp.json();\n\t\t\tthis.validateSubscription(data);\n\t\t\tthis._lastCheckInDate = new Date();\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\tdebugger;\n\t\t\tif (ex instanceof AccountValidationError) throw ex;\n\n\t\t\tthrow new AccountValidationError('Unable to validate account', ex);\n\t\t} finally {\n\t\t\tthis.startDailyCheckInTimer();\n\t\t}\n\t}\n\n\tprivate _dailyCheckInTimer: ReturnType<typeof setInterval> | undefined;\n\tprivate startDailyCheckInTimer(): void {\n\t\tif (this._dailyCheckInTimer != null) {\n\t\t\tclearInterval(this._dailyCheckInTimer);\n\t\t}\n\n\t\t// Check twice a day to ensure we check in at least once a day\n\t\tthis._dailyCheckInTimer = setInterval(() => {\n\t\t\tif (this._lastCheckInDate == null || this._lastCheckInDate.getDate() !== new Date().getDate()) {\n\t\t\t\tvoid this.ensureSession(false, true);\n\t\t\t}\n\t\t}, 1000 * 60 * 60 * 12);\n\t}\n\n\t@debug()\n\tprivate validateSubscription(data: GKLicenseInfo) {\n\t\tconst account: Subscription['account'] = {\n\t\t\tid: data.user.id,\n\t\t\tname: data.user.name,\n\t\t\temail: data.user.email,\n\t\t\tverified: data.user.status === 'activated',\n\t\t};\n\n\t\tconst effectiveLicenses = Object.entries(data.licenses.effectiveLicenses) as [GKLicenseType, GKLicense][];\n\t\tconst paidLicenses = Object.entries(data.licenses.paidLicenses) as [GKLicenseType, GKLicense][];\n\n\t\tlet actual: Subscription['plan']['actual'] | undefined;\n\t\tif (paidLicenses.length > 0) {\n\t\t\tpaidLicenses.sort(\n\t\t\t\t(a, b) =>\n\t\t\t\t\tlicenseStatusPriority(b[1].latestStatus) - licenseStatusPriority(a[1].latestStatus) ||\n\t\t\t\t\tgetSubscriptionPlanPriority(convertLicenseTypeToPlanId(b[0])) -\n\t\t\t\t\t\tgetSubscriptionPlanPriority(convertLicenseTypeToPlanId(a[0])),\n\t\t\t);\n\n\t\t\tconst [licenseType, license] = paidLicenses[0];\n\t\t\tactual = getSubscriptionPlan(\n\t\t\t\tconvertLicenseTypeToPlanId(licenseType),\n\t\t\t\tnew Date(license.latestStartDate),\n\t\t\t\tnew Date(license.latestEndDate),\n\t\t\t);\n\t\t}\n\n\t\tif (actual == null) {\n\t\t\tactual = getSubscriptionPlan(\n\t\t\t\tSubscriptionPlanId.FreePlus,\n\t\t\t\tdata.user.firstGitLensCheckIn != null ? new Date(data.user.firstGitLensCheckIn) : undefined,\n\t\t\t);\n\t\t}\n\n\t\tlet effective: Subscription['plan']['effective'] | undefined;\n\t\tif (effectiveLicenses.length > 0) {\n\t\t\teffectiveLicenses.sort(\n\t\t\t\t(a, b) =>\n\t\t\t\t\tlicenseStatusPriority(b[1].latestStatus) - licenseStatusPriority(a[1].latestStatus) ||\n\t\t\t\t\tgetSubscriptionPlanPriority(convertLicenseTypeToPlanId(b[0])) -\n\t\t\t\t\t\tgetSubscriptionPlanPriority(convertLicenseTypeToPlanId(a[0])),\n\t\t\t);\n\n\t\t\tconst [licenseType, license] = effectiveLicenses[0];\n\t\t\teffective = getSubscriptionPlan(\n\t\t\t\tconvertLicenseTypeToPlanId(licenseType),\n\t\t\t\tnew Date(license.latestStartDate),\n\t\t\t\tnew Date(license.latestEndDate),\n\t\t\t);\n\t\t}\n\n\t\tif (effective == null) {\n\t\t\teffective = { ...actual };\n\t\t}\n\n\t\tthis.changeSubscription({\n\t\t\t...this._subscription,\n\t\t\tplan: {\n\t\t\t\tactual: actual,\n\t\t\t\teffective: effective,\n\t\t\t},\n\t\t\taccount: account,\n\t\t});\n\t}\n\n\tprivate _sessionPromise: Promise<AuthenticationSession | null> | undefined;\n\tprivate _session: AuthenticationSession | null | undefined;\n\n\t@gate()\n\t@debug()\n\tprivate async ensureSession(createIfNeeded: boolean, force?: boolean): Promise<AuthenticationSession | undefined> {\n\t\tif (this._sessionPromise != null && this._session === undefined) {\n\t\t\tthis._session = await this._sessionPromise;\n\t\t\tthis._sessionPromise = undefined;\n\t\t}\n\n\t\tif (!force && this._session != null) return this._session;\n\t\tif (this._session === null && !createIfNeeded) return undefined;\n\n\t\tif (createIfNeeded) {\n\t\t\tawait this.container.storage.deleteWorkspace(this.connectedKey);\n\t\t} else if (this.container.storage.getWorkspace<boolean>(this.connectedKey) === false) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (this._sessionPromise === undefined) {\n\t\t\tthis._sessionPromise = this.getOrCreateSession(createIfNeeded);\n\t\t}\n\n\t\tthis._session = await this._sessionPromise;\n\t\tthis._sessionPromise = undefined;\n\t\treturn this._session ?? undefined;\n\t}\n\n\t@debug()\n\tprivate async getOrCreateSession(createIfNeeded: boolean): Promise<AuthenticationSession | null> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tlet session: AuthenticationSession | null | undefined;\n\n\t\ttry {\n\t\t\tsession = await authentication.getSession(\n\t\t\t\tSubscriptionService.authenticationProviderId,\n\t\t\t\tSubscriptionService.authenticationScopes,\n\t\t\t\t{\n\t\t\t\t\tcreateIfNone: createIfNeeded,\n\t\t\t\t\tsilent: !createIfNeeded,\n\t\t\t\t},\n\t\t\t);\n\t\t} catch (ex) {\n\t\t\tsession = null;\n\n\t\t\tif (ex instanceof Error && ex.message.includes('User did not consent')) {\n\t\t\t\tthis.logout();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tLogger.error(ex, cc);\n\t\t}\n\n\t\tif (session == null) {\n\t\t\tthis.logout();\n\t\t\treturn session ?? null;\n\t\t}\n\n\t\ttry {\n\t\t\tawait this.checkInAndValidate(session);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\tdebugger;\n\n\t\t\tconst name = session.account.label;\n\t\t\tsession = null;\n\t\t\tif (ex instanceof AccountValidationError) {\n\t\t\t\tthis.logout();\n\n\t\t\t\tif (createIfNeeded) {\n\t\t\t\t\tvoid window.showErrorMessage(\n\t\t\t\t\t\t`Unable to sign in to your account. Please try again. If this issue persists, please contact support. Account=${name} Error=${ex.message}`,\n\t\t\t\t\t\t'OK',\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn session;\n\t}\n\n\t@debug()\n\tprivate changeSubscription(\n\t\tsubscription: Optional<Subscription, 'state'> | undefined,\n\t\tsilent: boolean = false,\n\t): void {\n\t\tif (subscription == null) {\n\t\t\tsubscription = {\n\t\t\t\tplan: {\n\t\t\t\t\tactual: getSubscriptionPlan(SubscriptionPlanId.Free),\n\t\t\t\t\teffective: getSubscriptionPlan(SubscriptionPlanId.Free),\n\t\t\t\t},\n\t\t\t\taccount: undefined,\n\t\t\t\tstate: SubscriptionState.Free,\n\t\t\t};\n\t\t}\n\n\t\t// If the effective plan is Free, then check if the preview has expired, if not apply it\n\t\tif (\n\t\t\tsubscription.plan.effective.id === SubscriptionPlanId.Free &&\n\t\t\tsubscription.previewTrial != null &&\n\t\t\t(getTimeRemaining(subscription.previewTrial.expiresOn) ?? 0) > 0\n\t\t) {\n\t\t\t(subscription.plan as PickMutable<Subscription['plan'], 'effective'>).effective = getSubscriptionPlan(\n\t\t\t\tSubscriptionPlanId.Pro,\n\t\t\t\tnew Date(subscription.previewTrial.startedOn),\n\t\t\t\tnew Date(subscription.previewTrial.expiresOn),\n\t\t\t);\n\t\t}\n\n\t\t// If the effective plan has expired, then replace it with the actual plan\n\t\tif (isSubscriptionExpired(subscription)) {\n\t\t\t(subscription.plan as PickMutable<Subscription['plan'], 'effective'>).effective = subscription.plan.actual;\n\t\t}\n\n\t\tsubscription.state = computeSubscriptionState(subscription);\n\t\tassertSubscriptionState(subscription);\n\t\tvoid this.storeSubscription(subscription);\n\n\t\tconst previous = this._subscription; // Can be undefined here, since we call this in the constructor\n\t\tthis._subscription = subscription;\n\n\t\tthis._etag = Date.now();\n\t\tthis.updateContext();\n\n\t\tif (!silent && previous != null) {\n\t\t\tthis._onDidChange.fire({ current: subscription, previous: previous, etag: this._etag });\n\t\t}\n\t}\n\n\tprivate getStoredSubscription(): Subscription | undefined {\n\t\tconst storedSubscription = this.container.storage.get<Stored<Subscription>>(StorageKeys.PremiumSubscription);\n\t\treturn storedSubscription?.data;\n\t}\n\n\tprivate async storeSubscription(subscription: Subscription): Promise<void> {\n\t\treturn this.container.storage.store<Stored<Subscription>>(StorageKeys.PremiumSubscription, {\n\t\t\tv: 1,\n\t\t\tdata: subscription,\n\t\t});\n\t}\n\n\tprivate updateContext(): void {\n\t\tvoid this.updateStatusBar();\n\n\t\tqueueMicrotask(async () => {\n\t\t\tconst { allowed, subscription } = await this.container.git.access();\n\t\t\tconst required = allowed\n\t\t\t\t? false\n\t\t\t\t: subscription.required != null && isSubscriptionPaidPlan(subscription.required)\n\t\t\t\t? 'paid'\n\t\t\t\t: 'free+';\n\t\t\tvoid setContext(ContextKeys.PremiumAllowed, allowed);\n\t\t\tvoid setContext(ContextKeys.PremiumRequired, required);\n\t\t});\n\n\t\tconst {\n\t\t\tplan: { actual },\n\t\t\tstate,\n\t\t} = this._subscription;\n\n\t\tvoid setContext(ContextKeys.Premium, actual.id != SubscriptionPlanId.Free ? actual.id : undefined);\n\t\tvoid setContext(ContextKeys.PremiumState, state);\n\t}\n\n\tprivate updateStatusBar(): void {\n\t\tconst {\n\t\t\taccount,\n\t\t\tplan: { effective },\n\t\t} = this._subscription;\n\n\t\tif (effective.id === SubscriptionPlanId.Free) {\n\t\t\tthis._statusBarSubscription?.dispose();\n\t\t\tthis._statusBarSubscription = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tconst trial = isSubscriptionTrial(this._subscription);\n\t\tif (!trial && account?.verified !== false) {\n\t\t\tthis._statusBarSubscription?.dispose();\n\t\t\tthis._statusBarSubscription = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._statusBarSubscription == null) {\n\t\t\tthis._statusBarSubscription = window.createStatusBarItem(\n\t\t\t\t'gitlens.subscription',\n\t\t\t\tStatusBarAlignment.Left,\n\t\t\t\t1,\n\t\t\t);\n\t\t}\n\n\t\tthis._statusBarSubscription.name = 'GitLens Subscription';\n\t\tthis._statusBarSubscription.command = Commands.ShowHomeView;\n\n\t\tif (account?.verified === false) {\n\t\t\tthis._statusBarSubscription.text = `$(warning) ${effective.name} (Unverified)`;\n\t\t\tthis._statusBarSubscription.backgroundColor = new ThemeColor('statusBarItem.warningBackground');\n\t\t\tthis._statusBarSubscription.tooltip = new MarkdownString(\n\t\t\t\ttrial\n\t\t\t\t\t? `**Please verify your email**\\n\\nBefore you can start your **${effective.name}** trial, please verify the email for the account you created.\\n\\nClick for details`\n\t\t\t\t\t: `**Please verify your email**\\n\\nBefore you use premium GitLens features, please verify the email for the account you created.\\n\\nClick for details`,\n\t\t\t\ttrue,\n\t\t\t);\n\t\t} else {\n\t\t\tconst remaining = getSubscriptionTimeRemaining(this._subscription, 'days');\n\n\t\t\tthis._statusBarSubscription.text = `${effective.name} (Trial)`;\n\t\t\tthis._statusBarSubscription.tooltip = new MarkdownString(\n\t\t\t\t`You are currently trialing **${\n\t\t\t\t\teffective.name\n\t\t\t\t}**, which gives you access to premium GitLens features. You have ${pluralize(\n\t\t\t\t\t'day',\n\t\t\t\t\tremaining ?? 0,\n\t\t\t\t)} remaining in your trial.\\n\\nClick for details`,\n\t\t\t\ttrue,\n\t\t\t);\n\t\t}\n\n\t\tthis._statusBarSubscription.show();\n\t}\n}\n\nfunction assertSubscriptionState(subscription: Optional<Subscription, 'state'>): asserts subscription is Subscription {}\n\ninterface GKLicenseInfo {\n\tuser: GKUser;\n\tlicenses: {\n\t\tpaidLicenses: Record<GKLicenseType, GKLicense>;\n\t\teffectiveLicenses: Record<GKLicenseType, GKLicense>;\n\t};\n}\n\ntype GKLicenseType =\n\t| 'gitlens-pro'\n\t| 'gitlens-hosted-enterprise'\n\t| 'gitlens-self-hosted-enterprise'\n\t| 'gitlens-standalone-enterprise'\n\t| 'bundle-pro'\n\t| 'bundle-hosted-enterprise'\n\t| 'bundle-self-hosted-enterprise'\n\t| 'bundle-standalone-enterprise';\n\nfunction convertLicenseTypeToPlanId(licenseType: GKLicenseType): SubscriptionPlanId {\n\tswitch (licenseType) {\n\t\tcase 'gitlens-pro':\n\t\tcase 'bundle-pro':\n\t\t\treturn SubscriptionPlanId.Pro;\n\t\tcase 'gitlens-hosted-enterprise':\n\t\tcase 'gitlens-self-hosted-enterprise':\n\t\tcase 'gitlens-standalone-enterprise':\n\t\tcase 'bundle-hosted-enterprise':\n\t\tcase 'bundle-self-hosted-enterprise':\n\t\tcase 'bundle-standalone-enterprise':\n\t\t\treturn SubscriptionPlanId.Enterprise;\n\t\tdefault:\n\t\t\treturn SubscriptionPlanId.FreePlus;\n\t}\n}\n\nfunction licenseStatusPriority(status: GKLicense['latestStatus']): number {\n\tswitch (status) {\n\t\tcase 'active':\n\t\t\treturn 100;\n\t\tcase 'expired':\n\t\t\treturn -100;\n\t\tcase 'trial':\n\t\t\treturn 1;\n\t\tcase 'canceled':\n\t\t\treturn 0;\n\t}\n}\n\ninterface GKLicense {\n\tlatestStatus: 'active' | 'canceled' | 'expired' | 'trial';\n\tlatestStartDate: string;\n\tlatestEndDate: string;\n}\n\ninterface GKUser {\n\tid: string;\n\tname: string;\n\temail: string;\n\tstatus: 'activated' | 'pending';\n\tfirstGitLensCheckIn?: string;\n}\n\ninterface Stored<T, SchemaVersion extends number = 1> {\n\tv: SchemaVersion;\n\tdata: T;\n}\n","import type { Config } from '../config';\n\nexport interface IpcMessage {\n\tid: string;\n\tmethod: string;\n\tparams?: unknown;\n}\n\nabstract class IpcMessageType<Params = void> {\n\t_?: Params; // Required for type inferencing to work properly\n\tconstructor(public readonly method: string) {}\n}\nexport type IpcMessageParams<T> = T extends IpcMessageType<infer P> ? P : never;\n\n/**\n * Commands are sent from the webview to the extension\n */\nexport class IpcCommandType<Params = void> extends IpcMessageType<Params> {}\n/**\n * Notifications are sent from the extension to the webview\n */\nexport class IpcNotificationType<Params = void> extends IpcMessageType<Params> {}\n\nexport function onIpc<T extends IpcMessageType<any>>(\n\ttype: T,\n\tmsg: IpcMessage,\n\tfn: (params: IpcMessageParams<T>) => unknown,\n) {\n\tif (type.method !== msg.method) return;\n\n\tfn(msg.params as IpcMessageParams<T>);\n}\n\n// COMMANDS\n\nexport const WebviewReadyCommandType = new IpcCommandType('webview/ready');\n\nexport interface ExecuteCommandParams {\n\tcommand: string;\n\targs?: [];\n}\nexport const ExecuteCommandType = new IpcCommandType<ExecuteCommandParams>('command/execute');\n\nexport interface GenerateCommitPreviewParams {\n\tkey: string;\n\ttype: 'commit';\n\tformat: string;\n}\n\ntype GenerateConfigurationPreviewParams = GenerateCommitPreviewParams;\nexport const GenerateConfigurationPreviewCommandType = new IpcCommandType<GenerateConfigurationPreviewParams>(\n\t'configuration/preview',\n);\n\nexport interface UpdateConfigurationParams {\n\tchanges: {\n\t\t[key: string]: any;\n\t};\n\tremoves: string[];\n\tscope?: 'user' | 'workspace';\n\turi?: string;\n}\nexport const UpdateConfigurationCommandType = new IpcCommandType<UpdateConfigurationParams>('configuration/update');\n\n// NOTIFICATIONS\n\nexport interface DidChangeConfigurationParams {\n\tconfig: Config;\n\tcustomSettings: Record<string, boolean>;\n}\nexport const DidChangeConfigurationNotificationType = new IpcNotificationType<DidChangeConfigurationParams>(\n\t'configuration/didChange',\n);\n\nexport interface DidGenerateConfigurationPreviewParams {\n\tcompletionId: string;\n\tpreview: string;\n}\n\nexport const DidGenerateConfigurationPreviewNotificationType =\n\tnew IpcNotificationType<DidGenerateConfigurationPreviewParams>('configuration/didPreview');\n\nexport interface DidOpenAnchorParams {\n\tanchor: string;\n\tscrollBehavior: 'auto' | 'smooth';\n}\nexport const DidOpenAnchorNotificationType = new IpcNotificationType<DidOpenAnchorParams>('webview/didOpenAnchor');\n","import {\n\tcommands,\n\tDisposable,\n\tUri,\n\tViewColumn,\n\tWebview,\n\tWebviewPanel,\n\tWebviewPanelOnDidChangeViewStateEvent,\n\twindow,\n\tworkspace,\n} from 'vscode';\nimport { getNonce } from '@env/crypto';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { Logger } from '../logger';\nimport { executeCommand } from '../system/command';\nimport {\n\tExecuteCommandType,\n\tIpcMessage,\n\tIpcMessageParams,\n\tIpcNotificationType,\n\tonIpc,\n\tWebviewReadyCommandType,\n} from './protocol';\n\nlet ipcSequence = 0;\nfunction nextIpcId() {\n\tif (ipcSequence === Number.MAX_SAFE_INTEGER) {\n\t\tipcSequence = 1;\n\t} else {\n\t\tipcSequence++;\n\t}\n\n\treturn `host:${ipcSequence}`;\n}\n\nexport abstract class WebviewBase<State> implements Disposable {\n\tprotected readonly disposables: Disposable[] = [];\n\tprotected isReady: boolean = false;\n\tprivate _disposablePanel: Disposable | undefined;\n\tprivate _panel: WebviewPanel | undefined;\n\n\tconstructor(\n\t\tprotected readonly container: Container,\n\t\tpublic readonly id: `gitlens.${string}`,\n\t\tprivate readonly fileName: string,\n\t\tprivate readonly iconPath: string,\n\t\ttitle: string,\n\t\tshowCommand: Commands,\n\t) {\n\t\tthis._title = title;\n\t\tthis.disposables.push(commands.registerCommand(showCommand, this.onShowCommand, this));\n\t}\n\n\tdispose() {\n\t\tthis.disposables.forEach(d => d.dispose());\n\t\tthis._disposablePanel?.dispose();\n\t}\n\n\tprivate _title: string;\n\tget title(): string {\n\t\treturn this._panel?.title ?? this._title;\n\t}\n\tset title(title: string) {\n\t\tthis._title = title;\n\t\tif (this._panel == null) return;\n\n\t\tthis._panel.title = title;\n\t}\n\n\tget visible() {\n\t\treturn this._panel?.visible ?? false;\n\t}\n\n\thide() {\n\t\tthis._panel?.dispose();\n\t}\n\n\tasync show(column: ViewColumn = ViewColumn.Beside): Promise<void> {\n\t\tif (this._panel == null) {\n\t\t\tthis._panel = window.createWebviewPanel(\n\t\t\t\tthis.id,\n\t\t\t\tthis._title,\n\t\t\t\t{ viewColumn: column, preserveFocus: false },\n\t\t\t\t{\n\t\t\t\t\tretainContextWhenHidden: true,\n\t\t\t\t\tenableFindWidget: true,\n\t\t\t\t\tenableCommandUris: true,\n\t\t\t\t\tenableScripts: true,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tthis._panel.iconPath = Uri.file(this.container.context.asAbsolutePath(this.iconPath));\n\t\t\tthis._disposablePanel = Disposable.from(\n\t\t\t\tthis._panel,\n\t\t\t\tthis._panel.onDidDispose(this.onPanelDisposed, this),\n\t\t\t\tthis._panel.onDidChangeViewState(this.onViewStateChanged, this),\n\t\t\t\tthis._panel.webview.onDidReceiveMessage(this.onMessageReceivedCore, this),\n\t\t\t\t...(this.onInitializing?.() ?? []),\n\t\t\t\t...(this.registerCommands?.() ?? []),\n\t\t\t);\n\n\t\t\tthis._panel.webview.html = await this.getHtml(this._panel.webview);\n\t\t} else {\n\t\t\tconst html = await this.getHtml(this._panel.webview);\n\n\t\t\t// Reset the html to get the webview to reload\n\t\t\tthis._panel.webview.html = '';\n\t\t\tthis._panel.webview.html = html;\n\n\t\t\tthis._panel.reveal(this._panel.viewColumn ?? ViewColumn.Active, false);\n\t\t}\n\t}\n\n\tprotected onInitializing?(): Disposable[] | undefined;\n\tprotected onReady?(): void;\n\tprotected onMessageReceived?(e: IpcMessage): void;\n\tprotected onFocusChanged?(focused: boolean): void;\n\tprotected onVisibilityChanged?(visible: boolean): void;\n\n\tprotected registerCommands?(): Disposable[];\n\n\tprotected includeBootstrap?(): State | Promise<State>;\n\tprotected includeHead?(): string | Promise<string>;\n\tprotected includeBody?(): string | Promise<string>;\n\tprotected includeEndOfBody?(): string | Promise<string>;\n\n\tprotected async refresh(): Promise<void> {\n\t\tif (this._panel == null) return;\n\n\t\tthis._panel.webview.html = await this.getHtml(this._panel.webview);\n\t}\n\n\tprivate onPanelDisposed() {\n\t\tthis.onVisibilityChanged?.(false);\n\t\tthis.onFocusChanged?.(false);\n\n\t\tthis._disposablePanel?.dispose();\n\t\tthis._disposablePanel = undefined;\n\t\tthis._panel = undefined;\n\t}\n\n\tprotected onShowCommand(): void {\n\t\tvoid this.show();\n\t}\n\n\tprotected onViewStateChanged(e: WebviewPanelOnDidChangeViewStateEvent): void {\n\t\tLogger.debug(\n\t\t\t`Webview(${this.id}).onViewStateChanged`,\n\t\t\t`active=${e.webviewPanel.active}, visible=${e.webviewPanel.visible}`,\n\t\t);\n\t\tthis.onVisibilityChanged?.(e.webviewPanel.visible);\n\t\tthis.onFocusChanged?.(e.webviewPanel.active);\n\t}\n\n\tprotected onMessageReceivedCore(e: IpcMessage) {\n\t\tif (e == null) return;\n\n\t\tLogger.debug(`Webview(${this.id}).onMessageReceived: method=${e.method}`);\n\n\t\tswitch (e.method) {\n\t\t\tcase WebviewReadyCommandType.method:\n\t\t\t\tonIpc(WebviewReadyCommandType, e, () => {\n\t\t\t\t\tthis.isReady = true;\n\t\t\t\t\tthis.onReady?.();\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase ExecuteCommandType.method:\n\t\t\t\tonIpc(ExecuteCommandType, e, params => {\n\t\t\t\t\tif (params.args != null) {\n\t\t\t\t\t\tvoid executeCommand(params.command as Commands, ...params.args);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvoid executeCommand(params.command as Commands);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthis.onMessageReceived?.(e);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate async getHtml(webview: Webview): Promise<string> {\n\t\tconst webRootUri = Uri.joinPath(this.container.context.extensionUri, 'dist', 'webviews');\n\t\tconst uri = Uri.joinPath(webRootUri, this.fileName);\n\t\tconst content = new TextDecoder('utf8').decode(await workspace.fs.readFile(uri));\n\n\t\tconst [bootstrap, head, body, endOfBody] = await Promise.all([\n\t\t\tthis.includeBootstrap?.(),\n\t\t\tthis.includeHead?.(),\n\t\t\tthis.includeBody?.(),\n\t\t\tthis.includeEndOfBody?.(),\n\t\t]);\n\n\t\tconst cspSource = webview.cspSource;\n\t\tconst cspNonce = getNonce();\n\n\t\tconst root = webview.asWebviewUri(this.container.context.extensionUri).toString();\n\t\tconst webRoot = webview.asWebviewUri(webRootUri).toString();\n\n\t\tconst html = content\n\t\t\t.replace(/#{(head|body|endOfBody)}/i, (_substring, token) => {\n\t\t\t\tswitch (token) {\n\t\t\t\t\tcase 'head':\n\t\t\t\t\t\treturn head ?? '';\n\t\t\t\t\tcase 'body':\n\t\t\t\t\t\treturn body ?? '';\n\t\t\t\t\tcase 'endOfBody':\n\t\t\t\t\t\treturn bootstrap != null\n\t\t\t\t\t\t\t? `<script type=\"text/javascript\" nonce=\"#{cspNonce}\">window.bootstrap = ${JSON.stringify(\n\t\t\t\t\t\t\t\t\tbootstrap,\n\t\t\t\t\t\t\t  )};</script>${endOfBody ?? ''}`\n\t\t\t\t\t\t\t: endOfBody ?? '';\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t})\n\t\t\t.replace(/#{(cspSource|cspNonce|root|webroot)}/g, (substring, token) => {\n\t\t\t\tswitch (token) {\n\t\t\t\t\tcase 'cspSource':\n\t\t\t\t\t\treturn cspSource;\n\t\t\t\t\tcase 'cspNonce':\n\t\t\t\t\t\treturn cspNonce;\n\t\t\t\t\tcase 'root':\n\t\t\t\t\t\treturn root;\n\t\t\t\t\tcase 'webroot':\n\t\t\t\t\t\treturn webRoot;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn html;\n\t}\n\n\tprotected notify<T extends IpcNotificationType<any>>(type: T, params: IpcMessageParams<T>): Thenable<boolean> {\n\t\treturn this.postMessage({ id: nextIpcId(), method: type.method, params: params });\n\t}\n\n\tprivate postMessage(message: IpcMessage) {\n\t\tif (this._panel == null) return Promise.resolve(false);\n\n\t\tLogger.debug(`Webview(${this.id}).postMessage: method=${message.method}`);\n\t\treturn this._panel.webview.postMessage(message);\n\t}\n}\n","import type { FeatureAccess } from '../../../features';\nimport { IpcCommandType, IpcNotificationType } from '../../../webviews/protocol';\n\nexport interface State {\n\tdataset?: Commit[];\n\tperiod: Period;\n\ttitle: string;\n\turi?: string;\n\n\tdateFormat: string;\n\taccess: FeatureAccess;\n}\n\nexport interface Commit {\n\tcommit: string;\n\tauthor: string;\n\tdate: string;\n\tmessage: string;\n\n\tadditions: number | undefined;\n\tdeletions: number | undefined;\n\n\tsort: number;\n}\n\nexport type Period = `${number}|${'D' | 'M' | 'Y'}`;\n\nexport interface DidChangeStateParams {\n\tstate: State;\n}\nexport const DidChangeStateNotificationType = new IpcNotificationType<DidChangeStateParams>('timeline/data/didChange');\n\nexport interface OpenDataPointParams {\n\tdata?: {\n\t\tid: string;\n\t\tselected: boolean;\n\t};\n}\nexport const OpenDataPointCommandType = new IpcCommandType<OpenDataPointParams>('timeline/point/click');\n\nexport interface UpdatePeriodParams {\n\tperiod: Period;\n}\nexport const UpdatePeriodCommandType = new IpcCommandType<UpdatePeriodParams>('timeline/period/update');\n","import {\n\tCancellationToken,\n\tDisposable,\n\tUri,\n\tWebview,\n\tWebviewView,\n\tWebviewViewProvider,\n\tWebviewViewResolveContext,\n\twindow,\n\tWindowState,\n\tworkspace,\n} from 'vscode';\nimport { getNonce } from '@env/crypto';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { Logger } from '../logger';\nimport { executeCommand } from '../system/command';\nimport { log } from '../system/decorators/log';\nimport {\n\tExecuteCommandType,\n\tIpcMessage,\n\tIpcMessageParams,\n\tIpcNotificationType,\n\tonIpc,\n\tWebviewReadyCommandType,\n} from './protocol';\n\nlet ipcSequence = 0;\nfunction nextIpcId() {\n\tif (ipcSequence === Number.MAX_SAFE_INTEGER) {\n\t\tipcSequence = 1;\n\t} else {\n\t\tipcSequence++;\n\t}\n\n\treturn `host:${ipcSequence}`;\n}\n\nexport abstract class WebviewViewBase<State> implements WebviewViewProvider, Disposable {\n\tprotected readonly disposables: Disposable[] = [];\n\tprotected isReady: boolean = false;\n\tprivate _disposableView: Disposable | undefined;\n\tprivate _view: WebviewView | undefined;\n\n\tconstructor(\n\t\tprotected readonly container: Container,\n\t\tpublic readonly id: `gitlens.views.${string}`,\n\t\tprotected readonly fileName: string,\n\t\ttitle: string,\n\t) {\n\t\tthis._title = title;\n\t\tthis.disposables.push(window.registerWebviewViewProvider(id, this));\n\t}\n\n\tdispose() {\n\t\tthis.disposables.forEach(d => d.dispose());\n\t\tthis._disposableView?.dispose();\n\t}\n\n\tget description(): string | undefined {\n\t\treturn this._view?.description;\n\t}\n\tset description(description: string | undefined) {\n\t\tif (this._view == null) return;\n\n\t\tthis._view.description = description;\n\t}\n\n\tprivate _title: string;\n\tget title(): string {\n\t\treturn this._view?.title ?? this._title;\n\t}\n\tset title(title: string) {\n\t\tthis._title = title;\n\t\tif (this._view == null) return;\n\n\t\tthis._view.title = title;\n\t}\n\n\tget visible() {\n\t\treturn this._view?.visible ?? false;\n\t}\n\n\t@log()\n\tasync show(options?: { preserveFocus?: boolean }) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\ttry {\n\t\t\tvoid (await executeCommand(`${this.id}.focus`, options));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t}\n\t}\n\n\tprotected onInitializing?(): Disposable[] | undefined;\n\tprotected onReady?(): void;\n\tprotected onMessageReceived?(e: IpcMessage): void;\n\tprotected onVisibilityChanged?(visible: boolean): void;\n\tprotected onWindowFocusChanged?(focused: boolean): void;\n\n\tprotected registerCommands?(): Disposable[];\n\n\tprotected includeBootstrap?(): State | Promise<State>;\n\tprotected includeHead?(): string | Promise<string>;\n\tprotected includeBody?(): string | Promise<string>;\n\tprotected includeEndOfBody?(): string | Promise<string>;\n\n\tasync resolveWebviewView(\n\t\twebviewView: WebviewView,\n\t\t_context: WebviewViewResolveContext,\n\t\t_token: CancellationToken,\n\t): Promise<void> {\n\t\tthis._view = webviewView;\n\n\t\twebviewView.webview.options = {\n\t\t\tenableCommandUris: true,\n\t\t\tenableScripts: true,\n\t\t};\n\n\t\twebviewView.title = this._title;\n\n\t\tthis._disposableView = Disposable.from(\n\t\t\tthis._view.onDidDispose(this.onViewDisposed, this),\n\t\t\tthis._view.onDidChangeVisibility(this.onViewVisibilityChanged, this),\n\t\t\tthis._view.webview.onDidReceiveMessage(this.onMessageReceivedCore, this),\n\t\t\twindow.onDidChangeWindowState(this.onWindowStateChanged, this),\n\t\t\t...(this.onInitializing?.() ?? []),\n\t\t\t...(this.registerCommands?.() ?? []),\n\t\t);\n\n\t\twebviewView.webview.html = await this.getHtml(webviewView.webview);\n\n\t\tthis.onViewVisibilityChanged();\n\t}\n\n\tprotected async refresh(): Promise<void> {\n\t\tif (this._view == null) return;\n\n\t\tthis._view.webview.html = await this.getHtml(this._view.webview);\n\t}\n\n\tprivate onViewDisposed() {\n\t\tthis._disposableView?.dispose();\n\t\tthis._disposableView = undefined;\n\t\tthis._view = undefined;\n\t}\n\n\tprivate onViewVisibilityChanged() {\n\t\tconst visible = this.visible;\n\t\tLogger.debug(`WebviewView(${this.id}).onViewVisibilityChanged`, `visible=${visible}`);\n\t\tthis.onVisibilityChanged?.(visible);\n\t}\n\n\tprivate onWindowStateChanged(e: WindowState) {\n\t\tthis.onWindowFocusChanged?.(e.focused);\n\t}\n\n\tprivate onMessageReceivedCore(e: IpcMessage) {\n\t\tif (e == null) return;\n\n\t\tLogger.debug(`WebviewView(${this.id}).onMessageReceived: method=${e.method}`);\n\n\t\tswitch (e.method) {\n\t\t\tcase WebviewReadyCommandType.method:\n\t\t\t\tonIpc(WebviewReadyCommandType, e, () => {\n\t\t\t\t\tthis.isReady = true;\n\t\t\t\t\tthis.onReady?.();\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase ExecuteCommandType.method:\n\t\t\t\tonIpc(ExecuteCommandType, e, params => {\n\t\t\t\t\tif (params.args != null) {\n\t\t\t\t\t\tvoid executeCommand(params.command as Commands, ...params.args);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvoid executeCommand(params.command as Commands);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthis.onMessageReceived?.(e);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate async getHtml(webview: Webview): Promise<string> {\n\t\tconst webRootUri = Uri.joinPath(this.container.context.extensionUri, 'dist', 'webviews');\n\t\tconst uri = Uri.joinPath(webRootUri, this.fileName);\n\t\tconst content = new TextDecoder('utf8').decode(await workspace.fs.readFile(uri));\n\n\t\tconst [bootstrap, head, body, endOfBody] = await Promise.all([\n\t\t\tthis.includeBootstrap?.(),\n\t\t\tthis.includeHead?.(),\n\t\t\tthis.includeBody?.(),\n\t\t\tthis.includeEndOfBody?.(),\n\t\t]);\n\n\t\tconst cspSource = webview.cspSource;\n\t\tconst cspNonce = getNonce();\n\n\t\tconst root = webview.asWebviewUri(this.container.context.extensionUri).toString();\n\t\tconst webRoot = webview.asWebviewUri(webRootUri).toString();\n\n\t\tconst html = content\n\t\t\t.replace(/#{(head|body|endOfBody)}/i, (_substring, token) => {\n\t\t\t\tswitch (token) {\n\t\t\t\t\tcase 'head':\n\t\t\t\t\t\treturn head ?? '';\n\t\t\t\t\tcase 'body':\n\t\t\t\t\t\treturn body ?? '';\n\t\t\t\t\tcase 'endOfBody':\n\t\t\t\t\t\treturn bootstrap != null\n\t\t\t\t\t\t\t? `<script type=\"text/javascript\" nonce=\"#{cspNonce}\">window.bootstrap = ${JSON.stringify(\n\t\t\t\t\t\t\t\t\tbootstrap,\n\t\t\t\t\t\t\t  )};</script>${endOfBody ?? ''}`\n\t\t\t\t\t\t\t: endOfBody ?? '';\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t})\n\t\t\t.replace(/#{(cspSource|cspNonce|root|webroot)}/g, (_substring, token) => {\n\t\t\t\tswitch (token) {\n\t\t\t\t\tcase 'cspSource':\n\t\t\t\t\t\treturn cspSource;\n\t\t\t\t\tcase 'cspNonce':\n\t\t\t\t\t\treturn cspNonce;\n\t\t\t\t\tcase 'root':\n\t\t\t\t\t\treturn root;\n\t\t\t\t\tcase 'webroot':\n\t\t\t\t\t\treturn webRoot;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn html;\n\t}\n\n\tprotected notify<T extends IpcNotificationType<any>>(type: T, params: IpcMessageParams<T>): Thenable<boolean> {\n\t\treturn this.postMessage({ id: nextIpcId(), method: type.method, params: params });\n\t}\n\n\tprivate postMessage(message: IpcMessage) {\n\t\tif (this._view == null) return Promise.resolve(false);\n\n\t\treturn this._view.webview.postMessage(message);\n\t}\n}\n","'use strict';\nimport { commands, Disposable, TextEditor, Uri, window } from 'vscode';\nimport { ShowQuickCommitCommandArgs } from '../../../commands';\nimport { configuration } from '../../../configuration';\nimport { Commands } from '../../../constants';\nimport { Container } from '../../../container';\nimport { PremiumFeatures } from '../../../features';\nimport { RepositoriesChangeEvent } from '../../../git/gitProviderService';\nimport { GitUri } from '../../../git/gitUri';\nimport { RepositoryChange, RepositoryChangeComparisonMode, RepositoryChangeEvent } from '../../../git/models';\nimport { createFromDateDelta } from '../../../system/date';\nimport { debug } from '../../../system/decorators/log';\nimport { debounce, Deferrable } from '../../../system/function';\nimport { filter } from '../../../system/iterable';\nimport { hasVisibleTextEditor, isTextEditor } from '../../../system/utils';\nimport { IpcMessage, onIpc } from '../../../webviews/protocol';\nimport { WebviewViewBase } from '../../../webviews/webviewViewBase';\nimport type { SubscriptionChangeEvent } from '../../subscription/subscriptionService';\nimport {\n\tCommit,\n\tDidChangeStateNotificationType,\n\tOpenDataPointCommandType,\n\tPeriod,\n\tState,\n\tUpdatePeriodCommandType,\n} from './protocol';\n\ninterface Context {\n\turi: Uri | undefined;\n\tperiod: Period | undefined;\n\tetagRepositories: number | undefined;\n\tetagRepository: number | undefined;\n\tetagSubscription: number | undefined;\n}\n\nconst defaultPeriod: Period = '3|M';\n\nexport class TimelineWebviewView extends WebviewViewBase<State> {\n\tprivate _bootstraping = true;\n\t/** The context the webview has */\n\tprivate _context: Context;\n\t/** The context the webview should have */\n\tprivate _pendingContext: Partial<Context> | undefined;\n\n\tconstructor(container: Container) {\n\t\tsuper(container, 'gitlens.views.timeline', 'timeline.html', 'Visual File History');\n\n\t\tthis._context = {\n\t\t\turi: undefined,\n\t\t\tperiod: defaultPeriod,\n\t\t\tetagRepositories: 0,\n\t\t\tetagRepository: 0,\n\t\t\tetagSubscription: 0,\n\t\t};\n\t}\n\n\tprotected override onInitializing(): Disposable[] | undefined {\n\t\tthis._context = {\n\t\t\turi: undefined,\n\t\t\tperiod: defaultPeriod,\n\t\t\tetagRepositories: this.container.git.etag,\n\t\t\tetagRepository: 0,\n\t\t\tetagSubscription: this.container.subscription.etag,\n\t\t};\n\n\t\tthis.updatePendingEditor(window.activeTextEditor);\n\t\tthis._context = { ...this._context, ...this._pendingContext };\n\t\tthis._pendingContext = undefined;\n\n\t\treturn [\n\t\t\tthis.container.subscription.onDidChange(this.onSubscriptionChanged, this),\n\t\t\twindow.onDidChangeActiveTextEditor(this.onActiveEditorChanged, this),\n\t\t\tthis.container.git.onDidChangeRepository(this.onRepositoryChanged, this),\n\t\t\tthis.container.git.onDidChangeRepositories(this.onRepositoriesChanged, this),\n\t\t];\n\t}\n\n\tprotected override async includeBootstrap(): Promise<State> {\n\t\tthis._bootstraping = true;\n\n\t\tthis._context = { ...this._context, ...this._pendingContext };\n\t\tthis._pendingContext = undefined;\n\n\t\treturn this.getState(this._context);\n\t}\n\n\tprotected override registerCommands(): Disposable[] {\n\t\treturn [\n\t\t\tcommands.registerCommand(`${this.id}.refresh`, () => this.refresh(), this),\n\t\t\tcommands.registerCommand(`${this.id}.openInTab`, () => this.openInTab(), this),\n\t\t];\n\t}\n\n\tprotected override onVisibilityChanged(visible: boolean) {\n\t\tif (!visible) return;\n\n\t\t// Since this gets called even the first time the webview is shown, avoid sending an update, because the bootstrap has the data\n\t\tif (this._bootstraping) {\n\t\t\tthis._bootstraping = false;\n\n\t\t\t// If the uri changed since bootstrap still send the update\n\t\t\tif (this._pendingContext == null || !('uri' in this._pendingContext)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Should be immediate, but it causes the bubbles to go missing on the chart, since the update happens while it still rendering\n\t\tthis.updateState();\n\t}\n\n\tprotected override onMessageReceived(e: IpcMessage) {\n\t\tswitch (e.method) {\n\t\t\tcase OpenDataPointCommandType.method:\n\t\t\t\tonIpc(OpenDataPointCommandType, e, params => {\n\t\t\t\t\tif (params.data == null || !params.data.selected || this._context.uri == null) return;\n\n\t\t\t\t\tconst repository = this.container.git.getRepository(this._context.uri);\n\t\t\t\t\tif (repository == null) return;\n\n\t\t\t\t\tconst commandArgs: ShowQuickCommitCommandArgs = {\n\t\t\t\t\t\trepoPath: repository.path,\n\t\t\t\t\t\tsha: params.data.id,\n\t\t\t\t\t};\n\n\t\t\t\t\tvoid commands.executeCommand(Commands.ShowQuickCommit, commandArgs);\n\n\t\t\t\t\t// const commandArgs: DiffWithPreviousCommandArgs = {\n\t\t\t\t\t// \tline: 0,\n\t\t\t\t\t// \tshowOptions: {\n\t\t\t\t\t// \t\tpreserveFocus: true,\n\t\t\t\t\t// \t\tpreview: true,\n\t\t\t\t\t// \t\tviewColumn: ViewColumn.Beside,\n\t\t\t\t\t// \t},\n\t\t\t\t\t// };\n\n\t\t\t\t\t// void commands.executeCommand(\n\t\t\t\t\t// \tCommands.DiffWithPrevious,\n\t\t\t\t\t// \tnew GitUri(gitUri, { repoPath: gitUri.repoPath!, sha: params.data.id }),\n\t\t\t\t\t// \tcommandArgs,\n\t\t\t\t\t// );\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase UpdatePeriodCommandType.method:\n\t\t\t\tonIpc(UpdatePeriodCommandType, e, params => {\n\t\t\t\t\tif (this.updatePendingContext({ period: params.period })) {\n\t\t\t\t\t\tthis.updateState(true);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t@debug({ args: false })\n\tprivate onActiveEditorChanged(editor: TextEditor | undefined) {\n\t\tif (!this.updatePendingEditor(editor)) return;\n\n\t\tthis.updateState();\n\t}\n\n\t@debug({ args: false })\n\tprivate onRepositoriesChanged(e: RepositoriesChangeEvent) {\n\t\tconst changed = this.updatePendingUri(this._context.uri);\n\n\t\tif (this.updatePendingContext({ etagRepositories: e.etag }) || changed) {\n\t\t\tthis.updateState();\n\t\t}\n\t}\n\n\t@debug({ args: false })\n\tprivate onRepositoryChanged(e: RepositoryChangeEvent) {\n\t\tif (!e.changed(RepositoryChange.Heads, RepositoryChange.Index, RepositoryChangeComparisonMode.Any)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.updatePendingContext({ etagRepository: e.repository.etag })) {\n\t\t\tthis.updateState();\n\t\t}\n\t}\n\n\t@debug({ args: false })\n\tprivate onSubscriptionChanged(e: SubscriptionChangeEvent) {\n\t\tif (this.updatePendingContext({ etagSubscription: e.etag })) {\n\t\t\tthis.updateState();\n\t\t}\n\t}\n\n\t@debug({ args: false })\n\tprivate async getState(current: Context): Promise<State> {\n\t\tconst access = await this.container.git.access(PremiumFeatures.Timeline);\n\t\tconst dateFormat = this.container.config.defaultDateFormat ?? 'MMMM Do, YYYY h:mma';\n\t\tconst period = current.period ?? defaultPeriod;\n\n\t\tif (!access.allowed) {\n\t\t\tconst dataset = generateRandomTimelineDataset();\n\t\t\treturn {\n\t\t\t\tdataset: dataset.sort((a, b) => b.sort - a.sort),\n\t\t\t\tperiod: period,\n\t\t\t\ttitle: 'src/app/index.ts',\n\t\t\t\turi: Uri.file('src/app/index.ts').toString(),\n\t\t\t\tdateFormat: dateFormat,\n\t\t\t\taccess: access,\n\t\t\t};\n\t\t}\n\n\t\tif (current.uri == null) {\n\t\t\treturn {\n\t\t\t\tperiod: period,\n\t\t\t\ttitle: 'There are no editors open that can provide file history information',\n\t\t\t\tdateFormat: dateFormat,\n\t\t\t\taccess: access,\n\t\t\t};\n\t\t}\n\n\t\tconst gitUri = await GitUri.fromUri(current.uri);\n\t\tconst repoPath = gitUri.repoPath!;\n\t\tconst title = gitUri.relativePath;\n\n\t\tthis.description = gitUri.fileName;\n\n\t\tconst [currentUser, log] = await Promise.all([\n\t\t\tthis.container.git.getCurrentUser(repoPath),\n\t\t\tthis.container.git.getLogForFile(repoPath, gitUri.fsPath, {\n\t\t\t\tlimit: 0,\n\t\t\t\tref: gitUri.sha,\n\t\t\t\tsince: this.getPeriodDate(period).toISOString(),\n\t\t\t}),\n\t\t]);\n\n\t\tif (log == null) {\n\t\t\treturn {\n\t\t\t\tdataset: [],\n\t\t\t\tperiod: period,\n\t\t\t\ttitle: 'No commits found for the specified time period',\n\t\t\t\turi: current.uri.toString(),\n\t\t\t\tdateFormat: dateFormat,\n\t\t\t\taccess: access,\n\t\t\t};\n\t\t}\n\n\t\tlet queryRequiredCommits = [\n\t\t\t...filter(log.commits.values(), c => c.file?.stats == null && c.stats?.changedFiles !== 1),\n\t\t];\n\n\t\tif (queryRequiredCommits.length !== 0) {\n\t\t\tconst limit = configuration.get('visualHistory.queryLimit') ?? 20;\n\n\t\t\tconst repository = this.container.git.getRepository(current.uri);\n\t\t\tconst name = repository?.provider.name;\n\n\t\t\tif (queryRequiredCommits.length > limit) {\n\t\t\t\tvoid window.showWarningMessage(\n\t\t\t\t\t`Unable able to show more than the first ${limit} commits for the specified time period because of ${\n\t\t\t\t\t\tname ? `${name} ` : ''\n\t\t\t\t\t}rate limits.`,\n\t\t\t\t);\n\t\t\t\tqueryRequiredCommits = queryRequiredCommits.slice(0, 20);\n\t\t\t}\n\n\t\t\tvoid (await Promise.allSettled(queryRequiredCommits.map(c => c.ensureFullDetails())));\n\t\t}\n\n\t\tconst name = currentUser?.name ? `${currentUser.name} (you)` : 'You';\n\n\t\tconst dataset: Commit[] = [];\n\t\tfor (const commit of log.commits.values()) {\n\t\t\tconst stats = commit.file?.stats ?? (commit.stats?.changedFiles === 1 ? commit.stats : undefined);\n\t\t\tdataset.push({\n\t\t\t\tauthor: commit.author.name === 'You' ? name : commit.author.name,\n\t\t\t\tadditions: stats?.additions,\n\t\t\t\tdeletions: stats?.deletions,\n\t\t\t\tcommit: commit.sha,\n\t\t\t\tdate: commit.date.toISOString(),\n\t\t\t\tmessage: commit.message ?? commit.summary,\n\t\t\t\tsort: commit.date.getTime(),\n\t\t\t});\n\t\t}\n\n\t\tdataset.sort((a, b) => b.sort - a.sort);\n\n\t\treturn {\n\t\t\tdataset: dataset,\n\t\t\tperiod: period,\n\t\t\ttitle: title,\n\t\t\turi: current.uri.toString(),\n\t\t\tdateFormat: dateFormat,\n\t\t\taccess: access,\n\t\t};\n\t}\n\n\tprivate getPeriodDate(period: Period): Date {\n\t\tconst [number, unit] = period.split('|');\n\n\t\tswitch (unit) {\n\t\t\tcase 'D':\n\t\t\t\treturn createFromDateDelta(new Date(), { days: -parseInt(number, 10) });\n\t\t\tcase 'M':\n\t\t\t\treturn createFromDateDelta(new Date(), { months: -parseInt(number, 10) });\n\t\t\tcase 'Y':\n\t\t\t\treturn createFromDateDelta(new Date(), { years: -parseInt(number, 10) });\n\t\t\tdefault:\n\t\t\t\treturn createFromDateDelta(new Date(), { months: -3 });\n\t\t}\n\t}\n\n\tprivate openInTab() {\n\t\tconst uri = this._context.uri;\n\t\tif (uri == null) return;\n\n\t\tvoid commands.executeCommand(Commands.ShowTimelinePage, uri);\n\t}\n\n\tprivate updatePendingContext(context: Partial<Context>): boolean {\n\t\tlet changed = false;\n\t\tfor (const [key, value] of Object.entries(context)) {\n\t\t\tconst current = (this._context as unknown as Record<string, unknown>)[key];\n\t\t\tif (\n\t\t\t\tcurrent === value ||\n\t\t\t\t((current instanceof Uri || value instanceof Uri) && (current as any)?.toString() === value?.toString())\n\t\t\t) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this._pendingContext == null) {\n\t\t\t\tthis._pendingContext = {};\n\t\t\t}\n\n\t\t\t(this._pendingContext as Record<string, unknown>)[key] = value;\n\t\t\tchanged = true;\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\tprivate updatePendingEditor(editor: TextEditor | undefined): boolean {\n\t\tif (editor == null && hasVisibleTextEditor()) return false;\n\t\tif (editor != null && !isTextEditor(editor)) return false;\n\n\t\treturn this.updatePendingUri(editor?.document.uri);\n\t}\n\n\tprivate updatePendingUri(uri: Uri | undefined): boolean {\n\t\tlet etag;\n\t\tif (uri != null) {\n\t\t\tconst repository = this.container.git.getRepository(uri);\n\t\t\tetag = repository?.etag ?? 0;\n\t\t} else {\n\t\t\tetag = 0;\n\t\t}\n\n\t\treturn this.updatePendingContext({ uri: uri, etagRepository: etag });\n\t}\n\n\tprivate _notifyDidChangeStateDebounced: Deferrable<() => void> | undefined = undefined;\n\n\t@debug()\n\tprivate updateState(immediate: boolean = false) {\n\t\tif (!this.isReady || !this.visible) return;\n\n\t\tthis.updatePendingEditor(window.activeTextEditor);\n\n\t\tif (immediate) {\n\t\t\tvoid this.notifyDidChangeState();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._notifyDidChangeStateDebounced == null) {\n\t\t\tthis._notifyDidChangeStateDebounced = debounce(this.notifyDidChangeState.bind(this), 500);\n\t\t}\n\n\t\tthis._notifyDidChangeStateDebounced();\n\t}\n\n\t@debug()\n\tprivate async notifyDidChangeState() {\n\t\tif (!this.isReady || !this.visible) return false;\n\n\t\tthis._notifyDidChangeStateDebounced?.cancel();\n\t\tif (this._pendingContext == null) return false;\n\n\t\tconst context = { ...this._context, ...this._pendingContext };\n\n\t\treturn window.withProgress({ location: { viewId: this.id } }, async () => {\n\t\t\tconst success = await this.notify(DidChangeStateNotificationType, {\n\t\t\t\tstate: await this.getState(context),\n\t\t\t});\n\t\t\tif (success) {\n\t\t\t\tthis._context = context;\n\t\t\t\tthis._pendingContext = undefined;\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function generateRandomTimelineDataset(): Commit[] {\n\tconst dataset: Commit[] = [];\n\tconst authors = ['Eric Amodio', 'Justin Roberts', 'Ada Lovelace', 'Grace Hopper'];\n\n\tconst count = 10;\n\tfor (let i = 0; i < count; i++) {\n\t\t// Generate a random date between now and 3 months ago\n\t\tconst date = new Date(new Date().getTime() - Math.floor(Math.random() * (3 * 30 * 24 * 60 * 60 * 1000)));\n\n\t\tdataset.push({\n\t\t\tcommit: String(i),\n\t\t\tauthor: authors[Math.floor(Math.random() * authors.length)],\n\t\t\tdate: date.toISOString(),\n\t\t\tmessage: '',\n\t\t\t// Generate random additions/deletions between 1 and 20, but ensure we have a tiny and large commit\n\t\t\tadditions: i === 0 ? 2 : i === count - 1 ? 50 : Math.floor(Math.random() * 20) + 1,\n\t\t\tdeletions: i === 0 ? 1 : i === count - 1 ? 25 : Math.floor(Math.random() * 20) + 1,\n\t\t\tsort: date.getTime(),\n\t\t});\n\t}\n\n\treturn dataset;\n}\n","'use strict';\nimport { commands, Disposable, TextEditor, Uri, window } from 'vscode';\nimport { ShowQuickCommitCommandArgs } from '../../../commands';\nimport { configuration } from '../../../configuration';\nimport { Commands, ContextKeys } from '../../../constants';\nimport type { Container } from '../../../container';\nimport { setContext } from '../../../context';\nimport { PremiumFeatures } from '../../../features';\nimport { GitUri } from '../../../git/gitUri';\nimport { RepositoryChange, RepositoryChangeComparisonMode, RepositoryChangeEvent } from '../../../git/models';\nimport { createFromDateDelta } from '../../../system/date';\nimport { debug } from '../../../system/decorators/log';\nimport { debounce, Deferrable } from '../../../system/function';\nimport { filter } from '../../../system/iterable';\nimport { hasVisibleTextEditor, isTextEditor } from '../../../system/utils';\nimport { IpcMessage, onIpc } from '../../../webviews/protocol';\nimport { WebviewBase } from '../../../webviews/webviewBase';\nimport { SubscriptionChangeEvent } from '../../subscription/subscriptionService';\nimport {\n\tCommit,\n\tDidChangeStateNotificationType,\n\tOpenDataPointCommandType,\n\tPeriod,\n\tState,\n\tUpdatePeriodCommandType,\n} from './protocol';\nimport { generateRandomTimelineDataset } from './timelineWebviewView';\n\ninterface Context {\n\turi: Uri | undefined;\n\tperiod: Period | undefined;\n\tetagRepository: number | undefined;\n\tetagSubscription: number | undefined;\n}\n\nconst defaultPeriod: Period = '3|M';\n\nexport class TimelineWebview extends WebviewBase<State> {\n\tprivate _bootstraping = true;\n\t/** The context the webview has */\n\tprivate _context: Context;\n\t/** The context the webview should have */\n\tprivate _pendingContext: Partial<Context> | undefined;\n\tprivate _originalTitle: string;\n\n\tconstructor(container: Container) {\n\t\tsuper(\n\t\t\tcontainer,\n\t\t\t'gitlens.timeline',\n\t\t\t'timeline.html',\n\t\t\t'images/gitlens-icon.png',\n\t\t\t'Visual File History',\n\t\t\tCommands.ShowTimelinePage,\n\t\t);\n\t\tthis._originalTitle = this.title;\n\t\tthis._context = {\n\t\t\turi: undefined,\n\t\t\tperiod: defaultPeriod,\n\t\t\tetagRepository: 0,\n\t\t\tetagSubscription: 0,\n\t\t};\n\t}\n\n\tprotected override onInitializing(): Disposable[] | undefined {\n\t\tthis._context = {\n\t\t\turi: undefined,\n\t\t\tperiod: defaultPeriod,\n\t\t\tetagRepository: 0,\n\t\t\tetagSubscription: this.container.subscription.etag,\n\t\t};\n\n\t\tthis.updatePendingEditor(window.activeTextEditor);\n\t\tthis._context = { ...this._context, ...this._pendingContext };\n\t\tthis._pendingContext = undefined;\n\n\t\treturn [\n\t\t\tthis.container.subscription.onDidChange(this.onSubscriptionChanged, this),\n\t\t\tthis.container.git.onDidChangeRepository(this.onRepositoryChanged, this),\n\t\t];\n\t}\n\n\tprotected override onShowCommand(uri?: Uri): void {\n\t\tif (uri != null) {\n\t\t\tthis.updatePendingUri(uri);\n\t\t} else {\n\t\t\tthis.updatePendingEditor(window.activeTextEditor);\n\t\t}\n\t\tthis._context = { ...this._context, ...this._pendingContext };\n\t\tthis._pendingContext = undefined;\n\n\t\tsuper.onShowCommand();\n\t}\n\n\tprotected override async includeBootstrap(): Promise<State> {\n\t\tthis._bootstraping = true;\n\n\t\tthis._context = { ...this._context, ...this._pendingContext };\n\t\tthis._pendingContext = undefined;\n\n\t\treturn this.getState(this._context);\n\t}\n\n\tprotected override registerCommands(): Disposable[] {\n\t\treturn [commands.registerCommand(Commands.RefreshTimelinePage, () => this.refresh())];\n\t}\n\n\tprotected override onFocusChanged(focused: boolean): void {\n\t\tif (focused) {\n\t\t\t// If we are becoming focused, delay it a bit to give the UI time to update\n\t\t\tsetTimeout(() => void setContext(ContextKeys.TimelinePageFocused, focused), 0);\n\t\t\treturn;\n\t\t}\n\n\t\tvoid setContext(ContextKeys.TimelinePageFocused, focused);\n\t}\n\n\tprotected override onVisibilityChanged(visible: boolean) {\n\t\tif (!visible) return;\n\n\t\t// Since this gets called even the first time the webview is shown, avoid sending an update, because the bootstrap has the data\n\t\tif (this._bootstraping) {\n\t\t\tthis._bootstraping = false;\n\n\t\t\t// If the uri changed since bootstrap still send the update\n\t\t\tif (this._pendingContext == null || !('uri' in this._pendingContext)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Should be immediate, but it causes the bubbles to go missing on the chart, since the update happens while it still rendering\n\t\tthis.updateState();\n\t}\n\n\tprotected override onMessageReceived(e: IpcMessage) {\n\t\tswitch (e.method) {\n\t\t\tcase OpenDataPointCommandType.method:\n\t\t\t\tonIpc(OpenDataPointCommandType, e, params => {\n\t\t\t\t\tif (params.data == null || !params.data.selected || this._context.uri == null) return;\n\n\t\t\t\t\tconst repository = this.container.git.getRepository(this._context.uri);\n\t\t\t\t\tif (repository == null) return;\n\n\t\t\t\t\tconst commandArgs: ShowQuickCommitCommandArgs = {\n\t\t\t\t\t\trepoPath: repository.path,\n\t\t\t\t\t\tsha: params.data.id,\n\t\t\t\t\t};\n\n\t\t\t\t\tvoid commands.executeCommand(Commands.ShowQuickCommit, commandArgs);\n\n\t\t\t\t\t// const commandArgs: DiffWithPreviousCommandArgs = {\n\t\t\t\t\t// \tline: 0,\n\t\t\t\t\t// \tshowOptions: {\n\t\t\t\t\t// \t\tpreserveFocus: true,\n\t\t\t\t\t// \t\tpreview: true,\n\t\t\t\t\t// \t\tviewColumn: ViewColumn.Beside,\n\t\t\t\t\t// \t},\n\t\t\t\t\t// };\n\n\t\t\t\t\t// void commands.executeCommand(\n\t\t\t\t\t// \tCommands.DiffWithPrevious,\n\t\t\t\t\t// \tnew GitUri(gitUri, { repoPath: gitUri.repoPath!, sha: params.data.id }),\n\t\t\t\t\t// \tcommandArgs,\n\t\t\t\t\t// );\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase UpdatePeriodCommandType.method:\n\t\t\t\tonIpc(UpdatePeriodCommandType, e, params => {\n\t\t\t\t\tif (this.updatePendingContext({ period: params.period })) {\n\t\t\t\t\t\tthis.updateState(true);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t@debug({ args: false })\n\tprivate onRepositoryChanged(e: RepositoryChangeEvent) {\n\t\tif (!e.changed(RepositoryChange.Heads, RepositoryChange.Index, RepositoryChangeComparisonMode.Any)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.updatePendingContext({ etagRepository: e.repository.etag })) {\n\t\t\tthis.updateState();\n\t\t}\n\t}\n\n\t@debug({ args: false })\n\tprivate onSubscriptionChanged(e: SubscriptionChangeEvent) {\n\t\tif (this.updatePendingContext({ etagSubscription: e.etag })) {\n\t\t\tthis.updateState();\n\t\t}\n\t}\n\n\t@debug({ args: false })\n\tprivate async getState(current: Context): Promise<State> {\n\t\tconst access = await this.container.git.access(PremiumFeatures.Timeline);\n\t\tconst dateFormat = this.container.config.defaultDateFormat ?? 'MMMM Do, YYYY h:mma';\n\t\tconst period = current.period ?? defaultPeriod;\n\n\t\tif (!access.allowed) {\n\t\t\tconst dataset = generateRandomTimelineDataset();\n\t\t\treturn {\n\t\t\t\tdataset: dataset.sort((a, b) => b.sort - a.sort),\n\t\t\t\tperiod: period,\n\t\t\t\ttitle: 'src/app/index.ts',\n\t\t\t\turi: Uri.file('src/app/index.ts').toString(),\n\t\t\t\tdateFormat: dateFormat,\n\t\t\t\taccess: access,\n\t\t\t};\n\t\t}\n\n\t\tif (current.uri == null) {\n\t\t\treturn {\n\t\t\t\tperiod: period,\n\t\t\t\ttitle: 'There are no editors open that can provide file history information',\n\t\t\t\tdateFormat: dateFormat,\n\t\t\t\taccess: access,\n\t\t\t};\n\t\t}\n\n\t\tconst gitUri = await GitUri.fromUri(current.uri);\n\t\tconst repoPath = gitUri.repoPath!;\n\t\tconst title = gitUri.relativePath;\n\n\t\tthis.title = `${this._originalTitle}: ${gitUri.fileName}`;\n\n\t\tconst [currentUser, log] = await Promise.all([\n\t\t\tthis.container.git.getCurrentUser(repoPath),\n\t\t\tthis.container.git.getLogForFile(repoPath, gitUri.fsPath, {\n\t\t\t\tlimit: 0,\n\t\t\t\tref: gitUri.sha,\n\t\t\t\tsince: this.getPeriodDate(period).toISOString(),\n\t\t\t}),\n\t\t]);\n\n\t\tif (log == null) {\n\t\t\treturn {\n\t\t\t\tdataset: [],\n\t\t\t\tperiod: period,\n\t\t\t\ttitle: 'No commits found for the specified time period',\n\t\t\t\turi: current.uri.toString(),\n\t\t\t\tdateFormat: dateFormat,\n\t\t\t\taccess: access,\n\t\t\t};\n\t\t}\n\n\t\tlet queryRequiredCommits = [\n\t\t\t...filter(log.commits.values(), c => c.file?.stats == null && c.stats?.changedFiles !== 1),\n\t\t];\n\n\t\tif (queryRequiredCommits.length !== 0) {\n\t\t\tconst limit = configuration.get('visualHistory.queryLimit') ?? 20;\n\n\t\t\tconst repository = this.container.git.getRepository(current.uri);\n\t\t\tconst name = repository?.provider.name;\n\n\t\t\tif (queryRequiredCommits.length > limit) {\n\t\t\t\tvoid window.showWarningMessage(\n\t\t\t\t\t`Unable able to show more than the first ${limit} commits for the specified time period because of ${\n\t\t\t\t\t\tname ? `${name} ` : ''\n\t\t\t\t\t}rate limits.`,\n\t\t\t\t);\n\t\t\t\tqueryRequiredCommits = queryRequiredCommits.slice(0, 20);\n\t\t\t}\n\n\t\t\tvoid (await Promise.allSettled(queryRequiredCommits.map(c => c.ensureFullDetails())));\n\t\t}\n\n\t\tconst name = currentUser?.name ? `${currentUser.name} (you)` : 'You';\n\n\t\tconst dataset: Commit[] = [];\n\t\tfor (const commit of log.commits.values()) {\n\t\t\tconst stats = commit.file?.stats ?? (commit.stats?.changedFiles === 1 ? commit.stats : undefined);\n\t\t\tdataset.push({\n\t\t\t\tauthor: commit.author.name === 'You' ? name : commit.author.name,\n\t\t\t\tadditions: stats?.additions,\n\t\t\t\tdeletions: stats?.deletions,\n\t\t\t\tcommit: commit.sha,\n\t\t\t\tdate: commit.date.toISOString(),\n\t\t\t\tmessage: commit.message ?? commit.summary,\n\t\t\t\tsort: commit.date.getTime(),\n\t\t\t});\n\t\t}\n\n\t\tdataset.sort((a, b) => b.sort - a.sort);\n\n\t\treturn {\n\t\t\tdataset: dataset,\n\t\t\tperiod: period,\n\t\t\ttitle: title,\n\t\t\turi: current.uri.toString(),\n\t\t\tdateFormat: dateFormat,\n\t\t\taccess: access,\n\t\t};\n\t}\n\n\tprivate getPeriodDate(period: Period): Date {\n\t\tconst [number, unit] = period.split('|');\n\n\t\tswitch (unit) {\n\t\t\tcase 'D':\n\t\t\t\treturn createFromDateDelta(new Date(), { days: -parseInt(number, 10) });\n\t\t\tcase 'M':\n\t\t\t\treturn createFromDateDelta(new Date(), { months: -parseInt(number, 10) });\n\t\t\tcase 'Y':\n\t\t\t\treturn createFromDateDelta(new Date(), { years: -parseInt(number, 10) });\n\t\t\tdefault:\n\t\t\t\treturn createFromDateDelta(new Date(), { months: -3 });\n\t\t}\n\t}\n\n\tprivate updatePendingContext(context: Partial<Context>): boolean {\n\t\tlet changed = false;\n\t\tfor (const [key, value] of Object.entries(context)) {\n\t\t\tconst current = (this._context as unknown as Record<string, unknown>)[key];\n\t\t\tif (\n\t\t\t\tcurrent === value ||\n\t\t\t\t((current instanceof Uri || value instanceof Uri) && (current as any)?.toString() === value?.toString())\n\t\t\t) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this._pendingContext == null) {\n\t\t\t\tthis._pendingContext = {};\n\t\t\t}\n\n\t\t\t(this._pendingContext as Record<string, unknown>)[key] = value;\n\t\t\tchanged = true;\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\tprivate updatePendingEditor(editor: TextEditor | undefined): boolean {\n\t\tif (editor == null && hasVisibleTextEditor()) return false;\n\t\tif (editor != null && !isTextEditor(editor)) return false;\n\n\t\treturn this.updatePendingUri(editor?.document.uri);\n\t}\n\n\tprivate updatePendingUri(uri: Uri | undefined): boolean {\n\t\tlet etag;\n\t\tif (uri != null) {\n\t\t\tconst repository = this.container.git.getRepository(uri);\n\t\t\tetag = repository?.etag ?? 0;\n\t\t} else {\n\t\t\tetag = 0;\n\t\t}\n\n\t\treturn this.updatePendingContext({ uri: uri, etagRepository: etag });\n\t}\n\n\tprivate _notifyDidChangeStateDebounced: Deferrable<() => void> | undefined = undefined;\n\n\t@debug()\n\tprivate updateState(immediate: boolean = false) {\n\t\tif (!this.isReady || !this.visible) return;\n\n\t\tif (immediate) {\n\t\t\tvoid this.notifyDidChangeState();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._notifyDidChangeStateDebounced == null) {\n\t\t\tthis._notifyDidChangeStateDebounced = debounce(this.notifyDidChangeState.bind(this), 500);\n\t\t}\n\n\t\tthis._notifyDidChangeStateDebounced();\n\t}\n\n\t@debug()\n\tprivate async notifyDidChangeState() {\n\t\tif (!this.isReady || !this.visible) return false;\n\n\t\tthis._notifyDidChangeStateDebounced?.cancel();\n\t\tif (this._pendingContext == null) return false;\n\n\t\tconst context = { ...this._context, ...this._pendingContext };\n\n\t\treturn window.withProgress({ location: { viewId: this.id } }, async () => {\n\t\t\tconst success = await this.notify(DidChangeStateNotificationType, {\n\t\t\t\tstate: await this.getState(context),\n\t\t\t});\n\t\t\tif (success) {\n\t\t\t\tthis._context = context;\n\t\t\t\tthis._pendingContext = undefined;\n\t\t\t}\n\t\t});\n\t}\n}\n","import {\n\tCancellationToken,\n\tCancellationTokenSource,\n\tConfigurationChangeEvent,\n\tDisposable,\n\tMarkdownString,\n\tStatusBarAlignment,\n\tStatusBarItem,\n\tTextEditor,\n\tUri,\n\twindow,\n} from 'vscode';\nimport type { ToggleFileChangesAnnotationCommandArgs } from '../commands/toggleFileAnnotations';\nimport { configuration, FileAnnotationType, StatusBarCommand } from '../configuration';\nimport { Commands, GlyphChars } from '../constants';\nimport { Container } from '../container';\nimport { CommitFormatter } from '../git/formatters';\nimport { GitCommit, PullRequest } from '../git/models';\nimport { Hovers } from '../hovers/hovers';\nimport { LogCorrelationContext, Logger } from '../logger';\nimport { asCommand } from '../system/command';\nimport { debug } from '../system/decorators/log';\nimport { once } from '../system/event';\nimport { PromiseCancelledError } from '../system/promise';\nimport { isTextEditor } from '../system/utils';\nimport { LinesChangeEvent } from '../trackers/gitLineTracker';\n\nexport class StatusBarController implements Disposable {\n\tprivate _pullRequestCancellation: CancellationTokenSource | undefined;\n\tprivate _tooltipCancellation: CancellationTokenSource | undefined;\n\tprivate _tooltipDelayTimer: ReturnType<typeof setTimeout> | undefined;\n\n\tprivate readonly _disposable: Disposable;\n\tprivate _statusBarBlame: StatusBarItem | undefined;\n\tprivate _statusBarMode: StatusBarItem | undefined;\n\n\tconstructor(private readonly container: Container) {\n\t\tthis._disposable = Disposable.from(\n\t\t\tonce(container.onReady)(this.onReady, this),\n\t\t\tconfiguration.onDidChange(this.onConfigurationChanged, this),\n\t\t);\n\t}\n\n\tdispose() {\n\t\tthis.clearBlame();\n\n\t\tthis._statusBarBlame?.dispose();\n\t\tthis._statusBarMode?.dispose();\n\n\t\tthis.container.lineTracker.unsubscribe(this);\n\t\tthis._disposable.dispose();\n\t}\n\n\tprivate onReady(): void {\n\t\tthis.onConfigurationChanged();\n\t}\n\n\tprivate onConfigurationChanged(e?: ConfigurationChangeEvent) {\n\t\tif (configuration.changed(e, 'mode')) {\n\t\t\tconst mode =\n\t\t\t\tthis.container.config.mode.active && this.container.config.mode.statusBar.enabled\n\t\t\t\t\t? this.container.config.modes?.[this.container.config.mode.active]\n\t\t\t\t\t: undefined;\n\t\t\tif (mode?.statusBarItemName) {\n\t\t\t\tconst alignment =\n\t\t\t\t\tthis.container.config.mode.statusBar.alignment !== 'left'\n\t\t\t\t\t\t? StatusBarAlignment.Right\n\t\t\t\t\t\t: StatusBarAlignment.Left;\n\n\t\t\t\tif (configuration.changed(e, 'mode.statusBar.alignment')) {\n\t\t\t\t\tif (this._statusBarMode?.alignment !== alignment) {\n\t\t\t\t\t\tthis._statusBarMode?.dispose();\n\t\t\t\t\t\tthis._statusBarMode = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._statusBarMode =\n\t\t\t\t\tthis._statusBarMode ??\n\t\t\t\t\twindow.createStatusBarItem(\n\t\t\t\t\t\t'gitlens.mode',\n\t\t\t\t\t\talignment,\n\t\t\t\t\t\talignment === StatusBarAlignment.Right ? 999 : 1,\n\t\t\t\t\t);\n\t\t\t\tthis._statusBarMode.name = 'GitLens Modes';\n\t\t\t\tthis._statusBarMode.command = Commands.SwitchMode;\n\t\t\t\tthis._statusBarMode.text = mode.statusBarItemName;\n\t\t\t\tthis._statusBarMode.tooltip = new MarkdownString(\n\t\t\t\t\t`**${mode.statusBarItemName}** ${GlyphChars.Dash} ${mode.description}\\n\\n---\\n\\nClick to Switch GitLens Mode`,\n\t\t\t\t\ttrue,\n\t\t\t\t);\n\t\t\t\tthis._statusBarMode.show();\n\t\t\t} else {\n\t\t\t\tthis._statusBarMode?.dispose();\n\t\t\t\tthis._statusBarMode = undefined;\n\t\t\t}\n\t\t}\n\n\t\tif (!configuration.changed(e, 'statusBar')) return;\n\n\t\tif (this.container.config.statusBar.enabled) {\n\t\t\tconst alignment =\n\t\t\t\tthis.container.config.statusBar.alignment !== 'left'\n\t\t\t\t\t? StatusBarAlignment.Right\n\t\t\t\t\t: StatusBarAlignment.Left;\n\n\t\t\tif (configuration.changed(e, 'statusBar.alignment')) {\n\t\t\t\tif (this._statusBarBlame?.alignment !== alignment) {\n\t\t\t\t\tthis._statusBarBlame?.dispose();\n\t\t\t\t\tthis._statusBarBlame = undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._statusBarBlame =\n\t\t\t\tthis._statusBarBlame ??\n\t\t\t\twindow.createStatusBarItem(\n\t\t\t\t\t'gitlens.blame',\n\t\t\t\t\talignment,\n\t\t\t\t\talignment === StatusBarAlignment.Right ? 1000 : 0,\n\t\t\t\t);\n\t\t\tthis._statusBarBlame.name = 'GitLens Current Line Blame';\n\t\t\tthis._statusBarBlame.command = this.container.config.statusBar.command;\n\n\t\t\tif (configuration.changed(e, 'statusBar.enabled')) {\n\t\t\t\tthis.container.lineTracker.subscribe(\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.container.lineTracker.onDidChangeActiveLines(this.onActiveLinesChanged, this),\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (configuration.changed(e, 'statusBar.enabled')) {\n\t\t\tthis.container.lineTracker.unsubscribe(this);\n\n\t\t\tthis._statusBarBlame?.dispose();\n\t\t\tthis._statusBarBlame = undefined;\n\t\t}\n\t}\n\n\t@debug<StatusBarController['onActiveLinesChanged']>({\n\t\targs: {\n\t\t\t0: e =>\n\t\t\t\t`editor=${e.editor?.document.uri.toString(true)}, selections=${e.selections\n\t\t\t\t\t?.map(s => `[${s.anchor}-${s.active}]`)\n\t\t\t\t\t.join(',')}, pending=${Boolean(e.pending)}, reason=${e.reason}`,\n\t\t},\n\t})\n\tprivate onActiveLinesChanged(e: LinesChangeEvent) {\n\t\t// If we need to reduceFlicker, don't clear if only the selected lines changed\n\t\tlet clear = !(\n\t\t\tthis.container.config.statusBar.reduceFlicker &&\n\t\t\te.reason === 'selection' &&\n\t\t\t(e.pending || e.selections != null)\n\t\t);\n\t\tif (!e.pending && e.selections != null) {\n\t\t\tconst state = this.container.lineTracker.getState(e.selections[0].active);\n\t\t\tif (state?.commit != null) {\n\t\t\t\tvoid this.updateBlame(e.editor!, state.commit);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tclear = true;\n\t\t}\n\n\t\tif (clear) {\n\t\t\tthis.clearBlame();\n\t\t} else if (this._statusBarBlame != null) {\n\t\t\tthis._statusBarBlame.text = this._statusBarBlame.text.replace('$(git-commit)', '$(loading~spin)');\n\t\t}\n\t}\n\n\tclearBlame() {\n\t\tthis._pullRequestCancellation?.cancel();\n\t\tthis._tooltipCancellation?.cancel();\n\t\tthis._statusBarBlame?.hide();\n\t}\n\n\t@debug({ args: false })\n\tprivate async updateBlame(editor: TextEditor, commit: GitCommit, options?: { pr?: PullRequest | null }) {\n\t\tconst cfg = this.container.config.statusBar;\n\t\tif (!cfg.enabled || this._statusBarBlame == null || !isTextEditor(editor)) return;\n\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst showPullRequests =\n\t\t\tcfg.pullRequests.enabled &&\n\t\t\t(CommitFormatter.has(\n\t\t\t\tcfg.format,\n\t\t\t\t'pullRequest',\n\t\t\t\t'pullRequestAgo',\n\t\t\t\t'pullRequestAgoOrDate',\n\t\t\t\t'pullRequestDate',\n\t\t\t\t'pullRequestState',\n\t\t\t) ||\n\t\t\t\tCommitFormatter.has(\n\t\t\t\t\tcfg.tooltipFormat,\n\t\t\t\t\t'pullRequest',\n\t\t\t\t\t'pullRequestAgo',\n\t\t\t\t\t'pullRequestAgoOrDate',\n\t\t\t\t\t'pullRequestDate',\n\t\t\t\t\t'pullRequestState',\n\t\t\t\t));\n\n\t\t// TODO: Make this configurable?\n\t\tconst timeout = 100;\n\t\tconst [getBranchAndTagTips, pr] = await Promise.all([\n\t\t\tCommitFormatter.has(cfg.format, 'tips') || CommitFormatter.has(cfg.tooltipFormat, 'tips')\n\t\t\t\t? this.container.git.getBranchesAndTagsTipsFn(commit.repoPath)\n\t\t\t\t: undefined,\n\t\t\tshowPullRequests && options?.pr === undefined\n\t\t\t\t? this.getPullRequest(commit, { timeout: timeout })\n\t\t\t\t: options?.pr ?? undefined,\n\t\t]);\n\n\t\tif (pr != null) {\n\t\t\tthis._pullRequestCancellation?.cancel();\n\t\t\tthis._pullRequestCancellation = new CancellationTokenSource();\n\t\t\tvoid this.waitForPendingPullRequest(editor, commit, pr, this._pullRequestCancellation.token, timeout, cc);\n\t\t}\n\n\t\tthis._statusBarBlame.text = `$(git-commit) ${CommitFormatter.fromTemplate(cfg.format, commit, {\n\t\t\tdateFormat: cfg.dateFormat === null ? this.container.config.defaultDateFormat : cfg.dateFormat,\n\t\t\tgetBranchAndTagTips: getBranchAndTagTips,\n\t\t\tmessageTruncateAtNewLine: true,\n\t\t\tpullRequestOrRemote: pr,\n\t\t\tpullRequestPendingMessage: 'PR $(loading~spin)',\n\t\t})}`;\n\n\t\tlet tooltip: string;\n\t\tswitch (cfg.command) {\n\t\t\tcase StatusBarCommand.CopyRemoteCommitUrl:\n\t\t\t\ttooltip = 'Click to Copy Remote Commit Url';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.CopyRemoteFileUrl:\n\t\t\t\tthis._statusBarBlame.command = Commands.CopyRemoteFileUrl;\n\t\t\t\ttooltip = 'Click to Copy Remote File Revision Url';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.DiffWithPrevious:\n\t\t\t\tthis._statusBarBlame.command = Commands.DiffLineWithPrevious;\n\t\t\t\ttooltip = 'Click to Open Line Changes with Previous Revision';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.DiffWithWorking:\n\t\t\t\tthis._statusBarBlame.command = Commands.DiffLineWithWorking;\n\t\t\t\ttooltip = 'Click to Open Line Changes with Working File';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.OpenCommitOnRemote:\n\t\t\t\ttooltip = 'Click to Open Commit on Remote';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.OpenFileOnRemote:\n\t\t\t\ttooltip = 'Click to Open Revision on Remote';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.RevealCommitInView:\n\t\t\t\ttooltip = 'Click to Reveal Commit in the Side Bar';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.ShowCommitsInView:\n\t\t\t\ttooltip = 'Click to Search for Commit';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.ShowQuickCommitDetails:\n\t\t\t\ttooltip = 'Click to Show Commit';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.ShowQuickCommitFileDetails:\n\t\t\t\ttooltip = 'Click to Show Commit (file)';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.ShowQuickCurrentBranchHistory:\n\t\t\t\ttooltip = 'Click to Show Branch History';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.ShowQuickFileHistory:\n\t\t\t\ttooltip = 'Click to Show File History';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.ToggleCodeLens:\n\t\t\t\ttooltip = 'Click to Toggle Git CodeLens';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.ToggleFileBlame:\n\t\t\t\ttooltip = 'Click to Toggle File Blame';\n\t\t\t\tbreak;\n\t\t\tcase StatusBarCommand.ToggleFileChanges: {\n\t\t\t\tif (commit.file != null) {\n\t\t\t\t\tthis._statusBarBlame.command = asCommand<[Uri, ToggleFileChangesAnnotationCommandArgs]>({\n\t\t\t\t\t\ttitle: 'Toggle File Changes',\n\t\t\t\t\t\tcommand: Commands.ToggleFileChanges,\n\t\t\t\t\t\targuments: [\n\t\t\t\t\t\t\tcommit.file.uri,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: FileAnnotationType.Changes,\n\t\t\t\t\t\t\t\tcontext: { sha: commit.sha, only: false, selection: false },\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\ttooltip = 'Click to Toggle File Changes';\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase StatusBarCommand.ToggleFileChangesOnly: {\n\t\t\t\tif (commit.file != null) {\n\t\t\t\t\tthis._statusBarBlame.command = asCommand<[Uri, ToggleFileChangesAnnotationCommandArgs]>({\n\t\t\t\t\t\ttitle: 'Toggle File Changes',\n\t\t\t\t\t\tcommand: Commands.ToggleFileChanges,\n\t\t\t\t\t\targuments: [\n\t\t\t\t\t\t\tcommit.file.uri,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: FileAnnotationType.Changes,\n\t\t\t\t\t\t\t\tcontext: { sha: commit.sha, only: true, selection: false },\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\ttooltip = 'Click to Toggle File Changes';\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase StatusBarCommand.ToggleFileHeatmap:\n\t\t\t\ttooltip = 'Click to Toggle File Heatmap';\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis._statusBarBlame.tooltip = tooltip;\n\n\t\tif (this._tooltipDelayTimer != null) {\n\t\t\tclearTimeout(this._tooltipDelayTimer);\n\t\t}\n\t\tthis._tooltipCancellation?.cancel();\n\n\t\tthis._tooltipDelayTimer = setTimeout(() => {\n\t\t\tthis._tooltipDelayTimer = undefined;\n\t\t\tthis._tooltipCancellation = new CancellationTokenSource();\n\n\t\t\tvoid this.updateCommitTooltip(\n\t\t\t\tthis._statusBarBlame!,\n\t\t\t\tcommit,\n\t\t\t\ttooltip,\n\t\t\t\tgetBranchAndTagTips,\n\t\t\t\t{\n\t\t\t\t\tenabled: showPullRequests || pr != null,\n\t\t\t\t\tpr: pr,\n\t\t\t\t},\n\t\t\t\tthis._tooltipCancellation.token,\n\t\t\t);\n\t\t}, 500);\n\n\t\tthis._statusBarBlame.show();\n\t}\n\n\tprivate async getPullRequest(\n\t\tcommit: GitCommit,\n\t\t{ timeout }: { timeout?: number } = {},\n\t): Promise<PullRequest | PromiseCancelledError<Promise<PullRequest | undefined>> | undefined> {\n\t\tconst remote = await this.container.git.getRichRemoteProvider(commit.repoPath);\n\t\tif (remote?.provider == null) return undefined;\n\n\t\tconst { provider } = remote;\n\t\ttry {\n\t\t\treturn await this.container.git.getPullRequestForCommit(commit.ref, provider, { timeout: timeout });\n\t\t} catch (ex) {\n\t\t\treturn ex instanceof PromiseCancelledError ? ex : undefined;\n\t\t}\n\t}\n\n\tprivate async updateCommitTooltip(\n\t\tstatusBarItem: StatusBarItem,\n\t\tcommit: GitCommit,\n\t\tactionTooltip: string,\n\t\tgetBranchAndTagTips:\n\t\t\t| ((\n\t\t\t\t\tsha: string,\n\t\t\t\t\toptions?: { compact?: boolean | undefined; icons?: boolean | undefined } | undefined,\n\t\t\t  ) => string | undefined)\n\t\t\t| undefined,\n\t\tpullRequests: {\n\t\t\tenabled: boolean;\n\t\t\tpr: PullRequest | PromiseCancelledError<Promise<PullRequest | undefined>> | undefined | undefined;\n\t\t},\n\t\tcancellationToken: CancellationToken,\n\t) {\n\t\tif (cancellationToken.isCancellationRequested) return;\n\n\t\tconst tooltip = await Hovers.detailsMessage(\n\t\t\tcommit,\n\t\t\tcommit.getGitUri(),\n\t\t\tcommit.lines[0].line,\n\t\t\tthis.container.config.statusBar.tooltipFormat,\n\t\t\tthis.container.config.defaultDateFormat,\n\t\t\t{\n\t\t\t\tautolinks: true,\n\t\t\t\tcancellationToken: cancellationToken,\n\t\t\t\tgetBranchAndTagTips: getBranchAndTagTips,\n\t\t\t\tpullRequests: pullRequests,\n\t\t\t},\n\t\t);\n\n\t\tif (cancellationToken.isCancellationRequested) return;\n\n\t\ttooltip.appendMarkdown(`\\n\\n---\\n\\n${actionTooltip}`);\n\t\tstatusBarItem.tooltip = tooltip;\n\t}\n\n\tprivate async waitForPendingPullRequest(\n\t\teditor: TextEditor,\n\t\tcommit: GitCommit,\n\t\tpr: PullRequest | PromiseCancelledError<Promise<PullRequest | undefined>> | undefined,\n\t\tcancellationToken: CancellationToken,\n\t\ttimeout: number,\n\t\tcc: LogCorrelationContext | undefined,\n\t) {\n\t\tif (cancellationToken.isCancellationRequested || !(pr instanceof PromiseCancelledError)) return;\n\n\t\t// If the PR timed out, refresh the status bar once it completes\n\t\tLogger.debug(cc, `${GlyphChars.Dot} pull request query took too long (over ${timeout} ms)`);\n\n\t\tpr = await pr.promise;\n\n\t\tif (cancellationToken.isCancellationRequested) return;\n\n\t\tLogger.debug(cc, `${GlyphChars.Dot} pull request query completed; refreshing...`);\n\n\t\tvoid this.updateBlame(editor, commit, { pr: pr ?? null });\n\t}\n}\n","import { commands, Disposable, TerminalLink, TerminalLinkContext, TerminalLinkProvider, window } from 'vscode';\nimport type {\n\tGitCommandsCommandArgs,\n\tShowQuickBranchHistoryCommandArgs,\n\tShowQuickCommitCommandArgs,\n} from '../commands';\nimport { Commands } from '../constants';\nimport { Container } from '../container';\nimport { PagedResult } from '../git/gitProvider';\nimport { GitBranch, GitReference, GitTag } from '../git/models';\n\nconst commandsRegexShared =\n\t/\\b(g(?:it)?\\b\\s*)\\b(branch|checkout|cherry-pick|fetch|grep|log|merge|pull|push|rebase|reset|revert|show|stash|status|tag)\\b/gi;\n// Since negative lookbehind isn't supported in all browsers, leave out the negative lookbehind condition `(?<!\\.lock)` to ensure the branch name doesn't end with `.lock`\nconst refRegexShared = /\\b((?!\\/)(?!\\S*\\/\\/)(?!\\S*@\\{)(?!@$)(?!\\S*\\\\)[^\\000-\\037\\177 ~^:?*[]+(?<!\\/)(?<!\\.))\\b/gi;\nconst rangeRegex = /^[0-9a-f]{7,40}\\.\\.\\.?[0-9a-f]{7,40}$/;\nconst shaRegex = /^[0-9a-f]{7,40}$/;\n\ninterface GitTerminalLink<T = object> extends TerminalLink {\n\tcommand: {\n\t\tcommand: Commands;\n\t\targs: T;\n\t};\n}\n\nexport class GitTerminalLinkProvider implements Disposable, TerminalLinkProvider<GitTerminalLink> {\n\tprivate disposable: Disposable;\n\n\tconstructor(private readonly container: Container) {\n\t\tthis.disposable = window.registerTerminalLinkProvider(this);\n\t}\n\n\tdispose() {\n\t\tthis.disposable.dispose();\n\t}\n\n\tasync provideTerminalLinks(context: TerminalLinkContext): Promise<GitTerminalLink[]> {\n\t\tif (context.line.trim().length === 0) return [];\n\n\t\tconst repoPath = this.container.git.highlander?.path;\n\t\tif (!repoPath) return [];\n\n\t\tconst links: GitTerminalLink[] = [];\n\n\t\tlet branchResults: PagedResult<GitBranch> | undefined;\n\t\tlet tagResults: PagedResult<GitTag> | undefined;\n\n\t\t// Don't use the shared regex instance directly, because we can be called reentrantly (because of the awaits below)\n\t\tconst refRegex = new RegExp(refRegexShared, refRegexShared.flags);\n\t\tconst commandsRegex = new RegExp(commandsRegexShared, commandsRegexShared.flags);\n\n\t\tlet match;\n\t\tdo {\n\t\t\tmatch = commandsRegex.exec(context.line);\n\t\t\tif (match != null) {\n\t\t\t\tconst [_, git, command] = match;\n\n\t\t\t\tconst link: GitTerminalLink<GitCommandsCommandArgs> = {\n\t\t\t\t\tstartIndex: match.index + git.length,\n\t\t\t\t\tlength: command.length,\n\t\t\t\t\ttooltip: 'Open in Git Command Palette',\n\t\t\t\t\tcommand: {\n\t\t\t\t\t\tcommand: Commands.GitCommands,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tcommand: command as GitCommandsCommandArgs['command'],\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tlinks.push(link);\n\t\t\t}\n\n\t\t\tmatch = refRegex.exec(context.line);\n\t\t\tif (match == null) break;\n\n\t\t\tconst [_, ref] = match;\n\n\t\t\tif (ref.toUpperCase() === 'HEAD') {\n\t\t\t\tconst link: GitTerminalLink<ShowQuickBranchHistoryCommandArgs> = {\n\t\t\t\t\tstartIndex: match.index,\n\t\t\t\t\tlength: ref.length,\n\t\t\t\t\ttooltip: 'Show HEAD',\n\t\t\t\t\tcommand: {\n\t\t\t\t\t\tcommand: Commands.ShowQuickBranchHistory,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tbranch: 'HEAD',\n\t\t\t\t\t\t\trepoPath: repoPath,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tlinks.push(link);\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (branchResults === undefined) {\n\t\t\t\tbranchResults = await this.container.git.getBranches(repoPath);\n\t\t\t\t// TODO@eamodio handle paging\n\t\t\t}\n\n\t\t\tconst branch = branchResults.values.find(r => r.name === ref);\n\t\t\tif (branch != null) {\n\t\t\t\tconst link: GitTerminalLink<ShowQuickBranchHistoryCommandArgs> = {\n\t\t\t\t\tstartIndex: match.index,\n\t\t\t\t\tlength: ref.length,\n\t\t\t\t\ttooltip: 'Show Branch',\n\t\t\t\t\tcommand: {\n\t\t\t\t\t\tcommand: Commands.ShowQuickBranchHistory,\n\t\t\t\t\t\targs: { repoPath: repoPath, branch: branch.name },\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tlinks.push(link);\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (tagResults === undefined) {\n\t\t\t\ttagResults = await this.container.git.getTags(repoPath);\n\t\t\t\t// TODO@eamodio handle paging\n\t\t\t}\n\n\t\t\tconst tag = tagResults.values.find(r => r.name === ref);\n\t\t\tif (tag != null) {\n\t\t\t\tconst link: GitTerminalLink<ShowQuickBranchHistoryCommandArgs> = {\n\t\t\t\t\tstartIndex: match.index,\n\t\t\t\t\tlength: ref.length,\n\t\t\t\t\ttooltip: 'Show Tag',\n\t\t\t\t\tcommand: {\n\t\t\t\t\t\tcommand: Commands.ShowQuickBranchHistory,\n\t\t\t\t\t\targs: { repoPath: repoPath, tag: tag.name },\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tlinks.push(link);\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!shaRegex.test(ref)) {\n\t\t\t\tif (rangeRegex.test(ref)) {\n\t\t\t\t\tconst link: GitTerminalLink<GitCommandsCommandArgs> = {\n\t\t\t\t\t\tstartIndex: match.index,\n\t\t\t\t\t\tlength: ref.length,\n\t\t\t\t\t\ttooltip: 'Show Commits',\n\t\t\t\t\t\tcommand: {\n\t\t\t\t\t\t\tcommand: Commands.GitCommands,\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\tcommand: 'log',\n\t\t\t\t\t\t\t\tstate: {\n\t\t\t\t\t\t\t\t\trepo: repoPath,\n\t\t\t\t\t\t\t\t\treference: GitReference.create(ref, repoPath, { refType: 'revision' }),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t\tlinks.push(link);\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (await this.container.git.validateReference(repoPath, ref)) {\n\t\t\t\tconst link: GitTerminalLink<ShowQuickCommitCommandArgs> = {\n\t\t\t\t\tstartIndex: match.index,\n\t\t\t\t\tlength: ref.length,\n\t\t\t\t\ttooltip: 'Show Commit',\n\t\t\t\t\tcommand: {\n\t\t\t\t\t\tcommand: Commands.ShowQuickCommit,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\trepoPath: repoPath,\n\t\t\t\t\t\t\tsha: ref,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tlinks.push(link);\n\t\t\t}\n\t\t} while (true);\n\n\t\treturn links;\n\t}\n\n\thandleTerminalLink(link: GitTerminalLink): void {\n\t\tvoid commands.executeCommand(link.command.command, link.command.args);\n\t}\n}\n","import { Disposable, Event, EventEmitter, Selection, TextEditor, TextEditorSelectionChangeEvent, window } from 'vscode';\nimport { Logger } from '../logger';\nimport { debug } from '../system/decorators/log';\nimport { debounce, Deferrable } from '../system/function';\nimport { isTextEditor } from '../system/utils';\n\nexport interface LinesChangeEvent {\n\treadonly editor: TextEditor | undefined;\n\treadonly selections: LineSelection[] | undefined;\n\n\treadonly reason: 'editor' | 'selection';\n\treadonly pending?: boolean;\n}\n\nexport interface LineSelection {\n\tanchor: number;\n\tactive: number;\n}\n\nexport class LineTracker<T> implements Disposable {\n\tprivate _onDidChangeActiveLines = new EventEmitter<LinesChangeEvent>();\n\tget onDidChangeActiveLines(): Event<LinesChangeEvent> {\n\t\treturn this._onDidChangeActiveLines.event;\n\t}\n\n\tprotected _disposable: Disposable | undefined;\n\tprivate _editor: TextEditor | undefined;\n\n\tprivate readonly _state = new Map<number, T | undefined>();\n\n\tdispose() {\n\t\tfor (const subscriber of this._subscriptions.keys()) {\n\t\t\tthis.unsubscribe(subscriber);\n\t\t}\n\t}\n\n\tprivate onActiveTextEditorChanged(editor: TextEditor | undefined) {\n\t\tif (editor === this._editor) return;\n\t\tif (editor != null && !isTextEditor(editor)) return;\n\n\t\tthis.reset();\n\t\tthis._editor = editor;\n\t\tthis._selections = LineTracker.toLineSelections(editor?.selections);\n\n\t\tthis.trigger('editor');\n\t}\n\n\tprivate onTextEditorSelectionChanged(e: TextEditorSelectionChangeEvent) {\n\t\t// If this isn't for our cached editor and its not a real editor -- kick out\n\t\tif (this._editor !== e.textEditor && !isTextEditor(e.textEditor)) return;\n\n\t\tconst selections = LineTracker.toLineSelections(e.selections);\n\t\tif (this._editor === e.textEditor && this.includes(selections)) return;\n\n\t\tthis.reset();\n\t\tthis._editor = e.textEditor;\n\t\tthis._selections = selections;\n\n\t\tthis.trigger(this._editor === e.textEditor ? 'selection' : 'editor');\n\t}\n\n\tgetState(line: number): T | undefined {\n\t\treturn this._state.get(line);\n\t}\n\n\tsetState(line: number, state: T | undefined) {\n\t\tthis._state.set(line, state);\n\t}\n\n\tprivate _selections: LineSelection[] | undefined;\n\tget selections(): LineSelection[] | undefined {\n\t\treturn this._selections;\n\t}\n\n\tincludes(selections: LineSelection[]): boolean;\n\tincludes(line: number, options?: { activeOnly: boolean }): boolean;\n\tincludes(lineOrSelections: number | LineSelection[], options?: { activeOnly: boolean }): boolean {\n\t\tif (typeof lineOrSelections !== 'number') {\n\t\t\treturn LineTracker.includes(lineOrSelections, this._selections);\n\t\t}\n\n\t\tif (this._selections == null || this._selections.length === 0) return false;\n\n\t\tconst line = lineOrSelections;\n\t\tconst activeOnly = options?.activeOnly ?? true;\n\n\t\tfor (const selection of this._selections) {\n\t\t\tif (\n\t\t\t\tline === selection.active ||\n\t\t\t\t(!activeOnly &&\n\t\t\t\t\t((selection.anchor >= line && line >= selection.active) ||\n\t\t\t\t\t\t(selection.active >= line && line >= selection.anchor)))\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\trefresh() {\n\t\tthis.trigger('editor');\n\t}\n\n\treset() {\n\t\tthis._state.clear();\n\t}\n\n\tprivate _subscriptions = new Map<unknown, Disposable[]>();\n\n\tsubscribed(subscriber: unknown) {\n\t\treturn this._subscriptions.has(subscriber);\n\t}\n\n\tprotected onStart?(): Disposable | undefined;\n\n\t@debug({ args: false })\n\tsubscribe(subscriber: unknown, subscription: Disposable): Disposable {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst disposable = {\n\t\t\tdispose: () => this.unsubscribe(subscriber),\n\t\t};\n\n\t\tconst first = this._subscriptions.size === 0;\n\n\t\tlet subs = this._subscriptions.get(subscriber);\n\t\tif (subs == null) {\n\t\t\tsubs = [subscription];\n\t\t\tthis._subscriptions.set(subscriber, subs);\n\t\t} else {\n\t\t\tsubs.push(subscription);\n\t\t}\n\n\t\tif (first) {\n\t\t\tLogger.debug(cc, 'Starting line tracker...');\n\n\t\t\tthis._disposable = Disposable.from(\n\t\t\t\twindow.onDidChangeActiveTextEditor(debounce(this.onActiveTextEditorChanged, 0), this),\n\t\t\t\twindow.onDidChangeTextEditorSelection(this.onTextEditorSelectionChanged, this),\n\t\t\t\tthis.onStart?.() ?? { dispose: () => {} },\n\t\t\t);\n\n\t\t\tqueueMicrotask(() => this.onActiveTextEditorChanged(window.activeTextEditor));\n\t\t}\n\n\t\treturn disposable;\n\t}\n\n\t@debug({ args: false })\n\tunsubscribe(subscriber: unknown) {\n\t\tconst subs = this._subscriptions.get(subscriber);\n\t\tif (subs == null) return;\n\n\t\tthis._subscriptions.delete(subscriber);\n\t\tfor (const sub of subs) {\n\t\t\tsub.dispose();\n\t\t}\n\n\t\tif (this._subscriptions.size !== 0) return;\n\n\t\tif (this._linesChangedDebounced != null) {\n\t\t\tthis._linesChangedDebounced.cancel();\n\t\t}\n\n\t\tthis._disposable?.dispose();\n\t\tthis._disposable = undefined;\n\t}\n\n\tprivate _suspended = false;\n\tget suspended() {\n\t\treturn this._suspended;\n\t}\n\n\tprotected onResume?(): void;\n\n\t@debug()\n\tresume(options?: { force?: boolean }) {\n\t\tif (!options?.force && !this._suspended) return;\n\n\t\tthis._suspended = false;\n\t\tvoid this.onResume?.();\n\t\tthis.trigger('editor');\n\t}\n\n\tprotected onSuspend?(): void;\n\n\t@debug()\n\tsuspend(options?: { force?: boolean }) {\n\t\tif (!options?.force && this._suspended) return;\n\n\t\tthis._suspended = true;\n\t\tvoid this.onSuspend?.();\n\t\tthis.trigger('editor');\n\t}\n\n\tprotected fireLinesChanged(e: LinesChangeEvent) {\n\t\tthis._onDidChangeActiveLines.fire(e);\n\t}\n\n\tprotected trigger(reason: 'editor' | 'selection') {\n\t\tthis.onLinesChanged({ editor: this._editor, selections: this.selections, reason: reason });\n\t}\n\n\tprivate _linesChangedDebounced: Deferrable<(e: LinesChangeEvent) => void> | undefined;\n\n\tprivate onLinesChanged(e: LinesChangeEvent) {\n\t\tif (e.selections == null) {\n\t\t\tqueueMicrotask(() => {\n\t\t\t\tif (e.editor !== window.activeTextEditor) return;\n\n\t\t\t\tif (this._linesChangedDebounced != null) {\n\t\t\t\t\tthis._linesChangedDebounced.cancel();\n\t\t\t\t}\n\n\t\t\t\tvoid this.fireLinesChanged(e);\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._linesChangedDebounced == null) {\n\t\t\tthis._linesChangedDebounced = debounce(\n\t\t\t\t(e: LinesChangeEvent) => {\n\t\t\t\t\tif (e.editor !== window.activeTextEditor) return;\n\t\t\t\t\t// Make sure we are still on the same lines\n\t\t\t\t\tif (!LineTracker.includes(e.selections, LineTracker.toLineSelections(e.editor?.selections))) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvoid this.fireLinesChanged(e);\n\t\t\t\t},\n\t\t\t\t250,\n\t\t\t\t{ track: true },\n\t\t\t);\n\t\t}\n\n\t\t// If we have no pending moves, then fire an immediate pending event, and defer the real event\n\t\tif (!this._linesChangedDebounced.pending?.()) {\n\t\t\tvoid this.fireLinesChanged({ ...e, pending: true });\n\t\t}\n\n\t\tthis._linesChangedDebounced(e);\n\t}\n\n\tstatic includes(selections: LineSelection[] | undefined, inSelections: LineSelection[] | undefined): boolean {\n\t\tif (selections == null && inSelections == null) return true;\n\t\tif (selections == null || inSelections == null || selections.length !== inSelections.length) return false;\n\n\t\tlet match;\n\n\t\treturn selections.every((s, i) => {\n\t\t\tmatch = inSelections[i];\n\t\t\treturn s.active === match.active && s.anchor === match.anchor;\n\t\t});\n\t}\n\n\tstatic toLineSelections(selections: readonly Selection[]): LineSelection[];\n\tstatic toLineSelections(selections: readonly Selection[] | undefined): LineSelection[] | undefined;\n\tstatic toLineSelections(selections: readonly Selection[] | undefined) {\n\t\treturn selections?.map(s => ({ active: s.active.line, anchor: s.anchor.line }));\n\t}\n}\n","import { Disposable, TextEditor } from 'vscode';\nimport { GlyphChars } from '../constants';\nimport { Container } from '../container';\nimport { GitCommit } from '../git/models';\nimport { Logger } from '../logger';\nimport { debug } from '../system/decorators/log';\nimport {\n\tDocumentBlameStateChangeEvent,\n\tDocumentContentChangeEvent,\n\tDocumentDirtyIdleTriggerEvent,\n\tDocumentDirtyStateChangeEvent,\n\tGitDocumentState,\n} from './gitDocumentTracker';\nimport { LinesChangeEvent, LineSelection, LineTracker } from './lineTracker';\n\nexport * from './lineTracker';\n\nexport class GitLineState {\n\tconstructor(public readonly commit: GitCommit | undefined) {\n\t\tif (commit != null && commit.file == null) {\n\t\t\tdebugger;\n\t\t}\n\t}\n}\n\nexport class GitLineTracker extends LineTracker<GitLineState> {\n\tconstructor(private readonly container: Container) {\n\t\tsuper();\n\t}\n\n\tprotected override async fireLinesChanged(e: LinesChangeEvent) {\n\t\tthis.reset();\n\n\t\tlet updated = false;\n\t\tif (!this.suspended && !e.pending && e.selections != null && e.editor != null) {\n\t\t\tupdated = await this.updateState(e.selections, e.editor);\n\t\t}\n\n\t\treturn super.fireLinesChanged(updated ? e : { ...e, selections: undefined });\n\t}\n\n\tprivate _subscriptionOnlyWhenActive: Disposable | undefined;\n\n\tprotected override onStart(): Disposable | undefined {\n\t\tthis.onResume();\n\n\t\treturn Disposable.from(\n\t\t\t{ dispose: () => this.onSuspend() },\n\t\t\tthis.container.tracker.onDidChangeBlameState(this.onBlameStateChanged, this),\n\t\t\tthis.container.tracker.onDidChangeDirtyState(this.onDirtyStateChanged, this),\n\t\t\tthis.container.tracker.onDidTriggerDirtyIdle(this.onDirtyIdleTriggered, this),\n\t\t);\n\t}\n\n\tprotected override onResume(): void {\n\t\tif (this._subscriptionOnlyWhenActive == null) {\n\t\t\tthis._subscriptionOnlyWhenActive = this.container.tracker.onDidChangeContent(this.onContentChanged, this);\n\t\t}\n\t}\n\n\tprotected override onSuspend(): void {\n\t\tthis._subscriptionOnlyWhenActive?.dispose();\n\t\tthis._subscriptionOnlyWhenActive = undefined;\n\t}\n\n\t@debug<GitLineTracker['onBlameStateChanged']>({\n\t\targs: {\n\t\t\t0: e =>\n\t\t\t\t`editor=${e.editor.document.uri.toString(true)}, doc=${e.document.uri.toString(true)}, blameable=${\n\t\t\t\t\te.blameable\n\t\t\t\t}`,\n\t\t},\n\t})\n\tprivate onBlameStateChanged(_e: DocumentBlameStateChangeEvent<GitDocumentState>) {\n\t\tthis.trigger('editor');\n\t}\n\n\t@debug<GitLineTracker['onContentChanged']>({\n\t\targs: {\n\t\t\t0: e => `editor=${e.editor.document.uri.toString(true)}, doc=${e.document.uri.toString(true)}`,\n\t\t},\n\t})\n\tprivate onContentChanged(e: DocumentContentChangeEvent<GitDocumentState>) {\n\t\tif (\n\t\t\te.contentChanges.some(cc =>\n\t\t\t\tthis.selections?.some(\n\t\t\t\t\tselection =>\n\t\t\t\t\t\t(cc.range.end.line >= selection.active && selection.active >= cc.range.start.line) ||\n\t\t\t\t\t\t(cc.range.start.line >= selection.active && selection.active >= cc.range.end.line),\n\t\t\t\t),\n\t\t\t)\n\t\t) {\n\t\t\tthis.trigger('editor');\n\t\t}\n\t}\n\n\t@debug<GitLineTracker['onDirtyIdleTriggered']>({\n\t\targs: {\n\t\t\t0: e => `editor=${e.editor.document.uri.toString(true)}, doc=${e.document.uri.toString(true)}`,\n\t\t},\n\t})\n\tprivate onDirtyIdleTriggered(e: DocumentDirtyIdleTriggerEvent<GitDocumentState>) {\n\t\tconst maxLines = this.container.config.advanced.blame.sizeThresholdAfterEdit;\n\t\tif (maxLines > 0 && e.document.lineCount > maxLines) return;\n\n\t\tthis.resume();\n\t}\n\n\t@debug<GitLineTracker['onDirtyStateChanged']>({\n\t\targs: {\n\t\t\t0: e =>\n\t\t\t\t`editor=${e.editor.document.uri.toString(true)}, doc=${e.document.uri.toString(true)}, dirty=${\n\t\t\t\t\te.dirty\n\t\t\t\t}`,\n\t\t},\n\t})\n\tprivate onDirtyStateChanged(e: DocumentDirtyStateChangeEvent<GitDocumentState>) {\n\t\tif (e.dirty) {\n\t\t\tthis.suspend();\n\t\t} else {\n\t\t\tthis.resume({ force: true });\n\t\t}\n\t}\n\n\t@debug<GitLineTracker['updateState']>({\n\t\targs: { 0: selections => selections?.map(s => s.active).join(','), 1: e => e.document.uri.toString(true) },\n\t\texit: updated => `returned ${updated}`,\n\t\tsingleLine: true,\n\t})\n\tprivate async updateState(selections: LineSelection[], editor: TextEditor): Promise<boolean> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tif (!this.includes(selections)) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = ` ${GlyphChars.Dot} lines no longer match`;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tconst trackedDocument = await this.container.tracker.getOrAdd(editor.document);\n\t\tif (!trackedDocument.isBlameable) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = ` ${GlyphChars.Dot} document is not blameable`;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (selections.length === 1) {\n\t\t\tconst blameLine = await this.container.git.getBlameForLine(\n\t\t\t\ttrackedDocument.uri,\n\t\t\t\tselections[0].active,\n\t\t\t\teditor?.document,\n\t\t\t);\n\t\t\tif (blameLine == null) {\n\t\t\t\tif (cc != null) {\n\t\t\t\t\tcc.exitDetails = ` ${GlyphChars.Dot} blame failed`;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.setState(blameLine.line.line - 1, new GitLineState(blameLine.commit));\n\t\t} else {\n\t\t\tconst blame = await this.container.git.getBlame(trackedDocument.uri, editor.document);\n\t\t\tif (blame == null) {\n\t\t\t\tif (cc != null) {\n\t\t\t\t\tcc.exitDetails = ` ${GlyphChars.Dot} blame failed`;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfor (const selection of selections) {\n\t\t\t\tconst commitLine = blame.lines[selection.active];\n\t\t\t\tthis.setState(selection.active, new GitLineState(blame.commits.get(commitLine.sha)));\n\t\t\t}\n\t\t}\n\n\t\t// Check again because of the awaits above\n\n\t\tif (!this.includes(selections)) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = ` ${GlyphChars.Dot} lines no longer match`;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!trackedDocument.isBlameable) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = ` ${GlyphChars.Dot} document is not blameable`;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (editor.document.isDirty) {\n\t\t\ttrackedDocument.setForceDirtyStateChangeOnNextDocumentChange();\n\t\t}\n\n\t\treturn true;\n\t}\n}\n","import {\n\tCancellationToken,\n\tcommands,\n\tConfigurationChangeEvent,\n\tDisposable,\n\tProgressLocation,\n\tTreeItem,\n\tTreeItemCollapsibleState,\n\twindow,\n} from 'vscode';\nimport {\n\tBranchesViewConfig,\n\tconfiguration,\n\tViewBranchesLayout,\n\tViewFilesLayout,\n\tViewShowBranchComparison,\n} from '../configuration';\nimport { Commands } from '../constants';\nimport { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport {\n\tGitBranchReference,\n\tGitCommit,\n\tGitReference,\n\tGitRevisionReference,\n\tRepositoryChange,\n\tRepositoryChangeComparisonMode,\n\tRepositoryChangeEvent,\n} from '../git/models';\nimport { executeCommand } from '../system/command';\nimport { gate } from '../system/decorators/gate';\nimport {\n\tBranchesNode,\n\tBranchNode,\n\tBranchOrTagFolderNode,\n\tRepositoriesSubscribeableNode,\n\tRepositoryFolderNode,\n\tRepositoryNode,\n\tViewNode,\n} from './nodes';\nimport { ViewBase } from './viewBase';\n\nexport class BranchesRepositoryNode extends RepositoryFolderNode<BranchesView, BranchesNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.child == null) {\n\t\t\tthis.child = new BranchesNode(this.uri, this.view, this, this.repo);\n\t\t}\n\n\t\treturn this.child.getChildren();\n\t}\n\n\tprotected changed(e: RepositoryChangeEvent) {\n\t\treturn e.changed(\n\t\t\tRepositoryChange.Config,\n\t\t\tRepositoryChange.Heads,\n\t\t\tRepositoryChange.Index,\n\t\t\tRepositoryChange.Remotes,\n\t\t\tRepositoryChange.RemoteProviders,\n\t\t\tRepositoryChange.Status,\n\t\t\tRepositoryChange.Unknown,\n\t\t\tRepositoryChangeComparisonMode.Any,\n\t\t);\n\t}\n}\n\nexport class BranchesViewNode extends RepositoriesSubscribeableNode<BranchesView, BranchesRepositoryNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.children == null) {\n\t\t\tconst repositories = this.view.container.git.openRepositories;\n\t\t\tif (repositories.length === 0) {\n\t\t\t\tthis.view.message = 'No branches could be found.';\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\n\t\t\tconst splat = repositories.length === 1;\n\t\t\tthis.children = repositories.map(\n\t\t\t\tr => new BranchesRepositoryNode(GitUri.fromRepoPath(r.path), this.view, this, r, splat),\n\t\t\t);\n\t\t}\n\n\t\tif (this.children.length === 1) {\n\t\t\tconst [child] = this.children;\n\n\t\t\tconst branches = await child.repo.getBranches({ filter: b => !b.remote });\n\t\t\tif (branches.values.length === 0) {\n\t\t\t\tthis.view.message = 'No branches could be found.';\n\t\t\t\tthis.view.title = 'Branches';\n\n\t\t\t\tvoid child.ensureSubscription();\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\t\t\tthis.view.title = `Branches (${branches.values.length})`;\n\n\t\t\treturn child.getChildren();\n\t\t}\n\n\t\treturn this.children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Branches', TreeItemCollapsibleState.Expanded);\n\t\treturn item;\n\t}\n}\n\nexport class BranchesView extends ViewBase<BranchesViewNode, BranchesViewConfig> {\n\tprotected readonly configKey = 'branches';\n\n\tconstructor(container: Container) {\n\t\tsuper('gitlens.views.branches', 'Branches', container);\n\t}\n\n\toverride get canReveal(): boolean {\n\t\treturn this.config.reveal || !configuration.get('views.repositories.showBranches');\n\t}\n\n\tprotected getRoot() {\n\t\treturn new BranchesViewNode(this);\n\t}\n\n\tprotected registerCommands(): Disposable[] {\n\t\tvoid this.container.viewCommands;\n\n\t\treturn [\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('copy'),\n\t\t\t\t() => executeCommand(Commands.ViewsCopy, this.selection),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('refresh'),\n\t\t\t\t() => {\n\t\t\t\t\tthis.container.git.resetCaches('branches');\n\t\t\t\t\treturn this.refresh(true);\n\t\t\t\t},\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setLayoutToList'),\n\t\t\t\t() => this.setLayout(ViewBranchesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setLayoutToTree'),\n\t\t\t\t() => this.setLayout(ViewBranchesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToAuto'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Auto),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToList'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToTree'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOn'),\n\t\t\t\t() => this.setShowAvatars(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOff'),\n\t\t\t\t() => this.setShowAvatars(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchComparisonOn'),\n\t\t\t\t() => this.setShowBranchComparison(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchComparisonOff'),\n\t\t\t\t() => this.setShowBranchComparison(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchPullRequestOn'),\n\t\t\t\t() => this.setShowBranchPullRequest(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchPullRequestOff'),\n\t\t\t\t() => this.setShowBranchPullRequest(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\t}\n\n\tprotected override filterConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tconst changed = super.filterConfigurationChanged(e);\n\t\tif (\n\t\t\t!changed &&\n\t\t\t!configuration.changed(e, 'defaultDateFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateShortFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateSource') &&\n\t\t\t!configuration.changed(e, 'defaultDateStyle') &&\n\t\t\t!configuration.changed(e, 'defaultGravatarsStyle') &&\n\t\t\t!configuration.changed(e, 'defaultTimeFormat') &&\n\t\t\t!configuration.changed(e, 'sortBranchesBy')\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfindBranch(branch: GitBranchReference, token?: CancellationToken) {\n\t\tif (branch.remote) return undefined;\n\n\t\tconst repoNodeId = RepositoryNode.getId(branch.repoPath);\n\n\t\treturn this.findNode((n: any) => n.branch?.ref === branch.ref, {\n\t\t\tallowPaging: true,\n\t\t\tmaxDepth: 4,\n\t\t\tcanTraverse: n => {\n\t\t\t\tif (n instanceof BranchesViewNode) return true;\n\n\t\t\t\tif (n instanceof BranchesRepositoryNode || n instanceof BranchOrTagFolderNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\tasync findCommit(commit: GitCommit | { repoPath: string; ref: string }, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(commit.repoPath);\n\n\t\t// Get all the branches the commit is on\n\t\tconst branches = await this.container.git.getCommitBranches(\n\t\t\tcommit.repoPath,\n\t\t\tcommit.ref,\n\t\t\tGitCommit.is(commit) ? { commitDate: commit.committer.date } : undefined,\n\t\t);\n\t\tif (branches.length === 0) return undefined;\n\n\t\treturn this.findNode((n: any) => n.commit?.ref === commit.ref, {\n\t\t\tallowPaging: true,\n\t\t\tmaxDepth: 5,\n\t\t\tcanTraverse: async n => {\n\t\t\t\tif (n instanceof BranchesViewNode) return true;\n\n\t\t\t\tif (n instanceof BranchesRepositoryNode || n instanceof BranchOrTagFolderNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\tif (n instanceof BranchNode && branches.includes(n.branch.name)) {\n\t\t\t\t\tawait n.loadMore({ until: commit.ref });\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\t@gate(() => '')\n\trevealBranch(\n\t\tbranch: GitBranchReference,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing ${GitReference.toString(branch, { icon: false, quoted: true })} in the side bar...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findBranch(branch, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\tasync revealCommit(\n\t\tcommit: GitRevisionReference,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing ${GitReference.toString(commit, { icon: false, quoted: true })} in the side bar...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findCommit(commit, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\tasync revealRepository(\n\t\trepoPath: string,\n\t\toptions?: { select?: boolean; focus?: boolean; expand?: boolean | number },\n\t) {\n\t\tconst node = await this.findNode(RepositoryFolderNode.getId(repoPath), {\n\t\t\tmaxDepth: 1,\n\t\t\tcanTraverse: n => n instanceof BranchesViewNode || n instanceof RepositoryFolderNode,\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\tprivate setLayout(layout: ViewBranchesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.branches.layout` as const, layout);\n\t}\n\n\tprivate setFilesLayout(layout: ViewFilesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.files.layout` as const, layout);\n\t}\n\n\tprivate setShowAvatars(enabled: boolean) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.avatars` as const, enabled);\n\t}\n\n\tprivate setShowBranchComparison(enabled: boolean) {\n\t\treturn configuration.updateEffective(\n\t\t\t`views.${this.configKey}.showBranchComparison` as const,\n\t\t\tenabled ? ViewShowBranchComparison.Branch : false,\n\t\t);\n\t}\n\n\tprivate async setShowBranchPullRequest(enabled: boolean) {\n\t\tawait configuration.updateEffective(`views.${this.configKey}.pullRequests.showForBranches` as const, enabled);\n\t\tawait configuration.updateEffective(`views.${this.configKey}.pullRequests.enabled` as const, enabled);\n\t}\n}\n","import {\n\tCancellationToken,\n\tcommands,\n\tConfigurationChangeEvent,\n\tDisposable,\n\tProgressLocation,\n\tTreeItem,\n\tTreeItemCollapsibleState,\n\twindow,\n} from 'vscode';\nimport { CommitsViewConfig, configuration, ViewFilesLayout, ViewShowBranchComparison } from '../configuration';\nimport { Commands, ContextKeys, GlyphChars } from '../constants';\nimport { Container } from '../container';\nimport { setContext } from '../context';\nimport { GitUri } from '../git/gitUri';\nimport {\n\tGitCommit,\n\tGitReference,\n\tGitRevisionReference,\n\tRepository,\n\tRepositoryChange,\n\tRepositoryChangeComparisonMode,\n\tRepositoryChangeEvent,\n} from '../git/models';\nimport { executeCommand } from '../system/command';\nimport { gate } from '../system/decorators/gate';\nimport { debug } from '../system/decorators/log';\nimport { disposableInterval } from '../system/function';\nimport {\n\tBranchNode,\n\tBranchTrackingStatusNode,\n\tRepositoriesSubscribeableNode,\n\tRepositoryFolderNode,\n\tRepositoryNode,\n\tViewNode,\n} from './nodes';\nimport { ViewBase } from './viewBase';\n\nexport class CommitsRepositoryNode extends RepositoryFolderNode<CommitsView, BranchNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.child == null) {\n\t\t\tconst branch = await this.repo.getBranch();\n\t\t\tif (branch == null) {\n\t\t\t\tthis.view.message = 'No commits could be found.';\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\n\t\t\tlet authors;\n\t\t\tif (this.view.state.myCommitsOnly) {\n\t\t\t\tconst user = await this.view.container.git.getCurrentUser(this.repo.path);\n\t\t\t\tif (user != null) {\n\t\t\t\t\tauthors = [{ name: user.name, email: user.email, username: user.username, id: user.id }];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.child = new BranchNode(this.uri, this.view, this, branch, true, {\n\t\t\t\texpanded: true,\n\t\t\t\tlimitCommits: !this.splatted,\n\t\t\t\tshowComparison: this.view.config.showBranchComparison,\n\t\t\t\tshowCurrent: false,\n\t\t\t\tshowTracking: true,\n\t\t\t\tauthors: authors,\n\t\t\t});\n\t\t}\n\n\t\treturn this.child.getChildren();\n\t}\n\n\t@gate()\n\t@debug()\n\toverride async refresh(reset: boolean = false) {\n\t\tif (reset) {\n\t\t\tthis.child = undefined;\n\t\t} else {\n\t\t\tvoid this.parent?.triggerChange(false);\n\t\t}\n\n\t\tawait this.ensureSubscription();\n\t}\n\n\t@debug()\n\tprotected override async subscribe() {\n\t\tconst lastFetched = (await this.repo?.getLastFetched()) ?? 0;\n\n\t\tconst interval = Repository.getLastFetchedUpdateInterval(lastFetched);\n\t\tif (lastFetched !== 0 && interval > 0) {\n\t\t\treturn Disposable.from(\n\t\t\t\tawait super.subscribe(),\n\t\t\t\tdisposableInterval(() => {\n\t\t\t\t\t// Check if the interval should change, and if so, reset it\n\t\t\t\t\tif (interval !== Repository.getLastFetchedUpdateInterval(lastFetched)) {\n\t\t\t\t\t\tvoid this.resetSubscription();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.splatted) {\n\t\t\t\t\t\tvoid this.view.triggerNodeChange(this.parent ?? this);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvoid this.view.triggerNodeChange(this);\n\t\t\t\t\t}\n\t\t\t\t}, interval),\n\t\t\t);\n\t\t}\n\n\t\treturn super.subscribe();\n\t}\n\n\tprotected changed(e: RepositoryChangeEvent) {\n\t\treturn e.changed(\n\t\t\tRepositoryChange.Config,\n\t\t\tRepositoryChange.Heads,\n\t\t\tRepositoryChange.Index,\n\t\t\tRepositoryChange.Remotes,\n\t\t\tRepositoryChange.RemoteProviders,\n\t\t\tRepositoryChange.Status,\n\t\t\tRepositoryChange.Unknown,\n\t\t\tRepositoryChangeComparisonMode.Any,\n\t\t);\n\t}\n}\n\nexport class CommitsViewNode extends RepositoriesSubscribeableNode<CommitsView, CommitsRepositoryNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.children == null) {\n\t\t\tconst repositories = this.view.container.git.openRepositories;\n\t\t\tif (repositories.length === 0) {\n\t\t\t\tthis.view.message = 'No commits could be found.';\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\n\t\t\tconst splat = repositories.length === 1;\n\t\t\tthis.children = repositories.map(\n\t\t\t\tr =>\n\t\t\t\t\tnew CommitsRepositoryNode(GitUri.fromRepoPath(r.path), this.view, this, r, splat, {\n\t\t\t\t\t\tshowBranchAndLastFetched: true,\n\t\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tif (this.children.length === 1) {\n\t\t\tconst [child] = this.children;\n\n\t\t\tconst branch = await child.repo.getBranch();\n\t\t\tif (branch != null) {\n\t\t\t\tconst lastFetched = (await child.repo.getLastFetched()) ?? 0;\n\n\t\t\t\tconst status = branch.getTrackingStatus();\n\t\t\t\tthis.view.description = `${status ? `${status} ${GlyphChars.Dot} ` : ''}${branch.name}${\n\t\t\t\t\tbranch.rebasing ? ' (Rebasing)' : ''\n\t\t\t\t}${lastFetched ? ` ${GlyphChars.Dot} Last fetched ${Repository.formatLastFetched(lastFetched)}` : ''}`;\n\t\t\t}\n\n\t\t\treturn child.getChildren();\n\t\t}\n\n\t\treturn this.children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Commits', TreeItemCollapsibleState.Expanded);\n\t\treturn item;\n\t}\n}\n\ninterface CommitsViewState {\n\tmyCommitsOnly?: boolean;\n}\n\nexport class CommitsView extends ViewBase<CommitsViewNode, CommitsViewConfig> {\n\tprotected readonly configKey = 'commits';\n\n\tconstructor(container: Container) {\n\t\tsuper('gitlens.views.commits', 'Commits', container);\n\t}\n\n\toverride get canReveal(): boolean {\n\t\treturn this.config.reveal || !configuration.get('views.repositories.showCommits');\n\t}\n\n\tprivate readonly _state: CommitsViewState = {};\n\tget state(): CommitsViewState {\n\t\treturn this._state;\n\t}\n\n\tprotected getRoot() {\n\t\treturn new CommitsViewNode(this);\n\t}\n\n\tprotected registerCommands(): Disposable[] {\n\t\tvoid this.container.viewCommands;\n\n\t\treturn [\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('copy'),\n\t\t\t\t() => executeCommand(Commands.ViewsCopy, this.selection),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('refresh'),\n\t\t\t\t() => {\n\t\t\t\t\tthis.container.git.resetCaches('branches', 'status', 'tags');\n\t\t\t\t\treturn this.refresh(true);\n\t\t\t\t},\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToAuto'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Auto),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToList'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToTree'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setMyCommitsOnlyOn'),\n\t\t\t\t() => this.setMyCommitsOnly(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setMyCommitsOnlyOff'),\n\t\t\t\t() => this.setMyCommitsOnly(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOn'),\n\t\t\t\t() => this.setShowAvatars(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOff'),\n\t\t\t\t() => this.setShowAvatars(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchComparisonOn'),\n\t\t\t\t() => this.setShowBranchComparison(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchComparisonOff'),\n\t\t\t\t() => this.setShowBranchComparison(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchPullRequestOn'),\n\t\t\t\t() => this.setShowBranchPullRequest(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchPullRequestOff'),\n\t\t\t\t() => this.setShowBranchPullRequest(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\t}\n\n\tprotected override filterConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tconst changed = super.filterConfigurationChanged(e);\n\t\tif (\n\t\t\t!changed &&\n\t\t\t!configuration.changed(e, 'defaultDateFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateShortFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateSource') &&\n\t\t\t!configuration.changed(e, 'defaultDateStyle') &&\n\t\t\t!configuration.changed(e, 'defaultGravatarsStyle') &&\n\t\t\t!configuration.changed(e, 'defaultTimeFormat')\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync findCommit(commit: GitCommit | { repoPath: string; ref: string }, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(commit.repoPath);\n\n\t\tconst branch = await this.container.git.getBranch(commit.repoPath);\n\t\tif (branch == null) return undefined;\n\n\t\t// Check if the commit exists on the current branch\n\t\tconst branches = await Container.instance.git.getCommitBranches(commit.repoPath, commit.ref, {\n\t\t\tbranch: branch.name,\n\t\t\tcommitDate: GitCommit.is(commit) ? commit.committer.date : undefined,\n\t\t});\n\t\tif (!branches.length) return undefined;\n\n\t\treturn this.findNode((n: any) => n.commit?.ref === commit.ref, {\n\t\t\tallowPaging: true,\n\t\t\tmaxDepth: 2,\n\t\t\tcanTraverse: async n => {\n\t\t\t\tif (n instanceof CommitsViewNode) {\n\t\t\t\t\tlet node: ViewNode | undefined = await n.getSplattedChild?.();\n\t\t\t\t\tif (node instanceof CommitsRepositoryNode) {\n\t\t\t\t\t\tnode = await node.getSplattedChild?.();\n\t\t\t\t\t\tif (node instanceof BranchNode) {\n\t\t\t\t\t\t\tawait node.loadMore({ until: commit.ref });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (n instanceof CommitsRepositoryNode) {\n\t\t\t\t\tif (n.id.startsWith(repoNodeId)) {\n\t\t\t\t\t\tconst node = await n.getSplattedChild?.();\n\t\t\t\t\t\tif (node instanceof BranchNode) {\n\t\t\t\t\t\t\tawait node.loadMore({ until: commit.ref });\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (n instanceof BranchTrackingStatusNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\t@gate(() => '')\n\tasync revealCommit(\n\t\tcommit: GitRevisionReference,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing ${GitReference.toString(commit, { icon: false, quoted: true })} in the side bar...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findCommit(commit, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\tasync revealRepository(\n\t\trepoPath: string,\n\t\toptions?: { select?: boolean; focus?: boolean; expand?: boolean | number },\n\t) {\n\t\tconst node = await this.findNode(RepositoryFolderNode.getId(repoPath), {\n\t\t\tmaxDepth: 1,\n\t\t\tcanTraverse: n => n instanceof CommitsViewNode || n instanceof RepositoryFolderNode,\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\tprivate setFilesLayout(layout: ViewFilesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.files.layout` as const, layout);\n\t}\n\n\tprivate setMyCommitsOnly(enabled: boolean) {\n\t\tvoid setContext(ContextKeys.ViewsCommitsMyCommitsOnly, enabled);\n\t\tthis.state.myCommitsOnly = enabled;\n\t\tvoid this.refresh(true);\n\t}\n\n\tprivate setShowAvatars(enabled: boolean) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.avatars` as const, enabled);\n\t}\n\n\tprivate setShowBranchComparison(enabled: boolean) {\n\t\treturn configuration.updateEffective(\n\t\t\t`views.${this.configKey}.showBranchComparison` as const,\n\t\t\tenabled ? ViewShowBranchComparison.Working : false,\n\t\t);\n\t}\n\n\tprivate async setShowBranchPullRequest(enabled: boolean) {\n\t\tawait configuration.updateEffective(`views.${this.configKey}.pullRequests.showForBranches` as const, enabled);\n\t\tawait configuration.updateEffective(`views.${this.configKey}.pullRequests.enabled` as const, enabled);\n\t}\n}\n","import {\n\tCancellationToken,\n\tcommands,\n\tConfigurationChangeEvent,\n\tDisposable,\n\tProgressLocation,\n\tTreeItem,\n\tTreeItemCollapsibleState,\n\twindow,\n} from 'vscode';\nimport { Avatars } from '../avatars';\nimport { configuration, ContributorsViewConfig, ViewFilesLayout } from '../configuration';\nimport { Commands } from '../constants';\nimport { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport { GitContributor, RepositoryChange, RepositoryChangeComparisonMode, RepositoryChangeEvent } from '../git/models';\nimport { executeCommand } from '../system/command';\nimport { gate } from '../system/decorators/gate';\nimport { debug } from '../system/decorators/log';\nimport {\n\tContributorNode,\n\tContributorsNode,\n\tRepositoriesSubscribeableNode,\n\tRepositoryFolderNode,\n\tRepositoryNode,\n\tViewNode,\n} from './nodes';\nimport { ViewBase } from './viewBase';\n\nexport class ContributorsRepositoryNode extends RepositoryFolderNode<ContributorsView, ContributorsNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.child == null) {\n\t\t\tthis.child = new ContributorsNode(this.uri, this.view, this, this.repo);\n\t\t}\n\n\t\treturn this.child.getChildren();\n\t}\n\n\t@debug()\n\tprotected override async subscribe() {\n\t\treturn Disposable.from(\n\t\t\tawait super.subscribe(),\n\t\t\tAvatars.onDidFetch(e => this.child?.updateAvatar(e.email)),\n\t\t);\n\t}\n\n\tprotected changed(e: RepositoryChangeEvent) {\n\t\treturn e.changed(\n\t\t\tRepositoryChange.Config,\n\t\t\tRepositoryChange.Heads,\n\t\t\tRepositoryChange.Remotes,\n\t\t\tRepositoryChange.Unknown,\n\t\t\tRepositoryChangeComparisonMode.Any,\n\t\t);\n\t}\n}\n\nexport class ContributorsViewNode extends RepositoriesSubscribeableNode<ContributorsView, ContributorsRepositoryNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.children == null) {\n\t\t\tconst repositories = this.view.container.git.openRepositories;\n\t\t\tif (repositories.length === 0) {\n\t\t\t\tthis.view.message = 'No contributors could be found.';\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\n\t\t\tconst splat = repositories.length === 1;\n\t\t\tthis.children = repositories.map(\n\t\t\t\tr => new ContributorsRepositoryNode(GitUri.fromRepoPath(r.path), this.view, this, r, splat),\n\t\t\t);\n\t\t}\n\n\t\tif (this.children.length === 1) {\n\t\t\tconst [child] = this.children;\n\n\t\t\tconst children = await child.getChildren();\n\n\t\t\t// const all = this.view.container.config.views.contributors.showAllBranches;\n\n\t\t\t// let ref: string | undefined;\n\t\t\t// // If we aren't getting all branches, get the upstream of the current branch if there is one\n\t\t\t// if (!all) {\n\t\t\t// \ttry {\n\t\t\t// \t\tconst branch = await this.view.container.git.getBranch(this.uri.repoPath);\n\t\t\t// \t\tif (branch?.upstream?.name != null && !branch.upstream.missing) {\n\t\t\t// \t\t\tref = '@{u}';\n\t\t\t// \t\t}\n\t\t\t// \t} catch {}\n\t\t\t// }\n\n\t\t\t// const contributors = await child.repo.getContributors({ all: all, ref: ref });\n\t\t\tif (children.length === 0) {\n\t\t\t\tthis.view.message = 'No contributors could be found.';\n\t\t\t\tthis.view.title = 'Contributors';\n\n\t\t\t\tvoid child.ensureSubscription();\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\t\t\tthis.view.title = `Contributors (${children.length})`;\n\n\t\t\treturn children;\n\t\t}\n\n\t\treturn this.children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Contributors', TreeItemCollapsibleState.Expanded);\n\t\treturn item;\n\t}\n}\n\nexport class ContributorsView extends ViewBase<ContributorsViewNode, ContributorsViewConfig> {\n\tprotected readonly configKey = 'contributors';\n\n\tconstructor(container: Container) {\n\t\tsuper('gitlens.views.contributors', 'Contributors', container);\n\t}\n\n\toverride get canReveal(): boolean {\n\t\treturn this.config.reveal || !configuration.get('views.repositories.showContributors');\n\t}\n\n\tprotected getRoot() {\n\t\treturn new ContributorsViewNode(this);\n\t}\n\n\tprotected registerCommands(): Disposable[] {\n\t\tvoid this.container.viewCommands;\n\n\t\treturn [\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('copy'),\n\t\t\t\t() => executeCommand(Commands.ViewsCopy, this.selection),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('refresh'),\n\t\t\t\t() => {\n\t\t\t\t\tthis.container.git.resetCaches('contributors');\n\t\t\t\t\treturn this.refresh(true);\n\t\t\t\t},\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToAuto'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Auto),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToList'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToTree'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAllBranchesOn'),\n\t\t\t\t() => this.setShowAllBranches(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAllBranchesOff'),\n\t\t\t\t() => this.setShowAllBranches(false),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOn'),\n\t\t\t\t() => this.setShowAvatars(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOff'),\n\t\t\t\t() => this.setShowAvatars(false),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowStatisticsOn'),\n\t\t\t\t() => this.setShowStatistics(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowStatisticsOff'),\n\t\t\t\t() => this.setShowStatistics(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\t}\n\n\tprotected override filterConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tconst changed = super.filterConfigurationChanged(e);\n\t\tif (\n\t\t\t!changed &&\n\t\t\t!configuration.changed(e, 'defaultDateFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateShortFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateSource') &&\n\t\t\t!configuration.changed(e, 'defaultDateStyle') &&\n\t\t\t!configuration.changed(e, 'defaultGravatarsStyle') &&\n\t\t\t!configuration.changed(e, 'defaultTimeFormat') &&\n\t\t\t!configuration.changed(e, 'sortContributorsBy')\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfindContributor(contributor: GitContributor, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(contributor.repoPath);\n\n\t\treturn this.findNode(\n\t\t\tContributorNode.getId(contributor.repoPath, contributor.name, contributor.email, contributor.username),\n\t\t\t{\n\t\t\t\tmaxDepth: 2,\n\t\t\t\tcanTraverse: n => {\n\t\t\t\t\tif (n instanceof ContributorsViewNode) return true;\n\n\t\t\t\t\tif (n instanceof ContributorsRepositoryNode) {\n\t\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\ttoken: token,\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\tasync revealRepository(\n\t\trepoPath: string,\n\t\toptions?: { select?: boolean; focus?: boolean; expand?: boolean | number },\n\t) {\n\t\tconst node = await this.findNode(RepositoryFolderNode.getId(repoPath), {\n\t\t\tmaxDepth: 1,\n\t\t\tcanTraverse: n => n instanceof ContributorsViewNode || n instanceof RepositoryFolderNode,\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t@gate(() => '')\n\tasync revealContributor(\n\t\tcontributor: GitContributor,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing contributor '${contributor.name}' in the side bar...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findContributor(contributor, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\tprivate setFilesLayout(layout: ViewFilesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.files.layout` as const, layout);\n\t}\n\n\tprivate setShowAllBranches(enabled: boolean) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.showAllBranches` as const, enabled);\n\t}\n\n\tprivate setShowAvatars(enabled: boolean) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.avatars` as const, enabled);\n\t}\n\n\tprivate setShowStatistics(enabled: boolean) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.showStatistics` as const, enabled);\n\t}\n}\n","import { commands, ConfigurationChangeEvent, Disposable } from 'vscode';\nimport { configuration, LineHistoryViewConfig } from '../configuration';\nimport { Commands, ContextKeys } from '../constants';\nimport { Container } from '../container';\nimport { setContext } from '../context';\nimport { executeCommand } from '../system/command';\nimport { LineHistoryTrackerNode } from './nodes';\nimport { ViewBase } from './viewBase';\n\nconst pinnedSuffix = ' (pinned)';\n\nexport class LineHistoryView extends ViewBase<LineHistoryTrackerNode, LineHistoryViewConfig> {\n\tprotected readonly configKey = 'lineHistory';\n\n\tconstructor(container: Container) {\n\t\tsuper('gitlens.views.lineHistory', 'Line History', container);\n\n\t\tvoid setContext(ContextKeys.ViewsLineHistoryEditorFollowing, true);\n\t}\n\n\tprotected override get showCollapseAll(): boolean {\n\t\treturn false;\n\t}\n\n\tprotected getRoot() {\n\t\treturn new LineHistoryTrackerNode(this);\n\t}\n\n\tprotected registerCommands(): Disposable[] {\n\t\tvoid this.container.viewCommands;\n\n\t\treturn [\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('copy'),\n\t\t\t\t() => executeCommand(Commands.ViewsCopy, this.selection),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(this.getQualifiedCommand('refresh'), () => this.refresh(true), this),\n\t\t\tcommands.registerCommand(this.getQualifiedCommand('changeBase'), () => this.changeBase(), this),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setEditorFollowingOn'),\n\t\t\t\t() => this.setEditorFollowing(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setEditorFollowingOff'),\n\t\t\t\t() => this.setEditorFollowing(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOn'),\n\t\t\t\t() => this.setShowAvatars(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOff'),\n\t\t\t\t() => this.setShowAvatars(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\t}\n\n\tprotected override filterConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tconst changed = super.filterConfigurationChanged(e);\n\t\tif (\n\t\t\t!changed &&\n\t\t\t!configuration.changed(e, 'defaultDateFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateShortFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateSource') &&\n\t\t\t!configuration.changed(e, 'defaultDateStyle') &&\n\t\t\t!configuration.changed(e, 'defaultGravatarsStyle') &&\n\t\t\t!configuration.changed(e, 'defaultTimeFormat')\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate changeBase() {\n\t\tvoid this.root?.changeBase();\n\t}\n\n\tprivate setEditorFollowing(enabled: boolean) {\n\t\tconst root = this.ensureRoot();\n\t\tif (!root.hasUri) return;\n\n\t\tvoid setContext(ContextKeys.ViewsLineHistoryEditorFollowing, enabled);\n\n\t\tthis.root?.setEditorFollowing(enabled);\n\n\t\tif (this.description?.endsWith(pinnedSuffix)) {\n\t\t\tif (enabled) {\n\t\t\t\tthis.description = this.description.substr(0, this.description.length - pinnedSuffix.length);\n\t\t\t}\n\t\t} else if (!enabled && this.description != null) {\n\t\t\tthis.description += pinnedSuffix;\n\t\t}\n\n\t\tif (enabled) {\n\t\t\tvoid root.ensureSubscription();\n\t\t\tvoid this.refresh(true);\n\t\t}\n\t}\n\n\tprivate setShowAvatars(enabled: boolean) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.avatars` as const, enabled);\n\t}\n}\n","import { commands, ConfigurationChangeEvent, Disposable, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { configuration, SearchAndCompareViewConfig, ViewFilesLayout } from '../configuration';\nimport { Commands, ContextKeys } from '../constants';\nimport { Container } from '../container';\nimport { setContext } from '../context';\nimport { GitUri } from '../git/gitUri';\nimport { GitLog, GitRevision } from '../git/models';\nimport { SearchPattern } from '../git/search';\nimport { ReferencePicker, ReferencesQuickPickIncludes } from '../quickpicks/referencePicker';\nimport { RepositoryPicker } from '../quickpicks/repositoryPicker';\nimport { NamedRef, PinnedItem, PinnedItems, WorkspaceStorageKeys } from '../storage';\nimport { filterMap } from '../system/array';\nimport { executeCommand } from '../system/command';\nimport { gate } from '../system/decorators/gate';\nimport { debug, log } from '../system/decorators/log';\nimport { isPromise } from '../system/promise';\nimport {\n\tCompareResultsNode,\n\tContextValues,\n\tRepositoryFolderNode,\n\tResultsFilesNode,\n\tSearchResultsNode,\n\tViewNode,\n} from './nodes';\nimport { ComparePickerNode } from './nodes/comparePickerNode';\nimport { ViewBase } from './viewBase';\n\ninterface DeprecatedPinnedComparison {\n\tpath: string;\n\tref1: NamedRef;\n\tref2: NamedRef;\n\tnotation?: '..' | '...';\n}\n\ninterface DeprecatedPinnedComparisons {\n\t[id: string]: DeprecatedPinnedComparison;\n}\n\nexport class SearchAndCompareViewNode extends ViewNode<SearchAndCompareView> {\n\tprotected override splatted = true;\n\tprivate comparePicker: ComparePickerNode | undefined;\n\n\tconstructor(view: SearchAndCompareView) {\n\t\tsuper(GitUri.unknown, view);\n\t}\n\n\tprivate _children: (ComparePickerNode | CompareResultsNode | SearchResultsNode)[] | undefined;\n\tprivate get children(): (ComparePickerNode | CompareResultsNode | SearchResultsNode)[] {\n\t\tif (this._children == null) {\n\t\t\tthis._children = [];\n\n\t\t\t// Get pinned searches & comparisons\n\t\t\tconst pinned = this.view.getPinned();\n\t\t\tif (pinned.length !== 0) {\n\t\t\t\tthis._children.push(...pinned);\n\t\t\t}\n\t\t}\n\n\t\treturn this._children;\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\tif (this.children.length === 0) return [];\n\n\t\tthis.view.message = undefined;\n\n\t\treturn this.children.sort((a, b) => (a.pinned ? -1 : 1) - (b.pinned ? -1 : 1) || b.order - a.order);\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tthis.splatted = false;\n\n\t\tconst item = new TreeItem('SearchAndCompare', TreeItemCollapsibleState.Expanded);\n\t\titem.contextValue = ContextValues.SearchAndCompare;\n\t\treturn item;\n\t}\n\n\taddOrReplace(results: CompareResultsNode | SearchResultsNode, replace: boolean) {\n\t\tif (this.children.includes(results)) return;\n\n\t\tif (replace) {\n\t\t\tthis.clear();\n\t\t}\n\n\t\tthis.children.push(results);\n\n\t\tthis.view.triggerNodeChange();\n\t}\n\n\t@log()\n\tclear(silent: boolean = false) {\n\t\tif (this.children.length === 0) return;\n\n\t\tthis.removeComparePicker(true);\n\t\tconst index = this._children!.findIndex(c => !c.pinned);\n\t\tif (index !== -1) {\n\t\t\tthis._children!.splice(index, this._children!.length);\n\t\t}\n\n\t\tif (!silent) {\n\t\t\tthis.view.triggerNodeChange();\n\t\t}\n\t}\n\n\t@log<SearchAndCompareViewNode['dismiss']>({ args: { 0: n => n.toString() } })\n\tdismiss(node: ComparePickerNode | CompareResultsNode | SearchResultsNode) {\n\t\tif (node === this.comparePicker) {\n\t\t\tthis.removeComparePicker();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.children.length === 0) return;\n\n\t\tconst index = this.children.indexOf(node);\n\t\tif (index === -1) return;\n\n\t\tthis.children.splice(index, 1);\n\n\t\tthis.view.triggerNodeChange();\n\t}\n\n\t@gate()\n\t@debug()\n\toverride async refresh() {\n\t\tif (this.children.length === 0) return;\n\n\t\tconst promises: Promise<any>[] = [\n\t\t\t...filterMap(this.children, c => {\n\t\t\t\tconst result = c.refresh === undefined ? false : c.refresh();\n\t\t\t\treturn isPromise<boolean | void>(result) ? result : undefined;\n\t\t\t}),\n\t\t];\n\t\tawait Promise.all(promises);\n\t}\n\n\tasync compareWithSelected(repoPath?: string, ref?: string | NamedRef) {\n\t\tconst selectedRef = this.comparePicker?.selectedRef;\n\t\tif (selectedRef == null) return;\n\n\t\tif (repoPath == null) {\n\t\t\trepoPath = selectedRef.repoPath;\n\t\t} else if (repoPath !== selectedRef.repoPath) {\n\t\t\t// If we don't have a matching repoPath, then start over\n\t\t\tvoid this.selectForCompare(repoPath, ref);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (ref == null) {\n\t\t\tconst pick = await ReferencePicker.show(\n\t\t\t\trepoPath,\n\t\t\t\t`Compare ${this.getRefName(selectedRef.ref)} with`,\n\t\t\t\t'Choose a reference to compare with',\n\t\t\t\t{\n\t\t\t\t\tallowEnteringRefs: true,\n\t\t\t\t\tpicked: typeof selectedRef.ref === 'string' ? selectedRef.ref : selectedRef.ref.ref,\n\t\t\t\t\t// checkmarks: true,\n\t\t\t\t\tinclude:\n\t\t\t\t\t\tReferencesQuickPickIncludes.BranchesAndTags |\n\t\t\t\t\t\tReferencesQuickPickIncludes.HEAD |\n\t\t\t\t\t\tReferencesQuickPickIncludes.WorkingTree,\n\t\t\t\t\tsort: { branches: { current: true } },\n\t\t\t\t},\n\t\t\t);\n\t\t\tif (pick == null) {\n\t\t\t\tif (this.comparePicker != null) {\n\t\t\t\t\tawait this.view.show();\n\t\t\t\t\tawait this.view.reveal(this.comparePicker, { focus: true, select: true });\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tref = pick.ref;\n\t\t}\n\n\t\tthis.removeComparePicker();\n\t\tvoid (await this.view.compare(repoPath, selectedRef.ref, ref));\n\t}\n\n\tasync selectForCompare(repoPath?: string, ref?: string | NamedRef, options?: { prompt?: boolean }) {\n\t\tif (repoPath == null) {\n\t\t\trepoPath = (await RepositoryPicker.getRepositoryOrShow('Compare'))?.path;\n\t\t}\n\t\tif (repoPath == null) return;\n\n\t\tthis.removeComparePicker(true);\n\n\t\tlet prompt = options?.prompt ?? false;\n\t\tlet ref2;\n\t\tif (ref == null) {\n\t\t\tconst pick = await ReferencePicker.show(repoPath, 'Compare', 'Choose a reference to compare', {\n\t\t\t\tallowEnteringRefs: { ranges: true },\n\t\t\t\t// checkmarks: false,\n\t\t\t\tinclude:\n\t\t\t\t\tReferencesQuickPickIncludes.BranchesAndTags |\n\t\t\t\t\tReferencesQuickPickIncludes.HEAD |\n\t\t\t\t\tReferencesQuickPickIncludes.WorkingTree,\n\t\t\t\tsort: { branches: { current: true }, tags: {} },\n\t\t\t});\n\t\t\tif (pick == null) {\n\t\t\t\tawait this.triggerChange();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tref = pick.ref;\n\n\t\t\tif (GitRevision.isRange(ref)) {\n\t\t\t\tconst range = GitRevision.splitRange(ref);\n\t\t\t\tif (range != null) {\n\t\t\t\t\tref = range.ref1 || 'HEAD';\n\t\t\t\t\tref2 = range.ref2 || 'HEAD';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tprompt = true;\n\t\t}\n\n\t\tthis.comparePicker = new ComparePickerNode(this.view, this, {\n\t\t\tlabel: this.getRefName(ref),\n\t\t\trepoPath: repoPath,\n\t\t\tref: ref,\n\t\t});\n\t\tthis.children.splice(0, 0, this.comparePicker);\n\t\tvoid setContext(ContextKeys.ViewsCanCompare, true);\n\n\t\tawait this.triggerChange();\n\n\t\tawait this.view.reveal(this.comparePicker, { focus: false, select: true });\n\n\t\tif (prompt) {\n\t\t\tawait this.compareWithSelected(repoPath, ref2);\n\t\t}\n\t}\n\n\tprivate getRefName(ref: string | NamedRef) {\n\t\treturn typeof ref === 'string'\n\t\t\t? GitRevision.shorten(ref, { strings: { working: 'Working Tree' } })!\n\t\t\t: ref.label ?? GitRevision.shorten(ref.ref)!;\n\t}\n\n\tprivate removeComparePicker(silent: boolean = false) {\n\t\tvoid setContext(ContextKeys.ViewsCanCompare, false);\n\t\tif (this.comparePicker != null) {\n\t\t\tconst index = this.children.indexOf(this.comparePicker);\n\t\t\tif (index !== -1) {\n\t\t\t\tthis.children.splice(index, 1);\n\t\t\t\tif (!silent) {\n\t\t\t\t\tvoid this.triggerChange();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.comparePicker = undefined;\n\t\t}\n\t}\n}\n\nexport class SearchAndCompareView extends ViewBase<SearchAndCompareViewNode, SearchAndCompareViewConfig> {\n\tprotected readonly configKey = 'searchAndCompare';\n\n\tconstructor(container: Container) {\n\t\tsuper('gitlens.views.searchAndCompare', 'Search & Compare', container);\n\n\t\tvoid setContext(ContextKeys.ViewsSearchAndCompareKeepResults, this.keepResults);\n\t}\n\n\tprotected getRoot() {\n\t\treturn new SearchAndCompareViewNode(this);\n\t}\n\n\tprotected registerCommands(): Disposable[] {\n\t\tvoid this.container.viewCommands;\n\n\t\treturn [\n\t\t\tcommands.registerCommand(this.getQualifiedCommand('clear'), () => this.clear(), this),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('copy'),\n\t\t\t\t() => executeCommand(Commands.ViewsCopy, this.selection),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(this.getQualifiedCommand('refresh'), () => this.refresh(true), this),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToAuto'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Auto),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToList'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToTree'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setKeepResultsToOn'),\n\t\t\t\t() => this.setKeepResults(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setKeepResultsToOff'),\n\t\t\t\t() => this.setKeepResults(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOn'),\n\t\t\t\t() => this.setShowAvatars(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOff'),\n\t\t\t\t() => this.setShowAvatars(false),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(this.getQualifiedCommand('pin'), this.pin, this),\n\t\t\tcommands.registerCommand(this.getQualifiedCommand('unpin'), this.unpin, this),\n\t\t\tcommands.registerCommand(this.getQualifiedCommand('swapComparison'), this.swapComparison, this),\n\t\t\tcommands.registerCommand(this.getQualifiedCommand('selectForCompare'), this.selectForCompare, this),\n\t\t\tcommands.registerCommand(this.getQualifiedCommand('compareWithSelected'), this.compareWithSelected, this),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesFilterOnLeft'),\n\t\t\t\tn => this.setFilesFilter(n, 'left'),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesFilterOnRight'),\n\t\t\t\tn => this.setFilesFilter(n, 'right'),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesFilterOff'),\n\t\t\t\tn => this.setFilesFilter(n, false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\t}\n\n\tprotected override filterConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tconst changed = super.filterConfigurationChanged(e);\n\t\tif (\n\t\t\t!changed &&\n\t\t\t!configuration.changed(e, 'defaultDateFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateShortFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateSource') &&\n\t\t\t!configuration.changed(e, 'defaultDateStyle') &&\n\t\t\t!configuration.changed(e, 'defaultGravatarsStyle') &&\n\t\t\t!configuration.changed(e, 'defaultTimeFormat')\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tget keepResults(): boolean {\n\t\treturn this.container.storage.getWorkspace<boolean>(\n\t\t\tWorkspaceStorageKeys.ViewsSearchAndCompareKeepResults,\n\t\t\ttrue,\n\t\t);\n\t}\n\n\tclear() {\n\t\tthis.root?.clear();\n\t}\n\n\tdismissNode(node: ViewNode) {\n\t\tif (\n\t\t\tthis.root == null ||\n\t\t\t(!(node instanceof ComparePickerNode) &&\n\t\t\t\t!(node instanceof CompareResultsNode) &&\n\t\t\t\t!(node instanceof SearchResultsNode)) ||\n\t\t\t!node.canDismiss\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.root.dismiss(node);\n\t}\n\n\tcompare(repoPath: string, ref1: string | NamedRef, ref2: string | NamedRef) {\n\t\treturn this.addResults(\n\t\t\tnew CompareResultsNode(\n\t\t\t\tthis,\n\t\t\t\tthis.ensureRoot(),\n\t\t\t\trepoPath,\n\t\t\t\ttypeof ref1 === 'string' ? { ref: ref1 } : ref1,\n\t\t\t\ttypeof ref2 === 'string' ? { ref: ref2 } : ref2,\n\t\t\t),\n\t\t);\n\t}\n\n\tcompareWithSelected(repoPath?: string, ref?: string | NamedRef) {\n\t\tvoid this.ensureRoot().compareWithSelected(repoPath, ref);\n\t}\n\n\tselectForCompare(repoPath?: string, ref?: string | NamedRef, options?: { prompt?: boolean }) {\n\t\tvoid this.ensureRoot().selectForCompare(repoPath, ref, options);\n\t}\n\n\tasync search(\n\t\trepoPath: string,\n\t\tsearch: SearchPattern,\n\t\t{\n\t\t\tlabel,\n\t\t\treveal,\n\t\t}: {\n\t\t\tlabel:\n\t\t\t\t| string\n\t\t\t\t| {\n\t\t\t\t\t\tlabel: string;\n\t\t\t\t\t\tresultsType?: { singular: string; plural: string };\n\t\t\t\t  };\n\t\t\treveal?: {\n\t\t\t\tselect?: boolean;\n\t\t\t\tfocus?: boolean;\n\t\t\t\texpand?: boolean | number;\n\t\t\t};\n\t\t},\n\t\tresults?: Promise<GitLog | undefined> | GitLog,\n\t\tupdateNode?: SearchResultsNode,\n\t) {\n\t\tif (!this.visible) {\n\t\t\tawait this.show();\n\t\t}\n\n\t\tconst labels = { label: `Results ${typeof label === 'string' ? label : label.label}`, queryLabel: label };\n\t\tif (updateNode != null) {\n\t\t\tawait updateNode.edit({ pattern: search, labels: labels, log: results });\n\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.addResults(new SearchResultsNode(this, this.root!, repoPath, search, labels, results), reveal);\n\t}\n\n\tgetPinned() {\n\t\tlet savedPins = this.container.storage.getWorkspace<PinnedItems>(\n\t\t\tWorkspaceStorageKeys.ViewsSearchAndComparePinnedItems,\n\t\t);\n\t\tif (savedPins == null) {\n\t\t\t// Migrate any deprecated pinned items\n\t\t\tconst deprecatedPins = this.container.storage.getWorkspace<DeprecatedPinnedComparisons>(\n\t\t\t\tWorkspaceStorageKeys.Deprecated_PinnedComparisons,\n\t\t\t);\n\t\t\tif (deprecatedPins == null) return [];\n\n\t\t\tsavedPins = Object.create(null) as PinnedItems;\n\t\t\tfor (const p of Object.values(deprecatedPins)) {\n\t\t\t\tsavedPins[CompareResultsNode.getPinnableId(p.path, p.ref1.ref, p.ref2.ref)] = {\n\t\t\t\t\ttype: 'comparison',\n\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\tpath: p.path,\n\t\t\t\t\tref1: p.ref1,\n\t\t\t\t\tref2: p.ref2,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tvoid this.container.storage.storeWorkspace(\n\t\t\t\tWorkspaceStorageKeys.ViewsSearchAndComparePinnedItems,\n\t\t\t\tsavedPins,\n\t\t\t);\n\t\t\tvoid this.container.storage.deleteWorkspace(WorkspaceStorageKeys.Deprecated_PinnedComparisons);\n\t\t}\n\n\t\tconst migratedPins = Object.create(null) as PinnedItems;\n\t\tlet migrated = false;\n\n\t\tconst root = this.ensureRoot();\n\t\tconst pins = Object.entries(savedPins)\n\t\t\t.sort(([, a], [, b]) => (b.timestamp ?? 0) - (a.timestamp ?? 0))\n\t\t\t.map(([k, p]) => {\n\t\t\t\tif (p.type === 'comparison') {\n\t\t\t\t\t// Migrated any old keys (sha1) to new keys (md5)\n\t\t\t\t\tconst key = CompareResultsNode.getPinnableId(p.path, p.ref1.ref, p.ref2.ref);\n\t\t\t\t\tif (k !== key) {\n\t\t\t\t\t\tmigrated = true;\n\t\t\t\t\t\tmigratedPins[key] = p;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmigratedPins[k] = p;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn new CompareResultsNode(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\troot,\n\t\t\t\t\t\tp.path,\n\t\t\t\t\t\t{ label: p.ref1.label, ref: p.ref1.ref ?? (p.ref1 as any).name ?? (p.ref1 as any).sha },\n\t\t\t\t\t\t{ label: p.ref2.label, ref: p.ref2.ref ?? (p.ref2 as any).name ?? (p.ref2 as any).sha },\n\t\t\t\t\t\tp.timestamp,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Migrated any old keys (sha1) to new keys (md5)\n\t\t\t\tconst key = SearchResultsNode.getPinnableId(p.path, p.search);\n\t\t\t\tif (k !== key) {\n\t\t\t\t\tmigrated = true;\n\t\t\t\t\tmigratedPins[key] = p;\n\t\t\t\t} else {\n\t\t\t\t\tmigratedPins[k] = p;\n\t\t\t\t}\n\n\t\t\t\treturn new SearchResultsNode(this, root, p.path, p.search, p.labels, undefined, p.timestamp);\n\t\t\t});\n\n\t\tif (migrated) {\n\t\t\tvoid this.container.storage.storeWorkspace(\n\t\t\t\tWorkspaceStorageKeys.ViewsSearchAndComparePinnedItems,\n\t\t\t\tmigratedPins,\n\t\t\t);\n\t\t}\n\t\treturn pins;\n\t}\n\n\tasync updatePinned(id: string, pin?: PinnedItem) {\n\t\tlet pinned = this.container.storage.getWorkspace<PinnedItems>(\n\t\t\tWorkspaceStorageKeys.ViewsSearchAndComparePinnedItems,\n\t\t);\n\t\tif (pinned == null) {\n\t\t\tpinned = Object.create(null) as PinnedItems;\n\t\t}\n\n\t\tif (pin != null) {\n\t\t\tpinned[id] = { ...pin };\n\t\t} else {\n\t\t\tconst { [id]: _, ...rest } = pinned;\n\t\t\tpinned = rest;\n\t\t}\n\n\t\tawait this.container.storage.storeWorkspace(WorkspaceStorageKeys.ViewsSearchAndComparePinnedItems, pinned);\n\n\t\tthis.triggerNodeChange(this.ensureRoot());\n\t}\n\n\t@gate(() => '')\n\tasync revealRepository(\n\t\trepoPath: string,\n\t\toptions?: { select?: boolean; focus?: boolean; expand?: boolean | number },\n\t) {\n\t\tconst node = await this.findNode(RepositoryFolderNode.getId(repoPath), {\n\t\t\tmaxDepth: 1,\n\t\t\tcanTraverse: n => n instanceof SearchAndCompareViewNode || n instanceof RepositoryFolderNode,\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\tprivate async addResults(\n\t\tresults: CompareResultsNode | SearchResultsNode,\n\t\toptions: {\n\t\t\texpand?: boolean | number;\n\t\t\tfocus?: boolean;\n\t\t\tselect?: boolean;\n\t\t} = { expand: true, focus: true, select: true },\n\t) {\n\t\tif (!this.visible) {\n\t\t\tawait this.show();\n\t\t}\n\n\t\tconst root = this.ensureRoot();\n\t\troot.addOrReplace(results, !this.keepResults);\n\n\t\tqueueMicrotask(() => this.reveal(results, options));\n\t}\n\n\tprivate setFilesLayout(layout: ViewFilesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.files.layout` as const, layout);\n\t}\n\n\tprivate setKeepResults(enabled: boolean) {\n\t\tvoid this.container.storage.storeWorkspace(WorkspaceStorageKeys.ViewsSearchAndCompareKeepResults, enabled);\n\t\tvoid setContext(ContextKeys.ViewsSearchAndCompareKeepResults, enabled);\n\t}\n\n\tprivate setShowAvatars(enabled: boolean) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.avatars` as const, enabled);\n\t}\n\n\tprivate pin(node: CompareResultsNode | SearchResultsNode) {\n\t\tif (!(node instanceof CompareResultsNode) && !(node instanceof SearchResultsNode)) return undefined;\n\n\t\treturn node.pin();\n\t}\n\n\tprivate setFilesFilter(node: ResultsFilesNode, filter: 'left' | 'right' | false) {\n\t\tif (!(node instanceof ResultsFilesNode)) return;\n\n\t\tnode.filter = filter;\n\t}\n\n\tprivate swapComparison(node: CompareResultsNode) {\n\t\tif (!(node instanceof CompareResultsNode)) return undefined;\n\n\t\treturn node.swap();\n\t}\n\n\tprivate unpin(node: CompareResultsNode | SearchResultsNode) {\n\t\tif (!(node instanceof CompareResultsNode) && !(node instanceof SearchResultsNode)) return undefined;\n\n\t\treturn node.unpin();\n\t}\n}\n","import {\n\tCancellationToken,\n\tcommands,\n\tConfigurationChangeEvent,\n\tDisposable,\n\tProgressLocation,\n\tTreeItem,\n\tTreeItemCollapsibleState,\n\twindow,\n} from 'vscode';\nimport { configuration, StashesViewConfig, ViewFilesLayout } from '../configuration';\nimport { Commands } from '../constants';\nimport { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport {\n\tGitReference,\n\tGitStashReference,\n\tRepositoryChange,\n\tRepositoryChangeComparisonMode,\n\tRepositoryChangeEvent,\n} from '../git/models';\nimport { executeCommand } from '../system/command';\nimport { gate } from '../system/decorators/gate';\nimport {\n\tRepositoriesSubscribeableNode,\n\tRepositoryFolderNode,\n\tRepositoryNode,\n\tStashesNode,\n\tStashNode,\n\tViewNode,\n} from './nodes';\nimport { ViewBase } from './viewBase';\n\nexport class StashesRepositoryNode extends RepositoryFolderNode<StashesView, StashesNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.child == null) {\n\t\t\tthis.child = new StashesNode(this.uri, this.view, this, this.repo);\n\t\t}\n\n\t\treturn this.child.getChildren();\n\t}\n\n\tprotected changed(e: RepositoryChangeEvent) {\n\t\treturn e.changed(RepositoryChange.Stash, RepositoryChange.Unknown, RepositoryChangeComparisonMode.Any);\n\t}\n}\n\nexport class StashesViewNode extends RepositoriesSubscribeableNode<StashesView, StashesRepositoryNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.children == null) {\n\t\t\tconst repositories = this.view.container.git.openRepositories;\n\t\t\tif (repositories.length === 0) {\n\t\t\t\tthis.view.message = 'No stashes could be found.';\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\n\t\t\tconst splat = repositories.length === 1;\n\t\t\tthis.children = repositories.map(\n\t\t\t\tr => new StashesRepositoryNode(GitUri.fromRepoPath(r.path), this.view, this, r, splat),\n\t\t\t);\n\t\t}\n\n\t\tif (this.children.length === 1) {\n\t\t\tconst [child] = this.children;\n\n\t\t\tconst stash = await child.repo.getStash();\n\t\t\tif (stash == null) {\n\t\t\t\tthis.view.message = 'No stashes could be found.';\n\t\t\t\tthis.view.title = 'Stashes';\n\n\t\t\t\tvoid child.ensureSubscription();\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\t\t\tthis.view.title = `Stashes (${stash?.commits.size ?? 0})`;\n\n\t\t\treturn child.getChildren();\n\t\t}\n\n\t\treturn this.children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Stashes', TreeItemCollapsibleState.Expanded);\n\t\treturn item;\n\t}\n}\n\nexport class StashesView extends ViewBase<StashesViewNode, StashesViewConfig> {\n\tprotected readonly configKey = 'stashes';\n\n\tconstructor(container: Container) {\n\t\tsuper('gitlens.views.stashes', 'Stashes', container);\n\t}\n\n\toverride get canReveal(): boolean {\n\t\treturn this.config.reveal || !configuration.get('views.repositories.showStashes');\n\t}\n\n\tprotected getRoot() {\n\t\treturn new StashesViewNode(this);\n\t}\n\n\tprotected registerCommands(): Disposable[] {\n\t\tvoid this.container.viewCommands;\n\n\t\treturn [\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('copy'),\n\t\t\t\t() => executeCommand(Commands.ViewsCopy, this.selection),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('refresh'),\n\t\t\t\t() => {\n\t\t\t\t\tthis.container.git.resetCaches('stashes');\n\t\t\t\t\treturn this.refresh(true);\n\t\t\t\t},\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToAuto'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Auto),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToList'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToTree'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\t}\n\n\tprotected override filterConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tconst changed = super.filterConfigurationChanged(e);\n\t\tif (\n\t\t\t!changed &&\n\t\t\t!configuration.changed(e, 'defaultDateFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateShortFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateSource') &&\n\t\t\t!configuration.changed(e, 'defaultDateStyle') &&\n\t\t\t!configuration.changed(e, 'defaultGravatarsStyle') &&\n\t\t\t!configuration.changed(e, 'defaultTimeFormat')\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfindStash(stash: GitStashReference, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(stash.repoPath);\n\n\t\treturn this.findNode(StashNode.getId(stash.repoPath, stash.ref), {\n\t\t\tmaxDepth: 2,\n\t\t\tcanTraverse: n => {\n\t\t\t\tif (n instanceof StashesViewNode) return true;\n\n\t\t\t\tif (n instanceof StashesRepositoryNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\t@gate(() => '')\n\tasync revealRepository(\n\t\trepoPath: string,\n\t\toptions?: { select?: boolean; focus?: boolean; expand?: boolean | number },\n\t) {\n\t\tconst node = await this.findNode(RepositoryFolderNode.getId(repoPath), {\n\t\t\tmaxDepth: 1,\n\t\t\tcanTraverse: n => n instanceof StashesViewNode || n instanceof RepositoryFolderNode,\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t@gate(() => '')\n\tasync revealStash(\n\t\tstash: GitStashReference,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing ${GitReference.toString(stash, { icon: false, quoted: true })} in the side bar...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findStash(stash, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\tprivate setFilesLayout(layout: ViewFilesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.files.layout` as const, layout);\n\t}\n}\n","import { commands, env, TextDocumentShowOptions, Uri, window } from 'vscode';\nimport type { CreatePullRequestActionContext, OpenPullRequestActionContext } from '../api/gitlens';\nimport type {\n\tDiffWithCommandArgs,\n\tDiffWithPreviousCommandArgs,\n\tDiffWithWorkingCommandArgs,\n\tOpenFileAtRevisionCommandArgs,\n} from '../commands';\nimport { GitActions } from '../commands/gitCommands.actions';\nimport { configuration, FileAnnotationType, ViewShowBranchComparison } from '../configuration';\nimport { Commands, ContextKeys, CoreCommands, CoreGitCommands } from '../constants';\nimport { Container } from '../container';\nimport { setContext } from '../context';\nimport { GitUri } from '../git/gitUri';\nimport { GitReference, GitRevision } from '../git/models';\nimport {\n\texecuteActionCommand,\n\texecuteCommand,\n\texecuteCoreCommand,\n\texecuteCoreGitCommand,\n\texecuteEditorCommand,\n} from '../system/command';\nimport { debug } from '../system/decorators/log';\nimport { OpenWorkspaceLocation } from '../system/utils';\nimport { runGitCommandInTerminal } from '../terminal';\nimport {\n\tBranchesNode,\n\tBranchNode,\n\tBranchTrackingStatusNode,\n\tcanClearNode,\n\tcanEditNode,\n\tcanViewDismissNode,\n\tCommitFileNode,\n\tCommitNode,\n\tCompareBranchNode,\n\tContributorNode,\n\tContributorsNode,\n\tFileHistoryNode,\n\tFileRevisionAsCommitNode,\n\tFolderNode,\n\tLineHistoryNode,\n\tMergeConflictFileNode,\n\tPageableViewNode,\n\tPagerNode,\n\tPullRequestNode,\n\tRemoteNode,\n\tRemotesNode,\n\tRepositoryFolderNode,\n\tRepositoryNode,\n\tResultsFileNode,\n\tResultsFilesNode,\n\tStashFileNode,\n\tStashNode,\n\tStatusFileNode,\n\tTagNode,\n\tTagsNode,\n\tViewNode,\n\tViewRefFileNode,\n\tViewRefNode,\n\tWorktreeNode,\n\tWorktreesNode,\n} from './nodes';\n\ninterface CompareSelectedInfo {\n\tref: string;\n\trepoPath: string | undefined;\n\turi?: Uri;\n}\n\nexport class ViewCommands {\n\tconstructor(private readonly container: Container) {\n\t\tcommands.registerCommand('gitlens.views.clearNode', (n: ViewNode) => canClearNode(n) && n.clear(), this);\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.copy',\n\t\t\tasync (selection: ViewNode | ViewNode[]) => {\n\t\t\t\tselection = Array.isArray(selection) ? selection : [selection];\n\t\t\t\tif (selection.length === 0) return;\n\n\t\t\t\tconst data = selection\n\t\t\t\t\t.map(n => n.toClipboard?.())\n\t\t\t\t\t.filter(s => s != null && s.length > 0)\n\t\t\t\t\t.join(',');\n\t\t\t\tawait env.clipboard.writeText(data);\n\t\t\t},\n\t\t\tthis,\n\t\t);\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.dismissNode',\n\t\t\t(n: ViewNode) => canViewDismissNode(n.view) && n.view.dismissNode(n),\n\t\t\tthis,\n\t\t);\n\t\tcommands.registerCommand('gitlens.views.editNode', (n: ViewNode) => canEditNode(n) && n.edit(), this);\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.expandNode',\n\t\t\t(n: ViewNode) => n.view.reveal(n, { select: false, focus: false, expand: 3 }),\n\t\t\tthis,\n\t\t);\n\t\tcommands.registerCommand('gitlens.views.loadMoreChildren', (n: PagerNode) => n.loadMore(), this);\n\t\tcommands.registerCommand('gitlens.views.loadAllChildren', (n: PagerNode) => n.loadAll(), this);\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.refreshNode',\n\t\t\t(n: ViewNode, reset?: boolean) => {\n\t\t\t\tif (reset == null && PageableViewNode.is(n)) {\n\t\t\t\t\tn.limit = undefined;\n\t\t\t\t\tn.view.resetNodeLastKnownLimit(n);\n\t\t\t\t}\n\n\t\t\t\treturn n.view.refreshNode(n, reset == null ? true : reset);\n\t\t\t},\n\t\t\tthis,\n\t\t);\n\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.setShowRelativeDateMarkersOn',\n\t\t\t() => this.setShowRelativeDateMarkers(true),\n\t\t\tthis,\n\t\t);\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.setShowRelativeDateMarkersOff',\n\t\t\t() => this.setShowRelativeDateMarkers(false),\n\t\t\tthis,\n\t\t);\n\n\t\tcommands.registerCommand('gitlens.views.fetch', this.fetch, this);\n\t\tcommands.registerCommand('gitlens.views.publishBranch', this.publishBranch, this);\n\t\tcommands.registerCommand('gitlens.views.publishRepository', this.publishRepository, this);\n\t\tcommands.registerCommand('gitlens.views.pull', this.pull, this);\n\t\tcommands.registerCommand('gitlens.views.push', this.push, this);\n\t\tcommands.registerCommand('gitlens.views.pushWithForce', n => this.push(n, true), this);\n\t\tcommands.registerCommand('gitlens.views.closeRepository', this.closeRepository, this);\n\n\t\tcommands.registerCommand('gitlens.views.setAsDefault', this.setAsDefault, this);\n\t\tcommands.registerCommand('gitlens.views.unsetAsDefault', this.unsetAsDefault, this);\n\n\t\tcommands.registerCommand('gitlens.views.openInTerminal', this.openInTerminal, this);\n\t\tcommands.registerCommand('gitlens.views.star', this.star, this);\n\t\tcommands.registerCommand('gitlens.views.unstar', this.unstar, this);\n\n\t\tcommands.registerCommand('gitlens.views.browseRepoAtRevision', this.browseRepoAtRevision, this);\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.browseRepoAtRevisionInNewWindow',\n\t\t\tn => this.browseRepoAtRevision(n, { openInNewWindow: true }),\n\t\t\tthis,\n\t\t);\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.browseRepoBeforeRevision',\n\t\t\tn => this.browseRepoAtRevision(n, { before: true }),\n\t\t\tthis,\n\t\t);\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.browseRepoBeforeRevisionInNewWindow',\n\t\t\tn => this.browseRepoAtRevision(n, { before: true, openInNewWindow: true }),\n\t\t\tthis,\n\t\t);\n\n\t\tcommands.registerCommand('gitlens.views.addAuthors', this.addAuthors, this);\n\t\tcommands.registerCommand('gitlens.views.addAuthor', this.addAuthors, this);\n\n\t\tcommands.registerCommand('gitlens.views.openChanges', this.openChanges, this);\n\t\tcommands.registerCommand('gitlens.views.openChangesWithWorking', this.openChangesWithWorking, this);\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.openPreviousChangesWithWorking',\n\t\t\tthis.openPreviousChangesWithWorking,\n\t\t\tthis,\n\t\t);\n\t\tcommands.registerCommand('gitlens.views.openFile', this.openFile, this);\n\t\tcommands.registerCommand('gitlens.views.openFileRevision', this.openRevision, this);\n\t\tcommands.registerCommand('gitlens.views.openChangedFiles', this.openFiles, this);\n\t\tcommands.registerCommand('gitlens.views.openChangedFileDiffs', this.openAllChanges, this);\n\t\tcommands.registerCommand('gitlens.views.openChangedFileDiffsWithWorking', this.openAllChangesWithWorking, this);\n\t\tcommands.registerCommand('gitlens.views.openChangedFileRevisions', this.openRevisions, this);\n\t\tcommands.registerCommand('gitlens.views.applyChanges', this.applyChanges, this);\n\t\tcommands.registerCommand('gitlens.views.highlightChanges', this.highlightChanges, this);\n\t\tcommands.registerCommand('gitlens.views.highlightRevisionChanges', this.highlightRevisionChanges, this);\n\t\tcommands.registerCommand('gitlens.views.restore', this.restore, this);\n\t\tcommands.registerCommand('gitlens.views.switchToBranch', this.switch, this);\n\t\tcommands.registerCommand('gitlens.views.switchToAnotherBranch', this.switch, this);\n\t\tcommands.registerCommand('gitlens.views.switchToCommit', this.switch, this);\n\t\tcommands.registerCommand('gitlens.views.switchToTag', this.switch, this);\n\t\tcommands.registerCommand('gitlens.views.addRemote', this.addRemote, this);\n\t\tcommands.registerCommand('gitlens.views.pruneRemote', this.pruneRemote, this);\n\n\t\tcommands.registerCommand('gitlens.views.stageDirectory', this.stageDirectory, this);\n\t\tcommands.registerCommand('gitlens.views.stageFile', this.stageFile, this);\n\t\tcommands.registerCommand('gitlens.views.unstageDirectory', this.unstageDirectory, this);\n\t\tcommands.registerCommand('gitlens.views.unstageFile', this.unstageFile, this);\n\n\t\tcommands.registerCommand('gitlens.views.compareAncestryWithWorking', this.compareAncestryWithWorking, this);\n\t\tcommands.registerCommand('gitlens.views.compareWithHead', this.compareHeadWith, this);\n\t\tcommands.registerCommand('gitlens.views.compareWithUpstream', this.compareWithUpstream, this);\n\t\tcommands.registerCommand('gitlens.views.compareWithSelected', this.compareWithSelected, this);\n\t\tcommands.registerCommand('gitlens.views.selectForCompare', this.selectForCompare, this);\n\t\tcommands.registerCommand('gitlens.views.compareFileWithSelected', this.compareFileWithSelected, this);\n\t\tcommands.registerCommand('gitlens.views.selectFileForCompare', this.selectFileForCompare, this);\n\t\tcommands.registerCommand('gitlens.views.compareWithWorking', this.compareWorkingWith, this);\n\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.setBranchComparisonToWorking',\n\t\t\tn => this.setBranchComparison(n, ViewShowBranchComparison.Working),\n\t\t\tthis,\n\t\t);\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.setBranchComparisonToBranch',\n\t\t\tn => this.setBranchComparison(n, ViewShowBranchComparison.Branch),\n\t\t\tthis,\n\t\t);\n\n\t\tcommands.registerCommand('gitlens.views.cherryPick', this.cherryPick, this);\n\t\tcommands.registerCommand('gitlens.views.createBranch', this.createBranch, this);\n\t\tcommands.registerCommand('gitlens.views.deleteBranch', this.deleteBranch, this);\n\t\tcommands.registerCommand('gitlens.views.renameBranch', this.renameBranch, this);\n\t\tcommands.registerCommand('gitlens.views.deleteStash', this.deleteStash, this);\n\t\tcommands.registerCommand('gitlens.views.createTag', this.createTag, this);\n\t\tcommands.registerCommand('gitlens.views.deleteTag', this.deleteTag, this);\n\n\t\tcommands.registerCommand('gitlens.views.mergeBranchInto', this.merge, this);\n\t\tcommands.registerCommand('gitlens.views.pushToCommit', this.pushToCommit, this);\n\n\t\tcommands.registerCommand('gitlens.views.rebaseOntoBranch', this.rebase, this);\n\t\tcommands.registerCommand('gitlens.views.rebaseOntoUpstream', this.rebaseToRemote, this);\n\t\tcommands.registerCommand('gitlens.views.rebaseOntoCommit', this.rebase, this);\n\n\t\tcommands.registerCommand('gitlens.views.resetCommit', this.resetCommit, this);\n\t\tcommands.registerCommand('gitlens.views.resetToCommit', this.resetToCommit, this);\n\t\tcommands.registerCommand('gitlens.views.revert', this.revert, this);\n\t\tcommands.registerCommand('gitlens.views.undoCommit', this.undoCommit, this);\n\n\t\tcommands.registerCommand('gitlens.views.terminalRemoveRemote', this.terminalRemoveRemote, this);\n\n\t\tcommands.registerCommand('gitlens.views.createPullRequest', this.createPullRequest, this);\n\t\tcommands.registerCommand('gitlens.views.openPullRequest', this.openPullRequest, this);\n\n\t\tcommands.registerCommand('gitlens.views.createWorktree', this.createWorktree, this);\n\t\tcommands.registerCommand('gitlens.views.deleteWorktree', this.deleteWorktree, this);\n\t\tcommands.registerCommand('gitlens.views.openWorktree', this.openWorktree, this);\n\t\tcommands.registerCommand('gitlens.views.revealWorktreeInExplorer', this.revealWorktreeInExplorer, this);\n\t\tcommands.registerCommand(\n\t\t\t'gitlens.views.openWorktreeInNewWindow',\n\t\t\tn => this.openWorktree(n, { location: OpenWorkspaceLocation.NewWindow }),\n\t\t\tthis,\n\t\t);\n\t}\n\n\t@debug()\n\tprivate addAuthors(node?: ContributorNode | ContributorsNode) {\n\t\tif (node != null && !(node instanceof ContributorNode) && !(node instanceof ContributorsNode)) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn GitActions.Contributor.addAuthors(\n\t\t\tnode?.uri.repoPath,\n\t\t\tnode instanceof ContributorNode ? node.contributor : undefined,\n\t\t);\n\t}\n\n\t@debug()\n\tprivate addRemote(node?: RemotesNode) {\n\t\treturn GitActions.Remote.add(node?.repoPath);\n\t}\n\n\t@debug()\n\tprivate applyChanges(node: ViewRefFileNode) {\n\t\tif (!(node instanceof ViewRefFileNode)) return Promise.resolve();\n\n\t\tif (node instanceof ResultsFileNode) {\n\t\t\treturn GitActions.Commit.applyChanges(\n\t\t\t\tnode.file,\n\t\t\t\tGitReference.create(node.ref1, node.repoPath),\n\t\t\t\tGitReference.create(node.ref2, node.repoPath),\n\t\t\t);\n\t\t}\n\n\t\tif (node.ref == null || node.ref.ref === 'HEAD') return Promise.resolve();\n\n\t\treturn GitActions.Commit.applyChanges(node.file, node.ref);\n\t}\n\n\t@debug()\n\tprivate browseRepoAtRevision(node: ViewRefNode, options?: { before?: boolean; openInNewWindow?: boolean }) {\n\t\tif (!(node instanceof ViewRefNode)) return Promise.resolve();\n\n\t\treturn GitActions.browseAtRevision(node.uri, {\n\t\t\tbefore: options?.before,\n\t\t\topenInNewWindow: options?.openInNewWindow,\n\t\t});\n\t}\n\n\t@debug()\n\tprivate cherryPick(node: CommitNode) {\n\t\tif (!(node instanceof CommitNode)) return Promise.resolve();\n\n\t\treturn GitActions.cherryPick(node.repoPath, node.ref);\n\t}\n\n\t@debug()\n\tprivate closeRepository(node: RepositoryNode | RepositoryFolderNode) {\n\t\tif (!(node instanceof RepositoryNode) && !(node instanceof RepositoryFolderNode)) return;\n\n\t\tnode.repo.closed = true;\n\t}\n\n\t@debug()\n\tprivate async createBranch(node?: ViewRefNode | BranchesNode | BranchTrackingStatusNode) {\n\t\tlet from =\n\t\t\tnode instanceof ViewRefNode\n\t\t\t\t? node?.ref\n\t\t\t\t: node instanceof BranchTrackingStatusNode\n\t\t\t\t? node.branch\n\t\t\t\t: undefined;\n\t\tif (from == null) {\n\t\t\tconst branch = await this.container.git.getBranch(\n\t\t\t\tnode?.repoPath ?? this.container.git.getBestRepository()?.uri,\n\t\t\t);\n\t\t\tfrom = branch;\n\t\t}\n\t\treturn GitActions.Branch.create(node?.repoPath, from);\n\t}\n\n\t@debug()\n\tprivate async createWorktree(node?: BranchNode | WorktreesNode) {\n\t\tif (node instanceof WorktreesNode) {\n\t\t\tnode = undefined;\n\t\t}\n\t\tif (node != null && !(node instanceof BranchNode)) return undefined;\n\n\t\treturn GitActions.Worktree.create(node?.repoPath, undefined, node?.ref);\n\t}\n\n\t@debug()\n\tprivate openWorktree(node: WorktreeNode, options?: { location?: OpenWorkspaceLocation }) {\n\t\tif (!(node instanceof WorktreeNode)) return undefined;\n\n\t\treturn GitActions.Worktree.open(node.worktree, options);\n\t}\n\n\t@debug()\n\tprivate revealWorktreeInExplorer(node: WorktreeNode) {\n\t\tif (!(node instanceof WorktreeNode)) return undefined;\n\n\t\treturn GitActions.Worktree.revealInFileExplorer(node.worktree);\n\t}\n\n\t@debug()\n\tprivate async deleteWorktree(node: WorktreeNode) {\n\t\tif (!(node instanceof WorktreeNode)) return undefined;\n\n\t\treturn GitActions.Worktree.remove(node.repoPath, node.worktree.uri);\n\t}\n\n\t@debug()\n\tprivate async createPullRequest(node: BranchNode | BranchTrackingStatusNode) {\n\t\tif (!(node instanceof BranchNode) && !(node instanceof BranchTrackingStatusNode)) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst remote = await node.branch.getRemote();\n\n\t\treturn executeActionCommand<CreatePullRequestActionContext>('createPullRequest', {\n\t\t\trepoPath: node.repoPath,\n\t\t\tremote:\n\t\t\t\tremote != null\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tname: remote.name,\n\t\t\t\t\t\t\tprovider:\n\t\t\t\t\t\t\t\tremote.provider != null\n\t\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\t\tid: remote.provider.id,\n\t\t\t\t\t\t\t\t\t\t\tname: remote.provider.name,\n\t\t\t\t\t\t\t\t\t\t\tdomain: remote.provider.domain,\n\t\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\turl: remote.url,\n\t\t\t\t\t  }\n\t\t\t\t\t: undefined,\n\t\t\tbranch: {\n\t\t\t\tname: node.branch.name,\n\t\t\t\tupstream: node.branch.upstream?.name,\n\t\t\t\tisRemote: node.branch.remote,\n\t\t\t},\n\t\t});\n\t}\n\n\t@debug()\n\tprivate async createTag(node?: ViewRefNode | TagsNode | BranchTrackingStatusNode) {\n\t\tlet from =\n\t\t\tnode instanceof ViewRefNode\n\t\t\t\t? node?.ref\n\t\t\t\t: node instanceof BranchTrackingStatusNode\n\t\t\t\t? node.branch\n\t\t\t\t: undefined;\n\t\tif (from == null) {\n\t\t\tconst branch = await this.container.git.getBranch(\n\t\t\t\tnode?.repoPath ?? this.container.git.getBestRepository()?.uri,\n\t\t\t);\n\t\t\tfrom = branch;\n\t\t}\n\t\treturn GitActions.Tag.create(node?.repoPath, from);\n\t}\n\n\t@debug()\n\tprivate deleteBranch(node: BranchNode) {\n\t\tif (!(node instanceof BranchNode)) return Promise.resolve();\n\n\t\treturn GitActions.Branch.remove(node.repoPath, node.branch);\n\t}\n\n\t@debug()\n\tprivate deleteStash(node: StashNode) {\n\t\tif (!(node instanceof StashNode)) return Promise.resolve();\n\n\t\treturn GitActions.Stash.drop(node.repoPath, node.commit);\n\t}\n\n\t@debug()\n\tprivate deleteTag(node: TagNode) {\n\t\tif (!(node instanceof TagNode)) return Promise.resolve();\n\n\t\treturn GitActions.Tag.remove(node.repoPath, node.tag);\n\t}\n\n\t@debug()\n\tprivate fetch(node: RemoteNode | RepositoryNode | RepositoryFolderNode | BranchNode | BranchTrackingStatusNode) {\n\t\tif (node instanceof RepositoryNode || node instanceof RepositoryFolderNode) return GitActions.fetch(node.repo);\n\t\tif (node instanceof RemoteNode) return GitActions.Remote.fetch(node.remote.repoPath, node.remote.name);\n\t\tif (node instanceof BranchNode || node instanceof BranchTrackingStatusNode) {\n\t\t\treturn GitActions.fetch(node.repoPath, node.root ? undefined : node.branch);\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\t@debug()\n\tprivate async highlightChanges(node: CommitFileNode | StashFileNode | FileRevisionAsCommitNode | ResultsFileNode) {\n\t\tif (\n\t\t\t!(node instanceof CommitFileNode) &&\n\t\t\t!(node instanceof StashFileNode) &&\n\t\t\t!(node instanceof FileRevisionAsCommitNode) &&\n\t\t\t!(node instanceof ResultsFileNode)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid (await this.openFile(node, { preserveFocus: true, preview: true }));\n\t\tvoid (await this.container.fileAnnotations.toggle(\n\t\t\twindow.activeTextEditor,\n\t\t\tFileAnnotationType.Changes,\n\t\t\t{ sha: node.ref.ref },\n\t\t\ttrue,\n\t\t));\n\t}\n\n\t@debug()\n\tprivate async highlightRevisionChanges(\n\t\tnode: CommitFileNode | StashFileNode | FileRevisionAsCommitNode | ResultsFileNode,\n\t) {\n\t\tif (\n\t\t\t!(node instanceof CommitFileNode) &&\n\t\t\t!(node instanceof StashFileNode) &&\n\t\t\t!(node instanceof FileRevisionAsCommitNode) &&\n\t\t\t!(node instanceof ResultsFileNode)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid (await this.openFile(node, { preserveFocus: true, preview: true }));\n\t\tvoid (await this.container.fileAnnotations.toggle(\n\t\t\twindow.activeTextEditor,\n\t\t\tFileAnnotationType.Changes,\n\t\t\t{ sha: node.ref.ref, only: true },\n\t\t\ttrue,\n\t\t));\n\t}\n\n\t@debug()\n\tprivate merge(node: BranchNode | TagNode) {\n\t\tif (!(node instanceof BranchNode) && !(node instanceof TagNode)) return Promise.resolve();\n\n\t\treturn GitActions.merge(node.repoPath, node instanceof BranchNode ? node.branch : node.tag);\n\t}\n\n\t@debug()\n\tprivate pushToCommit(node: CommitNode | FileRevisionAsCommitNode) {\n\t\tif (!(node instanceof CommitNode) && !(node instanceof FileRevisionAsCommitNode)) return Promise.resolve();\n\n\t\treturn GitActions.push(node.repoPath, false, node.commit);\n\t}\n\n\t@debug()\n\tprivate openPullRequest(node: PullRequestNode) {\n\t\tif (!(node instanceof PullRequestNode)) return Promise.resolve();\n\n\t\treturn executeActionCommand<OpenPullRequestActionContext>('openPullRequest', {\n\t\t\trepoPath: node.uri.repoPath!,\n\t\t\tprovider: {\n\t\t\t\tid: node.pullRequest.provider.id,\n\t\t\t\tname: node.pullRequest.provider.name,\n\t\t\t\tdomain: node.pullRequest.provider.domain,\n\t\t\t},\n\t\t\tpullRequest: {\n\t\t\t\tid: node.pullRequest.id,\n\t\t\t\turl: node.pullRequest.url,\n\t\t\t},\n\t\t});\n\t}\n\n\t@debug()\n\tprivate openInTerminal(node: RepositoryNode | RepositoryFolderNode) {\n\t\tif (!(node instanceof RepositoryNode) && !(node instanceof RepositoryFolderNode)) return Promise.resolve();\n\n\t\treturn executeCoreCommand(CoreCommands.OpenInTerminal, Uri.file(node.repo.path));\n\t}\n\n\t@debug()\n\tprivate async pruneRemote(node: RemoteNode) {\n\t\tif (!(node instanceof RemoteNode)) return Promise.resolve();\n\n\t\treturn GitActions.Remote.prune(node.repo, node.remote.name);\n\t}\n\n\t@debug()\n\tprivate publishBranch(node: BranchNode | BranchTrackingStatusNode) {\n\t\tif (node instanceof BranchNode || node instanceof BranchTrackingStatusNode) {\n\t\t\treturn GitActions.push(node.repoPath, undefined, node.branch);\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t@debug()\n\tprivate publishRepository(node: BranchNode | BranchTrackingStatusNode) {\n\t\tif (node instanceof BranchNode || node instanceof BranchTrackingStatusNode) {\n\t\t\treturn executeCoreGitCommand(CoreGitCommands.Publish, Uri.file(node.repoPath));\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t@debug()\n\tprivate pull(node: RepositoryNode | RepositoryFolderNode | BranchNode | BranchTrackingStatusNode) {\n\t\tif (node instanceof RepositoryNode || node instanceof RepositoryFolderNode) return GitActions.pull(node.repo);\n\t\tif (node instanceof BranchNode || node instanceof BranchTrackingStatusNode) {\n\t\t\treturn GitActions.pull(node.repoPath, node.root ? undefined : node.branch);\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\t@debug()\n\tprivate push(\n\t\tnode:\n\t\t\t| RepositoryNode\n\t\t\t| RepositoryFolderNode\n\t\t\t| BranchNode\n\t\t\t| BranchTrackingStatusNode\n\t\t\t| CommitNode\n\t\t\t| FileRevisionAsCommitNode,\n\t\tforce?: boolean,\n\t) {\n\t\tif (node instanceof RepositoryNode || node instanceof RepositoryFolderNode) {\n\t\t\treturn GitActions.push(node.repo, force);\n\t\t}\n\n\t\tif (node instanceof BranchNode || node instanceof BranchTrackingStatusNode) {\n\t\t\treturn GitActions.push(node.repoPath, undefined, node.root ? undefined : node.branch);\n\t\t}\n\n\t\tif (node instanceof CommitNode || node instanceof FileRevisionAsCommitNode) {\n\t\t\tif (node.isTip) {\n\t\t\t\treturn GitActions.push(node.repoPath, force);\n\t\t\t}\n\n\t\t\treturn this.pushToCommit(node);\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\t@debug()\n\tprivate rebase(node: BranchNode | CommitNode | FileRevisionAsCommitNode | TagNode) {\n\t\tif (\n\t\t\t!(node instanceof BranchNode) &&\n\t\t\t!(node instanceof CommitNode) &&\n\t\t\t!(node instanceof FileRevisionAsCommitNode) &&\n\t\t\t!(node instanceof TagNode)\n\t\t) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn GitActions.rebase(node.repoPath, node.ref);\n\t}\n\n\t@debug()\n\tprivate rebaseToRemote(node: BranchNode | BranchTrackingStatusNode) {\n\t\tif (!(node instanceof BranchNode) && !(node instanceof BranchTrackingStatusNode)) return Promise.resolve();\n\n\t\tconst upstream = node instanceof BranchNode ? node.branch.upstream?.name : node.status.upstream;\n\t\tif (upstream == null) return Promise.resolve();\n\n\t\treturn GitActions.rebase(\n\t\t\tnode.repoPath,\n\t\t\tGitReference.create(upstream, node.repoPath, {\n\t\t\t\trefType: 'branch',\n\t\t\t\tname: upstream,\n\t\t\t\tremote: true,\n\t\t\t}),\n\t\t);\n\t}\n\n\t@debug()\n\tprivate renameBranch(node: BranchNode) {\n\t\tif (!(node instanceof BranchNode)) return Promise.resolve();\n\n\t\treturn GitActions.Branch.rename(node.repoPath, node.branch);\n\t}\n\n\t@debug()\n\tprivate resetCommit(node: CommitNode | FileRevisionAsCommitNode) {\n\t\tif (!(node instanceof CommitNode) && !(node instanceof FileRevisionAsCommitNode)) return Promise.resolve();\n\n\t\treturn GitActions.reset(\n\t\t\tnode.repoPath,\n\t\t\tGitReference.create(`${node.ref.ref}^`, node.ref.repoPath, {\n\t\t\t\trefType: 'revision',\n\t\t\t\tname: `${node.ref.name}^`,\n\t\t\t\tmessage: node.ref.message,\n\t\t\t}),\n\t\t);\n\t}\n\n\t@debug()\n\tprivate resetToCommit(node: CommitNode | FileRevisionAsCommitNode) {\n\t\tif (!(node instanceof CommitNode) && !(node instanceof FileRevisionAsCommitNode)) return Promise.resolve();\n\n\t\treturn GitActions.reset(node.repoPath, node.ref);\n\t}\n\n\t@debug()\n\tprivate restore(node: ViewRefFileNode) {\n\t\tif (!(node instanceof ViewRefFileNode)) return Promise.resolve();\n\n\t\treturn GitActions.Commit.restoreFile(node.fileName, node.ref);\n\t}\n\n\t@debug()\n\tprivate revert(node: CommitNode | FileRevisionAsCommitNode) {\n\t\tif (!(node instanceof CommitNode) && !(node instanceof FileRevisionAsCommitNode)) return Promise.resolve();\n\n\t\treturn GitActions.revert(node.repoPath, node.ref);\n\t}\n\n\t@debug()\n\tprivate setAsDefault(node: RemoteNode) {\n\t\tif (!(node instanceof RemoteNode)) return Promise.resolve();\n\n\t\treturn node.setAsDefault();\n\t}\n\n\t@debug()\n\tprivate setBranchComparison(node: ViewNode, comparisonType: Exclude<ViewShowBranchComparison, false>) {\n\t\tif (!(node instanceof CompareBranchNode)) return undefined;\n\n\t\treturn node.setComparisonType(comparisonType);\n\t}\n\n\t@debug()\n\tprivate setShowRelativeDateMarkers(enabled: boolean) {\n\t\treturn configuration.updateEffective('views.showRelativeDateMarkers', enabled);\n\t}\n\n\t@debug()\n\tprivate async stageFile(node: CommitFileNode | FileRevisionAsCommitNode | StatusFileNode) {\n\t\tif (\n\t\t\t!(node instanceof CommitFileNode) &&\n\t\t\t!(node instanceof FileRevisionAsCommitNode) &&\n\t\t\t!(node instanceof StatusFileNode)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid (await this.container.git.stageFile(node.repoPath, node.file.path));\n\t\tvoid node.triggerChange();\n\t}\n\n\t@debug()\n\tprivate async stageDirectory(node: FolderNode) {\n\t\tif (!(node instanceof FolderNode) || !node.relativePath) return;\n\n\t\tvoid (await this.container.git.stageDirectory(node.repoPath, node.relativePath));\n\t\tvoid node.triggerChange();\n\t}\n\n\t@debug()\n\tprivate star(node: BranchNode | RepositoryNode | RepositoryFolderNode) {\n\t\tif (\n\t\t\t!(node instanceof BranchNode) &&\n\t\t\t!(node instanceof RepositoryNode) &&\n\t\t\t!(node instanceof RepositoryFolderNode)\n\t\t) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn node.star();\n\t}\n\n\t@debug()\n\tprivate switch(node?: ViewRefNode | BranchesNode) {\n\t\tif (node == null) {\n\t\t\treturn GitActions.switchTo(this.container.git.highlander);\n\t\t}\n\n\t\tif (!(node instanceof ViewRefNode) && !(node instanceof BranchesNode)) return Promise.resolve();\n\n\t\treturn GitActions.switchTo(\n\t\t\tnode.repoPath,\n\t\t\tnode instanceof BranchesNode || (node instanceof BranchNode && node.branch.current) ? undefined : node.ref,\n\t\t);\n\t}\n\n\t@debug()\n\tprivate async undoCommit(node: CommitNode | FileRevisionAsCommitNode) {\n\t\tif (!(node instanceof CommitNode) && !(node instanceof FileRevisionAsCommitNode)) return;\n\n\t\tconst repo = await Container.instance.git.getOrOpenScmRepository(node.repoPath);\n\t\tconst commit = await repo?.getCommit('HEAD');\n\n\t\tif (commit?.hash !== node.ref.ref) {\n\t\t\tvoid window.showWarningMessage(\n\t\t\t\t`Commit ${GitReference.toString(node.ref, {\n\t\t\t\t\tcapitalize: true,\n\t\t\t\t\ticon: false,\n\t\t\t\t})} cannot be undone, because it is no longer the most recent commit.`,\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tawait executeCoreGitCommand(CoreGitCommands.UndoCommit, node.repoPath);\n\t}\n\n\t@debug()\n\tprivate unsetAsDefault(node: RemoteNode) {\n\t\tif (!(node instanceof RemoteNode)) return Promise.resolve();\n\n\t\treturn node.setAsDefault(false);\n\t}\n\n\t@debug()\n\tprivate async unstageFile(node: CommitFileNode | FileRevisionAsCommitNode | StatusFileNode) {\n\t\tif (\n\t\t\t!(node instanceof CommitFileNode) &&\n\t\t\t!(node instanceof FileRevisionAsCommitNode) &&\n\t\t\t!(node instanceof StatusFileNode)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid (await this.container.git.unStageFile(node.repoPath, node.file.path));\n\t\tvoid node.triggerChange();\n\t}\n\n\t@debug()\n\tprivate async unstageDirectory(node: FolderNode) {\n\t\tif (!(node instanceof FolderNode) || !node.relativePath) return;\n\n\t\tvoid (await this.container.git.unStageDirectory(node.repoPath, node.relativePath));\n\t\tvoid node.triggerChange();\n\t}\n\n\t@debug()\n\tprivate unstar(node: BranchNode | RepositoryNode | RepositoryFolderNode) {\n\t\tif (\n\t\t\t!(node instanceof BranchNode) &&\n\t\t\t!(node instanceof RepositoryNode) &&\n\t\t\t!(node instanceof RepositoryFolderNode)\n\t\t) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn node.unstar();\n\t}\n\n\t@debug()\n\tprivate compareHeadWith(node: ViewRefNode) {\n\t\tif (!(node instanceof ViewRefNode)) return Promise.resolve();\n\n\t\treturn this.container.searchAndCompareView.compare(node.repoPath, 'HEAD', node.ref);\n\t}\n\n\t@debug()\n\tprivate compareWithUpstream(node: BranchNode) {\n\t\tif (!(node instanceof BranchNode)) return Promise.resolve();\n\t\tif (node.branch.upstream == null) return Promise.resolve();\n\n\t\treturn this.container.searchAndCompareView.compare(node.repoPath, node.ref, node.branch.upstream.name);\n\t}\n\n\t@debug()\n\tprivate compareWorkingWith(node: ViewRefNode) {\n\t\tif (!(node instanceof ViewRefNode)) return Promise.resolve();\n\n\t\treturn this.container.searchAndCompareView.compare(node.repoPath, '', node.ref);\n\t}\n\n\t@debug()\n\tprivate async compareAncestryWithWorking(node: BranchNode) {\n\t\tif (!(node instanceof BranchNode)) return undefined;\n\n\t\tconst branch = await this.container.git.getBranch(node.repoPath);\n\t\tif (branch == null) return undefined;\n\n\t\tconst commonAncestor = await this.container.git.getMergeBase(node.repoPath, branch.ref, node.ref.ref);\n\t\tif (commonAncestor == null) return undefined;\n\n\t\treturn this.container.searchAndCompareView.compare(\n\t\t\tnode.repoPath,\n\t\t\t{ ref: commonAncestor, label: `ancestry with ${node.ref.ref} (${GitRevision.shorten(commonAncestor)})` },\n\t\t\t'',\n\t\t);\n\t}\n\n\t@debug()\n\tprivate compareWithSelected(node: ViewRefNode) {\n\t\tif (!(node instanceof ViewRefNode)) return;\n\n\t\tthis.container.searchAndCompareView.compareWithSelected(node.repoPath, node.ref);\n\t}\n\n\t@debug()\n\tprivate selectForCompare(node: ViewRefNode) {\n\t\tif (!(node instanceof ViewRefNode)) return;\n\n\t\tthis.container.searchAndCompareView.selectForCompare(node.repoPath, node.ref);\n\t}\n\n\t@debug()\n\tprivate compareFileWithSelected(node: ViewRefFileNode) {\n\t\tif (this._selectedFile == null || !(node instanceof ViewRefFileNode) || node.ref == null) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tif (this._selectedFile.repoPath !== node.repoPath) {\n\t\t\tthis.selectFileForCompare(node);\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst selected = this._selectedFile;\n\n\t\tthis._selectedFile = undefined;\n\t\tvoid setContext(ContextKeys.ViewsCanCompareFile, false);\n\n\t\treturn executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\trepoPath: selected.repoPath,\n\t\t\tlhs: {\n\t\t\t\tsha: selected.ref,\n\t\t\t\turi: selected.uri!,\n\t\t\t},\n\t\t\trhs: {\n\t\t\t\tsha: node.ref.ref,\n\t\t\t\turi: node.uri,\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate _selectedFile: CompareSelectedInfo | undefined;\n\n\t@debug()\n\tprivate selectFileForCompare(node: ViewRefFileNode) {\n\t\tif (!(node instanceof ViewRefFileNode) || node.ref == null) return;\n\n\t\tthis._selectedFile = {\n\t\t\tref: node.ref.ref,\n\t\t\trepoPath: node.repoPath,\n\t\t\turi: node.uri,\n\t\t};\n\t\tvoid setContext(ContextKeys.ViewsCanCompareFile, true);\n\t}\n\n\t@debug()\n\tprivate async openAllChanges(node: CommitNode | StashNode | ResultsFilesNode, options?: TextDocumentShowOptions) {\n\t\tif (!(node instanceof CommitNode) && !(node instanceof StashNode) && !(node instanceof ResultsFilesNode)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (node instanceof ResultsFilesNode) {\n\t\t\tconst { files: diff } = await node.getFilesQueryResults();\n\t\t\tif (diff == null || diff.length === 0) return undefined;\n\n\t\t\treturn GitActions.Commit.openAllChanges(\n\t\t\t\tdiff,\n\t\t\t\t{\n\t\t\t\t\trepoPath: node.repoPath,\n\t\t\t\t\tref1: node.ref1,\n\t\t\t\t\tref2: node.ref2,\n\t\t\t\t},\n\t\t\t\toptions,\n\t\t\t);\n\t\t}\n\n\t\treturn GitActions.Commit.openAllChanges(node.commit, options);\n\t}\n\n\t@debug()\n\tprivate openChanges(node: ViewRefFileNode | MergeConflictFileNode | StatusFileNode) {\n\t\tif (\n\t\t\t!(node instanceof ViewRefFileNode) &&\n\t\t\t!(node instanceof MergeConflictFileNode) &&\n\t\t\t!(node instanceof StatusFileNode)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (node instanceof MergeConflictFileNode) {\n\t\t\tvoid executeCommand<DiffWithCommandArgs>(Commands.DiffWith, {\n\t\t\t\tlhs: {\n\t\t\t\t\tsha: node.status.HEAD.ref,\n\t\t\t\t\turi: GitUri.fromFile(node.file, node.repoPath, undefined, true),\n\t\t\t\t},\n\t\t\t\trhs: {\n\t\t\t\t\tsha: 'HEAD',\n\t\t\t\t\turi: GitUri.fromFile(node.file, node.repoPath),\n\t\t\t\t},\n\t\t\t\trepoPath: node.repoPath,\n\t\t\t\tline: 0,\n\t\t\t\tshowOptions: {\n\t\t\t\t\tpreserveFocus: false,\n\t\t\t\t\tpreview: false,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst command = node.getCommand();\n\t\tif (command?.arguments == null) return;\n\n\t\tswitch (command.command) {\n\t\t\tcase Commands.DiffWith: {\n\t\t\t\tconst [args] = command.arguments as [DiffWithCommandArgs];\n\t\t\t\targs.showOptions!.preview = false;\n\t\t\t\tvoid executeCommand<DiffWithCommandArgs>(command.command, args);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Commands.DiffWithPrevious: {\n\t\t\t\tconst [, args] = command.arguments as [Uri, DiffWithPreviousCommandArgs];\n\t\t\t\targs.showOptions!.preview = false;\n\t\t\t\tvoid executeEditorCommand<DiffWithPreviousCommandArgs>(command.command, undefined, args);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unexpected command: ${command.command}`);\n\t\t}\n\n\t\t// TODO@eamodio Revisit this\n\t\t// return GitActions.Commit.openChanges(node.file, node instanceof ViewRefFileNode ? node.ref : node.commit, {\n\t\t// \tpreserveFocus: true,\n\t\t// \tpreview: false,\n\t\t// });\n\t}\n\n\t@debug()\n\tprivate async openAllChangesWithWorking(\n\t\tnode: CommitNode | StashNode | ResultsFilesNode,\n\t\toptions?: TextDocumentShowOptions,\n\t) {\n\t\tif (!(node instanceof CommitNode) && !(node instanceof StashNode) && !(node instanceof ResultsFilesNode)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (node instanceof ResultsFilesNode) {\n\t\t\tconst { files: diff } = await node.getFilesQueryResults();\n\t\t\tif (diff == null || diff.length === 0) return undefined;\n\n\t\t\treturn GitActions.Commit.openAllChangesWithWorking(\n\t\t\t\tdiff,\n\t\t\t\t{\n\t\t\t\t\trepoPath: node.repoPath,\n\t\t\t\t\tref: node.ref1 || node.ref2,\n\t\t\t\t},\n\t\t\t\toptions,\n\t\t\t);\n\t\t}\n\n\t\treturn GitActions.Commit.openAllChangesWithWorking(node.commit, options);\n\n\t\t// options = { preserveFocus: false, preview: false, ...options };\n\n\t\t// let repoPath: string;\n\t\t// let files;\n\t\t// let ref: string;\n\n\t\t// if (node instanceof ResultsFilesNode) {\n\t\t// \tconst { diff } = await node.getFilesQueryResults();\n\t\t// \tif (diff == null || diff.length === 0) return;\n\n\t\t// \trepoPath = node.repoPath;\n\t\t// \tfiles = diff;\n\t\t// \tref = node.ref1 || node.ref2;\n\t\t// } else {\n\t\t// \trepoPath = node.commit.repoPath;\n\t\t// \tfiles = node.commit.files;\n\t\t// \tref = node.commit.sha;\n\t\t// }\n\n\t\t// if (files.length > 20) {\n\t\t// \tconst result = await window.showWarningMessage(\n\t\t// \t\t`Are your sure you want to open all ${files.length} files?`,\n\t\t// \t\t{ title: 'Yes' },\n\t\t// \t\t{ title: 'No', isCloseAffordance: true },\n\t\t// \t);\n\t\t// \tif (result == null || result.title === 'No') return;\n\t\t// }\n\n\t\t// for (const file of files) {\n\t\t// \tif (file.status === 'A' || file.status === 'D') continue;\n\n\t\t// \tconst args: DiffWithWorkingCommandArgs = {\n\t\t// \t\tshowOptions: options,\n\t\t// \t};\n\n\t\t// \tconst uri = GitUri.fromFile(file, repoPath, ref);\n\t\t// \tawait executeCommand(Commands.DiffWithWorking, uri, args);\n\t\t// }\n\t}\n\n\t@debug()\n\tprivate async openChangesWithWorking(node: ViewRefFileNode | MergeConflictFileNode | StatusFileNode) {\n\t\tif (\n\t\t\t!(node instanceof ViewRefFileNode) &&\n\t\t\t!(node instanceof MergeConflictFileNode) &&\n\t\t\t!(node instanceof StatusFileNode)\n\t\t) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tif (node instanceof StatusFileNode) {\n\t\t\treturn executeEditorCommand<DiffWithWorkingCommandArgs>(Commands.DiffWithWorking, undefined, {\n\t\t\t\turi: node.uri,\n\t\t\t\tshowOptions: {\n\t\t\t\t\tpreserveFocus: true,\n\t\t\t\t\tpreview: true,\n\t\t\t\t},\n\t\t\t});\n\t\t} else if (node instanceof MergeConflictFileNode) {\n\t\t\treturn executeEditorCommand<DiffWithWorkingCommandArgs>(Commands.DiffWithWorking, undefined, {\n\t\t\t\turi: node.baseUri,\n\t\t\t\tshowOptions: {\n\t\t\t\t\tpreserveFocus: true,\n\t\t\t\t\tpreview: true,\n\t\t\t\t},\n\t\t\t});\n\t\t} else if (node instanceof FileRevisionAsCommitNode && node.commit.file?.hasConflicts) {\n\t\t\tconst baseUri = await node.getConflictBaseUri();\n\t\t\tif (baseUri != null) {\n\t\t\t\treturn executeEditorCommand<DiffWithWorkingCommandArgs>(Commands.DiffWithWorking, undefined, {\n\t\t\t\t\turi: baseUri,\n\t\t\t\t\tshowOptions: {\n\t\t\t\t\t\tpreserveFocus: true,\n\t\t\t\t\t\tpreview: true,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn GitActions.Commit.openChangesWithWorking(node.file, { repoPath: node.repoPath, ref: node.ref.ref });\n\t}\n\n\t@debug()\n\tprivate async openPreviousChangesWithWorking(node: ViewRefFileNode) {\n\t\tif (!(node instanceof ViewRefFileNode)) return Promise.resolve();\n\n\t\treturn GitActions.Commit.openChangesWithWorking(node.file, {\n\t\t\trepoPath: node.repoPath,\n\t\t\tref: `${node.ref.ref}^`,\n\t\t});\n\t}\n\n\t@debug()\n\tprivate openFile(\n\t\tnode: ViewRefFileNode | MergeConflictFileNode | StatusFileNode | FileHistoryNode | LineHistoryNode,\n\t\toptions?: TextDocumentShowOptions,\n\t) {\n\t\tif (\n\t\t\t!(node instanceof ViewRefFileNode) &&\n\t\t\t!(node instanceof MergeConflictFileNode) &&\n\t\t\t!(node instanceof StatusFileNode) &&\n\t\t\t!(node instanceof FileHistoryNode) &&\n\t\t\t!(node instanceof LineHistoryNode)\n\t\t) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn GitActions.Commit.openFile(node.uri, {\n\t\t\tpreserveFocus: true,\n\t\t\tpreview: false,\n\t\t\t...options,\n\t\t});\n\t}\n\n\t@debug()\n\tprivate async openFiles(node: CommitNode | StashNode | ResultsFilesNode) {\n\t\tif (!(node instanceof CommitNode) && !(node instanceof StashNode) && !(node instanceof ResultsFilesNode)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (node instanceof ResultsFilesNode) {\n\t\t\tconst { files: diff } = await node.getFilesQueryResults();\n\t\t\tif (diff == null || diff.length === 0) return undefined;\n\n\t\t\treturn GitActions.Commit.openFiles(diff, node.repoPath, node.ref1 || node.ref2);\n\t\t}\n\n\t\treturn GitActions.Commit.openFiles(node.commit);\n\t}\n\n\t@debug()\n\tprivate async openRevision(\n\t\tnode:\n\t\t\t| CommitFileNode\n\t\t\t| FileRevisionAsCommitNode\n\t\t\t| ResultsFileNode\n\t\t\t| StashFileNode\n\t\t\t| MergeConflictFileNode\n\t\t\t| StatusFileNode,\n\t\toptions?: OpenFileAtRevisionCommandArgs,\n\t) {\n\t\tif (\n\t\t\t!(node instanceof CommitFileNode) &&\n\t\t\t!(node instanceof FileRevisionAsCommitNode) &&\n\t\t\t!(node instanceof ResultsFileNode) &&\n\t\t\t!(node instanceof StashFileNode) &&\n\t\t\t!(node instanceof MergeConflictFileNode) &&\n\t\t\t!(node instanceof StatusFileNode)\n\t\t) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\toptions = { showOptions: { preserveFocus: true, preview: false }, ...options };\n\n\t\tlet uri = options.revisionUri;\n\t\tif (uri == null) {\n\t\t\tif (node instanceof ResultsFileNode || node instanceof MergeConflictFileNode) {\n\t\t\t\turi = Container.instance.git.getRevisionUri(node.uri);\n\t\t\t} else {\n\t\t\t\turi =\n\t\t\t\t\tnode.commit.file?.status === 'D'\n\t\t\t\t\t\t? Container.instance.git.getRevisionUri(\n\t\t\t\t\t\t\t\t(await node.commit.getPreviousSha()) ?? GitRevision.deletedOrMissing,\n\t\t\t\t\t\t\t\tnode.commit.file.path,\n\t\t\t\t\t\t\t\tnode.commit.repoPath,\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: Container.instance.git.getRevisionUri(node.uri);\n\t\t\t}\n\t\t}\n\n\t\treturn GitActions.Commit.openFileAtRevision(\n\t\t\turi,\n\t\t\toptions.showOptions ?? { preserveFocus: true, preview: false },\n\t\t);\n\t}\n\n\t@debug()\n\tprivate async openRevisions(node: CommitNode | StashNode | ResultsFilesNode, _options?: TextDocumentShowOptions) {\n\t\tif (!(node instanceof CommitNode) && !(node instanceof StashNode) && !(node instanceof ResultsFilesNode)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (node instanceof ResultsFilesNode) {\n\t\t\tconst { files: diff } = await node.getFilesQueryResults();\n\t\t\tif (diff == null || diff.length === 0) return undefined;\n\n\t\t\treturn GitActions.Commit.openFilesAtRevision(diff, node.repoPath, node.ref1, node.ref2);\n\t\t}\n\n\t\treturn GitActions.Commit.openFilesAtRevision(node.commit);\n\t}\n\n\tprivate terminalRemoveRemote(node: RemoteNode) {\n\t\tif (!(node instanceof RemoteNode)) return;\n\n\t\trunGitCommandInTerminal('remote', `remove ${node.remote.name}`, node.remote.repoPath);\n\t}\n}\n","import {\n\tCancellationToken,\n\tDisposable,\n\tEvent,\n\tEventEmitter,\n\tFileDecoration,\n\tFileDecorationProvider,\n\tThemeColor,\n\tUri,\n\twindow,\n} from 'vscode';\nimport { GlyphChars } from '../constants';\nimport { GitBranchStatus } from '../git/models';\n\nexport class ViewFileDecorationProvider implements FileDecorationProvider, Disposable {\n\tprivate readonly _onDidChange = new EventEmitter<undefined | Uri | Uri[]>();\n\tget onDidChange(): Event<undefined | Uri | Uri[]> {\n\t\treturn this._onDidChange.event;\n\t}\n\n\tprivate readonly disposable: Disposable;\n\tconstructor() {\n\t\tthis.disposable = Disposable.from(\n\t\t\t// Register the current branch decorator separately (since we can only have 2 char's per decoration)\n\t\t\twindow.registerFileDecorationProvider({\n\t\t\t\tprovideFileDecoration: (uri, token) => {\n\t\t\t\t\tif (uri.scheme !== 'gitlens-view') return undefined;\n\n\t\t\t\t\tif (uri.authority === 'branch') {\n\t\t\t\t\t\treturn this.provideBranchCurrentDecoration(uri, token);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (uri.authority === 'remote') {\n\t\t\t\t\t\treturn this.provideRemoteDefaultDecoration(uri, token);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\t\t\t}),\n\t\t\twindow.registerFileDecorationProvider(this),\n\t\t);\n\t}\n\n\tdispose(): void {\n\t\tthis.disposable.dispose();\n\t}\n\n\tprovideFileDecoration(uri: Uri, token: CancellationToken): FileDecoration | undefined {\n\t\tif (uri.scheme !== 'gitlens-view') return undefined;\n\n\t\tswitch (uri.authority) {\n\t\t\tcase 'branch':\n\t\t\t\treturn this.provideBranchStatusDecoration(uri, token);\n\t\t\tcase 'commit-file':\n\t\t\t\treturn this.provideCommitFileStatusDecoration(uri, token);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprovideCommitFileStatusDecoration(uri: Uri, _token: CancellationToken): FileDecoration | undefined {\n\t\tconst [, , status] = uri.path.split('/');\n\n\t\tswitch (status) {\n\t\t\tcase '!':\n\t\t\t\treturn {\n\t\t\t\t\tbadge: 'I',\n\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.ignoredForegroundColor'),\n\t\t\t\t\ttooltip: 'Ignored',\n\t\t\t\t};\n\t\t\tcase '?':\n\t\t\t\treturn {\n\t\t\t\t\tbadge: 'U',\n\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.untrackedForegroundColor'),\n\t\t\t\t\ttooltip: 'Untracked',\n\t\t\t\t};\n\t\t\tcase 'A':\n\t\t\t\treturn {\n\t\t\t\t\tbadge: 'A',\n\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.addedForegroundColor'),\n\t\t\t\t\ttooltip: 'Added',\n\t\t\t\t};\n\t\t\tcase 'C':\n\t\t\t\treturn {\n\t\t\t\t\tbadge: 'C',\n\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.copiedForegroundColor'),\n\t\t\t\t\ttooltip: 'Copied',\n\t\t\t\t};\n\t\t\tcase 'D':\n\t\t\t\treturn {\n\t\t\t\t\tbadge: 'D',\n\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.deletedForegroundColor'),\n\t\t\t\t\ttooltip: 'Deleted',\n\t\t\t\t};\n\t\t\tcase 'M':\n\t\t\t\treturn {\n\t\t\t\t\tbadge: 'M',\n\t\t\t\t\t// color: new ThemeColor('gitlens.decorations.modifiedForegroundColor'),\n\t\t\t\t\ttooltip: 'Modified',\n\t\t\t\t};\n\t\t\tcase 'R':\n\t\t\t\treturn {\n\t\t\t\t\tbadge: 'R',\n\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.renamedForegroundColor'),\n\t\t\t\t\ttooltip: 'Renamed',\n\t\t\t\t};\n\t\t\tdefault:\n\t\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprovideBranchStatusDecoration(uri: Uri, _token: CancellationToken): FileDecoration | undefined {\n\t\tconst [, , status] = uri.path.split('/');\n\n\t\tswitch (status as GitBranchStatus) {\n\t\t\tcase GitBranchStatus.Ahead:\n\t\t\t\treturn {\n\t\t\t\t\tbadge: '',\n\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.branchAheadForegroundColor'),\n\t\t\t\t\ttooltip: 'Ahead',\n\t\t\t\t};\n\t\t\tcase GitBranchStatus.Behind:\n\t\t\t\treturn {\n\t\t\t\t\tbadge: '',\n\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.branchBehindForegroundColor'),\n\t\t\t\t\ttooltip: 'Behind',\n\t\t\t\t};\n\t\t\tcase GitBranchStatus.Diverged:\n\t\t\t\treturn {\n\t\t\t\t\tbadge: '',\n\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.branchDivergedForegroundColor'),\n\t\t\t\t\ttooltip: 'Diverged',\n\t\t\t\t};\n\t\t\tcase GitBranchStatus.MissingUpstream:\n\t\t\t\treturn {\n\t\t\t\t\tbadge: '!',\n\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.branchMissingUpstreamForegroundColor'),\n\t\t\t\t\ttooltip: 'Missing Upstream',\n\t\t\t\t};\n\t\t\tcase GitBranchStatus.UpToDate:\n\t\t\t\treturn {\n\t\t\t\t\tbadge: '',\n\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.branchUpToDateForegroundColor'),\n\t\t\t\t\ttooltip: 'Up to Date',\n\t\t\t\t};\n\t\t\tcase GitBranchStatus.Unpublished:\n\t\t\t\treturn {\n\t\t\t\t\tbadge: '+',\n\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.branchUnpublishedForegroundColor'),\n\t\t\t\t\ttooltip: 'Unpublished',\n\t\t\t\t};\n\t\t\tdefault:\n\t\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprovideBranchCurrentDecoration(uri: Uri, _token: CancellationToken): FileDecoration | undefined {\n\t\tconst [, , status, current] = uri.path.split('/');\n\n\t\tif (!current) return undefined;\n\n\t\tlet color;\n\t\tswitch (status as GitBranchStatus) {\n\t\t\tcase GitBranchStatus.Ahead:\n\t\t\t\tcolor = new ThemeColor('gitlens.decorations.branchAheadForegroundColor');\n\t\t\t\tbreak;\n\t\t\tcase GitBranchStatus.Behind:\n\t\t\t\tcolor = new ThemeColor('gitlens.decorations.branchBehindForegroundColor');\n\t\t\t\tbreak;\n\t\t\tcase GitBranchStatus.Diverged:\n\t\t\t\tcolor = new ThemeColor('gitlens.decorations.branchDivergedForegroundColor');\n\t\t\t\tbreak;\n\t\t\tcase GitBranchStatus.UpToDate:\n\t\t\t\tcolor = new ThemeColor('gitlens.decorations.branchUpToDateForegroundColor');\n\t\t\t\tbreak;\n\t\t\tcase GitBranchStatus.Unpublished:\n\t\t\t\tcolor = new ThemeColor('gitlens.decorations.branchUnpublishedForegroundColor');\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn {\n\t\t\tbadge: GlyphChars.Check,\n\t\t\tcolor: color,\n\t\t\ttooltip: 'Current Branch',\n\t\t};\n\t}\n\n\tprovideRemoteDefaultDecoration(uri: Uri, _token: CancellationToken): FileDecoration | undefined {\n\t\tconst [, isDefault] = uri.path.split('/');\n\n\t\tif (!isDefault) return undefined;\n\n\t\treturn {\n\t\t\tbadge: GlyphChars.Check,\n\t\t\ttooltip: 'Default Remote',\n\t\t};\n\t}\n}\n","import { GitCommandOptions } from '../git/commandOptions';\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport class RequestType<Request, Response> {\n\tconstructor(public readonly name: string) {}\n}\n\nexport interface GitCommandRequest {\n\toptions: GitCommandOptions;\n\targs: any[];\n}\n\nexport interface GitCommandResponse {\n\tdata: string;\n\tisBuffer?: boolean;\n}\n\nexport const GitCommandRequestType = new RequestType<GitCommandRequest, GitCommandResponse>('git');\n\nexport interface RepositoryProxy {\n\tfolderUri: string;\n\t/** @deprecated */\n\tpath?: string;\n\troot: boolean;\n\tclosed: boolean;\n}\n\nexport interface GetRepositoriesForUriRequest {\n\tfolderUri: string;\n}\n\nexport interface GetRepositoriesForUriResponse {\n\trepositories: RepositoryProxy[];\n}\n\nexport const GetRepositoriesForUriRequestType = new RequestType<\n\tGetRepositoriesForUriRequest,\n\tGetRepositoriesForUriResponse\n>('repositories/inFolder');\n","import { CancellationToken, Disposable, Uri, workspace, WorkspaceFoldersChangeEvent } from 'vscode';\nimport { git } from '@env/providers';\nimport type { LiveShare, SharedService } from '../@types/vsls';\nimport { Container } from '../container';\nimport { Logger } from '../logger';\nimport { debug, log } from '../system/decorators/log';\nimport { join } from '../system/iterable';\nimport { isVslsRoot, normalizePath } from '../system/path';\nimport {\n\tGetRepositoriesForUriRequest,\n\tGetRepositoriesForUriRequestType,\n\tGetRepositoriesForUriResponse,\n\tGitCommandRequest,\n\tGitCommandRequestType,\n\tGitCommandResponse,\n\tRepositoryProxy,\n\tRequestType,\n} from './protocol';\n\nconst defaultWhitelistFn = () => true;\nconst gitWhitelist = new Map<string, (args: any[]) => boolean>([\n\t['blame', defaultWhitelistFn],\n\t['branch', args => args[1] === '--contains'],\n\t['cat-file', defaultWhitelistFn],\n\t['check-mailmap', defaultWhitelistFn],\n\t['check-ref-format', defaultWhitelistFn],\n\t['config', args => args[1] === '--get' || args[1] === '--get-regex'],\n\t['diff', defaultWhitelistFn],\n\t['difftool', defaultWhitelistFn],\n\t['for-each-ref', defaultWhitelistFn],\n\t['log', defaultWhitelistFn],\n\t['ls-files', defaultWhitelistFn],\n\t['ls-tree', defaultWhitelistFn],\n\t['merge-base', defaultWhitelistFn],\n\t['remote', args => args[1] === '-v' || args[1] === 'get-url'],\n\t['rev-list', defaultWhitelistFn],\n\t['rev-parse', defaultWhitelistFn],\n\t['show', defaultWhitelistFn],\n\t['show-ref', defaultWhitelistFn],\n\t['stash', args => args[1] === 'list'],\n\t['status', defaultWhitelistFn],\n\t['symbolic-ref', defaultWhitelistFn],\n\t['tag', args => args[1] === '-l'],\n]);\n\nconst leadingSlashRegex = /^[/|\\\\]/;\nconst slash = 47; //CharCode.Slash;\n\nexport class VslsHostService implements Disposable {\n\tstatic ServiceId = 'proxy';\n\n\t@log()\n\tstatic async share(api: LiveShare, container: Container) {\n\t\tconst service = await api.shareService(this.ServiceId);\n\t\tif (service == null) {\n\t\t\tthrow new Error('Failed to share host service');\n\t\t}\n\n\t\treturn new VslsHostService(api, service, container);\n\t}\n\n\tprivate readonly _disposable: Disposable;\n\tprivate _localPathsRegex: RegExp | undefined;\n\tprivate _localToSharedPaths = new Map<string, string>();\n\tprivate _sharedPathsRegex: RegExp | undefined;\n\tprivate _sharedToLocalPaths = new Map<string, string>();\n\n\tconstructor(\n\t\tprivate readonly _api: LiveShare,\n\t\tprivate readonly _service: SharedService,\n\t\tprivate readonly container: Container,\n\t) {\n\t\t_service.onDidChangeIsServiceAvailable(this.onAvailabilityChanged.bind(this));\n\n\t\tthis._disposable = Disposable.from(workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged, this));\n\n\t\tthis.onRequest(GitCommandRequestType, this.onGitCommandRequest.bind(this));\n\t\tthis.onRequest(GetRepositoriesForUriRequestType, this.onGetRepositoriesForUriRequest.bind(this));\n\n\t\tvoid this.onWorkspaceFoldersChanged();\n\t}\n\n\tdispose() {\n\t\tthis._disposable.dispose();\n\t\tvoid this._api.unshareService(VslsHostService.ServiceId);\n\t}\n\n\tprivate onRequest<TRequest, TResponse>(\n\t\trequestType: RequestType<TRequest, TResponse>,\n\t\thandler: (request: TRequest, cancellation: CancellationToken) => Promise<TResponse>,\n\t) {\n\t\tthis._service.onRequest(requestType.name, (args: any[], cancellation: CancellationToken) =>\n\t\t\thandler(args[0], cancellation),\n\t\t);\n\t}\n\n\t@log()\n\tprivate onAvailabilityChanged(_available: boolean) {\n\t\t// TODO\n\t}\n\n\t@debug()\n\tprivate onWorkspaceFoldersChanged(_e?: WorkspaceFoldersChangeEvent) {\n\t\tif (workspace.workspaceFolders == null || workspace.workspaceFolders.length === 0) return;\n\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tthis._localToSharedPaths.clear();\n\t\tthis._sharedToLocalPaths.clear();\n\n\t\tlet localPath;\n\t\tlet sharedPath;\n\t\tfor (const f of workspace.workspaceFolders) {\n\t\t\tlocalPath = normalizePath(f.uri.fsPath);\n\t\t\tsharedPath = normalizePath(this.convertLocalUriToShared(f.uri).toString());\n\n\t\t\tLogger.debug(cc, `shared='${sharedPath}' \\u2194 local='${localPath}'`);\n\t\t\tthis._localToSharedPaths.set(localPath, sharedPath);\n\t\t\tthis._sharedToLocalPaths.set(sharedPath, localPath);\n\t\t}\n\n\t\tlet localPaths = join(this._sharedToLocalPaths.values(), '|');\n\t\tlocalPaths = localPaths.replace(/(\\/|\\\\)/g, '[\\\\\\\\/|\\\\\\\\]');\n\t\tthis._localPathsRegex = new RegExp(`(${localPaths})`, 'gi');\n\n\t\tlet sharedPaths = join(this._localToSharedPaths.values(), '|');\n\t\tsharedPaths = sharedPaths.replace(/(\\/|\\\\)/g, '[\\\\\\\\/|\\\\\\\\]');\n\t\tthis._sharedPathsRegex = new RegExp(`^(${sharedPaths})`, 'i');\n\t}\n\n\t@log()\n\tprivate async onGitCommandRequest(\n\t\trequest: GitCommandRequest,\n\t\t_cancellation: CancellationToken,\n\t): Promise<GitCommandResponse> {\n\t\tconst { options, args } = request;\n\n\t\tconst fn = gitWhitelist.get(request.args[0]);\n\t\tif (fn == null || !fn(request.args)) throw new Error(`Git ${request.args[0]} command is not allowed`);\n\n\t\tlet isRootWorkspace = false;\n\t\tif (options.cwd != null && options.cwd.length > 0 && this._sharedToLocalPaths != null) {\n\t\t\t// This is all so ugly, but basically we are converting shared paths to local paths\n\t\t\tif (this._sharedPathsRegex?.test(options.cwd)) {\n\t\t\t\toptions.cwd = normalizePath(options.cwd).replace(this._sharedPathsRegex, (match, shared) => {\n\t\t\t\t\tif (!isRootWorkspace) {\n\t\t\t\t\t\tisRootWorkspace = shared === '/~0';\n\t\t\t\t\t}\n\n\t\t\t\t\tconst local = this._sharedToLocalPaths.get(shared);\n\t\t\t\t\treturn local != null ? local : shared;\n\t\t\t\t});\n\t\t\t} else if (leadingSlashRegex.test(options.cwd)) {\n\t\t\t\tconst localCwd = this._sharedToLocalPaths.get('vsls:/~0');\n\t\t\t\tif (localCwd != null) {\n\t\t\t\t\tisRootWorkspace = true;\n\t\t\t\t\toptions.cwd = normalizePath(this.container.git.getAbsoluteUri(options.cwd, localCwd).fsPath);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet files = false;\n\t\tlet i = -1;\n\t\tfor (const arg of args) {\n\t\t\ti++;\n\t\t\tif (arg === '--') {\n\t\t\t\tfiles = true;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!files) continue;\n\n\t\t\tif (typeof arg === 'string') {\n\t\t\t\t// If we are the \"root\" workspace, then we need to remove the leading slash off the path (otherwise it will not be treated as a relative path)\n\t\t\t\tif (isRootWorkspace && leadingSlashRegex.test(arg[0])) {\n\t\t\t\t\targs.splice(i, 1, arg.substr(1));\n\t\t\t\t}\n\n\t\t\t\tif (this._sharedPathsRegex?.test(arg)) {\n\t\t\t\t\targs.splice(\n\t\t\t\t\t\ti,\n\t\t\t\t\t\t1,\n\t\t\t\t\t\tnormalizePath(arg).replace(this._sharedPathsRegex, (match, shared) => {\n\t\t\t\t\t\t\tconst local = this._sharedToLocalPaths.get(shared);\n\t\t\t\t\t\t\treturn local != null ? local : shared;\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet data = await git(options, ...args);\n\t\tif (typeof data === 'string') {\n\t\t\t// And then we convert local paths to shared paths\n\t\t\tif (this._localPathsRegex != null && data.length > 0) {\n\t\t\t\tdata = data.replace(this._localPathsRegex, (match, local) => {\n\t\t\t\t\tconst shared = this._localToSharedPaths.get(normalizePath(local));\n\t\t\t\t\treturn shared != null ? shared : local;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn { data: data };\n\t\t}\n\n\t\treturn { data: data.toString('binary'), isBuffer: true };\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/require-await\n\t@log()\n\tprivate async onGetRepositoriesForUriRequest(\n\t\trequest: GetRepositoriesForUriRequest,\n\t\t_cancellation: CancellationToken,\n\t): Promise<GetRepositoriesForUriResponse> {\n\t\tconst repositories: RepositoryProxy[] = [];\n\n\t\tconst uri = this.convertSharedUriToLocal(Uri.parse(request.folderUri, true));\n\t\tconst repository = this.container.git.getRepository(uri);\n\n\t\tif (repository != null) {\n\t\t\tconst vslsUri = this.convertLocalUriToShared(repository.uri);\n\t\t\trepositories.push({\n\t\t\t\tfolderUri: vslsUri.toString(),\n\t\t\t\t// uri: vslsUri.toString(),\n\t\t\t\troot: repository.root,\n\t\t\t\tclosed: repository.closed,\n\t\t\t});\n\t\t}\n\n\t\treturn { repositories: repositories };\n\t}\n\n\t@debug({\n\t\texit: result => `returned ${result.toString(true)}`,\n\t})\n\tprivate convertLocalUriToShared(localUri: Uri) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tlet sharedUri = this._api.convertLocalUriToShared(localUri);\n\t\tLogger.debug(\n\t\t\tcc,\n\t\t\t`LiveShare.convertLocalUriToShared(${localUri.toString(true)}) returned ${sharedUri.toString(true)}`,\n\t\t);\n\n\t\tconst localPath = localUri.path;\n\t\tlet sharedPath = sharedUri.path;\n\t\tif (sharedUri.authority.length > 0) {\n\t\t\tsharedPath = `/${sharedUri.authority}${sharedPath}`;\n\t\t}\n\n\t\tif (new RegExp(`${localPath}$`, 'i').test(sharedPath)) {\n\t\t\tif (sharedPath.length === localPath.length) {\n\t\t\t\tconst folder = workspace.getWorkspaceFolder(localUri)!;\n\t\t\t\tsharedUri = sharedUri.with({ path: `/~${folder.index}` });\n\t\t\t} else {\n\t\t\t\tsharedUri = sharedUri.with({ path: sharedPath.substr(0, sharedPath.length - localPath.length) });\n\t\t\t}\n\t\t} else if (!sharedPath.startsWith('/~')) {\n\t\t\tconst folder = workspace.getWorkspaceFolder(localUri)!;\n\t\t\tsharedUri = sharedUri.with({ path: `/~${folder.index}${sharedPath}` });\n\t\t}\n\n\t\treturn sharedUri;\n\t}\n\n\tprivate convertSharedUriToLocal(sharedUri: Uri) {\n\t\tif (isVslsRoot(sharedUri.path)) {\n\t\t\tsharedUri = sharedUri.with({ path: `${sharedUri.path}/` });\n\t\t}\n\n\t\tconst localUri = this._api.convertSharedUriToLocal(sharedUri);\n\n\t\tlet localPath = localUri.path;\n\t\tconst sharedPath = sharedUri.path;\n\t\tif (localPath.endsWith(sharedPath)) {\n\t\t\tlocalPath = localPath.substr(0, localPath.length - sharedPath.length);\n\t\t}\n\n\t\tif (localPath.charCodeAt(localPath.length - 1) === slash) {\n\t\t\tlocalPath = localPath.slice(0, -1);\n\t\t}\n\n\t\treturn localUri.with({ path: localPath });\n\t}\n}\n","import { CancellationToken, Disposable, Uri, window } from 'vscode';\nimport type { LiveShare, SharedServiceProxy } from '../@types/vsls';\nimport { Container } from '../container';\nimport { GitCommandOptions } from '../git/commandOptions';\nimport { Logger } from '../logger';\nimport { debug, log } from '../system/decorators/log';\nimport { VslsHostService } from './host';\nimport { GetRepositoriesForUriRequestType, GitCommandRequestType, RepositoryProxy, RequestType } from './protocol';\n\nexport class VslsGuestService implements Disposable {\n\t@log()\n\tstatic async connect(api: LiveShare, container: Container) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\ttry {\n\t\t\tconst service = await api.getSharedService(VslsHostService.ServiceId);\n\t\t\tif (service == null) {\n\t\t\t\tthrow new Error('Failed to connect to host service');\n\t\t\t}\n\n\t\t\treturn new VslsGuestService(api, service, container);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tconstructor(\n\t\tprivate readonly _api: LiveShare,\n\t\tprivate readonly _service: SharedServiceProxy,\n\t\tprivate readonly container: Container,\n\t) {\n\t\t_service.onDidChangeIsServiceAvailable(this.onAvailabilityChanged.bind(this));\n\t\tthis.onAvailabilityChanged(_service.isServiceAvailable);\n\t}\n\n\tdispose() {\n\t\t// nothing to dispose\n\t}\n\n\t@log()\n\tprivate onAvailabilityChanged(available: boolean) {\n\t\tif (available) {\n\t\t\tvoid this.container.git.setEnabledContext(true);\n\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.container.git.setEnabledContext(false);\n\t\tvoid window.showWarningMessage(\n\t\t\t'GitLens features will be unavailable. Unable to connect to the host GitLens service. The host may have disabled GitLens guest access or may not have GitLens installed.',\n\t\t);\n\t}\n\n\t@log()\n\tasync git<TOut extends string | Buffer>(options: GitCommandOptions, ...args: any[]) {\n\t\tconst response = await this.sendRequest(GitCommandRequestType, { options: options, args: args });\n\n\t\tif (response.isBuffer) {\n\t\t\treturn Buffer.from(response.data, 'binary') as TOut;\n\t\t}\n\t\treturn response.data as TOut;\n\t}\n\n\t@log()\n\tasync getRepositoriesForUri(uri: Uri): Promise<RepositoryProxy[]> {\n\t\tconst response = await this.sendRequest(GetRepositoriesForUriRequestType, {\n\t\t\tfolderUri: uri.toString(),\n\t\t});\n\n\t\treturn response.repositories;\n\t}\n\n\t@debug()\n\tprivate sendRequest<TRequest, TResponse>(\n\t\trequestType: RequestType<TRequest, TResponse>,\n\t\trequest: TRequest,\n\t\t_cancellation?: CancellationToken,\n\t): Promise<TResponse> {\n\t\treturn this._service.request(requestType.name, [request]);\n\t}\n}\n","import { Disposable, extensions, workspace } from 'vscode';\nimport type { LiveShare, LiveShareExtension, SessionChangeEvent } from '../@types/vsls';\nimport { ContextKeys, Schemes } from '../constants';\nimport { Container } from '../container';\nimport { setContext } from '../context';\nimport { Logger } from '../logger';\nimport { debug } from '../system/decorators/log';\nimport { timeout } from '../system/decorators/timeout';\nimport { once } from '../system/event';\nimport { defer, Deferred } from '../system/promise';\nimport { VslsGuestService } from './guest';\nimport { VslsHostService } from './host';\n\nexport interface ContactPresence {\n\tstatus: ContactPresenceStatus;\n\tstatusText: string;\n}\nexport type ContactPresenceStatus = 'online' | 'away' | 'busy' | 'dnd' | 'offline';\n\nfunction contactStatusToPresence(status: string | undefined): ContactPresence {\n\tswitch (status) {\n\t\tcase 'available':\n\t\t\treturn { status: 'online', statusText: 'Available' };\n\t\tcase 'away':\n\t\t\treturn { status: 'away', statusText: 'Away' };\n\t\tcase 'busy':\n\t\t\treturn { status: 'busy', statusText: 'Busy' };\n\t\tcase 'doNotDisturb':\n\t\t\treturn { status: 'dnd', statusText: 'DND' };\n\t\tdefault:\n\t\t\treturn { status: 'offline', statusText: 'Offline' };\n\t}\n}\n\nexport class VslsController implements Disposable {\n\tprivate _api: Promise<LiveShare | undefined> | undefined;\n\tprivate _disposable: Disposable;\n\tprivate _guest: VslsGuestService | undefined;\n\tprivate _host: VslsHostService | undefined;\n\tprivate _ready: Deferred<void>;\n\n\tconstructor(private readonly container: Container) {\n\t\tthis._ready = defer<void>();\n\t\tthis._disposable = Disposable.from(once(container.onReady)(this.onReady, this));\n\t}\n\n\tdispose() {\n\t\tthis._ready.fulfill();\n\n\t\tthis._disposable.dispose();\n\t\tthis._host?.dispose();\n\t\tthis._guest?.dispose();\n\t}\n\n\tprivate onReady(): void {\n\t\tvoid this.initialize();\n\t}\n\n\tprivate async initialize() {\n\t\t// If we have a vsls: workspace open, we might be a guest, so wait until live share transitions into a mode\n\t\tif (workspace.workspaceFolders?.some(f => f.uri.scheme === Schemes.Vsls)) {\n\t\t\tthis.setReadonly(true);\n\t\t}\n\n\t\ttry {\n\t\t\tthis._api = this.getLiveShareApi();\n\t\t\tconst api = await this._api;\n\t\t\tif (api == null) {\n\t\t\t\tvoid setContext(ContextKeys.Vsls, false);\n\t\t\t\t// Tear it down if we can't talk to live share\n\t\t\t\tthis._ready.fulfill();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid setContext(ContextKeys.Vsls, true);\n\n\t\t\tthis._disposable = Disposable.from(\n\t\t\t\tthis._disposable,\n\t\t\t\tapi.onDidChangeSession(e => this.onLiveShareSessionChanged(api, e), this),\n\t\t\t);\n\t\t\tvoid this.onLiveShareSessionChanged(api, { session: api.session });\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\t\t\tdebugger;\n\t\t}\n\t}\n\n\tprivate async onLiveShareSessionChanged(api: LiveShare, e: SessionChangeEvent) {\n\t\tthis._host?.dispose();\n\t\tthis._host = undefined;\n\t\tthis._guest?.dispose();\n\t\tthis._guest = undefined;\n\n\t\tswitch (e.session.role) {\n\t\t\tcase 1 /*Role.Host*/:\n\t\t\t\tthis.setReadonly(false);\n\t\t\t\tvoid setContext(ContextKeys.Vsls, 'host');\n\t\t\t\tif (this.container.config.liveshare.allowGuestAccess) {\n\t\t\t\t\tthis._host = await VslsHostService.share(api, this.container);\n\t\t\t\t}\n\n\t\t\t\tthis._ready.fulfill();\n\n\t\t\t\tbreak;\n\n\t\t\tcase 2 /*Role.Guest*/:\n\t\t\t\tthis.setReadonly(true);\n\t\t\t\tvoid setContext(ContextKeys.Vsls, 'guest');\n\t\t\t\tthis._guest = await VslsGuestService.connect(api, this.container);\n\n\t\t\t\tthis._ready.fulfill();\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthis.setReadonly(false);\n\t\t\t\tvoid setContext(ContextKeys.Vsls, true);\n\n\t\t\t\tthis._ready = defer<void>();\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate async getLiveShareApi(): Promise<LiveShare | undefined> {\n\t\ttry {\n\t\t\tconst extension = extensions.getExtension<LiveShareExtension>('ms-vsliveshare.vsliveshare');\n\t\t\tif (extension != null) {\n\t\t\t\tconst vslsExtension = extension.isActive ? extension.exports : await extension.activate();\n\t\t\t\treturn (await vslsExtension.getApi('1.0.4753')) ?? undefined;\n\t\t\t}\n\t\t} catch {\n\t\t\tdebugger;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate _readonly: boolean = false;\n\tget readonly() {\n\t\treturn this._readonly;\n\t}\n\tprivate setReadonly(value: boolean) {\n\t\tthis._readonly = value;\n\t\tvoid setContext(ContextKeys.Readonly, value ? true : undefined);\n\t}\n\n\tasync guest() {\n\t\tif (this._guest != null) return this._guest;\n\n\t\tawait this._ready.promise;\n\t\treturn this._guest;\n\t}\n\n\t@debug()\n\tasync getContact(email: string | undefined) {\n\t\tif (email == null) return undefined;\n\n\t\tconst api = await this._api;\n\t\tif (api == null) return undefined;\n\n\t\tconst contacts = await api.getContacts([email]);\n\t\treturn contacts.contacts[email];\n\t}\n\n\t@debug<VslsController['getContacts']>({ args: { 0: emails => emails.length } })\n\tprivate async getContacts(emails: string[]) {\n\t\tconst api = await this._api;\n\t\tif (api == null) return undefined;\n\n\t\tconst contacts = await api.getContacts(emails);\n\t\treturn Object.values(contacts.contacts);\n\t}\n\n\t@debug()\n\tasync getContactPresence(email: string | undefined): Promise<ContactPresence | undefined> {\n\t\tconst contact = await this.getContact(email);\n\t\tif (contact == null) return undefined;\n\n\t\treturn contactStatusToPresence(contact.status);\n\t}\n\n\t@debug<VslsController['getContactsPresence']>({ args: { 0: emails => emails.length } })\n\tasync getContactsPresence(emails: string[]): Promise<Map<string, ContactPresence> | undefined> {\n\t\tconst contacts = await this.getContacts(emails);\n\t\tif (contacts == null) return undefined;\n\n\t\treturn new Map<string, ContactPresence>(\n\t\t\tObject.values(contacts).map(c => [c.email, contactStatusToPresence(c.status)]),\n\t\t);\n\t}\n\n\t@debug()\n\t@timeout(250)\n\tmaybeGetPresence(email: string | undefined): Promise<ContactPresence | undefined> {\n\t\treturn this.getContactPresence(email);\n\t}\n\n\tasync invite(email: string | undefined) {\n\t\tif (email == null) return undefined;\n\n\t\tconst contact = await this.getContact(email);\n\t\tif (contact == null) return undefined;\n\n\t\treturn contact.invite();\n\t}\n\n\tasync startSession() {\n\t\tconst api = await this._api;\n\t\tif (api == null) return undefined;\n\n\t\treturn api.share();\n\t}\n}\n","import type { Subscription } from '../../subscription';\nimport { IpcNotificationType } from '../protocol';\n\nexport interface State {\n\tsubscription: Subscription;\n\twelcomeVisible: boolean;\n}\n\nexport interface DidChangeSubscriptionParams {\n\tsubscription: Subscription;\n\twelcomeVisible: boolean;\n}\nexport const DidChangeSubscriptionNotificationType = new IpcNotificationType<DidChangeSubscriptionParams>(\n\t'subscription/didChange',\n);\n","import { commands, Disposable, window } from 'vscode';\nimport type { Container } from '../../container';\nimport type { SubscriptionChangeEvent } from '../../premium/subscription/subscriptionService';\nimport { SyncedStorageKeys } from '../../storage';\nimport type { Subscription } from '../../subscription';\nimport { WebviewViewBase } from '../webviewViewBase';\nimport { DidChangeSubscriptionNotificationType, State } from './protocol';\n\nexport class HomeWebviewView extends WebviewViewBase<State> {\n\tconstructor(container: Container) {\n\t\tsuper(container, 'gitlens.views.home', 'home.html', 'Home');\n\n\t\tthis.disposables.push(this.container.subscription.onDidChange(this.onSubscriptionChanged, this));\n\t}\n\n\tprivate onSubscriptionChanged(e: SubscriptionChangeEvent) {\n\t\tvoid this.notifyDidChangeData(e.current);\n\t}\n\n\tprotected override onVisibilityChanged(visible: boolean): void {\n\t\tif (!visible) return;\n\n\t\tvoid this.validateSubscription();\n\t}\n\n\tprotected override onWindowFocusChanged(focused: boolean): void {\n\t\tif (!focused) return;\n\n\t\tvoid this.validateSubscription();\n\t}\n\n\tprivate _validating: Promise<void> | undefined;\n\tprivate async validateSubscription(): Promise<void> {\n\t\tif (this._validating == null) {\n\t\t\tthis._validating = this.container.subscription.validate();\n\t\t\ttry {\n\t\t\t\tvoid (await this._validating);\n\t\t\t} finally {\n\t\t\t\tthis._validating = undefined;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected override registerCommands(): Disposable[] {\n\t\treturn [\n\t\t\tcommands.registerCommand(`${this.id}.refresh`, () => this.refresh(), this),\n\t\t\tcommands.registerCommand('gitlens.home.toggleWelcome', async () => {\n\t\t\t\tconst welcomeVisible = this.container.storage.get(SyncedStorageKeys.HomeViewWelcomeVisible, true);\n\t\t\t\tawait this.container.storage.store(SyncedStorageKeys.HomeViewWelcomeVisible, !welcomeVisible);\n\n\t\t\t\tconst subscription = await this.container.subscription.getSubscription();\n\t\t\t\tvoid this.notifyDidChangeData(subscription);\n\t\t\t}),\n\t\t];\n\t}\n\n\tprotected override async includeBootstrap(): Promise<State> {\n\t\tconst subscription = await this.container.subscription.getSubscription();\n\t\treturn {\n\t\t\tsubscription: subscription,\n\t\t\twelcomeVisible: this.container.storage.get(SyncedStorageKeys.HomeViewWelcomeVisible, true),\n\t\t};\n\t}\n\n\tprivate notifyDidChangeData(subscription: Subscription) {\n\t\tif (!this.isReady) return false;\n\n\t\treturn window.withProgress({ location: { viewId: this.id } }, () =>\n\t\t\tthis.notify(DidChangeSubscriptionNotificationType, {\n\t\t\t\tsubscription: subscription,\n\t\t\t\twelcomeVisible: this.container.storage.get(SyncedStorageKeys.HomeViewWelcomeVisible, true),\n\t\t\t}),\n\t\t);\n\t}\n}\n","import { IpcCommandType, IpcNotificationType } from '../protocol';\n\nexport interface State {\n\tbranch: string;\n\tonto: string;\n\n\tentries: RebaseEntry[];\n\tauthors: Author[];\n\tcommits: Commit[];\n\tcommands: {\n\t\tcommit: string;\n\t};\n}\n\nexport interface RebaseEntry {\n\treadonly action: RebaseEntryAction;\n\treadonly ref: string;\n\treadonly message: string;\n\treadonly index: number;\n}\n\nexport type RebaseEntryAction = 'pick' | 'reword' | 'edit' | 'squash' | 'fixup' | 'break' | 'drop';\n\nexport interface Author {\n\treadonly author: string;\n\treadonly avatarUrl: string;\n\treadonly email: string | undefined;\n}\n\nexport interface Commit {\n\treadonly ref: string;\n\treadonly author: string;\n\t// readonly avatarUrl: string;\n\treadonly date: string;\n\treadonly dateFromNow: string;\n\t// readonly email: string | undefined;\n\treadonly message: string;\n\t// readonly command: string;\n}\n\n// COMMANDS\n\nexport const AbortCommandType = new IpcCommandType('rebase/abort');\n\nexport const DisableCommandType = new IpcCommandType('rebase/disable');\n\nexport const StartCommandType = new IpcCommandType('rebase/start');\n\nexport const SwitchCommandType = new IpcCommandType('rebase/switch');\n\nexport interface ChangeEntryParams {\n\tref: string;\n\taction: RebaseEntryAction;\n}\nexport const ChangeEntryCommandType = new IpcCommandType<ChangeEntryParams>('rebase/change/entry');\n\nexport interface MoveEntryParams {\n\tref: string;\n\tto: number;\n\trelative: boolean;\n}\nexport const MoveEntryCommandType = new IpcCommandType<MoveEntryParams>('rebase/move/entry');\n\n// NOTIFICATIONS\n\nexport interface DidChangeParams {\n\tstate: State;\n}\nexport const DidChangeNotificationType = new IpcNotificationType<DidChangeParams>('rebase/didChange');\n","import {\n\tCancellationToken,\n\tConfigurationTarget,\n\tCustomTextEditorProvider,\n\tDisposable,\n\tPosition,\n\tRange,\n\tTextDocument,\n\tUri,\n\tWebviewPanel,\n\twindow,\n\tworkspace,\n\tWorkspaceEdit,\n} from 'vscode';\nimport { getNonce } from '@env/crypto';\nimport { ShowQuickCommitCommand } from '../../commands';\nimport { configuration } from '../../configuration';\nimport { CoreCommands } from '../../constants';\nimport type { Container } from '../../container';\nimport { RepositoryChange, RepositoryChangeComparisonMode } from '../../git/models';\nimport { Logger } from '../../logger';\nimport { Messages } from '../../messages';\nimport { executeCoreCommand } from '../../system/command';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { join, map } from '../../system/iterable';\nimport { normalizePath } from '../../system/path';\nimport { IpcMessage, onIpc } from '../protocol';\nimport {\n\tAbortCommandType,\n\tAuthor,\n\tChangeEntryCommandType,\n\tCommit,\n\tDidChangeNotificationType,\n\tDisableCommandType,\n\tMoveEntryCommandType,\n\tRebaseEntry,\n\tRebaseEntryAction,\n\tStartCommandType,\n\tState,\n\tSwitchCommandType,\n} from './protocol';\n\nlet ipcSequence = 0;\nfunction nextIpcId() {\n\tif (ipcSequence === Number.MAX_SAFE_INTEGER) {\n\t\tipcSequence = 1;\n\t} else {\n\t\tipcSequence++;\n\t}\n\n\treturn `host:${ipcSequence}`;\n}\n\nlet webviewId = 0;\nfunction nextWebviewId() {\n\tif (webviewId === Number.MAX_SAFE_INTEGER) {\n\t\twebviewId = 1;\n\t} else {\n\t\twebviewId++;\n\t}\n\n\treturn webviewId;\n}\n\nconst rebaseRegex = /^\\s?#\\s?Rebase\\s([0-9a-f]+)(?:..([0-9a-f]+))?\\sonto\\s([0-9a-f]+)\\s.*$/im;\nconst rebaseCommandsRegex = /^\\s?(p|pick|r|reword|e|edit|s|squash|f|fixup|d|drop)\\s([0-9a-f]+?)\\s(.*)$/gm;\n\nconst rebaseActionsMap = new Map<string, RebaseEntryAction>([\n\t['p', 'pick'],\n\t['pick', 'pick'],\n\t['r', 'reword'],\n\t['reword', 'reword'],\n\t['e', 'edit'],\n\t['edit', 'edit'],\n\t['s', 'squash'],\n\t['squash', 'squash'],\n\t['f', 'fixup'],\n\t['fixup', 'fixup'],\n\t['d', 'drop'],\n\t['drop', 'drop'],\n]);\n\ninterface RebaseEditorContext {\n\tdispose(): void;\n\n\treadonly id: number;\n\treadonly document: TextDocument;\n\treadonly panel: WebviewPanel;\n\treadonly repoPath: string;\n\treadonly subscriptions: Disposable[];\n\n\tabortOnClose: boolean;\n\tpendingChange?: boolean;\n}\n\nexport class RebaseEditorProvider implements CustomTextEditorProvider, Disposable {\n\tprivate readonly _disposable: Disposable;\n\n\tconstructor(private readonly container: Container) {\n\t\tthis._disposable = Disposable.from(\n\t\t\twindow.registerCustomEditorProvider('gitlens.rebase', this, {\n\t\t\t\tsupportsMultipleEditorsPerDocument: false,\n\t\t\t\twebviewOptions: {\n\t\t\t\t\tretainContextWhenHidden: true,\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}\n\n\tdispose() {\n\t\tthis._disposable.dispose();\n\t}\n\n\tget enabled(): boolean {\n\t\tconst associations = configuration.inspectAny<\n\t\t\t{ [key: string]: string } | { viewType: string; filenamePattern: string }[]\n\t\t>('workbench.editorAssociations')?.globalValue;\n\t\tif (associations == null || associations.length === 0) return true;\n\n\t\tif (Array.isArray(associations)) {\n\t\t\tconst association = associations.find(a => a.filenamePattern === 'git-rebase-todo');\n\t\t\treturn association != null ? association.viewType === 'gitlens.rebase' : true;\n\t\t}\n\n\t\tconst association = associations['git-rebase-todo'];\n\t\treturn association != null ? association === 'gitlens.rebase' : true;\n\t}\n\n\tprivate _disableAfterNextUse: boolean = false;\n\tasync enableForNextUse() {\n\t\tif (!this.enabled) {\n\t\t\tawait this.setEnabled(true);\n\t\t\tthis._disableAfterNextUse = true;\n\t\t}\n\t}\n\n\tasync setEnabled(enabled: boolean): Promise<void> {\n\t\tthis._disableAfterNextUse = false;\n\n\t\tconst inspection = configuration.inspectAny<\n\t\t\t{ [key: string]: string } | { viewType: string; filenamePattern: string }[]\n\t\t>('workbench.editorAssociations');\n\n\t\tlet associations = inspection?.globalValue;\n\t\tif (Array.isArray(associations)) {\n\t\t\tassociations = associations.reduce((accumulator, current) => {\n\t\t\t\taccumulator[current.filenamePattern] = current.viewType;\n\t\t\t\treturn accumulator;\n\t\t\t}, Object.create(null) as Record<string, string>);\n\t\t}\n\n\t\tif (associations == null) {\n\t\t\tif (enabled) return;\n\n\t\t\tassociations = {\n\t\t\t\t'git-rebase-todo': 'default',\n\t\t\t};\n\t\t} else {\n\t\t\tassociations['git-rebase-todo'] = enabled ? 'gitlens.rebase' : 'default';\n\t\t}\n\n\t\tawait configuration.updateAny('workbench.editorAssociations', associations, ConfigurationTarget.Global);\n\t}\n\n\t@debug({ args: false })\n\tasync resolveCustomTextEditor(document: TextDocument, panel: WebviewPanel, _token: CancellationToken) {\n\t\tconst repoPath = normalizePath(Uri.joinPath(document.uri, '..', '..', '..').fsPath);\n\t\tconst repo = this.container.git.getRepository(repoPath);\n\n\t\tconst subscriptions: Disposable[] = [];\n\t\tconst context: RebaseEditorContext = {\n\t\t\tdispose: () => Disposable.from(...subscriptions).dispose(),\n\n\t\t\tid: nextWebviewId(),\n\t\t\tsubscriptions: subscriptions,\n\t\t\tdocument: document,\n\t\t\tpanel: panel,\n\t\t\trepoPath: repo?.path ?? repoPath,\n\t\t\tabortOnClose: true,\n\t\t};\n\n\t\tsubscriptions.push(\n\t\t\tpanel.onDidDispose(() => {\n\t\t\t\t// If the user closed this without taking an action, consider it an abort\n\t\t\t\tif (context.abortOnClose) {\n\t\t\t\t\tvoid this.abort(context);\n\t\t\t\t}\n\t\t\t\tDisposable.from(...subscriptions).dispose();\n\t\t\t}),\n\t\t\tpanel.onDidChangeViewState(() => {\n\t\t\t\tif (!context.pendingChange) return;\n\n\t\t\t\tvoid this.getStateAndNotify(context);\n\t\t\t}),\n\t\t\tpanel.webview.onDidReceiveMessage(e => this.onMessageReceived(context, e)),\n\t\t\tworkspace.onDidChangeTextDocument(e => {\n\t\t\t\tif (e.contentChanges.length === 0 || e.document.uri.toString() !== document.uri.toString()) return;\n\n\t\t\t\tvoid this.getStateAndNotify(context);\n\t\t\t}),\n\t\t\tworkspace.onDidSaveTextDocument(e => {\n\t\t\t\tif (e.uri.toString() !== document.uri.toString()) return;\n\n\t\t\t\tvoid this.getStateAndNotify(context);\n\t\t\t}),\n\t\t);\n\n\t\tif (repo != null) {\n\t\t\tsubscriptions.push(\n\t\t\t\trepo.onDidChange(e => {\n\t\t\t\t\tif (!e.changed(RepositoryChange.Rebase, RepositoryChangeComparisonMode.Any)) return;\n\n\t\t\t\t\tvoid this.getStateAndNotify(context);\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tpanel.webview.options = { enableCommandUris: true, enableScripts: true };\n\t\tpanel.webview.html = await this.getHtml(context);\n\n\t\tif (this._disableAfterNextUse) {\n\t\t\tthis._disableAfterNextUse = false;\n\t\t\tvoid this.setEnabled(false);\n\t\t}\n\t}\n\n\t@gate((context: RebaseEditorContext) => `${context.id}`)\n\tprivate async getStateAndNotify(context: RebaseEditorContext) {\n\t\tif (!context.panel.visible) {\n\t\t\tcontext.pendingChange = true;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst state = await this.parseState(context);\n\t\tvoid this.postMessage(context, {\n\t\t\tid: nextIpcId(),\n\t\t\tmethod: DidChangeNotificationType.method,\n\t\t\tparams: { state: state },\n\t\t});\n\t}\n\n\tprivate async parseState(context: RebaseEditorContext): Promise<State> {\n\t\tconst branch = await this.container.git.getBranch(context.repoPath);\n\t\tconst state = await parseRebaseTodo(this.container, context.document.getText(), context.repoPath, branch?.name);\n\t\treturn state;\n\t}\n\n\tprivate async postMessage(context: RebaseEditorContext, message: IpcMessage) {\n\t\ttry {\n\t\t\tconst success = await context.panel.webview.postMessage(message);\n\t\t\tcontext.pendingChange = !success;\n\t\t\treturn success;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\n\t\t\tcontext.pendingChange = true;\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tprivate onMessageReceived(context: RebaseEditorContext, e: IpcMessage) {\n\t\tswitch (e.method) {\n\t\t\t// case ReadyCommandType.method:\n\t\t\t// \tonIpcCommand(ReadyCommandType, e, params => {\n\t\t\t// \t\tthis.parseDocumentAndSendChange(panel, document);\n\t\t\t// \t});\n\n\t\t\t// \tbreak;\n\n\t\t\tcase AbortCommandType.method:\n\t\t\t\tonIpc(AbortCommandType, e, () => this.abort(context));\n\n\t\t\t\tbreak;\n\n\t\t\tcase DisableCommandType.method:\n\t\t\t\tonIpc(DisableCommandType, e, () => this.disable(context));\n\t\t\t\tbreak;\n\n\t\t\tcase StartCommandType.method:\n\t\t\t\tonIpc(StartCommandType, e, () => this.rebase(context));\n\t\t\t\tbreak;\n\n\t\t\tcase SwitchCommandType.method:\n\t\t\t\tonIpc(SwitchCommandType, e, () => this.switch(context));\n\t\t\t\tbreak;\n\n\t\t\tcase ChangeEntryCommandType.method:\n\t\t\t\tonIpc(ChangeEntryCommandType, e, async params => {\n\t\t\t\t\tconst entries = parseRebaseTodoEntries(context.document);\n\n\t\t\t\t\tconst entry = entries.find(e => e.ref === params.ref);\n\t\t\t\t\tif (entry == null) return;\n\n\t\t\t\t\tconst start = context.document.positionAt(entry.index);\n\t\t\t\t\tconst range = context.document.validateRange(\n\t\t\t\t\t\tnew Range(new Position(start.line, 0), new Position(start.line, Number.MAX_SAFE_INTEGER)),\n\t\t\t\t\t);\n\n\t\t\t\t\tlet action = params.action;\n\t\t\t\t\tconst edit = new WorkspaceEdit();\n\n\t\t\t\t\t// Fake the new set of entries, to check if last entry is a squash/fixup\n\t\t\t\t\tconst newEntries = [...entries];\n\t\t\t\t\tnewEntries.splice(entries.indexOf(entry), 1, {\n\t\t\t\t\t\t...entry,\n\t\t\t\t\t\taction: params.action,\n\t\t\t\t\t});\n\n\t\t\t\t\tlet squashing = false;\n\n\t\t\t\t\tfor (const entry of newEntries) {\n\t\t\t\t\t\tif (entry.action === 'squash' || entry.action === 'fixup') {\n\t\t\t\t\t\t\tsquashing = true;\n\t\t\t\t\t\t} else if (squashing) {\n\t\t\t\t\t\t\tif (entry.action !== 'drop') {\n\t\t\t\t\t\t\t\tsquashing = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Ensure that the last entry isn't a squash/fixup\n\t\t\t\t\tif (squashing) {\n\t\t\t\t\t\tconst lastEntry = newEntries[newEntries.length - 1];\n\t\t\t\t\t\tif (entry.ref === lastEntry.ref) {\n\t\t\t\t\t\t\taction = 'pick';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst start = context.document.positionAt(lastEntry.index);\n\t\t\t\t\t\t\tconst range = context.document.validateRange(\n\t\t\t\t\t\t\t\tnew Range(\n\t\t\t\t\t\t\t\t\tnew Position(start.line, 0),\n\t\t\t\t\t\t\t\t\tnew Position(start.line, Number.MAX_SAFE_INTEGER),\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tedit.replace(context.document.uri, range, `pick ${lastEntry.ref} ${lastEntry.message}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tedit.replace(context.document.uri, range, `${action} ${entry.ref} ${entry.message}`);\n\t\t\t\t\tawait workspace.applyEdit(edit);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase MoveEntryCommandType.method:\n\t\t\t\tonIpc(MoveEntryCommandType, e, async params => {\n\t\t\t\t\tconst entries = parseRebaseTodoEntries(context.document);\n\n\t\t\t\t\tconst entry = entries.find(e => e.ref === params.ref);\n\t\t\t\t\tif (entry == null) return;\n\n\t\t\t\t\tconst index = entries.findIndex(e => e.ref === params.ref);\n\n\t\t\t\t\tlet newIndex;\n\t\t\t\t\tif (params.relative) {\n\t\t\t\t\t\tif ((params.to === -1 && index === 0) || (params.to === 1 && index === entries.length - 1)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnewIndex = index + params.to;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (index === params.to) return;\n\n\t\t\t\t\t\tnewIndex = params.to;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newEntry = entries[newIndex];\n\t\t\t\t\tlet newLine = context.document.positionAt(newEntry.index).line;\n\t\t\t\t\tif (newIndex < index) {\n\t\t\t\t\t\tnewLine++;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst start = context.document.positionAt(entry.index);\n\t\t\t\t\tconst range = context.document.validateRange(\n\t\t\t\t\t\tnew Range(new Position(start.line, 0), new Position(start.line + 1, 0)),\n\t\t\t\t\t);\n\n\t\t\t\t\t// Fake the new set of entries, so we can ensure that the last entry isn't a squash/fixup\n\t\t\t\t\tconst newEntries = [...entries];\n\t\t\t\t\tnewEntries.splice(index, 1);\n\t\t\t\t\tnewEntries.splice(newIndex, 0, entry);\n\n\t\t\t\t\tlet squashing = false;\n\n\t\t\t\t\tfor (const entry of newEntries) {\n\t\t\t\t\t\tif (entry.action === 'squash' || entry.action === 'fixup') {\n\t\t\t\t\t\t\tsquashing = true;\n\t\t\t\t\t\t} else if (squashing) {\n\t\t\t\t\t\t\tif (entry.action !== 'drop') {\n\t\t\t\t\t\t\t\tsquashing = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst edit = new WorkspaceEdit();\n\n\t\t\t\t\tlet action = entry.action;\n\n\t\t\t\t\t// Ensure that the last entry isn't a squash/fixup\n\t\t\t\t\tif (squashing) {\n\t\t\t\t\t\tconst lastEntry = newEntries[newEntries.length - 1];\n\t\t\t\t\t\tif (entry.ref === lastEntry.ref) {\n\t\t\t\t\t\t\taction = 'pick';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst start = context.document.positionAt(lastEntry.index);\n\t\t\t\t\t\t\tconst range = context.document.validateRange(\n\t\t\t\t\t\t\t\tnew Range(\n\t\t\t\t\t\t\t\t\tnew Position(start.line, 0),\n\t\t\t\t\t\t\t\t\tnew Position(start.line, Number.MAX_SAFE_INTEGER),\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tedit.replace(context.document.uri, range, `pick ${lastEntry.ref} ${lastEntry.message}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tedit.delete(context.document.uri, range);\n\t\t\t\t\tedit.insert(\n\t\t\t\t\t\tcontext.document.uri,\n\t\t\t\t\t\tnew Position(newLine, 0),\n\t\t\t\t\t\t`${action} ${entry.ref} ${entry.message}\\n`,\n\t\t\t\t\t);\n\n\t\t\t\t\tawait workspace.applyEdit(edit);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate async abort(context: RebaseEditorContext) {\n\t\tcontext.abortOnClose = false;\n\n\t\t// Avoid triggering events by disposing them first\n\t\tcontext.dispose();\n\n\t\t// Delete the contents to abort the rebase\n\t\tconst edit = new WorkspaceEdit();\n\t\tedit.replace(context.document.uri, new Range(0, 0, context.document.lineCount, 0), '');\n\t\tawait workspace.applyEdit(edit);\n\t\tawait context.document.save();\n\n\t\tcontext.panel.dispose();\n\t}\n\n\tprivate async disable(context: RebaseEditorContext) {\n\t\tawait this.abort(context);\n\t\tawait this.setEnabled(false);\n\t}\n\n\tprivate async rebase(context: RebaseEditorContext) {\n\t\tcontext.abortOnClose = false;\n\n\t\t// Avoid triggering events by disposing them first\n\t\tcontext.dispose();\n\n\t\tawait context.document.save();\n\n\t\tcontext.panel.dispose();\n\t}\n\n\tprivate switch(context: RebaseEditorContext) {\n\t\tcontext.abortOnClose = false;\n\n\t\tvoid Messages.showRebaseSwitchToTextWarningMessage();\n\n\t\t// Open the text version of the document\n\t\tvoid executeCoreCommand(CoreCommands.Open, context.document.uri, {\n\t\t\toverride: false,\n\t\t\tpreview: false,\n\t\t});\n\t}\n\n\tprivate async getHtml(context: RebaseEditorContext): Promise<string> {\n\t\tconst webRootUri = Uri.joinPath(this.container.context.extensionUri, 'dist', 'webviews');\n\t\tconst uri = Uri.joinPath(webRootUri, 'rebase.html');\n\t\tconst content = new TextDecoder('utf8').decode(await workspace.fs.readFile(uri));\n\n\t\tconst bootstrap = await this.parseState(context);\n\t\tconst cspSource = context.panel.webview.cspSource;\n\t\tconst cspNonce = getNonce();\n\n\t\tconst root = context.panel.webview.asWebviewUri(this.container.context.extensionUri).toString();\n\t\tconst webRoot = context.panel.webview.asWebviewUri(webRootUri).toString();\n\n\t\tconst html = content\n\t\t\t.replace(/#{(head|body|endOfBody)}/i, (_substring, token) => {\n\t\t\t\tswitch (token) {\n\t\t\t\t\tcase 'endOfBody':\n\t\t\t\t\t\treturn `<script type=\"text/javascript\" nonce=\"#{cspNonce}\">window.bootstrap = ${JSON.stringify(\n\t\t\t\t\t\t\tbootstrap,\n\t\t\t\t\t\t)};</script>`;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t})\n\t\t\t.replace(/#{(cspSource|cspNonce|root|webroot)}/g, (substring, token) => {\n\t\t\t\tswitch (token) {\n\t\t\t\t\tcase 'cspSource':\n\t\t\t\t\t\treturn cspSource;\n\t\t\t\t\tcase 'cspNonce':\n\t\t\t\t\t\treturn cspNonce;\n\t\t\t\t\tcase 'root':\n\t\t\t\t\t\treturn root;\n\t\t\t\t\tcase 'webroot':\n\t\t\t\t\t\treturn webRoot;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn html;\n\t}\n}\n\nasync function parseRebaseTodo(\n\tcontainer: Container,\n\tcontents: string | { entries: RebaseEntry[]; onto: string },\n\trepoPath: string,\n\tbranch: string | undefined,\n): Promise<Omit<State, 'rebasing'>> {\n\tlet onto: string;\n\tlet entries;\n\tif (typeof contents === 'string') {\n\t\tentries = parseRebaseTodoEntries(contents);\n\t\t[, , , onto] = rebaseRegex.exec(contents) ?? ['', '', ''];\n\t} else {\n\t\t({ entries, onto } = contents);\n\t}\n\n\tconst authors = new Map<string, Author>();\n\tconst commits: Commit[] = [];\n\n\tconst log = await container.git.getLogForSearch(repoPath, {\n\t\tpattern: `${onto ? `#:${onto} ` : ''}${join(\n\t\t\tmap(entries, e => `#:${e.ref}`),\n\t\t\t' ',\n\t\t)}`,\n\t});\n\tconst foundCommits = log != null ? [...log.commits.values()] : [];\n\n\tconst ontoCommit = onto ? foundCommits.find(c => c.ref.startsWith(onto)) : undefined;\n\tif (ontoCommit != null) {\n\t\tconst { name, email } = ontoCommit.author;\n\t\tif (!authors.has(name)) {\n\t\t\tauthors.set(name, {\n\t\t\t\tauthor: name,\n\t\t\t\tavatarUrl: (\n\t\t\t\t\tawait ontoCommit.getAvatarUri({ defaultStyle: container.config.defaultGravatarsStyle })\n\t\t\t\t).toString(true),\n\t\t\t\temail: email,\n\t\t\t});\n\t\t}\n\n\t\tcommits.push({\n\t\t\tref: ontoCommit.ref,\n\t\t\tauthor: name,\n\t\t\tdate: ontoCommit.formatDate(container.config.defaultDateFormat),\n\t\t\tdateFromNow: ontoCommit.formatDateFromNow(),\n\t\t\tmessage: ontoCommit.message || 'root',\n\t\t});\n\t}\n\n\tfor (const entry of entries) {\n\t\tconst commit = foundCommits.find(c => c.ref.startsWith(entry.ref));\n\t\tif (commit == null) continue;\n\n\t\t// If the onto commit is contained in the list of commits, remove it and clear the 'onto' value  See #1201\n\t\tif (commit.ref === ontoCommit?.ref) {\n\t\t\tcommits.splice(0, 1);\n\t\t\tonto = '';\n\t\t}\n\n\t\tconst { name, email } = commit.author;\n\t\tif (!authors.has(name)) {\n\t\t\tauthors.set(name, {\n\t\t\t\tauthor: name,\n\t\t\t\tavatarUrl: (\n\t\t\t\t\tawait commit.getAvatarUri({ defaultStyle: container.config.defaultGravatarsStyle })\n\t\t\t\t).toString(true),\n\t\t\t\temail: email,\n\t\t\t});\n\t\t}\n\n\t\tcommits.push({\n\t\t\tref: commit.ref,\n\t\t\tauthor: name,\n\t\t\tdate: commit.formatDate(container.config.defaultDateFormat),\n\t\t\tdateFromNow: commit.formatDateFromNow(),\n\t\t\tmessage: commit.message ?? commit.summary,\n\t\t});\n\t}\n\n\treturn {\n\t\tbranch: branch ?? '',\n\t\tonto: onto,\n\t\tentries: entries,\n\t\tauthors: [...authors.values()],\n\t\tcommits: commits,\n\t\tcommands: {\n\t\t\tcommit: ShowQuickCommitCommand.getMarkdownCommandArgs(`\\${commit}`, repoPath),\n\t\t},\n\t};\n}\n\nfunction parseRebaseTodoEntries(contents: string): RebaseEntry[];\nfunction parseRebaseTodoEntries(document: TextDocument): RebaseEntry[];\nfunction parseRebaseTodoEntries(contentsOrDocument: string | TextDocument): RebaseEntry[] {\n\tconst contents = typeof contentsOrDocument === 'string' ? contentsOrDocument : contentsOrDocument.getText();\n\n\tconst entries: RebaseEntry[] = [];\n\n\tlet match;\n\tlet action;\n\tlet ref;\n\tlet message;\n\n\tdo {\n\t\tmatch = rebaseCommandsRegex.exec(contents);\n\t\tif (match == null) break;\n\n\t\t[, action, ref, message] = match;\n\n\t\tentries.push({\n\t\t\tindex: match.index,\n\t\t\taction: rebaseActionsMap.get(action) ?? 'pick',\n\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\tref: ` ${ref}`.substr(1),\n\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\tmessage: message == null || message.length === 0 ? '' : ` ${message}`.substr(1),\n\t\t});\n\t} while (true);\n\n\treturn entries.reverse();\n}\n","import { ConfigurationChangeEvent, ConfigurationTarget, WebviewPanelOnDidChangeViewStateEvent } from 'vscode';\nimport { configuration } from '../configuration';\nimport { Commands } from '../constants';\nimport type { Container } from '../container';\nimport { CommitFormatter } from '../git/formatters';\nimport {\n\tGitCommit,\n\tGitCommitIdentity,\n\tGitFileChange,\n\tGitFileIndexStatus,\n\tPullRequest,\n\tPullRequestState,\n} from '../git/models';\nimport { Logger } from '../logger';\nimport {\n\tDidChangeConfigurationNotificationType,\n\tDidGenerateConfigurationPreviewNotificationType,\n\tDidOpenAnchorNotificationType,\n\tGenerateConfigurationPreviewCommandType,\n\tIpcMessage,\n\tonIpc,\n\tUpdateConfigurationCommandType,\n} from './protocol';\nimport { WebviewBase } from './webviewBase';\n\nexport abstract class WebviewWithConfigBase<State> extends WebviewBase<State> {\n\tprivate _pendingJumpToAnchor: string | undefined;\n\n\tconstructor(\n\t\tcontainer: Container,\n\t\tid: `gitlens.${string}`,\n\t\tfileName: string,\n\t\ticonPath: string,\n\t\ttitle: string,\n\t\tshowCommand: Commands,\n\t) {\n\t\tsuper(container, id, fileName, iconPath, title, showCommand);\n\t\tthis.disposables.push(\n\t\t\tconfiguration.onDidChange(this.onConfigurationChanged, this),\n\t\t\tconfiguration.onDidChangeAny(this.onAnyConfigurationChanged, this),\n\t\t);\n\t}\n\n\tprivate onAnyConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tlet notify = false;\n\t\tfor (const setting of this.customSettings.values()) {\n\t\t\tif (e.affectsConfiguration(setting.name)) {\n\t\t\t\tnotify = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!notify) return;\n\n\t\tvoid this.notifyDidChangeConfiguration();\n\t}\n\n\tprivate onConfigurationChanged(_e: ConfigurationChangeEvent) {\n\t\tvoid this.notifyDidChangeConfiguration();\n\t}\n\n\tprotected override onReady() {\n\t\tif (this._pendingJumpToAnchor != null) {\n\t\t\tconst anchor = this._pendingJumpToAnchor;\n\t\t\tthis._pendingJumpToAnchor = undefined;\n\n\t\t\tvoid this.notify(DidOpenAnchorNotificationType, { anchor: anchor, scrollBehavior: 'auto' });\n\t\t}\n\t}\n\n\tprotected override onShowCommand(anchor?: string) {\n\t\tif (anchor) {\n\t\t\tif (this.isReady && this.visible) {\n\t\t\t\tqueueMicrotask(\n\t\t\t\t\t() => void this.notify(DidOpenAnchorNotificationType, { anchor: anchor, scrollBehavior: 'smooth' }),\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._pendingJumpToAnchor = anchor;\n\t\t}\n\t\tsuper.onShowCommand();\n\t}\n\n\tprotected override onViewStateChanged(e: WebviewPanelOnDidChangeViewStateEvent): void {\n\t\tsuper.onViewStateChanged(e);\n\n\t\t// Anytime the webview becomes active, make sure it has the most up-to-date config\n\t\tif (e.webviewPanel.active) {\n\t\t\tvoid this.notifyDidChangeConfiguration();\n\t\t}\n\t}\n\n\tprotected override onMessageReceivedCore(e: IpcMessage): void {\n\t\tif (e == null) return;\n\n\t\tswitch (e.method) {\n\t\t\tcase UpdateConfigurationCommandType.method:\n\t\t\t\tLogger.debug(`Webview(${this.id}).onMessageReceived: method=${e.method}`);\n\n\t\t\t\tonIpc(UpdateConfigurationCommandType, e, async params => {\n\t\t\t\t\tconst target =\n\t\t\t\t\t\tparams.scope === 'workspace' ? ConfigurationTarget.Workspace : ConfigurationTarget.Global;\n\n\t\t\t\t\tfor (const key in params.changes) {\n\t\t\t\t\t\tlet value = params.changes[key];\n\n\t\t\t\t\t\tconst customSetting = this.customSettings.get(key);\n\t\t\t\t\t\tif (customSetting != null) {\n\t\t\t\t\t\t\tawait customSetting.update(value);\n\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst inspect = configuration.inspect(key as any)!;\n\n\t\t\t\t\t\tif (value != null) {\n\t\t\t\t\t\t\tif (params.scope === 'workspace') {\n\t\t\t\t\t\t\t\tif (value === inspect.workspaceValue) continue;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (value === inspect.globalValue && value !== inspect.defaultValue) continue;\n\n\t\t\t\t\t\t\t\tif (value === inspect.defaultValue) {\n\t\t\t\t\t\t\t\t\tvalue = undefined;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvoid (await configuration.update(key as any, value, target));\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const key of params.removes) {\n\t\t\t\t\t\tvoid (await configuration.update(key as any, undefined, target));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase GenerateConfigurationPreviewCommandType.method:\n\t\t\t\tLogger.debug(`Webview(${this.id}).onMessageReceived: method=${e.method}`);\n\n\t\t\t\tonIpc(GenerateConfigurationPreviewCommandType, e, async params => {\n\t\t\t\t\tswitch (params.type) {\n\t\t\t\t\t\tcase 'commit': {\n\t\t\t\t\t\t\tconst commit = new GitCommit(\n\t\t\t\t\t\t\t\tthis.container,\n\t\t\t\t\t\t\t\t'~/code/eamodio/vscode-gitlens-demo',\n\t\t\t\t\t\t\t\t'fe26af408293cba5b4bfd77306e1ac9ff7ccaef8',\n\t\t\t\t\t\t\t\tnew GitCommitIdentity('You', 'eamodio@gmail.com', new Date('2016-11-12T20:41:00.000Z')),\n\t\t\t\t\t\t\t\tnew GitCommitIdentity('You', 'eamodio@gmail.com', new Date('2020-11-01T06:57:21.000Z')),\n\t\t\t\t\t\t\t\t'Supercharged',\n\t\t\t\t\t\t\t\t['3ac1d3f51d7cf5f438cc69f25f6740536ad80fef'],\n\t\t\t\t\t\t\t\t'Supercharged',\n\t\t\t\t\t\t\t\tnew GitFileChange(\n\t\t\t\t\t\t\t\t\t'~/code/eamodio/vscode-gitlens-demo',\n\t\t\t\t\t\t\t\t\t'code.ts',\n\t\t\t\t\t\t\t\t\tGitFileIndexStatus.Modified,\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\t[],\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tlet includePullRequest = false;\n\t\t\t\t\t\t\tswitch (params.key) {\n\t\t\t\t\t\t\t\tcase configuration.name('currentLine.format'):\n\t\t\t\t\t\t\t\t\tincludePullRequest = this.container.config.currentLine.pullRequests.enabled;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase configuration.name('statusBar.format'):\n\t\t\t\t\t\t\t\t\tincludePullRequest = this.container.config.statusBar.pullRequests.enabled;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet pr: PullRequest | undefined;\n\t\t\t\t\t\t\tif (includePullRequest) {\n\t\t\t\t\t\t\t\tpr = new PullRequest(\n\t\t\t\t\t\t\t\t\t{ id: 'github', name: 'GitHub', domain: 'github.com' },\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'Eric Amodio',\n\t\t\t\t\t\t\t\t\t\tavatarUrl: 'https://avatars1.githubusercontent.com/u/641685?s=32&v=4',\n\t\t\t\t\t\t\t\t\t\turl: 'https://github.com/eamodio',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t'1',\n\t\t\t\t\t\t\t\t\t'Supercharged',\n\t\t\t\t\t\t\t\t\t'https://github.com/gitkraken/vscode-gitlens/pulls/1',\n\t\t\t\t\t\t\t\t\tPullRequestState.Merged,\n\t\t\t\t\t\t\t\t\tnew Date('Sat, 12 Nov 2016 19:41:00 GMT'),\n\t\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\t\tnew Date('Sat, 12 Nov 2016 20:41:00 GMT'),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet preview;\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tpreview = CommitFormatter.fromTemplate(params.format, commit, {\n\t\t\t\t\t\t\t\t\tdateFormat: this.container.config.defaultDateFormat,\n\t\t\t\t\t\t\t\t\tpullRequestOrRemote: pr,\n\t\t\t\t\t\t\t\t\tmessageTruncateAtNewLine: true,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\tpreview = 'Invalid format';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tawait this.notify(DidGenerateConfigurationPreviewNotificationType, {\n\t\t\t\t\t\t\t\tcompletionId: e.id,\n\t\t\t\t\t\t\t\tpreview: preview,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tsuper.onMessageReceivedCore(e);\n\t\t}\n\t}\n\n\tprivate _customSettings: Map<string, CustomSetting> | undefined;\n\tprivate get customSettings() {\n\t\tif (this._customSettings == null) {\n\t\t\tthis._customSettings = new Map<string, CustomSetting>([\n\t\t\t\t[\n\t\t\t\t\t'rebaseEditor.enabled',\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'workbench.editorAssociations',\n\t\t\t\t\t\tenabled: () => this.container.rebaseEditor.enabled,\n\t\t\t\t\t\tupdate: this.container.rebaseEditor.setEnabled,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t]);\n\t\t}\n\t\treturn this._customSettings;\n\t}\n\n\tprotected getCustomSettings(): Record<string, boolean> {\n\t\tconst customSettings = Object.create(null);\n\t\tfor (const [key, setting] of this.customSettings) {\n\t\t\tcustomSettings[key] = setting.enabled();\n\t\t}\n\t\treturn customSettings;\n\t}\n\n\tprivate notifyDidChangeConfiguration() {\n\t\t// Make sure to get the raw config, not from the container which has the modes mixed in\n\t\treturn this.notify(DidChangeConfigurationNotificationType, {\n\t\t\tconfig: configuration.get(),\n\t\t\tcustomSettings: this.getCustomSettings(),\n\t\t});\n\t}\n}\n\ninterface CustomSetting {\n\tname: string;\n\tenabled: () => boolean;\n\tupdate: (enabled: boolean) => Promise<void>;\n}\n","import { commands, workspace } from 'vscode';\nimport { configuration } from '../../configuration';\nimport { Commands } from '../../constants';\nimport type { Container } from '../../container';\nimport { WebviewWithConfigBase } from '../webviewWithConfigBase';\nimport { State } from './protocol';\n\nconst anchorRegex = /.*?#(.*)/;\n\nexport class SettingsWebview extends WebviewWithConfigBase<State> {\n\tconstructor(container: Container) {\n\t\tsuper(\n\t\t\tcontainer,\n\t\t\t'gitlens.settings',\n\t\t\t'settings.html',\n\t\t\t'images/gitlens-icon.png',\n\t\t\t'GitLens Settings',\n\t\t\tCommands.ShowSettingsPage,\n\t\t);\n\n\t\tthis.disposables.push(\n\t\t\t...[\n\t\t\t\tCommands.ShowSettingsPageAndJumpToBranchesView,\n\t\t\t\tCommands.ShowSettingsPageAndJumpToCommitsView,\n\t\t\t\tCommands.ShowSettingsPageAndJumpToContributorsView,\n\t\t\t\tCommands.ShowSettingsPageAndJumpToFileHistoryView,\n\t\t\t\tCommands.ShowSettingsPageAndJumpToLineHistoryView,\n\t\t\t\tCommands.ShowSettingsPageAndJumpToRemotesView,\n\t\t\t\tCommands.ShowSettingsPageAndJumpToRepositoriesView,\n\t\t\t\tCommands.ShowSettingsPageAndJumpToSearchAndCompareView,\n\t\t\t\tCommands.ShowSettingsPageAndJumpToStashesView,\n\t\t\t\tCommands.ShowSettingsPageAndJumpToTagsView,\n\t\t\t\tCommands.ShowSettingsPageAndJumpToWorkTreesView,\n\t\t\t\tCommands.ShowSettingsPageAndJumpToViews,\n\t\t\t].map(c => {\n\t\t\t\t// The show and jump commands are structured to have a # separating the base command from the anchor\n\t\t\t\tlet anchor: string | undefined;\n\t\t\t\tconst match = anchorRegex.exec(c);\n\t\t\t\tif (match != null) {\n\t\t\t\t\t[, anchor] = match;\n\t\t\t\t}\n\n\t\t\t\treturn commands.registerCommand(c, () => this.onShowCommand(anchor), this);\n\t\t\t}),\n\t\t);\n\t}\n\n\tprotected override includeBootstrap(): State {\n\t\tconst scopes: ['user' | 'workspace', string][] = [['user', 'User']];\n\t\tif (workspace.workspaceFolders?.length) {\n\t\t\tscopes.push(['workspace', 'Workspace']);\n\t\t}\n\n\t\treturn {\n\t\t\t// Make sure to get the raw config, not from the container which has the modes mixed in\n\t\t\tconfig: configuration.get(),\n\t\t\tcustomSettings: this.getCustomSettings(),\n\t\t\tscope: 'user',\n\t\t\tscopes: scopes,\n\t\t};\n\t}\n}\n","import { Commands } from '../../constants';\nimport type { Container } from '../../container';\nimport { WebviewWithConfigBase } from '../webviewWithConfigBase';\nimport type { State } from './protocol';\n\nexport class WelcomeWebview extends WebviewWithConfigBase<State> {\n\tconstructor(container: Container) {\n\t\tsuper(\n\t\t\tcontainer,\n\t\t\t'gitlens.welcome',\n\t\t\t'welcome.html',\n\t\t\t'images/gitlens-icon.png',\n\t\t\t'Welcome to GitLens',\n\t\t\tCommands.ShowWelcomePage,\n\t\t);\n\t}\n\n\tprotected override includeBootstrap(): State {\n\t\treturn {\n\t\t\tconfig: this.container.config,\n\t\t};\n\t}\n}\n","import {\n\tConfigurationChangeEvent,\n\tConfigurationScope,\n\tEvent,\n\tEventEmitter,\n\tExtensionContext,\n\tExtensionMode,\n} from 'vscode';\nimport { getSupportedGitProviders } from '@env/providers';\nimport { Autolinks } from './annotations/autolinks';\nimport { FileAnnotationController } from './annotations/fileAnnotationController';\nimport { LineAnnotationController } from './annotations/lineAnnotationController';\nimport { ActionRunners } from './api/actionRunners';\nimport { resetAvatarCache } from './avatars';\nimport { GitCodeLensController } from './codelens/codeLensController';\nimport type { ToggleFileAnnotationCommandArgs } from './commands';\nimport {\n\tAnnotationsToggleMode,\n\tConfig,\n\tconfiguration,\n\tConfigurationWillChangeEvent,\n\tDateSource,\n\tDateStyle,\n\tFileAnnotationType,\n} from './configuration';\nimport { Commands } from './constants';\nimport { GitFileSystemProvider } from './git/fsProvider';\nimport { GitProviderService } from './git/gitProviderService';\nimport { LineHoverController } from './hovers/lineHoverController';\nimport { Keyboard } from './keyboard';\nimport { Logger } from './logger';\nimport { SubscriptionService } from './premium/subscription/subscriptionService';\nimport { TimelineWebview } from './premium/webviews/timeline/timelineWebview';\nimport { TimelineWebviewView } from './premium/webviews/timeline/timelineWebviewView';\nimport { StatusBarController } from './statusbar/statusBarController';\nimport { Storage } from './storage';\nimport { executeCommand } from './system/command';\nimport { log } from './system/decorators/log';\nimport { memoize } from './system/decorators/memoize';\nimport { GitTerminalLinkProvider } from './terminal/linkProvider';\nimport { GitDocumentTracker } from './trackers/gitDocumentTracker';\nimport { GitLineTracker } from './trackers/gitLineTracker';\nimport { BranchesView } from './views/branchesView';\nimport { CommitsView } from './views/commitsView';\nimport { ContributorsView } from './views/contributorsView';\nimport { FileHistoryView } from './views/fileHistoryView';\nimport { LineHistoryView } from './views/lineHistoryView';\nimport { RemotesView } from './views/remotesView';\nimport { RepositoriesView } from './views/repositoriesView';\nimport { SearchAndCompareView } from './views/searchAndCompareView';\nimport { StashesView } from './views/stashesView';\nimport { TagsView } from './views/tagsView';\nimport { ViewCommands } from './views/viewCommands';\nimport { ViewFileDecorationProvider } from './views/viewDecorationProvider';\nimport { WorktreesView } from './views/worktreesView';\nimport { VslsController } from './vsls/vsls';\nimport { HomeWebviewView } from './webviews/home/homeWebviewView';\nimport { RebaseEditorProvider } from './webviews/rebase/rebaseEditor';\nimport { SettingsWebview } from './webviews/settings/settingsWebview';\nimport { WelcomeWebview } from './webviews/welcome/welcomeWebview';\n\nexport class Container {\n\tstatic #instance: Container | undefined;\n\tstatic #proxy = new Proxy<Container>({} as Container, {\n\t\tget: function (target, prop) {\n\t\t\t// In case anyone has cached this instance\n\t\t\tif (Container.#instance != null) return (Container.#instance as any)[prop];\n\n\t\t\t// Allow access to config before we are initialized\n\t\t\tif (prop === 'config') return configuration.get();\n\n\t\t\t// debugger;\n\t\t\tthrow new Error('Container is not initialized');\n\t\t},\n\t});\n\n\tstatic create(context: ExtensionContext, cfg: Config) {\n\t\tif (Container.#instance != null) throw new Error('Container is already initialized');\n\n\t\tContainer.#instance = new Container(context, cfg);\n\t\treturn Container.#instance;\n\t}\n\n\tstatic get instance(): Container {\n\t\treturn Container.#instance ?? Container.#proxy;\n\t}\n\n\tprivate _onReady: EventEmitter<void> = new EventEmitter<void>();\n\tget onReady(): Event<void> {\n\t\treturn this._onReady.event;\n\t}\n\n\treadonly BranchDateFormatting = {\n\t\tdateFormat: undefined! as string | null,\n\t\tdateStyle: undefined! as DateStyle,\n\n\t\treset: () => {\n\t\t\tthis.BranchDateFormatting.dateFormat = configuration.get('defaultDateFormat');\n\t\t\tthis.BranchDateFormatting.dateStyle = configuration.get('defaultDateStyle');\n\t\t},\n\t};\n\n\treadonly CommitDateFormatting = {\n\t\tdateFormat: null as string | null,\n\t\tdateSource: DateSource.Authored,\n\t\tdateStyle: DateStyle.Relative,\n\n\t\treset: () => {\n\t\t\tthis.CommitDateFormatting.dateFormat = configuration.get('defaultDateFormat');\n\t\t\tthis.CommitDateFormatting.dateSource = configuration.get('defaultDateSource');\n\t\t\tthis.CommitDateFormatting.dateStyle = configuration.get('defaultDateStyle');\n\t\t},\n\t};\n\n\treadonly CommitShaFormatting = {\n\t\tlength: 7,\n\n\t\treset: () => {\n\t\t\t// Don't allow shas to be shortened to less than 5 characters\n\t\t\tthis.CommitShaFormatting.length = Math.max(5, configuration.get('advanced.abbreviatedShaLength'));\n\t\t},\n\t};\n\n\treadonly PullRequestDateFormatting = {\n\t\tdateFormat: null as string | null,\n\t\tdateStyle: DateStyle.Relative,\n\n\t\treset: () => {\n\t\t\tthis.PullRequestDateFormatting.dateFormat = configuration.get('defaultDateFormat');\n\t\t\tthis.PullRequestDateFormatting.dateStyle = configuration.get('defaultDateStyle');\n\t\t},\n\t};\n\n\treadonly TagDateFormatting = {\n\t\tdateFormat: null as string | null,\n\t\tdateStyle: DateStyle.Relative,\n\n\t\treset: () => {\n\t\t\tthis.TagDateFormatting.dateFormat = configuration.get('defaultDateFormat');\n\t\t\tthis.TagDateFormatting.dateStyle = configuration.get('defaultDateStyle');\n\t\t},\n\t};\n\n\tprivate _configsAffectedByMode: string[] | undefined;\n\tprivate _applyModeConfigurationTransformBound:\n\t\t| ((e: ConfigurationChangeEvent) => ConfigurationChangeEvent)\n\t\t| undefined;\n\n\tprivate _terminalLinks: GitTerminalLinkProvider | undefined;\n\n\tprivate constructor(context: ExtensionContext, config: Config) {\n\t\tthis._context = context;\n\t\tthis._config = this.applyMode(config);\n\t\tthis._storage = new Storage(this._context);\n\n\t\tcontext.subscriptions.push(configuration.onWillChange(this.onConfigurationChanging, this));\n\n\t\tcontext.subscriptions.push((this._subscription = new SubscriptionService(this)));\n\n\t\tcontext.subscriptions.push((this._git = new GitProviderService(this)));\n\t\tcontext.subscriptions.push(new GitFileSystemProvider(this));\n\n\t\tcontext.subscriptions.push((this._actionRunners = new ActionRunners(this)));\n\t\tcontext.subscriptions.push((this._tracker = new GitDocumentTracker(this)));\n\t\tcontext.subscriptions.push((this._lineTracker = new GitLineTracker(this)));\n\t\tcontext.subscriptions.push((this._keyboard = new Keyboard()));\n\t\tcontext.subscriptions.push((this._vsls = new VslsController(this)));\n\n\t\tcontext.subscriptions.push((this._fileAnnotationController = new FileAnnotationController(this)));\n\t\tcontext.subscriptions.push((this._lineAnnotationController = new LineAnnotationController(this)));\n\t\tcontext.subscriptions.push((this._lineHoverController = new LineHoverController(this)));\n\t\tcontext.subscriptions.push((this._statusBarController = new StatusBarController(this)));\n\t\tcontext.subscriptions.push((this._codeLensController = new GitCodeLensController(this)));\n\n\t\tcontext.subscriptions.push((this._settingsWebview = new SettingsWebview(this)));\n\t\tcontext.subscriptions.push((this._timelineWebview = new TimelineWebview(this)));\n\t\tcontext.subscriptions.push((this._welcomeWebview = new WelcomeWebview(this)));\n\t\tcontext.subscriptions.push((this._rebaseEditor = new RebaseEditorProvider(this)));\n\n\t\tcontext.subscriptions.push(new ViewFileDecorationProvider());\n\n\t\tcontext.subscriptions.push((this._repositoriesView = new RepositoriesView(this)));\n\t\tcontext.subscriptions.push((this._commitsView = new CommitsView(this)));\n\t\tcontext.subscriptions.push((this._fileHistoryView = new FileHistoryView(this)));\n\t\tcontext.subscriptions.push((this._lineHistoryView = new LineHistoryView(this)));\n\t\tcontext.subscriptions.push((this._branchesView = new BranchesView(this)));\n\t\tcontext.subscriptions.push((this._remotesView = new RemotesView(this)));\n\t\tcontext.subscriptions.push((this._stashesView = new StashesView(this)));\n\t\tcontext.subscriptions.push((this._tagsView = new TagsView(this)));\n\t\tcontext.subscriptions.push((this._worktreesView = new WorktreesView(this)));\n\t\tcontext.subscriptions.push((this._contributorsView = new ContributorsView(this)));\n\t\tcontext.subscriptions.push((this._searchAndCompareView = new SearchAndCompareView(this)));\n\n\t\tcontext.subscriptions.push((this._homeView = new HomeWebviewView(this)));\n\t\tcontext.subscriptions.push((this._timelineView = new TimelineWebviewView(this)));\n\n\t\tif (config.terminalLinks.enabled) {\n\t\t\tcontext.subscriptions.push((this._terminalLinks = new GitTerminalLinkProvider(this)));\n\t\t}\n\n\t\tcontext.subscriptions.push(\n\t\t\tconfiguration.onDidChange(e => {\n\t\t\t\tif (!configuration.changed(e, 'terminalLinks.enabled')) return;\n\n\t\t\t\tthis._terminalLinks?.dispose();\n\t\t\t\tif (this.config.terminalLinks.enabled) {\n\t\t\t\t\tcontext.subscriptions.push((this._terminalLinks = new GitTerminalLinkProvider(this)));\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tprivate _ready: boolean = false;\n\n\tasync ready() {\n\t\tif (this._ready) throw new Error('Container is already ready');\n\n\t\tthis._ready = true;\n\t\tawait this.registerGitProviders();\n\t\tqueueMicrotask(() => this._onReady.fire());\n\t}\n\n\t@log()\n\tprivate async registerGitProviders() {\n\t\tconst providers = await getSupportedGitProviders(this);\n\t\tfor (const provider of providers) {\n\t\t\tthis._context.subscriptions.push(this._git.register(provider.descriptor.id, provider));\n\t\t}\n\n\t\tthis._git.registrationComplete();\n\t}\n\n\tprivate onConfigurationChanging(e: ConfigurationWillChangeEvent) {\n\t\tthis._config = undefined;\n\n\t\tif (configuration.changed(e.change, 'outputLevel')) {\n\t\t\tLogger.logLevel = configuration.get('outputLevel');\n\t\t}\n\n\t\tif (configuration.changed(e.change, 'defaultGravatarsStyle')) {\n\t\t\tresetAvatarCache('fallback');\n\t\t}\n\n\t\tif (configuration.changed(e.change, 'mode') || configuration.changed(e.change, 'modes')) {\n\t\t\tif (this._applyModeConfigurationTransformBound == null) {\n\t\t\t\tthis._applyModeConfigurationTransformBound = this.applyModeConfigurationTransform.bind(this);\n\t\t\t}\n\t\t\te.transform = this._applyModeConfigurationTransformBound;\n\t\t}\n\t}\n\n\tprivate _actionRunners: ActionRunners;\n\tget actionRunners() {\n\t\tif (this._actionRunners == null) {\n\t\t\tthis._context.subscriptions.push((this._actionRunners = new ActionRunners(this)));\n\t\t}\n\n\t\treturn this._actionRunners;\n\t}\n\n\tprivate _autolinks: Autolinks | undefined;\n\tget autolinks() {\n\t\tif (this._autolinks == null) {\n\t\t\tthis._context.subscriptions.push((this._autolinks = new Autolinks(this)));\n\t\t}\n\n\t\treturn this._autolinks;\n\t}\n\n\tprivate _codeLensController: GitCodeLensController;\n\tget codeLens() {\n\t\treturn this._codeLensController;\n\t}\n\n\tprivate _branchesView: BranchesView | undefined;\n\tget branchesView() {\n\t\tif (this._branchesView == null) {\n\t\t\tthis._context.subscriptions.push((this._branchesView = new BranchesView(this)));\n\t\t}\n\n\t\treturn this._branchesView;\n\t}\n\n\tprivate _commitsView: CommitsView | undefined;\n\tget commitsView() {\n\t\tif (this._commitsView == null) {\n\t\t\tthis._context.subscriptions.push((this._commitsView = new CommitsView(this)));\n\t\t}\n\n\t\treturn this._commitsView;\n\t}\n\n\tprivate _config: Config | undefined;\n\tget config() {\n\t\tif (this._config == null) {\n\t\t\tthis._config = this.applyMode(configuration.get());\n\t\t}\n\t\treturn this._config;\n\t}\n\n\tprivate _context: ExtensionContext;\n\tget context() {\n\t\treturn this._context;\n\t}\n\n\tprivate _contributorsView: ContributorsView | undefined;\n\tget contributorsView() {\n\t\tif (this._contributorsView == null) {\n\t\t\tthis._context.subscriptions.push((this._contributorsView = new ContributorsView(this)));\n\t\t}\n\n\t\treturn this._contributorsView;\n\t}\n\n\t@memoize()\n\tget debugging() {\n\t\treturn this._context.extensionMode === ExtensionMode.Development;\n\t}\n\n\t@memoize()\n\tget env(): 'dev' | 'staging' | 'production' {\n\t\tif (this.insiders || this.debugging) {\n\t\t\tconst env = configuration.getAny('gitkraken.env');\n\t\t\tif (env === 'dev') return 'dev';\n\t\t\tif (env === 'staging') return 'staging';\n\t\t}\n\n\t\treturn 'production';\n\t}\n\n\tprivate _fileAnnotationController: FileAnnotationController;\n\tget fileAnnotations() {\n\t\treturn this._fileAnnotationController;\n\t}\n\n\tprivate _fileHistoryView: FileHistoryView | undefined;\n\tget fileHistoryView() {\n\t\tif (this._fileHistoryView == null) {\n\t\t\tthis._context.subscriptions.push((this._fileHistoryView = new FileHistoryView(this)));\n\t\t}\n\n\t\treturn this._fileHistoryView;\n\t}\n\n\tprivate _git: GitProviderService;\n\tget git() {\n\t\treturn this._git;\n\t}\n\n\tprivate _github: Promise<import('./premium/github/github').GitHubApi | undefined> | undefined;\n\tget github() {\n\t\tif (this._github == null) {\n\t\t\tthis._github = this._loadGitHubApi();\n\t\t}\n\n\t\treturn this._github;\n\t}\n\n\tprivate async _loadGitHubApi() {\n\t\ttry {\n\t\t\treturn new (await import(/* webpackChunkName: \"github\" */ './premium/github/github')).GitHubApi();\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprivate _homeView: HomeWebviewView | undefined;\n\tget homeView() {\n\t\tif (this._homeView == null) {\n\t\t\tthis._context.subscriptions.push((this._homeView = new HomeWebviewView(this)));\n\t\t}\n\n\t\treturn this._homeView;\n\t}\n\n\t@memoize()\n\tget insiders() {\n\t\treturn this._context.extension.id.endsWith('-insiders');\n\t}\n\n\tprivate _keyboard: Keyboard;\n\tget keyboard() {\n\t\treturn this._keyboard;\n\t}\n\n\tprivate _lineAnnotationController: LineAnnotationController;\n\tget lineAnnotations() {\n\t\treturn this._lineAnnotationController;\n\t}\n\n\tprivate _lineHistoryView: LineHistoryView | undefined;\n\tget lineHistoryView() {\n\t\tif (this._lineHistoryView == null) {\n\t\t\tthis._context.subscriptions.push((this._lineHistoryView = new LineHistoryView(this)));\n\t\t}\n\n\t\treturn this._lineHistoryView;\n\t}\n\n\tprivate _lineHoverController: LineHoverController;\n\tget lineHovers() {\n\t\treturn this._lineHoverController;\n\t}\n\n\tprivate _lineTracker: GitLineTracker;\n\tget lineTracker() {\n\t\treturn this._lineTracker;\n\t}\n\n\tprivate _rebaseEditor: RebaseEditorProvider | undefined;\n\tget rebaseEditor() {\n\t\tif (this._rebaseEditor == null) {\n\t\t\tthis._context.subscriptions.push((this._rebaseEditor = new RebaseEditorProvider(this)));\n\t\t}\n\n\t\treturn this._rebaseEditor;\n\t}\n\n\tprivate _remotesView: RemotesView | undefined;\n\tget remotesView() {\n\t\tif (this._remotesView == null) {\n\t\t\tthis._context.subscriptions.push((this._remotesView = new RemotesView(this)));\n\t\t}\n\n\t\treturn this._remotesView;\n\t}\n\n\tprivate _repositoriesView: RepositoriesView | undefined;\n\tget repositoriesView(): RepositoriesView {\n\t\tif (this._repositoriesView == null) {\n\t\t\tthis._context.subscriptions.push((this._repositoriesView = new RepositoriesView(this)));\n\t\t}\n\n\t\treturn this._repositoriesView;\n\t}\n\n\tprivate _searchAndCompareView: SearchAndCompareView | undefined;\n\tget searchAndCompareView() {\n\t\tif (this._searchAndCompareView == null) {\n\t\t\tthis._context.subscriptions.push((this._searchAndCompareView = new SearchAndCompareView(this)));\n\t\t}\n\n\t\treturn this._searchAndCompareView;\n\t}\n\n\tprivate _subscription: SubscriptionService | undefined;\n\tget subscription() {\n\t\tif (this._subscription == null) {\n\t\t\tthis._subscription = new SubscriptionService(this);\n\t\t}\n\n\t\treturn this._subscription;\n\t}\n\n\tprivate _settingsWebview: SettingsWebview;\n\tget settingsWebview() {\n\t\treturn this._settingsWebview;\n\t}\n\n\tprivate _stashesView: StashesView | undefined;\n\tget stashesView() {\n\t\tif (this._stashesView == null) {\n\t\t\tthis._context.subscriptions.push((this._stashesView = new StashesView(this)));\n\t\t}\n\n\t\treturn this._stashesView;\n\t}\n\n\tprivate _statusBarController: StatusBarController;\n\tget statusBar() {\n\t\treturn this._statusBarController;\n\t}\n\n\tprivate readonly _storage: Storage;\n\tget storage(): Storage {\n\t\treturn this._storage;\n\t}\n\n\tprivate _tagsView: TagsView | undefined;\n\tget tagsView() {\n\t\tif (this._tagsView == null) {\n\t\t\tthis._context.subscriptions.push((this._tagsView = new TagsView(this)));\n\t\t}\n\n\t\treturn this._tagsView;\n\t}\n\n\tprivate _timelineView: TimelineWebviewView;\n\tget timelineView() {\n\t\treturn this._timelineView;\n\t}\n\n\tprivate _timelineWebview: TimelineWebview;\n\tget timelineWebview() {\n\t\treturn this._timelineWebview;\n\t}\n\n\tprivate _tracker: GitDocumentTracker;\n\tget tracker() {\n\t\treturn this._tracker;\n\t}\n\n\t@memoize()\n\tget version(): string {\n\t\treturn this.context.extension.packageJSON.version;\n\t}\n\n\tprivate _viewCommands: ViewCommands | undefined;\n\tget viewCommands() {\n\t\tif (this._viewCommands == null) {\n\t\t\tthis._viewCommands = new ViewCommands(this);\n\t\t}\n\t\treturn this._viewCommands;\n\t}\n\n\tprivate _vsls: VslsController;\n\tget vsls() {\n\t\treturn this._vsls;\n\t}\n\n\tprivate _welcomeWebview: WelcomeWebview;\n\tget welcomeWebview() {\n\t\treturn this._welcomeWebview;\n\t}\n\n\tprivate _worktreesView: WorktreesView | undefined;\n\tget worktreesView() {\n\t\tif (this._worktreesView == null) {\n\t\t\tthis._context.subscriptions.push((this._worktreesView = new WorktreesView(this)));\n\t\t}\n\n\t\treturn this._worktreesView;\n\t}\n\n\tprivate applyMode(config: Config) {\n\t\tif (!config.mode.active) return config;\n\n\t\tconst mode = config.modes?.[config.mode.active];\n\t\tif (mode == null) return config;\n\n\t\tif (mode.annotations != null) {\n\t\t\tlet command: Commands | undefined;\n\t\t\tswitch (mode.annotations) {\n\t\t\t\tcase 'blame':\n\t\t\t\t\tconfig.blame.toggleMode = AnnotationsToggleMode.Window;\n\t\t\t\t\tcommand = Commands.ToggleFileBlame;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'changes':\n\t\t\t\t\tconfig.changes.toggleMode = AnnotationsToggleMode.Window;\n\t\t\t\t\tcommand = Commands.ToggleFileChanges;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'heatmap':\n\t\t\t\t\tconfig.heatmap.toggleMode = AnnotationsToggleMode.Window;\n\t\t\t\t\tcommand = Commands.ToggleFileHeatmap;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (command != null) {\n\t\t\t\tconst commandArgs: ToggleFileAnnotationCommandArgs = {\n\t\t\t\t\ttype: mode.annotations as FileAnnotationType,\n\t\t\t\t\ton: true,\n\t\t\t\t};\n\t\t\t\t// Make sure to delay the execution by a bit so that the configuration changes get propegated first\n\t\t\t\tsetTimeout(() => executeCommand(command!, commandArgs), 50);\n\t\t\t}\n\t\t}\n\n\t\tif (mode.codeLens != null) {\n\t\t\tconfig.codeLens.enabled = mode.codeLens;\n\t\t}\n\n\t\tif (mode.currentLine != null) {\n\t\t\tconfig.currentLine.enabled = mode.currentLine;\n\t\t}\n\n\t\tif (mode.hovers != null) {\n\t\t\tconfig.hovers.enabled = mode.hovers;\n\t\t}\n\n\t\tif (mode.statusBar != null) {\n\t\t\tconfig.statusBar.enabled = mode.statusBar;\n\t\t}\n\n\t\treturn config;\n\t}\n\n\tprivate applyModeConfigurationTransform(e: ConfigurationChangeEvent): ConfigurationChangeEvent {\n\t\tif (this._configsAffectedByMode == null) {\n\t\t\tthis._configsAffectedByMode = [\n\t\t\t\t`gitlens.${configuration.name('mode')}`,\n\t\t\t\t`gitlens.${configuration.name('modes')}`,\n\t\t\t\t`gitlens.${configuration.name('blame.toggleMode')}`,\n\t\t\t\t`gitlens.${configuration.name('changes.toggleMode')}`,\n\t\t\t\t`gitlens.${configuration.name('codeLens')}`,\n\t\t\t\t`gitlens.${configuration.name('currentLine')}`,\n\t\t\t\t`gitlens.${configuration.name('heatmap.toggleMode')}`,\n\t\t\t\t`gitlens.${configuration.name('hovers')}`,\n\t\t\t\t`gitlens.${configuration.name('statusBar')}`,\n\t\t\t];\n\t\t}\n\n\t\tconst original = e.affectsConfiguration;\n\t\treturn {\n\t\t\t...e,\n\t\t\taffectsConfiguration: (section: string, scope?: ConfigurationScope) =>\n\t\t\t\tthis._configsAffectedByMode?.some(n => section.startsWith(n)) ? true : original(section, scope),\n\t\t};\n\t}\n}\n","import { commands } from 'vscode';\nimport { ContextKeys, CoreCommands } from './constants';\n\nconst contextStorage = new Map<string, unknown>();\n\nexport function getContext<T>(key: ContextKeys): T | undefined;\nexport function getContext<T>(key: ContextKeys, defaultValue: T): T;\nexport function getContext<T>(key: ContextKeys, defaultValue?: T): T | undefined {\n\treturn (contextStorage.get(key) as T | undefined) ?? defaultValue;\n}\n\nexport async function setContext(\n\tkey: ContextKeys | `${ContextKeys.ActionPrefix}${string}` | `${ContextKeys.KeyPrefix}${string}`,\n\tvalue: unknown,\n): Promise<void> {\n\tcontextStorage.set(key, value);\n\tvoid (await commands.executeCommand(CoreCommands.SetContext, key, value));\n}\n","import emojis from './emojis.json';\n\nconst emojiRegex = /:([-+_a-z0-9]+):/g;\n\nexport function emojify(message: string) {\n\treturn message.replace(emojiRegex, (s, code) => (emojis as Record<string, string>)[code] || s);\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"crypto\");","import { createHash, randomBytes } from 'crypto';\n\nexport function getNonce(): string {\n\treturn randomBytes(16).toString('base64');\n}\n\nexport function md5(data: string | Uint8Array, encoding: 'base64' | 'hex' = 'base64'): string {\n\treturn createHash('md5').update(data).digest(encoding);\n}\n","export function encodeUtf8Hex(s: string): string {\n\treturn Buffer.from(s, 'utf8').toString('hex');\n}\n\nexport function decodeUtf8Hex(hex: string): string {\n\treturn Buffer.from(hex, 'hex').toString('utf8');\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"process\");","import { env, UIKind } from 'vscode';\n\nexport const isWeb = env.uiKind === UIKind.Web;\n\nexport const isLinux = process.platform === 'linux';\nexport const isMac = process.platform === 'darwin';\nexport const isWindows = process.platform === 'win32';\n\nexport function getPlatform(): string {\n\tif (isWindows) {\n\t\treturn 'windows';\n\t}\n\tif (isMac) {\n\t\treturn 'macOS';\n\t}\n\tif (isLinux) {\n\t\treturn 'linux';\n\t}\n\treturn isWeb ? 'web' : 'unknown';\n}\n","import { Uri } from 'vscode';\nimport { isSubscriptionPaidPlan, RequiredSubscriptionPlans, Subscription } from './subscription';\n\nexport class AccessDeniedError extends Error {\n\tpublic readonly subscription: Subscription;\n\tpublic readonly required: RequiredSubscriptionPlans | undefined;\n\n\tconstructor(subscription: Subscription, required: RequiredSubscriptionPlans | undefined) {\n\t\tlet message;\n\t\tif (subscription.account?.verified === false) {\n\t\t\tmessage = 'Email verification required';\n\t\t} else if (required != null && isSubscriptionPaidPlan(required)) {\n\t\t\tmessage = 'Paid subscription required';\n\t\t} else {\n\t\t\tmessage = 'Subscription required';\n\t\t}\n\n\t\tsuper(message);\n\n\t\tthis.subscription = subscription;\n\t\tthis.required = required;\n\t\tError.captureStackTrace?.(this, AccessDeniedError);\n\t}\n}\n\nexport class AccountValidationError extends Error {\n\treadonly original?: Error;\n\treadonly statusCode?: number;\n\treadonly statusText?: string;\n\n\tconstructor(message: string, original?: Error, statusCode?: number, statusText?: string) {\n\t\tmessage += `; status=${statusCode}: ${statusText}`;\n\t\tsuper(message);\n\n\t\tthis.original = original;\n\t\tthis.statusCode = statusCode;\n\t\tthis.statusText = statusText;\n\t\tError.captureStackTrace?.(this, AccountValidationError);\n\t}\n}\n\nexport const enum AuthenticationErrorReason {\n\tUserDidNotConsent = 1,\n\tUnauthorized = 2,\n\tForbidden = 3,\n}\n\nexport class AuthenticationError extends Error {\n\treadonly id: string;\n\treadonly original?: Error;\n\treadonly reason: AuthenticationErrorReason | undefined;\n\n\tconstructor(id: string, reason?: AuthenticationErrorReason, original?: Error);\n\tconstructor(id: string, message?: string, original?: Error);\n\tconstructor(id: string, messageOrReason: string | AuthenticationErrorReason | undefined, original?: Error) {\n\t\tlet message;\n\t\tlet reason: AuthenticationErrorReason | undefined;\n\t\tif (messageOrReason == null) {\n\t\t\tmessage = `Unable to get required authentication session for '${id}'`;\n\t\t} else if (typeof messageOrReason === 'string') {\n\t\t\tmessage = messageOrReason;\n\t\t\treason = undefined;\n\t\t} else {\n\t\t\treason = messageOrReason;\n\t\t\tswitch (reason) {\n\t\t\t\tcase AuthenticationErrorReason.UserDidNotConsent:\n\t\t\t\t\tmessage = `'${id}' authentication is required for this operation`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase AuthenticationErrorReason.Unauthorized:\n\t\t\t\t\tmessage = `Your '${id}' credentials are either invalid or expired`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase AuthenticationErrorReason.Forbidden:\n\t\t\t\t\tmessage = `Your '${id}' credentials do not have the required access`;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tsuper(message);\n\n\t\tthis.id = id;\n\t\tthis.original = original;\n\t\tthis.reason = reason;\n\t\tError.captureStackTrace?.(this, AuthenticationError);\n\t}\n}\n\nexport class ExtensionNotFoundError extends Error {\n\tconstructor(public readonly extensionId: string, public readonly extensionName: string) {\n\t\tsuper(\n\t\t\t`Unable to find the ${extensionName} extension (${extensionId}). Please ensure it is installed and enabled.`,\n\t\t);\n\n\t\tError.captureStackTrace?.(this, ExtensionNotFoundError);\n\t}\n}\n\nexport const enum OpenVirtualRepositoryErrorReason {\n\tRemoteHubApiNotFound = 1,\n\tNotAGitHubRepository = 2,\n\tGitHubAuthenticationNotFound = 3,\n\tGitHubAuthenticationDenied = 4,\n}\n\nexport class OpenVirtualRepositoryError extends Error {\n\treadonly original?: Error;\n\treadonly reason: OpenVirtualRepositoryErrorReason | undefined;\n\treadonly repoPath: string;\n\n\tconstructor(repoPath: string, reason?: OpenVirtualRepositoryErrorReason, original?: Error);\n\tconstructor(repoPath: string, message?: string, original?: Error);\n\tconstructor(\n\t\trepoPath: string,\n\t\tmessageOrReason: string | OpenVirtualRepositoryErrorReason | undefined,\n\t\toriginal?: Error,\n\t) {\n\t\tlet message;\n\t\tlet reason: OpenVirtualRepositoryErrorReason | undefined;\n\t\tif (messageOrReason == null) {\n\t\t\tmessage = `Unable to open the virtual repository: ${repoPath}`;\n\t\t} else if (typeof messageOrReason === 'string') {\n\t\t\tmessage = messageOrReason;\n\t\t\treason = undefined;\n\t\t} else {\n\t\t\treason = messageOrReason;\n\t\t\tmessage = `Unable to open the virtual repository: ${repoPath}; `;\n\t\t\tswitch (reason) {\n\t\t\t\tcase OpenVirtualRepositoryErrorReason.RemoteHubApiNotFound:\n\t\t\t\t\tmessage +=\n\t\t\t\t\t\t'Unable to get required api from the GitHub Repositories extension. Please ensure that the GitHub Repositories extension is installed and enabled';\n\t\t\t\t\tbreak;\n\t\t\t\tcase OpenVirtualRepositoryErrorReason.NotAGitHubRepository:\n\t\t\t\t\tmessage += 'Only GitHub repositories are supported currently';\n\t\t\t\t\tbreak;\n\t\t\t\tcase OpenVirtualRepositoryErrorReason.GitHubAuthenticationNotFound:\n\t\t\t\t\tmessage += 'Unable to get required GitHub authentication';\n\t\t\t\t\tbreak;\n\t\t\t\tcase OpenVirtualRepositoryErrorReason.GitHubAuthenticationDenied:\n\t\t\t\t\tmessage += 'GitHub authentication is required';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tsuper(message);\n\n\t\tthis.original = original;\n\t\tthis.reason = reason;\n\t\tthis.repoPath = repoPath;\n\t\tError.captureStackTrace?.(this, OpenVirtualRepositoryError);\n\t}\n}\n\nexport class ProviderNotFoundError extends Error {\n\tconstructor(pathOrUri: string | Uri | undefined) {\n\t\tsuper(\n\t\t\t`No provider registered for '${\n\t\t\t\tpathOrUri == null\n\t\t\t\t\t? String(pathOrUri)\n\t\t\t\t\t: typeof pathOrUri === 'string'\n\t\t\t\t\t? pathOrUri\n\t\t\t\t\t: pathOrUri.toString(true)\n\t\t\t}'`,\n\t\t);\n\n\t\tError.captureStackTrace?.(this, ProviderNotFoundError);\n\t}\n}\n\nexport class ProviderRequestClientError extends Error {\n\tconstructor(public readonly original: Error) {\n\t\tsuper(original.message);\n\n\t\tError.captureStackTrace?.(this, ProviderRequestClientError);\n\t}\n}\n\nexport class ProviderRequestNotFoundError extends Error {\n\tconstructor(public readonly original: Error) {\n\t\tsuper(original.message);\n\n\t\tError.captureStackTrace?.(this, ProviderRequestNotFoundError);\n\t}\n}\n","import type { RequiredSubscriptionPlans, Subscription } from './subscription';\n\nexport const enum Features {\n\tStashes = 'stashes',\n\tTimeline = 'timeline',\n\tWorktrees = 'worktrees',\n}\n\nexport type FeatureAccess =\n\t| { allowed: true; subscription: { current: Subscription; required?: undefined } }\n\t| { allowed: false; subscription: { current: Subscription; required?: RequiredSubscriptionPlans } };\n\nexport const enum PremiumFeatures {\n\tTimeline = 'timeline',\n\tWorktrees = 'worktrees',\n}\n","export const enum StashApplyErrorReason {\n\tWorkingChanges = 1,\n}\n\nexport class StashApplyError extends Error {\n\tstatic is(ex: any, reason?: StashApplyErrorReason): ex is StashApplyError {\n\t\treturn ex instanceof StashApplyError && (reason == null || ex.reason === reason);\n\t}\n\n\treadonly original?: Error;\n\treadonly reason: StashApplyErrorReason | undefined;\n\n\tconstructor(reason?: StashApplyErrorReason, original?: Error);\n\tconstructor(message?: string, original?: Error);\n\tconstructor(messageOrReason: string | StashApplyErrorReason | undefined, original?: Error) {\n\t\tlet message;\n\t\tlet reason: StashApplyErrorReason | undefined;\n\t\tif (messageOrReason == null) {\n\t\t\tmessage = 'Unable to apply stash';\n\t\t} else if (typeof messageOrReason === 'string') {\n\t\t\tmessage = messageOrReason;\n\t\t\treason = undefined;\n\t\t} else {\n\t\t\treason = messageOrReason;\n\t\t\tmessage =\n\t\t\t\t'Unable to apply stash. Your working tree changes would be overwritten. Please commit or stash your changes before trying again';\n\t\t}\n\t\tsuper(message);\n\n\t\tthis.original = original;\n\t\tthis.reason = reason;\n\t\tError.captureStackTrace?.(this, StashApplyError);\n\t}\n}\n\nexport const enum WorktreeCreateErrorReason {\n\tAlreadyCheckedOut = 1,\n\tAlreadyExists = 2,\n}\n\nexport class WorktreeCreateError extends Error {\n\tstatic is(ex: any, reason?: WorktreeCreateErrorReason): ex is WorktreeCreateError {\n\t\treturn ex instanceof WorktreeCreateError && (reason == null || ex.reason === reason);\n\t}\n\n\treadonly original?: Error;\n\treadonly reason: WorktreeCreateErrorReason | undefined;\n\n\tconstructor(reason?: WorktreeCreateErrorReason, original?: Error);\n\tconstructor(message?: string, original?: Error);\n\tconstructor(messageOrReason: string | WorktreeCreateErrorReason | undefined, original?: Error) {\n\t\tlet message;\n\t\tlet reason: WorktreeCreateErrorReason | undefined;\n\t\tif (messageOrReason == null) {\n\t\t\tmessage = 'Unable to create worktree';\n\t\t} else if (typeof messageOrReason === 'string') {\n\t\t\tmessage = messageOrReason;\n\t\t\treason = undefined;\n\t\t} else {\n\t\t\treason = messageOrReason;\n\t\t\tswitch (reason) {\n\t\t\t\tcase WorktreeCreateErrorReason.AlreadyCheckedOut:\n\t\t\t\t\tmessage = 'Unable to create worktree because it is already checked out';\n\t\t\t\t\tbreak;\n\t\t\t\tcase WorktreeCreateErrorReason.AlreadyExists:\n\t\t\t\t\tmessage = 'Unable to create worktree because it already exists';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tsuper(message);\n\n\t\tthis.original = original;\n\t\tthis.reason = reason;\n\t\tError.captureStackTrace?.(this, WorktreeCreateError);\n\t}\n}\n\nexport const enum WorktreeDeleteErrorReason {\n\tHasChanges = 1,\n\tMainWorkingTree = 2,\n}\n\nexport class WorktreeDeleteError extends Error {\n\tstatic is(ex: any, reason?: WorktreeDeleteErrorReason): ex is WorktreeDeleteError {\n\t\treturn ex instanceof WorktreeDeleteError && (reason == null || ex.reason === reason);\n\t}\n\n\treadonly original?: Error;\n\treadonly reason: WorktreeDeleteErrorReason | undefined;\n\n\tconstructor(reason?: WorktreeDeleteErrorReason, original?: Error);\n\tconstructor(message?: string, original?: Error);\n\tconstructor(messageOrReason: string | WorktreeDeleteErrorReason | undefined, original?: Error) {\n\t\tlet message;\n\t\tlet reason: WorktreeDeleteErrorReason | undefined;\n\t\tif (messageOrReason == null) {\n\t\t\tmessage = 'Unable to delete worktree';\n\t\t} else if (typeof messageOrReason === 'string') {\n\t\t\tmessage = messageOrReason;\n\t\t\treason = undefined;\n\t\t} else {\n\t\t\treason = messageOrReason;\n\t\t\tswitch (reason) {\n\t\t\t\tcase WorktreeDeleteErrorReason.HasChanges:\n\t\t\t\t\tmessage = 'Unable to delete worktree because there are uncommitted changes';\n\t\t\t\t\tbreak;\n\t\t\t\tcase WorktreeDeleteErrorReason.MainWorkingTree:\n\t\t\t\t\tmessage = 'Unable to delete worktree because it is a main working tree';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tsuper(message);\n\n\t\tthis.original = original;\n\t\tthis.reason = reason;\n\t\tError.captureStackTrace?.(this, WorktreeDeleteError);\n\t}\n}\n","import { Uri } from 'vscode';\nimport type {\n\tAction,\n\tActionContext,\n\tHoverCommandsActionContext,\n\tOpenPullRequestActionContext,\n} from '../../api/gitlens';\nimport { getPresenceDataUri } from '../../avatars';\nimport {\n\tConnectRemoteProviderCommand,\n\tDiffWithCommand,\n\tOpenCommitOnRemoteCommand,\n\tOpenFileAtRevisionCommand,\n\tShowQuickCommitCommand,\n\tShowQuickCommitFileCommand,\n} from '../../commands';\nimport { Command } from '../../commands/base';\nimport { DateStyle, FileAnnotationType } from '../../configuration';\nimport { Commands, GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { emojify } from '../../emojis';\nimport { join, map } from '../../system/iterable';\nimport { PromiseCancelledError } from '../../system/promise';\nimport { escapeMarkdown, getSuperscript, TokenOptions } from '../../system/string';\nimport { ContactPresence } from '../../vsls/vsls';\nimport { PreviousLineComparisionUrisResult } from '../gitProvider';\nimport { GitCommit, GitRemote, GitRevision, IssueOrPullRequest, PullRequest } from '../models';\nimport { RemoteProvider } from '../remotes/provider';\nimport { FormatOptions, Formatter } from './formatter';\n\nexport interface CommitFormatOptions extends FormatOptions {\n\tautolinkedIssuesOrPullRequests?: Map<string, IssueOrPullRequest | PromiseCancelledError | undefined>;\n\tavatarSize?: number;\n\tdateStyle?: DateStyle;\n\teditor?: { line: number; uri: Uri };\n\tfootnotes?: Map<number, string>;\n\tgetBranchAndTagTips?: (sha: string, options?: { compact?: boolean; icons?: boolean }) => string | undefined;\n\tmarkdown?: boolean;\n\tmessageAutolinks?: boolean;\n\tmessageIndent?: number;\n\tmessageTruncateAtNewLine?: boolean;\n\tpullRequestOrRemote?: PullRequest | PromiseCancelledError | GitRemote;\n\tpullRequestPendingMessage?: string;\n\tpresence?: ContactPresence;\n\tpreviousLineComparisonUris?: PreviousLineComparisionUrisResult;\n\tremotes?: GitRemote<RemoteProvider>[];\n\tunpublished?: boolean;\n\n\ttokenOptions?: {\n\t\tago?: TokenOptions;\n\t\tagoOrDate?: TokenOptions;\n\t\tagoOrDateShort?: TokenOptions;\n\t\tauthor?: TokenOptions;\n\t\tauthorAgo?: TokenOptions;\n\t\tauthorAgoOrDate?: TokenOptions;\n\t\tauthorAgoOrDateShort?: TokenOptions;\n\t\tauthorDate?: TokenOptions;\n\t\tauthorNotYou?: TokenOptions;\n\t\tavatar?: TokenOptions;\n\t\tchanges?: TokenOptions;\n\t\tchangesDetail?: TokenOptions;\n\t\tchangesShort?: TokenOptions;\n\t\tcommands?: TokenOptions;\n\t\tcommitterAgo?: TokenOptions;\n\t\tcommitterAgoOrDate?: TokenOptions;\n\t\tcommitterAgoOrDateShort?: TokenOptions;\n\t\tcommitterDate?: TokenOptions;\n\t\tdate?: TokenOptions;\n\t\temail?: TokenOptions;\n\t\tfootnotes?: TokenOptions;\n\t\tid?: TokenOptions;\n\t\tlink?: TokenOptions;\n\t\tmessage?: TokenOptions;\n\t\tpullRequest?: TokenOptions;\n\t\tpullRequestAgo?: TokenOptions;\n\t\tpullRequestAgoOrDate?: TokenOptions;\n\t\tpullRequestDate?: TokenOptions;\n\t\tpullRequestState?: TokenOptions;\n\t\tsha?: TokenOptions;\n\t\ttips?: TokenOptions;\n\t};\n}\n\nexport class CommitFormatter extends Formatter<GitCommit, CommitFormatOptions> {\n\tprivate get _authorDate() {\n\t\treturn this._item.author.formatDate(this._options.dateFormat);\n\t}\n\n\tprivate get _authorDateAgo() {\n\t\treturn this._item.author.fromNow();\n\t}\n\n\tprivate get _authorDateAgoShort() {\n\t\treturn this._item.author.fromNow(true);\n\t}\n\n\tprivate get _committerDate() {\n\t\treturn this._item.committer.formatDate(this._options.dateFormat);\n\t}\n\n\tprivate get _committerDateAgo() {\n\t\treturn this._item.committer.fromNow();\n\t}\n\n\tprivate get _committerDateAgoShort() {\n\t\treturn this._item.committer.fromNow(true);\n\t}\n\n\tprivate get _date() {\n\t\treturn this._item.formatDate(this._options.dateFormat);\n\t}\n\n\tprivate get _dateAgo() {\n\t\treturn this._item.formatDateFromNow();\n\t}\n\n\tprivate get _dateAgoShort() {\n\t\treturn this._item.formatDateFromNow(true);\n\t}\n\n\tprivate get _pullRequestDate() {\n\t\tconst { pullRequestOrRemote: pr } = this._options;\n\t\tif (pr == null || !PullRequest.is(pr)) return '';\n\n\t\treturn pr.formatDate(this._options.dateFormat) ?? '';\n\t}\n\n\tprivate get _pullRequestDateAgo() {\n\t\tconst { pullRequestOrRemote: pr } = this._options;\n\t\tif (pr == null || !PullRequest.is(pr)) return '';\n\n\t\treturn pr.formatDateFromNow() ?? '';\n\t}\n\n\tprivate get _pullRequestDateOrAgo() {\n\t\tconst dateStyle =\n\t\t\tthis._options.dateStyle != null ? this._options.dateStyle : Container.instance.config.defaultDateStyle;\n\t\treturn dateStyle === DateStyle.Absolute ? this._pullRequestDate : this._pullRequestDateAgo;\n\t}\n\n\tget ago(): string {\n\t\treturn this._padOrTruncate(this._dateAgo, this._options.tokenOptions.ago);\n\t}\n\n\tget agoOrDate(): string {\n\t\tconst dateStyle =\n\t\t\tthis._options.dateStyle != null ? this._options.dateStyle : Container.instance.config.defaultDateStyle;\n\t\treturn this._padOrTruncate(\n\t\t\tdateStyle === DateStyle.Absolute ? this._date : this._dateAgo,\n\t\t\tthis._options.tokenOptions.agoOrDate,\n\t\t);\n\t}\n\n\tget agoOrDateShort(): string {\n\t\tconst dateStyle =\n\t\t\tthis._options.dateStyle != null ? this._options.dateStyle : Container.instance.config.defaultDateStyle;\n\t\treturn this._padOrTruncate(\n\t\t\tdateStyle === DateStyle.Absolute ? this._date : this._dateAgoShort,\n\t\t\tthis._options.tokenOptions.agoOrDateShort,\n\t\t);\n\t}\n\n\tget author(): string {\n\t\tconst { name, email } = this._item.author;\n\t\tconst author = this._padOrTruncate(name, this._options.tokenOptions.author);\n\t\tif (!this._options.markdown) return author;\n\n\t\treturn `[${author}](mailto:${email} \"Email ${name} (${email})\")`;\n\t}\n\n\tget authorAgo(): string {\n\t\treturn this._padOrTruncate(this._authorDateAgo, this._options.tokenOptions.authorAgo);\n\t}\n\n\tget authorAgoOrDate(): string {\n\t\tconst dateStyle =\n\t\t\tthis._options.dateStyle != null ? this._options.dateStyle : Container.instance.config.defaultDateStyle;\n\t\treturn this._padOrTruncate(\n\t\t\tdateStyle === DateStyle.Absolute ? this._authorDate : this._authorDateAgo,\n\t\t\tthis._options.tokenOptions.authorAgoOrDate,\n\t\t);\n\t}\n\n\tget authorAgoOrDateShort(): string {\n\t\tconst dateStyle =\n\t\t\tthis._options.dateStyle != null ? this._options.dateStyle : Container.instance.config.defaultDateStyle;\n\t\treturn this._padOrTruncate(\n\t\t\tdateStyle === DateStyle.Absolute ? this._authorDate : this._authorDateAgoShort,\n\t\t\tthis._options.tokenOptions.authorAgoOrDateShort,\n\t\t);\n\t}\n\n\tget authorDate(): string {\n\t\treturn this._padOrTruncate(this._authorDate, this._options.tokenOptions.authorDate);\n\t}\n\n\tget authorNotYou(): string {\n\t\tconst { name, email } = this._item.author;\n\t\tif (name === 'You') return this._padOrTruncate('', this._options.tokenOptions.authorNotYou);\n\n\t\tconst author = this._padOrTruncate(name, this._options.tokenOptions.authorNotYou);\n\t\tif (!this._options.markdown) return author;\n\n\t\treturn `[${author}](mailto:${email} \"Email ${name} (${email})\")`;\n\t}\n\n\tget avatar(): string | Promise<string> {\n\t\tif (!this._options.markdown || !Container.instance.config.hovers.avatars) {\n\t\t\treturn this._padOrTruncate('', this._options.tokenOptions.avatar);\n\t\t}\n\n\t\tconst { name } = this._item.author;\n\n\t\tconst presence = this._options.presence;\n\t\tif (presence != null) {\n\t\t\tconst title = `${name} ${name === 'You' ? 'are' : 'is'} ${\n\t\t\t\tpresence.status === 'dnd' ? 'in ' : ''\n\t\t\t}${presence.statusText.toLocaleLowerCase()}`;\n\n\t\t\tconst avatarMarkdownPromise = this._getAvatarMarkdown(title, this._options.avatarSize);\n\t\t\treturn avatarMarkdownPromise.then(md =>\n\t\t\t\tthis._padOrTruncate(\n\t\t\t\t\t`${md}${this._getPresenceMarkdown(presence, title)}`,\n\t\t\t\t\tthis._options.tokenOptions.avatar,\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\treturn this._getAvatarMarkdown(name, this._options.avatarSize);\n\t}\n\n\tprivate async _getAvatarMarkdown(title: string, size?: number) {\n\t\tsize = size ?? Container.instance.config.hovers.avatarSize;\n\t\tconst avatarPromise = this._item.getAvatarUri({\n\t\t\tdefaultStyle: Container.instance.config.defaultGravatarsStyle,\n\t\t\tsize: size,\n\t\t});\n\t\treturn this._padOrTruncate(\n\t\t\t`![${title}](${(await avatarPromise).toString(true)}|width=${size},height=${size} \"${title}\")`,\n\t\t\tthis._options.tokenOptions.avatar,\n\t\t);\n\t}\n\n\tprivate _getPresenceMarkdown(presence: ContactPresence, title: string) {\n\t\treturn `![${title}](${getPresenceDataUri(presence.status)} \"${title}\")`;\n\t}\n\n\tget changes(): string {\n\t\treturn this._padOrTruncate(\n\t\t\tGitCommit.is(this._item) ? this._item.formatStats() : '',\n\t\t\tthis._options.tokenOptions.changes,\n\t\t);\n\t}\n\n\tget changesDetail(): string {\n\t\treturn this._padOrTruncate(\n\t\t\tGitCommit.is(this._item) ? this._item.formatStats({ expand: true, separator: ', ' }) : '',\n\t\t\tthis._options.tokenOptions.changesDetail,\n\t\t);\n\t}\n\n\tget changesShort(): string {\n\t\treturn this._padOrTruncate(\n\t\t\tGitCommit.is(this._item) ? this._item.formatStats({ compact: true, separator: '' }) : '',\n\t\t\tthis._options.tokenOptions.changesShort,\n\t\t);\n\t}\n\n\tget commands(): string {\n\t\tif (!this._options.markdown) return this._padOrTruncate('', this._options.tokenOptions.commands);\n\n\t\tlet commands;\n\t\tif (this._item.isUncommitted) {\n\t\t\tconst { previousLineComparisonUris: diffUris } = this._options;\n\t\t\tif (diffUris?.previous != null) {\n\t\t\t\tcommands = `\\`${this._padOrTruncate(\n\t\t\t\t\tGitRevision.shorten(\n\t\t\t\t\t\tGitRevision.isUncommittedStaged(diffUris.current.sha)\n\t\t\t\t\t\t\t? diffUris.current.sha\n\t\t\t\t\t\t\t: GitRevision.uncommitted,\n\t\t\t\t\t)!,\n\t\t\t\t\tthis._options.tokenOptions.commands,\n\t\t\t\t)}\\``;\n\n\t\t\t\tcommands += ` &nbsp;[$(chevron-left)$(compare-changes)](${DiffWithCommand.getMarkdownCommandArgs({\n\t\t\t\t\tlhs: {\n\t\t\t\t\t\tsha: diffUris.previous.sha ?? '',\n\t\t\t\t\t\turi: diffUris.previous.documentUri(),\n\t\t\t\t\t},\n\t\t\t\t\trhs: {\n\t\t\t\t\t\tsha: diffUris.current.sha ?? '',\n\t\t\t\t\t\turi: diffUris.current.documentUri(),\n\t\t\t\t\t},\n\t\t\t\t\trepoPath: this._item.repoPath,\n\t\t\t\t\tline: this._options.editor?.line,\n\t\t\t\t})} \"Open Changes with Previous Revision\")`;\n\n\t\t\t\tcommands += ` &nbsp;&nbsp;[$(versions)](${OpenFileAtRevisionCommand.getMarkdownCommandArgs(\n\t\t\t\t\tContainer.instance.git.getRevisionUri(diffUris.previous),\n\t\t\t\t\tFileAnnotationType.Blame,\n\t\t\t\t\tthis._options.editor?.line,\n\t\t\t\t)} \"Open Blame Prior to this Change\")`;\n\t\t\t} else {\n\t\t\t\tcommands = `\\`${this._padOrTruncate(\n\t\t\t\t\tGitRevision.shorten(\n\t\t\t\t\t\tthis._item.isUncommittedStaged ? GitRevision.uncommittedStaged : GitRevision.uncommitted,\n\t\t\t\t\t)!,\n\t\t\t\t\tthis._options.tokenOptions.commands,\n\t\t\t\t)}\\``;\n\t\t\t}\n\n\t\t\treturn commands;\n\t\t}\n\n\t\tconst separator = ' &nbsp;&nbsp;|&nbsp;&nbsp; ';\n\n\t\tcommands = `---\\n\\n[\\`$(git-commit) ${this.id}\\`](${ShowQuickCommitCommand.getMarkdownCommandArgs(\n\t\t\tthis._item.sha,\n\t\t)} \"Show Commit\")`;\n\n\t\tcommands += ` &nbsp;[$(chevron-left)$(compare-changes)](${DiffWithCommand.getMarkdownCommandArgs(\n\t\t\tthis._item,\n\t\t\tthis._options.editor?.line,\n\t\t)} \"Open Changes with Previous Revision\")`;\n\n\t\tif (this._item.file != null && this._item.unresolvedPreviousSha != null) {\n\t\t\tconst uri = Container.instance.git.getRevisionUri(\n\t\t\t\tthis._item.unresolvedPreviousSha,\n\t\t\t\tthis._item.file.originalPath ?? this._item.file?.path,\n\t\t\t\tthis._item.repoPath,\n\t\t\t);\n\t\t\tcommands += ` &nbsp;&nbsp;[$(versions)](${OpenFileAtRevisionCommand.getMarkdownCommandArgs(\n\t\t\t\turi,\n\t\t\t\tFileAnnotationType.Blame,\n\t\t\t\tthis._options.editor?.line,\n\t\t\t)} \"Open Blame Prior to this Change\")`;\n\t\t}\n\n\t\tif (this._options.remotes != null && this._options.remotes.length !== 0) {\n\t\t\tconst providers = GitRemote.getHighlanderProviders(this._options.remotes);\n\n\t\t\tcommands += ` &nbsp;&nbsp;[$(globe)](${OpenCommitOnRemoteCommand.getMarkdownCommandArgs(\n\t\t\t\tthis._item.sha,\n\t\t\t)} \"Open Commit on ${providers?.length ? providers[0].name : 'Remote'}\")`;\n\t\t}\n\n\t\tconst { pullRequestOrRemote: pr } = this._options;\n\t\tif (pr != null) {\n\t\t\tif (PullRequest.is(pr)) {\n\t\t\t\tcommands += `${separator}[$(git-pull-request) PR #${\n\t\t\t\t\tpr.id\n\t\t\t\t}](${getMarkdownActionCommand<OpenPullRequestActionContext>('openPullRequest', {\n\t\t\t\t\trepoPath: this._item.repoPath,\n\t\t\t\t\tprovider: { id: pr.provider.id, name: pr.provider.name, domain: pr.provider.domain },\n\t\t\t\t\tpullRequest: { id: pr.id, url: pr.url },\n\t\t\t\t})} \"Open Pull Request \\\\#${pr.id}${\n\t\t\t\t\tContainer.instance.actionRunners.count('openPullRequest') == 1 ? ` on ${pr.provider.name}` : '...'\n\t\t\t\t}\\n${GlyphChars.Dash.repeat(2)}\\n${escapeMarkdown(pr.title).replace(/\"/g, '\\\\\"')}\\n${\n\t\t\t\t\tpr.state\n\t\t\t\t}, ${pr.formatDateFromNow()}\")`;\n\t\t\t} else if (pr instanceof PromiseCancelledError) {\n\t\t\t\tcommands += `${separator}[$(git-pull-request) PR $(loading~spin)](command:${Commands.RefreshHover} \"Searching for a Pull Request (if any) that introduced this commit...\")`;\n\t\t\t} else if (pr.provider != null && Container.instance.config.integrations.enabled) {\n\t\t\t\tcommands += `${separator}[$(plug) Connect to ${pr.provider.name}${\n\t\t\t\t\tGlyphChars.Ellipsis\n\t\t\t\t}](${ConnectRemoteProviderCommand.getMarkdownCommandArgs(pr)} \"Connect to ${\n\t\t\t\t\tpr.provider.name\n\t\t\t\t} to enable the display of the Pull Request (if any) that introduced this commit\")`;\n\t\t\t}\n\t\t}\n\n\t\tif (Container.instance.actionRunners.count('hover.commands') > 0) {\n\t\t\tconst { name, email } = this._item.author;\n\n\t\t\tcommands += `${separator}[$(organization) Team${GlyphChars.SpaceThinnest}${\n\t\t\t\tGlyphChars.Ellipsis\n\t\t\t}](${getMarkdownActionCommand<HoverCommandsActionContext>('hover.commands', {\n\t\t\t\trepoPath: this._item.repoPath,\n\t\t\t\tcommit: {\n\t\t\t\t\tsha: this._item.sha,\n\t\t\t\t\tauthor: {\n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\temail: email,\n\t\t\t\t\t\tpresence: this._options.presence,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tfile:\n\t\t\t\t\tthis._options.editor != null\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\turi: this._options.editor?.uri.toString(),\n\t\t\t\t\t\t\t\tline: this._options.editor?.line,\n\t\t\t\t\t\t  }\n\t\t\t\t\t\t: undefined,\n\t\t\t})} \"Show Team Actions\")`;\n\t\t}\n\n\t\tconst gitUri = this._item.getGitUri();\n\t\tcommands += `${separator}[$(ellipsis)](${ShowQuickCommitFileCommand.getMarkdownCommandArgs(\n\t\t\tgitUri != null\n\t\t\t\t? {\n\t\t\t\t\t\trevisionUri: Container.instance.git.getRevisionUri(gitUri).toString(true),\n\t\t\t\t  }\n\t\t\t\t: { commit: this._item },\n\t\t)} \"Show More Actions\")`;\n\n\t\treturn this._padOrTruncate(commands, this._options.tokenOptions.commands);\n\t}\n\n\tget committerAgo(): string {\n\t\treturn this._padOrTruncate(this._committerDateAgo, this._options.tokenOptions.committerAgo);\n\t}\n\n\tget committerAgoOrDate(): string {\n\t\tconst dateStyle =\n\t\t\tthis._options.dateStyle != null ? this._options.dateStyle : Container.instance.config.defaultDateStyle;\n\t\treturn this._padOrTruncate(\n\t\t\tdateStyle === DateStyle.Absolute ? this._committerDate : this._committerDateAgo,\n\t\t\tthis._options.tokenOptions.committerAgoOrDate,\n\t\t);\n\t}\n\n\tget committerAgoOrDateShort(): string {\n\t\tconst dateStyle =\n\t\t\tthis._options.dateStyle != null ? this._options.dateStyle : Container.instance.config.defaultDateStyle;\n\t\treturn this._padOrTruncate(\n\t\t\tdateStyle === DateStyle.Absolute ? this._committerDate : this._committerDateAgoShort,\n\t\t\tthis._options.tokenOptions.committerAgoOrDateShort,\n\t\t);\n\t}\n\n\tget committerDate(): string {\n\t\treturn this._padOrTruncate(this._committerDate, this._options.tokenOptions.committerDate);\n\t}\n\n\tget date(): string {\n\t\treturn this._padOrTruncate(this._date, this._options.tokenOptions.date);\n\t}\n\n\tget email(): string {\n\t\tconst { email } = this._item.author;\n\t\treturn this._padOrTruncate(email ?? '', this._options.tokenOptions.email);\n\t}\n\n\tget footnotes(): string {\n\t\treturn this._padOrTruncate(\n\t\t\tthis._options.footnotes == null || this._options.footnotes.size === 0\n\t\t\t\t? ''\n\t\t\t\t: join(\n\t\t\t\t\t\tmap(this._options.footnotes, ([i, footnote]) =>\n\t\t\t\t\t\t\tthis._options.markdown ? footnote : `${getSuperscript(i)} ${footnote}`,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tthis._options.markdown ? '\\\\\\n' : '\\n',\n\t\t\t\t  ),\n\t\t\tthis._options.tokenOptions.footnotes,\n\t\t);\n\t}\n\n\tget id(): string {\n\t\tconst sha = this._padOrTruncate(this._item.shortSha ?? '', this._options.tokenOptions.id);\n\t\tif (this._options.markdown && this._options.unpublished) {\n\t\t\treturn `<span style=\"color:#35b15e;\">${sha} (unpublished)</span>`;\n\t\t}\n\n\t\treturn sha;\n\t}\n\n\tget link(): string {\n\t\tif (!this._options.markdown) return this.id;\n\n\t\tconst sha = this._padOrTruncate(this._item.shortSha ?? '', this._options.tokenOptions.id);\n\t\tconst link = `[\\`$(git-commit) ${sha}\\`](${ShowQuickCommitCommand.getMarkdownCommandArgs(\n\t\t\tthis._item.sha,\n\t\t)} \"Show Commit\")`;\n\n\t\treturn this._padOrTruncate(link, this._options.tokenOptions.link);\n\t}\n\n\tget message(): string {\n\t\tif (this._item.isUncommitted) {\n\t\t\tconst confliced = this._item.file?.hasConflicts ?? false;\n\t\t\tconst staged =\n\t\t\t\tthis._item.isUncommittedStaged ||\n\t\t\t\t(this._options.previousLineComparisonUris?.current?.isUncommittedStaged ?? false);\n\n\t\t\treturn this._padOrTruncate(\n\t\t\t\t`${this._options.markdown ? '\\n> ' : ''}${\n\t\t\t\t\tconfliced ? 'Merge' : staged ? 'Staged' : 'Uncommitted'\n\t\t\t\t} changes`,\n\t\t\t\tthis._options.tokenOptions.message,\n\t\t\t);\n\t\t}\n\n\t\tlet message = this._options.messageTruncateAtNewLine\n\t\t\t? this._item.summary\n\t\t\t: this._item.message ?? this._item.summary;\n\n\t\tmessage = emojify(message);\n\t\tmessage = this._padOrTruncate(message, this._options.tokenOptions.message);\n\n\t\tif (this._options.messageAutolinks) {\n\t\t\tmessage = Container.instance.autolinks.linkify(\n\t\t\t\tthis._options.markdown ? escapeMarkdown(message, { quoted: true }) : message,\n\t\t\t\tthis._options.markdown ?? false,\n\t\t\t\tthis._options.remotes,\n\t\t\t\tthis._options.autolinkedIssuesOrPullRequests,\n\t\t\t\tthis._options.footnotes,\n\t\t\t);\n\t\t}\n\n\t\tif (this._options.messageIndent != null && !this._options.markdown) {\n\t\t\tmessage = message.replace(/^/gm, GlyphChars.Space.repeat(this._options.messageIndent));\n\t\t}\n\n\t\treturn this._options.markdown ? `\\n> ${message}` : message;\n\t}\n\n\tget pullRequest(): string {\n\t\tconst { pullRequestOrRemote: pr } = this._options;\n\t\tif (pr == null) return this._padOrTruncate('', this._options.tokenOptions.pullRequest);\n\n\t\tlet text;\n\t\tif (PullRequest.is(pr)) {\n\t\t\tif (this._options.markdown) {\n\t\t\t\tconst prTitle = escapeMarkdown(pr.title).replace(/\"/g, '\\\\\"').trim();\n\n\t\t\t\ttext = `PR [**#${pr.id}**](${getMarkdownActionCommand<OpenPullRequestActionContext>('openPullRequest', {\n\t\t\t\t\trepoPath: this._item.repoPath,\n\t\t\t\t\tprovider: { id: pr.provider.id, name: pr.provider.name, domain: pr.provider.domain },\n\t\t\t\t\tpullRequest: { id: pr.id, url: pr.url },\n\t\t\t\t})} \"Open Pull Request \\\\#${pr.id}${\n\t\t\t\t\tContainer.instance.actionRunners.count('openPullRequest') == 1 ? ` on ${pr.provider.name}` : '...'\n\t\t\t\t}\\n${GlyphChars.Dash.repeat(2)}\\n${escapeMarkdown(pr.title).replace(/\"/g, '\\\\\"')}\\n${\n\t\t\t\t\tpr.state\n\t\t\t\t}, ${pr.formatDateFromNow()}\")`;\n\n\t\t\t\tif (this._options.footnotes != null) {\n\t\t\t\t\tconst index = this._options.footnotes.size + 1;\n\t\t\t\t\tthis._options.footnotes.set(\n\t\t\t\t\t\tindex,\n\t\t\t\t\t\t`${PullRequest.getMarkdownIcon(pr)} [**${prTitle}**](${pr.url} \"Open Pull Request \\\\#${\n\t\t\t\t\t\t\tpr.id\n\t\t\t\t\t\t} on ${pr.provider.name}\")\\\\\\n${GlyphChars.Space.repeat(4)} #${\n\t\t\t\t\t\t\tpr.id\n\t\t\t\t\t\t} ${pr.state.toLocaleLowerCase()} ${pr.formatDateFromNow()}`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else if (this._options.footnotes != null) {\n\t\t\t\tconst index = this._options.footnotes.size + 1;\n\t\t\t\tthis._options.footnotes.set(\n\t\t\t\t\tindex,\n\t\t\t\t\t`PR #${pr.id}: ${pr.title}  ${GlyphChars.Dot}  ${pr.state}, ${pr.formatDateFromNow()}`,\n\t\t\t\t);\n\n\t\t\t\ttext = `PR #${pr.id}${getSuperscript(index)}`;\n\t\t\t} else {\n\t\t\t\ttext = `PR #${pr.id}`;\n\t\t\t}\n\t\t} else if (pr instanceof PromiseCancelledError) {\n\t\t\ttext = this._options.markdown\n\t\t\t\t? `[PR $(loading~spin)](command:${Commands.RefreshHover} \"Searching for a Pull Request (if any) that introduced this commit...\")`\n\t\t\t\t: this._options?.pullRequestPendingMessage ?? '';\n\t\t} else {\n\t\t\treturn this._padOrTruncate('', this._options.tokenOptions.pullRequest);\n\t\t}\n\n\t\treturn this._padOrTruncate(text, this._options.tokenOptions.pullRequest);\n\t}\n\n\tget pullRequestAgo(): string {\n\t\treturn this._padOrTruncate(this._pullRequestDateAgo, this._options.tokenOptions.pullRequestAgo);\n\t}\n\n\tget pullRequestAgoOrDate(): string {\n\t\treturn this._padOrTruncate(this._pullRequestDateOrAgo, this._options.tokenOptions.pullRequestAgoOrDate);\n\t}\n\n\tget pullRequestDate(): string {\n\t\treturn this._padOrTruncate(this._pullRequestDate, this._options.tokenOptions.pullRequestDate);\n\t}\n\n\tget pullRequestState(): string {\n\t\tconst { pullRequestOrRemote: pr } = this._options;\n\t\treturn this._padOrTruncate(\n\t\t\tpr == null || !PullRequest.is(pr) ? '' : pr.state ?? '',\n\t\t\tthis._options.tokenOptions.pullRequestState,\n\t\t);\n\t}\n\n\tget sha(): string {\n\t\treturn this._padOrTruncate(this._item.shortSha ?? '', this._options.tokenOptions.sha);\n\t}\n\n\tget tips(): string {\n\t\tlet branchAndTagTips = this._options.getBranchAndTagTips?.(this._item.sha, { icons: this._options.markdown });\n\t\tif (branchAndTagTips != null && this._options.markdown) {\n\t\t\tconst tips = branchAndTagTips.split(', ');\n\t\t\tbranchAndTagTips = tips\n\t\t\t\t.map(t => `<span style=\"color:#ffffff;background-color:#1d76db;\">&nbsp;&nbsp;${t}&nbsp;&nbsp;</span>`)\n\t\t\t\t.join(GlyphChars.Space.repeat(3));\n\t\t}\n\t\treturn this._padOrTruncate(branchAndTagTips ?? '', this._options.tokenOptions.tips);\n\t}\n\n\tstatic fromTemplate(template: string, commit: GitCommit, dateFormat: string | null): string;\n\tstatic fromTemplate(template: string, commit: GitCommit, options?: CommitFormatOptions): string;\n\tstatic fromTemplate(\n\t\ttemplate: string,\n\t\tcommit: GitCommit,\n\t\tdateFormatOrOptions?: string | null | CommitFormatOptions,\n\t): string;\n\tstatic fromTemplate(\n\t\ttemplate: string,\n\t\tcommit: GitCommit,\n\t\tdateFormatOrOptions?: string | null | CommitFormatOptions,\n\t): string {\n\t\tif (dateFormatOrOptions == null || typeof dateFormatOrOptions === 'string') {\n\t\t\tdateFormatOrOptions = {\n\t\t\t\tdateFormat: dateFormatOrOptions,\n\t\t\t};\n\t\t}\n\n\t\tif (CommitFormatter.has(template, 'footnotes')) {\n\t\t\tif (dateFormatOrOptions.footnotes == null) {\n\t\t\t\tdateFormatOrOptions.footnotes = new Map<number, string>();\n\t\t\t}\n\t\t}\n\n\t\tif (CommitFormatter.has(template, 'avatar') && dateFormatOrOptions?.markdown) {\n\t\t\tdebugger;\n\t\t\tthrow new Error(\"Invalid template token 'avatar' used in non-async call\");\n\t\t}\n\n\t\treturn super.fromTemplateCore(this, template, commit, dateFormatOrOptions);\n\t}\n\n\tstatic fromTemplateAsync(template: string, commit: GitCommit, dateFormat: string | null): Promise<string>;\n\tstatic fromTemplateAsync(template: string, commit: GitCommit, options?: CommitFormatOptions): Promise<string>;\n\tstatic fromTemplateAsync(\n\t\ttemplate: string,\n\t\tcommit: GitCommit,\n\t\tdateFormatOrOptions?: string | null | CommitFormatOptions,\n\t): Promise<string>;\n\tstatic fromTemplateAsync(\n\t\ttemplate: string,\n\t\tcommit: GitCommit,\n\t\tdateFormatOrOptions?: string | null | CommitFormatOptions,\n\t): Promise<string> {\n\t\tif (CommitFormatter.has(template, 'footnotes')) {\n\t\t\tif (dateFormatOrOptions == null || typeof dateFormatOrOptions === 'string') {\n\t\t\t\tdateFormatOrOptions = {\n\t\t\t\t\tdateFormat: dateFormatOrOptions,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (dateFormatOrOptions.footnotes == null) {\n\t\t\t\tdateFormatOrOptions.footnotes = new Map<number, string>();\n\t\t\t}\n\t\t}\n\n\t\treturn super.fromTemplateCoreAsync(this, template, commit, dateFormatOrOptions);\n\t}\n\n\tstatic override has(\n\t\ttemplate: string,\n\t\t...tokens: (keyof NonNullable<CommitFormatOptions['tokenOptions']>)[]\n\t): boolean {\n\t\treturn super.has<CommitFormatOptions>(template, ...tokens);\n\t}\n}\n\nfunction getMarkdownActionCommand<T extends ActionContext>(action: Action<T>, args: Omit<T, 'type'>): string {\n\treturn Command.getMarkdownCommandArgsCore(`${Commands.ActionPrefix}${action}`, {\n\t\t...args,\n\t\ttype: action,\n\t});\n}\n","import {\n\tgetTokensFromTemplate,\n\tgetWidth,\n\tinterpolate,\n\tinterpolateAsync,\n\tpadLeft,\n\tpadRight,\n\tTokenOptions,\n\ttruncate,\n} from '../../system/string';\n\nexport interface FormatOptions {\n\tdateFormat?: string | null;\n\ttokenOptions?: Record<string, TokenOptions | undefined>;\n}\n\ntype Constructor<T = Record<string, unknown>> = new (...args: any[]) => T;\n\nconst hasTokenRegexMap = new Map<string, RegExp>();\nconst spaceReplacementRegex = / /g;\n\ndeclare type RequiredTokenOptions<Options extends FormatOptions> = Options & Required<Pick<Options, 'tokenOptions'>>;\n\nexport abstract class Formatter<Item = any, Options extends FormatOptions = FormatOptions> {\n\tprotected _item!: Item;\n\tprotected _options!: RequiredTokenOptions<Options>;\n\n\tconstructor(item: Item, options?: Options) {\n\t\tthis.reset(item, options);\n\t}\n\n\treset(item: Item, options?: Options) {\n\t\tthis._item = item;\n\t\tthis.collapsableWhitespace = 0;\n\n\t\tif (options == null && this._options != null) return;\n\n\t\tif (options == null) {\n\t\t\t// eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n\t\t\toptions = {} as Options;\n\t\t}\n\n\t\tif (options.dateFormat == null) {\n\t\t\toptions.dateFormat = 'MMMM Do, YYYY h:mma';\n\t\t}\n\n\t\tif (options.tokenOptions == null) {\n\t\t\toptions.tokenOptions = {};\n\t\t}\n\n\t\tthis._options = options as RequiredTokenOptions<Options>;\n\t}\n\n\tprivate collapsableWhitespace: number = 0;\n\n\tprotected _padOrTruncate(s: string, options: TokenOptions | undefined) {\n\t\tif (s == null || s.length === 0) return s;\n\n\t\t// NOTE: the collapsable whitespace logic relies on the javascript template evaluation to be left to right\n\t\tif (options == null) {\n\t\t\toptions = {\n\t\t\t\tcollapseWhitespace: false,\n\t\t\t\tpadDirection: 'left',\n\t\t\t\tprefix: undefined,\n\t\t\t\tsuffix: undefined,\n\t\t\t\ttruncateTo: undefined,\n\t\t\t};\n\t\t}\n\n\t\tlet max = options.truncateTo;\n\t\tif (max == null) {\n\t\t\tthis.collapsableWhitespace = 0;\n\t\t} else {\n\t\t\tmax += this.collapsableWhitespace;\n\t\t\tthis.collapsableWhitespace = 0;\n\n\t\t\tconst width = getWidth(s);\n\t\t\tconst diff = max - width;\n\t\t\tif (diff > 0) {\n\t\t\t\tif (options.collapseWhitespace) {\n\t\t\t\t\tthis.collapsableWhitespace = diff;\n\t\t\t\t}\n\n\t\t\t\tif (options.padDirection === 'left') {\n\t\t\t\t\ts = padLeft(s, max, undefined, width);\n\t\t\t\t} else {\n\t\t\t\t\tif (options.collapseWhitespace) {\n\t\t\t\t\t\tmax -= diff;\n\t\t\t\t\t}\n\t\t\t\t\ts = padRight(s, max, undefined, width);\n\t\t\t\t}\n\t\t\t} else if (diff < 0) {\n\t\t\t\ts = truncate(s, max, undefined, width);\n\t\t\t}\n\t\t}\n\n\t\tif (options.prefix || options.suffix) {\n\t\t\ts = `${options.prefix ?? ''}${s}${options.suffix ?? ''}`;\n\t\t}\n\n\t\treturn s;\n\t}\n\n\tprivate static _formatter: Formatter | undefined = undefined;\n\n\tprotected static fromTemplateCore<TFormatter extends Formatter<Item, Options>, Item, Options extends FormatOptions>(\n\t\tformatter: TFormatter | Constructor<TFormatter>,\n\t\ttemplate: string,\n\t\titem: Item,\n\t\tdateFormatOrOptions?: string | null | Options,\n\t): string {\n\t\t// Preserve spaces\n\t\ttemplate = template.replace(spaceReplacementRegex, '\\u00a0');\n\t\tif (formatter instanceof Formatter) return interpolate(template, formatter);\n\n\t\tlet options: Options | undefined = undefined;\n\t\tif (dateFormatOrOptions == null || typeof dateFormatOrOptions === 'string') {\n\t\t\t// eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n\t\t\toptions = {\n\t\t\t\tdateFormat: dateFormatOrOptions,\n\t\t\t} as Options;\n\t\t} else {\n\t\t\toptions = dateFormatOrOptions;\n\t\t}\n\n\t\tif (options.tokenOptions == null) {\n\t\t\tconst tokenOptions = getTokensFromTemplate(template).reduce<{\n\t\t\t\t[token: string]: TokenOptions | undefined;\n\t\t\t}>((map, token) => {\n\t\t\t\tmap[token.key] = token.options;\n\t\t\t\treturn map;\n\t\t\t}, Object.create(null));\n\n\t\t\toptions.tokenOptions = tokenOptions;\n\t\t}\n\n\t\tif (this._formatter == null) {\n\t\t\tthis._formatter = new formatter(item, options);\n\t\t} else {\n\t\t\tthis._formatter.reset(item, options);\n\t\t}\n\n\t\treturn interpolate(template, this._formatter);\n\t}\n\n\tprotected static fromTemplateCoreAsync<\n\t\tTFormatter extends Formatter<Item, Options>,\n\t\tItem,\n\t\tOptions extends FormatOptions,\n\t>(\n\t\tformatter: TFormatter | Constructor<TFormatter>,\n\t\ttemplate: string,\n\t\titem: Item,\n\t\tdateFormatOrOptions?: string | null | Options,\n\t): Promise<string> {\n\t\t// Preserve spaces\n\t\ttemplate = template.replace(spaceReplacementRegex, '\\u00a0');\n\t\tif (formatter instanceof Formatter) return interpolateAsync(template, formatter);\n\n\t\tlet options: Options | undefined = undefined;\n\t\tif (dateFormatOrOptions == null || typeof dateFormatOrOptions === 'string') {\n\t\t\t// eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n\t\t\toptions = {\n\t\t\t\tdateFormat: dateFormatOrOptions,\n\t\t\t} as Options;\n\t\t} else {\n\t\t\toptions = dateFormatOrOptions;\n\t\t}\n\n\t\tif (options.tokenOptions == null) {\n\t\t\tconst tokenOptions = getTokensFromTemplate(template).reduce<{\n\t\t\t\t[token: string]: TokenOptions | undefined;\n\t\t\t}>((map, token) => {\n\t\t\t\tmap[token.key] = token.options;\n\t\t\t\treturn map;\n\t\t\t}, Object.create(null));\n\n\t\t\toptions.tokenOptions = tokenOptions;\n\t\t}\n\n\t\tif (this._formatter == null) {\n\t\t\tthis._formatter = new formatter(item, options);\n\t\t} else {\n\t\t\tthis._formatter.reset(item, options);\n\t\t}\n\n\t\treturn interpolateAsync(template, this._formatter);\n\t}\n\n\tstatic has<TOptions extends FormatOptions>(\n\t\ttemplate: string,\n\t\t...tokens: (keyof NonNullable<TOptions['tokenOptions']>)[]\n\t): boolean {\n\t\tconst token =\n\t\t\ttokens.length === 1\n\t\t\t\t? (tokens[0] as string)\n\t\t\t\t: (`(${tokens.join('|')})` as keyof NonNullable<TOptions['tokenOptions']> as string);\n\n\t\tlet regex = hasTokenRegexMap.get(token);\n\t\tif (regex == null) {\n\t\t\tregex = new RegExp(`\\\\b${token}\\\\b`);\n\t\t\thasTokenRegexMap.set(token, regex);\n\t\t}\n\n\t\treturn regex.test(template);\n\t}\n}\n","import { GlyphChars } from '../../constants';\nimport { basename } from '../../system/path';\nimport { TokenOptions } from '../../system/string';\nimport { GitFile, GitFileChange, GitFileWithCommit } from '../models/file';\nimport { FormatOptions, Formatter } from './formatter';\n\nexport interface StatusFormatOptions extends FormatOptions {\n\trelativePath?: string;\n\n\ttokenOptions?: {\n\t\tdirectory?: TokenOptions;\n\t\tfile?: TokenOptions;\n\t\tfilePath?: TokenOptions;\n\t\toriginalPath?: TokenOptions;\n\t\tpath?: TokenOptions;\n\t\tstatus?: TokenOptions;\n\t\tworking?: TokenOptions;\n\t\tchanges?: TokenOptions;\n\t\tchangesDetail?: TokenOptions;\n\t\tchangesShort?: TokenOptions;\n\t};\n}\n\nexport class StatusFileFormatter extends Formatter<GitFile, StatusFormatOptions> {\n\tget directory() {\n\t\tconst directory = GitFile.getFormattedDirectory(this._item, false, this._options.relativePath);\n\t\treturn this._padOrTruncate(directory, this._options.tokenOptions.directory);\n\t}\n\n\tget file() {\n\t\tconst file = basename(this._item.path);\n\t\treturn this._padOrTruncate(file, this._options.tokenOptions.file);\n\t}\n\n\tget filePath() {\n\t\tconst filePath = GitFile.getFormattedPath(this._item, {\n\t\t\trelativeTo: this._options.relativePath,\n\t\t\ttruncateTo: this._options.tokenOptions.filePath?.truncateTo,\n\t\t});\n\t\treturn this._padOrTruncate(filePath, this._options.tokenOptions.filePath);\n\t}\n\n\tget originalPath() {\n\t\t// if (\n\t\t//     // this._item.status !== 'R' ||\n\t\t//     this._item.originalFileName == null ||\n\t\t//     this._item.originalFileName.length === 0\n\t\t// ) {\n\t\t//     return '';\n\t\t// }\n\n\t\tconst originalPath = GitFile.getOriginalRelativePath(this._item, this._options.relativePath);\n\t\treturn this._padOrTruncate(originalPath, this._options.tokenOptions.originalPath);\n\t}\n\n\tget path() {\n\t\tconst directory = GitFile.getRelativePath(this._item, this._options.relativePath);\n\t\treturn this._padOrTruncate(directory, this._options.tokenOptions.path);\n\t}\n\n\tget status() {\n\t\tconst status = GitFile.getStatusText(this._item.status);\n\t\treturn this._padOrTruncate(status, this._options.tokenOptions.status);\n\t}\n\n\tget working() {\n\t\tlet icon = '';\n\t\tif (this._item.workingTreeStatus != null && this._item.indexStatus != null) {\n\t\t\ticon = `${GlyphChars.Pencil}${GlyphChars.Space}${GlyphChars.SpaceThinnest}${GlyphChars.Check}`;\n\t\t} else if (this._item.workingTreeStatus != null) {\n\t\t\ticon = `${GlyphChars.Pencil}${GlyphChars.SpaceThin}${GlyphChars.SpaceThinnest}${GlyphChars.EnDash}${GlyphChars.Space}`;\n\t\t} else if (this._item.indexStatus != null) {\n\t\t\ticon = `${GlyphChars.Space}${GlyphChars.EnDash}${GlyphChars.Space.repeat(2)}${GlyphChars.Check}`;\n\t\t} else {\n\t\t\ticon = '';\n\t\t}\n\t\treturn this._padOrTruncate(icon, this._options.tokenOptions.working);\n\t}\n\n\tget changes(): string {\n\t\treturn this._padOrTruncate(\n\t\t\tGitFileChange.is(this._item) ? this._item.formatStats() : '',\n\t\t\tthis._options.tokenOptions.changes,\n\t\t);\n\t}\n\n\tget changesDetail(): string {\n\t\treturn this._padOrTruncate(\n\t\t\tGitFileChange.is(this._item) ? this._item.formatStats({ expand: true, separator: ', ' }) : '',\n\t\t\tthis._options.tokenOptions.changesDetail,\n\t\t);\n\t}\n\n\tget changesShort(): string {\n\t\treturn this._padOrTruncate(\n\t\t\tGitFileChange.is(this._item) ? this._item.formatStats({ compact: true, separator: '' }) : '',\n\t\t\tthis._options.tokenOptions.changesShort,\n\t\t);\n\t}\n\n\tstatic fromTemplate(template: string, file: GitFile | GitFileWithCommit, dateFormat: string | null): string;\n\tstatic fromTemplate(template: string, file: GitFile | GitFileWithCommit, options?: StatusFormatOptions): string;\n\tstatic fromTemplate(\n\t\ttemplate: string,\n\t\tfile: GitFile,\n\t\tdateFormatOrOptions?: string | null | StatusFormatOptions,\n\t): string;\n\tstatic fromTemplate(\n\t\ttemplate: string,\n\t\tfile: GitFile,\n\t\tdateFormatOrOptions?: string | null | StatusFormatOptions,\n\t): string {\n\t\treturn super.fromTemplateCore(this, template, file, dateFormatOrOptions);\n\t}\n}\n","import { Disposable, Event, Range, TextDocument, Uri, WorkspaceFolder } from 'vscode';\nimport type { Commit, InputBox } from '../@types/vscode.git';\nimport { Features, PremiumFeatures } from '../features';\nimport type { SubscriptionPlanId } from '../subscription';\nimport type { GitUri } from './gitUri';\nimport type {\n\tBranchSortOptions,\n\tGitBlame,\n\tGitBlameLine,\n\tGitBlameLines,\n\tGitBranch,\n\tGitBranchReference,\n\tGitCommit,\n\tGitContributor,\n\tGitDiff,\n\tGitDiffFilter,\n\tGitDiffHunkLine,\n\tGitDiffShortStat,\n\tGitFile,\n\tGitLog,\n\tGitMergeStatus,\n\tGitRebaseStatus,\n\tGitReflog,\n\tGitRemote,\n\tGitStash,\n\tGitStatus,\n\tGitStatusFile,\n\tGitTag,\n\tGitTreeEntry,\n\tGitUser,\n\tGitWorktree,\n\tRepository,\n\tRepositoryChangeEvent,\n\tTagSortOptions,\n} from './models';\nimport type { RemoteProviders } from './remotes/factory';\nimport type { RemoteProvider, RichRemoteProvider } from './remotes/provider';\nimport type { SearchPattern } from './search';\n\nexport const enum GitProviderId {\n\tGit = 'git',\n\tGitHub = 'github',\n\tVsls = 'vsls',\n}\n\nexport interface GitProviderDescriptor {\n\treadonly id: GitProviderId;\n\treadonly name: string;\n}\n\nexport interface RepositoryInitWatcher extends Disposable {\n\treadonly onDidCreate: Event<Uri>;\n}\n\nexport interface ScmRepository {\n\treadonly rootUri: Uri;\n\treadonly inputBox: InputBox;\n\n\tgetCommit(ref: string): Promise<Commit>;\n\tpush(remoteName?: string, branchName?: string, setUpstream?: boolean): Promise<void>;\n}\n\nexport interface PagedResult<T> {\n\treadonly paging?: {\n\t\treadonly cursor: string;\n\t\treadonly more: boolean;\n\t};\n\treadonly values: NonNullable<T>[];\n}\n\nexport interface NextComparisionUrisResult {\n\tcurrent: GitUri;\n\tnext: GitUri | undefined;\n\tdeleted?: boolean | undefined;\n}\n\nexport interface PreviousComparisionUrisResult {\n\tcurrent: GitUri;\n\tprevious: GitUri | undefined;\n}\n\nexport interface PreviousLineComparisionUrisResult extends PreviousComparisionUrisResult {\n\tline: number;\n}\n\nexport interface RepositoryCloseEvent {\n\treadonly uri: Uri;\n}\n\nexport interface RepositoryOpenEvent {\n\treadonly uri: Uri;\n}\n\nexport const enum RepositoryVisibility {\n\tPrivate = 'private',\n\tPublic = 'public',\n}\n\nexport interface GitProvider extends Disposable {\n\tget onDidChangeRepository(): Event<RepositoryChangeEvent>;\n\tget onDidCloseRepository(): Event<RepositoryCloseEvent>;\n\tget onDidOpenRepository(): Event<RepositoryOpenEvent>;\n\n\treadonly descriptor: GitProviderDescriptor;\n\treadonly supportedSchemes: Set<string>;\n\n\tdiscoverRepositories(uri: Uri): Promise<Repository[]>;\n\tupdateContext?(): void;\n\topenRepository(\n\t\tfolder: WorkspaceFolder | undefined,\n\t\turi: Uri,\n\t\troot: boolean,\n\t\tsuspended?: boolean,\n\t\tclosed?: boolean,\n\t): Repository;\n\topenRepositoryInitWatcher?(): RepositoryInitWatcher;\n\n\tallows(feature: PremiumFeatures, plan: SubscriptionPlanId, repoPath?: string): Promise<boolean>;\n\tsupports(feature: Features): Promise<boolean>;\n\tvisibility(repoPath: string): Promise<RepositoryVisibility>;\n\n\tgetOpenScmRepositories(): Promise<ScmRepository[]>;\n\tgetOrOpenScmRepository(repoPath: string): Promise<ScmRepository | undefined>;\n\n\tcanHandlePathOrUri(scheme: string, pathOrUri: string | Uri): string | undefined;\n\tgetAbsoluteUri(pathOrUri: string | Uri, base: string | Uri): Uri;\n\tgetBestRevisionUri(repoPath: string, path: string, ref: string | undefined): Promise<Uri | undefined>;\n\tgetRelativePath(pathOrUri: string | Uri, base: string | Uri): string;\n\tgetRevisionUri(repoPath: string, path: string, ref: string): Uri;\n\t// getRootUri(pathOrUri: string | Uri): Uri;\n\tgetWorkingUri(repoPath: string, uri: Uri): Promise<Uri | undefined>;\n\n\taddRemote(repoPath: string, name: string, url: string): Promise<void>;\n\tpruneRemote(repoPath: string, remoteName: string): Promise<void>;\n\tapplyChangesToWorkingFile(uri: GitUri, ref1?: string, ref2?: string): Promise<void>;\n\tcheckout(\n\t\trepoPath: string,\n\t\tref: string,\n\t\toptions?: { createBranch?: string | undefined } | { fileName?: string | undefined },\n\t): Promise<void>;\n\tresetCaches(\n\t\t...affects: ('branches' | 'contributors' | 'providers' | 'remotes' | 'stashes' | 'status' | 'tags')[]\n\t): void;\n\texcludeIgnoredUris(repoPath: string, uris: Uri[]): Promise<Uri[]>;\n\tfetch(\n\t\trepoPath: string,\n\t\toptions?: {\n\t\t\tall?: boolean | undefined;\n\t\t\tbranch?: GitBranchReference | undefined;\n\t\t\tprune?: boolean | undefined;\n\t\t\tpull?: boolean | undefined;\n\t\t\tremote?: string | undefined;\n\t\t},\n\t): Promise<void>;\n\tfindRepositoryUri(uri: Uri, isDirectory?: boolean): Promise<Uri | undefined>;\n\tgetAheadBehindCommitCount(repoPath: string, refs: string[]): Promise<{ ahead: number; behind: number } | undefined>;\n\t/**\n\t * Returns the blame of a file\n\t * @param uri Uri of the file to blame\n\t * @param document Optional TextDocument to blame the contents of if dirty\n\t */\n\tgetBlame(uri: GitUri, document?: TextDocument | undefined): Promise<GitBlame | undefined>;\n\t/**\n\t * Returns the blame of a file, using the editor contents (for dirty editors)\n\t * @param uri Uri of the file to blame\n\t * @param contents Contents from the editor to use\n\t */\n\tgetBlameContents(uri: GitUri, contents: string): Promise<GitBlame | undefined>;\n\t/**\n\t * Returns the blame of a single line\n\t * @param uri Uri of the file to blame\n\t * @param editorLine Editor line number (0-based) to blame (Git is 1-based)\n\t * @param document Optional TextDocument to blame the contents of if dirty\n\t * @param options.forceSingleLine Forces blame to be for the single line (rather than the whole file)\n\t */\n\tgetBlameForLine(\n\t\turi: GitUri,\n\t\teditorLine: number,\n\t\tdocument?: TextDocument | undefined,\n\t\toptions?: { forceSingleLine?: boolean },\n\t): Promise<GitBlameLine | undefined>;\n\t/**\n\t * Returns the blame of a single line, using the editor contents (for dirty editors)\n\t * @param uri Uri of the file to blame\n\t * @param editorLine Editor line number (0-based) to blame (Git is 1-based)\n\t * @param contents Contents from the editor to use\n\t */\n\tgetBlameForLineContents(\n\t\turi: GitUri,\n\t\teditorLine: number,\n\t\tcontents: string,\n\t\toptions?: { forceSingleLine?: boolean },\n\t): Promise<GitBlameLine | undefined>;\n\tgetBlameForRange(uri: GitUri, range: Range): Promise<GitBlameLines | undefined>;\n\tgetBlameForRangeContents(uri: GitUri, range: Range, contents: string): Promise<GitBlameLines | undefined>;\n\tgetBlameRange(blame: GitBlame, uri: GitUri, range: Range): GitBlameLines | undefined;\n\tgetBranch(repoPath: string): Promise<GitBranch | undefined>;\n\tgetBranches(\n\t\trepoPath: string,\n\t\toptions?: {\n\t\t\tcursor?: string;\n\t\t\tfilter?: ((b: GitBranch) => boolean) | undefined;\n\t\t\tsort?: boolean | BranchSortOptions | undefined;\n\t\t},\n\t): Promise<PagedResult<GitBranch>>;\n\tgetChangedFilesCount(repoPath: string, ref?: string): Promise<GitDiffShortStat | undefined>;\n\tgetCommit(repoPath: string, ref: string): Promise<GitCommit | undefined>;\n\tgetCommitBranches(\n\t\trepoPath: string,\n\t\tref: string,\n\t\toptions?: {\n\t\t\tbranch?: string | undefined;\n\t\t\tcommitDate?: Date | undefined;\n\t\t\tmode?: 'contains' | 'pointsAt' | undefined;\n\t\t\tname?: string | undefined;\n\t\t\tremotes?: boolean | undefined;\n\t\t},\n\t): Promise<string[]>;\n\tgetCommitCount(repoPath: string, ref: string): Promise<number | undefined>;\n\tgetCommitForFile(\n\t\trepoPath: string,\n\t\turi: Uri,\n\t\toptions?: {\n\t\t\tref?: string | undefined;\n\t\t\tfirstIfNotFound?: boolean | undefined;\n\t\t\trange?: Range | undefined;\n\t\t},\n\t): Promise<GitCommit | undefined>;\n\tgetOldestUnpushedRefForFile(repoPath: string, uri: Uri): Promise<string | undefined>;\n\tgetContributors(\n\t\trepoPath: string,\n\t\toptions?: { all?: boolean | undefined; ref?: string | undefined; stats?: boolean | undefined },\n\t): Promise<GitContributor[]>;\n\tgetCurrentUser(repoPath: string): Promise<GitUser | undefined>;\n\tgetDefaultBranchName(repoPath: string | undefined, remote?: string): Promise<string | undefined>;\n\t/**\n\t * Returns a file diff between two commits\n\t * @param uri Uri of the file to diff\n\t * @param ref1 Commit to diff from\n\t * @param ref2 Commit to diff to\n\t */\n\tgetDiffForFile(uri: GitUri, ref1: string | undefined, ref2?: string): Promise<GitDiff | undefined>;\n\t/**\n\t * Returns a file diff between a commit and the specified contents\n\t * @param uri Uri of the file to diff\n\t * @param ref Commit to diff from\n\t * @param contents Contents to use for the diff\n\t */\n\tgetDiffForFileContents(uri: GitUri, ref: string, contents: string): Promise<GitDiff | undefined>;\n\t/**\n\t * Returns a line diff between two commits\n\t * @param uri Uri of the file to diff\n\t * @param editorLine Editor line number (0-based) to blame (Git is 1-based)\n\t * @param ref1 Commit to diff from\n\t * @param ref2 Commit to diff to\n\t */\n\tgetDiffForLine(\n\t\turi: GitUri,\n\t\teditorLine: number,\n\t\tref1: string | undefined,\n\t\tref2?: string,\n\t): Promise<GitDiffHunkLine | undefined>;\n\tgetDiffStatus(\n\t\trepoPath: string,\n\t\tref1?: string,\n\t\tref2?: string,\n\t\toptions?: { filters?: GitDiffFilter[] | undefined; similarityThreshold?: number | undefined },\n\t): Promise<GitFile[] | undefined>;\n\tgetFileStatusForCommit(repoPath: string, uri: Uri, ref: string): Promise<GitFile | undefined>;\n\tgetLastFetchedTimestamp(repoPath: string): Promise<number | undefined>;\n\tgetLog(\n\t\trepoPath: string,\n\t\toptions?: {\n\t\t\tall?: boolean | undefined;\n\t\t\tauthors?: GitUser[] | undefined;\n\t\t\tcursor?: string | undefined;\n\t\t\tlimit?: number | undefined;\n\t\t\tmerges?: boolean | undefined;\n\t\t\tordering?: string | null | undefined;\n\t\t\tref?: string | undefined;\n\t\t\tsince?: string | undefined;\n\t\t},\n\t): Promise<GitLog | undefined>;\n\tgetLogRefsOnly(\n\t\trepoPath: string,\n\t\toptions?: {\n\t\t\tauthors?: GitUser[] | undefined;\n\t\t\tcursor?: string | undefined;\n\t\t\tlimit?: number | undefined;\n\t\t\tmerges?: boolean | undefined;\n\t\t\tordering?: string | null | undefined;\n\t\t\tref?: string | undefined;\n\t\t\tsince?: string | undefined;\n\t\t},\n\t): Promise<Set<string> | undefined>;\n\tgetLogForSearch(\n\t\trepoPath: string,\n\t\tsearch: SearchPattern,\n\t\toptions?: {\n\t\t\tlimit?: number | undefined;\n\t\t\tordering?: 'date' | 'author-date' | 'topo' | null | undefined;\n\t\t\tskip?: number | undefined;\n\t\t},\n\t): Promise<GitLog | undefined>;\n\tgetLogForFile(\n\t\trepoPath: string,\n\t\tpathOrUri: string | Uri,\n\t\toptions?: {\n\t\t\tall?: boolean | undefined;\n\t\t\tcursor?: string | undefined;\n\t\t\tforce?: boolean | undefined;\n\t\t\tlimit?: number | undefined;\n\t\t\tordering?: string | null | undefined;\n\t\t\trange?: Range | undefined;\n\t\t\tref?: string | undefined;\n\t\t\trenames?: boolean | undefined;\n\t\t\treverse?: boolean | undefined;\n\t\t\tsince?: string | undefined;\n\t\t\tskip?: number | undefined;\n\t\t},\n\t): Promise<GitLog | undefined>;\n\tgetMergeBase(\n\t\trepoPath: string,\n\t\tref1: string,\n\t\tref2: string,\n\t\toptions?: { forkPoint?: boolean | undefined },\n\t): Promise<string | undefined>;\n\tgetMergeStatus(repoPath: string): Promise<GitMergeStatus | undefined>;\n\tgetRebaseStatus(repoPath: string): Promise<GitRebaseStatus | undefined>;\n\tgetNextComparisonUris(\n\t\trepoPath: string,\n\t\turi: Uri,\n\t\tref: string | undefined,\n\t\tskip?: number,\n\t): Promise<NextComparisionUrisResult | undefined>;\n\tgetPreviousComparisonUris(\n\t\trepoPath: string,\n\t\turi: Uri,\n\t\tref: string | undefined,\n\t\tskip?: number,\n\t\tfirstParent?: boolean,\n\t): Promise<PreviousComparisionUrisResult | undefined>;\n\tgetPreviousComparisonUrisForLine(\n\t\trepoPath: string,\n\t\turi: Uri,\n\t\teditorLine: number,\n\t\tref: string | undefined,\n\t\tskip?: number,\n\t): Promise<PreviousLineComparisionUrisResult | undefined>;\n\tgetIncomingActivity(\n\t\trepoPath: string,\n\t\toptions?: {\n\t\t\tall?: boolean | undefined;\n\t\t\tbranch?: string | undefined;\n\t\t\tlimit?: number | undefined;\n\t\t\tordering?: string | null | undefined;\n\t\t\tskip?: number | undefined;\n\t\t},\n\t): Promise<GitReflog | undefined>;\n\tgetRemotes(\n\t\trepoPath: string | undefined,\n\t\toptions?: { providers?: RemoteProviders; sort?: boolean },\n\t): Promise<GitRemote<RemoteProvider | RichRemoteProvider | undefined>[]>;\n\tgetRevisionContent(repoPath: string, path: string, ref: string): Promise<Uint8Array | undefined>;\n\tgetStash(repoPath: string | undefined): Promise<GitStash | undefined>;\n\tgetStatusForFile(repoPath: string, uri: Uri): Promise<GitStatusFile | undefined>;\n\tgetStatusForFiles(repoPath: string, pathOrGlob: Uri): Promise<GitStatusFile[] | undefined>;\n\tgetStatusForRepo(repoPath: string | undefined): Promise<GitStatus | undefined>;\n\tgetTags(\n\t\trepoPath: string | undefined,\n\t\toptions?: {\n\t\t\tcursor?: string;\n\t\t\tfilter?: ((t: GitTag) => boolean) | undefined;\n\t\t\tsort?: boolean | TagSortOptions | undefined;\n\t\t},\n\t): Promise<PagedResult<GitTag>>;\n\tgetTreeEntryForRevision(repoPath: string, path: string, ref: string): Promise<GitTreeEntry | undefined>;\n\tgetTreeForRevision(repoPath: string, ref: string): Promise<GitTreeEntry[]>;\n\n\thasBranchOrTag(\n\t\trepoPath: string | undefined,\n\t\toptions?: {\n\t\t\tfilter?:\n\t\t\t\t| { branches?: ((b: GitBranch) => boolean) | undefined; tags?: ((t: GitTag) => boolean) | undefined }\n\t\t\t\t| undefined;\n\t\t},\n\t): Promise<boolean>;\n\n\thasCommitBeenPushed(repoPath: string, ref: string): Promise<boolean>;\n\tisTrackable(uri: Uri): boolean;\n\n\tgetDiffTool(repoPath?: string): Promise<string | undefined>;\n\topenDiffTool(\n\t\trepoPath: string,\n\t\turi: Uri,\n\t\toptions?: {\n\t\t\tref1?: string | undefined;\n\t\t\tref2?: string | undefined;\n\t\t\tstaged?: boolean | undefined;\n\t\t\ttool?: string | undefined;\n\t\t},\n\t): Promise<void>;\n\topenDirectoryCompare(repoPath: string, ref1: string, ref2?: string, tool?: string): Promise<void>;\n\n\tresolveReference(\n\t\trepoPath: string,\n\t\tref: string,\n\t\tpathOrUri?: string | Uri,\n\t\toptions?: { timeout?: number | undefined },\n\t): Promise<string>;\n\tvalidateBranchOrTagName(repoPath: string, ref: string): Promise<boolean>;\n\tvalidateReference(repoPath: string, ref: string): Promise<boolean>;\n\n\tstageFile(repoPath: string, pathOrUri: string | Uri): Promise<void>;\n\tstageDirectory(repoPath: string, directoryOrUri: string | Uri): Promise<void>;\n\tunStageFile(repoPath: string, pathOrUri: string | Uri): Promise<void>;\n\tunStageDirectory(repoPath: string, directoryOrUri: string | Uri): Promise<void>;\n\n\tstashApply(repoPath: string, stashName: string, options?: { deleteAfter?: boolean | undefined }): Promise<void>;\n\tstashDelete(repoPath: string, stashName: string, ref?: string): Promise<void>;\n\tstashSave(\n\t\trepoPath: string,\n\t\tmessage?: string,\n\t\turis?: Uri[],\n\t\toptions?: { includeUntracked?: boolean | undefined; keepIndex?: boolean | undefined },\n\t): Promise<void>;\n\n\tcreateWorktree?(\n\t\trepoPath: string,\n\t\tpath: string,\n\t\toptions?: { commitish?: string; createBranch?: string; detach?: boolean; force?: boolean },\n\t): Promise<void>;\n\tgetWorktrees?(repoPath: string): Promise<GitWorktree[]>;\n\tgetWorktreesDefaultUri?(repoPath: string): Promise<Uri | undefined>;\n\tdeleteWorktree?(repoPath: string, path: string, options?: { force?: boolean }): Promise<void>;\n}\n\nexport interface RevisionUriData {\n\tref?: string;\n\trepoPath: string;\n}\n","import { encodingExists } from 'iconv-lite';\nimport {\n\tConfigurationChangeEvent,\n\tDisposable,\n\tEvent,\n\tEventEmitter,\n\tProgressLocation,\n\tRange,\n\tTextDocument,\n\tTextEditor,\n\tUri,\n\twindow,\n\tWindowState,\n\tworkspace,\n\tWorkspaceFolder,\n\tWorkspaceFoldersChangeEvent,\n} from 'vscode';\nimport { resetAvatarCache } from '../avatars';\nimport { configuration } from '../configuration';\nimport { ContextKeys, CoreGitConfiguration, GlyphChars, Schemes } from '../constants';\nimport type { Container } from '../container';\nimport { setContext } from '../context';\nimport { AccessDeniedError, ProviderNotFoundError } from '../errors';\nimport type { FeatureAccess, Features, PremiumFeatures } from '../features';\nimport { Logger } from '../logger';\nimport type { SubscriptionChangeEvent } from '../premium/subscription/subscriptionService';\nimport { asRepoComparisonKey, RepoComparisionKey, Repositories } from '../repositories';\nimport { WorkspaceStorageKeys } from '../storage';\nimport {\n\tFreeSubscriptionPlans,\n\tgetSubscriptionPlanPriority,\n\tisSubscriptionPaidPlan,\n\tRequiredSubscriptionPlans,\n\tSubscription,\n\tSubscriptionPlanId,\n} from '../subscription';\nimport { groupByFilterMap, groupByMap } from '../system/array';\nimport { gate } from '../system/decorators/gate';\nimport { debug, log } from '../system/decorators/log';\nimport { count, filter, first, flatMap, map, some } from '../system/iterable';\nimport { dirname, getBestPath, getScheme, isAbsolute, maybeUri, normalizePath } from '../system/path';\nimport { cancellable, isPromise, PromiseCancelledError } from '../system/promise';\nimport { VisitedPathsTrie } from '../system/trie';\nimport {\n\tGitProvider,\n\tGitProviderDescriptor,\n\tGitProviderId,\n\tNextComparisionUrisResult,\n\tPagedResult,\n\tPreviousComparisionUrisResult,\n\tPreviousLineComparisionUrisResult,\n\tRepositoryVisibility,\n\tScmRepository,\n} from './gitProvider';\nimport { GitUri } from './gitUri';\nimport {\n\tBranchSortOptions,\n\tGitBlame,\n\tGitBlameLine,\n\tGitBlameLines,\n\tGitBranch,\n\tGitBranchReference,\n\tGitCommit,\n\tGitContributor,\n\tGitDiff,\n\tGitDiffFilter,\n\tGitDiffHunkLine,\n\tGitDiffShortStat,\n\tGitFile,\n\tGitLog,\n\tGitMergeStatus,\n\tGitRebaseStatus,\n\tGitReference,\n\tGitReflog,\n\tGitRemote,\n\tGitRevision,\n\tGitStash,\n\tGitStatus,\n\tGitStatusFile,\n\tGitTag,\n\tGitTreeEntry,\n\tGitUser,\n\tGitWorktree,\n\tPullRequest,\n\tPullRequestState,\n\tRepository,\n\tRepositoryChange,\n\tRepositoryChangeComparisonMode,\n\tRepositoryChangeEvent,\n\tTagSortOptions,\n} from './models';\nimport { RemoteProviders } from './remotes/factory';\nimport { Authentication, RemoteProvider, RichRemoteProvider } from './remotes/provider';\nimport { SearchPattern } from './search';\n\nconst maxDefaultBranchWeight = 100;\nconst weightedDefaultBranches = new Map<string, number>([\n\t['master', maxDefaultBranchWeight],\n\t['main', 15],\n\t['default', 10],\n\t['develop', 5],\n\t['development', 1],\n]);\n\nexport type GitProvidersChangeEvent = {\n\treadonly added: readonly GitProvider[];\n\treadonly removed: readonly GitProvider[];\n\treadonly etag: number;\n};\n\nexport type RepositoriesChangeEvent = {\n\treadonly added: readonly Repository[];\n\treadonly removed: readonly Repository[];\n\treadonly etag: number;\n};\n\nexport interface GitProviderResult {\n\tprovider: GitProvider;\n\tpath: string;\n}\n\nexport const enum RepositoriesVisibility {\n\tPrivate = 'private',\n\tPublic = 'public',\n\tMixed = 'mixed',\n}\n\nexport class GitProviderService implements Disposable {\n\tstatic readonly previewFeatures: Map<PremiumFeatures | undefined, boolean> | undefined; // = new Map();\n\n\tprivate readonly _onDidChangeProviders = new EventEmitter<GitProvidersChangeEvent>();\n\tget onDidChangeProviders(): Event<GitProvidersChangeEvent> {\n\t\treturn this._onDidChangeProviders.event;\n\t}\n\tprivate fireProvidersChanged(added?: GitProvider[], removed?: GitProvider[]) {\n\t\tthis._etag = Date.now();\n\n\t\tthis._onDidChangeProviders.fire({ added: added ?? [], removed: removed ?? [], etag: this._etag });\n\t}\n\n\tprivate _onDidChangeRepositories = new EventEmitter<RepositoriesChangeEvent>();\n\tget onDidChangeRepositories(): Event<RepositoriesChangeEvent> {\n\t\treturn this._onDidChangeRepositories.event;\n\t}\n\tprivate fireRepositoriesChanged(added?: Repository[], removed?: Repository[]) {\n\t\tthis._etag = Date.now();\n\n\t\tthis._accessCache.clear();\n\t\tthis._visibilityCache.delete(undefined);\n\t\tif (removed?.length) {\n\t\t\tthis._visibilityCache.clear();\n\t\t}\n\t\tthis._onDidChangeRepositories.fire({ added: added ?? [], removed: removed ?? [], etag: this._etag });\n\t}\n\n\tprivate readonly _onDidChangeRepository = new EventEmitter<RepositoryChangeEvent>();\n\tget onDidChangeRepository(): Event<RepositoryChangeEvent> {\n\t\treturn this._onDidChangeRepository.event;\n\t}\n\n\treadonly supportedSchemes = new Set<string>();\n\n\tprivate readonly _disposable: Disposable;\n\tprivate readonly _pendingRepositories = new Map<RepoComparisionKey, Promise<Repository | undefined>>();\n\tprivate readonly _providers = new Map<GitProviderId, GitProvider>();\n\tprivate readonly _repositories = new Repositories();\n\tprivate readonly _richRemotesCache = new Map<string, GitRemote<RichRemoteProvider> | null>();\n\tprivate readonly _visitedPaths = new VisitedPathsTrie();\n\n\tconstructor(private readonly container: Container) {\n\t\tthis._disposable = Disposable.from(\n\t\t\tcontainer.subscription.onDidChange(this.onSubscriptionChanged, this),\n\t\t\twindow.onDidChangeWindowState(this.onWindowStateChanged, this),\n\t\t\tworkspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged, this),\n\t\t\tconfiguration.onDidChange(this.onConfigurationChanged, this),\n\t\t\tAuthentication.onDidChange(e => {\n\t\t\t\tif (e.reason === 'connected') {\n\t\t\t\t\tresetAvatarCache('failed');\n\t\t\t\t}\n\n\t\t\t\tthis.resetCaches('providers');\n\t\t\t\tthis.updateContext();\n\t\t\t}),\n\t\t);\n\n\t\tthis.container.BranchDateFormatting.reset();\n\t\tthis.container.CommitDateFormatting.reset();\n\t\tthis.container.CommitShaFormatting.reset();\n\t\tthis.container.PullRequestDateFormatting.reset();\n\n\t\tthis.updateContext();\n\t}\n\n\tdispose() {\n\t\tthis._disposable.dispose();\n\t\tthis._providers.clear();\n\n\t\tthis._repositories.forEach(r => r.dispose());\n\t\tthis._repositories.clear();\n\t}\n\n\tprivate _etag: number = 0;\n\tget etag(): number {\n\t\treturn this._etag;\n\t}\n\n\tprivate onConfigurationChanged(e?: ConfigurationChangeEvent) {\n\t\tif (\n\t\t\tconfiguration.changed(e, 'defaultDateFormat') ||\n\t\t\tconfiguration.changed(e, 'defaultDateSource') ||\n\t\t\tconfiguration.changed(e, 'defaultDateStyle')\n\t\t) {\n\t\t\tthis.container.BranchDateFormatting.reset();\n\t\t\tthis.container.CommitDateFormatting.reset();\n\t\t\tthis.container.PullRequestDateFormatting.reset();\n\t\t}\n\n\t\tif (configuration.changed(e, 'advanced.abbreviatedShaLength')) {\n\t\t\tthis.container.CommitShaFormatting.reset();\n\t\t}\n\n\t\tif (configuration.changed(e, 'views.contributors.showAllBranches')) {\n\t\t\tthis.resetCaches('contributors');\n\t\t}\n\t}\n\n\t@debug()\n\tonSubscriptionChanged(e: SubscriptionChangeEvent) {\n\t\tthis._accessCache.clear();\n\t\tthis._subscription = e.current;\n\t}\n\n\t@debug<GitProviderService['onWindowStateChanged']>({ args: { 0: e => `focused=${e.focused}` } })\n\tprivate onWindowStateChanged(e: WindowState) {\n\t\tif (e.focused) {\n\t\t\tthis._repositories.forEach(r => r.resume());\n\t\t} else {\n\t\t\tthis._repositories.forEach(r => r.suspend());\n\t\t}\n\t}\n\n\tprivate onWorkspaceFoldersChanged(e: WorkspaceFoldersChangeEvent) {\n\t\tif (e.added.length) {\n\t\t\tconst autoRepositoryDetection =\n\t\t\t\tconfiguration.getAny<boolean | 'subFolders' | 'openEditors'>(\n\t\t\t\t\tCoreGitConfiguration.AutoRepositoryDetection,\n\t\t\t\t) ?? true;\n\t\t\tif (autoRepositoryDetection !== false && autoRepositoryDetection !== 'openEditors') {\n\t\t\t\tvoid this.discoverRepositories(e.added);\n\t\t\t}\n\t\t}\n\n\t\tif (e.removed.length) {\n\t\t\tconst removed: Repository[] = [];\n\n\t\t\tfor (const folder of e.removed) {\n\t\t\t\tconst repository = this._repositories.getClosest(folder.uri);\n\t\t\t\tif (repository != null) {\n\t\t\t\t\tthis._repositories.remove(repository.uri);\n\t\t\t\t\tremoved.push(repository);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (removed.length) {\n\t\t\t\tthis.updateContext();\n\n\t\t\t\t// Defer the event trigger enough to let everything unwind\n\t\t\t\tqueueMicrotask(() => {\n\t\t\t\t\tthis.fireRepositoriesChanged([], removed);\n\t\t\t\t\tremoved.forEach(r => r.dispose());\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tget hasProviders(): boolean {\n\t\treturn this._providers.size !== 0;\n\t}\n\n\tget registeredProviders(): GitProviderDescriptor[] {\n\t\treturn [...map(this._providers.values(), p => ({ ...p.descriptor }))];\n\t}\n\n\tget openRepositories(): Repository[] {\n\t\tconst repositories = [...filter(this.repositories, r => !r.closed)];\n\t\tif (repositories.length === 0) return repositories;\n\n\t\treturn Repository.sort(repositories);\n\t}\n\n\tget openRepositoryCount(): number {\n\t\treturn count(this.repositories, r => !r.closed);\n\t}\n\n\tget repositories(): IterableIterator<Repository> {\n\t\treturn this._repositories.values();\n\t}\n\n\tget repositoryCount(): number {\n\t\treturn this._repositories.count;\n\t}\n\n\tget highlander(): Repository | undefined {\n\t\treturn this.repositoryCount === 1 ? first(this._repositories.values()) : undefined;\n\t}\n\n\t// get readonly() {\n\t// \treturn true;\n\t// \t// return this.container.vsls.readonly;\n\t// }\n\n\t// get useCaching() {\n\t// \treturn this.container.config.advanced.caching.enabled;\n\t// }\n\n\t/**\n\t * Registers a {@link GitProvider}\n\t * @param id A unique indentifier for the provider\n\t * @param name A name for the provider\n\t * @param provider A provider for handling git operations\n\t * @returns A disposable to unregister the {@link GitProvider}\n\t */\n\t@log({ args: { 1: false }, singleLine: true })\n\tregister(id: GitProviderId, provider: GitProvider): Disposable {\n\t\tif (id !== provider.descriptor.id) {\n\t\t\tthrow new Error(`Id '${id}' must match provider id '${provider.descriptor.id}'`);\n\t\t}\n\t\tif (this._providers.has(id)) throw new Error(`Provider '${id}' has already been registered`);\n\n\t\tthis._providers.set(id, provider);\n\t\tfor (const scheme of provider.supportedSchemes) {\n\t\t\tthis.supportedSchemes.add(scheme);\n\t\t}\n\n\t\tconst disposables = [];\n\n\t\tconst watcher = provider.openRepositoryInitWatcher?.();\n\t\tif (watcher != null) {\n\t\t\tdisposables.push(\n\t\t\t\twatcher,\n\t\t\t\twatcher.onDidCreate(uri => {\n\t\t\t\t\tconst f = workspace.getWorkspaceFolder(uri);\n\t\t\t\t\tif (f == null) return;\n\n\t\t\t\t\tvoid this.discoverRepositories([f], { force: true });\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tconst disposable = Disposable.from(\n\t\t\tprovider,\n\t\t\t...disposables,\n\t\t\tprovider.onDidChangeRepository(e => {\n\t\t\t\tif (\n\t\t\t\t\te.changed(\n\t\t\t\t\t\tRepositoryChange.Remotes,\n\t\t\t\t\t\tRepositoryChange.RemoteProviders,\n\t\t\t\t\t\tRepositoryChangeComparisonMode.Any,\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tthis._richRemotesCache.clear();\n\t\t\t\t}\n\n\t\t\t\tif (e.changed(RepositoryChange.Closed, RepositoryChangeComparisonMode.Any)) {\n\t\t\t\t\tthis.updateContext();\n\n\t\t\t\t\t// Send a notification that the repositories changed\n\t\t\t\t\tqueueMicrotask(() => this.fireRepositoriesChanged([], [e.repository]));\n\t\t\t\t}\n\n\t\t\t\tthis._visibilityCache.delete(e.repository.path);\n\t\t\t\tthis._onDidChangeRepository.fire(e);\n\t\t\t}),\n\t\t\tprovider.onDidCloseRepository(e => {\n\t\t\t\tconst repository = this._repositories.get(e.uri);\n\t\t\t\tif (repository != null) {\n\t\t\t\t\trepository.closed = true;\n\t\t\t\t}\n\t\t\t}),\n\t\t\tprovider.onDidOpenRepository(e => {\n\t\t\t\tconst repository = this._repositories.get(e.uri);\n\t\t\t\tif (repository != null) {\n\t\t\t\t\trepository.closed = false;\n\t\t\t\t} else {\n\t\t\t\t\tvoid this.getOrOpenRepository(e.uri);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis.fireProvidersChanged([provider]);\n\n\t\t// Don't kick off the discovery if we're still initializing (we'll do it at the end for all \"known\" providers)\n\t\tif (!this._initializing) {\n\t\t\tthis.onWorkspaceFoldersChanged({ added: workspace.workspaceFolders ?? [], removed: [] });\n\t\t}\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tdisposable.dispose();\n\t\t\t\tthis._providers.delete(id);\n\n\t\t\t\tconst removed: Repository[] = [];\n\n\t\t\t\tfor (const repository of [...this._repositories.values()]) {\n\t\t\t\t\tif (repository?.provider.id === id) {\n\t\t\t\t\t\tthis._repositories.remove(repository.uri);\n\t\t\t\t\t\tremoved.push(repository);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.updateContext();\n\n\t\t\t\tif (removed.length) {\n\t\t\t\t\t// Defer the event trigger enough to let everything unwind\n\t\t\t\t\tqueueMicrotask(() => {\n\t\t\t\t\t\tthis.fireRepositoriesChanged([], removed);\n\t\t\t\t\t\tremoved.forEach(r => r.dispose());\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.fireProvidersChanged([], [provider]);\n\t\t\t},\n\t\t};\n\t}\n\n\tprivate _initializing: boolean = true;\n\n\t@log({ singleLine: true })\n\tregistrationComplete() {\n\t\tthis._initializing = false;\n\n\t\tconst { workspaceFolders } = workspace;\n\t\tif (workspaceFolders?.length) {\n\t\t\tconst autoRepositoryDetection =\n\t\t\t\tconfiguration.getAny<boolean | 'subFolders' | 'openEditors'>(\n\t\t\t\t\tCoreGitConfiguration.AutoRepositoryDetection,\n\t\t\t\t) ?? true;\n\n\t\t\tif (autoRepositoryDetection !== false && autoRepositoryDetection !== 'openEditors') {\n\t\t\t\tvoid this.discoverRepositories(workspaceFolders);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.updateContext();\n\t}\n\n\tgetOpenProviders(): GitProvider[] {\n\t\tconst map = this.getOpenRepositoriesByProvider();\n\t\treturn [...map.keys()].map(id => this._providers.get(id)!);\n\t}\n\n\tgetOpenRepositories(id: GitProviderId): Iterable<Repository> {\n\t\treturn filter(this.repositories, r => !r.closed && (id == null || id === r.provider.id));\n\t}\n\n\tgetOpenRepositoriesByProvider(): Map<GitProviderId, Repository[]> {\n\t\tconst repositories = [...filter(this.repositories, r => !r.closed)];\n\t\tif (repositories.length === 0) return new Map();\n\n\t\treturn groupByMap(repositories, r => r.provider.id);\n\t}\n\n\thasOpenRepositories(id: GitProviderId): boolean {\n\t\treturn some(this.repositories, r => !r.closed && (id == null || id === r.provider.id));\n\t}\n\n\tprivate _discoveredWorkspaceFolders = new Map<WorkspaceFolder, Promise<Repository[]>>();\n\n\t@log<GitProviderService['discoverRepositories']>({ args: { 0: folders => folders.length } })\n\tasync discoverRepositories(folders: readonly WorkspaceFolder[], options?: { force?: boolean }): Promise<void> {\n\t\tconst promises = [];\n\n\t\tfor (const folder of folders) {\n\t\t\tif (!options?.force && this._discoveredWorkspaceFolders.has(folder)) continue;\n\n\t\t\tconst promise = this.discoverRepositoriesCore(folder);\n\t\t\tpromises.push(promise);\n\t\t\tthis._discoveredWorkspaceFolders.set(folder, promise);\n\t\t}\n\n\t\tif (promises.length === 0) return;\n\n\t\tconst results = await Promise.allSettled(promises);\n\n\t\tconst repositories = flatMap<PromiseFulfilledResult<Repository[]>, Repository>(\n\t\t\tfilter<PromiseSettledResult<Repository[]>, PromiseFulfilledResult<Repository[]>>(\n\t\t\t\tresults,\n\t\t\t\t(r): r is PromiseFulfilledResult<Repository[]> => r.status === 'fulfilled',\n\t\t\t),\n\t\t\tr => r.value,\n\t\t);\n\n\t\tconst added: Repository[] = [];\n\n\t\tfor (const repository of repositories) {\n\t\t\tif (this._repositories.add(repository)) {\n\t\t\t\tadded.push(repository);\n\t\t\t}\n\t\t}\n\n\t\tthis.updateContext();\n\n\t\tif (added.length === 0) return;\n\n\t\t// Defer the event trigger enough to let everything unwind\n\t\tqueueMicrotask(() => this.fireRepositoriesChanged(added));\n\t}\n\n\tprivate async discoverRepositoriesCore(folder: WorkspaceFolder): Promise<Repository[]> {\n\t\tconst { provider } = this.getProvider(folder.uri);\n\n\t\ttry {\n\t\t\treturn await provider.discoverRepositories(folder.uri);\n\t\t} catch (ex) {\n\t\t\tthis._discoveredWorkspaceFolders.delete(folder);\n\n\t\t\tLogger.error(\n\t\t\t\tex,\n\t\t\t\t`${provider.descriptor.name} Provider(${\n\t\t\t\t\tprovider.descriptor.id\n\t\t\t\t}) failed discovering repositories in ${folder.uri.toString(true)}`,\n\t\t\t);\n\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tprivate _subscription: Subscription | undefined;\n\tprivate async getSubscription(): Promise<Subscription> {\n\t\treturn this._subscription ?? (this._subscription = await this.container.subscription.getSubscription());\n\t}\n\n\tprivate _accessCache = new Map<string | undefined, Promise<FeatureAccess>>();\n\tasync access(feature?: PremiumFeatures, repoPath?: string | Uri): Promise<FeatureAccess> {\n\t\tlet cacheKey;\n\t\tif (repoPath != null) {\n\t\t\tconst { path } = this.getProvider(repoPath);\n\t\t\tcacheKey = path;\n\t\t}\n\n\t\tlet access = this._accessCache.get(cacheKey);\n\t\tif (access == null) {\n\t\t\taccess = this.accessCore(feature, repoPath);\n\t\t\tthis._accessCache.set(cacheKey, access);\n\t\t}\n\t\treturn access;\n\t}\n\n\t@debug()\n\tprivate async accessCore(feature?: PremiumFeatures, repoPath?: string | Uri): Promise<FeatureAccess> {\n\t\tconst subscription = await this.getSubscription();\n\t\tif (subscription.account?.verified === false) {\n\t\t\treturn { allowed: false, subscription: { current: subscription } };\n\t\t}\n\n\t\tconst plan = subscription.plan.effective.id;\n\t\tif (isSubscriptionPaidPlan(plan) || GitProviderService.previewFeatures?.get(feature)) {\n\t\t\treturn { allowed: true, subscription: { current: subscription } };\n\t\t}\n\n\t\tfunction getRepoAccess(\n\t\t\tthis: GitProviderService,\n\t\t\trepoPath: string | Uri,\n\t\t\tplan: FreeSubscriptionPlans,\n\t\t): Promise<FeatureAccess> {\n\t\t\tconst { path: cacheKey } = this.getProvider(repoPath);\n\n\t\t\tlet access = this._accessCache.get(cacheKey);\n\t\t\tif (access == null) {\n\t\t\t\taccess = this.visibility(repoPath).then(visibility => {\n\t\t\t\t\tif (visibility === RepositoryVisibility.Public) {\n\t\t\t\t\t\tswitch (plan) {\n\t\t\t\t\t\t\tcase SubscriptionPlanId.Free:\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tallowed: false,\n\t\t\t\t\t\t\t\t\tsubscription: { current: subscription, required: SubscriptionPlanId.FreePlus },\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tcase SubscriptionPlanId.FreePlus:\n\t\t\t\t\t\t\t\treturn { allowed: true, subscription: { current: subscription } };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tallowed: false,\n\t\t\t\t\t\tsubscription: { current: subscription, required: SubscriptionPlanId.Pro },\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tthis._accessCache.set(cacheKey, access);\n\t\t\t}\n\n\t\t\treturn access;\n\t\t}\n\n\t\tif (repoPath == null) {\n\t\t\tconst repositories = this.openRepositories;\n\t\t\tif (repositories.length === 0) {\n\t\t\t\treturn { allowed: false, subscription: { current: subscription } };\n\t\t\t}\n\n\t\t\tif (repositories.length === 1) {\n\t\t\t\treturn getRepoAccess.call(this, repositories[0].path, plan);\n\t\t\t}\n\n\t\t\tlet allowed = true;\n\t\t\tlet requiredPlan: RequiredSubscriptionPlans | undefined;\n\t\t\tlet requiredPriority = -1;\n\n\t\t\tconst results = await Promise.allSettled(repositories.map(r => getRepoAccess.call(this, r.path, plan)));\n\t\t\tfor (const result of results) {\n\t\t\t\tif (result.status !== 'fulfilled') continue;\n\n\t\t\t\tif (result.value.allowed) continue;\n\n\t\t\t\tallowed = false;\n\t\t\t\tconst priority = getSubscriptionPlanPriority(result.value.subscription.required);\n\t\t\t\tif (requiredPriority < priority) {\n\t\t\t\t\trequiredPriority = priority;\n\t\t\t\t\trequiredPlan = result.value.subscription.required;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn allowed\n\t\t\t\t? { allowed: true, subscription: { current: subscription } }\n\t\t\t\t: { allowed: false, subscription: { current: subscription, required: requiredPlan } };\n\t\t}\n\n\t\treturn getRepoAccess.call(this, repoPath, plan);\n\t}\n\n\tasync ensureAccess(feature: PremiumFeatures, repoPath?: string): Promise<void> {\n\t\tconst { allowed, subscription } = await this.access(feature, repoPath);\n\t\tif (!allowed) throw new AccessDeniedError(subscription.current, subscription.required);\n\t}\n\n\tsupports(repoPath: string | Uri, feature: Features): Promise<boolean> {\n\t\tconst { provider } = this.getProvider(repoPath);\n\t\treturn provider.supports(feature);\n\t}\n\n\tprivate _visibilityCache: Map<undefined, Promise<RepositoriesVisibility>> &\n\t\tMap<string, Promise<RepositoryVisibility>> = new Map();\n\tvisibility(): Promise<RepositoriesVisibility>;\n\tvisibility(repoPath: string | Uri): Promise<RepositoryVisibility>;\n\tasync visibility(repoPath?: string | Uri): Promise<RepositoriesVisibility | RepositoryVisibility> {\n\t\tif (repoPath == null) {\n\t\t\tlet visibility = this._visibilityCache.get(undefined);\n\t\t\tif (visibility == null) {\n\t\t\t\tvisibility = this.visibilityCore();\n\t\t\t\tthis._visibilityCache.set(undefined, visibility);\n\t\t\t}\n\t\t\treturn visibility;\n\t\t}\n\n\t\tconst { path: cacheKey } = this.getProvider(repoPath);\n\n\t\tlet visibility = this._visibilityCache.get(cacheKey);\n\t\tif (visibility == null) {\n\t\t\tvisibility = this.visibilityCore(repoPath);\n\t\t\tthis._visibilityCache.set(cacheKey, visibility);\n\t\t}\n\t\treturn visibility;\n\t}\n\n\tprivate visibilityCore(): Promise<RepositoriesVisibility>;\n\tprivate visibilityCore(repoPath: string | Uri): Promise<RepositoryVisibility>;\n\t@debug()\n\tprivate async visibilityCore(repoPath?: string | Uri): Promise<RepositoriesVisibility | RepositoryVisibility> {\n\t\tfunction getRepoVisibility(this: GitProviderService, repoPath: string | Uri): Promise<RepositoryVisibility> {\n\t\t\tconst { provider, path } = this.getProvider(repoPath);\n\n\t\t\tlet visibility = this._visibilityCache.get(path);\n\t\t\tif (visibility == null) {\n\t\t\t\tvisibility = provider.visibility(path);\n\t\t\t\tthis._visibilityCache.set(path, visibility);\n\t\t\t}\n\n\t\t\treturn visibility;\n\t\t}\n\n\t\tif (repoPath == null) {\n\t\t\tconst repositories = this.openRepositories;\n\t\t\tif (repositories.length === 0) return RepositoriesVisibility.Private;\n\n\t\t\tif (repositories.length === 1) {\n\t\t\t\treturn getRepoVisibility.call(this, repositories[0].path);\n\t\t\t}\n\n\t\t\tconst results = await Promise.allSettled(repositories.map(r => getRepoVisibility.call(this, r.path)));\n\n\t\t\tlet isPublic: boolean | undefined = undefined;\n\t\t\tlet isPrivate: boolean | undefined = undefined;\n\n\t\t\tfor (const result of results) {\n\t\t\t\tif (result.status !== 'fulfilled') continue;\n\n\t\t\t\tif (result.value === RepositoryVisibility.Public) {\n\t\t\t\t\tisPublic = true;\n\t\t\t\t} else if (result.value === RepositoryVisibility.Private) {\n\t\t\t\t\tisPrivate = true;\n\t\t\t\t}\n\n\t\t\t\tif (isPublic && isPrivate) break;\n\t\t\t}\n\n\t\t\tif (isPublic) return isPrivate ? RepositoriesVisibility.Mixed : RepositoriesVisibility.Public;\n\t\t\treturn RepositoriesVisibility.Private;\n\t\t}\n\n\t\treturn getRepoVisibility.call(this, repoPath);\n\t}\n\n\tprivate _context: { enabled: boolean; disabled: boolean } = { enabled: false, disabled: false };\n\n\tasync setEnabledContext(enabled: boolean): Promise<void> {\n\t\tlet disabled = !enabled;\n\t\t// If we think we should be disabled during startup, check if we have a saved value from the last time this repo was loaded\n\t\tif (!enabled && this._initializing) {\n\t\t\tdisabled = !(\n\t\t\t\tthis.container.storage.getWorkspace<boolean>(WorkspaceStorageKeys.AssumeRepositoriesOnStartup) ?? true\n\t\t\t);\n\t\t}\n\n\t\tif (this._context.enabled === enabled && this._context.disabled === disabled) return;\n\n\t\tconst promises = [];\n\n\t\tif (this._context.enabled !== enabled) {\n\t\t\tthis._context.enabled = enabled;\n\t\t\tpromises.push(setContext(ContextKeys.Enabled, enabled));\n\t\t}\n\n\t\tif (this._context.disabled !== disabled) {\n\t\t\tthis._context.disabled = disabled;\n\t\t\tpromises.push(setContext(ContextKeys.Disabled, disabled));\n\t\t}\n\n\t\tawait Promise.all(promises);\n\n\t\tif (!this._initializing) {\n\t\t\tvoid this.container.storage.storeWorkspace(WorkspaceStorageKeys.AssumeRepositoriesOnStartup, enabled);\n\t\t}\n\t}\n\n\tprivate updateContext() {\n\t\tconst hasRepositories = this.openRepositoryCount !== 0;\n\t\tvoid this.setEnabledContext(hasRepositories);\n\n\t\t// Don't bother trying to set the values if we're still starting up\n\t\tif (!hasRepositories && this._initializing) return;\n\n\t\t// Don't block for the remote context updates (because it can block other downstream requests during initialization)\n\t\tasync function updateRemoteContext(this: GitProviderService) {\n\t\t\tlet hasRemotes = false;\n\t\t\tlet hasRichRemotes = false;\n\t\t\tlet hasConnectedRemotes = false;\n\t\t\tif (hasRepositories) {\n\t\t\t\tfor (const repo of this._repositories.values()) {\n\t\t\t\t\tif (!hasConnectedRemotes) {\n\t\t\t\t\t\thasConnectedRemotes = await repo.hasRichRemote(true);\n\n\t\t\t\t\t\tif (hasConnectedRemotes) {\n\t\t\t\t\t\t\thasRichRemotes = true;\n\t\t\t\t\t\t\thasRemotes = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!hasRichRemotes) {\n\t\t\t\t\t\thasRichRemotes = await repo.hasRichRemote();\n\n\t\t\t\t\t\tif (hasRichRemotes) {\n\t\t\t\t\t\t\thasRemotes = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!hasRemotes) {\n\t\t\t\t\t\thasRemotes = await repo.hasRemotes();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (hasRemotes && hasRichRemotes && hasConnectedRemotes) break;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tawait Promise.all([\n\t\t\t\tsetContext(ContextKeys.HasRemotes, hasRemotes),\n\t\t\t\tsetContext(ContextKeys.HasRichRemotes, hasRichRemotes),\n\t\t\t\tsetContext(ContextKeys.HasConnectedRemotes, hasConnectedRemotes),\n\t\t\t]);\n\t\t}\n\n\t\tvoid updateRemoteContext.call(this);\n\n\t\tthis._providers.forEach(p => p.updateContext?.());\n\t}\n\n\t// private _pathToProvider = new Map<string, GitProviderResult>();\n\n\tprivate getProvider(repoPath: string | Uri): GitProviderResult {\n\t\tif (repoPath == null || (typeof repoPath !== 'string' && !this.supportedSchemes.has(repoPath.scheme))) {\n\t\t\tdebugger;\n\t\t\tthrow new ProviderNotFoundError(repoPath);\n\t\t}\n\n\t\tlet scheme;\n\t\tif (typeof repoPath === 'string') {\n\t\t\tscheme = getScheme(repoPath) ?? Schemes.File;\n\t\t} else {\n\t\t\t({ scheme } = repoPath);\n\t\t}\n\n\t\t// const key = repoPath.toString();\n\t\t// let providerResult = this._pathToProvider.get(key);\n\t\t// if (providerResult != null) return providerResult;\n\n\t\tfor (const provider of this._providers.values()) {\n\t\t\tconst path = provider.canHandlePathOrUri(scheme, repoPath);\n\t\t\tif (path == null) continue;\n\n\t\t\tconst providerResult: GitProviderResult = { provider: provider, path: path };\n\t\t\t// this._pathToProvider.set(key, providerResult);\n\t\t\treturn providerResult;\n\t\t}\n\n\t\tdebugger;\n\t\tthrow new ProviderNotFoundError(repoPath);\n\n\t\t// let id = !isWeb ? GitProviderId.Git : undefined;\n\t\t// if (typeof repoPath !== 'string' && repoPath.scheme === DocumentSchemes.Virtual) {\n\t\t// \tif (repoPath.authority.startsWith('github')) {\n\t\t// \t\tid = GitProviderId.GitHub;\n\t\t// \t} else {\n\t\t// \t\tthrow new ProviderNotFoundError(repoPath);\n\t\t// \t}\n\t\t// }\n\t\t// if (id == null) throw new ProviderNotFoundError(repoPath);\n\n\t\t// const provider = this._providers.get(id);\n\t\t// if (provider == null) throw new ProviderNotFoundError(repoPath);\n\n\t\t// switch (id) {\n\t\t// \tcase GitProviderId.Git:\n\t\t// \t\treturn {\n\t\t// \t\t\tprovider: provider,\n\t\t// \t\t\tpath: typeof repoPath === 'string' ? repoPath : repoPath.fsPath,\n\t\t// \t\t};\n\n\t\t// \tdefault:\n\t\t// \t\treturn {\n\t\t// \t\t\tprovider: provider,\n\t\t// \t\t\tpath: typeof repoPath === 'string' ? repoPath : repoPath.toString(),\n\t\t// \t\t};\n\t\t// }\n\t}\n\n\tgetAbsoluteUri(pathOrUri: string | Uri, base?: string | Uri): Uri {\n\t\tif (base == null) {\n\t\t\tif (typeof pathOrUri === 'string') {\n\t\t\t\tif (maybeUri(pathOrUri)) return Uri.parse(pathOrUri, true);\n\n\t\t\t\t// I think it is safe to assume this should be file://\n\t\t\t\treturn Uri.file(pathOrUri);\n\t\t\t}\n\n\t\t\treturn pathOrUri;\n\t\t}\n\n\t\t// Short-circuit if the base is already a Uri and the path is relative\n\t\tif (typeof base !== 'string' && typeof pathOrUri === 'string' && !isAbsolute(pathOrUri)) {\n\t\t\treturn Uri.joinPath(base, normalizePath(pathOrUri));\n\t\t}\n\n\t\tconst { provider } = this.getProvider(base);\n\t\treturn provider.getAbsoluteUri(pathOrUri, base);\n\t}\n\n\t@log()\n\tasync getBestRevisionUri(\n\t\trepoPath: string | Uri | undefined,\n\t\tpath: string,\n\t\tref: string | undefined,\n\t): Promise<Uri | undefined> {\n\t\tif (repoPath == null || ref === GitRevision.deletedOrMissing) return undefined;\n\n\t\tconst { provider, path: rp } = this.getProvider(repoPath);\n\t\treturn provider.getBestRevisionUri(rp, provider.getRelativePath(path, rp), ref);\n\t}\n\n\tgetRelativePath(pathOrUri: string | Uri, base: string | Uri): string {\n\t\tconst { provider } = this.getProvider(pathOrUri instanceof Uri ? pathOrUri : base);\n\t\treturn provider.getRelativePath(pathOrUri, base);\n\t}\n\n\tgetRevisionUri(uri: GitUri): Uri;\n\tgetRevisionUri(ref: string, path: string, repoPath: string): Uri;\n\tgetRevisionUri(ref: string, file: GitFile, repoPath: string): Uri;\n\t@log()\n\tgetRevisionUri(refOrUri: string | GitUri, pathOrFile?: string | GitFile, repoPath?: string): Uri {\n\t\tlet path: string;\n\t\tlet ref: string | undefined;\n\n\t\tif (typeof refOrUri === 'string') {\n\t\t\tref = refOrUri;\n\n\t\t\tif (typeof pathOrFile === 'string') {\n\t\t\t\tpath = pathOrFile;\n\t\t\t} else {\n\t\t\t\tpath = pathOrFile!.originalPath ?? pathOrFile!.path;\n\t\t\t}\n\t\t} else {\n\t\t\tref = refOrUri.sha;\n\t\t\trepoPath = refOrUri.repoPath!;\n\n\t\t\tpath = getBestPath(refOrUri);\n\t\t}\n\n\t\tconst { provider, path: rp } = this.getProvider(repoPath!);\n\t\treturn provider.getRevisionUri(rp, provider.getRelativePath(path, rp), ref!);\n\t}\n\n\t@log()\n\tasync getWorkingUri(repoPath: string | Uri, uri: Uri) {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getWorkingUri(path, uri);\n\t}\n\n\t@log()\n\taddRemote(repoPath: string | Uri, name: string, url: string): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.addRemote(path, name, url);\n\t}\n\n\t@log()\n\tpruneRemote(repoPath: string | Uri, remoteName: string): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.pruneRemote(path, remoteName);\n\t}\n\n\t@log()\n\tasync applyChangesToWorkingFile(uri: GitUri, ref1?: string, ref2?: string): Promise<void> {\n\t\tconst { provider } = this.getProvider(uri);\n\t\treturn provider.applyChangesToWorkingFile(uri, ref1, ref2);\n\t}\n\n\t@log()\n\tasync checkout(\n\t\trepoPath: string,\n\t\tref: string,\n\t\toptions?: { createBranch?: string } | { fileName?: string },\n\t): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.checkout(path, ref, options);\n\t}\n\n\t@log()\n\tresetCaches(\n\t\t...affects: ('branches' | 'contributors' | 'providers' | 'remotes' | 'stashes' | 'status' | 'tags')[]\n\t): void {\n\t\tif (affects.length === 0 || affects.includes('providers')) {\n\t\t\tthis._richRemotesCache.clear();\n\t\t}\n\n\t\tconst repoAffects = affects.filter((c): c is 'branches' | 'remotes' => c === 'branches' || c === 'remotes');\n\t\t// Delegate to the repos, if we are clearing everything or one of the per-repo caches\n\t\tif (affects.length === 0 || repoAffects.length > 0) {\n\t\t\tfor (const repo of this.repositories) {\n\t\t\t\trepo.resetCaches(...repoAffects);\n\t\t\t}\n\t\t}\n\n\t\tfor (const provider of this._providers.values()) {\n\t\t\tprovider.resetCaches(...affects);\n\t\t}\n\t}\n\n\t@log<GitProviderService['excludeIgnoredUris']>({ args: { 1: uris => uris.length } })\n\tasync excludeIgnoredUris(repoPath: string, uris: Uri[]): Promise<Uri[]> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.excludeIgnoredUris(path, uris);\n\t}\n\n\t@gate()\n\t@log()\n\tasync fetch(\n\t\trepoPath: string,\n\t\toptions?: { all?: boolean; branch?: GitBranchReference; prune?: boolean; pull?: boolean; remote?: string },\n\t): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.fetch(path, options);\n\t}\n\n\t@gate<GitProviderService['fetchAll']>(\n\t\t(repos, opts) => `${repos == null ? '' : repos.map(r => r.id).join(',')}|${JSON.stringify(opts)}`,\n\t)\n\t@log<GitProviderService['fetchAll']>({ args: { 0: repos => repos?.map(r => r.name).join(', ') } })\n\tasync fetchAll(repositories?: Repository[], options?: { all?: boolean; prune?: boolean }) {\n\t\tif (repositories == null) {\n\t\t\trepositories = this.openRepositories;\n\t\t}\n\t\tif (repositories.length === 0) return;\n\n\t\tif (repositories.length === 1) {\n\t\t\tawait repositories[0].fetch(options);\n\n\t\t\treturn;\n\t\t}\n\n\t\tawait window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Fetching ${repositories.length} repositories`,\n\t\t\t},\n\t\t\t() => Promise.all(repositories!.map(r => r.fetch({ progress: false, ...options }))),\n\t\t);\n\t}\n\n\t@gate<GitProviderService['pullAll']>(\n\t\t(repos, opts) => `${repos == null ? '' : repos.map(r => r.id).join(',')}|${JSON.stringify(opts)}`,\n\t)\n\t@log<GitProviderService['pullAll']>({ args: { 0: repos => repos?.map(r => r.name).join(', ') } })\n\tasync pullAll(repositories?: Repository[], options?: { rebase?: boolean }) {\n\t\tif (repositories == null) {\n\t\t\trepositories = this.openRepositories;\n\t\t}\n\t\tif (repositories.length === 0) return;\n\n\t\tif (repositories.length === 1) {\n\t\t\tawait repositories[0].pull(options);\n\n\t\t\treturn;\n\t\t}\n\n\t\tawait window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Pulling ${repositories.length} repositories`,\n\t\t\t},\n\t\t\t() => Promise.all(repositories!.map(r => r.pull({ progress: false, ...options }))),\n\t\t);\n\t}\n\n\t@gate<GitProviderService['pushAll']>(repos => `${repos == null ? '' : repos.map(r => r.id).join(',')}`)\n\t@log<GitProviderService['pushAll']>({ args: { 0: repos => repos?.map(r => r.name).join(', ') } })\n\tasync pushAll(\n\t\trepositories?: Repository[],\n\t\toptions?: {\n\t\t\tforce?: boolean;\n\t\t\treference?: GitReference;\n\t\t\tpublish?: {\n\t\t\t\tremote: string;\n\t\t\t};\n\t\t},\n\t) {\n\t\tif (repositories == null) {\n\t\t\trepositories = this.openRepositories;\n\t\t}\n\t\tif (repositories.length === 0) return;\n\n\t\tif (repositories.length === 1) {\n\t\t\tawait repositories[0].push(options);\n\n\t\t\treturn;\n\t\t}\n\n\t\tawait window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Pushing ${repositories.length} repositories`,\n\t\t\t},\n\t\t\t() => Promise.all(repositories!.map(r => r.push({ progress: false, ...options }))),\n\t\t);\n\t}\n\n\t@log<GitProviderService['getAheadBehindCommitCount']>({ args: { 1: refs => refs.join(',') } })\n\tgetAheadBehindCommitCount(\n\t\trepoPath: string | Uri,\n\t\trefs: string[],\n\t): Promise<{ ahead: number; behind: number } | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getAheadBehindCommitCount(path, refs);\n\t}\n\n\t@log()\n\t/**\n\t * Returns the blame of a file\n\t * @param uri Uri of the file to blame\n\t * @param document Optional TextDocument to blame the contents of if dirty\n\t */\n\tasync getBlame(uri: GitUri, document?: TextDocument | undefined): Promise<GitBlame | undefined> {\n\t\tconst { provider } = this.getProvider(uri);\n\t\treturn provider.getBlame(uri, document);\n\t}\n\n\t@log<GitProviderService['getBlameContents']>({ args: { 1: '<contents>' } })\n\t/**\n\t * Returns the blame of a file, using the editor contents (for dirty editors)\n\t * @param uri Uri of the file to blame\n\t * @param contents Contents from the editor to use\n\t */\n\tasync getBlameContents(uri: GitUri, contents: string): Promise<GitBlame | undefined> {\n\t\tconst { provider } = this.getProvider(uri);\n\t\treturn provider.getBlameContents(uri, contents);\n\t}\n\n\t@log()\n\t/**\n\t * Returns the blame of a single line\n\t * @param uri Uri of the file to blame\n\t * @param editorLine Editor line number (0-based) to blame (Git is 1-based)\n\t * @param document Optional TextDocument to blame the contents of if dirty\n\t * @param options.forceSingleLine Forces blame to be for the single line (rather than the whole file)\n\t */\n\tasync getBlameForLine(\n\t\turi: GitUri,\n\t\teditorLine: number,\n\t\tdocument?: TextDocument | undefined,\n\t\toptions?: { forceSingleLine?: boolean },\n\t): Promise<GitBlameLine | undefined> {\n\t\tconst { provider } = this.getProvider(uri);\n\t\treturn provider.getBlameForLine(uri, editorLine, document, options);\n\t}\n\n\t@log<GitProviderService['getBlameForLineContents']>({ args: { 2: '<contents>' } })\n\t/**\n\t * Returns the blame of a single line, using the editor contents (for dirty editors)\n\t * @param uri Uri of the file to blame\n\t * @param editorLine Editor line number (0-based) to blame (Git is 1-based)\n\t * @param contents Contents from the editor to use\n\t * @param options.forceSingleLine Forces blame to be for the single line (rather than the whole file)\n\t */\n\tasync getBlameForLineContents(\n\t\turi: GitUri,\n\t\teditorLine: number,\n\t\tcontents: string,\n\t\toptions?: { forceSingleLine?: boolean },\n\t): Promise<GitBlameLine | undefined> {\n\t\tconst { provider } = this.getProvider(uri);\n\t\treturn provider.getBlameForLineContents(uri, editorLine, contents, options);\n\t}\n\n\t@log()\n\tasync getBlameForRange(uri: GitUri, range: Range): Promise<GitBlameLines | undefined> {\n\t\tconst { provider } = this.getProvider(uri);\n\t\treturn provider.getBlameForRange(uri, range);\n\t}\n\n\t@log<GitProviderService['getBlameForRangeContents']>({ args: { 2: '<contents>' } })\n\tasync getBlameForRangeContents(uri: GitUri, range: Range, contents: string): Promise<GitBlameLines | undefined> {\n\t\tconst { provider } = this.getProvider(uri);\n\t\treturn provider.getBlameForRangeContents(uri, range, contents);\n\t}\n\n\t@log<GitProviderService['getBlameRange']>({ args: { 0: '<blame>' } })\n\tgetBlameRange(blame: GitBlame, uri: GitUri, range: Range): GitBlameLines | undefined {\n\t\tconst { provider } = this.getProvider(uri);\n\t\treturn provider.getBlameRange(blame, uri, range);\n\t}\n\n\t@log()\n\tasync getBranch(repoPath: string | Uri | undefined): Promise<GitBranch | undefined> {\n\t\tif (repoPath == null) return undefined;\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getBranch(path);\n\t}\n\n\t@log<GitProviderService['getBranchAheadRange']>({ args: { 0: b => b.name } })\n\tasync getBranchAheadRange(branch: GitBranch): Promise<string | undefined> {\n\t\tif (branch.state.ahead > 0) {\n\t\t\treturn GitRevision.createRange(branch.upstream?.name, branch.ref);\n\t\t}\n\n\t\tif (branch.upstream == null) {\n\t\t\t// If we have no upstream branch, try to find a best guess branch to use as the \"base\"\n\t\t\tconst { values: branches } = await this.getBranches(branch.repoPath, {\n\t\t\t\tfilter: b => weightedDefaultBranches.has(b.name),\n\t\t\t});\n\t\t\tif (branches.length > 0) {\n\t\t\t\tlet weightedBranch: { weight: number; branch: GitBranch } | undefined;\n\t\t\t\tfor (const branch of branches) {\n\t\t\t\t\tconst weight = weightedDefaultBranches.get(branch.name)!;\n\t\t\t\t\tif (weightedBranch == null || weightedBranch.weight < weight) {\n\t\t\t\t\t\tweightedBranch = { weight: weight, branch: branch };\n\t\t\t\t\t}\n\n\t\t\t\t\tif (weightedBranch.weight === maxDefaultBranchWeight) break;\n\t\t\t\t}\n\n\t\t\t\tconst possibleBranch = weightedBranch!.branch.upstream?.name ?? weightedBranch!.branch.ref;\n\t\t\t\tif (possibleBranch !== branch.ref) {\n\t\t\t\t\treturn GitRevision.createRange(possibleBranch, branch.ref);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\t@log({ args: { 1: false } })\n\tasync getBranches(\n\t\trepoPath: string | Uri | undefined,\n\t\toptions?: {\n\t\t\tfilter?: (b: GitBranch) => boolean;\n\t\t\tsort?: boolean | BranchSortOptions;\n\t\t},\n\t): Promise<PagedResult<GitBranch>> {\n\t\tif (repoPath == null) return { values: [] };\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getBranches(path, options);\n\t}\n\n\t@log()\n\tasync getBranchesAndTagsTipsFn(\n\t\trepoPath: string | Uri | undefined,\n\t\tcurrentName?: string,\n\t): Promise<\n\t\t(sha: string, options?: { compact?: boolean | undefined; icons?: boolean | undefined }) => string | undefined\n\t> {\n\t\tconst [{ values: branches }, { values: tags }] = await Promise.all([\n\t\t\tthis.getBranches(repoPath),\n\t\t\tthis.getTags(repoPath),\n\t\t]);\n\n\t\tconst branchesAndTagsBySha = groupByFilterMap(\n\t\t\t(branches as (GitBranch | GitTag)[]).concat(tags as (GitBranch | GitTag)[]),\n\t\t\tbt => bt.sha,\n\t\t\tbt => {\n\t\t\t\tif (currentName) {\n\t\t\t\t\tif (bt.name === currentName) return undefined;\n\t\t\t\t\tif (bt.refType === 'branch' && bt.getNameWithoutRemote() === currentName) {\n\t\t\t\t\t\treturn { name: bt.name, compactName: bt.getRemoteName(), type: bt.refType };\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn { name: bt.name, compactName: undefined, type: bt.refType };\n\t\t\t},\n\t\t);\n\n\t\treturn (sha: string, options?: { compact?: boolean; icons?: boolean }): string | undefined => {\n\t\t\tconst branchesAndTags = branchesAndTagsBySha.get(sha);\n\t\t\tif (branchesAndTags == null || branchesAndTags.length === 0) return undefined;\n\n\t\t\tif (!options?.compact) {\n\t\t\t\treturn branchesAndTags\n\t\t\t\t\t.map(\n\t\t\t\t\t\tbt => `${options?.icons ? `${bt.type === 'tag' ? '$(tag)' : '$(git-branch)'} ` : ''}${bt.name}`,\n\t\t\t\t\t)\n\t\t\t\t\t.join(', ');\n\t\t\t}\n\n\t\t\tif (branchesAndTags.length > 1) {\n\t\t\t\tconst [bt] = branchesAndTags;\n\t\t\t\treturn `${options?.icons ? `${bt.type === 'tag' ? '$(tag)' : '$(git-branch)'} ` : ''}${\n\t\t\t\t\tbt.compactName ?? bt.name\n\t\t\t\t}, ${GlyphChars.Ellipsis}`;\n\t\t\t}\n\n\t\t\treturn branchesAndTags\n\t\t\t\t.map(\n\t\t\t\t\tbt =>\n\t\t\t\t\t\t`${options?.icons ? `${bt.type === 'tag' ? '$(tag)' : '$(git-branch)'} ` : ''}${\n\t\t\t\t\t\t\tbt.compactName ?? bt.name\n\t\t\t\t\t\t}`,\n\t\t\t\t)\n\t\t\t\t.join(', ');\n\t\t};\n\t}\n\n\t@log()\n\tgetChangedFilesCount(repoPath: string | Uri, ref?: string): Promise<GitDiffShortStat | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getChangedFilesCount(path, ref);\n\t}\n\n\t@log()\n\tgetCommit(repoPath: string | Uri, ref: string): Promise<GitCommit | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getCommit(path, ref);\n\t}\n\n\t@log()\n\tgetCommitBranches(\n\t\trepoPath: string | Uri,\n\t\tref: string,\n\t\toptions?: { branch?: string; commitDate?: Date; mode?: 'contains' | 'pointsAt'; remotes?: boolean },\n\t): Promise<string[]> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getCommitBranches(path, ref, options);\n\t}\n\n\t@log()\n\tgetCommitCount(repoPath: string | Uri, ref: string): Promise<number | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getCommitCount(path, ref);\n\t}\n\n\t@log()\n\tasync getCommitForFile(\n\t\trepoPath: string | Uri | undefined,\n\t\turi: Uri,\n\t\toptions?: { ref?: string; firstIfNotFound?: boolean; range?: Range },\n\t): Promise<GitCommit | undefined> {\n\t\tif (repoPath == null) return undefined;\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getCommitForFile(path, uri, options);\n\t}\n\n\t@log()\n\tasync getOldestUnpushedRefForFile(repoPath: string | Uri, uri: Uri): Promise<string | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getOldestUnpushedRefForFile(path, uri);\n\t}\n\n\t@log()\n\tasync getContributors(\n\t\trepoPath: string | Uri,\n\t\toptions?: { all?: boolean; ref?: string; stats?: boolean },\n\t): Promise<GitContributor[]> {\n\t\tif (repoPath == null) return [];\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getContributors(path, options);\n\t}\n\n\t@gate()\n\t@log()\n\tasync getCurrentUser(repoPath: string | Uri): Promise<GitUser | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getCurrentUser(path);\n\t}\n\n\t@log()\n\tasync getDefaultBranchName(repoPath: string | Uri | undefined, remote?: string): Promise<string | undefined> {\n\t\tif (repoPath == null) return undefined;\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getDefaultBranchName(path, remote);\n\t}\n\n\t@log()\n\t/**\n\t * Returns a file diff between two commits\n\t * @param uri Uri of the file to diff\n\t * @param ref1 Commit to diff from\n\t * @param ref2 Commit to diff to\n\t */\n\tasync getDiffForFile(uri: GitUri, ref1: string | undefined, ref2?: string): Promise<GitDiff | undefined> {\n\t\tconst { provider } = this.getProvider(uri);\n\t\treturn provider.getDiffForFile(uri, ref1, ref2);\n\t}\n\n\t@log<GitProviderService['getDiffForFileContents']>({ args: { 1: '<contents>' } })\n\t/**\n\t * Returns a file diff between a commit and the specified contents\n\t * @param uri Uri of the file to diff\n\t * @param ref Commit to diff from\n\t * @param contents Contents to use for the diff\n\t */\n\tasync getDiffForFileContents(uri: GitUri, ref: string, contents: string): Promise<GitDiff | undefined> {\n\t\tconst { provider } = this.getProvider(uri);\n\t\treturn provider.getDiffForFileContents(uri, ref, contents);\n\t}\n\n\t@log()\n\t/**\n\t * Returns a line diff between two commits\n\t * @param uri Uri of the file to diff\n\t * @param editorLine Editor line number (0-based) to blame (Git is 1-based)\n\t * @param ref1 Commit to diff from\n\t * @param ref2 Commit to diff to\n\t */\n\tasync getDiffForLine(\n\t\turi: GitUri,\n\t\teditorLine: number,\n\t\tref1: string | undefined,\n\t\tref2?: string,\n\t): Promise<GitDiffHunkLine | undefined> {\n\t\tconst { provider } = this.getProvider(uri);\n\t\treturn provider.getDiffForLine(uri, editorLine, ref1, ref2);\n\t}\n\n\t@log()\n\tasync getDiffStatus(\n\t\trepoPath: string | Uri,\n\t\tref1?: string,\n\t\tref2?: string,\n\t\toptions?: { filters?: GitDiffFilter[]; similarityThreshold?: number },\n\t): Promise<GitFile[] | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getDiffStatus(path, ref1, ref2, options);\n\t}\n\n\t@log()\n\tasync getFileStatusForCommit(repoPath: string | Uri, uri: Uri, ref: string): Promise<GitFile | undefined> {\n\t\tif (ref === GitRevision.deletedOrMissing || GitRevision.isUncommitted(ref)) return undefined;\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getFileStatusForCommit(path, uri, ref);\n\t}\n\n\t@debug()\n\tgetLastFetchedTimestamp(repoPath: string | Uri): Promise<number | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getLastFetchedTimestamp(path);\n\t}\n\n\t@log()\n\tasync getLog(\n\t\trepoPath: string | Uri,\n\t\toptions?: {\n\t\t\tall?: boolean;\n\t\t\tauthors?: GitUser[];\n\t\t\tlimit?: number;\n\t\t\tmerges?: boolean;\n\t\t\tordering?: string | null;\n\t\t\tref?: string;\n\t\t\tsince?: string;\n\t\t},\n\t): Promise<GitLog | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getLog(path, options);\n\t}\n\n\t@log()\n\tasync getLogRefsOnly(\n\t\trepoPath: string | Uri,\n\t\toptions?: {\n\t\t\tauthors?: GitUser[];\n\t\t\tlimit?: number;\n\t\t\tmerges?: boolean;\n\t\t\tordering?: string | null;\n\t\t\tref?: string;\n\t\t\tsince?: string;\n\t\t},\n\t): Promise<Set<string> | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getLogRefsOnly(path, options);\n\t}\n\n\t@log()\n\tasync getLogForSearch(\n\t\trepoPath: string | Uri,\n\t\tsearch: SearchPattern,\n\t\toptions?: { limit?: number; ordering?: 'date' | 'author-date' | 'topo' | null; skip?: number },\n\t): Promise<GitLog | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getLogForSearch(path, search, options);\n\t}\n\n\t@log()\n\tasync getLogForFile(\n\t\trepoPath: string | Uri | undefined,\n\t\tpathOrUri: string | Uri,\n\t\toptions?: {\n\t\t\tall?: boolean;\n\t\t\tforce?: boolean;\n\t\t\tlimit?: number;\n\t\t\tordering?: string | null;\n\t\t\trange?: Range;\n\t\t\tref?: string;\n\t\t\trenames?: boolean;\n\t\t\treverse?: boolean;\n\t\t\tsince?: string;\n\t\t\tskip?: number;\n\t\t},\n\t): Promise<GitLog | undefined> {\n\t\tif (repoPath == null) return undefined;\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getLogForFile(path, pathOrUri, options);\n\t}\n\n\t@log()\n\tasync getMergeBase(\n\t\trepoPath: string | Uri,\n\t\tref1: string,\n\t\tref2: string,\n\t\toptions?: { forkPoint?: boolean },\n\t): Promise<string | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getMergeBase(path, ref1, ref2, options);\n\t}\n\n\t@gate()\n\t@log()\n\tasync getMergeStatus(repoPath: string | Uri): Promise<GitMergeStatus | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getMergeStatus(path);\n\t}\n\n\t@gate()\n\t@log()\n\tasync getRebaseStatus(repoPath: string | Uri): Promise<GitRebaseStatus | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getRebaseStatus(path);\n\t}\n\n\t@log()\n\tgetNextComparisonUris(\n\t\trepoPath: string | Uri,\n\t\turi: Uri,\n\t\tref: string | undefined,\n\t\tskip: number = 0,\n\t): Promise<NextComparisionUrisResult | undefined> {\n\t\tif (!ref) return Promise.resolve(undefined);\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getNextComparisonUris(path, uri, ref, skip);\n\t}\n\n\t@log()\n\tgetPreviousComparisonUris(\n\t\trepoPath: string | Uri,\n\t\turi: Uri,\n\t\tref: string | undefined,\n\t\tskip: number = 0,\n\t\tfirstParent: boolean = false,\n\t): Promise<PreviousComparisionUrisResult | undefined> {\n\t\tif (ref === GitRevision.deletedOrMissing) return Promise.resolve(undefined);\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getPreviousComparisonUris(path, uri, ref, skip, firstParent);\n\t}\n\n\t@log()\n\tgetPreviousComparisonUrisForLine(\n\t\trepoPath: string | Uri,\n\t\turi: Uri,\n\t\teditorLine: number,\n\t\tref: string | undefined,\n\t\tskip: number = 0,\n\t): Promise<PreviousLineComparisionUrisResult | undefined> {\n\t\tif (ref === GitRevision.deletedOrMissing) return Promise.resolve(undefined);\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getPreviousComparisonUrisForLine(path, uri, editorLine, ref, skip);\n\t}\n\n\tasync getPullRequestForBranch(\n\t\tbranch: string,\n\t\tremote: GitRemote,\n\t\toptions?: { avatarSize?: number; include?: PullRequestState[]; limit?: number; timeout?: number },\n\t): Promise<PullRequest | undefined>;\n\tasync getPullRequestForBranch(\n\t\tbranch: string,\n\t\tprovider: RichRemoteProvider,\n\t\toptions?: { avatarSize?: number; include?: PullRequestState[]; limit?: number; timeout?: number },\n\t): Promise<PullRequest | undefined>;\n\t@gate<GitProviderService['getPullRequestForBranch']>((branch, remoteOrProvider, options) => {\n\t\tconst provider = GitRemote.is(remoteOrProvider) ? remoteOrProvider.provider : remoteOrProvider;\n\t\treturn `${branch}${\n\t\t\tprovider != null ? `|${provider.id}:${provider.domain}/${provider.path}` : ''\n\t\t}|${JSON.stringify(options)}`;\n\t})\n\t@debug<GitProviderService['getPullRequestForBranch']>({ args: { 1: remoteOrProvider => remoteOrProvider.name } })\n\tasync getPullRequestForBranch(\n\t\tbranch: string,\n\t\tremoteOrProvider: GitRemote | RichRemoteProvider,\n\t\toptions?: { avatarSize?: number; include?: PullRequestState[]; limit?: number; timeout?: number },\n\t): Promise<PullRequest | undefined> {\n\t\tlet provider;\n\t\tif (GitRemote.is(remoteOrProvider)) {\n\t\t\t({ provider } = remoteOrProvider);\n\t\t\tif (!provider?.hasRichApi()) return undefined;\n\t\t} else {\n\t\t\tprovider = remoteOrProvider;\n\t\t}\n\n\t\tlet timeout;\n\t\tif (options != null) {\n\t\t\t({ timeout, ...options } = options);\n\t\t}\n\n\t\tlet promiseOrPR = provider.getPullRequestForBranch(branch, options);\n\t\tif (promiseOrPR == null || !isPromise(promiseOrPR)) {\n\t\t\treturn promiseOrPR;\n\t\t}\n\n\t\tif (timeout != null && timeout > 0) {\n\t\t\tpromiseOrPR = cancellable(promiseOrPR, timeout);\n\t\t}\n\n\t\ttry {\n\t\t\treturn await promiseOrPR;\n\t\t} catch (ex) {\n\t\t\tif (ex instanceof PromiseCancelledError) throw ex;\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tasync getPullRequestForCommit(\n\t\tref: string,\n\t\tremote: GitRemote,\n\t\toptions?: { timeout?: number },\n\t): Promise<PullRequest | undefined>;\n\tasync getPullRequestForCommit(\n\t\tref: string,\n\t\tprovider: RichRemoteProvider,\n\t\toptions?: { timeout?: number },\n\t): Promise<PullRequest | undefined>;\n\t@gate<GitProviderService['getPullRequestForCommit']>((ref, remoteOrProvider, options) => {\n\t\tconst provider = GitRemote.is(remoteOrProvider) ? remoteOrProvider.provider : remoteOrProvider;\n\t\treturn `${ref}${provider != null ? `|${provider.id}:${provider.domain}/${provider.path}` : ''}|${\n\t\t\toptions?.timeout\n\t\t}`;\n\t})\n\t@debug<GitProviderService['getPullRequestForCommit']>({ args: { 1: remoteOrProvider => remoteOrProvider.name } })\n\tasync getPullRequestForCommit(\n\t\tref: string,\n\t\tremoteOrProvider: GitRemote | RichRemoteProvider,\n\t\toptions?: { timeout?: number },\n\t): Promise<PullRequest | undefined> {\n\t\tif (GitRevision.isUncommitted(ref)) return undefined;\n\n\t\tlet provider;\n\t\tif (GitRemote.is(remoteOrProvider)) {\n\t\t\t({ provider } = remoteOrProvider);\n\t\t\tif (!provider?.hasRichApi()) return undefined;\n\t\t} else {\n\t\t\tprovider = remoteOrProvider;\n\t\t}\n\n\t\tlet promiseOrPR = provider.getPullRequestForCommit(ref);\n\t\tif (promiseOrPR == null || !isPromise(promiseOrPR)) {\n\t\t\treturn promiseOrPR;\n\t\t}\n\n\t\tif (options?.timeout != null && options.timeout > 0) {\n\t\t\tpromiseOrPR = cancellable(promiseOrPR, options.timeout);\n\t\t}\n\n\t\ttry {\n\t\t\treturn await promiseOrPR;\n\t\t} catch (ex) {\n\t\t\tif (ex instanceof PromiseCancelledError) throw ex;\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t@log()\n\tasync getIncomingActivity(\n\t\trepoPath: string | Uri,\n\t\toptions?: { all?: boolean; branch?: string; limit?: number; ordering?: string | null; skip?: number },\n\t): Promise<GitReflog | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getIncomingActivity(path, options);\n\t}\n\n\tasync getRichRemoteProvider(\n\t\trepoPath: string | Uri | undefined,\n\t\toptions?: { includeDisconnected?: boolean },\n\t): Promise<GitRemote<RichRemoteProvider> | undefined>;\n\tasync getRichRemoteProvider(\n\t\tremotes: GitRemote[],\n\t\toptions?: { includeDisconnected?: boolean },\n\t): Promise<GitRemote<RichRemoteProvider> | undefined>;\n\t@gate<GitProviderService['getRichRemoteProvider']>(\n\t\t(remotesOrRepoPath, options) =>\n\t\t\t`${\n\t\t\t\tremotesOrRepoPath == null || typeof remotesOrRepoPath === 'string'\n\t\t\t\t\t? remotesOrRepoPath\n\t\t\t\t\t: remotesOrRepoPath instanceof Uri\n\t\t\t\t\t? remotesOrRepoPath.toString()\n\t\t\t\t\t: `${remotesOrRepoPath[0]?.repoPath}|${remotesOrRepoPath?.map(r => r.id).join(',') ?? ''}`\n\t\t\t}|${options?.includeDisconnected ?? false}`,\n\t)\n\t@log<GitProviderService['getRichRemoteProvider']>({\n\t\targs: {\n\t\t\t0: remotesOrRepoPath =>\n\t\t\t\tArray.isArray(remotesOrRepoPath) ? remotesOrRepoPath.map(r => r.name).join(',') : remotesOrRepoPath,\n\t\t},\n\t})\n\tasync getRichRemoteProvider(\n\t\tremotesOrRepoPath: GitRemote[] | string | Uri | undefined,\n\t\toptions?: { includeDisconnected?: boolean },\n\t): Promise<GitRemote<RichRemoteProvider> | undefined> {\n\t\tif (remotesOrRepoPath == null) return undefined;\n\n\t\tlet remotes;\n\t\tif (Array.isArray(remotesOrRepoPath)) {\n\t\t\tif (remotesOrRepoPath.length === 0) return undefined;\n\n\t\t\tremotes = remotesOrRepoPath;\n\t\t\tremotesOrRepoPath = remotesOrRepoPath[0].repoPath;\n\t\t}\n\n\t\tif (typeof remotesOrRepoPath === 'string') {\n\t\t\tremotesOrRepoPath = this.getAbsoluteUri(remotesOrRepoPath);\n\t\t}\n\n\t\tconst cacheKey = asRepoComparisonKey(remotesOrRepoPath);\n\n\t\tlet richRemote = this._richRemotesCache.get(cacheKey);\n\t\tif (richRemote != null) return richRemote;\n\t\tif (richRemote === null && !options?.includeDisconnected) return undefined;\n\n\t\tif (options?.includeDisconnected) {\n\t\t\trichRemote = this._richRemotesCache.get(`disconnected|${cacheKey}`);\n\t\t\tif (richRemote !== undefined) return richRemote ?? undefined;\n\t\t}\n\n\t\tremotes = (remotes ?? (await this.getRemotesWithProviders(remotesOrRepoPath))).filter(\n\t\t\t(\n\t\t\t\tr: GitRemote<RemoteProvider | RichRemoteProvider | undefined>,\n\t\t\t): r is GitRemote<RemoteProvider | RichRemoteProvider> => r.provider != null,\n\t\t);\n\n\t\tif (remotes.length === 0) return undefined;\n\n\t\tlet remote;\n\t\tif (remotes.length === 1) {\n\t\t\tremote = remotes[0];\n\t\t} else {\n\t\t\tconst weightedRemotes = new Map<string, number>([\n\t\t\t\t['upstream', 15],\n\t\t\t\t['origin', 10],\n\t\t\t]);\n\n\t\t\tconst branch = await this.getBranch(remotes[0].repoPath);\n\t\t\tconst branchRemote = branch?.getRemoteName();\n\n\t\t\tif (branchRemote != null) {\n\t\t\t\tweightedRemotes.set(branchRemote, 100);\n\t\t\t}\n\n\t\t\tlet bestRemote;\n\t\t\tlet weight = 0;\n\t\t\tfor (const r of remotes) {\n\t\t\t\tif (r.default) {\n\t\t\t\t\tbestRemote = r;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Don't choose a remote unless its weighted above\n\t\t\t\tconst matchedWeight = weightedRemotes.get(r.name) ?? -1;\n\t\t\t\tif (matchedWeight > weight) {\n\t\t\t\t\tbestRemote = r;\n\t\t\t\t\tweight = matchedWeight;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tremote = bestRemote ?? null;\n\t\t}\n\n\t\tif (!remote?.hasRichProvider()) {\n\t\t\tthis._richRemotesCache.set(cacheKey, null);\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { provider } = remote;\n\t\tconst connected = provider.maybeConnected ?? (await provider.isConnected());\n\t\tif (connected) {\n\t\t\tthis._richRemotesCache.set(cacheKey, remote);\n\t\t} else {\n\t\t\tthis._richRemotesCache.set(cacheKey, null);\n\t\t\tthis._richRemotesCache.set(`disconnected|${cacheKey}`, remote);\n\n\t\t\tif (!options?.includeDisconnected) return undefined;\n\t\t}\n\n\t\treturn remote;\n\t}\n\n\t@log({ args: { 1: false } })\n\tasync getRemotes(\n\t\trepoPath: string | Uri | undefined,\n\t\toptions?: { providers?: RemoteProviders; sort?: boolean },\n\t): Promise<GitRemote<RemoteProvider | RichRemoteProvider | undefined>[]> {\n\t\tif (repoPath == null) return [];\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getRemotes(path, options);\n\t}\n\n\t@log()\n\tasync getRemotesWithProviders(\n\t\trepoPath: string | Uri | undefined,\n\t\toptions?: { sort?: boolean },\n\t): Promise<GitRemote<RemoteProvider | RichRemoteProvider>[]> {\n\t\tif (repoPath == null) return [];\n\n\t\tconst repository = this.container.git.getRepository(repoPath);\n\t\tconst remotes = await (repository != null\n\t\t\t? repository.getRemotes(options)\n\t\t\t: this.getRemotes(repoPath, options));\n\n\t\treturn remotes.filter(r => r.provider != null) as GitRemote<RemoteProvider | RichRemoteProvider>[];\n\t}\n\n\tgetBestRepository(): Repository | undefined;\n\tgetBestRepository(uri?: Uri): Repository | undefined;\n\tgetBestRepository(editor?: TextEditor): Repository | undefined;\n\tgetBestRepository(uri?: TextEditor | Uri, editor?: TextEditor): Repository | undefined;\n\t@log<GitProviderService['getBestRepository']>({ exit: r => `returned ${r?.path}` })\n\tgetBestRepository(editorOrUri?: TextEditor | Uri, editor?: TextEditor): Repository | undefined {\n\t\tif (this.repositoryCount === 0) return undefined;\n\n\t\tif (editorOrUri != null && editorOrUri instanceof Uri) {\n\t\t\tconst repo = this.getRepository(editorOrUri);\n\t\t\tif (repo != null) return repo;\n\n\t\t\teditorOrUri = undefined;\n\t\t}\n\n\t\teditor = editorOrUri ?? editor ?? window.activeTextEditor;\n\t\treturn (editor != null ? this.getRepository(editor.document.uri) : undefined) ?? this.highlander;\n\t}\n\n\t@log<GitProviderService['getOrOpenRepository']>({ exit: r => `returned ${r?.path}` })\n\tasync getOrOpenRepository(uri: Uri, detectNested?: boolean): Promise<Repository | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst folderPath = dirname(getBestPath(uri));\n\t\tconst repository = this.getRepository(uri);\n\n\t\tdetectNested = detectNested ?? configuration.get('detectNestedRepositories');\n\t\tif (!detectNested) {\n\t\t\tif (repository != null) return repository;\n\t\t} else if (this._visitedPaths.has(folderPath)) {\n\t\t\treturn repository;\n\t\t}\n\n\t\tconst key = asRepoComparisonKey(uri);\n\t\tlet promise = this._pendingRepositories.get(key);\n\t\tif (promise == null) {\n\t\t\tasync function findRepository(this: GitProviderService): Promise<Repository | undefined> {\n\t\t\t\tconst { provider } = this.getProvider(uri);\n\t\t\t\tconst repoUri = await provider.findRepositoryUri(uri);\n\n\t\t\t\tthis._visitedPaths.set(folderPath);\n\n\t\t\t\tif (repoUri == null) return undefined;\n\n\t\t\t\tlet repository = this._repositories.get(repoUri);\n\t\t\t\tif (repository != null) return repository;\n\n\t\t\t\t// If this new repo is inside one of our known roots and we we don't already know about, add it\n\t\t\t\tconst root = this._repositories.getClosest(provider.getAbsoluteUri(uri, repoUri));\n\n\t\t\t\tLogger.log(cc, `Repository found in '${repoUri.toString(false)}'`);\n\t\t\t\trepository = provider.openRepository(root?.folder, repoUri, false);\n\t\t\t\tthis._repositories.add(repository);\n\n\t\t\t\tthis._pendingRepositories.delete(key);\n\n\t\t\t\tthis.updateContext();\n\t\t\t\t// Send a notification that the repositories changed\n\t\t\t\tqueueMicrotask(() => this.fireRepositoriesChanged([repository!]));\n\n\t\t\t\treturn repository;\n\t\t\t}\n\n\t\t\tpromise = findRepository.call(this);\n\t\t\tthis._pendingRepositories.set(key, promise);\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\t@log<GitProviderService['getOrOpenRepositoryForEditor']>({\n\t\targs: { 0: e => (e != null ? `TextEditor(${Logger.toLoggable(e.document.uri)})` : undefined) },\n\t})\n\tasync getOrOpenRepositoryForEditor(editor?: TextEditor): Promise<Repository | undefined> {\n\t\teditor = editor ?? window.activeTextEditor;\n\n\t\tif (editor == null) return this.highlander;\n\n\t\treturn this.getOrOpenRepository(editor.document.uri);\n\t}\n\n\tgetRepository(uri: Uri): Repository | undefined;\n\tgetRepository(path: string): Repository | undefined;\n\tgetRepository(pathOrUri: string | Uri): Repository | undefined;\n\t@log<GitProviderService['getRepository']>({ exit: r => `returned ${r?.path}` })\n\tgetRepository(pathOrUri?: string | Uri): Repository | undefined {\n\t\tif (this.repositoryCount === 0) return undefined;\n\t\tif (pathOrUri == null) return undefined;\n\n\t\tif (typeof pathOrUri === 'string') {\n\t\t\tif (!pathOrUri) return undefined;\n\n\t\t\treturn this._repositories.getClosest(this.getAbsoluteUri(pathOrUri));\n\t\t}\n\n\t\treturn this._repositories.getClosest(pathOrUri);\n\t}\n\n\tasync getLocalInfoFromRemoteUri(\n\t\turi: Uri,\n\t\toptions?: { validate?: boolean },\n\t): Promise<{ uri: Uri; startLine?: number; endLine?: number } | undefined> {\n\t\tfor (const repo of this.openRepositories) {\n\t\t\tfor (const remote of await repo.getRemotes()) {\n\t\t\t\tconst local = await remote?.provider?.getLocalInfoFromRemoteUri(repo, uri, options);\n\t\t\t\tif (local != null) return local;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\t@gate()\n\t@log()\n\tasync getStash(repoPath: string | Uri | undefined): Promise<GitStash | undefined> {\n\t\tif (repoPath == null) return undefined;\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getStash(path);\n\t}\n\n\t@log()\n\tasync getStatusForFile(repoPath: string | Uri, uri: Uri): Promise<GitStatusFile | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getStatusForFile(path, uri);\n\t}\n\n\t@log()\n\tasync getStatusForFiles(repoPath: string | Uri, pathOrGlob: Uri): Promise<GitStatusFile[] | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getStatusForFiles(path, pathOrGlob);\n\t}\n\n\t@log()\n\tasync getStatusForRepo(repoPath: string | Uri | undefined): Promise<GitStatus | undefined> {\n\t\tif (repoPath == null) return undefined;\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getStatusForRepo(path);\n\t}\n\n\t@log({ args: { 1: false } })\n\tasync getTags(\n\t\trepoPath: string | Uri | undefined,\n\t\toptions?: { cursor?: string; filter?: (t: GitTag) => boolean; sort?: boolean | TagSortOptions },\n\t): Promise<PagedResult<GitTag>> {\n\t\tif (repoPath == null) return { values: [] };\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getTags(path, options);\n\t}\n\n\t@log()\n\tasync getTreeEntryForRevision(\n\t\trepoPath: string | Uri | undefined,\n\t\tpath: string,\n\t\tref: string,\n\t): Promise<GitTreeEntry | undefined> {\n\t\tif (repoPath == null || !path) return undefined;\n\n\t\tconst { provider, path: rp } = this.getProvider(repoPath);\n\t\treturn provider.getTreeEntryForRevision(rp, provider.getRelativePath(path, rp), ref);\n\t}\n\n\t@log()\n\tasync getTreeForRevision(repoPath: string | Uri | undefined, ref: string): Promise<GitTreeEntry[]> {\n\t\tif (repoPath == null) return [];\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getTreeForRevision(path, ref);\n\t}\n\n\t@gate()\n\t@log()\n\tgetRevisionContent(repoPath: string | Uri, path: string, ref: string): Promise<Uint8Array | undefined> {\n\t\tconst { provider, path: rp } = this.getProvider(repoPath);\n\t\treturn provider.getRevisionContent(rp, path, ref);\n\t}\n\n\t@log({ args: { 1: false } })\n\tasync hasBranchOrTag(\n\t\trepoPath: string | Uri | undefined,\n\t\toptions?: {\n\t\t\tfilter?: { branches?: (b: GitBranch) => boolean; tags?: (t: GitTag) => boolean };\n\t\t},\n\t): Promise<boolean> {\n\t\tif (repoPath == null) return false;\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.hasBranchOrTag(path, options);\n\t}\n\n\t@log({ args: { 1: false } })\n\tasync hasCommitBeenPushed(repoPath: string | Uri, ref: string): Promise<boolean> {\n\t\tif (repoPath == null) return false;\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.hasCommitBeenPushed(path, ref);\n\t}\n\n\t@log()\n\tasync hasRemotes(repoPath: string | Uri | undefined): Promise<boolean> {\n\t\tif (repoPath == null) return false;\n\n\t\tconst repository = this.getRepository(repoPath);\n\t\tif (repository == null) return false;\n\n\t\treturn repository.hasRemotes();\n\t}\n\n\t@log()\n\tasync hasTrackingBranch(repoPath: string | undefined): Promise<boolean> {\n\t\tif (repoPath == null) return false;\n\n\t\tconst repository = this.getRepository(repoPath);\n\t\tif (repository == null) return false;\n\n\t\treturn repository.hasUpstreamBranch();\n\t}\n\n\t@log<GitProviderService['isRepositoryForEditor']>({\n\t\targs: {\n\t\t\t0: r => r.uri.toString(false),\n\t\t\t1: e => (e != null ? `TextEditor(${Logger.toLoggable(e.document.uri)})` : undefined),\n\t\t},\n\t})\n\tisRepositoryForEditor(repository: Repository, editor?: TextEditor): boolean {\n\t\teditor = editor ?? window.activeTextEditor;\n\t\tif (editor == null) return false;\n\n\t\treturn repository === this.getRepository(editor.document.uri);\n\t}\n\n\tisTrackable(uri: Uri): boolean {\n\t\tif (!this.supportedSchemes.has(uri.scheme)) return false;\n\n\t\tconst { provider } = this.getProvider(uri);\n\t\treturn provider.isTrackable(uri);\n\t}\n\n\t@log()\n\tasync getDiffTool(repoPath?: string | Uri): Promise<string | undefined> {\n\t\tif (repoPath == null) return undefined;\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getDiffTool(path);\n\t}\n\n\t@log()\n\tasync openDiffTool(\n\t\trepoPath: string | Uri,\n\t\turi: Uri,\n\t\toptions?: { ref1?: string; ref2?: string; staged?: boolean; tool?: string },\n\t): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.openDiffTool(path, uri, options);\n\t}\n\n\t@log()\n\tasync openDirectoryCompare(repoPath: string | Uri, ref1: string, ref2?: string, tool?: string): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.openDirectoryCompare(path, ref1, ref2, tool);\n\t}\n\n\tasync resolveReference(\n\t\trepoPath: string,\n\t\tref: string,\n\t\tpath?: string,\n\t\toptions?: { timeout?: number },\n\t): Promise<string>;\n\tasync resolveReference(repoPath: string, ref: string, uri?: Uri, options?: { timeout?: number }): Promise<string>;\n\t@log()\n\tasync resolveReference(\n\t\trepoPath: string | Uri,\n\t\tref: string,\n\t\tpathOrUri?: string | Uri,\n\t\toptions?: { timeout?: number },\n\t) {\n\t\tif (\n\t\t\t!ref ||\n\t\t\tref === GitRevision.deletedOrMissing ||\n\t\t\t(pathOrUri == null && GitRevision.isSha(ref)) ||\n\t\t\t(pathOrUri != null && GitRevision.isUncommitted(ref))\n\t\t) {\n\t\t\treturn ref;\n\t\t}\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.resolveReference(path, ref, pathOrUri, options);\n\t}\n\n\t@log()\n\tvalidateBranchOrTagName(repoPath: string | Uri, ref: string): Promise<boolean> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.validateBranchOrTagName(path, ref);\n\t}\n\n\t@log()\n\tasync validateReference(repoPath: string | Uri, ref: string) {\n\t\tif (ref == null || ref.length === 0) return false;\n\t\tif (ref === GitRevision.deletedOrMissing || GitRevision.isUncommitted(ref)) return true;\n\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.validateReference(path, ref);\n\t}\n\n\tstageFile(repoPath: string | Uri, path: string): Promise<void>;\n\tstageFile(repoPath: string | Uri, uri: Uri): Promise<void>;\n\t@log()\n\tstageFile(repoPath: string | Uri, pathOrUri: string | Uri): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.stageFile(path, pathOrUri);\n\t}\n\n\tstageDirectory(repoPath: string | Uri, directory: string): Promise<void>;\n\tstageDirectory(repoPath: string | Uri, uri: Uri): Promise<void>;\n\t@log()\n\tstageDirectory(repoPath: string | Uri, directoryOrUri: string | Uri): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.stageDirectory(path, directoryOrUri);\n\t}\n\n\tunStageFile(repoPath: string | Uri, path: string): Promise<void>;\n\tunStageFile(repoPath: string | Uri, uri: Uri): Promise<void>;\n\t@log()\n\tunStageFile(repoPath: string | Uri, pathOrUri: string | Uri): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.unStageFile(path, pathOrUri);\n\t}\n\n\tunStageDirectory(repoPath: string | Uri, directory: string): Promise<void>;\n\tunStageDirectory(repoPath: string | Uri, uri: Uri): Promise<void>;\n\t@log()\n\tunStageDirectory(repoPath: string | Uri, directoryOrUri: string | Uri): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.unStageDirectory(path, directoryOrUri);\n\t}\n\n\t@log()\n\tstashApply(repoPath: string | Uri, stashName: string, options?: { deleteAfter?: boolean }): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.stashApply(path, stashName, options);\n\t}\n\n\t@log()\n\tstashDelete(repoPath: string | Uri, stashName: string, ref?: string): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.stashDelete(path, stashName, ref);\n\t}\n\n\t@log<GitProviderService['stashSave']>({ args: { 2: uris => uris?.length } })\n\tstashSave(\n\t\trepoPath: string | Uri,\n\t\tmessage?: string,\n\t\turis?: Uri[],\n\t\toptions?: { includeUntracked?: boolean; keepIndex?: boolean },\n\t): Promise<void> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.stashSave(path, message, uris, options);\n\t}\n\n\t@log()\n\tcreateWorktree(\n\t\trepoPath: string | Uri,\n\t\tpath: string,\n\t\toptions?: { commitish?: string; createBranch?: string; detach?: boolean; force?: boolean },\n\t): Promise<void> {\n\t\tconst { provider, path: rp } = this.getProvider(repoPath);\n\t\treturn Promise.resolve(provider.createWorktree?.(rp, path, options));\n\t}\n\n\t@log()\n\tasync getWorktrees(repoPath: string | Uri): Promise<GitWorktree[]> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn (await provider.getWorktrees?.(path)) ?? [];\n\t}\n\n\t@log()\n\tasync getWorktreesDefaultUri(path: string | Uri): Promise<Uri | undefined> {\n\t\tconst { provider, path: rp } = this.getProvider(path);\n\t\tlet defaultUri = await provider.getWorktreesDefaultUri?.(rp);\n\t\tif (defaultUri != null) return defaultUri;\n\n\t\t// If we don't have a default set, default it to the parent folder of the repo folder\n\t\tdefaultUri = this.getRepository(rp)?.uri;\n\t\tif (defaultUri != null) {\n\t\t\tdefaultUri = Uri.joinPath(defaultUri, '..');\n\t\t}\n\t\treturn defaultUri;\n\t}\n\n\t@log()\n\tdeleteWorktree(repoPath: string | Uri, path: string, options?: { force?: boolean }): Promise<void> {\n\t\tconst { provider, path: rp } = this.getProvider(repoPath);\n\t\treturn Promise.resolve(provider.deleteWorktree?.(rp, path, options));\n\t}\n\t@log()\n\tasync getOpenScmRepositories(): Promise<ScmRepository[]> {\n\t\tconst results = await Promise.allSettled([...this._providers.values()].map(p => p.getOpenScmRepositories()));\n\t\tconst repositories = flatMap<PromiseFulfilledResult<ScmRepository[]>, ScmRepository>(\n\t\t\tfilter<PromiseSettledResult<ScmRepository[]>, PromiseFulfilledResult<ScmRepository[]>>(\n\t\t\t\tresults,\n\t\t\t\t(r): r is PromiseFulfilledResult<ScmRepository[]> => r.status === 'fulfilled',\n\t\t\t),\n\t\t\tr => r.value,\n\t\t);\n\t\treturn [...repositories];\n\t}\n\n\t@log()\n\tasync getOrOpenScmRepository(repoPath: string): Promise<ScmRepository | undefined> {\n\t\tconst { provider, path } = this.getProvider(repoPath);\n\t\treturn provider.getOrOpenScmRepository(path);\n\t}\n\n\tstatic getEncoding(uri: Uri): string {\n\t\tconst encoding = configuration.getAny<string>('files.encoding', uri);\n\t\treturn encoding != null && encodingExists(encoding) ? encoding : 'utf8';\n\t}\n}\n","import { Uri } from 'vscode';\nimport { decodeUtf8Hex, encodeUtf8Hex } from '@env/hex';\nimport { UriComparer } from '../comparers';\nimport { Schemes } from '../constants';\nimport { Container } from '../container';\nimport { Logger } from '../logger';\nimport type { GitHubAuthorityMetadata } from '../premium/remotehub';\nimport { debug } from '../system/decorators/log';\nimport { memoize } from '../system/decorators/memoize';\nimport { formatPath } from '../system/formatPath';\nimport { basename, getBestPath, normalizePath, relativeDir, splitPath } from '../system/path';\n// import { CharCode } from '../system/string';\nimport type { RevisionUriData } from './gitProvider';\nimport { GitFile, GitRevision } from './models';\n\nconst slash = 47; //CharCode.Slash;\n\nexport interface GitCommitish {\n\tfileName?: string;\n\trepoPath: string;\n\tsha?: string;\n}\n\ninterface UriComponents {\n\tscheme?: string;\n\tauthority?: string;\n\tpath?: string;\n\tquery?: string;\n\tfragment?: string;\n}\n\ninterface UriEx {\n\tnew (): Uri;\n\tnew (scheme: string, authority: string, path: string, query: string, fragment: string): Uri;\n\t// Use this ctor, because vscode doesn't validate it\n\tnew (components: UriComponents): Uri;\n}\n\nexport class GitUri extends (Uri as any as UriEx) {\n\tprivate static readonly _unknown = new GitUri();\n\tstatic get unknown() {\n\t\treturn this._unknown;\n\t}\n\n\tstatic is(uri: any): uri is GitUri {\n\t\treturn uri instanceof GitUri;\n\t}\n\n\treadonly repoPath?: string;\n\treadonly sha?: string;\n\n\tconstructor(uri?: Uri);\n\tconstructor(uri: Uri, commit: GitCommitish);\n\tconstructor(uri: Uri, repoPath: string | undefined);\n\tconstructor(uri?: Uri, commitOrRepoPath?: GitCommitish | string) {\n\t\tif (uri == null) {\n\t\t\tsuper({ scheme: 'unknown' });\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (uri.scheme === Schemes.GitLens) {\n\t\t\tsuper({\n\t\t\t\tscheme: uri.scheme,\n\t\t\t\tauthority: uri.authority,\n\t\t\t\tpath: uri.path,\n\t\t\t\tquery: uri.query,\n\t\t\t\tfragment: uri.fragment,\n\t\t\t});\n\n\t\t\tconst metadata = decodeGitLensRevisionUriAuthority<RevisionUriData>(uri.authority);\n\t\t\tthis.repoPath = metadata.repoPath;\n\n\t\t\tlet ref = metadata.ref;\n\t\t\tif (commitOrRepoPath != null && typeof commitOrRepoPath !== 'string') {\n\t\t\t\tref = commitOrRepoPath.sha;\n\t\t\t}\n\n\t\t\tif (GitRevision.isUncommittedStaged(ref) || !GitRevision.isUncommitted(ref)) {\n\t\t\t\tthis.sha = ref;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (uri.scheme === Schemes.Virtual || uri.scheme === Schemes.GitHub) {\n\t\t\tsuper(uri);\n\n\t\t\tconst [, owner, repo] = uri.path.split('/', 3);\n\t\t\tthis.repoPath = uri.with({ path: `/${owner}/${repo}` }).toString();\n\n\t\t\tconst data = decodeRemoteHubAuthority<GitHubAuthorityMetadata>(uri);\n\n\t\t\tlet ref = data.metadata?.ref?.id;\n\t\t\tif (commitOrRepoPath != null && typeof commitOrRepoPath !== 'string') {\n\t\t\t\tref = commitOrRepoPath.sha;\n\t\t\t}\n\n\t\t\tif (ref && (GitRevision.isUncommittedStaged(ref) || !GitRevision.isUncommitted(ref))) {\n\t\t\t\tthis.sha = ref;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (commitOrRepoPath === undefined) {\n\t\t\tsuper(uri);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof commitOrRepoPath === 'string') {\n\t\t\tsuper(uri);\n\n\t\t\tthis.repoPath = commitOrRepoPath;\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet authority = uri.authority;\n\t\tlet fsPath = normalizePath(\n\t\t\tContainer.instance.git.getAbsoluteUri(commitOrRepoPath.fileName ?? uri.fsPath, commitOrRepoPath.repoPath)\n\t\t\t\t.fsPath,\n\t\t);\n\n\t\t// Check for authority as used in UNC shares or use the path as given\n\t\tif (fsPath.charCodeAt(0) === slash && fsPath.charCodeAt(1) === slash) {\n\t\t\tconst index = fsPath.indexOf('/', 2);\n\t\t\tif (index === -1) {\n\t\t\t\tauthority = fsPath.substring(2);\n\t\t\t\tfsPath = '/';\n\t\t\t} else {\n\t\t\t\tauthority = fsPath.substring(2, index);\n\t\t\t\tfsPath = fsPath.substring(index) || '/';\n\t\t\t}\n\t\t}\n\n\t\tlet path;\n\t\tswitch (uri.scheme) {\n\t\t\tcase 'https':\n\t\t\tcase 'http':\n\t\t\tcase 'file':\n\t\t\t\tif (!fsPath) {\n\t\t\t\t\tpath = '/';\n\t\t\t\t} else if (fsPath.charCodeAt(0) !== slash) {\n\t\t\t\t\tpath = `/${fsPath}`;\n\t\t\t\t} else {\n\t\t\t\t\tpath = fsPath;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tpath = fsPath.charCodeAt(0) !== slash ? `/${fsPath}` : fsPath;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tsuper({\n\t\t\tscheme: uri.scheme,\n\t\t\tauthority: authority,\n\t\t\tpath: path,\n\t\t\tquery: uri.query,\n\t\t\tfragment: uri.fragment,\n\t\t});\n\t\tthis.repoPath = commitOrRepoPath.repoPath;\n\t\tif (GitRevision.isUncommittedStaged(commitOrRepoPath.sha) || !GitRevision.isUncommitted(commitOrRepoPath.sha)) {\n\t\t\tthis.sha = commitOrRepoPath.sha;\n\t\t}\n\t}\n\n\t@memoize()\n\tget directory(): string {\n\t\treturn relativeDir(this.relativePath);\n\t}\n\n\t@memoize()\n\tget fileName(): string {\n\t\treturn basename(this.relativePath);\n\t}\n\n\t@memoize()\n\tget isUncommitted(): boolean {\n\t\treturn GitRevision.isUncommitted(this.sha);\n\t}\n\n\t@memoize()\n\tget isUncommittedStaged(): boolean {\n\t\treturn GitRevision.isUncommittedStaged(this.sha);\n\t}\n\n\t@memoize()\n\tget relativePath(): string {\n\t\treturn splitPath(getBestPath(this.fsPath), this.repoPath)[0];\n\t}\n\n\t@memoize()\n\tget shortSha(): string {\n\t\treturn GitRevision.shorten(this.sha);\n\t}\n\n\t@memoize()\n\tdocumentUri() {\n\t\t// TODO@eamodio which is correct?\n\t\treturn Uri.from({\n\t\t\tscheme: this.scheme,\n\t\t\tauthority: this.authority,\n\t\t\tpath: this.path,\n\t\t\tquery: this.query,\n\t\t\tfragment: this.fragment,\n\t\t});\n\t\treturn Container.instance.git.getAbsoluteUri(this.fsPath, this.repoPath);\n\t}\n\n\tequals(uri: Uri | undefined) {\n\t\tif (!UriComparer.equals(this, uri)) return false;\n\n\t\treturn this.sha === (GitUri.is(uri) ? uri.sha : undefined);\n\t}\n\n\tgetFormattedFileName(options?: { suffix?: string; truncateTo?: number }): string {\n\t\treturn formatPath(this.fsPath, { ...options, fileOnly: true });\n\t}\n\n\t@memoize()\n\ttoFileUri() {\n\t\treturn Container.instance.git.getAbsoluteUri(this.fsPath, this.repoPath);\n\t}\n\n\tstatic fromFile(file: string | GitFile, repoPath: string, ref?: string, original: boolean = false): GitUri {\n\t\tconst uri = Container.instance.git.getAbsoluteUri(\n\t\t\ttypeof file === 'string' ? file : (original && file.originalPath) || file.path,\n\t\t\trepoPath,\n\t\t);\n\t\treturn !ref ? new GitUri(uri, repoPath) : new GitUri(uri, { repoPath: repoPath, sha: ref });\n\t}\n\n\tstatic fromRepoPath(repoPath: string, ref?: string) {\n\t\treturn !ref\n\t\t\t? new GitUri(Container.instance.git.getAbsoluteUri(repoPath, repoPath), repoPath)\n\t\t\t: new GitUri(Container.instance.git.getAbsoluteUri(repoPath, repoPath), { repoPath: repoPath, sha: ref });\n\t}\n\n\tstatic fromRevisionUri(uri: Uri): GitUri {\n\t\treturn new GitUri(uri);\n\t}\n\n\t@debug({\n\t\texit: uri => `returned ${Logger.toLoggable(uri)}`,\n\t})\n\tstatic async fromUri(uri: Uri): Promise<GitUri> {\n\t\tif (GitUri.is(uri)) return uri;\n\t\tif (!Container.instance.git.isTrackable(uri)) return new GitUri(uri);\n\t\tif (uri.scheme === Schemes.GitLens) return new GitUri(uri);\n\n\t\t// If this is a git uri, find its repoPath\n\t\tif (uri.scheme === Schemes.Git) {\n\t\t\tlet data: { path: string; ref: string } | undefined;\n\t\t\ttry {\n\t\t\t\tdata = JSON.parse(uri.query);\n\t\t\t} catch {}\n\n\t\t\tif (data?.path) {\n\t\t\t\tconst repository = await Container.instance.git.getOrOpenRepository(Uri.file(data.path));\n\t\t\t\tif (repository == null) {\n\t\t\t\t\tdebugger;\n\t\t\t\t\tthrow new Error(`Unable to find repository for uri=${uri.toString(false)}`);\n\t\t\t\t}\n\n\t\t\t\tlet ref;\n\t\t\t\tswitch (data.ref) {\n\t\t\t\t\tcase '':\n\t\t\t\t\tcase '~':\n\t\t\t\t\t\tref = GitRevision.uncommittedStaged;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase null:\n\t\t\t\t\t\tref = undefined;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tref = data.ref;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tconst commitish: GitCommitish = {\n\t\t\t\t\tfileName: data.path,\n\t\t\t\t\trepoPath: repository?.path,\n\t\t\t\t\tsha: ref,\n\t\t\t\t};\n\t\t\t\treturn new GitUri(uri, commitish);\n\t\t\t}\n\t\t}\n\n\t\tif (uri.scheme === Schemes.PRs) {\n\t\t\tlet data:\n\t\t\t\t| {\n\t\t\t\t\t\tbaseCommit: string;\n\t\t\t\t\t\theadCommit: string;\n\t\t\t\t\t\tisBase: boolean;\n\t\t\t\t\t\tfileName: string;\n\t\t\t\t\t\tprNumber: number;\n\t\t\t\t\t\tstatus: number;\n\t\t\t\t\t\tremoteName: string;\n\t\t\t\t  }\n\t\t\t\t| undefined;\n\t\t\ttry {\n\t\t\t\tdata = JSON.parse(uri.query);\n\t\t\t} catch {}\n\n\t\t\tif (data?.fileName) {\n\t\t\t\tconst repository = await Container.instance.git.getOrOpenRepository(Uri.file(data.fileName));\n\t\t\t\tif (repository == null) {\n\t\t\t\t\tdebugger;\n\t\t\t\t\tthrow new Error(`Unable to find repository for uri=${uri.toString(false)}`);\n\t\t\t\t}\n\n\t\t\t\tlet repoPath = normalizePath(uri.fsPath);\n\t\t\t\tif (repoPath.endsWith(data.fileName)) {\n\t\t\t\t\trepoPath = repoPath.substr(0, repoPath.length - data.fileName.length - 1);\n\t\t\t\t} else {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-asserted-optional-chain\n\t\t\t\t\trepoPath = (await Container.instance.git.getOrOpenRepository(uri))?.path!;\n\t\t\t\t\tif (!repoPath) {\n\t\t\t\t\t\tdebugger;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst commitish: GitCommitish = {\n\t\t\t\t\tfileName: data.fileName,\n\t\t\t\t\trepoPath: repoPath,\n\t\t\t\t\tsha: data.isBase ? data.baseCommit : data.headCommit,\n\t\t\t\t};\n\t\t\t\treturn new GitUri(uri, commitish);\n\t\t\t}\n\t\t}\n\n\t\tconst repository = await Container.instance.git.getOrOpenRepository(uri);\n\t\treturn new GitUri(uri, repository?.path);\n\t}\n}\n\nexport function decodeGitLensRevisionUriAuthority<T>(authority: string): T {\n\treturn JSON.parse(decodeUtf8Hex(authority)) as T;\n}\n\nexport function encodeGitLensRevisionUriAuthority<T>(metadata: T): string {\n\treturn encodeUtf8Hex(JSON.stringify(metadata));\n}\n\nfunction decodeRemoteHubAuthority<T>(uri: Uri): { scheme: string; metadata: T | undefined } {\n\tconst [scheme, encoded] = uri.authority.split('+');\n\n\tlet metadata: T | undefined;\n\tif (encoded) {\n\t\ttry {\n\t\t\tconst data = JSON.parse(decodeUtf8Hex(encoded));\n\t\t\tmetadata = data as T;\n\t\t} catch {}\n\t}\n\n\treturn { scheme: scheme, metadata: metadata };\n}\n","import { Uri } from 'vscode';\nimport { getAvatarUri } from '../../avatars';\nimport { configuration, ContributorSorting, GravatarDefaultStyle } from '../../configuration';\nimport { formatDate, fromNow } from '../../system/date';\nimport { memoize } from '../../system/decorators/memoize';\nimport { sortCompare } from '../../system/string';\n\nexport interface ContributorSortOptions {\n\tcurrent?: true;\n\torderBy?: ContributorSorting;\n}\n\nexport class GitContributor {\n\tstatic is(contributor: any): contributor is GitContributor {\n\t\treturn contributor instanceof GitContributor;\n\t}\n\n\tstatic sort(contributors: GitContributor[], options?: ContributorSortOptions) {\n\t\toptions = { current: true, orderBy: configuration.get('sortContributorsBy'), ...options };\n\n\t\tswitch (options.orderBy) {\n\t\t\tcase ContributorSorting.CountAsc:\n\t\t\t\treturn contributors.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(a.current ? -1 : 1) - (b.current ? -1 : 1) ||\n\t\t\t\t\t\ta.count - b.count ||\n\t\t\t\t\t\t(a.date?.getTime() ?? 0) - (b.date?.getTime() ?? 0),\n\t\t\t\t);\n\t\t\tcase ContributorSorting.DateDesc:\n\t\t\t\treturn contributors.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(options!.current ? (a.current ? -1 : 1) - (b.current ? -1 : 1) : 0) ||\n\t\t\t\t\t\t(b.date?.getTime() ?? 0) - (a.date?.getTime() ?? 0) ||\n\t\t\t\t\t\tb.count - a.count,\n\t\t\t\t);\n\t\t\tcase ContributorSorting.DateAsc:\n\t\t\t\treturn contributors.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(options!.current ? (a.current ? -1 : 1) - (b.current ? -1 : 1) : 0) ||\n\t\t\t\t\t\t(a.date?.getTime() ?? 0) - (b.date?.getTime() ?? 0) ||\n\t\t\t\t\t\tb.count - a.count,\n\t\t\t\t);\n\t\t\tcase ContributorSorting.NameAsc:\n\t\t\t\treturn contributors.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(a.current ? -1 : 1) - (b.current ? -1 : 1) ||\n\t\t\t\t\t\tsortCompare(a.name ?? a.username!, b.name ?? b.username!),\n\t\t\t\t);\n\t\t\tcase ContributorSorting.NameDesc:\n\t\t\t\treturn contributors.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(a.current ? -1 : 1) - (b.current ? -1 : 1) ||\n\t\t\t\t\t\tsortCompare(b.name ?? b.username!, a.name ?? a.username!),\n\t\t\t\t);\n\t\t\tcase ContributorSorting.CountDesc:\n\t\t\tdefault:\n\t\t\t\treturn contributors.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(a.current ? -1 : 1) - (b.current ? -1 : 1) ||\n\t\t\t\t\t\tb.count - a.count ||\n\t\t\t\t\t\t(b.date?.getTime() ?? 0) - (a.date?.getTime() ?? 0),\n\t\t\t\t);\n\t\t}\n\t}\n\n\tconstructor(\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly name: string | undefined,\n\t\tpublic readonly email: string | undefined,\n\t\tpublic readonly count: number,\n\t\tpublic readonly date?: Date,\n\t\tpublic readonly current: boolean = false,\n\t\tpublic readonly stats?: {\n\t\t\tfiles: number;\n\t\t\tadditions: number;\n\t\t\tdeletions: number;\n\t\t},\n\t\tpublic readonly username?: string | undefined,\n\t\tprivate readonly avatarUrl?: string | undefined,\n\t\tpublic readonly id?: string | undefined,\n\t) {}\n\n\tget label(): string {\n\t\treturn this.name ?? this.username!;\n\t}\n\n\t@memoize<GitContributor['formatDate']>(format => format ?? 'MMMM Do, YYYY h:mma')\n\tformatDate(format?: string | null): string {\n\t\treturn this.date != null ? formatDate(this.date, format ?? 'MMMM Do, YYYY h:mma') : '';\n\t}\n\n\tformatDateFromNow(short?: boolean): string {\n\t\treturn this.date != null ? fromNow(this.date, short) : '';\n\t}\n\n\tgetAvatarUri(options?: { defaultStyle?: GravatarDefaultStyle; size?: number }): Uri | Promise<Uri> {\n\t\tif (this.avatarUrl != null) return Uri.parse(this.avatarUrl);\n\n\t\treturn getAvatarUri(this.email, undefined /*this.repoPath*/, options);\n\t}\n\n\tgetCoauthor(): string {\n\t\treturn `${this.name}${this.email ? ` <${this.email}>` : ''}`;\n\t}\n}\n","import { ColorThemeKind, ThemeColor, ThemeIcon, window } from 'vscode';\nimport { Colors } from '../../constants';\nimport { RemoteProviderReference } from './remoteProvider';\n\nexport const enum IssueOrPullRequestType {\n\tIssue = 'Issue',\n\tPullRequest = 'PullRequest',\n}\n\nexport interface IssueOrPullRequest {\n\ttype: IssueOrPullRequestType;\n\tprovider: RemoteProviderReference;\n\tid: string;\n\tdate: Date;\n\ttitle: string;\n\tclosed: boolean;\n\tclosedDate?: Date;\n\turl: string;\n}\n\nexport namespace IssueOrPullRequest {\n\texport function getMarkdownIcon(issue: IssueOrPullRequest): string {\n\t\tif (issue.type === IssueOrPullRequestType.PullRequest) {\n\t\t\tif (issue.closed) {\n\t\t\t\treturn `<span style=\"color:${\n\t\t\t\t\twindow.activeColorTheme.kind === ColorThemeKind.Dark ? '#a371f7' : '#8250df'\n\t\t\t\t};\">$(git-pull-request)</span>`;\n\t\t\t}\n\t\t\treturn `<span style=\"color:${\n\t\t\t\twindow.activeColorTheme.kind === ColorThemeKind.Dark ? '#3fb950' : '#1a7f37'\n\t\t\t};\">$(git-pull-request)</span>`;\n\t\t}\n\n\t\tif (issue.closed) {\n\t\t\treturn `<span style=\"color:${\n\t\t\t\twindow.activeColorTheme.kind === ColorThemeKind.Dark ? '#a371f7' : '#8250df'\n\t\t\t};\">$(pass)</span>`;\n\t\t}\n\t\treturn `<span style=\"color:${\n\t\t\twindow.activeColorTheme.kind === ColorThemeKind.Dark ? '#3fb950' : '#1a7f37'\n\t\t};\">$(issue)</span>`;\n\t}\n\n\texport function getThemeIcon(issue: IssueOrPullRequest): ThemeIcon {\n\t\tif (issue.type === IssueOrPullRequestType.PullRequest) {\n\t\t\tif (issue.closed) {\n\t\t\t\treturn new ThemeIcon('git-pull-request', new ThemeColor(Colors.MergedPullRequestIconColor));\n\t\t\t}\n\t\t\treturn new ThemeIcon('git-pull-request', new ThemeColor(Colors.OpenPullRequestIconColor));\n\t\t}\n\n\t\tif (issue.closed) {\n\t\t\treturn new ThemeIcon('pass', new ThemeColor(Colors.ClosedAutolinkedIssueIconColor));\n\t\t}\n\t\treturn new ThemeIcon('issues', new ThemeColor(Colors.OpenAutolinkedIssueIconColor));\n\t}\n}\n","import { ColorThemeKind, ThemeColor, ThemeIcon, window } from 'vscode';\nimport { DateStyle } from '../../configuration';\nimport { Colors } from '../../constants';\nimport { Container } from '../../container';\nimport { formatDate, fromNow } from '../../system/date';\nimport { memoize } from '../../system/decorators/memoize';\nimport { RemoteProviderReference } from './remoteProvider';\n\nexport const enum PullRequestState {\n\tOpen = 'Open',\n\tClosed = 'Closed',\n\tMerged = 'Merged',\n}\n\nexport class PullRequest {\n\tstatic is(pr: any): pr is PullRequest {\n\t\treturn pr instanceof PullRequest;\n\t}\n\n\tstatic getMarkdownIcon(pullRequest: PullRequest): string {\n\t\tswitch (pullRequest.state) {\n\t\t\tcase PullRequestState.Open:\n\t\t\t\treturn `<span style=\"color:${\n\t\t\t\t\twindow.activeColorTheme.kind === ColorThemeKind.Dark ? '#3fb950' : '#1a7f37'\n\t\t\t\t};\">$(git-pull-request)</span>`;\n\t\t\tcase PullRequestState.Closed:\n\t\t\t\treturn `<span style=\"color:${\n\t\t\t\t\twindow.activeColorTheme.kind === ColorThemeKind.Dark ? '#f85149' : '#cf222e'\n\t\t\t\t};\">$(git-pull-request-closed)</span>`;\n\t\t\tcase PullRequestState.Merged:\n\t\t\t\treturn `<span style=\"color:${\n\t\t\t\t\twindow.activeColorTheme.kind === ColorThemeKind.Dark ? '#a371f7' : '#8250df'\n\t\t\t\t};\">$(git-merge)</span>`;\n\t\t\tdefault:\n\t\t\t\treturn '$(git-pull-request)';\n\t\t}\n\t}\n\n\tstatic getThemeIcon(pullRequest: PullRequest): ThemeIcon {\n\t\tswitch (pullRequest.state) {\n\t\t\tcase PullRequestState.Open:\n\t\t\t\treturn new ThemeIcon('git-pull-request', new ThemeColor(Colors.OpenPullRequestIconColor));\n\t\t\tcase PullRequestState.Closed:\n\t\t\t\treturn new ThemeIcon('git-pull-request-closed', new ThemeColor(Colors.ClosedPullRequestIconColor));\n\t\t\tcase PullRequestState.Merged:\n\t\t\t\treturn new ThemeIcon('git-merge', new ThemeColor(Colors.MergedPullRequestIconColor));\n\t\t\tdefault:\n\t\t\t\treturn new ThemeIcon('git-pull-request');\n\t\t}\n\t}\n\n\tconstructor(\n\t\tpublic readonly provider: RemoteProviderReference,\n\t\tpublic readonly author: {\n\t\t\treadonly name: string;\n\t\t\treadonly avatarUrl: string;\n\t\t\treadonly url: string;\n\t\t},\n\t\tpublic readonly id: string,\n\t\tpublic readonly title: string,\n\t\tpublic readonly url: string,\n\t\tpublic readonly state: PullRequestState,\n\t\tpublic readonly date: Date,\n\t\tpublic readonly closedDate?: Date,\n\t\tpublic readonly mergedDate?: Date,\n\t) {}\n\n\tget formattedDate(): string {\n\t\treturn Container.instance.PullRequestDateFormatting.dateStyle === DateStyle.Absolute\n\t\t\t? this.formatDate(Container.instance.PullRequestDateFormatting.dateFormat)\n\t\t\t: this.formatDateFromNow();\n\t}\n\n\t@memoize<PullRequest['formatDate']>(format => format ?? 'MMMM Do, YYYY h:mma')\n\tformatDate(format?: string | null) {\n\t\treturn formatDate(this.mergedDate ?? this.closedDate ?? this.date, format ?? 'MMMM Do, YYYY h:mma');\n\t}\n\n\tformatDateFromNow() {\n\t\treturn fromNow(this.mergedDate ?? this.closedDate ?? this.date);\n\t}\n\n\t@memoize<PullRequest['formatClosedDate']>(format => format ?? 'MMMM Do, YYYY h:mma')\n\tformatClosedDate(format?: string | null) {\n\t\tif (this.closedDate == null) return '';\n\t\treturn formatDate(this.closedDate, format ?? 'MMMM Do, YYYY h:mma');\n\t}\n\n\tformatClosedDateFromNow() {\n\t\tif (this.closedDate == null) return '';\n\t\treturn fromNow(this.closedDate);\n\t}\n\n\t@memoize<PullRequest['formatMergedDate']>(format => format ?? 'MMMM Do, YYYY h:mma')\n\tformatMergedDate(format?: string | null) {\n\t\tif (this.mergedDate == null) return '';\n\t\treturn formatDate(this.mergedDate, format ?? 'MMMM Do, YYYY h:mma') ?? '';\n\t}\n\n\tformatMergedDateFromNow() {\n\t\tif (this.mergedDate == null) return '';\n\t\treturn fromNow(this.mergedDate);\n\t}\n\n\t@memoize<PullRequest['formatUpdatedDate']>(format => format ?? 'MMMM Do, YYYY h:mma')\n\tformatUpdatedDate(format?: string | null) {\n\t\treturn formatDate(this.date, format ?? 'MMMM Do, YYYY h:mma') ?? '';\n\t}\n\n\tformatUpdatedDateFromNow() {\n\t\treturn fromNow(this.date);\n\t}\n}\n","import { Container } from '../../container';\nimport { WorkspaceStorageKeys } from '../../storage';\nimport { sortCompare } from '../../system/string';\nimport { RemoteProvider, RichRemoteProvider } from '../remotes/provider';\n\nexport const enum GitRemoteType {\n\tFetch = 'fetch',\n\tPush = 'push',\n}\n\nexport class GitRemote<TProvider extends RemoteProvider | undefined = RemoteProvider | RichRemoteProvider | undefined> {\n\tstatic getHighlanderProviders(remotes: GitRemote<RemoteProvider | RichRemoteProvider>[]) {\n\t\tif (remotes.length === 0) return undefined;\n\n\t\tconst remote = remotes.length === 1 ? remotes[0] : remotes.find(r => r.default);\n\t\tif (remote != null) return [remote.provider];\n\n\t\tconst providerName = remotes[0].provider.name;\n\t\tif (remotes.every(r => r.provider.name === providerName)) return remotes.map(r => r.provider);\n\n\t\treturn undefined;\n\t}\n\n\tstatic getHighlanderProviderName(remotes: GitRemote<RemoteProvider | RichRemoteProvider>[]) {\n\t\tif (remotes.length === 0) return undefined;\n\n\t\tconst remote = remotes.length === 1 ? remotes[0] : remotes.find(r => r.default);\n\t\tif (remote != null) return remote.provider.name;\n\n\t\tconst providerName = remotes[0].provider.name;\n\t\t// Only use the real provider name if there is only 1 type of provider\n\t\tif (remotes.every(r => r.provider.name === providerName)) return providerName;\n\n\t\treturn undefined;\n\t}\n\n\tstatic is(remote: any): remote is GitRemote {\n\t\treturn remote instanceof GitRemote;\n\t}\n\n\tstatic sort(remotes: GitRemote[]) {\n\t\treturn remotes.sort(\n\t\t\t(a, b) =>\n\t\t\t\t(a.default ? -1 : 1) - (b.default ? -1 : 1) ||\n\t\t\t\t(a.name === 'origin' ? -1 : 1) - (b.name === 'origin' ? -1 : 1) ||\n\t\t\t\tsortCompare(a.name, b.name),\n\t\t);\n\t}\n\n\tconstructor(\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly id: string,\n\t\tpublic readonly name: string,\n\t\tpublic readonly scheme: string,\n\t\tpublic readonly domain: string,\n\t\tpublic readonly path: string,\n\t\tpublic readonly provider: TProvider,\n\t\tpublic readonly urls: { type: GitRemoteType; url: string }[],\n\t) {}\n\n\tget default() {\n\t\tconst defaultRemote = Container.instance.storage.getWorkspace<string>(WorkspaceStorageKeys.DefaultRemote);\n\t\treturn this.id === defaultRemote;\n\t}\n\n\tget url(): string {\n\t\tlet bestUrl: string | undefined;\n\t\tfor (const remoteUrl of this.urls) {\n\t\t\tif (remoteUrl.type === GitRemoteType.Push) {\n\t\t\t\treturn remoteUrl.url;\n\t\t\t}\n\n\t\t\tif (bestUrl == null) {\n\t\t\t\tbestUrl = remoteUrl.url;\n\t\t\t}\n\t\t}\n\n\t\treturn bestUrl!;\n\t}\n\n\thasRichProvider(): this is GitRemote<RichRemoteProvider> {\n\t\treturn RichRemoteProvider.is(this.provider);\n\t}\n\n\tasync setAsDefault(state: boolean = true, updateViews: boolean = true) {\n\t\tvoid (await Container.instance.storage.storeWorkspace(\n\t\t\tWorkspaceStorageKeys.DefaultRemote,\n\t\t\tstate ? this.id : undefined,\n\t\t));\n\n\t\t// TODO@eamodio this is UGLY\n\t\tif (updateViews) {\n\t\t\tvoid (await Container.instance.remotesView.refresh());\n\t\t\tvoid (await Container.instance.repositoriesView.refresh());\n\t\t}\n\t}\n}\n","import {\n\tConfigurationChangeEvent,\n\tDisposable,\n\tEvent,\n\tEventEmitter,\n\tProgressLocation,\n\tRelativePattern,\n\tUri,\n\twindow,\n\tworkspace,\n\tWorkspaceFolder,\n} from 'vscode';\nimport type { CreatePullRequestActionContext } from '../../api/gitlens';\nimport { configuration } from '../../configuration';\nimport { CoreGitCommands, CoreGitConfiguration, Schemes } from '../../constants';\nimport { Container } from '../../container';\nimport type { FeatureAccess, Features, PremiumFeatures } from '../../features';\nimport { Logger } from '../../logger';\nimport { Messages } from '../../messages';\nimport { asRepoComparisonKey } from '../../repositories';\nimport { Starred, WorkspaceStorageKeys } from '../../storage';\nimport { filterMap, groupByMap } from '../../system/array';\nimport { executeActionCommand, executeCoreGitCommand } from '../../system/command';\nimport { formatDate, fromNow } from '../../system/date';\nimport { gate } from '../../system/decorators/gate';\nimport { debug, log, logName } from '../../system/decorators/log';\nimport { debounce } from '../../system/function';\nimport { filter, join, some } from '../../system/iterable';\nimport { basename, normalizePath } from '../../system/path';\nimport { runGitCommandInTerminal } from '../../terminal';\nimport type { GitProviderDescriptor } from '../gitProvider';\nimport { RemoteProviderFactory, RemoteProviders } from '../remotes/factory';\nimport { RichRemoteProvider } from '../remotes/provider';\nimport type { SearchPattern } from '../search';\nimport { BranchSortOptions, GitBranch } from './branch';\nimport type { GitCommit } from './commit';\nimport type { GitContributor } from './contributor';\nimport type { GitDiffShortStat } from './diff';\nimport type { GitLog } from './log';\nimport type { GitMergeStatus } from './merge';\nimport type { GitRebaseStatus } from './rebase';\nimport { GitBranchReference, GitReference, GitTagReference } from './reference';\nimport type { GitRemote } from './remote';\nimport type { GitStash } from './stash';\nimport type { GitStatus } from './status';\nimport type { GitTag, TagSortOptions } from './tag';\nimport type { GitWorktree } from './worktree';\n\nconst millisecondsPerMinute = 60 * 1000;\nconst millisecondsPerHour = 60 * 60 * 1000;\nconst millisecondsPerDay = 24 * 60 * 60 * 1000;\n\nexport const enum RepositoryChange {\n\t// FileSystem = 'filesystem',\n\tUnknown = 'unknown',\n\n\t// No file watching required\n\tClosed = 'closed',\n\tIgnores = 'ignores',\n\tStarred = 'starred',\n\n\t// File watching required\n\tCherryPick = 'cherrypick',\n\tConfig = 'config',\n\tHeads = 'heads',\n\tIndex = 'index',\n\tMerge = 'merge',\n\tRebase = 'rebase',\n\tRemotes = 'remotes',\n\tRemoteProviders = 'providers',\n\tStash = 'stash',\n\t/*\n\t * Union of Cherry, Merge, and Rebase\n\t */\n\tStatus = 'status',\n\tTags = 'tags',\n\tWorktrees = 'worktrees',\n}\n\nexport const enum RepositoryChangeComparisonMode {\n\tAny,\n\tAll,\n\tExclusive,\n}\n\nexport class RepositoryChangeEvent {\n\tprivate readonly _changes: Set<RepositoryChange>;\n\n\tconstructor(public readonly repository: Repository, changes: RepositoryChange[]) {\n\t\tthis._changes = new Set(changes);\n\t}\n\n\ttoString(changesOnly: boolean = false): string {\n\t\treturn changesOnly\n\t\t\t? `changes=${join(this._changes, ', ')}`\n\t\t\t: `{ repository: ${this.repository?.name ?? ''}, changes: ${join(this._changes, ', ')} }`;\n\t}\n\n\tchanged(...args: [...RepositoryChange[], RepositoryChangeComparisonMode]) {\n\t\tconst affected = args.slice(0, -1) as RepositoryChange[];\n\t\tconst mode = args[args.length - 1] as RepositoryChangeComparisonMode;\n\n\t\tif (mode === RepositoryChangeComparisonMode.Any) {\n\t\t\treturn some(this._changes, c => affected.includes(c));\n\t\t}\n\n\t\tlet changes = this._changes;\n\n\t\tif (mode === RepositoryChangeComparisonMode.Exclusive) {\n\t\t\tif (\n\t\t\t\taffected.includes(RepositoryChange.CherryPick) ||\n\t\t\t\taffected.includes(RepositoryChange.Merge) ||\n\t\t\t\taffected.includes(RepositoryChange.Rebase)\n\t\t\t) {\n\t\t\t\tif (!affected.includes(RepositoryChange.Status)) {\n\t\t\t\t\taffected.push(RepositoryChange.Status);\n\t\t\t\t}\n\t\t\t} else if (affected.includes(RepositoryChange.Status)) {\n\t\t\t\tchanges = new Set(changes);\n\t\t\t\tchanges.delete(RepositoryChange.CherryPick);\n\t\t\t\tchanges.delete(RepositoryChange.Merge);\n\t\t\t\tchanges.delete(RepositoryChange.Rebase);\n\t\t\t}\n\t\t}\n\n\t\tconst intersection = [...filter(changes, c => affected.includes(c))];\n\t\treturn mode === RepositoryChangeComparisonMode.Exclusive\n\t\t\t? intersection.length === changes.size\n\t\t\t: intersection.length === affected.length;\n\t}\n\n\twith(changes: RepositoryChange[]) {\n\t\treturn new RepositoryChangeEvent(this.repository, [...this._changes, ...changes]);\n\t}\n}\n\nexport interface RepositoryFileSystemChangeEvent {\n\treadonly repository?: Repository;\n\treadonly uris: Uri[];\n}\n\n@logName<Repository>((r, name) => `${name}(${r.id})`)\nexport class Repository implements Disposable {\n\tstatic formatLastFetched(lastFetched: number, short: boolean = true): string {\n\t\tconst date = new Date(lastFetched);\n\t\tif (Date.now() - lastFetched < millisecondsPerDay) {\n\t\t\treturn fromNow(date);\n\t\t}\n\n\t\tif (short) {\n\t\t\treturn formatDate(date, Container.instance.config.defaultDateShortFormat ?? 'MMM D, YYYY');\n\t\t}\n\n\t\tlet format =\n\t\t\tContainer.instance.config.defaultDateFormat ??\n\t\t\t`dddd, MMMM Do, YYYY [at] ${Container.instance.config.defaultTimeFormat ?? 'h:mma'}`;\n\t\tif (!/[hHm]/.test(format)) {\n\t\t\tformat += ` [at] ${Container.instance.config.defaultTimeFormat ?? 'h:mma'}`;\n\t\t}\n\t\treturn formatDate(date, format);\n\t}\n\n\tstatic getLastFetchedUpdateInterval(lastFetched: number): number {\n\t\tconst timeDiff = Date.now() - lastFetched;\n\t\treturn timeDiff < millisecondsPerDay\n\t\t\t? (timeDiff < millisecondsPerHour ? millisecondsPerMinute : millisecondsPerHour) / 2\n\t\t\t: 0;\n\t}\n\n\tstatic sort(repositories: Repository[]) {\n\t\treturn repositories.sort((a, b) => (a.starred ? -1 : 1) - (b.starred ? -1 : 1) || a.index - b.index);\n\t}\n\n\tprivate _onDidChange = new EventEmitter<RepositoryChangeEvent>();\n\tget onDidChange(): Event<RepositoryChangeEvent> {\n\t\treturn this._onDidChange.event;\n\t}\n\n\tprivate _onDidChangeFileSystem = new EventEmitter<RepositoryFileSystemChangeEvent>();\n\tget onDidChangeFileSystem(): Event<RepositoryFileSystemChangeEvent> {\n\t\treturn this._onDidChangeFileSystem.event;\n\t}\n\n\treadonly formattedName: string;\n\treadonly id: string;\n\treadonly index: number;\n\treadonly name: string;\n\n\tprivate _branch: Promise<GitBranch | undefined> | undefined;\n\tprivate readonly _disposable: Disposable;\n\tprivate _fireChangeDebounced: (() => void) | undefined = undefined;\n\tprivate _fireFileSystemChangeDebounced: (() => void) | undefined = undefined;\n\tprivate _fsWatchCounter = 0;\n\tprivate _fsWatcherDisposable: Disposable | undefined;\n\tprivate _pendingFileSystemChange?: RepositoryFileSystemChangeEvent;\n\tprivate _pendingRepoChange?: RepositoryChangeEvent;\n\tprivate _providers: RemoteProviders | undefined;\n\tprivate _remotes: Promise<GitRemote[]> | undefined;\n\tprivate _remotesDisposable: Disposable | undefined;\n\tprivate _repoWatcherDisposable: Disposable | undefined;\n\tprivate _suspended: boolean;\n\n\tconstructor(\n\t\tprivate readonly container: Container,\n\t\tprivate readonly onDidRepositoryChange: (repo: Repository, e: RepositoryChangeEvent) => void,\n\t\tpublic readonly provider: GitProviderDescriptor,\n\t\tpublic readonly folder: WorkspaceFolder | undefined,\n\t\tpublic readonly uri: Uri,\n\t\tpublic readonly root: boolean,\n\t\tsuspended: boolean,\n\t\tclosed: boolean = false,\n\t) {\n\t\tfolder = workspace.getWorkspaceFolder(uri) ?? folder;\n\t\tif (folder != null) {\n\t\t\tthis.name = folder.name;\n\n\t\t\tif (root) {\n\t\t\t\tthis.formattedName = this.name;\n\t\t\t} else {\n\t\t\t\tconst relativePath = container.git.getRelativePath(folder.uri, uri);\n\t\t\t\tthis.formattedName = relativePath ? `${this.name} (${relativePath})` : this.name;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.name = basename(uri.path);\n\t\t\tthis.formattedName = this.name;\n\n\t\t\t// TODO@eamodio should we create a fake workspace folder?\n\t\t\t// folder = {\n\t\t\t// \turi: uri,\n\t\t\t// \tname: this.name,\n\t\t\t// \tindex: container.git.repositoryCount,\n\t\t\t// };\n\t\t}\n\t\tthis.index = folder?.index ?? container.git.repositoryCount;\n\n\t\tthis.id = asRepoComparisonKey(uri);\n\n\t\tthis._suspended = suspended;\n\t\tthis._closed = closed;\n\n\t\tconst watcher = workspace.createFileSystemWatcher(\n\t\t\tnew RelativePattern(\n\t\t\t\tthis.uri,\n\t\t\t\t'{\\\n**/.git/config,\\\n**/.git/index,\\\n**/.git/HEAD,\\\n**/.git/*_HEAD,\\\n**/.git/MERGE_*,\\\n**/.git/refs/**,\\\n**/.git/rebase-merge/**,\\\n**/.git/sequencer/**,\\\n**/.git/worktrees/**,\\\n**/.gitignore\\\n}',\n\t\t\t),\n\t\t);\n\t\tthis._disposable = Disposable.from(\n\t\t\twatcher,\n\t\t\twatcher.onDidChange(this.onRepositoryChanged, this),\n\t\t\twatcher.onDidCreate(this.onRepositoryChanged, this),\n\t\t\twatcher.onDidDelete(this.onRepositoryChanged, this),\n\t\t\tconfiguration.onDidChange(this.onConfigurationChanged, this),\n\t\t);\n\t\tthis.onConfigurationChanged();\n\t}\n\n\tdispose() {\n\t\tthis.stopWatchingFileSystem();\n\n\t\tthis._remotesDisposable?.dispose();\n\t\tthis._repoWatcherDisposable?.dispose();\n\t\tthis._disposable.dispose();\n\t}\n\n\tget path(): string {\n\t\treturn this.uri.scheme === Schemes.File ? normalizePath(this.uri.fsPath) : this.uri.toString();\n\t}\n\n\tget etag(): number {\n\t\treturn this._updatedAt;\n\t}\n\n\tprivate _updatedAt: number = 0;\n\tget updatedAt(): number {\n\t\treturn this._updatedAt;\n\t}\n\n\tprivate onConfigurationChanged(e?: ConfigurationChangeEvent) {\n\t\tif (configuration.changed(e, 'remotes', this.folder?.uri)) {\n\t\t\tthis._providers = RemoteProviderFactory.loadProviders(configuration.get('remotes', this.folder?.uri));\n\n\t\t\tif (e != null) {\n\t\t\t\tthis.resetCaches('remotes');\n\t\t\t\tthis.fireChange(RepositoryChange.Remotes);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onFileSystemChanged(uri: Uri) {\n\t\t// Ignore .git changes\n\t\tif (/\\.git(?:\\/|\\\\|$)/.test(uri.fsPath)) return;\n\n\t\tthis.fireFileSystemChange(uri);\n\t}\n\n\t@debug()\n\tprivate onRepositoryChanged(uri: Uri | undefined) {\n\t\tthis._lastFetched = undefined;\n\n\t\tconst match =\n\t\t\turi != null\n\t\t\t\t? /(?<ignore>\\/\\.gitignore)|\\.git\\/(?<type>config|index|HEAD|FETCH_HEAD|ORIG_HEAD|CHERRY_PICK_HEAD|MERGE_HEAD|REBASE_HEAD|rebase-merge|refs\\/(?:heads|remotes|stash|tags)|worktrees)/.exec(\n\t\t\t\t\t\turi.path,\n\t\t\t\t  )\n\t\t\t\t: undefined;\n\t\tif (match?.groups != null) {\n\t\t\tconst { ignore, type } = match.groups;\n\n\t\t\tif (ignore) {\n\t\t\t\tthis.fireChange(RepositoryChange.Ignores);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (type) {\n\t\t\t\tcase 'config':\n\t\t\t\t\tthis.resetCaches();\n\t\t\t\t\tthis.fireChange(RepositoryChange.Config, RepositoryChange.Remotes);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'index':\n\t\t\t\t\tthis.fireChange(RepositoryChange.Index);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'FETCH_HEAD':\n\t\t\t\t\t// Ignore any changes to FETCH_HEAD as unless other things change, nothing changes that we care about\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'HEAD':\n\t\t\t\tcase 'ORIG_HEAD':\n\t\t\t\t\tthis.resetCaches('branches');\n\t\t\t\t\tthis.fireChange(RepositoryChange.Heads);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'CHERRY_PICK_HEAD':\n\t\t\t\t\tthis.fireChange(RepositoryChange.CherryPick, RepositoryChange.Status);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'MERGE_HEAD':\n\t\t\t\t\tthis.fireChange(RepositoryChange.Merge, RepositoryChange.Status);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'REBASE_HEAD':\n\t\t\t\tcase 'rebase-merge':\n\t\t\t\t\tthis.fireChange(RepositoryChange.Rebase, RepositoryChange.Status);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'refs/heads':\n\t\t\t\t\tthis.resetCaches('branches');\n\t\t\t\t\tthis.fireChange(RepositoryChange.Heads);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'refs/remotes':\n\t\t\t\t\tthis.resetCaches();\n\t\t\t\t\tthis.fireChange(RepositoryChange.Remotes);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'refs/stash':\n\t\t\t\t\tthis.fireChange(RepositoryChange.Stash);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'refs/tags':\n\t\t\t\t\tthis.fireChange(RepositoryChange.Tags);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'worktrees':\n\t\t\t\t\tthis.fireChange(RepositoryChange.Worktrees);\n\t\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.fireChange(RepositoryChange.Unknown);\n\t}\n\n\tprivate _closed: boolean = false;\n\tget closed(): boolean {\n\t\treturn this._closed;\n\t}\n\tset closed(value: boolean) {\n\t\tconst changed = this._closed !== value;\n\t\tthis._closed = value;\n\t\tif (changed) {\n\t\t\tthis.fireChange(RepositoryChange.Closed);\n\t\t}\n\t}\n\n\t@log()\n\taccess(feature?: PremiumFeatures): Promise<FeatureAccess> {\n\t\treturn this.container.git.access(feature, this.uri);\n\t}\n\n\t@log()\n\tsupports(feature: Features): Promise<boolean> {\n\t\treturn this.container.git.supports(this.uri, feature);\n\t}\n\n\t@log()\n\tbranch(...args: string[]) {\n\t\tthis.runTerminalCommand('branch', ...args);\n\t}\n\n\t@log()\n\tbranchDelete(\n\t\tbranches: GitBranchReference | GitBranchReference[],\n\t\t{ force, remote }: { force?: boolean; remote?: boolean } = {},\n\t) {\n\t\tif (!Array.isArray(branches)) {\n\t\t\tbranches = [branches];\n\t\t}\n\n\t\tconst localBranches = branches.filter(b => !b.remote);\n\t\tif (localBranches.length !== 0) {\n\t\t\tconst args = ['--delete'];\n\t\t\tif (force) {\n\t\t\t\targs.push('--force');\n\t\t\t}\n\t\t\tthis.runTerminalCommand('branch', ...args, ...branches.map(b => b.ref));\n\n\t\t\tif (remote) {\n\t\t\t\tconst trackingBranches = localBranches.filter(b => b.upstream != null);\n\t\t\t\tif (trackingBranches.length !== 0) {\n\t\t\t\t\tconst branchesByOrigin = groupByMap(trackingBranches, b => GitBranch.getRemote(b.upstream!.name));\n\n\t\t\t\t\tfor (const [remote, branches] of branchesByOrigin.entries()) {\n\t\t\t\t\t\tthis.runTerminalCommand(\n\t\t\t\t\t\t\t'push',\n\t\t\t\t\t\t\t'-d',\n\t\t\t\t\t\t\tremote,\n\t\t\t\t\t\t\t...branches.map(b => GitBranch.getNameWithoutRemote(b.upstream!.name)),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst remoteBranches = branches.filter(b => b.remote);\n\t\tif (remoteBranches.length !== 0) {\n\t\t\tconst branchesByOrigin = groupByMap(remoteBranches, b => GitBranch.getRemote(b.name));\n\n\t\t\tfor (const [remote, branches] of branchesByOrigin.entries()) {\n\t\t\t\tthis.runTerminalCommand(\n\t\t\t\t\t'push',\n\t\t\t\t\t'-d',\n\t\t\t\t\tremote,\n\t\t\t\t\t...branches.map(b => GitReference.getNameWithoutRemote(b)),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t@log()\n\tcherryPick(...args: string[]) {\n\t\tthis.runTerminalCommand('cherry-pick', ...args);\n\t}\n\n\tcontainsUri(uri: Uri) {\n\t\treturn this === this.container.git.getRepository(uri);\n\t}\n\n\t@gate()\n\t@log()\n\tasync fetch(\n\t\toptions: {\n\t\t\tall?: boolean;\n\t\t\tbranch?: GitBranchReference;\n\t\t\tprogress?: boolean;\n\t\t\tprune?: boolean;\n\t\t\tpull?: boolean;\n\t\t\tremote?: string;\n\t\t} = {},\n\t) {\n\t\tconst { progress, ...opts } = { progress: true, ...options };\n\t\tif (!progress) return this.fetchCore(opts);\n\n\t\treturn void (await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle:\n\t\t\t\t\topts.branch != null\n\t\t\t\t\t\t? `${opts.pull ? 'Pulling' : 'Fetching'} ${opts.branch.name}...`\n\t\t\t\t\t\t: `Fetching ${opts.remote ? `${opts.remote} of ` : ''}${this.formattedName}...`,\n\t\t\t},\n\t\t\t() => this.fetchCore(opts),\n\t\t));\n\t}\n\n\tprivate async fetchCore(\n\t\toptions: { all?: boolean; branch?: GitBranchReference; prune?: boolean; pull?: boolean; remote?: string } = {},\n\t) {\n\t\ttry {\n\t\t\tvoid (await this.container.git.fetch(this.path, options));\n\n\t\t\tthis.fireChange(RepositoryChange.Unknown);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to fetch repository');\n\t\t}\n\t}\n\n\tasync getBranch(name?: string): Promise<GitBranch | undefined> {\n\t\tif (name) {\n\t\t\tconst {\n\t\t\t\tvalues: [branch],\n\t\t\t} = await this.getBranches({ filter: b => b.name === name });\n\t\t\treturn branch;\n\t\t}\n\n\t\tif (this._branch == null) {\n\t\t\tthis._branch = this.container.git.getBranch(this.path);\n\t\t}\n\t\treturn this._branch;\n\t}\n\n\tgetBranches(\n\t\toptions: {\n\t\t\tfilter?: (b: GitBranch) => boolean;\n\t\t\tpaging?: { cursor?: string; limit?: number };\n\t\t\tsort?: boolean | BranchSortOptions;\n\t\t} = {},\n\t) {\n\t\treturn this.container.git.getBranches(this.path, options);\n\t}\n\n\tgetChangedFilesCount(ref?: string): Promise<GitDiffShortStat | undefined> {\n\t\treturn this.container.git.getChangedFilesCount(this.path, ref);\n\t}\n\n\tgetCommit(ref: string): Promise<GitCommit | undefined> {\n\t\treturn this.container.git.getCommit(this.path, ref);\n\t}\n\n\tgetContributors(options?: { all?: boolean; ref?: string; stats?: boolean }): Promise<GitContributor[]> {\n\t\treturn this.container.git.getContributors(this.path, options);\n\t}\n\n\tprivate _lastFetched: number | undefined;\n\t@gate()\n\tasync getLastFetched(): Promise<number> {\n\t\tif (this._lastFetched == null) {\n\t\t\tif (!(await this.hasRemotes())) return 0;\n\t\t}\n\n\t\ttry {\n\t\t\tconst lastFetched = await this.container.git.getLastFetchedTimestamp(this.path);\n\t\t\t// If we don't get a number, assume the fetch failed, and don't update the timestamp\n\t\t\tif (lastFetched != null) {\n\t\t\t\tthis._lastFetched = lastFetched;\n\t\t\t}\n\t\t} catch {\n\t\t\tthis._lastFetched = undefined;\n\t\t}\n\n\t\treturn this._lastFetched ?? 0;\n\t}\n\n\tgetMergeStatus(): Promise<GitMergeStatus | undefined> {\n\t\treturn this.container.git.getMergeStatus(this.path);\n\t}\n\n\tgetRebaseStatus(): Promise<GitRebaseStatus | undefined> {\n\t\treturn this.container.git.getRebaseStatus(this.path);\n\t}\n\n\tasync getRemote(remote: string): Promise<GitRemote | undefined> {\n\t\treturn (await this.getRemotes()).find(r => r.name === remote);\n\t}\n\n\tasync getRemotes(options: { filter?: (remote: GitRemote) => boolean; sort?: boolean } = {}): Promise<GitRemote[]> {\n\t\tif (this._remotes == null) {\n\t\t\tif (this._providers == null) {\n\t\t\t\tconst remotesCfg = configuration.get('remotes', this.folder?.uri);\n\t\t\t\tthis._providers = RemoteProviderFactory.loadProviders(remotesCfg);\n\t\t\t}\n\n\t\t\t// Since we are caching the results, always sort\n\t\t\tthis._remotes = this.container.git.getRemotes(this.path, { providers: this._providers, sort: true });\n\t\t\tvoid this.subscribeToRemotes(this._remotes);\n\t\t}\n\n\t\treturn options.filter != null ? (await this._remotes).filter(options.filter) : this._remotes;\n\t}\n\n\tasync getRichRemote(connectedOnly: boolean = false): Promise<GitRemote<RichRemoteProvider> | undefined> {\n\t\treturn this.container.git.getRichRemoteProvider(await this.getRemotes(), {\n\t\t\tincludeDisconnected: !connectedOnly,\n\t\t});\n\t}\n\n\tprivate async subscribeToRemotes(remotes: Promise<GitRemote[]>) {\n\t\tthis._remotesDisposable?.dispose();\n\t\tthis._remotesDisposable = undefined;\n\n\t\tthis._remotesDisposable = Disposable.from(\n\t\t\t...filterMap(await remotes, r => {\n\t\t\t\tif (!RichRemoteProvider.is(r.provider)) return undefined;\n\n\t\t\t\treturn r.provider.onDidChange(() => this.fireChange(RepositoryChange.RemoteProviders));\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetStash(): Promise<GitStash | undefined> {\n\t\treturn this.container.git.getStash(this.path);\n\t}\n\n\tgetStatus(): Promise<GitStatus | undefined> {\n\t\treturn this.container.git.getStatusForRepo(this.path);\n\t}\n\n\tgetTags(options?: { filter?: (t: GitTag) => boolean; sort?: boolean | TagSortOptions }) {\n\t\treturn this.container.git.getTags(this.path, options);\n\t}\n\n\tcreateWorktree(\n\t\turi: Uri,\n\t\toptions?: { commitish?: string; createBranch?: string; detach?: boolean; force?: boolean },\n\t): Promise<void> {\n\t\treturn this.container.git.createWorktree(this.path, uri.fsPath, options);\n\t}\n\n\tgetWorktrees(): Promise<GitWorktree[]> {\n\t\treturn this.container.git.getWorktrees(this.path);\n\t}\n\n\tasync getWorktreesDefaultUri(): Promise<Uri | undefined> {\n\t\treturn this.container.git.getWorktreesDefaultUri(this.path);\n\t}\n\n\tdeleteWorktree(uri: Uri, options?: { force?: boolean }): Promise<void> {\n\t\treturn this.container.git.deleteWorktree(this.path, uri.fsPath, options);\n\t}\n\n\tasync hasRemotes(): Promise<boolean> {\n\t\tconst remotes = await this.getRemotes();\n\t\treturn remotes?.length > 0;\n\t}\n\n\tasync hasRichRemote(connectedOnly: boolean = false): Promise<boolean> {\n\t\tconst remote = await this.getRichRemote(connectedOnly);\n\t\treturn remote?.provider != null;\n\t}\n\n\tasync hasUpstreamBranch(): Promise<boolean> {\n\t\tconst branch = await this.getBranch();\n\t\treturn branch?.upstream != null;\n\t}\n\n\t@log()\n\tmerge(...args: string[]) {\n\t\tthis.runTerminalCommand('merge', ...args);\n\t}\n\n\t@gate()\n\t@log()\n\tasync pull(options: { progress?: boolean; rebase?: boolean } = {}) {\n\t\tconst { progress, ...opts } = { progress: true, ...options };\n\t\tif (!progress) return this.pullCore();\n\n\t\treturn void (await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Pulling ${this.formattedName}...`,\n\t\t\t},\n\t\t\t() => this.pullCore(opts),\n\t\t));\n\t}\n\n\tprivate async pullCore(options: { rebase?: boolean } = {}) {\n\t\ttry {\n\t\t\tconst upstream = await this.hasUpstreamBranch();\n\t\t\tif (upstream) {\n\t\t\t\tvoid (await executeCoreGitCommand(\n\t\t\t\t\toptions.rebase ? CoreGitCommands.PullRebase : CoreGitCommands.Pull,\n\t\t\t\t\tthis.path,\n\t\t\t\t));\n\t\t\t} else if (configuration.getAny<boolean>(CoreGitConfiguration.FetchOnPull, Uri.file(this.path))) {\n\t\t\t\tvoid (await this.container.git.fetch(this.path));\n\t\t\t}\n\n\t\t\tthis.fireChange(RepositoryChange.Unknown);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to pull repository');\n\t\t}\n\t}\n\n\t@gate()\n\t@log()\n\tasync push(\n\t\toptions: {\n\t\t\tforce?: boolean;\n\t\t\tprogress?: boolean;\n\t\t\treference?: GitReference;\n\t\t\tpublish?: {\n\t\t\t\tremote: string;\n\t\t\t};\n\t\t} = {},\n\t) {\n\t\tconst { progress, ...opts } = { progress: true, ...options };\n\t\tif (!progress) return this.pushCore(opts);\n\n\t\treturn void (await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: GitReference.isBranch(opts.reference)\n\t\t\t\t\t? `${opts.publish != null ? 'Publishing ' : 'Pushing '}${opts.reference.name}...`\n\t\t\t\t\t: `Pushing ${this.formattedName}...`,\n\t\t\t},\n\t\t\t() => this.pushCore(opts),\n\t\t));\n\t}\n\n\tprivate async showCreatePullRequestPrompt(remoteName: string, branch: GitBranchReference) {\n\t\tif (!this.container.actionRunners.count('createPullRequest')) return;\n\t\tif (!(await Messages.showCreatePullRequestPrompt(branch.name))) return;\n\n\t\tconst remote = await this.getRemote(remoteName);\n\n\t\tvoid executeActionCommand<CreatePullRequestActionContext>('createPullRequest', {\n\t\t\trepoPath: this.path,\n\t\t\tremote:\n\t\t\t\tremote != null\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tname: remote.name,\n\t\t\t\t\t\t\tprovider:\n\t\t\t\t\t\t\t\tremote.provider != null\n\t\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\t\tid: remote.provider.id,\n\t\t\t\t\t\t\t\t\t\t\tname: remote.provider.name,\n\t\t\t\t\t\t\t\t\t\t\tdomain: remote.provider.domain,\n\t\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\turl: remote.url,\n\t\t\t\t\t  }\n\t\t\t\t\t: { name: remoteName },\n\t\t\tbranch: {\n\t\t\t\tname: branch.name,\n\t\t\t\tisRemote: branch.remote,\n\t\t\t\tupstream: branch.upstream?.name,\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate async pushCore(\n\t\toptions: {\n\t\t\tforce?: boolean;\n\t\t\treference?: GitReference;\n\t\t\tpublish?: {\n\t\t\t\tremote: string;\n\t\t\t};\n\t\t} = {},\n\t) {\n\t\ttry {\n\t\t\tif (GitReference.isBranch(options.reference)) {\n\t\t\t\tconst repo = await this.container.git.getOrOpenScmRepository(this.path);\n\t\t\t\tif (repo == null) return;\n\n\t\t\t\tif (options.publish != null) {\n\t\t\t\t\tawait repo?.push(options.publish.remote, options.reference.name, true);\n\t\t\t\t\tvoid this.showCreatePullRequestPrompt(options.publish.remote, options.reference);\n\t\t\t\t} else {\n\t\t\t\t\tconst branch = await this.getBranch(options.reference.name);\n\t\t\t\t\tif (branch == null) return;\n\n\t\t\t\t\tconst currentBranch = await this.getBranch();\n\t\t\t\t\tif (branch.id === currentBranch?.id) {\n\t\t\t\t\t\tvoid (await executeCoreGitCommand(\n\t\t\t\t\t\t\toptions.force ? CoreGitCommands.PushForce : CoreGitCommands.Push,\n\t\t\t\t\t\t\tthis.path,\n\t\t\t\t\t\t));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait repo?.push(branch.getRemoteName(), branch.name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (options.reference != null) {\n\t\t\t\tconst repo = await this.container.git.getOrOpenScmRepository(this.path);\n\t\t\t\tif (repo == null) return;\n\n\t\t\t\tconst branch = await this.getBranch();\n\t\t\t\tif (branch == null) return;\n\n\t\t\t\tawait repo?.push(branch.getRemoteName(), `${options.reference.ref}:${branch.getNameWithoutRemote()}`);\n\t\t\t} else {\n\t\t\t\tvoid (await executeCoreGitCommand(\n\t\t\t\t\toptions.force ? CoreGitCommands.PushForce : CoreGitCommands.Push,\n\t\t\t\t\tthis.path,\n\t\t\t\t));\n\t\t\t}\n\n\t\t\tthis.fireChange(RepositoryChange.Unknown);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to push repository');\n\t\t}\n\t}\n\n\t@log()\n\trebase(configs: string[] | undefined, ...args: string[]) {\n\t\tthis.runTerminalCommand(\n\t\t\tconfigs != null && configs.length !== 0 ? `${configs.join(' ')} rebase` : 'rebase',\n\t\t\t...args,\n\t\t);\n\t}\n\n\t@log()\n\treset(...args: string[]) {\n\t\tthis.runTerminalCommand('reset', ...args);\n\t}\n\n\tresetCaches(...affects: ('branches' | 'remotes')[]) {\n\t\tif (affects.length === 0 || affects.includes('branches')) {\n\t\t\tthis._branch = undefined;\n\t\t}\n\n\t\tif (affects.length === 0 || affects.includes('remotes')) {\n\t\t\tthis._remotes = undefined;\n\t\t\tthis._remotesDisposable?.dispose();\n\t\t\tthis._remotesDisposable = undefined;\n\t\t}\n\t}\n\n\tresume() {\n\t\tif (!this._suspended) return;\n\n\t\tthis._suspended = false;\n\n\t\t// If we've come back into focus and we are dirty, fire the change events\n\n\t\tif (this._pendingRepoChange != null) {\n\t\t\tthis._fireChangeDebounced!();\n\t\t}\n\n\t\tif (this._pendingFileSystemChange != null) {\n\t\t\tthis._fireFileSystemChangeDebounced!();\n\t\t}\n\t}\n\n\t@log()\n\trevert(...args: string[]) {\n\t\tthis.runTerminalCommand('revert', ...args);\n\t}\n\n\tsearchForCommits(\n\t\tsearch: SearchPattern,\n\t\toptions: { limit?: number; skip?: number } = {},\n\t): Promise<GitLog | undefined> {\n\t\treturn this.container.git.getLogForSearch(this.path, search, options);\n\t}\n\n\tget starred() {\n\t\tconst starred = this.container.storage.getWorkspace<Starred>(WorkspaceStorageKeys.StarredRepositories);\n\t\treturn starred != null && starred[this.id] === true;\n\t}\n\n\tstar(branch?: GitBranch) {\n\t\treturn this.updateStarred(true, branch);\n\t}\n\n\t@gate()\n\t@log()\n\tasync stashApply(stashName: string, options: { deleteAfter?: boolean } = {}) {\n\t\tvoid (await this.container.git.stashApply(this.path, stashName, options));\n\n\t\tthis.fireChange(RepositoryChange.Stash);\n\t}\n\n\t@gate()\n\t@log()\n\tasync stashDelete(stashName: string, ref?: string) {\n\t\tvoid (await this.container.git.stashDelete(this.path, stashName, ref));\n\n\t\tthis.fireChange(RepositoryChange.Stash);\n\t}\n\n\t@gate()\n\t@log()\n\tasync stashSave(message?: string, uris?: Uri[], options: { includeUntracked?: boolean; keepIndex?: boolean } = {}) {\n\t\tvoid (await this.container.git.stashSave(this.path, message, uris, options));\n\n\t\tthis.fireChange(RepositoryChange.Stash);\n\t}\n\n\t@gate()\n\t@log()\n\tasync switch(ref: string, options: { createBranch?: string | undefined; progress?: boolean } = {}) {\n\t\tconst { progress, ...opts } = { progress: true, ...options };\n\t\tif (!progress) return this.switchCore(ref, opts);\n\n\t\treturn void (await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Switching ${this.formattedName} to ${ref}...`,\n\t\t\t\tcancellable: false,\n\t\t\t},\n\t\t\t() => this.switchCore(ref, opts),\n\t\t));\n\t}\n\n\tprivate async switchCore(ref: string, options: { createBranch?: string } = {}) {\n\t\ttry {\n\t\t\tvoid (await this.container.git.checkout(this.path, ref, options));\n\n\t\t\tthis.fireChange(RepositoryChange.Unknown);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\t\t\tvoid Messages.showGenericErrorMessage('Unable to switch to reference');\n\t\t}\n\t}\n\n\ttoAbsoluteUri(path: string, options?: { validate?: boolean }): Uri | undefined {\n\t\tconst uri = this.container.git.getAbsoluteUri(path, this.path);\n\t\treturn !(options?.validate ?? true) || this.containsUri(uri) ? uri : undefined;\n\t}\n\n\tunstar(branch?: GitBranch) {\n\t\treturn this.updateStarred(false, branch);\n\t}\n\n\tprivate async updateStarred(star: boolean, branch?: GitBranch) {\n\t\tif (branch != null) {\n\t\t\tawait this.updateStarredCore(WorkspaceStorageKeys.StarredBranches, branch.id, star);\n\t\t} else {\n\t\t\tawait this.updateStarredCore(WorkspaceStorageKeys.StarredRepositories, this.id, star);\n\t\t}\n\n\t\tthis.fireChange(RepositoryChange.Starred);\n\t}\n\n\tprivate async updateStarredCore(key: WorkspaceStorageKeys, id: string, star: boolean) {\n\t\tlet starred = this.container.storage.getWorkspace<Starred>(key);\n\t\tif (starred === undefined) {\n\t\t\tstarred = Object.create(null) as Starred;\n\t\t}\n\n\t\tif (star) {\n\t\t\tstarred[id] = true;\n\t\t} else {\n\t\t\tconst { [id]: _, ...rest } = starred;\n\t\t\tstarred = rest;\n\t\t}\n\t\tawait this.container.storage.storeWorkspace(key, starred);\n\n\t\tthis.fireChange(RepositoryChange.Starred);\n\t}\n\n\tstartWatchingFileSystem(): Disposable {\n\t\tthis._fsWatchCounter++;\n\t\tif (this._fsWatcherDisposable == null) {\n\t\t\tconst watcher = workspace.createFileSystemWatcher(new RelativePattern(this.uri, '**'));\n\t\t\tthis._fsWatcherDisposable = Disposable.from(\n\t\t\t\twatcher,\n\t\t\t\twatcher.onDidChange(this.onFileSystemChanged, this),\n\t\t\t\twatcher.onDidCreate(this.onFileSystemChanged, this),\n\t\t\t\twatcher.onDidDelete(this.onFileSystemChanged, this),\n\t\t\t);\n\t\t}\n\n\t\treturn { dispose: () => this.stopWatchingFileSystem() };\n\t}\n\n\tstopWatchingFileSystem(force: boolean = false) {\n\t\tif (this._fsWatcherDisposable == null) return;\n\t\tif (--this._fsWatchCounter > 0 && !force) return;\n\n\t\tthis._fsWatchCounter = 0;\n\t\tthis._fsWatcherDisposable.dispose();\n\t\tthis._fsWatcherDisposable = undefined;\n\t}\n\n\tsuspend() {\n\t\tthis._suspended = true;\n\t}\n\n\t@log()\n\ttag(...args: string[]) {\n\t\tthis.runTerminalCommand('tag', ...args);\n\t}\n\n\t@log()\n\ttagDelete(tags: GitTagReference | GitTagReference[]) {\n\t\tif (!Array.isArray(tags)) {\n\t\t\ttags = [tags];\n\t\t}\n\n\t\tconst args = ['--delete'];\n\t\tthis.runTerminalCommand('tag', ...args, ...tags.map(t => t.ref));\n\t}\n\n\t@debug()\n\tprivate fireChange(...changes: RepositoryChange[]) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tthis._updatedAt = Date.now();\n\n\t\tif (this._fireChangeDebounced == null) {\n\t\t\tthis._fireChangeDebounced = debounce(this.fireChangeCore.bind(this), 250);\n\t\t}\n\n\t\tthis._pendingRepoChange = this._pendingRepoChange?.with(changes) ?? new RepositoryChangeEvent(this, changes);\n\n\t\tthis.onDidRepositoryChange(this, new RepositoryChangeEvent(this, changes));\n\n\t\tif (this._suspended) {\n\t\t\tLogger.debug(cc, `queueing suspended ${this._pendingRepoChange.toString(true)}`);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._fireChangeDebounced();\n\t}\n\n\tprivate fireChangeCore() {\n\t\tconst e = this._pendingRepoChange;\n\t\tif (e == null) return;\n\n\t\tthis._pendingRepoChange = undefined;\n\n\t\tLogger.debug(`Repository(${this.id}) firing ${e.toString(true)}`);\n\t\tthis._onDidChange.fire(e);\n\t}\n\n\t@debug()\n\tprivate fireFileSystemChange(uri: Uri) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tthis._updatedAt = Date.now();\n\n\t\tif (this._fireFileSystemChangeDebounced == null) {\n\t\t\tthis._fireFileSystemChangeDebounced = debounce(this.fireFileSystemChangeCore.bind(this), 2500);\n\t\t}\n\n\t\tif (this._pendingFileSystemChange == null) {\n\t\t\tthis._pendingFileSystemChange = { repository: this, uris: [] };\n\t\t}\n\n\t\tconst e = this._pendingFileSystemChange;\n\t\te.uris.push(uri);\n\n\t\tif (this._suspended) {\n\t\t\tLogger.debug(cc, `queueing suspended fs changes=${e.uris.map(u => u.fsPath).join(', ')}`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._fireFileSystemChangeDebounced();\n\t}\n\n\tprivate async fireFileSystemChangeCore() {\n\t\tlet e = this._pendingFileSystemChange;\n\t\tif (e == null) return;\n\n\t\tthis._pendingFileSystemChange = undefined;\n\n\t\tconst uris = await this.container.git.excludeIgnoredUris(this.path, e.uris);\n\t\tif (uris.length === 0) return;\n\n\t\tif (uris.length !== e.uris.length) {\n\t\t\te = { ...e, uris: uris };\n\t\t}\n\n\t\tLogger.debug(`Repository(${this.id}) firing fs changes=${e.uris.map(u => u.fsPath).join(', ')}`);\n\n\t\tthis._onDidChangeFileSystem.fire(e);\n\t}\n\n\tprivate runTerminalCommand(command: string, ...args: string[]) {\n\t\tconst parsedArgs = args.map(arg =>\n\t\t\targ.startsWith('#') || arg.includes(\"'\") || arg.includes('(') || arg.includes(')') ? `\"${arg}\"` : arg,\n\t\t);\n\t\trunGitCommandInTerminal(command, parsedArgs.join(' '), this.path, true);\n\n\t\tsetTimeout(() => this.fireChange(RepositoryChange.Unknown), 2500);\n\t}\n}\n","import { configuration, DateStyle, TagSorting } from '../../configuration';\nimport { Container } from '../../container';\nimport { formatDate, fromNow } from '../../system/date';\nimport { memoize } from '../../system/decorators/memoize';\nimport { sortCompare } from '../../system/string';\nimport { GitReference, GitTagReference } from './reference';\n\nexport interface TagSortOptions {\n\tcurrent?: boolean;\n\torderBy?: TagSorting;\n}\n\nexport class GitTag implements GitTagReference {\n\tstatic is(tag: any): tag is GitTag {\n\t\treturn tag instanceof GitTag;\n\t}\n\n\tstatic isOfRefType(tag: GitReference | undefined) {\n\t\treturn tag?.refType === 'tag';\n\t}\n\n\tstatic sort(tags: GitTag[], options?: TagSortOptions) {\n\t\toptions = { orderBy: configuration.get('sortTagsBy'), ...options };\n\n\t\tswitch (options.orderBy) {\n\t\t\tcase TagSorting.DateAsc:\n\t\t\t\treturn tags.sort((a, b) => a.date.getTime() - b.date.getTime());\n\t\t\tcase TagSorting.NameAsc:\n\t\t\t\treturn tags.sort((a, b) => sortCompare(a.name, b.name));\n\t\t\tcase TagSorting.NameDesc:\n\t\t\t\treturn tags.sort((a, b) => sortCompare(b.name, a.name));\n\t\t\tcase TagSorting.DateDesc:\n\t\t\tdefault:\n\t\t\t\treturn tags.sort((a, b) => b.date.getTime() - a.date.getTime());\n\t\t}\n\t}\n\n\treadonly refType = 'tag';\n\n\tconstructor(\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly name: string,\n\t\tpublic readonly sha: string,\n\t\tpublic readonly message: string,\n\t\tpublic readonly date: Date,\n\t\tpublic readonly commitDate: Date | undefined,\n\t) {}\n\n\tget formattedDate(): string {\n\t\treturn Container.instance.TagDateFormatting.dateStyle === DateStyle.Absolute\n\t\t\t? this.formatDate(Container.instance.TagDateFormatting.dateFormat)\n\t\t\t: this.formatDateFromNow();\n\t}\n\n\tget ref() {\n\t\treturn this.name;\n\t}\n\n\t@memoize<GitTag['formatCommitDate']>(format => format ?? 'MMMM Do, YYYY h:mma')\n\tformatCommitDate(format?: string | null) {\n\t\treturn this.commitDate != null ? formatDate(this.commitDate, format ?? 'MMMM Do, YYYY h:mma') : '';\n\t}\n\n\tformatCommitDateFromNow() {\n\t\treturn this.commitDate != null ? fromNow(this.commitDate) : '';\n\t}\n\n\t@memoize<GitTag['formatDate']>(format => format ?? 'MMMM Do, YYYY h:mma')\n\tformatDate(format?: string | null) {\n\t\treturn formatDate(this.date, format ?? 'MMMM Do, YYYY h:mma');\n\t}\n\n\tformatDateFromNow() {\n\t\treturn fromNow(this.date);\n\t}\n\n\t@memoize()\n\tgetBasename(): string {\n\t\tconst index = this.name.lastIndexOf('/');\n\t\treturn index !== -1 ? this.name.substring(index + 1) : this.name;\n\t}\n}\n","export interface GitUser {\n\tname: string | undefined;\n\temail: string | undefined;\n\n\tid?: string | undefined;\n\tusername?: string | undefined;\n}\n\nexport function isUserMatch(\n\tuser: GitUser | undefined,\n\tname: string | undefined,\n\temail: string | undefined,\n\tusername?: string | undefined,\n): boolean {\n\treturn (\n\t\tuser != null &&\n\t\t// Name or e-mail is provided\n\t\t(user.name != null || user.email != null || user.username != null) &&\n\t\t// Match on name if provided\n\t\t(user.name == null || user.name === name) &&\n\t\t// Match on email if provided\n\t\t(user.email == null || user.email === email) &&\n\t\t// Match on username if provided\n\t\t(user.username == null || user.username === username)\n\t);\n}\n","import { BranchSorting, configuration, DateStyle } from '../../configuration';\nimport { Container } from '../../container';\nimport { Starred, WorkspaceStorageKeys } from '../../storage';\nimport { formatDate, fromNow } from '../../system/date';\nimport { debug } from '../../system/decorators/log';\nimport { memoize } from '../../system/decorators/memoize';\nimport { sortCompare } from '../../system/string';\nimport { PullRequest, PullRequestState } from './pullRequest';\nimport { GitBranchReference, GitReference, GitRevision } from './reference';\nimport { GitRemote } from './remote';\nimport { GitStatus } from './status';\n\nconst whitespaceRegex = /\\s/;\nconst detachedHEADRegex = /^(?=.*\\bHEAD\\b)?(?=.*\\bdetached\\b).*$/;\n\nexport interface GitTrackingState {\n\tahead: number;\n\tbehind: number;\n}\n\nexport const enum GitBranchStatus {\n\tAhead = 'ahead',\n\tBehind = 'behind',\n\tDiverged = 'diverged',\n\tLocal = 'local',\n\tMissingUpstream = 'missingUpstream',\n\tRemote = 'remote',\n\tUpToDate = 'upToDate',\n\tUnpublished = 'unpublished',\n}\n\nexport interface BranchSortOptions {\n\tcurrent?: boolean;\n\tmissingUpstream?: boolean;\n\torderBy?: BranchSorting;\n}\n\nexport class GitBranch implements GitBranchReference {\n\tstatic is(branch: any): branch is GitBranch {\n\t\treturn branch instanceof GitBranch;\n\t}\n\n\tstatic isOfRefType(branch: GitReference | undefined) {\n\t\treturn branch?.refType === 'branch';\n\t}\n\n\tstatic sort(branches: GitBranch[], options?: BranchSortOptions) {\n\t\toptions = { current: true, orderBy: configuration.get('sortBranchesBy'), ...options };\n\n\t\tswitch (options.orderBy) {\n\t\t\tcase BranchSorting.DateAsc:\n\t\t\t\treturn branches.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(options!.missingUpstream\n\t\t\t\t\t\t\t? (a.upstream?.missing ? -1 : 1) - (b.upstream?.missing ? -1 : 1)\n\t\t\t\t\t\t\t: 0) ||\n\t\t\t\t\t\t(options!.current ? (a.current ? -1 : 1) - (b.current ? -1 : 1) : 0) ||\n\t\t\t\t\t\t(a.starred ? -1 : 1) - (b.starred ? -1 : 1) ||\n\t\t\t\t\t\t(b.remote ? -1 : 1) - (a.remote ? -1 : 1) ||\n\t\t\t\t\t\t(a.date == null ? -1 : a.date.getTime()) - (b.date == null ? -1 : b.date.getTime()),\n\t\t\t\t);\n\t\t\tcase BranchSorting.NameAsc:\n\t\t\t\treturn branches.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(options!.missingUpstream\n\t\t\t\t\t\t\t? (a.upstream?.missing ? -1 : 1) - (b.upstream?.missing ? -1 : 1)\n\t\t\t\t\t\t\t: 0) ||\n\t\t\t\t\t\t(options!.current ? (a.current ? -1 : 1) - (b.current ? -1 : 1) : 0) ||\n\t\t\t\t\t\t(a.starred ? -1 : 1) - (b.starred ? -1 : 1) ||\n\t\t\t\t\t\t(a.name === 'main' ? -1 : 1) - (b.name === 'main' ? -1 : 1) ||\n\t\t\t\t\t\t(a.name === 'master' ? -1 : 1) - (b.name === 'master' ? -1 : 1) ||\n\t\t\t\t\t\t(a.name === 'develop' ? -1 : 1) - (b.name === 'develop' ? -1 : 1) ||\n\t\t\t\t\t\t(b.remote ? -1 : 1) - (a.remote ? -1 : 1) ||\n\t\t\t\t\t\tsortCompare(a.name, b.name),\n\t\t\t\t);\n\t\t\tcase BranchSorting.NameDesc:\n\t\t\t\treturn branches.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(options!.missingUpstream\n\t\t\t\t\t\t\t? (a.upstream?.missing ? -1 : 1) - (b.upstream?.missing ? -1 : 1)\n\t\t\t\t\t\t\t: 0) ||\n\t\t\t\t\t\t(options!.current ? (a.current ? -1 : 1) - (b.current ? -1 : 1) : 0) ||\n\t\t\t\t\t\t(a.starred ? -1 : 1) - (b.starred ? -1 : 1) ||\n\t\t\t\t\t\t(a.name === 'main' ? -1 : 1) - (b.name === 'main' ? -1 : 1) ||\n\t\t\t\t\t\t(a.name === 'master' ? -1 : 1) - (b.name === 'master' ? -1 : 1) ||\n\t\t\t\t\t\t(a.name === 'develop' ? -1 : 1) - (b.name === 'develop' ? -1 : 1) ||\n\t\t\t\t\t\t(b.remote ? -1 : 1) - (a.remote ? -1 : 1) ||\n\t\t\t\t\t\tsortCompare(b.name, a.name),\n\t\t\t\t);\n\t\t\tcase BranchSorting.DateDesc:\n\t\t\tdefault:\n\t\t\t\treturn branches.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(options!.missingUpstream\n\t\t\t\t\t\t\t? (a.upstream?.missing ? -1 : 1) - (b.upstream?.missing ? -1 : 1)\n\t\t\t\t\t\t\t: 0) ||\n\t\t\t\t\t\t(options!.current ? (a.current ? -1 : 1) - (b.current ? -1 : 1) : 0) ||\n\t\t\t\t\t\t(a.starred ? -1 : 1) - (b.starred ? -1 : 1) ||\n\t\t\t\t\t\t(b.remote ? -1 : 1) - (a.remote ? -1 : 1) ||\n\t\t\t\t\t\t(b.date == null ? -1 : b.date.getTime()) - (a.date == null ? -1 : a.date.getTime()),\n\t\t\t\t);\n\t\t}\n\t}\n\n\treadonly refType = 'branch';\n\treadonly detached: boolean;\n\treadonly id: string;\n\treadonly upstream?: { name: string; missing: boolean };\n\treadonly state: GitTrackingState;\n\n\tconstructor(\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly name: string,\n\t\tpublic readonly remote: boolean,\n\t\tpublic readonly current: boolean,\n\t\tpublic readonly date: Date | undefined,\n\t\tpublic readonly sha?: string,\n\t\tupstream?: { name: string; missing: boolean },\n\t\tahead: number = 0,\n\t\tbehind: number = 0,\n\t\tdetached: boolean = false,\n\t\tpublic readonly rebasing: boolean = false,\n\t) {\n\t\tthis.id = `${repoPath}|${remote ? 'remotes/' : 'heads/'}${name}`;\n\n\t\tthis.detached = detached || (this.current ? GitBranch.isDetached(name) : false);\n\t\tif (this.detached) {\n\t\t\tthis.name = GitBranch.formatDetached(this.sha!);\n\t\t}\n\n\t\tthis.upstream = upstream?.name == null || upstream.name.length === 0 ? undefined : upstream;\n\t\tthis.state = {\n\t\t\tahead: ahead,\n\t\t\tbehind: behind,\n\t\t};\n\t}\n\n\tget formattedDate(): string {\n\t\treturn Container.instance.BranchDateFormatting.dateStyle === DateStyle.Absolute\n\t\t\t? this.formatDate(Container.instance.BranchDateFormatting.dateFormat)\n\t\t\t: this.formatDateFromNow();\n\t}\n\n\tget ref() {\n\t\treturn this.detached ? this.sha! : this.name;\n\t}\n\n\t@memoize<GitBranch['formatDate']>(format => format ?? 'MMMM Do, YYYY h:mma')\n\tformatDate(format?: string | null): string {\n\t\treturn this.date != null ? formatDate(this.date, format ?? 'MMMM Do, YYYY h:mma') : '';\n\t}\n\n\tformatDateFromNow(): string {\n\t\treturn this.date != null ? fromNow(this.date) : '';\n\t}\n\n\t@debug()\n\tasync getAssociatedPullRequest(options?: {\n\t\tavatarSize?: number;\n\t\tinclude?: PullRequestState[];\n\t\tlimit?: number;\n\t\ttimeout?: number;\n\t}): Promise<PullRequest | undefined> {\n\t\tconst remote = await this.getRemote();\n\t\tif (remote == null) return undefined;\n\n\t\treturn Container.instance.git.getPullRequestForBranch(this.getNameWithoutRemote(), remote, options);\n\t}\n\n\t@memoize()\n\tgetBasename(): string {\n\t\tconst name = this.getNameWithoutRemote();\n\t\tconst index = name.lastIndexOf('/');\n\t\treturn index !== -1 ? name.substring(index + 1) : name;\n\t}\n\n\t@memoize()\n\tgetNameWithoutRemote(): string {\n\t\treturn this.remote ? this.name.substring(this.name.indexOf('/') + 1) : this.name;\n\t}\n\n\t@memoize()\n\tgetTrackingWithoutRemote(): string | undefined {\n\t\treturn this.upstream?.name.substring(this.upstream.name.indexOf('/') + 1);\n\t}\n\n\t@memoize()\n\tasync getRemote(): Promise<GitRemote | undefined> {\n\t\tconst remoteName = this.getRemoteName();\n\t\tif (remoteName == null) return undefined;\n\n\t\tconst remotes = await Container.instance.git.getRemotesWithProviders(this.repoPath);\n\t\tif (remotes.length === 0) return undefined;\n\n\t\treturn remotes.find(r => r.name === remoteName);\n\t}\n\n\t@memoize()\n\tgetRemoteName(): string | undefined {\n\t\tif (this.remote) return GitBranch.getRemote(this.name);\n\t\tif (this.upstream != null) return GitBranch.getRemote(this.upstream.name);\n\n\t\treturn undefined;\n\t}\n\n\t@memoize()\n\tasync getStatus(): Promise<GitBranchStatus> {\n\t\tif (this.remote) return GitBranchStatus.Remote;\n\n\t\tif (this.upstream != null) {\n\t\t\tif (this.upstream.missing) return GitBranchStatus.MissingUpstream;\n\t\t\tif (this.state.ahead && this.state.behind) return GitBranchStatus.Diverged;\n\t\t\tif (this.state.ahead) return GitBranchStatus.Ahead;\n\t\t\tif (this.state.behind) return GitBranchStatus.Behind;\n\t\t\treturn GitBranchStatus.UpToDate;\n\t\t}\n\n\t\tconst remotes = await Container.instance.git.getRemotesWithProviders(this.repoPath);\n\t\tif (remotes.length > 0) return GitBranchStatus.Unpublished;\n\n\t\treturn GitBranchStatus.Local;\n\t}\n\n\tgetTrackingStatus(options?: {\n\t\tcount?: boolean;\n\t\tempty?: string;\n\t\texpand?: boolean;\n\t\ticons?: boolean;\n\t\tprefix?: string;\n\t\tseparator?: string;\n\t\tsuffix?: string;\n\t}): string {\n\t\treturn GitStatus.getUpstreamStatus(this.upstream, this.state, options);\n\t}\n\n\tget starred() {\n\t\tconst starred = Container.instance.storage.getWorkspace<Starred>(WorkspaceStorageKeys.StarredBranches);\n\t\treturn starred !== undefined && starred[this.id] === true;\n\t}\n\n\tstar() {\n\t\treturn Container.instance.git.getRepository(this.repoPath)?.star(this);\n\t}\n\n\tunstar() {\n\t\treturn Container.instance.git.getRepository(this.repoPath)?.unstar(this);\n\t}\n\n\tstatic formatDetached(sha: string): string {\n\t\treturn `(${GitRevision.shorten(sha)}...)`;\n\t}\n\n\tstatic getNameWithoutRemote(name: string): string {\n\t\treturn name.substring(name.indexOf('/') + 1);\n\t}\n\n\tstatic getRemote(name: string): string {\n\t\treturn name.substring(0, name.indexOf('/'));\n\t}\n\n\tstatic isDetached(name: string): boolean {\n\t\t// If there is whitespace in the name assume this is not a valid branch name\n\t\t// Deals with detached HEAD states\n\t\treturn whitespaceRegex.test(name) || detachedHEADRegex.test(name);\n\t}\n}\n","import { Uri } from 'vscode';\nimport { getAvatarUri } from '../../avatars';\nimport { DateSource, DateStyle, GravatarDefaultStyle } from '../../configuration';\nimport { GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { formatDate, fromNow } from '../../system/date';\nimport { gate } from '../../system/decorators/gate';\nimport { memoize } from '../../system/decorators/memoize';\nimport { cancellable } from '../../system/promise';\nimport { pad, pluralize } from '../../system/string';\nimport { PreviousLineComparisionUrisResult } from '../gitProvider';\nimport { GitUri } from '../gitUri';\nimport { GitFile, GitFileChange, GitFileWorkingTreeStatus } from './file';\nimport { PullRequest } from './pullRequest';\nimport { GitReference, GitRevision, GitRevisionReference, GitStashReference } from './reference';\n\nconst stashNumberRegex = /stash@{(\\d+)}/;\n\nexport class GitCommit implements GitRevisionReference {\n\tstatic is(commit: any): commit is GitCommit {\n\t\treturn commit instanceof GitCommit;\n\t}\n\n\tstatic isStash(commit: any): commit is GitStashCommit {\n\t\treturn commit instanceof GitCommit && commit.refType === 'stash' && Boolean(commit.stashName);\n\t}\n\n\tstatic isOfRefType(commit: GitReference | undefined): boolean {\n\t\treturn commit?.refType === 'revision' || commit?.refType === 'stash';\n\t}\n\n\tstatic hasFullDetails(commit: GitCommit): commit is GitCommit & SomeNonNullable<GitCommit, 'message' | 'files'> {\n\t\treturn (\n\t\t\tcommit.message != null &&\n\t\t\tcommit.files != null &&\n\t\t\tcommit.parents.length !== 0 &&\n\t\t\t(!commit.stashName || commit._stashUntrackedFilesLoaded)\n\t\t);\n\t}\n\n\tprivate _stashUntrackedFilesLoaded = false;\n\tprivate _recomputeStats = false;\n\n\treadonly lines: GitCommitLine[];\n\treadonly ref: string;\n\treadonly refType: GitRevisionReference['refType'];\n\treadonly shortSha: string;\n\treadonly stashName: string | undefined;\n\t// TODO@eamodio rename to stashNumber\n\treadonly number: string | undefined;\n\n\tconstructor(\n\t\tprivate readonly container: Container,\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly sha: string,\n\t\tpublic readonly author: GitCommitIdentity,\n\t\tpublic readonly committer: GitCommitIdentity,\n\t\tsummary: string,\n\t\tpublic readonly parents: string[],\n\t\tmessage?: string | undefined,\n\t\tfiles?: GitFileChange | GitFileChange[] | { file?: GitFileChange; files?: GitFileChange[] } | undefined,\n\t\tstats?: GitCommitStats,\n\t\tlines?: GitCommitLine | GitCommitLine[] | undefined,\n\t\tstashName?: string | undefined,\n\t) {\n\t\tthis.ref = this.sha;\n\t\tthis.refType = stashName ? 'stash' : 'revision';\n\t\tthis.shortSha = this.sha.substring(0, this.container.CommitShaFormatting.length);\n\n\t\t// Add an ellipsis to the summary if there is or might be more message\n\t\tif (message != null) {\n\t\t\tthis._message = message;\n\t\t\tif (this.summary !== message) {\n\t\t\t\tthis._summary = `${summary} ${GlyphChars.Ellipsis}`;\n\t\t\t} else {\n\t\t\t\tthis._summary = summary;\n\t\t\t}\n\t\t} else {\n\t\t\tthis._summary = `${summary} ${GlyphChars.Ellipsis}`;\n\t\t}\n\n\t\t// Keep this above files, because we check this in computing the stats\n\t\tif (stats != null) {\n\t\t\tthis._stats = stats;\n\t\t}\n\n\t\tif (files != null) {\n\t\t\tif (Array.isArray(files)) {\n\t\t\t\tthis._files = files;\n\t\t\t} else if (files instanceof GitFileChange) {\n\t\t\t\tthis._file = files;\n\t\t\t\tif (GitRevision.isUncommitted(sha, true)) {\n\t\t\t\t\tthis._files = [files];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (files.file != null) {\n\t\t\t\t\tthis._file = files.file;\n\t\t\t\t}\n\n\t\t\t\tif (files.files != null) {\n\t\t\t\t\tthis._files = files.files;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._recomputeStats = true;\n\t\t}\n\n\t\tif (lines != null) {\n\t\t\tif (Array.isArray(lines)) {\n\t\t\t\tthis.lines = lines;\n\t\t\t} else {\n\t\t\t\tthis.lines = [lines];\n\t\t\t}\n\t\t} else {\n\t\t\tthis.lines = [];\n\t\t}\n\n\t\tif (stashName) {\n\t\t\tthis.stashName = stashName || undefined;\n\t\t\tthis.number = stashNumberRegex.exec(stashName)?.[1];\n\t\t}\n\t}\n\n\tget date(): Date {\n\t\treturn this.container.CommitDateFormatting.dateSource === DateSource.Committed\n\t\t\t? this.committer.date\n\t\t\t: this.author.date;\n\t}\n\n\tprivate _file: GitFileChange | undefined;\n\tget file(): GitFileChange | undefined {\n\t\treturn this._file;\n\t}\n\n\tprivate _files: GitFileChange[] | undefined;\n\tget files(): readonly GitFileChange[] | undefined {\n\t\treturn this._files;\n\t}\n\n\tget formattedDate(): string {\n\t\treturn this.container.CommitDateFormatting.dateStyle === DateStyle.Absolute\n\t\t\t? this.formatDate(this.container.CommitDateFormatting.dateFormat)\n\t\t\t: this.formatDateFromNow();\n\t}\n\n\t@memoize()\n\tget isUncommitted(): boolean {\n\t\treturn GitRevision.isUncommitted(this.sha);\n\t}\n\n\t@memoize()\n\tget isUncommittedStaged(): boolean {\n\t\treturn GitRevision.isUncommittedStaged(this.sha);\n\t}\n\n\tprivate _message: string | undefined;\n\tget message(): string | undefined {\n\t\treturn this._message;\n\t}\n\n\tget name(): string {\n\t\treturn this.stashName ? this.stashName : this.shortSha;\n\t}\n\n\tprivate _stats: GitCommitStats | undefined;\n\tget stats(): GitCommitStats | undefined {\n\t\tif (this._recomputeStats) {\n\t\t\tthis.computeFileStats();\n\t\t}\n\n\t\treturn this._stats;\n\t}\n\n\tprivate _summary: string;\n\tget summary(): string {\n\t\treturn this._summary;\n\t}\n\n\tprivate _resolvedPreviousSha: string | undefined;\n\tget unresolvedPreviousSha(): string {\n\t\tif (this._resolvedPreviousSha != null) return this._resolvedPreviousSha;\n\t\tif (this.file != null) return this.file.previousSha ?? `${this.sha}^`;\n\t\treturn this.parents[0] ?? `${this.sha}^`;\n\t}\n\n\t@gate()\n\tasync ensureFullDetails(): Promise<void> {\n\t\tif (this.isUncommitted || GitCommit.hasFullDetails(this)) return;\n\n\t\tconst [commitResult, untrackedResult] = await Promise.allSettled([\n\t\t\tthis.container.git.getCommit(this.repoPath, this.sha),\n\t\t\t// Check for any untracked files -- since git doesn't return them via `git stash list` :(\n\t\t\t// See https://stackoverflow.com/questions/12681529/\n\t\t\tthis.stashName ? this.container.git.getCommit(this.repoPath, `${this.stashName}^3`) : undefined,\n\t\t\tthis.getPreviousSha(),\n\t\t]);\n\t\tif (commitResult.status !== 'fulfilled' || commitResult.value == null) return;\n\n\t\tlet commit = commitResult.value;\n\t\tthis.parents.push(...(commit.parents ?? []));\n\t\tthis._summary = commit.summary;\n\t\tthis._message = commit.message;\n\t\tthis._files = commit.files as GitFileChange[];\n\n\t\tif (this._file != null) {\n\t\t\tconst file = this._files.find(f => f.path === this._file!.path);\n\t\t\tif (file != null) {\n\t\t\t\tthis._file = new GitFileChange(\n\t\t\t\t\tfile.repoPath,\n\t\t\t\t\tfile.path,\n\t\t\t\t\tfile.status,\n\t\t\t\t\tfile.originalPath ?? this._file.originalPath,\n\t\t\t\t\tfile.previousSha ?? this._file.previousSha,\n\t\t\t\t\tfile.stats ?? this._file.stats,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (untrackedResult.status === 'fulfilled' && untrackedResult.value != null) {\n\t\t\tthis._stashUntrackedFilesLoaded = true;\n\t\t\tcommit = untrackedResult.value;\n\t\t\tif (commit?.files != null && commit.files.length !== 0) {\n\t\t\t\t// Since these files are untracked -- make them look that way\n\t\t\t\tconst files = commit.files.map(\n\t\t\t\t\tf => new GitFileChange(this.repoPath, f.path, GitFileWorkingTreeStatus.Untracked, f.originalPath),\n\t\t\t\t);\n\n\t\t\t\tif (this._files == null) {\n\t\t\t\t\tthis._files = files;\n\t\t\t\t} else {\n\t\t\t\t\tthis._files.push(...files);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._recomputeStats = true;\n\t}\n\n\tprivate computeFileStats(): void {\n\t\tif (!this._recomputeStats || this._files == null) return;\n\t\tthis._recomputeStats = false;\n\n\t\tconst changedFiles = {\n\t\t\tadded: 0,\n\t\t\tdeleted: 0,\n\t\t\tchanged: 0,\n\t\t};\n\n\t\tlet additions = 0;\n\t\tlet deletions = 0;\n\t\tfor (const file of this._files) {\n\t\t\tif (file.stats != null) {\n\t\t\t\tadditions += file.stats.additions;\n\t\t\t\tdeletions += file.stats.deletions;\n\t\t\t}\n\n\t\t\tswitch (file.status) {\n\t\t\t\tcase 'A':\n\t\t\t\tcase '?':\n\t\t\t\t\tchangedFiles.added++;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'D':\n\t\t\t\t\tchangedFiles.deleted++;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tchangedFiles.changed++;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (this._stats != null) {\n\t\t\tif (additions === 0 && this._stats.additions !== 0) {\n\t\t\t\tadditions = this._stats.additions;\n\t\t\t}\n\t\t\tif (deletions === 0 && this._stats.deletions !== 0) {\n\t\t\t\tdeletions = this._stats.deletions;\n\t\t\t}\n\t\t}\n\n\t\tthis._stats = { ...this._stats, changedFiles: changedFiles, additions: additions, deletions: deletions };\n\t}\n\n\tasync findFile(path: string): Promise<GitFileChange | undefined>;\n\tasync findFile(uri: Uri): Promise<GitFileChange | undefined>;\n\tasync findFile(pathOrUri: string | Uri): Promise<GitFileChange | undefined> {\n\t\tif (this._files == null) {\n\t\t\tawait this.ensureFullDetails();\n\t\t\tif (this._files == null) return undefined;\n\t\t}\n\n\t\tconst relativePath = this.container.git.getRelativePath(pathOrUri, this.repoPath);\n\t\treturn this._files.find(f => f.path === relativePath);\n\t}\n\n\tformatDate(format?: string | null) {\n\t\treturn this.container.CommitDateFormatting.dateSource === DateSource.Committed\n\t\t\t? this.committer.formatDate(format)\n\t\t\t: this.author.formatDate(format);\n\t}\n\n\tformatDateFromNow(short?: boolean) {\n\t\treturn this.container.CommitDateFormatting.dateSource === DateSource.Committed\n\t\t\t? this.committer.fromNow(short)\n\t\t\t: this.author.fromNow(short);\n\t}\n\n\tformatStats(options?: {\n\t\tcompact?: boolean;\n\t\tempty?: string;\n\t\texpand?: boolean;\n\t\tprefix?: string;\n\t\tsectionSeparator?: string;\n\t\tseparator?: string;\n\t\tsuffix?: string;\n\t}): string {\n\t\tconst stats = this.stats;\n\t\tif (stats == null) return options?.empty ?? '';\n\n\t\tconst { changedFiles, additions, deletions } = stats;\n\t\tif (changedFiles <= 0 && additions <= 0 && deletions <= 0) return options?.empty ?? '';\n\n\t\tconst {\n\t\t\tcompact = false,\n\t\t\texpand = false,\n\t\t\tprefix = '',\n\t\t\tsectionSeparator = ` ${pad(GlyphChars.Dot, 1, 1, GlyphChars.Space)} `,\n\t\t\tseparator = ' ',\n\t\t\tsuffix = '',\n\t\t} = options ?? {};\n\n\t\tlet status = prefix;\n\n\t\tif (typeof changedFiles === 'number') {\n\t\t\tif (changedFiles) {\n\t\t\t\tstatus += expand ? `${pluralize('file', changedFiles)} changed` : `~${changedFiles}`;\n\t\t\t}\n\t\t} else {\n\t\t\tconst { added, changed, deleted } = changedFiles;\n\t\t\tif (added) {\n\t\t\t\tstatus += expand ? `${pluralize('file', added)} added` : `+${added}`;\n\t\t\t} else if (!expand && !compact) {\n\t\t\t\tstatus += '+0';\n\t\t\t}\n\n\t\t\tif (changed) {\n\t\t\t\tstatus += `${added ? separator : ''}${\n\t\t\t\t\texpand ? `${pluralize('file', changed)} changed` : `~${changed}`\n\t\t\t\t}`;\n\t\t\t} else if (!expand && !compact) {\n\t\t\t\tstatus += '~0';\n\t\t\t}\n\n\t\t\tif (deleted) {\n\t\t\t\tstatus += `${changed | additions ? separator : ''}${\n\t\t\t\t\texpand ? `${pluralize('file', deleted)} deleted` : `-${deleted}`\n\t\t\t\t}`;\n\t\t\t} else if (!expand && !compact) {\n\t\t\t\tstatus += '-0';\n\t\t\t}\n\t\t}\n\n\t\tif (expand) {\n\t\t\tif (additions) {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\t\t\tstatus += `${changedFiles ? sectionSeparator : ''}${pluralize('addition', additions)}`;\n\t\t\t}\n\n\t\t\tif (deletions) {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\t\t\tstatus += `${changedFiles || additions ? separator : ''}${pluralize('deletion', deletions)}`;\n\t\t\t}\n\t\t}\n\n\t\tstatus += suffix;\n\n\t\treturn status;\n\t}\n\n\tprivate _pullRequest: Promise<PullRequest | undefined> | undefined;\n\tasync getAssociatedPullRequest(options?: { timeout?: number }): Promise<PullRequest | undefined> {\n\t\tif (this._pullRequest == null) {\n\t\t\tasync function getCore(this: GitCommit): Promise<PullRequest | undefined> {\n\t\t\t\tconst remote = await this.container.git.getRichRemoteProvider(this.repoPath);\n\t\t\t\tif (remote?.provider == null) return undefined;\n\n\t\t\t\treturn this.container.git.getPullRequestForCommit(this.ref, remote, options);\n\t\t\t}\n\t\t\tthis._pullRequest = getCore.call(this);\n\t\t}\n\n\t\treturn cancellable(this._pullRequest, options?.timeout);\n\t}\n\n\tgetAvatarUri(options?: { defaultStyle?: GravatarDefaultStyle; size?: number }): Uri | Promise<Uri> {\n\t\treturn this.author.getAvatarUri(this, options);\n\t}\n\n\tasync getCommitForFile(file: string | GitFile): Promise<GitCommit | undefined> {\n\t\tconst path = typeof file === 'string' ? this.container.git.getRelativePath(file, this.repoPath) : file.path;\n\t\tconst foundFile = await this.findFile(path);\n\t\tif (foundFile == null) return undefined;\n\n\t\tconst commit = this.with({ files: { file: foundFile } });\n\t\treturn commit;\n\t}\n\n\tasync getCommitsForFiles(): Promise<GitCommit[]> {\n\t\tif (this._files == null) {\n\t\t\tawait this.ensureFullDetails();\n\t\t\tif (this._files == null) return [];\n\t\t}\n\n\t\tconst commits = this._files.map(f => this.with({ files: { file: f } }));\n\t\treturn commits;\n\t}\n\n\t@memoize()\n\tgetGitUri(previous: boolean = false): GitUri {\n\t\tconst uri = this._file?.uri ?? this.container.git.getAbsoluteUri(this.repoPath, this.repoPath);\n\t\tif (!previous) return new GitUri(uri, this);\n\n\t\treturn new GitUri(this._file?.originalUri ?? uri, {\n\t\t\trepoPath: this.repoPath,\n\t\t\tsha: this.unresolvedPreviousSha,\n\t\t});\n\t}\n\n\t@memoize<GitCommit['getPreviousComparisonUrisForLine']>((el, ref) => `${el}|${ref ?? ''}`)\n\tgetPreviousComparisonUrisForLine(\n\t\teditorLine: number,\n\t\tref?: string,\n\t): Promise<PreviousLineComparisionUrisResult | undefined> {\n\t\treturn this.file != null\n\t\t\t? this.container.git.getPreviousComparisonUrisForLine(\n\t\t\t\t\tthis.repoPath,\n\t\t\t\t\tthis.file.uri,\n\t\t\t\t\teditorLine,\n\t\t\t\t\tref ?? (this.sha === GitRevision.uncommitted ? undefined : this.sha),\n\t\t\t  )\n\t\t\t: Promise.resolve(undefined);\n\t}\n\n\tprivate _previousShaPromise: Promise<string | undefined> | undefined;\n\tasync getPreviousSha(): Promise<string | undefined> {\n\t\tif (this._previousShaPromise == null) {\n\t\t\tasync function getCore(this: GitCommit) {\n\t\t\t\tif (this.file != null) {\n\t\t\t\t\tif (this.file.previousSha != null && GitRevision.isSha(this.file.previousSha)) {\n\t\t\t\t\t\treturn this.file.previousSha;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst sha = await this.container.git.resolveReference(\n\t\t\t\t\t\tthis.repoPath,\n\t\t\t\t\t\tGitRevision.isUncommitted(this.sha, true) ? 'HEAD' : `${this.sha}^`,\n\t\t\t\t\t\tthis.file.originalPath ?? this.file.path,\n\t\t\t\t\t);\n\t\t\t\t\treturn sha;\n\t\t\t\t}\n\n\t\t\t\tconst parent = this.parents[0];\n\t\t\t\tif (parent != null && GitRevision.isSha(parent)) return parent;\n\n\t\t\t\tconst sha = await this.container.git.resolveReference(\n\t\t\t\t\tthis.repoPath,\n\t\t\t\t\tGitRevision.isUncommitted(this.sha, true) ? 'HEAD' : `${this.sha}^`,\n\t\t\t\t);\n\t\t\t\treturn sha;\n\t\t\t}\n\n\t\t\tthis._previousShaPromise = getCore.call(this).then(sha => (this._resolvedPreviousSha = sha));\n\t\t}\n\n\t\treturn this._previousShaPromise;\n\t}\n\n\t@gate()\n\tasync isPushed(): Promise<boolean> {\n\t\treturn this.container.git.hasCommitBeenPushed(this.repoPath, this.ref);\n\t}\n\n\twith(changes: {\n\t\tsha?: string;\n\t\tparents?: string[];\n\t\tfiles?: { file?: GitFileChange | null; files?: GitFileChange[] | null } | null;\n\t\tlines?: GitCommitLine[];\n\t}): GitCommit {\n\t\tlet files;\n\t\tif (changes.files != null) {\n\t\t\tfiles = { file: this._file, files: this._files };\n\n\t\t\tif (changes.files.file != null) {\n\t\t\t\tfiles.file = changes.files.file;\n\t\t\t} else if (changes.files.file === null) {\n\t\t\t\tfiles.file = undefined;\n\t\t\t}\n\n\t\t\tif (changes.files.files != null) {\n\t\t\t\tfiles.files = changes.files.files;\n\t\t\t} else if (changes.files.files === null) {\n\t\t\t\tfiles.files = undefined;\n\t\t\t}\n\t\t} else if (changes.files === null) {\n\t\t\tfiles = undefined;\n\t\t}\n\n\t\treturn new GitCommit(\n\t\t\tthis.container,\n\t\t\tthis.repoPath,\n\t\t\tchanges.sha ?? this.sha,\n\t\t\tthis.author,\n\t\t\tthis.committer,\n\t\t\tthis.summary,\n\t\t\tthis.getChangedValue(changes.parents, this.parents) ?? [],\n\t\t\tthis.message,\n\t\t\tfiles,\n\t\t\tthis.stats,\n\t\t\tthis.getChangedValue(changes.lines, this.lines),\n\t\t\tthis.stashName,\n\t\t);\n\t}\n\n\tprotected getChangedValue<T>(change: T | null | undefined, original: T | undefined): T | undefined {\n\t\tif (change === undefined) return original;\n\t\treturn change !== null ? change : undefined;\n\t}\n}\n\nexport class GitCommitIdentity {\n\tconstructor(\n\t\tpublic readonly name: string,\n\t\tpublic readonly email: string | undefined,\n\t\tpublic readonly date: Date,\n\t\tprivate readonly avatarUrl?: string | undefined,\n\t) {}\n\n\t@memoize<GitCommitIdentity['formatDate']>(format => format ?? 'MMMM Do, YYYY h:mma')\n\tformatDate(format?: string | null): string {\n\t\treturn formatDate(this.date, format ?? 'MMMM Do, YYYY h:mma');\n\t}\n\n\tfromNow(short?: boolean): string {\n\t\treturn fromNow(this.date, short);\n\t}\n\n\tgetAvatarUri(\n\t\tcommit: GitCommit,\n\t\toptions?: { defaultStyle?: GravatarDefaultStyle; size?: number },\n\t): Uri | Promise<Uri> {\n\t\tif (this.avatarUrl != null) return Uri.parse(this.avatarUrl);\n\n\t\treturn getAvatarUri(this.email, commit, options);\n\t}\n}\n\nexport interface GitCommitLine {\n\tsha: string;\n\tpreviousSha?: string | undefined;\n\t/** The original (previous) line number prior to this commit; 1-based */\n\toriginalLine: number;\n\t/** The current line number in this commit; 1-based */\n\tline: number;\n}\n\nexport interface GitCommitStats {\n\treadonly additions: number;\n\treadonly deletions: number;\n\treadonly changedFiles: number | { added: number; deleted: number; changed: number };\n}\n\nexport interface GitStashCommit extends GitCommit {\n\treadonly refType: GitStashReference['refType'];\n\treadonly stashName: string;\n\treadonly number: string;\n}\n","import { GitDiffParser } from '../parsers/diffParser';\n\nexport interface GitDiffLine {\n\tline: string;\n\tstate: 'added' | 'removed' | 'unchanged';\n}\n\nexport interface GitDiffHunkLine {\n\thunk: GitDiffHunk;\n\tcurrent: GitDiffLine | undefined;\n\tprevious: GitDiffLine | undefined;\n}\n\nexport class GitDiffHunk {\n\tconstructor(\n\t\tpublic readonly diff: string,\n\t\tpublic current: {\n\t\t\tcount: number;\n\t\t\tposition: { start: number; end: number };\n\t\t},\n\t\tpublic previous: {\n\t\t\tcount: number;\n\t\t\tposition: { start: number; end: number };\n\t\t},\n\t) {}\n\n\tget lines(): GitDiffHunkLine[] {\n\t\treturn this.parseHunk().lines;\n\t}\n\n\tget state(): 'added' | 'changed' | 'removed' {\n\t\treturn this.parseHunk().state;\n\t}\n\n\tprivate parsedHunk: { lines: GitDiffHunkLine[]; state: 'added' | 'changed' | 'removed' } | undefined;\n\tprivate parseHunk() {\n\t\tif (this.parsedHunk == null) {\n\t\t\tthis.parsedHunk = GitDiffParser.parseHunk(this);\n\t\t}\n\t\treturn this.parsedHunk;\n\t}\n}\n\nexport interface GitDiff {\n\treadonly hunks: GitDiffHunk[];\n\n\treadonly diff?: string;\n}\n\nexport interface GitDiffShortStat {\n\treadonly additions: number;\n\treadonly deletions: number;\n\treadonly changedFiles: number;\n}\n\nexport type GitDiffFilter = 'A' | 'C' | 'D' | 'M' | 'R' | 'T' | 'U' | 'X' | 'B' | '*';\n","import { Uri } from 'vscode';\nimport { GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { memoize } from '../../system/decorators/memoize';\nimport { formatPath } from '../../system/formatPath';\nimport { relativeDir, splitPath } from '../../system/path';\nimport { pad, pluralize } from '../../system/string';\nimport { GitCommit } from './commit';\n\nexport declare type GitFileStatus = GitFileConflictStatus | GitFileIndexStatus | GitFileWorkingTreeStatus;\n\nexport const enum GitFileConflictStatus {\n\tAddedByBoth = 'AA',\n\tAddedByUs = 'AU',\n\tAddedByThem = 'UA',\n\tDeletedByBoth = 'DD',\n\tDeletedByUs = 'DU',\n\tDeletedByThem = 'UD',\n\tModifiedByBoth = 'UU',\n}\n\nexport const enum GitFileIndexStatus {\n\tModified = 'M',\n\tAdded = 'A',\n\tDeleted = 'D',\n\tRenamed = 'R',\n\tCopied = 'C',\n\tUnchanged = '.',\n\tUntracked = '?',\n\tIgnored = '!',\n\tUpdatedButUnmerged = 'U',\n}\n\nexport const enum GitFileWorkingTreeStatus {\n\tModified = 'M',\n\tAdded = 'A',\n\tDeleted = 'D',\n\tUntracked = '?',\n\tIgnored = '!',\n}\n\nexport interface GitFile {\n\tstatus: GitFileStatus;\n\treadonly repoPath?: string;\n\treadonly conflictStatus?: GitFileConflictStatus;\n\treadonly indexStatus?: GitFileIndexStatus;\n\treadonly workingTreeStatus?: GitFileWorkingTreeStatus;\n\treadonly path: string;\n\treadonly originalPath?: string;\n}\n\nexport interface GitFileWithCommit extends GitFile {\n\treadonly commit: GitCommit;\n}\n\nexport namespace GitFile {\n\texport function is(file: any | undefined): file is GitFile {\n\t\treturn (\n\t\t\tfile != null &&\n\t\t\t'fileName' in file &&\n\t\t\ttypeof file.fileName === 'string' &&\n\t\t\t'status' in file &&\n\t\t\ttypeof file.status === 'string' &&\n\t\t\tfile.status.length === 1\n\t\t);\n\t}\n\n\texport function getFormattedDirectory(\n\t\tfile: GitFile,\n\t\tincludeOriginal: boolean = false,\n\t\trelativeTo?: string,\n\t): string {\n\t\tconst directory = relativeDir(file.path, relativeTo);\n\t\treturn includeOriginal && (file.status === 'R' || file.status === 'C') && file.originalPath\n\t\t\t? `${directory} ${pad(GlyphChars.ArrowLeft, 1, 1)} ${file.originalPath}`\n\t\t\t: directory;\n\t}\n\n\texport function getFormattedPath(\n\t\tfile: GitFile,\n\t\toptions: { relativeTo?: string; suffix?: string; truncateTo?: number } = {},\n\t): string {\n\t\treturn formatPath(file.path, options);\n\t}\n\n\texport function getOriginalRelativePath(file: GitFile, relativeTo?: string): string {\n\t\tif (!file.originalPath) return '';\n\n\t\treturn splitPath(file.originalPath, relativeTo)[0];\n\t}\n\n\texport function getRelativePath(file: GitFile, relativeTo?: string): string {\n\t\treturn splitPath(file.path, relativeTo)[0];\n\t}\n\n\tconst statusIconsMap = {\n\t\t'.': undefined,\n\t\t'!': 'icon-status-ignored.svg',\n\t\t'?': 'icon-status-untracked.svg',\n\t\tA: 'icon-status-added.svg',\n\t\tD: 'icon-status-deleted.svg',\n\t\tM: 'icon-status-modified.svg',\n\t\tR: 'icon-status-renamed.svg',\n\t\tC: 'icon-status-copied.svg',\n\t\tAA: 'icon-status-conflict.svg',\n\t\tAU: 'icon-status-conflict.svg',\n\t\tUA: 'icon-status-conflict.svg',\n\t\tDD: 'icon-status-conflict.svg',\n\t\tDU: 'icon-status-conflict.svg',\n\t\tUD: 'icon-status-conflict.svg',\n\t\tUU: 'icon-status-conflict.svg',\n\t\tT: 'icon-status-modified.svg',\n\t\tU: 'icon-status-modified.svg',\n\t};\n\n\texport function getStatusIcon(status: GitFileStatus): string {\n\t\treturn statusIconsMap[status] ?? 'icon-status-unknown.svg';\n\t}\n\n\tconst statusCodiconsMap = {\n\t\t'.': undefined,\n\t\t'!': '$(diff-ignored)',\n\t\t'?': '$(diff-added)',\n\t\tA: '$(diff-added)',\n\t\tD: '$(diff-removed)',\n\t\tM: '$(diff-modified)',\n\t\tR: '$(diff-renamed)',\n\t\tC: '$(diff-added)',\n\t\tAA: '$(warning)',\n\t\tAU: '$(warning)',\n\t\tUA: '$(warning)',\n\t\tDD: '$(warning)',\n\t\tDU: '$(warning)',\n\t\tUD: '$(warning)',\n\t\tUU: '$(warning)',\n\t\tT: '$(diff-modified)',\n\t\tU: '$(diff-modified)',\n\t};\n\n\texport function getStatusCodicon(status: GitFileStatus, missing: string = GlyphChars.Space.repeat(4)): string {\n\t\treturn statusCodiconsMap[status] ?? missing;\n\t}\n\n\tconst statusTextMap = {\n\t\t'.': 'Unchanged',\n\t\t'!': 'Ignored',\n\t\t'?': 'Untracked',\n\t\tA: 'Added',\n\t\tD: 'Deleted',\n\t\tM: 'Modified',\n\t\tR: 'Renamed',\n\t\tC: 'Copied',\n\t\tAA: 'Conflict',\n\t\tAU: 'Conflict',\n\t\tUA: 'Conflict',\n\t\tDD: 'Conflict',\n\t\tDU: 'Conflict',\n\t\tUD: 'Conflict',\n\t\tUU: 'Conflict',\n\t\tT: 'Modified',\n\t\tU: 'Updated but Unmerged',\n\t};\n\n\texport function getStatusText(status: GitFileStatus): string {\n\t\treturn statusTextMap[status] ?? 'Unknown';\n\t}\n}\n\nexport interface GitFileChangeStats {\n\tadditions: number;\n\tdeletions: number;\n\tchanges: number;\n}\n\nexport class GitFileChange {\n\tstatic is(file: any): file is GitFileChange {\n\t\treturn file instanceof GitFileChange;\n\t}\n\n\tconstructor(\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly path: string,\n\t\tpublic readonly status: GitFileStatus,\n\t\tpublic readonly originalPath?: string | undefined,\n\t\tpublic readonly previousSha?: string | undefined,\n\t\tpublic readonly stats?: GitFileChangeStats | undefined,\n\t) {}\n\n\tget hasConflicts() {\n\t\tswitch (this.status) {\n\t\t\tcase GitFileConflictStatus.AddedByThem:\n\t\t\tcase GitFileConflictStatus.AddedByUs:\n\t\t\tcase GitFileConflictStatus.AddedByBoth:\n\t\t\tcase GitFileConflictStatus.DeletedByThem:\n\t\t\tcase GitFileConflictStatus.DeletedByUs:\n\t\t\tcase GitFileConflictStatus.DeletedByBoth:\n\t\t\tcase GitFileConflictStatus.ModifiedByBoth:\n\t\t\t\treturn true;\n\n\t\t\tdefault:\n\t\t\t\treturn false;\n\t\t}\n\t}\n\n\t@memoize()\n\tget uri(): Uri {\n\t\treturn Container.instance.git.getAbsoluteUri(this.path, this.repoPath);\n\t}\n\n\t@memoize()\n\tget originalUri(): Uri | undefined {\n\t\treturn this.originalPath ? Container.instance.git.getAbsoluteUri(this.originalPath, this.repoPath) : undefined;\n\t}\n\n\t@memoize()\n\tgetWorkingUri(): Promise<Uri | undefined> {\n\t\treturn Container.instance.git.getWorkingUri(this.repoPath, this.uri);\n\t}\n\n\tformatStats(options?: {\n\t\tcompact?: boolean;\n\t\tempty?: string;\n\t\texpand?: boolean;\n\t\tprefix?: string;\n\t\tseparator?: string;\n\t\tsuffix?: string;\n\t}): string {\n\t\tif (this.stats == null) return options?.empty ?? '';\n\n\t\tconst { /*changes,*/ additions, deletions } = this.stats;\n\t\tif (/*changes < 0 && */ additions < 0 && deletions < 0) return options?.empty ?? '';\n\n\t\tconst { compact = false, expand = false, prefix = '', separator = ' ', suffix = '' } = options ?? {};\n\n\t\tlet status = prefix;\n\n\t\tif (additions) {\n\t\t\tstatus += expand ? `${pluralize('line', additions)} added` : `+${additions}`;\n\t\t} else if (!expand && !compact) {\n\t\t\tstatus += '+0';\n\t\t}\n\n\t\t// if (changes) {\n\t\t// \tstatus += `${additions ? separator : ''}${\n\t\t// \t\texpand ? `${pluralize('line', changes)} changed` : `~${changes}`\n\t\t// \t}`;\n\t\t// } else if (!expand && !compact) {\n\t\t// \tstatus += '~0';\n\t\t// }\n\n\t\tif (deletions) {\n\t\t\tstatus += `${/*changes |*/ additions ? separator : ''}${\n\t\t\t\texpand ? `${pluralize('line', deletions)} deleted` : `-${deletions}`\n\t\t\t}`;\n\t\t} else if (!expand && !compact) {\n\t\t\tstatus += '-0';\n\t\t}\n\n\t\tstatus += suffix;\n\n\t\treturn status;\n\t}\n}\n","import { GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { GitBranch } from './branch';\n\nconst rangeRegex = /^(\\S*?)(\\.\\.\\.?)(\\S*)\\s*$/;\nconst shaLikeRegex = /(^[0-9a-f]{40}([\\^@~:]\\S*)?$)|(^[0]{40}(:|-)$)/;\nconst shaRegex = /(^[0-9a-f]{40}$)|(^[0]{40}(:|-)$)/;\nconst shaParentRegex = /(^[0-9a-f]{40})\\^[0-3]?$/;\nconst shaShortenRegex = /^(.*?)([\\^@~:].*)?$/;\nconst uncommittedRegex = /^[0]{40}(?:[\\^@~:]\\S*)?:?$/;\nconst uncommittedStagedRegex = /^[0]{40}([\\^@~]\\S*)?:$/;\n\nfunction isMatch(regex: RegExp, ref: string | undefined) {\n\treturn !ref ? false : regex.test(ref);\n}\n\nexport namespace GitRevision {\n\texport const deletedOrMissing = '0000000000000000000000000000000000000000-';\n\texport const uncommitted = '0000000000000000000000000000000000000000';\n\texport const uncommittedStaged = '0000000000000000000000000000000000000000:';\n\n\texport function createRange(\n\t\tref1: string | undefined,\n\t\tref2: string | undefined,\n\t\tnotation: '..' | '...' = '..',\n\t): string {\n\t\treturn `${ref1 ?? ''}${notation}${ref2 ?? ''}`;\n\t}\n\n\texport function isRange(ref: string | undefined) {\n\t\treturn ref?.includes('..') ?? false;\n\t}\n\n\texport function isSha(ref: string) {\n\t\treturn isMatch(shaRegex, ref);\n\t}\n\n\texport function isShaLike(ref: string) {\n\t\treturn isMatch(shaLikeRegex, ref);\n\t}\n\n\texport function isShaParent(ref: string) {\n\t\treturn isMatch(shaParentRegex, ref);\n\t}\n\n\texport function isUncommitted(ref: string | undefined, exact: boolean = false) {\n\t\treturn ref === uncommitted || ref === uncommittedStaged || (!exact && isMatch(uncommittedRegex, ref));\n\t}\n\n\texport function isUncommittedStaged(ref: string | undefined, exact: boolean = false): boolean {\n\t\treturn ref === uncommittedStaged || (!exact && isMatch(uncommittedStagedRegex, ref));\n\t}\n\n\texport function shorten(\n\t\tref: string | undefined,\n\t\t{\n\t\t\tforce,\n\t\t\tstrings = {},\n\t\t}: {\n\t\t\tforce?: boolean;\n\t\t\tstrings?: { uncommitted?: string; uncommittedStaged?: string; working?: string };\n\t\t} = {},\n\t) {\n\t\tif (ref === deletedOrMissing) return '(deleted)';\n\n\t\tif (!ref) return strings.working ?? '';\n\t\tif (isUncommitted(ref)) {\n\t\t\treturn isUncommittedStaged(ref)\n\t\t\t\t? strings.uncommittedStaged ?? 'Index'\n\t\t\t\t: strings.uncommitted ?? 'Working Tree';\n\t\t}\n\n\t\tif (GitRevision.isRange(ref)) return ref;\n\t\tif (!force && !isShaLike(ref)) return ref;\n\n\t\t// Don't allow shas to be shortened to less than 5 characters\n\t\tconst len = Math.max(5, Container.instance.config.advanced.abbreviatedShaLength);\n\n\t\t// If we have a suffix, append it\n\t\tconst match = shaShortenRegex.exec(ref);\n\t\tif (match != null) {\n\t\t\tconst [, rev, suffix] = match;\n\n\t\t\tif (suffix != null) {\n\t\t\t\treturn `${rev.substr(0, len)}${suffix}`;\n\t\t\t}\n\t\t}\n\n\t\treturn ref.substr(0, len);\n\t}\n\n\texport function splitRange(ref: string): { ref1: string; ref2: string; notation: '..' | '...' } | undefined {\n\t\tconst match = rangeRegex.exec(ref);\n\t\tif (match == null) return undefined;\n\n\t\tconst [, ref1, notation, ref2] = match;\n\t\treturn {\n\t\t\tref1: ref1,\n\t\t\tnotation: notation as '..' | '...',\n\t\t\tref2: ref2,\n\t\t};\n\t}\n}\n\nexport interface GitBranchReference {\n\treadonly refType: 'branch';\n\tname: string;\n\tref: string;\n\treadonly remote: boolean;\n\treadonly upstream?: { name: string; missing: boolean };\n\trepoPath: string;\n}\n\nexport interface GitRevisionReference {\n\treadonly refType: 'revision' | 'stash';\n\tname: string;\n\tref: string;\n\trepoPath: string;\n\n\tnumber?: string | undefined;\n\tmessage?: string | undefined;\n}\n\nexport interface GitStashReference {\n\treadonly refType: 'stash';\n\tname: string;\n\tref: string;\n\trepoPath: string;\n\tnumber: string | undefined;\n\n\tmessage?: string | undefined;\n}\n\nexport interface GitTagReference {\n\treadonly refType: 'tag';\n\tname: string;\n\tref: string;\n\trepoPath: string;\n}\n\nexport type GitReference = GitBranchReference | GitRevisionReference | GitStashReference | GitTagReference;\n\nexport namespace GitReference {\n\texport function create(\n\t\tref: string,\n\t\trepoPath: string,\n\t\toptions: { refType: 'branch'; name: string; remote: boolean; upstream?: { name: string; missing: boolean } },\n\t): GitBranchReference;\n\texport function create(\n\t\tref: string,\n\t\trepoPath: string,\n\t\toptions?: { refType: 'revision'; name?: string; message?: string },\n\t): GitRevisionReference;\n\texport function create(\n\t\tref: string,\n\t\trepoPath: string,\n\t\toptions: { refType: 'stash'; name: string; number: string | undefined; message?: string },\n\t): GitStashReference;\n\texport function create(ref: string, repoPath: string, options: { refType: 'tag'; name: string }): GitTagReference;\n\texport function create(\n\t\tref: string,\n\t\trepoPath: string,\n\t\toptions:\n\t\t\t| { refType: 'branch'; name: string; remote: boolean }\n\t\t\t| { refType?: 'revision'; name?: string; message?: string }\n\t\t\t| { refType: 'stash'; name: string; number: string | undefined; message?: string }\n\t\t\t| { refType: 'tag'; name: string } = { refType: 'revision' },\n\t): GitReference {\n\t\tswitch (options.refType) {\n\t\t\tcase 'branch':\n\t\t\t\treturn {\n\t\t\t\t\tname: options.name,\n\t\t\t\t\tref: ref,\n\t\t\t\t\trefType: 'branch',\n\t\t\t\t\tremote: options.remote,\n\t\t\t\t\trepoPath: repoPath,\n\t\t\t\t};\n\t\t\tcase 'stash':\n\t\t\t\treturn {\n\t\t\t\t\tname: options.name,\n\t\t\t\t\tref: ref,\n\t\t\t\t\trefType: 'stash',\n\t\t\t\t\trepoPath: repoPath,\n\t\t\t\t\tnumber: options.number,\n\t\t\t\t\tmessage: options.message,\n\t\t\t\t};\n\t\t\tcase 'tag':\n\t\t\t\treturn {\n\t\t\t\t\tname: options.name,\n\t\t\t\t\tref: ref,\n\t\t\t\t\trefType: 'tag',\n\t\t\t\t\trepoPath: repoPath,\n\t\t\t\t};\n\t\t\tdefault:\n\t\t\t\treturn {\n\t\t\t\t\tname:\n\t\t\t\t\t\toptions.name ?? GitRevision.shorten(ref, { force: true, strings: { working: 'Working Tree' } }),\n\t\t\t\t\tref: ref,\n\t\t\t\t\trefType: 'revision',\n\t\t\t\t\trepoPath: repoPath,\n\t\t\t\t\tmessage: options.message,\n\t\t\t\t};\n\t\t}\n\t}\n\n\texport function fromBranch(branch: GitBranchReference) {\n\t\treturn create(branch.ref, branch.repoPath, {\n\t\t\trefType: branch.refType,\n\t\t\tname: branch.name,\n\t\t\tremote: branch.remote,\n\t\t\tupstream: branch.upstream,\n\t\t});\n\t}\n\n\texport function fromTag(tag: GitTagReference) {\n\t\treturn create(tag.ref, tag.repoPath, {\n\t\t\trefType: tag.refType,\n\t\t\tname: tag.name,\n\t\t});\n\t}\n\n\texport function getNameWithoutRemote(ref: GitReference) {\n\t\tif (ref.refType === 'branch') {\n\t\t\treturn ref.remote ? GitBranch.getNameWithoutRemote(ref.name) : ref.name;\n\t\t}\n\t\treturn ref.name;\n\t}\n\n\texport function isBranch(ref: GitReference | undefined): ref is GitBranchReference {\n\t\treturn ref?.refType === 'branch';\n\t}\n\n\texport function isRevision(ref: GitReference | undefined): ref is GitRevisionReference {\n\t\treturn ref?.refType === 'revision';\n\t}\n\n\texport function isRevisionRange(ref: GitReference | undefined): ref is GitRevisionReference {\n\t\treturn ref?.refType === 'revision' && GitRevision.isRange(ref.ref);\n\t}\n\n\texport function isStash(ref: GitReference | undefined): ref is GitStashReference {\n\t\treturn ref?.refType === 'stash' || (ref?.refType === 'revision' && (ref as any)?.stashName);\n\t}\n\n\texport function isTag(ref: GitReference | undefined): ref is GitTagReference {\n\t\treturn ref?.refType === 'tag';\n\t}\n\n\texport function toString(\n\t\trefs: GitReference | GitReference[] | undefined,\n\t\toptions?: { capitalize?: boolean; expand?: boolean; icon?: boolean; label?: boolean; quoted?: boolean } | false,\n\t) {\n\t\tif (refs == null) return '';\n\n\t\toptions =\n\t\t\toptions === false\n\t\t\t\t? {}\n\t\t\t\t: { expand: true, icon: true, label: options?.label ?? options?.expand ?? true, ...options };\n\n\t\tlet result;\n\t\tif (!Array.isArray(refs) || refs.length === 1) {\n\t\t\tconst ref = Array.isArray(refs) ? refs[0] : refs;\n\t\t\tlet refName = options?.quoted ? `'${ref.name}'` : ref.name;\n\t\t\tswitch (ref.refType) {\n\t\t\t\tcase 'branch':\n\t\t\t\t\tresult = `${options.label ? `${ref.remote ? 'remote ' : ''}branch ` : ''}${\n\t\t\t\t\t\toptions.icon ? `$(git-branch)${GlyphChars.Space}${refName}` : refName\n\t\t\t\t\t}`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'tag':\n\t\t\t\t\tresult = `${options.label ? 'tag ' : ''}${\n\t\t\t\t\t\toptions.icon ? `$(tag)${GlyphChars.Space}${refName}` : refName\n\t\t\t\t\t}`;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault: {\n\t\t\t\t\tif (GitReference.isStash(ref)) {\n\t\t\t\t\t\tlet message;\n\t\t\t\t\t\tif (options.expand && ref.message) {\n\t\t\t\t\t\t\tmessage = `${ref.number != null ? `${ref.number}: ` : ''}${\n\t\t\t\t\t\t\t\tref.message.length > 20\n\t\t\t\t\t\t\t\t\t? `${ref.message.substring(0, 20).trimRight()}${GlyphChars.Ellipsis}`\n\t\t\t\t\t\t\t\t\t: ref.message\n\t\t\t\t\t\t\t}`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult = `${options.label ? 'stash ' : ''}${\n\t\t\t\t\t\t\toptions.icon\n\t\t\t\t\t\t\t\t? `$(archive)${GlyphChars.Space}${message ?? ref.name}`\n\t\t\t\t\t\t\t\t: `${message ?? ref.number ?? ref.name}`\n\t\t\t\t\t\t}`;\n\t\t\t\t\t} else if (GitRevision.isRange(ref.ref)) {\n\t\t\t\t\t\tresult = refName;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet message;\n\t\t\t\t\t\tif (options.expand && ref.message) {\n\t\t\t\t\t\t\tmessage =\n\t\t\t\t\t\t\t\tref.message.length > 20\n\t\t\t\t\t\t\t\t\t? ` (${ref.message.substring(0, 20).trimRight()}${GlyphChars.Ellipsis})`\n\t\t\t\t\t\t\t\t\t: ` (${ref.message})`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet prefix;\n\t\t\t\t\t\tif (options.expand && options.label && GitRevision.isShaParent(ref.ref)) {\n\t\t\t\t\t\t\trefName = ref.name.endsWith('^') ? ref.name.substr(0, ref.name.length - 1) : ref.name;\n\t\t\t\t\t\t\tif (options?.quoted) {\n\t\t\t\t\t\t\t\trefName = `'${refName}'`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tprefix = 'before ';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tprefix = '';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult = `${options.label ? `${prefix}commit ` : ''}${\n\t\t\t\t\t\t\toptions.icon\n\t\t\t\t\t\t\t\t? `$(git-commit)${GlyphChars.Space}${refName}${message ?? ''}`\n\t\t\t\t\t\t\t\t: `${refName}${message ?? ''}`\n\t\t\t\t\t\t}`;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn options.capitalize && options.expand && options.label !== false\n\t\t\t\t? `${result[0].toLocaleUpperCase()}${result.substring(1)}`\n\t\t\t\t: result;\n\t\t}\n\n\t\tconst expanded = options.expand ? ` (${refs.map(r => r.name).join(', ')})` : '';\n\t\tswitch (refs[0].refType) {\n\t\t\tcase 'branch':\n\t\t\t\treturn `${refs.length} branches${expanded}`;\n\t\t\tcase 'tag':\n\t\t\t\treturn `${refs.length} tags${expanded}`;\n\t\t\tdefault:\n\t\t\t\treturn `${refs.length} ${GitReference.isStash(refs[0]) ? 'stashes' : 'commits'}${expanded}`;\n\t\t}\n\t}\n}\n","import { DateStyle } from '../../config';\nimport { Container } from '../../container';\nimport { formatDate, fromNow } from '../../system/date';\nimport { memoize } from '../../system/decorators/memoize';\nimport { GitRevision } from './reference';\n\nexport interface GitReflog {\n\treadonly repoPath: string;\n\treadonly records: GitReflogRecord[];\n\n\treadonly count: number;\n\treadonly total: number;\n\treadonly limit: number | undefined;\n\treadonly hasMore: boolean;\n\tmore?(limit: number | undefined): Promise<GitReflog | undefined>;\n}\n\nexport class GitReflogRecord {\n\tprivate _previousSha: string | undefined;\n\n\tconstructor(\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly sha: string,\n\t\tprivate _selector: string,\n\t\tpublic readonly date: Date,\n\t\tpublic readonly command: string,\n\t\tpublic readonly commandArgs: string | undefined,\n\t\tpublic readonly details: string | undefined,\n\t) {}\n\n\t@memoize<GitReflogRecord['formatDate']>(format => format ?? 'MMMM Do, YYYY h:mma')\n\tformatDate(format?: string | null) {\n\t\treturn formatDate(this.date, format ?? 'MMMM Do, YYYY h:mma');\n\t}\n\n\tformatDateFromNow() {\n\t\treturn fromNow(this.date);\n\t}\n\n\tget formattedDate(): string {\n\t\treturn Container.instance.CommitDateFormatting.dateStyle === DateStyle.Absolute\n\t\t\t? this.formatDate(Container.instance.CommitDateFormatting.dateFormat)\n\t\t\t: this.formatDateFromNow();\n\t}\n\n\t@memoize()\n\tget HEAD() {\n\t\tif (this._selector == null || this._selector.length === 0) return '';\n\n\t\tif (this._selector.startsWith('refs/heads')) {\n\t\t\treturn this._selector.substr(11);\n\t\t}\n\n\t\tif (this._selector.startsWith('refs/remotes')) {\n\t\t\treturn this._selector.substr(13);\n\t\t}\n\n\t\treturn this._selector;\n\t}\n\n\tget previousSha() {\n\t\treturn this._previousSha;\n\t}\n\n\t@memoize()\n\tget previousShortSha() {\n\t\treturn GitRevision.shorten(this._previousSha);\n\t}\n\n\tget selector() {\n\t\treturn this._selector;\n\t}\n\n\t@memoize()\n\tget shortSha() {\n\t\treturn GitRevision.shorten(this.sha);\n\t}\n\n\tupdate(previousSha?: string, selector?: string) {\n\t\tif (previousSha !== undefined) {\n\t\t\tthis._previousSha = previousSha;\n\t\t}\n\t\tif (selector !== undefined) {\n\t\t\tthis._selector = selector;\n\t\t}\n\t}\n}\n","import { Uri } from 'vscode';\nimport { GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { memoize } from '../../system/decorators/memoize';\nimport { pluralize } from '../../system/string';\nimport { GitBranch, GitTrackingState } from './branch';\nimport { GitCommit, GitCommitIdentity } from './commit';\nimport {\n\tGitFile,\n\tGitFileChange,\n\tGitFileConflictStatus,\n\tGitFileIndexStatus,\n\tGitFileStatus,\n\tGitFileWorkingTreeStatus,\n} from './file';\nimport { GitRevision } from './reference';\nimport { GitRemote } from './remote';\nimport { GitUser } from './user';\n\nexport interface ComputedWorkingTreeGitStatus {\n\tstaged: number;\n\tstagedAddsAndChanges: GitStatusFile[];\n\tstagedStatus: string;\n\n\tunstaged: number;\n\tunstagedAddsAndChanges: GitStatusFile[];\n\tunstagedStatus: string;\n\n\tconflicted: number;\n\tconflictedAddsAndChanges: GitStatusFile[];\n\tconflictedStatus: string;\n}\n\nexport class GitStatus {\n\treadonly detached: boolean;\n\n\tconstructor(\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly branch: string,\n\t\tpublic readonly sha: string,\n\t\tpublic readonly files: GitStatusFile[],\n\t\tpublic readonly state: GitTrackingState,\n\t\tpublic readonly upstream?: string,\n\t\tpublic readonly rebasing: boolean = false,\n\t) {\n\t\tthis.detached = GitBranch.isDetached(branch);\n\t\tif (this.detached) {\n\t\t\tthis.branch = GitBranch.formatDetached(this.sha);\n\t\t}\n\t}\n\n\t@memoize()\n\tget conflicts() {\n\t\treturn this.files.filter(f => f.conflicted);\n\t}\n\n\tget hasChanges() {\n\t\treturn this.files.length !== 0;\n\t}\n\n\t@memoize()\n\tget hasConflicts() {\n\t\treturn this.files.some(f => f.conflicted);\n\t}\n\n\tget ref() {\n\t\treturn this.detached ? this.sha : this.branch;\n\t}\n\n\t@memoize()\n\tcomputeWorkingTreeStatus(): ComputedWorkingTreeGitStatus {\n\t\tlet conflictedAdds = 0;\n\t\tlet conflictedDeletes = 0;\n\t\tlet conflictedChanges = 0;\n\t\tlet stagedAdds = 0;\n\t\tlet unstagedAdds = 0;\n\t\tlet stagedChanges = 0;\n\t\tlet unstagedChanges = 0;\n\t\tlet stagedDeletes = 0;\n\t\tlet unstagedDeletes = 0;\n\n\t\tconst conflictedAddsAndChanges: GitStatusFile[] = [];\n\t\tconst stagedAddsAndChanges: GitStatusFile[] = [];\n\t\tconst unstagedAddsAndChanges: GitStatusFile[] = [];\n\n\t\tfor (const f of this.files) {\n\t\t\tswitch (f.conflictStatus) {\n\t\t\t\tcase undefined:\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase GitFileConflictStatus.AddedByBoth:\n\t\t\t\tcase GitFileConflictStatus.AddedByUs:\n\t\t\t\tcase GitFileConflictStatus.AddedByThem:\n\t\t\t\t\tconflictedAdds++;\n\t\t\t\t\tstagedAddsAndChanges.push(f);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase GitFileConflictStatus.DeletedByBoth:\n\t\t\t\tcase GitFileConflictStatus.DeletedByUs:\n\t\t\t\tcase GitFileConflictStatus.DeletedByThem:\n\t\t\t\t\tconflictedDeletes++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconflictedChanges++;\n\t\t\t\t\tconflictedAddsAndChanges.push(f);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tswitch (f.indexStatus) {\n\t\t\t\tcase undefined:\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase GitFileIndexStatus.Added:\n\t\t\t\t\tstagedAdds++;\n\t\t\t\t\tstagedAddsAndChanges.push(f);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase GitFileIndexStatus.Deleted:\n\t\t\t\t\tstagedDeletes++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tstagedChanges++;\n\t\t\t\t\tstagedAddsAndChanges.push(f);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tswitch (f.workingTreeStatus) {\n\t\t\t\tcase undefined:\n\t\t\t\tcase GitFileWorkingTreeStatus.Ignored:\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase GitFileWorkingTreeStatus.Added:\n\t\t\t\tcase GitFileWorkingTreeStatus.Untracked:\n\t\t\t\t\tunstagedAdds++;\n\t\t\t\t\tunstagedAddsAndChanges.push(f);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase GitFileWorkingTreeStatus.Deleted:\n\t\t\t\t\tunstagedDeletes++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tunstagedChanges++;\n\t\t\t\t\tunstagedAddsAndChanges.push(f);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconst conflicted = conflictedAdds + conflictedChanges + conflictedDeletes;\n\t\tconst staged = stagedAdds + stagedChanges + stagedDeletes;\n\t\tconst unstaged = unstagedAdds + unstagedChanges + unstagedDeletes;\n\n\t\treturn {\n\t\t\tconflicted: conflicted,\n\t\t\tconflictedAddsAndChanges: conflictedAddsAndChanges,\n\t\t\tconflictedStatus: conflicted > 0 ? `+${conflictedAdds} ~${conflictedChanges} -${conflictedDeletes}` : '',\n\t\t\tstaged: staged,\n\t\t\tstagedStatus: staged > 0 ? `+${stagedAdds} ~${stagedChanges} -${stagedDeletes}` : '',\n\t\t\tstagedAddsAndChanges: stagedAddsAndChanges,\n\t\t\tunstaged: unstaged,\n\t\t\tunstagedStatus: unstaged > 0 ? `+${unstagedAdds} ~${unstagedChanges} -${unstagedDeletes}` : '',\n\t\t\tunstagedAddsAndChanges: unstagedAddsAndChanges,\n\t\t};\n\t}\n\n\t@memoize()\n\tgetDiffStatus() {\n\t\tconst diff = {\n\t\t\tadded: 0,\n\t\t\tdeleted: 0,\n\t\t\tchanged: 0,\n\t\t};\n\n\t\tif (this.files.length === 0) return diff;\n\n\t\tfor (const f of this.files) {\n\t\t\tswitch (f.status) {\n\t\t\t\tcase 'A':\n\t\t\t\tcase '?':\n\t\t\t\t\tdiff.added++;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'D':\n\t\t\t\t\tdiff.deleted++;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tdiff.changed++;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn diff;\n\t}\n\n\tgetFormattedDiffStatus({\n\t\tcompact,\n\t\tempty,\n\t\texpand,\n\t\tprefix = '',\n\t\tseparator = ' ',\n\t\tsuffix = '',\n\t}: {\n\t\tcompact?: boolean;\n\t\tempty?: string;\n\t\texpand?: boolean;\n\t\tprefix?: string;\n\t\tseparator?: string;\n\t\tsuffix?: string;\n\t} = {}): string {\n\t\tconst { added, changed, deleted } = this.getDiffStatus();\n\t\tif (added === 0 && changed === 0 && deleted === 0) return empty ?? '';\n\n\t\tif (expand) {\n\t\t\tlet status = '';\n\t\t\tif (added) {\n\t\t\t\tstatus += `${pluralize('file', added)} added`;\n\t\t\t}\n\t\t\tif (changed) {\n\t\t\t\tstatus += `${status.length === 0 ? '' : separator}${pluralize('file', changed)} changed`;\n\t\t\t}\n\t\t\tif (deleted) {\n\t\t\t\tstatus += `${status.length === 0 ? '' : separator}${pluralize('file', deleted)} deleted`;\n\t\t\t}\n\t\t\treturn `${prefix}${status}${suffix}`;\n\t\t}\n\n\t\tlet status = '';\n\t\tif (compact) {\n\t\t\tif (added !== 0) {\n\t\t\t\tstatus += `+${added}`;\n\t\t\t}\n\t\t\tif (changed !== 0) {\n\t\t\t\tstatus += `${status.length === 0 ? '' : separator}~${changed}`;\n\t\t\t}\n\t\t\tif (deleted !== 0) {\n\t\t\t\tstatus += `${status.length === 0 ? '' : separator}-${deleted}`;\n\t\t\t}\n\t\t} else {\n\t\t\tstatus += `+${added}${separator}~${changed}${separator}-${deleted}`;\n\t\t}\n\n\t\treturn `${prefix}${status}${suffix}`;\n\t}\n\n\t@memoize()\n\tasync getRemote(): Promise<GitRemote | undefined> {\n\t\tif (this.upstream == null) return undefined;\n\n\t\tconst remotes = await Container.instance.git.getRemotesWithProviders(this.repoPath);\n\t\tif (remotes.length === 0) return undefined;\n\n\t\tconst remoteName = GitBranch.getRemote(this.upstream);\n\t\treturn remotes.find(r => r.name === remoteName);\n\t}\n\n\tgetUpstreamStatus(options: {\n\t\tempty?: string;\n\t\texpand?: boolean;\n\t\ticons?: boolean;\n\t\tprefix?: string;\n\t\tseparator?: string;\n\t\tsuffix?: string;\n\t}): string {\n\t\treturn GitStatus.getUpstreamStatus(\n\t\t\tthis.upstream ? { name: this.upstream, missing: false } : undefined,\n\t\t\tthis.state,\n\t\t\toptions,\n\t\t);\n\t}\n\n\tstatic getUpstreamStatus(\n\t\tupstream: { name: string; missing: boolean } | undefined,\n\t\tstate: { ahead: number; behind: number },\n\t\toptions: {\n\t\t\tcount?: boolean;\n\t\t\tempty?: string;\n\t\t\texpand?: boolean;\n\t\t\ticons?: boolean;\n\t\t\tprefix?: string;\n\t\t\tseparator?: string;\n\t\t\tsuffix?: string;\n\t\t} = {},\n\t): string {\n\t\tconst { count = true, expand = false, icons = false, prefix = '', separator = ' ', suffix = '' } = options;\n\t\tif (upstream == null || (state.behind === 0 && state.ahead === 0)) return options.empty ?? '';\n\n\t\tif (expand) {\n\t\t\tlet status = '';\n\t\t\tif (upstream.missing) {\n\t\t\t\tstatus = 'missing';\n\t\t\t} else {\n\t\t\t\tif (state.behind) {\n\t\t\t\t\tstatus += `${pluralize('commit', state.behind, {\n\t\t\t\t\t\tinfix: icons ? '$(arrow-down) ' : undefined,\n\t\t\t\t\t})} behind`;\n\t\t\t\t}\n\t\t\t\tif (state.ahead) {\n\t\t\t\t\tstatus += `${status.length === 0 ? '' : separator}${pluralize('commit', state.ahead, {\n\t\t\t\t\t\tinfix: icons ? '$(arrow-up) ' : undefined,\n\t\t\t\t\t})} ahead`;\n\t\t\t\t\tif (suffix.startsWith(` ${upstream.name.split('/')[0]}`)) {\n\t\t\t\t\t\tstatus += ' of';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn `${prefix}${status}${suffix}`;\n\t\t}\n\n\t\tconst showCounts = count && !upstream.missing;\n\n\t\treturn `${prefix}${showCounts ? state.behind : ''}${\n\t\t\tshowCounts || state.behind !== 0 ? GlyphChars.ArrowDown : ''\n\t\t}${separator}${showCounts ? state.ahead : ''}${\n\t\t\tshowCounts || state.ahead !== 0 ? GlyphChars.ArrowUp : ''\n\t\t}${suffix}`;\n\t}\n}\n\nexport class GitStatusFile implements GitFile {\n\tpublic readonly conflictStatus: GitFileConflictStatus | undefined;\n\tpublic readonly indexStatus: GitFileIndexStatus | undefined;\n\tpublic readonly workingTreeStatus: GitFileWorkingTreeStatus | undefined;\n\n\tconstructor(\n\t\tpublic readonly repoPath: string,\n\t\tx: string | undefined,\n\t\ty: string | undefined,\n\t\tpublic readonly path: string,\n\t\tpublic readonly originalPath?: string,\n\t) {\n\t\tif (x != null && y != null) {\n\t\t\tswitch (x + y) {\n\t\t\t\tcase '??':\n\t\t\t\t\tthis.workingTreeStatus = GitFileWorkingTreeStatus.Untracked;\n\t\t\t\t\tbreak;\n\t\t\t\tcase '!!':\n\t\t\t\t\tthis.workingTreeStatus = GitFileWorkingTreeStatus.Ignored;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'AA':\n\t\t\t\t\tthis.conflictStatus = GitFileConflictStatus.AddedByBoth;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'AU':\n\t\t\t\t\tthis.conflictStatus = GitFileConflictStatus.AddedByUs;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'UA':\n\t\t\t\t\tthis.conflictStatus = GitFileConflictStatus.AddedByThem;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'DD':\n\t\t\t\t\tthis.conflictStatus = GitFileConflictStatus.DeletedByBoth;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'DU':\n\t\t\t\t\tthis.conflictStatus = GitFileConflictStatus.DeletedByUs;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'UD':\n\t\t\t\t\tthis.conflictStatus = GitFileConflictStatus.DeletedByThem;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'UU':\n\t\t\t\t\tthis.conflictStatus = GitFileConflictStatus.ModifiedByBoth;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (this.conflictStatus == null) {\n\t\t\tswitch (x) {\n\t\t\t\tcase 'A':\n\t\t\t\t\tthis.indexStatus = GitFileIndexStatus.Added;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'D':\n\t\t\t\t\tthis.indexStatus = GitFileIndexStatus.Deleted;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'M':\n\t\t\t\t\tthis.indexStatus = GitFileIndexStatus.Modified;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'R':\n\t\t\t\t\tthis.indexStatus = GitFileIndexStatus.Renamed;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'C':\n\t\t\t\t\tthis.indexStatus = GitFileIndexStatus.Copied;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tswitch (y) {\n\t\t\t\tcase 'A':\n\t\t\t\t\tthis.workingTreeStatus = GitFileWorkingTreeStatus.Modified;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'D':\n\t\t\t\t\tthis.workingTreeStatus = GitFileWorkingTreeStatus.Modified;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'M':\n\t\t\t\t\tthis.workingTreeStatus = GitFileWorkingTreeStatus.Modified;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tget conflicted() {\n\t\treturn this.conflictStatus != null;\n\t}\n\n\tget edited() {\n\t\treturn this.workingTreeStatus != null;\n\t}\n\n\tget staged() {\n\t\treturn this.indexStatus != null;\n\t}\n\n\tget status(): GitFileStatus {\n\t\treturn (this.conflictStatus ?? this.indexStatus ?? this.workingTreeStatus)!;\n\t}\n\n\t@memoize()\n\tget uri(): Uri {\n\t\treturn Container.instance.git.getAbsoluteUri(this.path, this.repoPath);\n\t}\n\n\tgetFormattedDirectory(includeOriginal: boolean = false): string {\n\t\treturn GitFile.getFormattedDirectory(this, includeOriginal);\n\t}\n\n\tgetFormattedPath(options: { relativeTo?: string; suffix?: string; truncateTo?: number } = {}): string {\n\t\treturn GitFile.getFormattedPath(this, options);\n\t}\n\n\tgetOcticon() {\n\t\treturn GitFile.getStatusCodicon(this.status);\n\t}\n\n\tgetStatusText(): string {\n\t\treturn GitFile.getStatusText(this.status);\n\t}\n\n\tgetPseudoCommits(container: Container, user: GitUser | undefined): GitCommit[] {\n\t\tconst commits: GitCommit[] = [];\n\n\t\tconst now = new Date();\n\n\t\tif (this.conflictStatus != null) {\n\t\t\tcommits.push(\n\t\t\t\tnew GitCommit(\n\t\t\t\t\tcontainer,\n\t\t\t\t\tthis.repoPath,\n\t\t\t\t\tGitRevision.uncommitted,\n\t\t\t\t\tnew GitCommitIdentity('You', user?.email ?? undefined, now),\n\t\t\t\t\tnew GitCommitIdentity('You', user?.email ?? undefined, now),\n\t\t\t\t\t'Uncommitted changes',\n\t\t\t\t\t[GitRevision.uncommittedStaged],\n\t\t\t\t\t'Uncommitted changes',\n\t\t\t\t\tnew GitFileChange(\n\t\t\t\t\t\tthis.repoPath,\n\t\t\t\t\t\tthis.path,\n\t\t\t\t\t\tthis.status,\n\t\t\t\t\t\tthis.originalPath,\n\t\t\t\t\t\tGitRevision.uncommittedStaged,\n\t\t\t\t\t),\n\t\t\t\t\tundefined,\n\t\t\t\t\t[],\n\t\t\t\t),\n\t\t\t);\n\t\t\treturn commits;\n\t\t}\n\n\t\tif (this.workingTreeStatus == null && this.indexStatus == null) return commits;\n\n\t\tif (this.workingTreeStatus != null && this.indexStatus != null) {\n\t\t\t// Decrements the date to guarantee the staged entry will be sorted after the working entry (most recent first)\n\t\t\tconst older = new Date(now);\n\t\t\tolder.setMilliseconds(older.getMilliseconds() - 1);\n\n\t\t\tcommits.push(\n\t\t\t\tnew GitCommit(\n\t\t\t\t\tcontainer,\n\t\t\t\t\tthis.repoPath,\n\t\t\t\t\tGitRevision.uncommitted,\n\t\t\t\t\tnew GitCommitIdentity('You', user?.email ?? undefined, now),\n\t\t\t\t\tnew GitCommitIdentity('You', user?.email ?? undefined, now),\n\t\t\t\t\t'Uncommitted changes',\n\t\t\t\t\t[GitRevision.uncommittedStaged],\n\t\t\t\t\t'Uncommitted changes',\n\t\t\t\t\tnew GitFileChange(\n\t\t\t\t\t\tthis.repoPath,\n\t\t\t\t\t\tthis.path,\n\t\t\t\t\t\tthis.status,\n\t\t\t\t\t\tthis.originalPath,\n\t\t\t\t\t\tGitRevision.uncommittedStaged,\n\t\t\t\t\t),\n\t\t\t\t\tundefined,\n\t\t\t\t\t[],\n\t\t\t\t),\n\t\t\t\tnew GitCommit(\n\t\t\t\t\tcontainer,\n\t\t\t\t\tthis.repoPath,\n\t\t\t\t\tGitRevision.uncommittedStaged,\n\t\t\t\t\tnew GitCommitIdentity('You', user?.email ?? undefined, older),\n\t\t\t\t\tnew GitCommitIdentity('You', user?.email ?? undefined, older),\n\t\t\t\t\t'Uncommitted changes',\n\t\t\t\t\t['HEAD'],\n\t\t\t\t\t'Uncommitted changes',\n\t\t\t\t\tnew GitFileChange(this.repoPath, this.path, this.status, this.originalPath, 'HEAD'),\n\t\t\t\t\tundefined,\n\t\t\t\t\t[],\n\t\t\t\t),\n\t\t\t);\n\t\t} else {\n\t\t\tcommits.push(\n\t\t\t\tnew GitCommit(\n\t\t\t\t\tcontainer,\n\t\t\t\t\tthis.repoPath,\n\t\t\t\t\tthis.workingTreeStatus != null ? GitRevision.uncommitted : GitRevision.uncommittedStaged,\n\t\t\t\t\tnew GitCommitIdentity('You', user?.email ?? undefined, now),\n\t\t\t\t\tnew GitCommitIdentity('You', user?.email ?? undefined, now),\n\t\t\t\t\t'Uncommitted changes',\n\t\t\t\t\t['HEAD'],\n\t\t\t\t\t'Uncommitted changes',\n\t\t\t\t\tnew GitFileChange(this.repoPath, this.path, this.status, this.originalPath, 'HEAD'),\n\t\t\t\t\tundefined,\n\t\t\t\t\t[],\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\treturn commits;\n\t}\n}\n","import { Uri, workspace, WorkspaceFolder } from 'vscode';\nimport { Container } from '../../container';\nimport { memoize } from '../../system/decorators/memoize';\nimport { normalizePath, relative } from '../../system/path';\nimport { GitBranch } from './branch';\nimport { GitRevision } from './reference';\nimport type { GitStatus } from './status';\n\nexport class GitWorktree {\n\tstatic is(worktree: any): worktree is GitWorktree {\n\t\treturn worktree instanceof GitWorktree;\n\t}\n\n\tconstructor(\n\t\tpublic readonly main: boolean,\n\t\tpublic readonly type: 'bare' | 'branch' | 'detached',\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly uri: Uri,\n\t\tpublic readonly locked: boolean | string,\n\t\tpublic readonly prunable: boolean | string,\n\t\tpublic readonly sha?: string,\n\t\tpublic readonly branch?: string,\n\t) {}\n\n\tget opened(): boolean {\n\t\treturn this.workspaceFolder?.uri.toString() === this.uri.toString();\n\t}\n\n\tget name(): string {\n\t\tswitch (this.type) {\n\t\t\tcase 'bare':\n\t\t\t\treturn '(bare)';\n\t\t\tcase 'detached':\n\t\t\t\treturn GitRevision.shorten(this.sha);\n\t\t\tdefault:\n\t\t\t\treturn this.branch || this.friendlyPath;\n\t\t}\n\t}\n\n\t@memoize()\n\tget friendlyPath(): string {\n\t\tconst path = GitWorktree.getFriendlyPath(this.uri);\n\t\treturn path;\n\t}\n\n\t@memoize()\n\tget workspaceFolder(): WorkspaceFolder | undefined {\n\t\treturn workspace.getWorkspaceFolder(this.uri);\n\t}\n\n\tprivate _branch: Promise<GitBranch | undefined> | undefined;\n\tgetBranch(): Promise<GitBranch | undefined> {\n\t\tif (this.type !== 'branch' || this.branch == null) return Promise.resolve(undefined);\n\n\t\tif (this._branch == null) {\n\t\t\tthis._branch = Container.instance.git\n\t\t\t\t.getBranches(this.repoPath, { filter: b => b.name === this.branch })\n\t\t\t\t.then(b => b.values[0]);\n\t\t}\n\t\treturn this._branch;\n\t}\n\n\tprivate _status: Promise<GitStatus | undefined> | undefined;\n\tgetStatus(options?: { force?: boolean }): Promise<GitStatus | undefined> {\n\t\tif (this.type === 'bare') return Promise.resolve(undefined);\n\n\t\tif (this._status == null || options?.force) {\n\t\t\tthis._status = Container.instance.git.getStatusForRepo(this.uri.fsPath);\n\t\t}\n\t\treturn this._status;\n\t}\n\n\tstatic getFriendlyPath(uri: Uri): string {\n\t\tconst folder = workspace.getWorkspaceFolder(uri);\n\t\tif (folder == null) return normalizePath(uri.fsPath);\n\n\t\tconst relativePath = normalizePath(relative(folder.uri.fsPath, uri.fsPath));\n\t\treturn relativePath.length === 0 ? folder.name : relativePath;\n\t}\n}\n","import { debug } from '../../system/decorators/log';\nimport { getLines } from '../../system/string';\nimport { GitDiff, GitDiffHunk, GitDiffHunkLine, GitDiffLine, GitDiffShortStat } from '../models/diff';\nimport { GitFile, GitFileStatus } from '../models/file';\n\nconst nameStatusDiffRegex = /^(.*?)\\t(.*?)(?:\\t(.*?))?$/gm;\nconst shortStatDiffRegex =\n\t/^\\s*(\\d+)\\sfiles? changed(?:,\\s+(\\d+)\\s+insertions?\\(\\+\\))?(?:,\\s+(\\d+)\\s+deletions?\\(-\\))?/;\nconst unifiedDiffRegex = /^@@ -([\\d]+)(?:,([\\d]+))? \\+([\\d]+)(?:,([\\d]+))? @@(?:.*?)\\n([\\s\\S]*?)(?=^@@)/gm;\n\nexport class GitDiffParser {\n\t@debug({ args: false, singleLine: true })\n\tstatic parse(data: string, debug: boolean = false): GitDiff | undefined {\n\t\tif (!data) return undefined;\n\n\t\tconst hunks: GitDiffHunk[] = [];\n\n\t\tlet previousStart;\n\t\tlet previousCount;\n\t\tlet currentStart;\n\t\tlet currentCount;\n\t\tlet hunk;\n\n\t\tlet match;\n\t\tdo {\n\t\t\tmatch = unifiedDiffRegex.exec(`${data}\\n@@`);\n\t\t\tif (match == null) break;\n\n\t\t\t[, previousStart, previousCount, currentStart, currentCount, hunk] = match;\n\n\t\t\tpreviousCount = Number(previousCount) || 0;\n\t\t\tpreviousStart = Number(previousStart) || 0;\n\t\t\tcurrentCount = Number(currentCount) || 0;\n\t\t\tcurrentStart = Number(currentStart) || 0;\n\n\t\t\thunks.push(\n\t\t\t\tnew GitDiffHunk(\n\t\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\t\t` ${hunk}`.substr(1),\n\t\t\t\t\t{\n\t\t\t\t\t\tcount: currentCount === 0 ? 1 : currentCount,\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tstart: currentStart,\n\t\t\t\t\t\t\tend: currentStart + (currentCount > 0 ? currentCount - 1 : 0),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tcount: previousCount === 0 ? 1 : previousCount,\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tstart: previousStart,\n\t\t\t\t\t\t\tend: previousStart + (previousCount > 0 ? previousCount - 1 : 0),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t);\n\t\t} while (true);\n\n\t\tif (!hunks.length) return undefined;\n\n\t\tconst diff: GitDiff = {\n\t\t\tdiff: debug ? data : undefined,\n\t\t\thunks: hunks,\n\t\t};\n\t\treturn diff;\n\t}\n\n\t@debug({ args: false, singleLine: true })\n\tstatic parseHunk(hunk: GitDiffHunk): { lines: GitDiffHunkLine[]; state: 'added' | 'changed' | 'removed' } {\n\t\tconst currentStart = hunk.current.position.start;\n\t\tconst previousStart = hunk.previous.position.start;\n\n\t\tconst currentLines: (GitDiffLine | undefined)[] =\n\t\t\tcurrentStart > previousStart\n\t\t\t\t? new Array(currentStart - previousStart).fill(undefined, 0, currentStart - previousStart)\n\t\t\t\t: [];\n\t\tconst previousLines: (GitDiffLine | undefined)[] =\n\t\t\tpreviousStart > currentStart\n\t\t\t\t? new Array(previousStart - currentStart).fill(undefined, 0, previousStart - currentStart)\n\t\t\t\t: [];\n\n\t\tlet hasAddedOrChanged;\n\t\tlet hasRemoved;\n\n\t\tlet removed = 0;\n\t\tfor (const l of getLines(hunk.diff)) {\n\t\t\tswitch (l[0]) {\n\t\t\t\tcase '+':\n\t\t\t\t\thasAddedOrChanged = true;\n\t\t\t\t\tcurrentLines.push({\n\t\t\t\t\t\tline: ` ${l.substring(1)}`,\n\t\t\t\t\t\tstate: 'added',\n\t\t\t\t\t});\n\n\t\t\t\t\tif (removed > 0) {\n\t\t\t\t\t\tremoved--;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpreviousLines.push(undefined);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase '-':\n\t\t\t\t\thasRemoved = true;\n\t\t\t\t\tremoved++;\n\n\t\t\t\t\tpreviousLines.push({\n\t\t\t\t\t\tline: ` ${l.substring(1)}`,\n\t\t\t\t\t\tstate: 'removed',\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\twhile (removed > 0) {\n\t\t\t\t\t\tremoved--;\n\t\t\t\t\t\tcurrentLines.push(undefined);\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrentLines.push({ line: l, state: 'unchanged' });\n\t\t\t\t\tpreviousLines.push({ line: l, state: 'unchanged' });\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\twhile (removed > 0) {\n\t\t\tremoved--;\n\t\t\tcurrentLines.push(undefined);\n\t\t}\n\n\t\tconst hunkLines: GitDiffHunkLine[] = [];\n\n\t\tfor (let i = 0; i < Math.max(currentLines.length, previousLines.length); i++) {\n\t\t\thunkLines.push({\n\t\t\t\thunk: hunk,\n\t\t\t\tcurrent: currentLines[i],\n\t\t\t\tprevious: previousLines[i],\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tlines: hunkLines,\n\t\t\tstate: hasAddedOrChanged && hasRemoved ? 'changed' : hasAddedOrChanged ? 'added' : 'removed',\n\t\t};\n\t}\n\n\t@debug({ args: false, singleLine: true })\n\tstatic parseNameStatus(data: string, repoPath: string): GitFile[] | undefined {\n\t\tif (!data) return undefined;\n\n\t\tconst files: GitFile[] = [];\n\n\t\tlet status: string;\n\t\tlet fileName: string;\n\t\tlet originalFileName: string;\n\n\t\tlet match: RegExpExecArray | null;\n\t\tdo {\n\t\t\tmatch = nameStatusDiffRegex.exec(data);\n\t\t\tif (match == null) break;\n\n\t\t\t[, status, fileName, originalFileName] = match;\n\n\t\t\tfiles.push({\n\t\t\t\trepoPath: repoPath,\n\t\t\t\tstatus: (!status.startsWith('.') ? status[0].trim() : '?') as GitFileStatus,\n\t\t\t\tconflictStatus: undefined,\n\t\t\t\tindexStatus: undefined,\n\t\t\t\tworkingTreeStatus: undefined,\n\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\tpath: ` ${fileName}`.substr(1),\n\t\t\t\t// Stops excessive memory usage -- https://bugs.chromium.org/p/v8/issues/detail?id=2869\n\t\t\t\toriginalPath:\n\t\t\t\t\toriginalFileName == null || originalFileName.length === 0\n\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t: ` ${originalFileName}`.substr(1),\n\t\t\t});\n\t\t} while (true);\n\n\t\treturn files;\n\t}\n\n\t@debug({ args: false, singleLine: true })\n\tstatic parseShortStat(data: string): GitDiffShortStat | undefined {\n\t\tif (!data) return undefined;\n\n\t\tconst match = shortStatDiffRegex.exec(data);\n\t\tif (match == null) return undefined;\n\n\t\tconst [, files, insertions, deletions] = match;\n\n\t\tconst diffShortStat: GitDiffShortStat = {\n\t\t\tchangedFiles: files == null ? 0 : parseInt(files, 10),\n\t\t\tadditions: insertions == null ? 0 : parseInt(insertions, 10),\n\t\t\tdeletions: deletions == null ? 0 : parseInt(deletions, 10),\n\t\t};\n\n\t\treturn diffShortStat;\n\t}\n}\n","import { Range, Uri } from 'vscode';\nimport { DynamicAutolinkReference } from '../../annotations/autolinks';\nimport { AutolinkReference } from '../../config';\nimport { Repository } from '../models/repository';\nimport { RemoteProvider } from './provider';\n\nconst gitRegex = /\\/_git\\/?/i;\nconst legacyDefaultCollectionRegex = /^DefaultCollection\\//i;\nconst orgAndProjectRegex = /^(.*?)\\/(.*?)\\/(.*)/;\nconst sshDomainRegex = /^(ssh|vs-ssh)\\./i;\nconst sshPathRegex = /^\\/?v\\d\\//i;\n\nconst fileRegex = /path=([^&]+)/i;\nconst rangeRegex = /line=(\\d+)(?:&lineEnd=(\\d+))?/;\n\nexport class AzureDevOpsRemote extends RemoteProvider {\n\tconstructor(domain: string, path: string, protocol?: string, name?: string, legacy: boolean = false) {\n\t\tif (sshDomainRegex.test(domain)) {\n\t\t\tpath = path.replace(sshPathRegex, '');\n\t\t\tdomain = domain.replace(sshDomainRegex, '');\n\n\t\t\t// Add in /_git/ into ssh urls\n\t\t\tconst match = orgAndProjectRegex.exec(path);\n\t\t\tif (match != null) {\n\t\t\t\tconst [, org, project, rest] = match;\n\n\t\t\t\t// Handle legacy vsts urls\n\t\t\t\tif (legacy) {\n\t\t\t\t\tdomain = `${org}.${domain}`;\n\t\t\t\t\tpath = `${project}/_git/${rest}`;\n\t\t\t\t} else {\n\t\t\t\t\tpath = `${org}/${project}/_git/${rest}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Azure DevOps allows projects and repository names with spaces. In that situation,\n\t\t// the `path` will be previously encoded during git clone\n\t\t// revert that encoding to avoid double-encoding by gitlens during copy remote and open remote\n\t\tpath = decodeURIComponent(path);\n\t\tsuper(domain, path, protocol, name);\n\t}\n\n\tprivate _autolinks: (AutolinkReference | DynamicAutolinkReference)[] | undefined;\n\toverride get autolinks(): (AutolinkReference | DynamicAutolinkReference)[] {\n\t\tif (this._autolinks === undefined) {\n\t\t\t// Strip off any `_git` part from the repo url\n\t\t\tconst workUrl = this.baseUrl.replace(gitRegex, '/');\n\t\t\tthis._autolinks = [\n\t\t\t\t{\n\t\t\t\t\tprefix: '#',\n\t\t\t\t\turl: `${workUrl}/_workitems/edit/<num>`,\n\t\t\t\t\ttitle: `Open Work Item #<num> on ${this.name}`,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t// Default Pull request message when merging a PR in ADO. Will not catch commits & pushes following a different pattern.\n\t\t\t\t\tprefix: 'Merged PR ',\n\t\t\t\t\turl: `${this.baseUrl}/pullrequest/<num>`,\n\t\t\t\t\ttitle: `Open Pull Request #<num> on ${this.name}`,\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\t\treturn this._autolinks;\n\t}\n\n\toverride get icon() {\n\t\treturn 'vsts';\n\t}\n\n\tget id() {\n\t\treturn 'azure-devops';\n\t}\n\n\tget name() {\n\t\treturn 'Azure DevOps';\n\t}\n\n\tprivate _displayPath: string | undefined;\n\toverride get displayPath(): string {\n\t\tif (this._displayPath === undefined) {\n\t\t\tthis._displayPath = this.path.replace(gitRegex, '/').replace(legacyDefaultCollectionRegex, '');\n\t\t}\n\t\treturn this._displayPath;\n\t}\n\n\tasync getLocalInfoFromRemoteUri(\n\t\trepository: Repository,\n\t\turi: Uri,\n\t\toptions?: { validate?: boolean },\n\t): Promise<{ uri: Uri; startLine?: number; endLine?: number } | undefined> {\n\t\tif (uri.authority !== this.domain) return Promise.resolve(undefined);\n\t\t// if ((options?.validate ?? true) && !uri.path.startsWith(`/${this.path}/`)) return undefined;\n\n\t\tlet startLine;\n\t\tlet endLine;\n\t\tif (uri.query) {\n\t\t\tconst match = rangeRegex.exec(uri.query);\n\t\t\tif (match != null) {\n\t\t\t\tconst [, start, end] = match;\n\t\t\t\tif (start) {\n\t\t\t\t\tstartLine = parseInt(start, 10);\n\t\t\t\t\tif (end) {\n\t\t\t\t\t\tendLine = parseInt(end, 10);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst match = fileRegex.exec(uri.query);\n\t\tif (match == null) return Promise.resolve(undefined);\n\n\t\tconst [, path] = match;\n\n\t\tconst absoluteUri = repository.toAbsoluteUri(path, { validate: options?.validate });\n\t\treturn Promise.resolve(\n\t\t\tabsoluteUri != null ? { uri: absoluteUri, startLine: startLine, endLine: endLine } : undefined,\n\t\t);\n\t}\n\n\tprotected getUrlForBranches(): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/branches`);\n\t}\n\n\tprotected getUrlForBranch(branch: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/?version=GB${branch}&_a=history`);\n\t}\n\n\tprotected getUrlForCommit(sha: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/commit/${sha}`);\n\t}\n\n\tprotected override getUrlForComparison(base: string, compare: string, _notation: '..' | '...'): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/branchCompare?baseVersion=GB${base}&targetVersion=GB${compare}`);\n\t}\n\n\tprotected getUrlForFile(fileName: string, branch?: string, sha?: string, range?: Range): string {\n\t\tlet line;\n\t\tif (range != null) {\n\t\t\tif (range.start.line === range.end.line) {\n\t\t\t\tline = `&line=${range.start.line}&lineStartColumn=${range.start.character + 1}&lineEndColumn=${\n\t\t\t\t\trange.end.character + 1\n\t\t\t\t}`;\n\t\t\t} else {\n\t\t\t\tline = `&line=${range.start.line}&lineEnd=${range.end.line}&lineStartColumn=${\n\t\t\t\t\trange.start.character + 1\n\t\t\t\t}&lineEndColumn=${range.end.character + 1}`;\n\t\t\t}\n\t\t} else {\n\t\t\tline = '';\n\t\t}\n\n\t\tif (sha) return this.encodeUrl(`${this.baseUrl}?path=${fileName}&version=GC${sha}${line}&_a=contents`);\n\t\tif (branch) return this.encodeUrl(`${this.baseUrl}/?path=/${fileName}&version=GB${branch}&_a=contents${line}`);\n\t\treturn this.encodeUrl(`${this.baseUrl}?path=/${fileName}${line}`);\n\t}\n}\n","import { Range, Uri } from 'vscode';\nimport { DynamicAutolinkReference } from '../../annotations/autolinks';\nimport { AutolinkReference } from '../../config';\nimport { GitRevision } from '../models';\nimport { Repository } from '../models/repository';\nimport { RemoteProvider } from './provider';\n\nconst fileRegex = /^\\/([^/]+)\\/([^/]+?)\\/src(.+)$/i;\nconst rangeRegex = /^lines-(\\d+)(?::(\\d+))?$/;\n\nexport class BitbucketRemote extends RemoteProvider {\n\tconstructor(domain: string, path: string, protocol?: string, name?: string, custom: boolean = false) {\n\t\tsuper(domain, path, protocol, name, custom);\n\t}\n\n\tprivate _autolinks: (AutolinkReference | DynamicAutolinkReference)[] | undefined;\n\toverride get autolinks(): (AutolinkReference | DynamicAutolinkReference)[] {\n\t\tif (this._autolinks === undefined) {\n\t\t\tthis._autolinks = [\n\t\t\t\t{\n\t\t\t\t\tprefix: 'issue #',\n\t\t\t\t\turl: `${this.baseUrl}/issues/<num>`,\n\t\t\t\t\ttitle: `Open Issue #<num> on ${this.name}`,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tprefix: 'pull request #',\n\t\t\t\t\turl: `${this.baseUrl}/pull-requests/<num>`,\n\t\t\t\t\ttitle: `Open PR #<num> on ${this.name}`,\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\t\treturn this._autolinks;\n\t}\n\n\toverride get icon() {\n\t\treturn 'bitbucket';\n\t}\n\n\tget id() {\n\t\treturn 'bitbucket';\n\t}\n\n\tget name() {\n\t\treturn this.formatName('Bitbucket');\n\t}\n\n\tasync getLocalInfoFromRemoteUri(\n\t\trepository: Repository,\n\t\turi: Uri,\n\t\toptions?: { validate?: boolean },\n\t): Promise<{ uri: Uri; startLine?: number; endLine?: number } | undefined> {\n\t\tif (uri.authority !== this.domain) return undefined;\n\t\tif ((options?.validate ?? true) && !uri.path.startsWith(`/${this.path}/`)) return undefined;\n\n\t\tlet startLine;\n\t\tlet endLine;\n\t\tif (uri.fragment) {\n\t\t\tconst match = rangeRegex.exec(uri.fragment);\n\t\t\tif (match != null) {\n\t\t\t\tconst [, start, end] = match;\n\t\t\t\tif (start) {\n\t\t\t\t\tstartLine = parseInt(start, 10);\n\t\t\t\t\tif (end) {\n\t\t\t\t\t\tendLine = parseInt(end, 10);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst match = fileRegex.exec(uri.path);\n\t\tif (match == null) return undefined;\n\n\t\tconst [, , , path] = match;\n\n\t\t// Check for a permalink\n\t\tlet index = path.indexOf('/', 1);\n\t\tif (index !== -1) {\n\t\t\tconst sha = path.substring(1, index);\n\t\t\tif (GitRevision.isSha(sha)) {\n\t\t\t\tconst uri = repository.toAbsoluteUri(path.substr(index), { validate: options?.validate });\n\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine, endLine: endLine };\n\t\t\t}\n\t\t}\n\n\t\t// Check for a link with branch (and deal with branch names with /)\n\t\tlet branch;\n\t\tconst possibleBranches = new Map<string, string>();\n\t\tindex = path.length;\n\t\tdo {\n\t\t\tindex = path.lastIndexOf('/', index - 1);\n\t\t\tbranch = path.substring(1, index);\n\n\t\t\tpossibleBranches.set(branch, path.substr(index));\n\t\t} while (index > 0);\n\n\t\tif (possibleBranches.size !== 0) {\n\t\t\tconst { values: branches } = await repository.getBranches({\n\t\t\t\tfilter: b => b.remote && possibleBranches.has(b.getNameWithoutRemote()),\n\t\t\t});\n\t\t\tfor (const branch of branches) {\n\t\t\t\tconst path = possibleBranches.get(branch.getNameWithoutRemote());\n\t\t\t\tif (path == null) continue;\n\n\t\t\t\tconst uri = repository.toAbsoluteUri(path, { validate: options?.validate });\n\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine, endLine: endLine };\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprotected getUrlForBranches(): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/branches`);\n\t}\n\n\tprotected getUrlForBranch(branch: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/branch/${branch}`);\n\t}\n\n\tprotected getUrlForCommit(sha: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/commits/${sha}`);\n\t}\n\n\tprotected override getUrlForComparison(base: string, compare: string, _notation: '..' | '...'): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/branches/compare/${base}%0D${compare}`).replace('%250D', '%0D');\n\t}\n\n\tprotected getUrlForFile(fileName: string, branch?: string, sha?: string, range?: Range): string {\n\t\tlet line;\n\t\tif (range != null) {\n\t\t\tif (range.start.line === range.end.line) {\n\t\t\t\tline = `#${fileName}-${range.start.line}`;\n\t\t\t} else {\n\t\t\t\tline = `#${fileName}-${range.start.line}:${range.end.line}`;\n\t\t\t}\n\t\t} else {\n\t\t\tline = '';\n\t\t}\n\n\t\tif (sha) return `${this.encodeUrl(`${this.baseUrl}/src/${sha}/${fileName}`)}${line}`;\n\t\tif (branch) return `${this.encodeUrl(`${this.baseUrl}/src/${branch}/${fileName}`)}${line}`;\n\t\treturn `${this.encodeUrl(`${this.baseUrl}?path=${fileName}`)}${line}`;\n\t}\n}\n","import { Range, Uri } from 'vscode';\nimport { DynamicAutolinkReference } from '../../annotations/autolinks';\nimport { AutolinkReference } from '../../config';\nimport { GitRevision } from '../models';\nimport { Repository } from '../models/repository';\nimport { RemoteProvider } from './provider';\n\nconst fileRegex = /^\\/([^/]+)\\/([^/]+?)\\/src(.+)$/i;\nconst rangeRegex = /^lines-(\\d+)(?::(\\d+))?$/;\n\nexport class BitbucketServerRemote extends RemoteProvider {\n\tconstructor(domain: string, path: string, protocol?: string, name?: string, custom: boolean = false) {\n\t\tsuper(domain, path, protocol, name, custom);\n\t}\n\n\tprivate _autolinks: (AutolinkReference | DynamicAutolinkReference)[] | undefined;\n\toverride get autolinks(): (AutolinkReference | DynamicAutolinkReference)[] {\n\t\tif (this._autolinks === undefined) {\n\t\t\tthis._autolinks = [\n\t\t\t\t{\n\t\t\t\t\tprefix: 'issue #',\n\t\t\t\t\turl: `${this.baseUrl}/issues/<num>`,\n\t\t\t\t\ttitle: `Open Issue #<num> on ${this.name}`,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tprefix: 'pull request #',\n\t\t\t\t\turl: `${this.baseUrl}/pull-requests/<num>`,\n\t\t\t\t\ttitle: `Open PR #<num> on ${this.name}`,\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\t\treturn this._autolinks;\n\t}\n\n\tprotected override get baseUrl(): string {\n\t\tconst [project, repo] = this.path.startsWith('scm/')\n\t\t\t? this.path.replace('scm/', '').split('/')\n\t\t\t: this.splitPath();\n\t\treturn `${this.protocol}://${this.domain}/projects/${project}/repos/${repo}`;\n\t}\n\n\toverride get icon() {\n\t\treturn 'bitbucket';\n\t}\n\n\tget id() {\n\t\treturn 'bitbucket-server';\n\t}\n\n\tget name() {\n\t\treturn this.formatName('Bitbucket Server');\n\t}\n\n\tasync getLocalInfoFromRemoteUri(\n\t\trepository: Repository,\n\t\turi: Uri,\n\t\toptions?: { validate?: boolean },\n\t): Promise<{ uri: Uri; startLine?: number; endLine?: number } | undefined> {\n\t\tif (uri.authority !== this.domain) return undefined;\n\t\tif ((options?.validate ?? true) && !uri.path.startsWith(`/${this.path}/`)) return undefined;\n\n\t\tlet startLine;\n\t\tlet endLine;\n\t\tif (uri.fragment) {\n\t\t\tconst match = rangeRegex.exec(uri.fragment);\n\t\t\tif (match != null) {\n\t\t\t\tconst [, start, end] = match;\n\t\t\t\tif (start) {\n\t\t\t\t\tstartLine = parseInt(start, 10);\n\t\t\t\t\tif (end) {\n\t\t\t\t\t\tendLine = parseInt(end, 10);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst match = fileRegex.exec(uri.path);\n\t\tif (match == null) return undefined;\n\n\t\tconst [, , , path] = match;\n\n\t\t// Check for a permalink\n\t\tlet index = path.indexOf('/', 1);\n\t\tif (index !== -1) {\n\t\t\tconst sha = path.substring(1, index);\n\t\t\tif (GitRevision.isSha(sha)) {\n\t\t\t\tconst uri = repository.toAbsoluteUri(path.substr(index), { validate: options?.validate });\n\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine, endLine: endLine };\n\t\t\t}\n\t\t}\n\n\t\t// Check for a link with branch (and deal with branch names with /)\n\t\tlet branch;\n\t\tconst possibleBranches = new Map<string, string>();\n\t\tindex = path.length;\n\t\tdo {\n\t\t\tindex = path.lastIndexOf('/', index - 1);\n\t\t\tbranch = path.substring(1, index);\n\n\t\t\tpossibleBranches.set(branch, path.substr(index));\n\t\t} while (index > 0);\n\n\t\tif (possibleBranches.size !== 0) {\n\t\t\tconst { values: branches } = await repository.getBranches({\n\t\t\t\tfilter: b => b.remote && possibleBranches.has(b.getNameWithoutRemote()),\n\t\t\t});\n\t\t\tfor (const branch of branches) {\n\t\t\t\tconst path = possibleBranches.get(branch.getNameWithoutRemote());\n\t\t\t\tif (path == null) continue;\n\n\t\t\t\tconst uri = repository.toAbsoluteUri(path, { validate: options?.validate });\n\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine, endLine: endLine };\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprotected getUrlForBranches(): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/branches`);\n\t}\n\n\tprotected getUrlForBranch(branch: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/commits?until=${branch}`);\n\t}\n\n\tprotected getUrlForCommit(sha: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/commits/${sha}`);\n\t}\n\n\tprotected override getUrlForComparison(base: string, compare: string, _notation: '..' | '...'): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/branches/compare/${base}%0D${compare}`).replace('%250D', '%0D');\n\t}\n\n\tprotected getUrlForFile(fileName: string, branch?: string, sha?: string, range?: Range): string {\n\t\tlet line;\n\t\tif (range != null) {\n\t\t\tif (range.start.line === range.end.line) {\n\t\t\t\tline = `#${range.start.line}`;\n\t\t\t} else {\n\t\t\t\tline = `#${range.start.line}-${range.end.line}`;\n\t\t\t}\n\t\t} else {\n\t\t\tline = '';\n\t\t}\n\t\tif (sha) return `${this.encodeUrl(`${this.baseUrl}/browse/${fileName}?at=${sha}`)}${line}`;\n\t\tif (branch) return `${this.encodeUrl(`${this.baseUrl}/browse/${fileName}?at=${branch}`)}${line}`;\n\t\treturn `${this.encodeUrl(`${this.baseUrl}/browse/${fileName}`)}${line}`;\n\t}\n}\n","import { Range, Uri } from 'vscode';\nimport { RemotesUrlsConfig } from '../../configuration';\nimport { interpolate } from '../../system/string';\nimport { Repository } from '../models/repository';\nimport { RemoteProvider } from './provider';\n\nexport class CustomRemote extends RemoteProvider {\n\tprivate readonly urls: RemotesUrlsConfig;\n\n\tconstructor(domain: string, path: string, urls: RemotesUrlsConfig, protocol?: string, name?: string) {\n\t\tsuper(domain, path, protocol, name, true);\n\t\tthis.urls = urls;\n\t}\n\n\tget id() {\n\t\treturn 'custom';\n\t}\n\n\tget name() {\n\t\treturn this.formatName('Custom');\n\t}\n\n\tgetLocalInfoFromRemoteUri(\n\t\t_repository: Repository,\n\t\t_uri: Uri,\n\t): Promise<{ uri: Uri; startLine?: number; endLine?: number } | undefined> {\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\tprotected override getUrlForRepository(): string {\n\t\treturn this.encodeUrl(interpolate(this.urls.repository, this.getContext()));\n\t}\n\n\tprotected getUrlForBranches(): string {\n\t\treturn this.encodeUrl(interpolate(this.urls.branches, this.getContext()));\n\t}\n\n\tprotected getUrlForBranch(branch: string): string {\n\t\treturn this.encodeUrl(interpolate(this.urls.branch, this.getContext({ branch: branch })));\n\t}\n\n\tprotected getUrlForCommit(sha: string): string {\n\t\treturn this.encodeUrl(interpolate(this.urls.commit, this.getContext({ id: sha })));\n\t}\n\n\tprotected override getUrlForComparison(base: string, compare: string, notation: '..' | '...'): string | undefined {\n\t\tif (this.urls.comparison == null) return undefined;\n\n\t\treturn this.encodeUrl(\n\t\t\tinterpolate(this.urls.comparison, this.getContext({ ref1: base, ref2: compare, notation: notation })),\n\t\t);\n\t}\n\n\tprotected getUrlForFile(fileName: string, branch?: string, sha?: string, range?: Range): string {\n\t\tlet line;\n\t\tif (range != null) {\n\t\t\tif (range.start.line === range.end.line) {\n\t\t\t\tline = interpolate(this.urls.fileLine, { line: range.start.line });\n\t\t\t} else {\n\t\t\t\tline = interpolate(this.urls.fileRange, { start: range.start.line, end: range.end.line });\n\t\t\t}\n\t\t} else {\n\t\t\tline = '';\n\t\t}\n\n\t\tlet url;\n\t\tif (sha) {\n\t\t\turl = interpolate(this.urls.fileInCommit, this.getContext({ id: sha, file: fileName, line: line }));\n\t\t} else if (branch) {\n\t\t\turl = interpolate(this.urls.fileInBranch, this.getContext({ branch: branch, file: fileName, line: line }));\n\t\t} else {\n\t\t\turl = interpolate(this.urls.file, this.getContext({ file: fileName, line: line }));\n\t\t}\n\n\t\tconst decodeHash = url.includes('#');\n\t\turl = this.encodeUrl(url);\n\t\tif (decodeHash) {\n\t\t\tconst index = url.lastIndexOf('%23');\n\t\t\tif (index !== -1) {\n\t\t\t\turl = `${url.substring(0, index)}#${url.substring(index + 3)}`;\n\t\t\t}\n\t\t}\n\t\treturn url;\n\t}\n\n\tprivate getContext(context?: Record<string, unknown>) {\n\t\tconst [repoBase, repoPath] = this.splitPath();\n\t\treturn {\n\t\t\trepo: this.path,\n\t\t\trepoBase: repoBase,\n\t\t\trepoPath: repoPath,\n\t\t\t...(context ?? {}),\n\t\t};\n\t}\n}\n","import { Range, Uri } from 'vscode';\nimport { DynamicAutolinkReference } from '../../annotations/autolinks';\nimport { AutolinkReference } from '../../config';\nimport { GitRevision } from '../models';\nimport { Repository } from '../models/repository';\nimport { RemoteProvider } from './provider';\n\nconst fileRegex = /^\\/([^/]+)\\/\\+(.+)$/i;\nconst rangeRegex = /^(\\d+)$/;\n\nexport class GerritRemote extends RemoteProvider {\n\tconstructor(domain: string, path: string, protocol?: string, name?: string, custom: boolean = false) {\n\t\tsuper(domain, path, protocol, name, custom);\n\t}\n\n\tprivate _autolinks: (AutolinkReference | DynamicAutolinkReference)[] | undefined;\n\toverride get autolinks(): (AutolinkReference | DynamicAutolinkReference)[] {\n\t\tif (this._autolinks === undefined) {\n\t\t\tthis._autolinks = [\n\t\t\t\t{\n\t\t\t\t\tprefix: 'Change-Id: ',\n\t\t\t\t\turl: `${this.baseReviewUrl}/q/<num>`,\n\t\t\t\t\ttitle: `Open Change #<num> on ${this.name}`,\n\t\t\t\t\talphanumeric: true,\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\t\treturn this._autolinks;\n\t}\n\n\toverride get icon() {\n\t\treturn 'gerrit';\n\t}\n\n\tget id() {\n\t\treturn 'gerrit';\n\t}\n\n\tget name() {\n\t\treturn this.formatName('Gerrit');\n\t}\n\n\tprivate get reviewDomain(): string {\n\t\tconst [subdomain, secondLevelDomain, topLevelDomain] = this.domain.split('.');\n\t\treturn [`${subdomain}-review`, secondLevelDomain, topLevelDomain].join('.');\n\t}\n\n\tprivate get baseReviewUrl(): string {\n\t\treturn `${this.protocol}://${this.reviewDomain}`;\n\t}\n\n\tasync getLocalInfoFromRemoteUri(\n\t\trepository: Repository,\n\t\turi: Uri,\n\t\toptions?: { validate?: boolean },\n\t): Promise<{ uri: Uri; startLine?: number } | undefined> {\n\t\tif (uri.authority !== this.domain) return undefined;\n\t\tif ((options?.validate ?? true) && !uri.path.startsWith(`/${this.path}/`)) return undefined;\n\n\t\tlet startLine;\n\t\tif (uri.fragment) {\n\t\t\tconst match = rangeRegex.exec(uri.fragment);\n\t\t\tif (match != null) {\n\t\t\t\tconst [, start] = match;\n\t\t\t\tif (start) {\n\t\t\t\t\tstartLine = parseInt(start, 10);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst match = fileRegex.exec(uri.path);\n\t\tif (match == null) return undefined;\n\n\t\tconst [, , path] = match;\n\n\t\t// Check for a permalink\n\t\tlet index = path.indexOf('/', 1);\n\t\tif (index !== -1) {\n\t\t\tconst sha = path.substring(1, index);\n\t\t\tif (GitRevision.isSha(sha) || sha == 'HEAD') {\n\t\t\t\tconst uri = repository.toAbsoluteUri(path.substr(index), { validate: options?.validate });\n\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine };\n\t\t\t}\n\t\t}\n\n\t\t// Check for a link with branch (and deal with branch names with /)\n\t\tif (path.startsWith('/refs/heads/')) {\n\t\t\tconst branchPath = path.substr('/refs/heads/'.length);\n\n\t\t\tlet branch;\n\t\t\tconst possibleBranches = new Map<string, string>();\n\t\t\tindex = branchPath.length;\n\t\t\tdo {\n\t\t\t\tindex = branchPath.lastIndexOf('/', index - 1);\n\t\t\t\tbranch = branchPath.substring(1, index);\n\n\t\t\t\tpossibleBranches.set(branch, branchPath.substr(index));\n\t\t\t} while (index > 0);\n\n\t\t\tif (possibleBranches.size !== 0) {\n\t\t\t\tconst { values: branches } = await repository.getBranches({\n\t\t\t\t\tfilter: b => b.remote && possibleBranches.has(b.getNameWithoutRemote()),\n\t\t\t\t});\n\t\t\t\tfor (const branch of branches) {\n\t\t\t\t\tconst path = possibleBranches.get(branch.getNameWithoutRemote());\n\t\t\t\t\tif (path == null) continue;\n\n\t\t\t\t\tconst uri = repository.toAbsoluteUri(path, { validate: options?.validate });\n\t\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine };\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Check for a link with tag (and deal with tag names with /)\n\t\tif (path.startsWith('/refs/tags/')) {\n\t\t\tconst tagPath = path.substr('/refs/tags/'.length);\n\n\t\t\tlet tag;\n\t\t\tconst possibleTags = new Map<string, string>();\n\t\t\tindex = tagPath.length;\n\t\t\tdo {\n\t\t\t\tindex = tagPath.lastIndexOf('/', index - 1);\n\t\t\t\ttag = tagPath.substring(1, index);\n\n\t\t\t\tpossibleTags.set(tag, tagPath.substr(index));\n\t\t\t} while (index > 0);\n\n\t\t\tif (possibleTags.size !== 0) {\n\t\t\t\tconst { values: tags } = await repository.getTags({\n\t\t\t\t\tfilter: t => possibleTags.has(t.name),\n\t\t\t\t});\n\t\t\t\tfor (const tag of tags) {\n\t\t\t\t\tconst path = possibleTags.get(tag.name);\n\t\t\t\t\tif (path == null) continue;\n\n\t\t\t\t\tconst uri = repository.toAbsoluteUri(path, { validate: options?.validate });\n\t\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine };\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprotected getUrlForBranches(): string {\n\t\treturn this.encodeUrl(`${this.baseReviewUrl}/admin/repos/${this.path},branches`);\n\t}\n\n\tprotected getUrlForBranch(branch: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/+/refs/heads/${branch}`);\n\t}\n\n\tprotected getUrlForCommit(sha: string): string {\n\t\treturn this.encodeUrl(`${this.baseReviewUrl}/q/${sha}`);\n\t}\n\n\tprotected getUrlForFile(fileName: string, branch?: string, sha?: string, range?: Range): string {\n\t\tconst line = range != null ? `#${range.start.line}` : '';\n\n\t\tif (sha) return `${this.encodeUrl(`${this.baseUrl}/+/${sha}/${fileName}`)}${line}`;\n\t\tif (branch) return `${this.encodeUrl(`${this.getUrlForBranch(branch)}/${fileName}`)}${line}`;\n\t\treturn `${this.encodeUrl(`${this.baseUrl}/+/HEAD/${fileName}`)}${line}`;\n\t}\n}\n","import { Range, Uri } from 'vscode';\nimport { DynamicAutolinkReference } from '../../annotations/autolinks';\nimport { AutolinkReference } from '../../config';\nimport { GitRevision } from '../models';\nimport { Repository } from '../models/repository';\nimport { RemoteProvider } from './provider';\n\nconst fileRegex = /^\\/([^/]+)\\/([^/]+?)\\/src(.+)$/i;\nconst rangeRegex = /^L(\\d+)(?:-L(\\d+))?$/;\n\nexport class GiteaRemote extends RemoteProvider {\n\tconstructor(domain: string, path: string, protocol?: string, name?: string, custom: boolean = false) {\n\t\tsuper(domain, path, protocol, name, custom);\n\t}\n\n\tprivate _autolinks: (AutolinkReference | DynamicAutolinkReference)[] | undefined;\n\toverride get autolinks(): (AutolinkReference | DynamicAutolinkReference)[] {\n\t\tif (this._autolinks === undefined) {\n\t\t\tthis._autolinks = [\n\t\t\t\t{\n\t\t\t\t\tprefix: '#',\n\t\t\t\t\turl: `${this.baseUrl}/issues/<num>`,\n\t\t\t\t\ttitle: `Open Issue #<num> on ${this.name}`,\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\t\treturn this._autolinks;\n\t}\n\n\toverride get icon() {\n\t\treturn 'gitea';\n\t}\n\n\tget id() {\n\t\treturn 'gitea';\n\t}\n\n\tget name() {\n\t\treturn this.formatName('Gitea');\n\t}\n\n\tasync getLocalInfoFromRemoteUri(\n\t\trepository: Repository,\n\t\turi: Uri,\n\t\toptions?: { validate?: boolean },\n\t): Promise<{ uri: Uri; startLine?: number; endLine?: number } | undefined> {\n\t\tif (uri.authority !== this.domain) return undefined;\n\t\tif ((options?.validate ?? true) && !uri.path.startsWith(`/${this.path}/`)) return undefined;\n\n\t\tlet startLine;\n\t\tlet endLine;\n\t\tif (uri.fragment) {\n\t\t\tconst match = rangeRegex.exec(uri.fragment);\n\t\t\tif (match != null) {\n\t\t\t\tconst [, start, end] = match;\n\t\t\t\tif (start) {\n\t\t\t\t\tstartLine = parseInt(start, 10);\n\t\t\t\t\tif (end) {\n\t\t\t\t\t\tendLine = parseInt(end, 10);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst match = fileRegex.exec(uri.path);\n\t\tif (match == null) return undefined;\n\n\t\tconst [, , , path] = match;\n\t\tlet offset;\n\t\tlet index;\n\n\t\t// Check for a permalink\n\t\tif (path.startsWith('/commit/')) {\n\t\t\toffset = '/commit/'.length;\n\t\t\tindex = path.indexOf('/', offset);\n\t\t\tif (index !== -1) {\n\t\t\t\tconst sha = path.substring(offset, index);\n\t\t\t\tif (GitRevision.isSha(sha)) {\n\t\t\t\t\tconst uri = repository.toAbsoluteUri(path.substr(index), { validate: options?.validate });\n\t\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine, endLine: endLine };\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Check for a link with branch (and deal with branch names with /)\n\t\tif (path.startsWith('/branch/')) {\n\t\t\tlet branch;\n\t\t\tconst possibleBranches = new Map<string, string>();\n\t\t\toffset = '/branch/'.length;\n\t\t\tindex = offset;\n\t\t\tdo {\n\t\t\t\tbranch = path.substring(offset, index);\n\t\t\t\tpossibleBranches.set(branch, path.substr(index));\n\n\t\t\t\tindex = path.indexOf('/', index + 1);\n\t\t\t} while (index < path.length && index !== -1);\n\n\t\t\tif (possibleBranches.size !== 0) {\n\t\t\t\tconst { values: branches } = await repository.getBranches({\n\t\t\t\t\tfilter: b => b.remote && possibleBranches.has(b.getNameWithoutRemote()),\n\t\t\t\t});\n\t\t\t\tfor (const branch of branches) {\n\t\t\t\t\tconst path = possibleBranches.get(branch.getNameWithoutRemote());\n\t\t\t\t\tif (path == null) continue;\n\n\t\t\t\t\tconst uri = repository.toAbsoluteUri(path, { validate: options?.validate });\n\t\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine, endLine: endLine };\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprotected getUrlForBranches(): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/branches`);\n\t}\n\n\tprotected getUrlForBranch(branch: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/src/branch/${branch}`);\n\t}\n\n\tprotected getUrlForCommit(sha: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/commit/${sha}`);\n\t}\n\n\tprotected override getUrlForComparison(ref1: string, ref2: string, _notation: '..' | '...'): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/compare/${ref1}...${ref2}`);\n\t}\n\n\tprotected getUrlForFile(fileName: string, branch?: string, sha?: string, range?: Range): string {\n\t\tlet line;\n\t\tif (range != null) {\n\t\t\tif (range.start.line === range.end.line) {\n\t\t\t\tline = `#L${range.start.line}`;\n\t\t\t} else {\n\t\t\t\tline = `#L${range.start.line}-L${range.end.line}`;\n\t\t\t}\n\t\t} else {\n\t\t\tline = '';\n\t\t}\n\n\t\tif (sha) return this.encodeUrl(`${this.baseUrl}/src/commit/${sha}/${fileName}${line}`);\n\t\tif (branch) return this.encodeUrl(`${this.baseUrl}/src/branch/${branch}/${fileName}${line}`);\n\t\t// this route is deprecated but there is no alternative\n\t\treturn this.encodeUrl(`${this.baseUrl}/src/${fileName}${line}`);\n\t}\n}\n","import { AuthenticationSession, Range, Uri } from 'vscode';\nimport { DynamicAutolinkReference } from '../../annotations/autolinks';\nimport { AutolinkReference } from '../../config';\nimport { Container } from '../../container';\nimport {\n\tAccount,\n\tDefaultBranch,\n\tGitRevision,\n\tIssueOrPullRequest,\n\tPullRequest,\n\tPullRequestState,\n\tRepository,\n} from '../models';\nimport { RichRemoteProvider } from './provider';\n\nconst issueEnricher3rdPartyRegex = /\\b(?<repo>[^/\\s]+\\/[^/\\s]+)\\\\#(?<num>[0-9]+)\\b(?!]\\()/g;\nconst fileRegex = /^\\/([^/]+)\\/([^/]+?)\\/blob(.+)$/i;\nconst rangeRegex = /^L(\\d+)(?:-L(\\d+))?$/;\n\nconst authProvider = Object.freeze({ id: 'github', scopes: ['repo', 'read:user', 'user:email'] });\n\nexport class GitHubRemote extends RichRemoteProvider {\n\tprotected get authProvider() {\n\t\treturn authProvider;\n\t}\n\n\tconstructor(domain: string, path: string, protocol?: string, name?: string, custom: boolean = false) {\n\t\tsuper(domain, path, protocol, name, custom);\n\t}\n\n\tget apiBaseUrl() {\n\t\treturn this.custom ? `${this.protocol}://${this.domain}/api` : `https://api.${this.domain}`;\n\t}\n\n\tprivate _autolinks: (AutolinkReference | DynamicAutolinkReference)[] | undefined;\n\toverride get autolinks(): (AutolinkReference | DynamicAutolinkReference)[] {\n\t\tif (this._autolinks === undefined) {\n\t\t\tthis._autolinks = [\n\t\t\t\t{\n\t\t\t\t\tprefix: '#',\n\t\t\t\t\turl: `${this.baseUrl}/issues/<num>`,\n\t\t\t\t\ttitle: `Open Issue #<num> on ${this.name}`,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tprefix: 'gh-',\n\t\t\t\t\turl: `${this.baseUrl}/issues/<num>`,\n\t\t\t\t\ttitle: `Open Issue #<num> on ${this.name}`,\n\t\t\t\t\tignoreCase: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlinkify: (text: string) =>\n\t\t\t\t\t\ttext.replace(\n\t\t\t\t\t\t\tissueEnricher3rdPartyRegex,\n\t\t\t\t\t\t\t`[$&](${this.protocol}://${this.domain}/$<repo>/issues/$<num> \"Open Issue #$<num> from $<repo> on ${this.name}\")`,\n\t\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\t\treturn this._autolinks;\n\t}\n\n\toverride get icon() {\n\t\treturn 'github';\n\t}\n\n\tget id() {\n\t\treturn 'github';\n\t}\n\n\tget name() {\n\t\treturn this.formatName('GitHub');\n\t}\n\n\tasync getLocalInfoFromRemoteUri(\n\t\trepository: Repository,\n\t\turi: Uri,\n\t\toptions?: { validate?: boolean },\n\t): Promise<{ uri: Uri; startLine?: number; endLine?: number } | undefined> {\n\t\tif (uri.authority !== this.domain) return undefined;\n\t\tif ((options?.validate ?? true) && !uri.path.startsWith(`/${this.path}/`)) return undefined;\n\n\t\tlet startLine;\n\t\tlet endLine;\n\t\tif (uri.fragment) {\n\t\t\tconst match = rangeRegex.exec(uri.fragment);\n\t\t\tif (match != null) {\n\t\t\t\tconst [, start, end] = match;\n\t\t\t\tif (start) {\n\t\t\t\t\tstartLine = parseInt(start, 10);\n\t\t\t\t\tif (end) {\n\t\t\t\t\t\tendLine = parseInt(end, 10);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst match = fileRegex.exec(uri.path);\n\t\tif (match == null) return undefined;\n\n\t\tconst [, , , path] = match;\n\n\t\t// Check for a permalink\n\t\tlet index = path.indexOf('/', 1);\n\t\tif (index !== -1) {\n\t\t\tconst sha = path.substring(1, index);\n\t\t\tif (GitRevision.isSha(sha)) {\n\t\t\t\tconst uri = repository.toAbsoluteUri(path.substr(index), { validate: options?.validate });\n\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine, endLine: endLine };\n\t\t\t}\n\t\t}\n\n\t\t// Check for a link with branch (and deal with branch names with /)\n\t\tlet branch;\n\t\tconst possibleBranches = new Map<string, string>();\n\t\tindex = path.length;\n\t\tdo {\n\t\t\tindex = path.lastIndexOf('/', index - 1);\n\t\t\tbranch = path.substring(1, index);\n\n\t\t\tpossibleBranches.set(branch, path.substr(index));\n\t\t} while (index > 0);\n\n\t\tif (possibleBranches.size !== 0) {\n\t\t\tconst { values: branches } = await repository.getBranches({\n\t\t\t\tfilter: b => b.remote && possibleBranches.has(b.getNameWithoutRemote()),\n\t\t\t});\n\t\t\tfor (const branch of branches) {\n\t\t\t\tconst path = possibleBranches.get(branch.getNameWithoutRemote());\n\t\t\t\tif (path == null) continue;\n\n\t\t\t\tconst uri = repository.toAbsoluteUri(path, { validate: options?.validate });\n\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine, endLine: endLine };\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprotected getUrlForBranches(): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/branches`);\n\t}\n\n\tprotected getUrlForBranch(branch: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/tree/${branch}`);\n\t}\n\n\tprotected getUrlForCommit(sha: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/commit/${sha}`);\n\t}\n\n\tprotected override getUrlForComparison(base: string, compare: string, notation: '..' | '...'): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/compare/${base}${notation}${compare}`);\n\t}\n\n\tprotected override getUrlForCreatePullRequest(\n\t\tbase: { branch?: string; remote: { path: string; url: string } },\n\t\tcompare: { branch: string; remote: { path: string; url: string } },\n\t): string | undefined {\n\t\tif (base.remote.url === compare.remote.url) {\n\t\t\treturn this.encodeUrl(`${this.baseUrl}/pull/new/${base.branch ?? 'HEAD'}...${compare.branch}`);\n\t\t}\n\n\t\tconst [owner] = compare.remote.path.split('/', 1);\n\t\treturn this.encodeUrl(`${this.baseUrl}/pull/new/${base.branch ?? 'HEAD'}...${owner}:${compare.branch}`);\n\t}\n\n\tprotected getUrlForFile(fileName: string, branch?: string, sha?: string, range?: Range): string {\n\t\tlet line;\n\t\tif (range != null) {\n\t\t\tif (range.start.line === range.end.line) {\n\t\t\t\tline = `#L${range.start.line}`;\n\t\t\t} else {\n\t\t\t\tline = `#L${range.start.line}-L${range.end.line}`;\n\t\t\t}\n\t\t} else {\n\t\t\tline = '';\n\t\t}\n\n\t\tif (sha) return `${this.encodeUrl(`${this.baseUrl}/blob/${sha}/${fileName}`)}${line}`;\n\t\tif (branch) return `${this.encodeUrl(`${this.baseUrl}/blob/${branch}/${fileName}`)}${line}`;\n\t\treturn `${this.encodeUrl(`${this.baseUrl}?path=${fileName}`)}${line}`;\n\t}\n\n\tprotected async getProviderAccountForCommit(\n\t\t{ accessToken }: AuthenticationSession,\n\t\tref: string,\n\t\toptions?: {\n\t\t\tavatarSize?: number;\n\t\t},\n\t): Promise<Account | undefined> {\n\t\tconst [owner, repo] = this.splitPath();\n\t\treturn (await Container.instance.github)?.getAccountForCommit(this, accessToken, owner, repo, ref, {\n\t\t\t...options,\n\t\t\tbaseUrl: this.apiBaseUrl,\n\t\t});\n\t}\n\n\tprotected async getProviderAccountForEmail(\n\t\t{ accessToken }: AuthenticationSession,\n\t\temail: string,\n\t\toptions?: {\n\t\t\tavatarSize?: number;\n\t\t},\n\t): Promise<Account | undefined> {\n\t\tconst [owner, repo] = this.splitPath();\n\t\treturn (await Container.instance.github)?.getAccountForEmail(this, accessToken, owner, repo, email, {\n\t\t\t...options,\n\t\t\tbaseUrl: this.apiBaseUrl,\n\t\t});\n\t}\n\n\tprotected async getProviderDefaultBranch({\n\t\taccessToken,\n\t}: AuthenticationSession): Promise<DefaultBranch | undefined> {\n\t\tconst [owner, repo] = this.splitPath();\n\t\treturn (await Container.instance.github)?.getDefaultBranch(this, accessToken, owner, repo, {\n\t\t\tbaseUrl: this.apiBaseUrl,\n\t\t});\n\t}\n\tprotected async getProviderIssueOrPullRequest(\n\t\t{ accessToken }: AuthenticationSession,\n\t\tid: string,\n\t): Promise<IssueOrPullRequest | undefined> {\n\t\tconst [owner, repo] = this.splitPath();\n\t\treturn (await Container.instance.github)?.getIssueOrPullRequest(this, accessToken, owner, repo, Number(id), {\n\t\t\tbaseUrl: this.apiBaseUrl,\n\t\t});\n\t}\n\n\tprotected async getProviderPullRequestForBranch(\n\t\t{ accessToken }: AuthenticationSession,\n\t\tbranch: string,\n\t\toptions?: {\n\t\t\tavatarSize?: number;\n\t\t\tinclude?: PullRequestState[];\n\t\t},\n\t): Promise<PullRequest | undefined> {\n\t\tconst [owner, repo] = this.splitPath();\n\t\tconst { include, ...opts } = options ?? {};\n\n\t\tconst GitHubPullRequest = (await import(/* webpackChunkName: \"github\" */ '../../premium/github/github'))\n\t\t\t.GitHubPullRequest;\n\t\treturn (await Container.instance.github)?.getPullRequestForBranch(this, accessToken, owner, repo, branch, {\n\t\t\t...opts,\n\t\t\tinclude: include?.map(s => GitHubPullRequest.toState(s)),\n\t\t\tbaseUrl: this.apiBaseUrl,\n\t\t});\n\t}\n\n\tprotected async getProviderPullRequestForCommit(\n\t\t{ accessToken }: AuthenticationSession,\n\t\tref: string,\n\t): Promise<PullRequest | undefined> {\n\t\tconst [owner, repo] = this.splitPath();\n\t\treturn (await Container.instance.github)?.getPullRequestForCommit(this, accessToken, owner, repo, ref, {\n\t\t\tbaseUrl: this.apiBaseUrl,\n\t\t});\n\t}\n}\n","import { Range, Uri } from 'vscode';\nimport { DynamicAutolinkReference } from '../../annotations/autolinks';\nimport { AutolinkReference } from '../../config';\nimport { GitRevision } from '../models';\nimport { Repository } from '../models/repository';\nimport { RemoteProvider } from './provider';\n\nconst fileRegex = /^\\/([^/]+)\\/([^/]+?)\\/-\\/blob(.+)$/i;\nconst rangeRegex = /^L(\\d+)(?:-(\\d+))?$/;\n\nexport class GitLabRemote extends RemoteProvider {\n\tconstructor(domain: string, path: string, protocol?: string, name?: string, custom: boolean = false) {\n\t\tsuper(domain, path, protocol, name, custom);\n\t}\n\n\tprivate _autolinks: (AutolinkReference | DynamicAutolinkReference)[] | undefined;\n\toverride get autolinks(): (AutolinkReference | DynamicAutolinkReference)[] {\n\t\tif (this._autolinks === undefined) {\n\t\t\tthis._autolinks = [\n\t\t\t\t{\n\t\t\t\t\tprefix: '#',\n\t\t\t\t\turl: `${this.baseUrl}/issues/<num>`,\n\t\t\t\t\ttitle: `Open Issue #<num> on ${this.name}`,\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\t\treturn this._autolinks;\n\t}\n\n\toverride get icon() {\n\t\treturn 'gitlab';\n\t}\n\n\tget id() {\n\t\treturn 'gitlab';\n\t}\n\n\tget name() {\n\t\treturn this.formatName('GitLab');\n\t}\n\n\tasync getLocalInfoFromRemoteUri(\n\t\trepository: Repository,\n\t\turi: Uri,\n\t\toptions?: { validate?: boolean },\n\t): Promise<{ uri: Uri; startLine?: number; endLine?: number } | undefined> {\n\t\tif (uri.authority !== this.domain) return undefined;\n\t\tif ((options?.validate ?? true) && !uri.path.startsWith(`/${this.path}/`)) return undefined;\n\n\t\tlet startLine;\n\t\tlet endLine;\n\t\tif (uri.fragment) {\n\t\t\tconst match = rangeRegex.exec(uri.fragment);\n\t\t\tif (match != null) {\n\t\t\t\tconst [, start, end] = match;\n\t\t\t\tif (start) {\n\t\t\t\t\tstartLine = parseInt(start, 10);\n\t\t\t\t\tif (end) {\n\t\t\t\t\t\tendLine = parseInt(end, 10);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst match = fileRegex.exec(uri.path);\n\t\tif (match == null) return undefined;\n\n\t\tconst [, , , path] = match;\n\n\t\t// Check for a permalink\n\t\tlet index = path.indexOf('/', 1);\n\t\tif (index !== -1) {\n\t\t\tconst sha = path.substring(1, index);\n\t\t\tif (GitRevision.isSha(sha)) {\n\t\t\t\tconst uri = repository.toAbsoluteUri(path.substr(index), { validate: options?.validate });\n\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine, endLine: endLine };\n\t\t\t}\n\t\t}\n\n\t\t// Check for a link with branch (and deal with branch names with /)\n\t\tlet branch;\n\t\tconst possibleBranches = new Map<string, string>();\n\t\tindex = path.length;\n\t\tdo {\n\t\t\tindex = path.lastIndexOf('/', index - 1);\n\t\t\tbranch = path.substring(1, index);\n\n\t\t\tpossibleBranches.set(branch, path.substr(index));\n\t\t} while (index > 0);\n\n\t\tif (possibleBranches.size !== 0) {\n\t\t\tconst { values: branches } = await repository.getBranches({\n\t\t\t\tfilter: b => b.remote && possibleBranches.has(b.getNameWithoutRemote()),\n\t\t\t});\n\t\t\tfor (const branch of branches) {\n\t\t\t\tconst path = possibleBranches.get(branch.getNameWithoutRemote());\n\t\t\t\tif (path == null) continue;\n\n\t\t\t\tconst uri = repository.toAbsoluteUri(path, { validate: options?.validate });\n\t\t\t\tif (uri != null) return { uri: uri, startLine: startLine, endLine: endLine };\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprotected getUrlForBranches(): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/branches`);\n\t}\n\n\tprotected getUrlForBranch(branch: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/tree/${branch}`);\n\t}\n\n\tprotected getUrlForCommit(sha: string): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/commit/${sha}`);\n\t}\n\n\tprotected override getUrlForComparison(base: string, compare: string, notation: '..' | '...'): string {\n\t\treturn this.encodeUrl(`${this.baseUrl}/-/compare/${base}${notation}${compare}`);\n\t}\n\n\tprotected getUrlForFile(fileName: string, branch?: string, sha?: string, range?: Range): string {\n\t\tlet line;\n\t\tif (range != null) {\n\t\t\tif (range.start.line === range.end.line) {\n\t\t\t\tline = `#L${range.start.line}`;\n\t\t\t} else {\n\t\t\t\tline = `#L${range.start.line}-${range.end.line}`;\n\t\t\t}\n\t\t} else {\n\t\t\tline = '';\n\t\t}\n\n\t\tif (sha) return `${this.encodeUrl(`${this.baseUrl}/blob/${sha}/${fileName}`)}${line}`;\n\t\tif (branch) return `${this.encodeUrl(`${this.baseUrl}/blob/${branch}/${fileName}`)}${line}`;\n\t\treturn `${this.encodeUrl(`${this.baseUrl}?path=${fileName}`)}${line}`;\n\t}\n}\n","import { CustomRemoteType, RemotesConfig } from '../../configuration';\nimport { Logger } from '../../logger';\nimport { AzureDevOpsRemote } from './azure-devops';\nimport { BitbucketRemote } from './bitbucket';\nimport { BitbucketServerRemote } from './bitbucket-server';\nimport { CustomRemote } from './custom';\nimport { GerritRemote } from './gerrit';\nimport { GiteaRemote } from './gitea';\nimport { GitHubRemote } from './github';\nimport { GitLabRemote } from './gitlab';\nimport { RemoteProvider } from './provider';\n\n// export { RemoteProvider, RichRemoteProvider };\nexport type RemoteProviders = {\n\tcustom: boolean;\n\tmatcher: string | RegExp;\n\tcreator: (domain: string, path: string) => RemoteProvider;\n}[];\n\nconst builtInProviders: RemoteProviders = [\n\t{\n\t\tcustom: false,\n\t\tmatcher: 'bitbucket.org',\n\t\tcreator: (domain: string, path: string) => new BitbucketRemote(domain, path),\n\t},\n\t{\n\t\tcustom: false,\n\t\tmatcher: 'github.com',\n\t\tcreator: (domain: string, path: string) => new GitHubRemote(domain, path),\n\t},\n\t{\n\t\tcustom: false,\n\t\tmatcher: 'gitlab.com',\n\t\tcreator: (domain: string, path: string) => new GitLabRemote(domain, path),\n\t},\n\t{\n\t\tcustom: false,\n\t\tmatcher: /\\bdev\\.azure\\.com$/i,\n\t\tcreator: (domain: string, path: string) => new AzureDevOpsRemote(domain, path),\n\t},\n\t{\n\t\tcustom: true,\n\t\tmatcher: /^(.+\\/(?:bitbucket|stash))\\/scm\\/(.+)$/i,\n\t\tcreator: (domain: string, path: string) => new BitbucketServerRemote(domain, path),\n\t},\n\t{\n\t\tcustom: false,\n\t\tmatcher: /\\bgitlab\\b/i,\n\t\tcreator: (domain: string, path: string) => new GitLabRemote(domain, path),\n\t},\n\t{\n\t\tcustom: false,\n\t\tmatcher: /\\bvisualstudio\\.com$/i,\n\t\tcreator: (domain: string, path: string) => new AzureDevOpsRemote(domain, path, undefined, undefined, true),\n\t},\n\t{\n\t\tcustom: false,\n\t\tmatcher: /\\bgitea\\b/i,\n\t\tcreator: (domain: string, path: string) => new GiteaRemote(domain, path),\n\t},\n\t{\n\t\tcustom: false,\n\t\tmatcher: /\\bgooglesource\\.com$/i,\n\t\tcreator: (domain: string, path: string) => new GerritRemote(domain, path),\n\t},\n];\n\nexport class RemoteProviderFactory {\n\tstatic factory(\n\t\tproviders: RemoteProviders,\n\t): (url: string, domain: string, path: string) => RemoteProvider | undefined {\n\t\treturn (url: string, domain: string, path: string) => this.create(providers, url, domain, path);\n\t}\n\n\tstatic create(providers: RemoteProviders, url: string, domain: string, path: string): RemoteProvider | undefined {\n\t\ttry {\n\t\t\tconst key = domain.toLowerCase();\n\t\t\tfor (const { custom, matcher, creator } of providers) {\n\t\t\t\tif (typeof matcher === 'string') {\n\t\t\t\t\tif (matcher === key) return creator(domain, path);\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (matcher.test(key)) return creator(domain, path);\n\t\t\t\tif (!custom) continue;\n\n\t\t\t\tconst match = matcher.exec(url);\n\t\t\t\tif (match != null) {\n\t\t\t\t\treturn creator(match[1], match[2]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, 'RemoteProviderFactory');\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tstatic loadProviders(cfg: RemotesConfig[] | null | undefined): RemoteProviders {\n\t\tconst providers: RemoteProviders = [];\n\n\t\tif (cfg != null && cfg.length > 0) {\n\t\t\tfor (const rc of cfg) {\n\t\t\t\tconst provider = this.getCustomProvider(rc);\n\t\t\t\tif (provider == null) continue;\n\n\t\t\t\tlet matcher: string | RegExp | undefined;\n\t\t\t\ttry {\n\t\t\t\t\tmatcher = rc.regex ? new RegExp(rc.regex, 'i') : rc.domain?.toLowerCase();\n\t\t\t\t\tif (matcher == null) throw new Error('No matcher found');\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tLogger.error(ex, `Loading remote provider '${rc.name ?? ''}' failed`);\n\t\t\t\t}\n\n\t\t\t\tproviders.push({\n\t\t\t\t\tcustom: true,\n\t\t\t\t\tmatcher: matcher!,\n\t\t\t\t\tcreator: provider,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tproviders.push(...builtInProviders);\n\n\t\treturn providers;\n\t}\n\n\tprivate static getCustomProvider(cfg: RemotesConfig) {\n\t\tswitch (cfg.type) {\n\t\t\tcase CustomRemoteType.AzureDevOps:\n\t\t\t\treturn (domain: string, path: string) =>\n\t\t\t\t\tnew AzureDevOpsRemote(domain, path, cfg.protocol, cfg.name, true);\n\t\t\tcase CustomRemoteType.Bitbucket:\n\t\t\t\treturn (domain: string, path: string) =>\n\t\t\t\t\tnew BitbucketRemote(domain, path, cfg.protocol, cfg.name, true);\n\t\t\tcase CustomRemoteType.BitbucketServer:\n\t\t\t\treturn (domain: string, path: string) =>\n\t\t\t\t\tnew BitbucketServerRemote(domain, path, cfg.protocol, cfg.name, true);\n\t\t\tcase CustomRemoteType.Custom:\n\t\t\t\treturn (domain: string, path: string) =>\n\t\t\t\t\tnew CustomRemote(domain, path, cfg.urls!, cfg.protocol, cfg.name);\n\t\t\tcase CustomRemoteType.Gerrit:\n\t\t\t\treturn (domain: string, path: string) => new GerritRemote(domain, path, cfg.protocol, cfg.name, true);\n\t\t\tcase CustomRemoteType.Gitea:\n\t\t\t\treturn (domain: string, path: string) => new GiteaRemote(domain, path, cfg.protocol, cfg.name, true);\n\t\t\tcase CustomRemoteType.GitHub:\n\t\t\t\treturn (domain: string, path: string) => new GitHubRemote(domain, path, cfg.protocol, cfg.name, true);\n\t\t\tcase CustomRemoteType.GitLab:\n\t\t\t\treturn (domain: string, path: string) => new GitLabRemote(domain, path, cfg.protocol, cfg.name, true);\n\t\t\tdefault:\n\t\t\t\treturn undefined;\n\t\t}\n\t}\n}\n","import {\n\tauthentication,\n\tAuthenticationSession,\n\tAuthenticationSessionsChangeEvent,\n\tenv,\n\tEvent,\n\tEventEmitter,\n\tRange,\n\tUri,\n} from 'vscode';\nimport { DynamicAutolinkReference } from '../../annotations/autolinks';\nimport { AutolinkReference } from '../../config';\nimport { Container } from '../../container';\nimport { AuthenticationError, ProviderRequestClientError } from '../../errors';\nimport { Logger } from '../../logger';\nimport { WorkspaceStorageKeys } from '../../storage';\nimport { gate } from '../../system/decorators/gate';\nimport { debug, log } from '../../system/decorators/log';\nimport { encodeUrl } from '../../system/encoding';\nimport { isPromise } from '../../system/promise';\nimport {\n\tAccount,\n\tDefaultBranch,\n\tGitCommit,\n\tIssueOrPullRequest,\n\tPullRequest,\n\tPullRequestState,\n\tRemoteProviderReference,\n\tRepository,\n} from '../models';\n\nexport const enum RemoteResourceType {\n\tBranch = 'branch',\n\tBranches = 'branches',\n\tCommit = 'commit',\n\tComparison = 'comparison',\n\tCreatePullRequest = 'createPullRequest',\n\tFile = 'file',\n\tRepo = 'repo',\n\tRevision = 'revision',\n}\n\nexport type RemoteResource =\n\t| {\n\t\t\ttype: RemoteResourceType.Branch;\n\t\t\tbranch: string;\n\t  }\n\t| {\n\t\t\ttype: RemoteResourceType.Branches;\n\t  }\n\t| {\n\t\t\ttype: RemoteResourceType.Commit;\n\t\t\tsha: string;\n\t  }\n\t| {\n\t\t\ttype: RemoteResourceType.Comparison;\n\t\t\tbase: string;\n\t\t\tcompare: string;\n\t\t\tnotation?: '..' | '...';\n\t  }\n\t| {\n\t\t\ttype: RemoteResourceType.CreatePullRequest;\n\t\t\tbase: {\n\t\t\t\tbranch?: string;\n\t\t\t\tremote: { path: string; url: string };\n\t\t\t};\n\t\t\tcompare: {\n\t\t\t\tbranch: string;\n\t\t\t\tremote: { path: string; url: string };\n\t\t\t};\n\t  }\n\t| {\n\t\t\ttype: RemoteResourceType.File;\n\t\t\tbranchOrTag?: string;\n\t\t\tfileName: string;\n\t\t\trange?: Range;\n\t  }\n\t| {\n\t\t\ttype: RemoteResourceType.Repo;\n\t  }\n\t| {\n\t\t\ttype: RemoteResourceType.Revision;\n\t\t\tbranchOrTag?: string;\n\t\t\tcommit?: GitCommit;\n\t\t\tfileName: string;\n\t\t\trange?: Range;\n\t\t\tsha?: string;\n\t  };\n\nexport function getNameFromRemoteResource(resource: RemoteResource) {\n\tswitch (resource.type) {\n\t\tcase RemoteResourceType.Branch:\n\t\t\treturn 'Branch';\n\t\tcase RemoteResourceType.Branches:\n\t\t\treturn 'Branches';\n\t\tcase RemoteResourceType.Commit:\n\t\t\treturn 'Commit';\n\t\tcase RemoteResourceType.Comparison:\n\t\t\treturn 'Comparison';\n\t\tcase RemoteResourceType.CreatePullRequest:\n\t\t\treturn 'Create Pull Request';\n\t\tcase RemoteResourceType.File:\n\t\t\treturn 'File';\n\t\tcase RemoteResourceType.Repo:\n\t\t\treturn 'Repository';\n\t\tcase RemoteResourceType.Revision:\n\t\t\treturn 'File';\n\t\tdefault:\n\t\t\treturn '';\n\t}\n}\n\nexport abstract class RemoteProvider implements RemoteProviderReference {\n\treadonly type: 'simple' | 'rich' = 'simple';\n\tprotected readonly _name: string | undefined;\n\n\tconstructor(\n\t\tpublic readonly domain: string,\n\t\tpublic readonly path: string,\n\t\tpublic readonly protocol: string = 'https',\n\t\tname?: string,\n\t\tpublic readonly custom: boolean = false,\n\t) {\n\t\tthis._name = name;\n\t}\n\n\tget autolinks(): (AutolinkReference | DynamicAutolinkReference)[] {\n\t\treturn [];\n\t}\n\n\tget displayPath(): string {\n\t\treturn this.path;\n\t}\n\n\tget icon(): string {\n\t\treturn 'remote';\n\t}\n\n\tabstract get id(): string;\n\tabstract get name(): string;\n\n\tasync copy(resource: RemoteResource): Promise<void> {\n\t\tconst url = this.url(resource);\n\t\tif (url == null) return;\n\n\t\tvoid (await env.clipboard.writeText(url));\n\t}\n\n\thasRichApi(): this is RichRemoteProvider {\n\t\treturn RichRemoteProvider.is(this);\n\t}\n\n\tabstract getLocalInfoFromRemoteUri(\n\t\trepository: Repository,\n\t\turi: Uri,\n\t\toptions?: { validate?: boolean },\n\t): Promise<{ uri: Uri; startLine?: number; endLine?: number } | undefined>;\n\n\topen(resource: RemoteResource): Promise<boolean | undefined> {\n\t\treturn this.openUrl(this.url(resource));\n\t}\n\n\turl(resource: RemoteResource): string | undefined {\n\t\tswitch (resource.type) {\n\t\t\tcase RemoteResourceType.Branch:\n\t\t\t\treturn this.getUrlForBranch(resource.branch);\n\t\t\tcase RemoteResourceType.Branches:\n\t\t\t\treturn this.getUrlForBranches();\n\t\t\tcase RemoteResourceType.Commit:\n\t\t\t\treturn this.getUrlForCommit(resource.sha);\n\t\t\tcase RemoteResourceType.Comparison: {\n\t\t\t\treturn this.getUrlForComparison?.(resource.base, resource.compare, resource.notation ?? '...');\n\t\t\t}\n\t\t\tcase RemoteResourceType.CreatePullRequest: {\n\t\t\t\treturn this.getUrlForCreatePullRequest?.(resource.base, resource.compare);\n\t\t\t}\n\t\t\tcase RemoteResourceType.File:\n\t\t\t\treturn this.getUrlForFile(\n\t\t\t\t\tresource.fileName,\n\t\t\t\t\tresource.branchOrTag != null ? resource.branchOrTag : undefined,\n\t\t\t\t\tundefined,\n\t\t\t\t\tresource.range,\n\t\t\t\t);\n\t\t\tcase RemoteResourceType.Repo:\n\t\t\t\treturn this.getUrlForRepository();\n\t\t\tcase RemoteResourceType.Revision:\n\t\t\t\treturn this.getUrlForFile(\n\t\t\t\t\tresource.fileName,\n\t\t\t\t\tresource.branchOrTag != null ? resource.branchOrTag : undefined,\n\t\t\t\t\tresource.sha != null ? resource.sha : undefined,\n\t\t\t\t\tresource.range,\n\t\t\t\t);\n\t\t\tdefault:\n\t\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprotected get baseUrl(): string {\n\t\treturn `${this.protocol}://${this.domain}/${this.path}`;\n\t}\n\n\tprotected formatName(name: string) {\n\t\tif (this._name != null) return this._name;\n\t\treturn `${name}${this.custom ? ` (${this.domain})` : ''}`;\n\t}\n\n\tprotected splitPath(): [string, string] {\n\t\tconst index = this.path.indexOf('/');\n\t\treturn [this.path.substring(0, index), this.path.substring(index + 1)];\n\t}\n\n\tprotected abstract getUrlForBranch(branch: string): string;\n\n\tprotected abstract getUrlForBranches(): string;\n\n\tprotected abstract getUrlForCommit(sha: string): string;\n\n\tprotected getUrlForComparison?(base: string, compare: string, notation: '..' | '...'): string | undefined;\n\n\tprotected getUrlForCreatePullRequest?(\n\t\tbase: { branch?: string; remote: { path: string; url: string } },\n\t\tcompare: { branch: string; remote: { path: string; url: string } },\n\t): string | undefined;\n\n\tprotected abstract getUrlForFile(fileName: string, branch?: string, sha?: string, range?: Range): string;\n\n\tprotected getUrlForRepository(): string {\n\t\treturn this.baseUrl;\n\t}\n\n\tprivate async openUrl(url?: string): Promise<boolean | undefined> {\n\t\tif (url == null) return undefined;\n\n\t\treturn env.openExternal(Uri.parse(url));\n\t}\n\n\tprotected encodeUrl(url: string): string;\n\tprotected encodeUrl(url: string | undefined): string | undefined;\n\tprotected encodeUrl(url: string | undefined): string | undefined {\n\t\treturn encodeUrl(url)?.replace(/#/g, '%23');\n\t}\n}\n\nconst _connectedCache = new Set<string>();\nconst _onDidChangeAuthentication = new EventEmitter<{ reason: 'connected' | 'disconnected'; key: string }>();\nfunction fireAuthenticationChanged(key: string, reason: 'connected' | 'disconnected') {\n\t// Only fire events if the key is being connected for the first time (we could probably do the same for disconnected, but better safe on those imo)\n\tif (_connectedCache.has(key)) {\n\t\tif (reason === 'connected') return;\n\n\t\t_connectedCache.delete(key);\n\t} else if (reason === 'connected') {\n\t\t_connectedCache.add(key);\n\t}\n\n\t_onDidChangeAuthentication.fire({ key: key, reason: reason });\n}\n\nexport class Authentication {\n\tstatic get onDidChange(): Event<{ reason: 'connected' | 'disconnected'; key: string }> {\n\t\treturn _onDidChangeAuthentication.event;\n\t}\n}\n\n// TODO@eamodio revisit how once authenticated, all remotes are always connected, even after a restart\n\nexport abstract class RichRemoteProvider extends RemoteProvider {\n\toverride readonly type: 'simple' | 'rich' = 'rich';\n\n\tstatic is(provider: RemoteProvider | undefined): provider is RichRemoteProvider {\n\t\treturn provider?.type === 'rich';\n\t}\n\n\tprivate readonly _onDidChange = new EventEmitter<void>();\n\tget onDidChange(): Event<void> {\n\t\treturn this._onDidChange.event;\n\t}\n\n\tprivate invalidClientExceptionCount = 0;\n\n\tconstructor(domain: string, path: string, protocol?: string, name?: string, custom?: boolean) {\n\t\tsuper(domain, path, protocol, name, custom);\n\n\t\tContainer.instance.context.subscriptions.push(\n\t\t\t// TODO@eamodio revisit how connections are linked or not\n\t\t\tAuthentication.onDidChange(e => {\n\t\t\t\tif (e.key !== this.key) return;\n\n\t\t\t\tif (e.reason === 'disconnected') {\n\t\t\t\t\tthis.disconnect(true);\n\t\t\t\t} else if (e.reason === 'connected') {\n\t\t\t\t\tvoid this.ensureSession(false);\n\t\t\t\t}\n\t\t\t}),\n\t\t\tauthentication.onDidChangeSessions(this.onAuthenticationSessionsChanged, this),\n\t\t);\n\t}\n\n\tabstract get apiBaseUrl(): string;\n\tprotected abstract get authProvider(): { id: string; scopes: string[] };\n\n\tprivate get key() {\n\t\treturn this.custom ? `${this.name}:${this.domain}` : this.name;\n\t}\n\n\tprivate get connectedKey(): `${WorkspaceStorageKeys.ConnectedPrefix}${string}` {\n\t\treturn `${WorkspaceStorageKeys.ConnectedPrefix}${this.key}`;\n\t}\n\n\tget maybeConnected(): boolean | undefined {\n\t\tif (this._session === undefined) return undefined;\n\n\t\treturn this._session !== null;\n\t}\n\n\tprotected _session: AuthenticationSession | null | undefined;\n\tprotected session() {\n\t\tif (this._session === undefined) {\n\t\t\treturn this.ensureSession(false);\n\t\t}\n\t\treturn this._session ?? undefined;\n\t}\n\n\tprivate onAuthenticationSessionsChanged(e: AuthenticationSessionsChangeEvent) {\n\t\tif (e.provider.id === this.authProvider.id) {\n\t\t\tvoid this.ensureSession(false);\n\t\t}\n\t}\n\n\t@log()\n\tasync connect(): Promise<boolean> {\n\t\ttry {\n\t\t\tconst session = await this.ensureSession(true);\n\t\t\treturn Boolean(session);\n\t\t} catch (ex) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t@log()\n\tdisconnect(silent: boolean = false): void {\n\t\tconst connected = this._session != null;\n\n\t\tthis.invalidClientExceptionCount = 0;\n\t\tthis._prsByCommit.clear();\n\t\tthis._session = null;\n\n\t\tif (connected) {\n\t\t\tvoid Container.instance.storage.storeWorkspace(this.connectedKey, false);\n\n\t\t\tthis._onDidChange.fire();\n\t\t\tif (!silent) {\n\t\t\t\tfireAuthenticationChanged(this.key, 'disconnected');\n\t\t\t}\n\t\t}\n\t}\n\n\t@gate()\n\t@debug<RichRemoteProvider['isConnected']>({\n\t\texit: connected => `returned ${connected}`,\n\t})\n\tasync isConnected(): Promise<boolean> {\n\t\treturn (await this.session()) != null;\n\t}\n\n\t@gate()\n\t@debug()\n\tasync getAccountForCommit(\n\t\tref: string,\n\t\toptions?: {\n\t\t\tavatarSize?: number;\n\t\t},\n\t): Promise<Account | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst connected = this.maybeConnected ?? (await this.isConnected());\n\t\tif (!connected) return undefined;\n\n\t\ttry {\n\t\t\tconst author = await this.getProviderAccountForCommit(this._session!, ref, options);\n\t\t\tthis.invalidClientExceptionCount = 0;\n\t\t\treturn author;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\n\t\t\tif (ex instanceof AuthenticationError || ex instanceof ProviderRequestClientError) {\n\t\t\t\tthis.handleClientException();\n\t\t\t}\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprotected abstract getProviderAccountForCommit(\n\t\tsession: AuthenticationSession,\n\t\tref: string,\n\t\toptions?: {\n\t\t\tavatarSize?: number;\n\t\t},\n\t): Promise<Account | undefined>;\n\n\t@gate()\n\t@debug()\n\tasync getAccountForEmail(\n\t\temail: string,\n\t\toptions?: {\n\t\t\tavatarSize?: number;\n\t\t},\n\t): Promise<Account | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst connected = this.maybeConnected ?? (await this.isConnected());\n\t\tif (!connected) return undefined;\n\n\t\ttry {\n\t\t\tconst author = await this.getProviderAccountForEmail(this._session!, email, options);\n\t\t\tthis.invalidClientExceptionCount = 0;\n\t\t\treturn author;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\n\t\t\tif (ex instanceof AuthenticationError || ex instanceof ProviderRequestClientError) {\n\t\t\t\tthis.handleClientException();\n\t\t\t}\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprotected abstract getProviderAccountForEmail(\n\t\tsession: AuthenticationSession,\n\t\temail: string,\n\t\toptions?: {\n\t\t\tavatarSize?: number;\n\t\t},\n\t): Promise<Account | undefined>;\n\n\t@gate()\n\t@debug()\n\tasync getDefaultBranch(): Promise<DefaultBranch | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst connected = this.maybeConnected ?? (await this.isConnected());\n\t\tif (!connected) return undefined;\n\n\t\ttry {\n\t\t\tconst defaultBranch = await this.getProviderDefaultBranch(this._session!);\n\t\t\tthis.invalidClientExceptionCount = 0;\n\t\t\treturn defaultBranch;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\n\t\t\tif (ex instanceof AuthenticationError || ex instanceof ProviderRequestClientError) {\n\t\t\t\tthis.handleClientException();\n\t\t\t}\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprotected abstract getProviderDefaultBranch({\n\t\taccessToken,\n\t}: AuthenticationSession): Promise<DefaultBranch | undefined>;\n\n\t@gate()\n\t@debug()\n\tasync getIssueOrPullRequest(id: string): Promise<IssueOrPullRequest | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst connected = this.maybeConnected ?? (await this.isConnected());\n\t\tif (!connected) return undefined;\n\n\t\ttry {\n\t\t\tconst issueOrPullRequest = await this.getProviderIssueOrPullRequest(this._session!, id);\n\t\t\tthis.invalidClientExceptionCount = 0;\n\t\t\treturn issueOrPullRequest;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\n\t\t\tif (ex instanceof AuthenticationError || ex instanceof ProviderRequestClientError) {\n\t\t\t\tthis.handleClientException();\n\t\t\t}\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprotected abstract getProviderIssueOrPullRequest(\n\t\tsession: AuthenticationSession,\n\t\tid: string,\n\t): Promise<IssueOrPullRequest | undefined>;\n\n\t@gate()\n\t@debug()\n\tasync getPullRequestForBranch(\n\t\tbranch: string,\n\t\toptions?: {\n\t\t\tavatarSize?: number;\n\t\t\tinclude?: PullRequestState[];\n\t\t},\n\t): Promise<PullRequest | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst connected = this.maybeConnected ?? (await this.isConnected());\n\t\tif (!connected) return undefined;\n\n\t\ttry {\n\t\t\tconst pr = await this.getProviderPullRequestForBranch(this._session!, branch, options);\n\t\t\tthis.invalidClientExceptionCount = 0;\n\t\t\treturn pr;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\n\t\t\tif (ex instanceof AuthenticationError || ex instanceof ProviderRequestClientError) {\n\t\t\t\tthis.handleClientException();\n\t\t\t}\n\t\t\treturn undefined;\n\t\t}\n\t}\n\tprotected abstract getProviderPullRequestForBranch(\n\t\tsession: AuthenticationSession,\n\t\tbranch: string,\n\t\toptions?: {\n\t\t\tavatarSize?: number;\n\t\t\tinclude?: PullRequestState[];\n\t\t},\n\t): Promise<PullRequest | undefined>;\n\n\tprivate _prsByCommit = new Map<string, Promise<PullRequest | null> | PullRequest | null>();\n\n\t@gate()\n\t@debug()\n\tgetPullRequestForCommit(ref: string): Promise<PullRequest | undefined> | PullRequest | undefined {\n\t\tlet pr = this._prsByCommit.get(ref);\n\t\tif (pr === undefined) {\n\t\t\tpr = this.getPullRequestForCommitCore(ref);\n\t\t\tthis._prsByCommit.set(ref, pr);\n\t\t}\n\t\tif (pr == null || !isPromise(pr)) return pr ?? undefined;\n\n\t\treturn pr.then(pr => pr ?? undefined);\n\t}\n\n\t@debug()\n\tprivate async getPullRequestForCommitCore(ref: string) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tconst connected = this.maybeConnected ?? (await this.isConnected());\n\t\tif (!connected) return null;\n\n\t\ttry {\n\t\t\tconst pr = (await this.getProviderPullRequestForCommit(this._session!, ref)) ?? null;\n\t\t\tthis._prsByCommit.set(ref, pr);\n\t\t\tthis.invalidClientExceptionCount = 0;\n\t\t\treturn pr;\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\n\t\t\tthis._prsByCommit.delete(ref);\n\n\t\t\tif (ex instanceof AuthenticationError || ex instanceof ProviderRequestClientError) {\n\t\t\t\tthis.handleClientException();\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tprotected abstract getProviderPullRequestForCommit(\n\t\tsession: AuthenticationSession,\n\t\tref: string,\n\t): Promise<PullRequest | undefined>;\n\n\t@gate()\n\tprivate async ensureSession(createIfNeeded: boolean): Promise<AuthenticationSession | undefined> {\n\t\tif (this._session != null) return this._session;\n\n\t\tif (!Container.instance.config.integrations.enabled) return undefined;\n\n\t\tif (createIfNeeded) {\n\t\t\tawait Container.instance.storage.deleteWorkspace(this.connectedKey);\n\t\t} else if (Container.instance.storage.getWorkspace<boolean>(this.connectedKey) === false) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tlet session;\n\t\ttry {\n\t\t\tsession = await authentication.getSession(this.authProvider.id, this.authProvider.scopes, {\n\t\t\t\tcreateIfNone: createIfNeeded,\n\t\t\t\tsilent: !createIfNeeded,\n\t\t\t});\n\t\t} catch (ex) {\n\t\t\tawait Container.instance.storage.deleteWorkspace(this.connectedKey);\n\n\t\t\tif (ex instanceof Error && ex.message.includes('User did not consent')) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tsession = null;\n\t\t}\n\n\t\tif (session === undefined && !createIfNeeded) {\n\t\t\tawait Container.instance.storage.deleteWorkspace(this.connectedKey);\n\t\t}\n\n\t\tthis._session = session ?? null;\n\t\tthis.invalidClientExceptionCount = 0;\n\n\t\tif (session != null) {\n\t\t\tawait Container.instance.storage.storeWorkspace(this.connectedKey, true);\n\n\t\t\tqueueMicrotask(() => {\n\t\t\t\tthis._onDidChange.fire();\n\t\t\t\tfireAuthenticationChanged(this.key, 'connected');\n\t\t\t});\n\t\t}\n\n\t\treturn session ?? undefined;\n\t}\n\n\t@debug()\n\tprivate handleClientException() {\n\t\tthis.invalidClientExceptionCount++;\n\n\t\tif (this.invalidClientExceptionCount >= 5) {\n\t\t\tthis.disconnect();\n\t\t}\n\t}\n}\n","import { GitRevision, GitRevisionReference } from './models';\n\nexport type SearchOperators =\n\t| ''\n\t| '=:'\n\t| 'message:'\n\t| '@:'\n\t| 'author:'\n\t| '#:'\n\t| 'commit:'\n\t| '?:'\n\t| 'file:'\n\t| '~:'\n\t| 'change:';\n\nexport const searchOperators = new Set<string>([\n\t'',\n\t'=:',\n\t'message:',\n\t'@:',\n\t'author:',\n\t'#:',\n\t'commit:',\n\t'?:',\n\t'file:',\n\t'~:',\n\t'change:',\n]);\n\nexport interface SearchPattern {\n\tpattern: string;\n\tmatchAll?: boolean;\n\tmatchCase?: boolean;\n\tmatchRegex?: boolean;\n}\n\nexport namespace SearchPattern {\n\tconst normalizeSearchOperatorsMap = new Map<SearchOperators, SearchOperators>([\n\t\t['', 'message:'],\n\t\t['=:', 'message:'],\n\t\t['message:', 'message:'],\n\t\t['@:', 'author:'],\n\t\t['author:', 'author:'],\n\t\t['#:', 'commit:'],\n\t\t['commit:', 'commit:'],\n\t\t['?:', 'file:'],\n\t\t['file:', 'file:'],\n\t\t['~:', 'change:'],\n\t\t['change:', 'change:'],\n\t]);\n\n\tconst searchOperationRegex =\n\t\t/(?:(?<op>=:|message:|@:|author:|#:|commit:|\\?:|file:|~:|change:)\\s?(?<value>\".+?\"|\\S+\\b}?))|(?<text>\\S+)(?!(?:=|message|@|author|#|commit|\\?|file|~|change):)/gi;\n\n\texport function fromCommit(ref: string): string;\n\texport function fromCommit(commit: GitRevisionReference): string;\n\texport function fromCommit(refOrCommit: string | GitRevisionReference) {\n\t\treturn `#:${typeof refOrCommit === 'string' ? GitRevision.shorten(refOrCommit) : refOrCommit.name}`;\n\t}\n\n\texport function fromCommits(refs: string[]): string;\n\texport function fromCommits(commits: GitRevisionReference[]): string;\n\texport function fromCommits(refsOrCommits: (string | GitRevisionReference)[]) {\n\t\treturn refsOrCommits.map(r => `#:${typeof r === 'string' ? GitRevision.shorten(r) : r.name}`).join(' ');\n\t}\n\n\texport function parseSearchOperations(search: string): Map<string, string[]> {\n\t\tconst operations = new Map<string, string[]>();\n\n\t\tlet op: SearchOperators | undefined;\n\t\tlet value: string | undefined;\n\t\tlet text: string | undefined;\n\n\t\tlet match;\n\t\tdo {\n\t\t\tmatch = searchOperationRegex.exec(search);\n\t\t\tif (match?.groups == null) break;\n\n\t\t\top = normalizeSearchOperatorsMap.get(match.groups.op as SearchOperators);\n\t\t\t({ value, text } = match.groups);\n\n\t\t\tif (text) {\n\t\t\t\top = GitRevision.isSha(text) ? 'commit:' : 'message:';\n\t\t\t\tvalue = text;\n\t\t\t}\n\n\t\t\tif (op && value) {\n\t\t\t\tconst values = operations.get(op);\n\t\t\t\tif (values == null) {\n\t\t\t\t\toperations.set(op, [value]);\n\t\t\t\t} else {\n\t\t\t\t\tvalues.push(value);\n\t\t\t\t}\n\t\t\t}\n\t\t} while (match != null);\n\n\t\treturn operations;\n\t}\n\n\texport function toKey(search: SearchPattern) {\n\t\treturn `${search.pattern}|${search.matchAll ? 'A' : ''}${search.matchCase ? 'C' : ''}${\n\t\t\tsearch.matchRegex ? 'R' : ''\n\t\t}`;\n\t}\n}\n","import { ExtensionContext, ExtensionMode, OutputChannel, Uri, window } from 'vscode';\nimport { OutputLevel } from './configuration';\nimport { getCorrelationContext, getNextCorrelationId } from './system/decorators/log';\n\nconst emptyStr = '';\nconst outputChannelName = 'GitLens';\nconst consolePrefix = '[GitLens]';\n\nconst gitOutputChannelName = 'GitLens (Git)';\nconst gitConsolePrefix = '[GitLens (Git)]';\n\nexport const enum LogLevel {\n\tOff = 'off',\n\tError = 'error',\n\tWarn = 'warn',\n\tInfo = 'info',\n\tDebug = 'debug',\n}\n\nconst enum OrderedLevel {\n\tOff = 0,\n\tError = 1,\n\tWarn = 2,\n\tInfo = 3,\n\tDebug = 4,\n}\n\nexport interface LogCorrelationContext {\n\treadonly correlationId?: number;\n\treadonly prefix: string;\n\texitDetails?: string;\n}\n\nexport class Logger {\n\tstatic readonly slowCallWarningThreshold = 500;\n\n\tprivate static output: OutputChannel | undefined;\n\tprivate static customLoggableFn: ((o: object) => string | undefined) | undefined;\n\n\tstatic configure(context: ExtensionContext, outputLevel: OutputLevel, loggableFn?: (o: any) => string | undefined) {\n\t\tthis._isDebugging = context.extensionMode === ExtensionMode.Development;\n\t\tthis.logLevel = outputLevel;\n\t\tthis.customLoggableFn = loggableFn;\n\t}\n\n\tstatic enabled(level: LogLevel): boolean {\n\t\treturn this.level >= toOrderedLevel(level);\n\t}\n\n\tprivate static _isDebugging: boolean;\n\tstatic get isDebugging() {\n\t\treturn this._isDebugging;\n\t}\n\n\tprivate static level: OrderedLevel = OrderedLevel.Off;\n\tprivate static _logLevel: LogLevel = LogLevel.Off;\n\tstatic get logLevel(): LogLevel {\n\t\treturn this._logLevel;\n\t}\n\tstatic set logLevel(value: LogLevel | OutputLevel) {\n\t\tthis._logLevel = fromOutputLevel(value);\n\t\tthis.level = toOrderedLevel(this._logLevel);\n\n\t\tif (value === LogLevel.Off) {\n\t\t\tthis.output?.dispose();\n\t\t\tthis.output = undefined;\n\t\t} else {\n\t\t\tthis.output = this.output ?? window.createOutputChannel(outputChannelName);\n\t\t}\n\t}\n\n\tstatic debug(message: string, ...params: any[]): void;\n\tstatic debug(context: LogCorrelationContext | undefined, message: string, ...params: any[]): void;\n\tstatic debug(contextOrMessage: LogCorrelationContext | string | undefined, ...params: any[]): void {\n\t\tif (this.level < OrderedLevel.Debug && !this.isDebugging) return;\n\n\t\tlet message;\n\t\tif (typeof contextOrMessage === 'string') {\n\t\t\tmessage = contextOrMessage;\n\t\t} else {\n\t\t\tmessage = params.shift();\n\n\t\t\tif (contextOrMessage != null) {\n\t\t\t\tmessage = `${contextOrMessage.prefix} ${message ?? emptyStr}`;\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDebugging) {\n\t\t\tconsole.log(this.timestamp, consolePrefix, message ?? emptyStr, ...params);\n\t\t}\n\n\t\tif (this.output == null || this.level < OrderedLevel.Debug) return;\n\t\tthis.output.appendLine(`${this.timestamp} ${message ?? emptyStr}${this.toLoggableParams(true, params)}`);\n\t}\n\n\tstatic error(ex: Error | unknown, message?: string, ...params: any[]): void;\n\tstatic error(ex: Error | unknown, context?: LogCorrelationContext, message?: string, ...params: any[]): void;\n\tstatic error(\n\t\tex: Error | unknown,\n\t\tcontextOrMessage: LogCorrelationContext | string | undefined,\n\t\t...params: any[]\n\t): void {\n\t\tif (this.level < OrderedLevel.Error && !this.isDebugging) return;\n\n\t\tlet message;\n\t\tif (contextOrMessage == null || typeof contextOrMessage === 'string') {\n\t\t\tmessage = contextOrMessage;\n\t\t} else {\n\t\t\tmessage = `${contextOrMessage.prefix} ${params.shift() ?? emptyStr}`;\n\t\t}\n\n\t\tif (message == null) {\n\t\t\tconst stack = ex instanceof Error ? ex.stack : undefined;\n\t\t\tif (stack) {\n\t\t\t\tconst match = /.*\\s*?at\\s(.+?)\\s/.exec(stack);\n\t\t\t\tif (match != null) {\n\t\t\t\t\tmessage = match[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDebugging) {\n\t\t\tconsole.error(this.timestamp, consolePrefix, message ?? emptyStr, ...params, ex);\n\t\t}\n\n\t\tif (this.output == null || this.level < OrderedLevel.Error) return;\n\t\tthis.output.appendLine(\n\t\t\t`${this.timestamp} ${message ?? emptyStr}${this.toLoggableParams(false, params)}\\n${String(ex)}`,\n\t\t);\n\t}\n\n\tstatic log(message: string, ...params: any[]): void;\n\tstatic log(context: LogCorrelationContext | undefined, message: string, ...params: any[]): void;\n\tstatic log(contextOrMessage: LogCorrelationContext | string | undefined, ...params: any[]): void {\n\t\tif (this.level < OrderedLevel.Info && !this.isDebugging) return;\n\n\t\tlet message;\n\t\tif (typeof contextOrMessage === 'string') {\n\t\t\tmessage = contextOrMessage;\n\t\t} else {\n\t\t\tmessage = params.shift();\n\n\t\t\tif (contextOrMessage != null) {\n\t\t\t\tmessage = `${contextOrMessage.prefix} ${message ?? emptyStr}`;\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDebugging) {\n\t\t\tconsole.log(this.timestamp, consolePrefix, message ?? emptyStr, ...params);\n\t\t}\n\n\t\tif (this.output == null || this.level < OrderedLevel.Info) return;\n\t\tthis.output.appendLine(`${this.timestamp} ${message ?? emptyStr}${this.toLoggableParams(false, params)}`);\n\t}\n\n\tstatic warn(message: string, ...params: any[]): void;\n\tstatic warn(context: LogCorrelationContext | undefined, message: string, ...params: any[]): void;\n\tstatic warn(contextOrMessage: LogCorrelationContext | string | undefined, ...params: any[]): void {\n\t\tif (this.level < OrderedLevel.Warn && !this.isDebugging) return;\n\n\t\tlet message;\n\t\tif (typeof contextOrMessage === 'string') {\n\t\t\tmessage = contextOrMessage;\n\t\t} else {\n\t\t\tmessage = params.shift();\n\n\t\t\tif (contextOrMessage != null) {\n\t\t\t\tmessage = `${contextOrMessage.prefix} ${message ?? emptyStr}`;\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDebugging) {\n\t\t\tconsole.warn(this.timestamp, consolePrefix, message ?? emptyStr, ...params);\n\t\t}\n\n\t\tif (this.output == null || this.level < OrderedLevel.Warn) return;\n\t\tthis.output.appendLine(`${this.timestamp} ${message ?? emptyStr}${this.toLoggableParams(false, params)}`);\n\t}\n\n\tstatic getCorrelationContext() {\n\t\treturn getCorrelationContext();\n\t}\n\n\tstatic getNewCorrelationContext(prefix: string): LogCorrelationContext {\n\t\tconst correlationId = getNextCorrelationId();\n\t\treturn {\n\t\t\tcorrelationId: correlationId,\n\t\t\tprefix: `[${String(correlationId).padStart(5)}] ${prefix}`,\n\t\t};\n\t}\n\n\tstatic showOutputChannel(): void {\n\t\tthis.output?.show();\n\t}\n\n\tstatic toLoggable(p: any, sanitize?: ((key: string, value: any) => any) | undefined) {\n\t\tif (typeof p !== 'object') return String(p);\n\t\tif (this.customLoggableFn != null) {\n\t\t\tconst loggable = this.customLoggableFn(p);\n\t\t\tif (loggable != null) return loggable;\n\t\t}\n\t\tif (p instanceof Uri) return `Uri(${p.toString(true)})`;\n\n\t\ttry {\n\t\t\treturn JSON.stringify(p, sanitize);\n\t\t} catch {\n\t\t\treturn '<error>';\n\t\t}\n\t}\n\n\tstatic toLoggableName(instance: Function | object) {\n\t\tlet name: string;\n\t\tif (typeof instance === 'function') {\n\t\t\tif (instance.prototype == null || instance.prototype.constructor == null) {\n\t\t\t\treturn instance.name;\n\t\t\t}\n\n\t\t\tname = instance.prototype.constructor.name ?? emptyStr;\n\t\t} else {\n\t\t\tname = instance.constructor?.name ?? emptyStr;\n\t\t}\n\n\t\t// Strip webpack module name (since I never name classes with an _)\n\t\tconst index = name.indexOf('_');\n\t\treturn index === -1 ? name : name.substr(index + 1);\n\t}\n\n\tprivate static get timestamp(): string {\n\t\treturn `[${new Date().toISOString().replace(/T/, ' ').slice(0, -1)}]`;\n\t}\n\n\tprivate static toLoggableParams(debugOnly: boolean, params: any[]) {\n\t\tif (params.length === 0 || (debugOnly && this.level < OrderedLevel.Debug && !this.isDebugging)) {\n\t\t\treturn emptyStr;\n\t\t}\n\n\t\tconst loggableParams = params.map(p => this.toLoggable(p)).join(', ');\n\t\treturn loggableParams.length !== 0 ? ` \\u2014 ${loggableParams}` : emptyStr;\n\t}\n\n\tstatic gitOutput: OutputChannel | undefined;\n\n\tstatic logGitCommand(command: string, duration: number, ex?: Error): void {\n\t\tif (this.level < OrderedLevel.Debug && !this.isDebugging) return;\n\n\t\tconst slow = duration > Logger.slowCallWarningThreshold;\n\n\t\tif (this.isDebugging) {\n\t\t\tif (ex != null) {\n\t\t\t\tconsole.error(this.timestamp, gitConsolePrefix, command ?? emptyStr, ex);\n\t\t\t} else if (slow) {\n\t\t\t\tconsole.warn(this.timestamp, gitConsolePrefix, command ?? emptyStr);\n\t\t\t} else {\n\t\t\t\tconsole.log(this.timestamp, gitConsolePrefix, command ?? emptyStr);\n\t\t\t}\n\t\t}\n\n\t\tif (this.gitOutput == null) {\n\t\t\tthis.gitOutput = window.createOutputChannel(gitOutputChannelName);\n\t\t}\n\t\tthis.gitOutput.appendLine(\n\t\t\t`${this.timestamp} [${slow ? '*' : ' '}${duration.toString().padStart(6)}ms] ${command}${\n\t\t\t\tex != null ? `\\n\\n${ex.toString()}` : emptyStr\n\t\t\t}`,\n\t\t);\n\t}\n}\n\nfunction fromOutputLevel(level: LogLevel | OutputLevel): LogLevel {\n\tswitch (level) {\n\t\tcase OutputLevel.Silent:\n\t\t\treturn LogLevel.Off;\n\t\tcase OutputLevel.Errors:\n\t\t\treturn LogLevel.Error;\n\t\tcase OutputLevel.Verbose:\n\t\t\treturn LogLevel.Info;\n\t\tcase OutputLevel.Debug:\n\t\t\treturn LogLevel.Debug;\n\t\tdefault:\n\t\t\treturn level;\n\t}\n}\n\nfunction toOrderedLevel(logLevel: LogLevel): OrderedLevel {\n\tswitch (logLevel) {\n\t\tcase LogLevel.Off:\n\t\t\treturn OrderedLevel.Off;\n\t\tcase LogLevel.Error:\n\t\t\treturn OrderedLevel.Error;\n\t\tcase LogLevel.Warn:\n\t\t\treturn OrderedLevel.Warn;\n\t\tcase LogLevel.Info:\n\t\t\treturn OrderedLevel.Info;\n\t\tcase LogLevel.Debug:\n\t\t\treturn OrderedLevel.Debug;\n\t\tdefault:\n\t\t\treturn OrderedLevel.Off;\n\t}\n}\n","import { ConfigurationTarget, env, MessageItem, Uri, window } from 'vscode';\nimport { configuration } from './configuration';\nimport { Commands } from './constants';\nimport { GitCommit } from './git/models';\nimport { Logger } from './logger';\nimport { executeCommand } from './system/command';\n\nexport const enum SuppressedMessages {\n\tCommitHasNoPreviousCommitWarning = 'suppressCommitHasNoPreviousCommitWarning',\n\tCommitNotFoundWarning = 'suppressCommitNotFoundWarning',\n\tCreatePullRequestPrompt = 'suppressCreatePullRequestPrompt',\n\tSuppressDebugLoggingWarning = 'suppressDebugLoggingWarning',\n\tFileNotUnderSourceControlWarning = 'suppressFileNotUnderSourceControlWarning',\n\tGitDisabledWarning = 'suppressGitDisabledWarning',\n\tGitMissingWarning = 'suppressGitMissingWarning',\n\tGitVersionWarning = 'suppressGitVersionWarning',\n\tLineUncommittedWarning = 'suppressLineUncommittedWarning',\n\tNoRepositoryWarning = 'suppressNoRepositoryWarning',\n\tRebaseSwitchToTextWarning = 'suppressRebaseSwitchToTextWarning',\n}\n\nexport class Messages {\n\tstatic showCommitHasNoPreviousCommitWarningMessage(commit?: GitCommit): Promise<MessageItem | undefined> {\n\t\tif (commit == null) {\n\t\t\treturn Messages.showMessage(\n\t\t\t\t'info',\n\t\t\t\t'There is no previous commit.',\n\t\t\t\tSuppressedMessages.CommitHasNoPreviousCommitWarning,\n\t\t\t);\n\t\t}\n\t\treturn Messages.showMessage(\n\t\t\t'info',\n\t\t\t`Commit ${commit.shortSha} (${commit.author.name}, ${commit.formattedDate}) has no previous commit.`,\n\t\t\tSuppressedMessages.CommitHasNoPreviousCommitWarning,\n\t\t);\n\t}\n\n\tstatic showCommitNotFoundWarningMessage(message: string): Promise<MessageItem | undefined> {\n\t\treturn Messages.showMessage(\n\t\t\t'warn',\n\t\t\t`${message}. The commit could not be found.`,\n\t\t\tSuppressedMessages.CommitNotFoundWarning,\n\t\t);\n\t}\n\n\tstatic async showCreatePullRequestPrompt(branch: string): Promise<boolean> {\n\t\tconst create = { title: 'Create Pull Request...' };\n\t\tconst result = await Messages.showMessage(\n\t\t\t'info',\n\t\t\t`Would you like to create a Pull Request for branch '${branch}'?`,\n\t\t\tSuppressedMessages.CreatePullRequestPrompt,\n\t\t\t{ title: \"Don't Show Again\" },\n\t\t\tcreate,\n\t\t);\n\t\treturn result === create;\n\t}\n\n\tstatic async showDebugLoggingWarningMessage(): Promise<boolean> {\n\t\tconst disable = { title: 'Disable Debug Logging' };\n\t\tconst result = await Messages.showMessage(\n\t\t\t'warn',\n\t\t\t'GitLens debug logging is currently enabled. Unless you are reporting an issue, it is recommended to be disabled. Would you like to disable it?',\n\t\t\tSuppressedMessages.SuppressDebugLoggingWarning,\n\t\t\t{ title: \"Don't Show Again\" },\n\t\t\tdisable,\n\t\t);\n\n\t\treturn result === disable;\n\t}\n\n\tstatic async showGenericErrorMessage(message: string): Promise<MessageItem | undefined> {\n\t\tconst actions: MessageItem[] = [{ title: 'Open Output Channel' }];\n\t\tconst result = await Messages.showMessage(\n\t\t\t'error',\n\t\t\t`${message}. See output channel for more details`,\n\t\t\tundefined,\n\t\t\tnull,\n\t\t\t...actions,\n\t\t);\n\n\t\tif (result !== undefined) {\n\t\t\tLogger.showOutputChannel();\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic showFileNotUnderSourceControlWarningMessage(message: string): Promise<MessageItem | undefined> {\n\t\treturn Messages.showMessage(\n\t\t\t'warn',\n\t\t\t`${message}. The file is probably not under source control.`,\n\t\t\tSuppressedMessages.FileNotUnderSourceControlWarning,\n\t\t);\n\t}\n\n\tstatic showGitDisabledErrorMessage() {\n\t\treturn Messages.showMessage(\n\t\t\t'error',\n\t\t\t'GitLens requires Git to be enabled. Please re-enable Git \\u2014 set `git.enabled` to true and reload.',\n\t\t\tSuppressedMessages.GitDisabledWarning,\n\t\t);\n\t}\n\n\tstatic showGitInvalidConfigErrorMessage() {\n\t\treturn Messages.showMessage(\n\t\t\t'error',\n\t\t\t'GitLens is unable to use Git. Your Git configuration seems to be invalid. Please resolve any issues with your Git configuration and reload.',\n\t\t);\n\t}\n\n\tstatic showGitMissingErrorMessage() {\n\t\treturn Messages.showMessage(\n\t\t\t'error',\n\t\t\t\"GitLens was unable to find Git. Please make sure Git is installed. Also ensure that Git is either in the PATH, or that 'git.path' is pointed to its installed location.\",\n\t\t\tSuppressedMessages.GitMissingWarning,\n\t\t);\n\t}\n\n\tstatic showGitVersionUnsupportedErrorMessage(version: string, required: string): Promise<MessageItem | undefined> {\n\t\treturn Messages.showMessage(\n\t\t\t'error',\n\t\t\t`GitLens requires a newer version of Git (>= ${required}) than is currently installed (${version}). Please install a more recent version of Git.`,\n\t\t\tSuppressedMessages.GitVersionWarning,\n\t\t);\n\t}\n\n\tstatic showInsidersErrorMessage() {\n\t\treturn Messages.showMessage(\n\t\t\t'error',\n\t\t\t'GitLens (Insiders) cannot be used while GitLens is also enabled. Please ensure that only one version is enabled.',\n\t\t\tSuppressedMessages.GitDisabledWarning,\n\t\t);\n\t}\n\n\tstatic showLineUncommittedWarningMessage(message: string): Promise<MessageItem | undefined> {\n\t\treturn Messages.showMessage(\n\t\t\t'warn',\n\t\t\t`${message}. The line has uncommitted changes.`,\n\t\t\tSuppressedMessages.LineUncommittedWarning,\n\t\t);\n\t}\n\n\tstatic showNoRepositoryWarningMessage(message: string): Promise<MessageItem | undefined> {\n\t\treturn Messages.showMessage(\n\t\t\t'warn',\n\t\t\t`${message}. No repository could be found.`,\n\t\t\tSuppressedMessages.NoRepositoryWarning,\n\t\t);\n\t}\n\n\tstatic showRebaseSwitchToTextWarningMessage(): Promise<MessageItem | undefined> {\n\t\treturn Messages.showMessage(\n\t\t\t'warn',\n\t\t\t'Closing either the git-rebase-todo file or the Rebase Editor will start the rebase.',\n\t\t\tSuppressedMessages.RebaseSwitchToTextWarning,\n\t\t);\n\t}\n\n\tstatic async showWhatsNewMessage(version: string) {\n\t\tconst whatsnew = { title: \"See What's New\" };\n\t\tconst result = await Messages.showMessage(\n\t\t\t'info',\n\t\t\t`GitLens ${version} is here  check out what's new!`,\n\t\t\tundefined,\n\t\t\tnull,\n\t\t\twhatsnew,\n\t\t);\n\n\t\tif (result === whatsnew) {\n\t\t\tvoid (await executeCommand(Commands.ShowWelcomePage));\n\t\t}\n\t}\n\n\tprivate static async showMessage(\n\t\ttype: 'info' | 'warn' | 'error',\n\t\tmessage: string,\n\t\tsuppressionKey?: SuppressedMessages,\n\t\tdontShowAgain: MessageItem | null = { title: \"Don't Show Again\" },\n\t\t...actions: MessageItem[]\n\t): Promise<MessageItem | undefined> {\n\t\tLogger.log(`ShowMessage(${type}, '${message}', ${suppressionKey}, ${JSON.stringify(dontShowAgain)})`);\n\n\t\tif (suppressionKey !== undefined && configuration.get(`advanced.messages.${suppressionKey}` as const)) {\n\t\t\tLogger.log(\n\t\t\t\t`ShowMessage(${type}, '${message}', ${suppressionKey}, ${JSON.stringify(dontShowAgain)}) skipped`,\n\t\t\t);\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (suppressionKey !== undefined && dontShowAgain !== null) {\n\t\t\tactions.push(dontShowAgain);\n\t\t}\n\n\t\tlet result: MessageItem | undefined = undefined;\n\t\tswitch (type) {\n\t\t\tcase 'info':\n\t\t\t\tresult = await window.showInformationMessage(message, ...actions);\n\t\t\t\tbreak;\n\n\t\t\tcase 'warn':\n\t\t\t\tresult = await window.showWarningMessage(message, ...actions);\n\t\t\t\tbreak;\n\n\t\t\tcase 'error':\n\t\t\t\tresult = await window.showErrorMessage(message, ...actions);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ((suppressionKey !== undefined && dontShowAgain === null) || result === dontShowAgain) {\n\t\t\tLogger.log(\n\t\t\t\t`ShowMessage(${type}, '${message}', ${suppressionKey}, ${JSON.stringify(\n\t\t\t\t\tdontShowAgain,\n\t\t\t\t)}) don't show again requested`,\n\t\t\t);\n\t\t\tawait this.suppressedMessage(suppressionKey!);\n\n\t\t\tif (result === dontShowAgain) return undefined;\n\t\t}\n\n\t\tLogger.log(\n\t\t\t`ShowMessage(${type}, '${message}', ${suppressionKey}, ${JSON.stringify(dontShowAgain)}) returned ${\n\t\t\t\tresult != null ? result.title : result\n\t\t\t}`,\n\t\t);\n\t\treturn result;\n\t}\n\n\tprivate static suppressedMessage(suppressionKey: SuppressedMessages) {\n\t\tconst messages = { ...configuration.get('advanced.messages') };\n\n\t\tmessages[suppressionKey] = true;\n\n\t\tfor (const [key, value] of Object.entries(messages)) {\n\t\t\tif (value !== true) {\n\t\t\t\tdelete messages[key as keyof typeof messages];\n\t\t\t}\n\t\t}\n\n\t\treturn configuration.update('advanced.messages', messages, ConfigurationTarget.Global);\n\t}\n}\n","import { QuickPickItem, window } from 'vscode';\nimport { GitActions } from '../../commands/gitCommands.actions';\nimport { OpenChangedFilesCommandArgs } from '../../commands/openChangedFiles';\nimport { QuickCommandButtons } from '../../commands/quickCommand.buttons';\nimport { Commands, GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { CommitFormatter } from '../../git/formatters';\nimport { GitCommit, GitFile, GitFileChange, GitStatusFile } from '../../git/models';\nimport { Keys } from '../../keyboard';\nimport { basename } from '../../system/path';\nimport { pad } from '../../system/string';\nimport { CommandQuickPickItem } from './common';\n\nexport class CommitFilesQuickPickItem extends CommandQuickPickItem {\n\tconstructor(\n\t\treadonly commit: GitCommit,\n\t\toptions?: {\n\t\t\tfile?: GitFileChange;\n\t\t\tunpublished?: boolean | undefined;\n\t\t\tpicked?: boolean;\n\t\t\thint?: string;\n\t\t},\n\t) {\n\t\tsuper(\n\t\t\t{\n\t\t\t\tlabel: commit.summary,\n\t\t\t\tdescription: `${CommitFormatter.fromTemplate(`\\${author}, \\${ago}  $(git-commit)  \\${id}`, commit)}${\n\t\t\t\t\toptions?.unpublished ? '  (unpublished)' : ''\n\t\t\t\t}`,\n\t\t\t\tdetail: `${\n\t\t\t\t\toptions?.file != null\n\t\t\t\t\t\t? `$(file) ${basename(options.file.path)}${options.file.formatStats({\n\t\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t\t\tseparator: ', ',\n\t\t\t\t\t\t\t\tprefix: ` ${GlyphChars.Dot} `,\n\t\t\t\t\t\t  })}`\n\t\t\t\t\t\t: `$(files) ${commit.formatStats({\n\t\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t\t\tseparator: ', ',\n\t\t\t\t\t\t\t\tempty: 'No files changed',\n\t\t\t\t\t\t  })}`\n\t\t\t\t}${options?.hint != null ? `${pad(GlyphChars.Dash, 4, 2, GlyphChars.Space)}${options.hint}` : ''}`,\n\t\t\t\talwaysShow: true,\n\t\t\t\tpicked: options?.picked ?? true,\n\t\t\t\tbuttons: GitCommit.isStash(commit)\n\t\t\t\t\t? [QuickCommandButtons.RevealInSideBar]\n\t\t\t\t\t: [QuickCommandButtons.RevealInSideBar, QuickCommandButtons.SearchInSideBar],\n\t\t\t},\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\t{ suppressKeyPress: true },\n\t\t);\n\t}\n\n\tget sha(): string {\n\t\treturn this.commit.sha;\n\t}\n}\n\nexport class CommitFileQuickPickItem extends CommandQuickPickItem {\n\tconstructor(readonly commit: GitCommit, readonly file: GitFile, picked?: boolean) {\n\t\tsuper({\n\t\t\tlabel: `${pad(GitFile.getStatusCodicon(file.status), 0, 2)}${basename(file.path)}`,\n\t\t\tdescription: GitFile.getFormattedDirectory(file, true),\n\t\t\tpicked: picked,\n\t\t});\n\n\t\t// TODO@eamodio - add line diff details\n\t\t// this.detail = this.commit.getFormattedDiffStatus({ expand: true });\n\t}\n\n\tget sha(): string {\n\t\treturn this.commit.sha;\n\t}\n\n\toverride execute(options?: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn GitActions.Commit.openChanges(this.file, this.commit, options);\n\t\t// const fileCommit = await this.commit.getCommitForFile(this.file)!;\n\n\t\t// if (fileCommit.previousSha === undefined) {\n\t\t// \tvoid (await findOrOpenEditor(\n\t\t// \t\tGitUri.toRevisionUri(fileCommit.sha, this.file, fileCommit.repoPath),\n\t\t// \t\toptions,\n\t\t// \t));\n\n\t\t// \treturn;\n\t\t// }\n\n\t\t// const commandArgs: DiffWithPreviousCommandArgs = {\n\t\t// \tcommit: fileCommit,\n\t\t// \tshowOptions: options,\n\t\t// };\n\t\t// void (await executeCommand(Commands.DiffWithPrevious, fileCommit.toGitUri(), commandArgs));\n\t}\n}\n\nexport class CommitBrowseRepositoryFromHereCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(\n\t\tprivate readonly commit: GitCommit,\n\t\tprivate readonly executeOptions?: {\n\t\t\tbefore?: boolean;\n\t\t\topenInNewWindow: boolean;\n\t\t},\n\t\titem?: QuickPickItem,\n\t) {\n\t\tsuper(\n\t\t\titem ??\n\t\t\t\t`$(folder-opened) Browse Repository from${executeOptions?.before ? ' Before' : ''} Here${\n\t\t\t\t\texecuteOptions?.openInNewWindow ? ' in New Window' : ''\n\t\t\t\t}`,\n\t\t);\n\t}\n\n\toverride execute(_options: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn GitActions.browseAtRevision(this.commit.getGitUri(), {\n\t\t\tbefore: this.executeOptions?.before,\n\t\t\topenInNewWindow: this.executeOptions?.openInNewWindow,\n\t\t});\n\t}\n}\n\nexport class CommitCompareWithHEADCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(compare-changes) Compare with HEAD');\n\t}\n\n\toverride execute(_options: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn Container.instance.searchAndCompareView.compare(this.commit.repoPath, this.commit.ref, 'HEAD');\n\t}\n}\n\nexport class CommitCompareWithWorkingCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(compare-changes) Compare with Working Tree');\n\t}\n\n\toverride execute(_options: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn Container.instance.searchAndCompareView.compare(this.commit.repoPath, this.commit.ref, '');\n\t}\n}\n\nexport class CommitCopyIdQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(copy) Copy SHA');\n\t}\n\n\toverride execute(): Promise<void> {\n\t\treturn GitActions.Commit.copyIdToClipboard(this.commit);\n\t}\n\n\toverride async onDidPressKey(key: Keys): Promise<void> {\n\t\tawait super.onDidPressKey(key);\n\t\tvoid window.showInformationMessage('Commit SHA copied to the clipboard');\n\t}\n}\n\nexport class CommitCopyMessageQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(copy) Copy Message');\n\t}\n\n\toverride execute(): Promise<void> {\n\t\treturn GitActions.Commit.copyMessageToClipboard(this.commit);\n\t}\n\n\toverride async onDidPressKey(key: Keys): Promise<void> {\n\t\tawait super.onDidPressKey(key);\n\t\tvoid window.showInformationMessage(\n\t\t\t`${this.commit.stashName ? 'Stash' : 'Commit'} Message copied to the clipboard`,\n\t\t);\n\t}\n}\n\nexport class CommitOpenAllChangesCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(git-compare) Open All Changes');\n\t}\n\n\toverride execute(options: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn GitActions.Commit.openAllChanges(this.commit, options);\n\t}\n}\n\nexport class CommitOpenAllChangesWithDiffToolCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(git-compare) Open All Changes (difftool)');\n\t}\n\n\toverride execute(): Promise<void> {\n\t\treturn GitActions.Commit.openAllChangesWithDiffTool(this.commit);\n\t}\n}\n\nexport class CommitOpenAllChangesWithWorkingCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(git-compare) Open All Changes with Working Tree');\n\t}\n\n\toverride execute(options: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn GitActions.Commit.openAllChangesWithWorking(this.commit, options);\n\t}\n}\n\nexport class CommitOpenChangesCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, private readonly file: string | GitFile, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(git-compare) Open Changes');\n\t}\n\n\toverride execute(options: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn GitActions.Commit.openChanges(this.file, this.commit, options);\n\t}\n}\n\nexport class CommitOpenChangesWithDiffToolCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, private readonly file: string | GitFile, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(git-compare) Open Changes (difftool)');\n\t}\n\n\toverride execute(): Promise<void> {\n\t\treturn GitActions.Commit.openChangesWithDiffTool(this.file, this.commit);\n\t}\n}\n\nexport class CommitOpenChangesWithWorkingCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, private readonly file: string | GitFile, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(git-compare) Open Changes with Working File');\n\t}\n\n\toverride execute(options: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn GitActions.Commit.openChangesWithWorking(this.file, this.commit, options);\n\t}\n}\n\nexport class CommitOpenDirectoryCompareCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(git-compare) Open Directory Compare');\n\t}\n\n\toverride execute(): Promise<void> {\n\t\treturn GitActions.Commit.openDirectoryCompareWithPrevious(this.commit);\n\t}\n}\n\nexport class CommitOpenDirectoryCompareWithWorkingCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(git-compare) Open Directory Compare with Working Tree');\n\t}\n\n\toverride execute(): Promise<void> {\n\t\treturn GitActions.Commit.openDirectoryCompareWithWorking(this.commit);\n\t}\n}\n\nexport class CommitOpenFilesCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(files) Open Files');\n\t}\n\n\toverride execute(_options: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn GitActions.Commit.openFiles(this.commit);\n\t}\n}\n\nexport class CommitOpenFileCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, private readonly file: string | GitFile, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(file) Open File');\n\t}\n\n\toverride execute(options?: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn GitActions.Commit.openFile(this.file, this.commit, options);\n\t}\n}\n\nexport class CommitOpenRevisionsCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(files) Open Files at Revision');\n\t}\n\n\toverride execute(_options: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn GitActions.Commit.openFilesAtRevision(this.commit);\n\t}\n}\n\nexport class CommitOpenRevisionCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, private readonly file: string | GitFile, item?: QuickPickItem) {\n\t\tsuper(item ?? '$(file) Open File at Revision');\n\t}\n\n\toverride execute(options?: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn GitActions.Commit.openFileAtRevision(this.file, this.commit, options);\n\t}\n}\n\nexport class CommitApplyFileChangesCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, private readonly file: string | GitFile, item?: QuickPickItem) {\n\t\tsuper(item ?? 'Apply Changes');\n\t}\n\n\toverride async execute(): Promise<void> {\n\t\treturn GitActions.Commit.applyChanges(this.file, this.commit);\n\t}\n}\n\nexport class CommitRestoreFileChangesCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(private readonly commit: GitCommit, private readonly file: string | GitFile, item?: QuickPickItem) {\n\t\tsuper(\n\t\t\titem ?? {\n\t\t\t\tlabel: 'Restore',\n\t\t\t\tdescription: 'aka checkout',\n\t\t\t},\n\t\t);\n\t}\n\n\toverride execute(): Promise<void> {\n\t\treturn GitActions.Commit.restoreFile(this.file, this.commit);\n\t}\n}\n\nexport class OpenChangedFilesCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(files: GitStatusFile[], item?: QuickPickItem) {\n\t\tconst commandArgs: OpenChangedFilesCommandArgs = {\n\t\t\turis: files.map(f => f.uri),\n\t\t};\n\n\t\tsuper(item ?? '$(files) Open All Changed Files', Commands.OpenChangedFiles, [commandArgs]);\n\t}\n}\n","import { commands, QuickPickItem, QuickPickItemKind } from 'vscode';\nimport { Commands } from '../../constants';\nimport { Keys } from '../../keyboard';\n\ndeclare module 'vscode' {\n\tinterface QuickPickItem {\n\t\tonDidSelect?(): void;\n\t\tonDidPressKey?(key: Keys): Promise<void>;\n\t}\n}\n\nexport interface QuickPickSeparator extends QuickPickItem {\n\tkind: QuickPickItemKind.Separator;\n}\n\nexport namespace QuickPickSeparator {\n\texport function create(label?: string): QuickPickSeparator {\n\t\treturn { kind: QuickPickItemKind.Separator, label: label ?? '' };\n\t}\n}\n\nexport interface QuickPickItemOfT<T = any> extends QuickPickItem {\n\treadonly item: T;\n}\n\nexport class CommandQuickPickItem<Arguments extends any[] = any[]> implements QuickPickItem {\n\tstatic fromCommand<T>(label: string, command: Commands, args?: T): CommandQuickPickItem;\n\tstatic fromCommand<T>(item: QuickPickItem, command: Commands, args?: T): CommandQuickPickItem;\n\tstatic fromCommand<T>(labelOrItem: string | QuickPickItem, command: Commands, args?: T): CommandQuickPickItem {\n\t\treturn new CommandQuickPickItem(\n\t\t\ttypeof labelOrItem === 'string' ? { label: labelOrItem } : labelOrItem,\n\t\t\tcommand,\n\t\t\targs == null ? [] : [args],\n\t\t);\n\t}\n\n\tstatic is(item: QuickPickItem): item is CommandQuickPickItem {\n\t\treturn item instanceof CommandQuickPickItem;\n\t}\n\n\tlabel!: string;\n\tdescription?: string;\n\tdetail?: string | undefined;\n\n\tconstructor(\n\t\tlabel: string,\n\t\tcommand?: Commands,\n\t\targs?: Arguments,\n\t\toptions?: {\n\t\t\tonDidPressKey?: (key: Keys, result: Thenable<unknown>) => void;\n\t\t\tsuppressKeyPress?: boolean;\n\t\t},\n\t);\n\tconstructor(\n\t\titem: QuickPickItem,\n\t\tcommand?: Commands,\n\t\targs?: Arguments,\n\t\toptions?: {\n\t\t\tonDidPressKey?: (key: Keys, result: Thenable<unknown>) => void;\n\t\t\tsuppressKeyPress?: boolean;\n\t\t},\n\t);\n\tconstructor(\n\t\tlabelOrItem: string | QuickPickItem,\n\t\tcommand?: Commands,\n\t\targs?: Arguments,\n\t\toptions?: {\n\t\t\tonDidPressKey?: (key: Keys, result: Thenable<unknown>) => void;\n\t\t\tsuppressKeyPress?: boolean;\n\t\t},\n\t);\n\tconstructor(\n\t\tlabelOrItem: string | QuickPickItem,\n\t\tprotected readonly command?: Commands,\n\t\tprotected readonly args?: Arguments,\n\t\tprotected readonly options?: {\n\t\t\t// onDidExecute?: (\n\t\t\t// \toptions: { preserveFocus?: boolean; preview?: boolean } | undefined,\n\t\t\t// \tresult: Thenable<unknown>,\n\t\t\t// ) => void;\n\t\t\tonDidPressKey?: (key: Keys, result: Thenable<unknown>) => void;\n\t\t\tsuppressKeyPress?: boolean;\n\t\t},\n\t) {\n\t\tthis.command = command;\n\t\tthis.args = args;\n\n\t\tif (typeof labelOrItem === 'string') {\n\t\t\tthis.label = labelOrItem;\n\t\t} else {\n\t\t\tObject.assign(this, labelOrItem);\n\t\t}\n\t}\n\n\texecute(_options?: { preserveFocus?: boolean; preview?: boolean }): Promise<unknown | undefined> {\n\t\tif (this.command === undefined) return Promise.resolve(undefined);\n\n\t\tconst result = commands.executeCommand(this.command, ...(this.args ?? [])) as Promise<unknown | undefined>;\n\t\t// this.options?.onDidExecute?.(options, result);\n\t\treturn result;\n\t}\n\n\tasync onDidPressKey(key: Keys): Promise<void> {\n\t\tif (this.options?.suppressKeyPress) return;\n\n\t\tconst result = this.execute({ preserveFocus: true, preview: false });\n\t\tthis.options?.onDidPressKey?.(key, result);\n\t\tvoid (await result);\n\t}\n}\n\nexport class ActionQuickPickItem extends CommandQuickPickItem {\n\tconstructor(\n\t\tlabelOrItem: string | QuickPickItem,\n\t\tprivate readonly action: (options?: { preserveFocus?: boolean; preview?: boolean }) => void | Promise<void>,\n\t) {\n\t\tsuper(labelOrItem, undefined, undefined);\n\t}\n\n\toverride async execute(options?: { preserveFocus?: boolean; preview?: boolean }): Promise<void> {\n\t\treturn this.action(options);\n\t}\n}\n","import { QuickPickItem } from 'vscode';\nimport type { Subscription } from '../../subscription';\n\nexport enum Directive {\n\tBack,\n\tCancel,\n\tLoadMore,\n\tNoop,\n\tRequiresVerification,\n\n\tRequiresFreeSubscription,\n\tRequiresPaidSubscription,\n\tStartPreviewTrial,\n}\n\nexport namespace Directive {\n\texport function is<T>(value: Directive | T): value is Directive {\n\t\treturn typeof value === 'number' && Directive[value] != null;\n\t}\n}\n\nexport interface DirectiveQuickPickItem extends QuickPickItem {\n\tdirective: Directive;\n}\n\nexport namespace DirectiveQuickPickItem {\n\texport function create(\n\t\tdirective: Directive,\n\t\tpicked?: boolean,\n\t\toptions?: { label?: string; description?: string; detail?: string; subscription?: Subscription },\n\t) {\n\t\tlet label = options?.label;\n\t\tlet detail = options?.detail;\n\t\tif (label == null) {\n\t\t\tswitch (directive) {\n\t\t\t\tcase Directive.Back:\n\t\t\t\t\tlabel = 'Back';\n\t\t\t\t\tbreak;\n\t\t\t\tcase Directive.Cancel:\n\t\t\t\t\tlabel = 'Cancel';\n\t\t\t\t\tbreak;\n\t\t\t\tcase Directive.LoadMore:\n\t\t\t\t\tlabel = 'Load more';\n\t\t\t\t\tbreak;\n\t\t\t\tcase Directive.Noop:\n\t\t\t\t\tlabel = 'Try again';\n\t\t\t\t\tbreak;\n\t\t\t\tcase Directive.StartPreviewTrial:\n\t\t\t\t\tlabel = 'Try Premium Features Now';\n\t\t\t\t\tdetail = 'Try premium features now, without an account, for 3 days';\n\t\t\t\t\tbreak;\n\t\t\t\tcase Directive.RequiresVerification:\n\t\t\t\t\tlabel = 'Resend Verification Email';\n\t\t\t\t\tdetail = 'You must verify your account email address before you can continue';\n\t\t\t\t\tbreak;\n\t\t\t\tcase Directive.RequiresFreeSubscription:\n\t\t\t\t\tlabel = 'Sign In';\n\t\t\t\t\tdetail =\n\t\t\t\t\t\t'To use premium features for public repos and get a free 7-day trial for both public and private repos';\n\t\t\t\t\tbreak;\n\t\t\t\tcase Directive.RequiresPaidSubscription:\n\t\t\t\t\tlabel = 'Purchase a Plan';\n\t\t\t\t\tdetail = 'To use premium features for both public and private repos';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconst item: DirectiveQuickPickItem = {\n\t\t\tlabel: label,\n\t\t\tdescription: options?.description,\n\t\t\tdetail: detail,\n\t\t\talwaysShow: true,\n\t\t\tpicked: picked,\n\t\t\tdirective: directive,\n\t\t};\n\n\t\treturn item;\n\t}\n\n\texport function is(item: QuickPickItem): item is DirectiveQuickPickItem {\n\t\treturn item != null && 'directive' in item;\n\t}\n}\n","import { QuickInputButton, QuickPickItem } from 'vscode';\nimport type { GitCommandsCommandArgs } from '../../commands/gitCommands';\nimport { getSteps } from '../../commands/gitCommands.utils';\nimport { Commands, GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { emojify } from '../../emojis';\nimport {\n\tGitBranch,\n\tGitCommit,\n\tGitContributor,\n\tGitReference,\n\tGitRemoteType,\n\tGitRevision,\n\tGitStatus,\n\tGitTag,\n\tGitWorktree,\n\tRepository,\n} from '../../git/models';\nimport { fromNow } from '../../system/date';\nimport { pad } from '../../system/string';\nimport { CommandQuickPickItem, QuickPickItemOfT } from './common';\n\nexport class GitCommandQuickPickItem extends CommandQuickPickItem<[GitCommandsCommandArgs]> {\n\tconstructor(label: string, args: GitCommandsCommandArgs);\n\tconstructor(item: QuickPickItem, args: GitCommandsCommandArgs);\n\tconstructor(labelOrItem: string | QuickPickItem, args: GitCommandsCommandArgs) {\n\t\tsuper(labelOrItem, Commands.GitCommands, [args], { suppressKeyPress: true });\n\t}\n\n\texecuteSteps(pickedVia: 'menu' | 'command') {\n\t\treturn getSteps(Container.instance, this.args![0], pickedVia);\n\t}\n}\n\nexport interface BranchQuickPickItem extends QuickPickItemOfT<GitBranch> {\n\treadonly current: boolean;\n\treadonly ref: string;\n\treadonly remote: boolean;\n}\n\nexport namespace BranchQuickPickItem {\n\texport async function create(\n\t\tbranch: GitBranch,\n\t\tpicked?: boolean,\n\t\toptions?: {\n\t\t\talwaysShow?: boolean;\n\t\t\tbuttons?: QuickInputButton[];\n\t\t\tchecked?: boolean;\n\t\t\tcurrent?: boolean | 'checkmark';\n\t\t\tref?: boolean;\n\t\t\tstatus?: boolean;\n\t\t\ttype?: boolean | 'remote';\n\t\t},\n\t): Promise<BranchQuickPickItem> {\n\t\tlet description = '';\n\t\tif (options?.type === true) {\n\t\t\tif (options.current === true && branch.current) {\n\t\t\t\tdescription = 'current branch';\n\t\t\t} else {\n\t\t\t\tdescription = 'branch';\n\t\t\t}\n\t\t} else if (options?.type === 'remote') {\n\t\t\tif (branch.remote) {\n\t\t\t\tdescription = 'remote branch';\n\t\t\t}\n\t\t} else if (options?.current === true && branch.current) {\n\t\t\tdescription = 'current branch';\n\t\t}\n\n\t\tif (options?.status && !branch.remote && branch.upstream != null) {\n\t\t\tlet arrows = GlyphChars.Dash;\n\n\t\t\tif (!branch.upstream.missing) {\n\t\t\t\tconst remote = await branch.getRemote();\n\t\t\t\tif (remote != null) {\n\t\t\t\t\tlet left;\n\t\t\t\t\tlet right;\n\t\t\t\t\tfor (const { type } of remote.urls) {\n\t\t\t\t\t\tif (type === GitRemoteType.Fetch) {\n\t\t\t\t\t\t\tleft = true;\n\n\t\t\t\t\t\t\tif (right) break;\n\t\t\t\t\t\t} else if (type === GitRemoteType.Push) {\n\t\t\t\t\t\t\tright = true;\n\n\t\t\t\t\t\t\tif (left) break;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (left && right) {\n\t\t\t\t\t\tarrows = GlyphChars.ArrowsRightLeft;\n\t\t\t\t\t} else if (right) {\n\t\t\t\t\t\tarrows = GlyphChars.ArrowRight;\n\t\t\t\t\t} else if (left) {\n\t\t\t\t\t\tarrows = GlyphChars.ArrowLeft;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tarrows = GlyphChars.Warning;\n\t\t\t}\n\n\t\t\tconst status = `${branch.getTrackingStatus({ suffix: `${GlyphChars.Space} ` })}${arrows}${\n\t\t\t\tGlyphChars.Space\n\t\t\t} ${branch.upstream.name}`;\n\t\t\tdescription = `${description ? `${description}${GlyphChars.Space.repeat(2)}${status}` : status}`;\n\t\t}\n\n\t\tif (options?.ref) {\n\t\t\tif (branch.sha) {\n\t\t\t\tdescription = description\n\t\t\t\t\t? `${description} $(git-commit)${GlyphChars.Space}${GitRevision.shorten(branch.sha)}`\n\t\t\t\t\t: `$(git-commit)${GlyphChars.Space}${GitRevision.shorten(branch.sha)}`;\n\t\t\t}\n\n\t\t\tif (branch.date !== undefined) {\n\t\t\t\tdescription = description\n\t\t\t\t\t? `${description}${pad(GlyphChars.Dot, 2, 2)}${branch.formattedDate}`\n\t\t\t\t\t: branch.formattedDate;\n\t\t\t}\n\t\t}\n\n\t\tconst checked =\n\t\t\toptions?.checked || (options?.checked == null && options?.current === 'checkmark' && branch.current);\n\t\tconst item: BranchQuickPickItem = {\n\t\t\tlabel: `$(git-branch)${GlyphChars.Space}${branch.starred ? `$(star-full)${GlyphChars.Space}` : ''}${\n\t\t\t\tbranch.name\n\t\t\t}${checked ? pad('$(check)', 2) : ''}`,\n\t\t\tdescription: description,\n\t\t\talwaysShow: options?.alwaysShow,\n\t\t\tbuttons: options?.buttons,\n\t\t\tpicked: picked ?? branch.current,\n\t\t\titem: branch,\n\t\t\tcurrent: branch.current,\n\t\t\tref: branch.name,\n\t\t\tremote: branch.remote,\n\t\t};\n\n\t\treturn item;\n\t}\n}\n\nexport class CommitLoadMoreQuickPickItem implements QuickPickItem {\n\treadonly label = 'Load more';\n\treadonly alwaysShow = true;\n}\n\nexport type CommitQuickPickItem<T extends GitCommit = GitCommit> = QuickPickItemOfT<T>;\n\nexport namespace CommitQuickPickItem {\n\texport function create<T extends GitCommit = GitCommit>(\n\t\tcommit: T,\n\t\tpicked?: boolean,\n\t\toptions?: { alwaysShow?: boolean; buttons?: QuickInputButton[]; compact?: boolean; icon?: boolean },\n\t) {\n\t\tif (GitCommit.isStash(commit)) {\n\t\t\tconst number = commit.number == null ? '' : `${commit.number}: `;\n\n\t\t\tif (options?.compact) {\n\t\t\t\tconst item: CommitQuickPickItem<T> = {\n\t\t\t\t\tlabel: `${options.icon ? `$(archive)${GlyphChars.Space}` : ''}${number}${commit.summary}`,\n\t\t\t\t\tdescription: `${commit.formattedDate}${pad(GlyphChars.Dot, 2, 2)}${commit.formatStats({\n\t\t\t\t\t\tcompact: true,\n\t\t\t\t\t})}`,\n\t\t\t\t\talwaysShow: options.alwaysShow,\n\t\t\t\t\tbuttons: options.buttons,\n\t\t\t\t\tpicked: picked,\n\t\t\t\t\titem: commit,\n\t\t\t\t};\n\n\t\t\t\treturn item;\n\t\t\t}\n\n\t\t\tconst item: CommitQuickPickItem<T> = {\n\t\t\t\tlabel: `${options?.icon ? `$(archive)${GlyphChars.Space}` : ''}${number}${commit.summary}`,\n\t\t\t\tdescription: '',\n\t\t\t\tdetail: `${GlyphChars.Space.repeat(2)}${commit.formattedDate}${pad(\n\t\t\t\t\tGlyphChars.Dot,\n\t\t\t\t\t2,\n\t\t\t\t\t2,\n\t\t\t\t)}${commit.formatStats({ compact: true })}`,\n\t\t\t\talwaysShow: options?.alwaysShow,\n\t\t\t\tbuttons: options?.buttons,\n\t\t\t\tpicked: picked,\n\t\t\t\titem: commit,\n\t\t\t};\n\n\t\t\treturn item;\n\t\t}\n\n\t\tif (options?.compact) {\n\t\t\tconst item: CommitQuickPickItem<T> = {\n\t\t\t\tlabel: `${options.icon ? `$(git-commit)${GlyphChars.Space}` : ''}${commit.summary}`,\n\t\t\t\tdescription: `${commit.author.name}, ${commit.formattedDate}${pad('$(git-commit)', 2, 1)}${\n\t\t\t\t\tcommit.shortSha\n\t\t\t\t}${pad(GlyphChars.Dot, 2, 2)}${commit.formatStats({ compact: true })}`,\n\t\t\t\talwaysShow: options.alwaysShow,\n\t\t\t\tbuttons: options.buttons,\n\t\t\t\tpicked: picked,\n\t\t\t\titem: commit,\n\t\t\t};\n\t\t\treturn item;\n\t\t}\n\n\t\tconst item: CommitQuickPickItem<T> = {\n\t\t\tlabel: `${options?.icon ? `$(git-commit)${GlyphChars.Space}` : ''}${commit.summary}`,\n\t\t\tdescription: '',\n\t\t\tdetail: `${GlyphChars.Space.repeat(2)}${commit.author.name}, ${commit.formattedDate}${pad(\n\t\t\t\t'$(git-commit)',\n\t\t\t\t2,\n\t\t\t\t1,\n\t\t\t)}${commit.shortSha}${pad(GlyphChars.Dot, 2, 2)}${commit.formatStats({\n\t\t\t\tcompact: true,\n\t\t\t})}`,\n\t\t\talwaysShow: options?.alwaysShow,\n\t\t\tbuttons: options?.buttons,\n\t\t\tpicked: picked,\n\t\t\titem: commit,\n\t\t};\n\t\treturn item;\n\t}\n}\n\nexport type ContributorQuickPickItem = QuickPickItemOfT<GitContributor>;\n\nexport namespace ContributorQuickPickItem {\n\texport function create(\n\t\tcontributor: GitContributor,\n\t\tpicked?: boolean,\n\t\toptions?: { alwaysShow?: boolean; buttons?: QuickInputButton[] },\n\t): ContributorQuickPickItem {\n\t\tconst item: ContributorQuickPickItem = {\n\t\t\tlabel: contributor.label,\n\t\t\tdescription: contributor.email,\n\t\t\talwaysShow: options?.alwaysShow,\n\t\t\tbuttons: options?.buttons,\n\t\t\tpicked: picked,\n\t\t\titem: contributor,\n\t\t};\n\t\treturn item;\n\t}\n}\n\nexport interface RefQuickPickItem extends QuickPickItemOfT<GitReference> {\n\treadonly current: boolean;\n\treadonly ref: string;\n\treadonly remote: boolean;\n}\n\nexport namespace RefQuickPickItem {\n\texport function create(\n\t\tref: string | GitReference,\n\t\trepoPath: string,\n\t\tpicked?: boolean,\n\t\toptions?: { alwaysShow?: boolean; buttons?: QuickInputButton[]; icon?: boolean; ref?: boolean },\n\t): RefQuickPickItem {\n\t\tif (ref === '') {\n\t\t\treturn {\n\t\t\t\tlabel: `${options?.icon ? `$(file-directory)${GlyphChars.Space}` : ''}Working Tree`,\n\t\t\t\tdescription: '',\n\t\t\t\talwaysShow: options?.alwaysShow,\n\t\t\t\tbuttons: options?.buttons,\n\t\t\t\tpicked: picked,\n\t\t\t\titem: GitReference.create(ref, repoPath, { refType: 'revision', name: 'Working Tree' }),\n\t\t\t\tcurrent: false,\n\t\t\t\tref: ref,\n\t\t\t\tremote: false,\n\t\t\t};\n\t\t}\n\n\t\tif (ref === 'HEAD') {\n\t\t\treturn {\n\t\t\t\tlabel: `${options?.icon ? `$(git-branch)${GlyphChars.Space}` : ''}HEAD`,\n\t\t\t\tdescription: '',\n\t\t\t\talwaysShow: options?.alwaysShow,\n\t\t\t\tbuttons: options?.buttons,\n\t\t\t\tpicked: picked,\n\t\t\t\titem: GitReference.create(ref, repoPath, { refType: 'revision', name: 'HEAD' }),\n\t\t\t\tcurrent: false,\n\t\t\t\tref: ref,\n\t\t\t\tremote: false,\n\t\t\t};\n\t\t}\n\n\t\tlet gitRef;\n\t\tif (typeof ref === 'string') {\n\t\t\tgitRef = GitReference.create(ref, repoPath);\n\t\t} else {\n\t\t\tgitRef = ref;\n\t\t\tref = gitRef.ref;\n\t\t}\n\n\t\tif (GitRevision.isRange(ref)) {\n\t\t\treturn {\n\t\t\t\tlabel: `Range ${gitRef.name}`,\n\t\t\t\tdescription: '',\n\t\t\t\talwaysShow: options?.alwaysShow,\n\t\t\t\tbuttons: options?.buttons,\n\t\t\t\tpicked: picked,\n\t\t\t\titem: gitRef,\n\t\t\t\tcurrent: false,\n\t\t\t\tref: ref,\n\t\t\t\tremote: false,\n\t\t\t};\n\t\t}\n\n\t\tconst item: RefQuickPickItem = {\n\t\t\tlabel: `Commit ${gitRef.name}`,\n\t\t\tdescription: options?.ref ? `$(git-commit)${GlyphChars.Space}${ref}` : '',\n\t\t\talwaysShow: options?.alwaysShow,\n\t\t\tbuttons: options?.buttons,\n\t\t\tpicked: picked,\n\t\t\titem: gitRef,\n\t\t\tcurrent: false,\n\t\t\tref: ref,\n\t\t\tremote: false,\n\t\t};\n\n\t\treturn item;\n\t}\n}\n\nexport interface RepositoryQuickPickItem extends QuickPickItemOfT<Repository> {\n\treadonly repoPath: string;\n}\n\nexport namespace RepositoryQuickPickItem {\n\texport async function create(\n\t\trepository: Repository,\n\t\tpicked?: boolean,\n\t\toptions?: {\n\t\t\talwaysShow?: boolean;\n\t\t\tbranch?: boolean;\n\t\t\tbuttons?: QuickInputButton[];\n\t\t\tfetched?: boolean;\n\t\t\tstatus?: boolean;\n\t\t},\n\t) {\n\t\tlet repoStatus;\n\t\tif (options?.branch || options?.status) {\n\t\t\trepoStatus = await repository.getStatus();\n\t\t}\n\n\t\tlet description = '';\n\t\tif (options?.branch && repoStatus != null) {\n\t\t\tdescription = repoStatus.branch;\n\t\t}\n\n\t\tif (options?.status && repoStatus != null) {\n\t\t\tlet workingStatus = '';\n\t\t\tif (repoStatus.files.length !== 0) {\n\t\t\t\tworkingStatus = repoStatus.getFormattedDiffStatus({\n\t\t\t\t\tcompact: true,\n\t\t\t\t\tprefix: pad(GlyphChars.Dot, 2, 2),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst upstreamStatus = repoStatus.getUpstreamStatus({\n\t\t\t\tprefix: description ? `${GlyphChars.Space} ` : '',\n\t\t\t});\n\n\t\t\tconst status = `${upstreamStatus}${workingStatus}`;\n\t\t\tif (status) {\n\t\t\t\tdescription = `${description ? `${description}${status}` : status}`;\n\t\t\t}\n\t\t}\n\n\t\tif (options?.fetched) {\n\t\t\tconst lastFetched = await repository.getLastFetched();\n\t\t\tif (lastFetched !== 0) {\n\t\t\t\tconst fetched = `Last fetched ${fromNow(new Date(lastFetched))}`;\n\t\t\t\tdescription = `${description ? `${description}${pad(GlyphChars.Dot, 2, 2)}${fetched}` : fetched}`;\n\t\t\t}\n\t\t}\n\n\t\tconst item: RepositoryQuickPickItem = {\n\t\t\tlabel: repository.formattedName,\n\t\t\tdescription: description,\n\t\t\talwaysShow: options?.alwaysShow,\n\t\t\tbuttons: options?.buttons,\n\t\t\tpicked: picked,\n\t\t\titem: repository,\n\t\t\trepoPath: repository.path,\n\t\t};\n\n\t\treturn item;\n\t}\n}\n\nexport interface TagQuickPickItem extends QuickPickItemOfT<GitTag> {\n\treadonly current: boolean;\n\treadonly ref: string;\n\treadonly remote: boolean;\n}\n\nexport namespace TagQuickPickItem {\n\texport function create(\n\t\ttag: GitTag,\n\t\tpicked?: boolean,\n\t\toptions?: {\n\t\t\talwaysShow?: boolean;\n\t\t\tbuttons?: QuickInputButton[];\n\t\t\tchecked?: boolean;\n\t\t\tmessage?: boolean;\n\t\t\tref?: boolean;\n\t\t\ttype?: boolean;\n\t\t},\n\t) {\n\t\tlet description = '';\n\t\tif (options?.type) {\n\t\t\tdescription = 'tag';\n\t\t}\n\n\t\tif (options?.ref) {\n\t\t\tdescription = `${description}${pad('$(git-commit)', description ? 2 : 0, 1)}${GitRevision.shorten(\n\t\t\t\ttag.sha,\n\t\t\t)}`;\n\n\t\t\tdescription = `${description ? `${description}${pad(GlyphChars.Dot, 2, 2)}` : ''}${tag.formattedDate}`;\n\t\t}\n\n\t\tif (options?.message) {\n\t\t\tconst message = emojify(tag.message);\n\t\t\tdescription = description ? `${description}${pad(GlyphChars.Dot, 2, 2)}${message}` : message;\n\t\t}\n\n\t\tconst item: TagQuickPickItem = {\n\t\t\tlabel: `$(tag)${GlyphChars.Space}${tag.name}${options?.checked ? pad('$(check)', 2) : ''}`,\n\t\t\tdescription: description,\n\t\t\talwaysShow: options?.alwaysShow,\n\t\t\tbuttons: options?.buttons,\n\t\t\tpicked: picked,\n\t\t\titem: tag,\n\t\t\tcurrent: false,\n\t\t\tref: tag.name,\n\t\t\tremote: false,\n\t\t};\n\n\t\treturn item;\n\t}\n}\n\nexport interface WorktreeQuickPickItem extends QuickPickItemOfT<GitWorktree> {\n\treadonly opened: boolean;\n\treadonly hasChanges: boolean | undefined;\n}\n\nexport namespace WorktreeQuickPickItem {\n\texport function create(\n\t\tworktree: GitWorktree,\n\t\tpicked?: boolean,\n\t\toptions?: {\n\t\t\talwaysShow?: boolean;\n\t\t\tbuttons?: QuickInputButton[];\n\t\t\tchecked?: boolean;\n\t\t\tmessage?: boolean;\n\t\t\tpath?: boolean;\n\t\t\ttype?: boolean;\n\t\t\tstatus?: GitStatus;\n\t\t},\n\t) {\n\t\tlet description = '';\n\t\tif (options?.type) {\n\t\t\tdescription = 'worktree';\n\t\t}\n\n\t\tif (options?.status != null) {\n\t\t\tdescription += options.status.hasChanges\n\t\t\t\t? pad(`Uncommited changes (${options.status.getFormattedDiffStatus()})`, description ? 2 : 0, 0)\n\t\t\t\t: pad('No changes', description ? 2 : 0, 0);\n\t\t}\n\n\t\tlet icon;\n\t\tlet label;\n\t\tswitch (worktree.type) {\n\t\t\tcase 'bare':\n\t\t\t\tlabel = '(bare)';\n\t\t\t\ticon = '$(folder)';\n\t\t\t\tbreak;\n\t\t\tcase 'branch':\n\t\t\t\tlabel = worktree.branch!;\n\t\t\t\ticon = '$(git-branch)';\n\t\t\t\tbreak;\n\t\t\tcase 'detached':\n\t\t\t\tlabel = GitRevision.shorten(worktree.sha);\n\t\t\t\ticon = '$(git-commit)';\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconst item: WorktreeQuickPickItem = {\n\t\t\tlabel: `${icon}${GlyphChars.Space}${label}${options?.checked ? pad('$(check)', 2) : ''}`,\n\t\t\tdescription: description,\n\t\t\tdetail: options?.path ? `In $(folder) ${worktree.friendlyPath}` : undefined,\n\t\t\talwaysShow: options?.alwaysShow,\n\t\t\tbuttons: options?.buttons,\n\t\t\tpicked: picked,\n\t\t\titem: worktree,\n\t\t\topened: worktree.opened,\n\t\t\thasChanges: options?.status?.hasChanges,\n\t\t};\n\n\t\treturn item;\n\t}\n}\n","import { CancellationTokenSource, Disposable, QuickPick, window } from 'vscode';\nimport { GitActions } from '../commands/gitCommands.actions';\nimport { getBranchesAndOrTags, getValidateGitReferenceFn, QuickCommandButtons } from '../commands/quickCommand';\nimport { GlyphChars } from '../constants';\nimport { Container } from '../container';\nimport { BranchSortOptions, GitBranch, GitReference, GitTag, TagSortOptions } from '../git/models';\nimport { KeyboardScope, Keys } from '../keyboard';\nimport { getQuickPickIgnoreFocusOut } from '../system/utils';\nimport { BranchQuickPickItem, RefQuickPickItem, TagQuickPickItem } from './items/gitCommands';\n\nexport type ReferencesQuickPickItem = BranchQuickPickItem | TagQuickPickItem | RefQuickPickItem;\n\nexport const enum ReferencesQuickPickIncludes {\n\tBranches = 1 << 0,\n\tTags = 1 << 1,\n\tWorkingTree = 1 << 2,\n\tHEAD = 1 << 3,\n\n\tBranchesAndTags = Branches | Tags,\n}\n\nexport interface ReferencesQuickPickOptions {\n\tallowEnteringRefs?: boolean | { ranges?: boolean };\n\tautoPick?: boolean;\n\tpicked?: string;\n\tfilter?: { branches?(b: GitBranch): boolean; tags?(t: GitTag): boolean };\n\tinclude?: ReferencesQuickPickIncludes;\n\tkeys?: Keys[];\n\tonDidPressKey?(key: Keys, quickpick: QuickPick<ReferencesQuickPickItem>): void | Promise<void>;\n\tsort?: boolean | { branches?: BranchSortOptions; tags?: TagSortOptions };\n}\n\nexport namespace ReferencePicker {\n\texport async function show(\n\t\trepoPath: string,\n\t\ttitle: string,\n\t\tplaceHolder: string,\n\t\toptions: ReferencesQuickPickOptions = {},\n\t): Promise<GitReference | undefined> {\n\t\tconst quickpick = window.createQuickPick<ReferencesQuickPickItem>();\n\t\tquickpick.ignoreFocusOut = getQuickPickIgnoreFocusOut();\n\n\t\tquickpick.title = title;\n\t\tquickpick.placeholder =\n\t\t\toptions.allowEnteringRefs != null\n\t\t\t\t? `${placeHolder}${GlyphChars.Space.repeat(3)}(or enter a reference using #)`\n\t\t\t\t: placeHolder;\n\t\tquickpick.matchOnDescription = true;\n\n\t\tconst disposables: Disposable[] = [];\n\n\t\tlet scope: KeyboardScope | undefined;\n\t\tif (options?.keys != null && options.keys.length !== 0 && options?.onDidPressKey !== null) {\n\t\t\tscope = Container.instance.keyboard.createScope(\n\t\t\t\tObject.fromEntries(\n\t\t\t\t\toptions.keys.map(key => [\n\t\t\t\t\t\tkey,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonDidPressKey: key => {\n\t\t\t\t\t\t\t\tif (quickpick.activeItems.length !== 0) {\n\t\t\t\t\t\t\t\t\tvoid options.onDidPressKey!(key, quickpick);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t]),\n\t\t\t\t),\n\t\t\t);\n\t\t\tvoid scope.start();\n\t\t\tdisposables.push(scope);\n\t\t}\n\n\t\tconst cancellation = new CancellationTokenSource();\n\n\t\tlet autoPick;\n\t\tlet items = getItems(repoPath, options);\n\t\tif (options.autoPick) {\n\t\t\titems = items.then(itms => {\n\t\t\t\tif (itms.length <= 1) {\n\t\t\t\t\tautoPick = itms[0];\n\t\t\t\t\tcancellation.cancel();\n\t\t\t\t}\n\t\t\t\treturn itms;\n\t\t\t});\n\t\t}\n\n\t\tquickpick.busy = true;\n\t\tquickpick.enabled = false;\n\n\t\tquickpick.show();\n\n\t\tconst getValidateGitReference = getValidateGitReferenceFn(Container.instance.git.getRepository(repoPath), {\n\t\t\tbuttons: [QuickCommandButtons.RevealInSideBar],\n\t\t\tranges:\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\t\t\toptions?.allowEnteringRefs && typeof options.allowEnteringRefs !== 'boolean'\n\t\t\t\t\t? options.allowEnteringRefs.ranges\n\t\t\t\t\t: undefined,\n\t\t});\n\n\t\tquickpick.items = await items;\n\n\t\tquickpick.busy = false;\n\t\tquickpick.enabled = true;\n\n\t\ttry {\n\t\t\tlet pick = await new Promise<ReferencesQuickPickItem | undefined>(resolve => {\n\t\t\t\tdisposables.push(\n\t\t\t\t\tcancellation.token.onCancellationRequested(() => quickpick.hide()),\n\t\t\t\t\tquickpick.onDidHide(() => resolve(undefined)),\n\t\t\t\t\tquickpick.onDidAccept(() => {\n\t\t\t\t\t\tif (quickpick.activeItems.length === 0) return;\n\n\t\t\t\t\t\tresolve(quickpick.activeItems[0]);\n\t\t\t\t\t}),\n\t\t\t\t\tquickpick.onDidChangeValue(async e => {\n\t\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\t\t\t\t\tif (options.allowEnteringRefs) {\n\t\t\t\t\t\t\tif (!(await getValidateGitReference(quickpick, e))) {\n\t\t\t\t\t\t\t\tquickpick.items = await items;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (scope == null) return;\n\n\t\t\t\t\t\t// Pause the left/right keyboard commands if there is a value, otherwise the left/right arrows won't work in the input properly\n\t\t\t\t\t\tif (e.length !== 0) {\n\t\t\t\t\t\t\tawait scope.pause(['left', 'right']);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tawait scope.resume();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tquickpick.onDidTriggerItemButton(({ button, item: { item } }) => {\n\t\t\t\t\t\tif (button === QuickCommandButtons.RevealInSideBar) {\n\t\t\t\t\t\t\tif (GitReference.isBranch(item)) {\n\t\t\t\t\t\t\t\tvoid GitActions.Branch.reveal(item, { select: true, expand: true });\n\t\t\t\t\t\t\t} else if (GitReference.isTag(item)) {\n\t\t\t\t\t\t\t\tvoid GitActions.Tag.reveal(item, { select: true, expand: true });\n\t\t\t\t\t\t\t} else if (GitReference.isRevision(item)) {\n\t\t\t\t\t\t\t\tvoid GitActions.Commit.reveal(item, { select: true, expand: true });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t});\n\t\t\tif (pick == null && autoPick != null) {\n\t\t\t\tpick = autoPick;\n\t\t\t}\n\t\t\tif (pick == null) return undefined;\n\n\t\t\treturn pick.item;\n\t\t} finally {\n\t\t\tquickpick.dispose();\n\t\t\tdisposables.forEach(d => d.dispose());\n\t\t}\n\t}\n\n\tasync function getItems(\n\t\trepoPath: string,\n\t\t{ picked, filter, include, sort }: ReferencesQuickPickOptions,\n\t): Promise<ReferencesQuickPickItem[]> {\n\t\tinclude = include ?? ReferencesQuickPickIncludes.BranchesAndTags;\n\n\t\tconst items: ReferencesQuickPickItem[] = await getBranchesAndOrTags(\n\t\t\tContainer.instance.git.getRepository(repoPath),\n\t\t\tinclude && ReferencesQuickPickIncludes.BranchesAndTags\n\t\t\t\t? ['branches', 'tags']\n\t\t\t\t: include && ReferencesQuickPickIncludes.Branches\n\t\t\t\t? ['branches']\n\t\t\t\t: include && ReferencesQuickPickIncludes.Tags\n\t\t\t\t? ['tags']\n\t\t\t\t: [],\n\t\t\t{\n\t\t\t\tbuttons: [QuickCommandButtons.RevealInSideBar],\n\t\t\t\tfilter: filter,\n\t\t\t\tpicked: picked,\n\t\t\t\tsort: sort ?? { branches: { current: false }, tags: {} },\n\t\t\t},\n\t\t);\n\n\t\t// Move the picked item to the top\n\t\tif (picked) {\n\t\t\tconst index = items.findIndex(i => i.ref === picked);\n\t\t\tif (index !== -1) {\n\t\t\t\titems.splice(0, 0, ...items.splice(index, 1));\n\t\t\t}\n\t\t}\n\n\t\tif (include & ReferencesQuickPickIncludes.HEAD) {\n\t\t\titems.splice(0, 0, RefQuickPickItem.create('HEAD', repoPath, undefined, { icon: true }));\n\t\t}\n\n\t\tif (include & ReferencesQuickPickIncludes.WorkingTree) {\n\t\t\titems.splice(0, 0, RefQuickPickItem.create('', repoPath, undefined, { icon: true }));\n\t\t}\n\n\t\treturn items;\n\t}\n}\n","import { Disposable, env, QuickInputButton, ThemeIcon, Uri, window } from 'vscode';\nimport type { OpenOnRemoteCommandArgs } from '../commands';\nimport { Commands, GlyphChars } from '../constants';\nimport { Container } from '../container';\nimport { GitBranch, GitRemote } from '../git/models';\nimport { getNameFromRemoteResource, RemoteProvider, RemoteResource, RemoteResourceType } from '../git/remotes/provider';\nimport { Keys } from '../keyboard';\nimport { CommandQuickPickItem } from '../quickpicks/items/common';\nimport { getQuickPickIgnoreFocusOut } from '../system/utils';\n\nexport class ConfigureCustomRemoteProviderCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor() {\n\t\tsuper({ label: 'See how to configure a custom remote provider...' });\n\t}\n\n\toverride async execute(): Promise<void> {\n\t\tawait env.openExternal(\n\t\t\tUri.parse('https://github.com/eamodio/vscode-gitlens#remote-provider-integration-settings-'),\n\t\t);\n\t}\n}\n\nexport class CopyOrOpenRemoteCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(\n\t\tprivate readonly remote: GitRemote<RemoteProvider>,\n\t\tprivate readonly resource: RemoteResource,\n\t\tprivate readonly clipboard?: boolean,\n\t\tbuttons?: QuickInputButton[],\n\t) {\n\t\tsuper({\n\t\t\tlabel: `$(repo) ${remote.provider.path}`,\n\t\t\tdescription: remote.name,\n\t\t\tbuttons: buttons,\n\t\t});\n\t}\n\n\toverride async execute(): Promise<void> {\n\t\tlet resource = this.resource;\n\t\tif (resource.type === RemoteResourceType.Comparison) {\n\t\t\tif (GitBranch.getRemote(resource.base) === this.remote.name) {\n\t\t\t\tresource = { ...resource, base: GitBranch.getNameWithoutRemote(resource.base) };\n\t\t\t}\n\n\t\t\tif (GitBranch.getRemote(resource.compare) === this.remote.name) {\n\t\t\t\tresource = { ...resource, compare: GitBranch.getNameWithoutRemote(resource.compare) };\n\t\t\t}\n\t\t} else if (resource.type === RemoteResourceType.CreatePullRequest) {\n\t\t\tlet branch = resource.base.branch;\n\t\t\tif (branch == null) {\n\t\t\t\tbranch = await Container.instance.git.getDefaultBranchName(this.remote.repoPath, this.remote.name);\n\t\t\t\tif (branch == null && this.remote.hasRichProvider()) {\n\t\t\t\t\tconst defaultBranch = await this.remote.provider.getDefaultBranch?.();\n\t\t\t\t\tbranch = defaultBranch?.name;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresource = {\n\t\t\t\t...resource,\n\t\t\t\tbase: { branch: branch, remote: { path: this.remote.path, url: this.remote.url } },\n\t\t\t};\n\t\t} else if (\n\t\t\tresource.type === RemoteResourceType.File &&\n\t\t\tresource.branchOrTag != null &&\n\t\t\t(this.remote.provider.id === 'bitbucket' || this.remote.provider.id === 'bitbucket-server')\n\t\t) {\n\t\t\t// HACK ALERT\n\t\t\t// Since Bitbucket can't support branch names in the url (other than with the default branch),\n\t\t\t// turn this into a `Revision` request\n\t\t\tconst { branchOrTag } = resource;\n\t\t\tconst [branches, tags] = await Promise.allSettled([\n\t\t\t\tContainer.instance.git.getBranches(this.remote.repoPath, {\n\t\t\t\t\tfilter: b => b.name === branchOrTag || b.getNameWithoutRemote() === branchOrTag,\n\t\t\t\t}),\n\t\t\t\tContainer.instance.git.getTags(this.remote.repoPath, { filter: t => t.name === branchOrTag }),\n\t\t\t]);\n\n\t\t\tconst sha =\n\t\t\t\t(branches.status === 'fulfilled' ? branches.value.values[0]?.sha : undefined) ??\n\t\t\t\t(tags.status === 'fulfilled' ? tags.value.values[0]?.sha : undefined);\n\t\t\tif (sha) {\n\t\t\t\tresource = { ...resource, type: RemoteResourceType.Revision, sha: sha };\n\t\t\t}\n\t\t}\n\n\t\tvoid (await (this.clipboard ? this.remote.provider.copy(resource) : this.remote.provider.open(resource)));\n\t}\n\n\tsetAsDefault(): Promise<void> {\n\t\treturn this.remote.setAsDefault(true);\n\t}\n}\n\nexport class CopyRemoteResourceCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(remotes: GitRemote<RemoteProvider>[], resource: RemoteResource) {\n\t\tconst providers = GitRemote.getHighlanderProviders(remotes);\n\t\tconst commandArgs: OpenOnRemoteCommandArgs = {\n\t\t\tresource: resource,\n\t\t\tremotes: remotes,\n\t\t\tclipboard: true,\n\t\t};\n\t\tsuper(\n\t\t\t`$(copy) Copy ${providers?.length ? providers[0].name : 'Remote'} ${getNameFromRemoteResource(\n\t\t\t\tresource,\n\t\t\t)} Url${providers?.length === 1 ? '' : GlyphChars.Ellipsis}`,\n\t\t\tCommands.OpenOnRemote,\n\t\t\t[commandArgs],\n\t\t);\n\t}\n\n\toverride async onDidPressKey(key: Keys): Promise<void> {\n\t\tawait super.onDidPressKey(key);\n\t\tvoid window.showInformationMessage('Url copied to the clipboard');\n\t}\n}\n\nexport class OpenRemoteResourceCommandQuickPickItem extends CommandQuickPickItem {\n\tconstructor(remotes: GitRemote<RemoteProvider>[], resource: RemoteResource) {\n\t\tconst providers = GitRemote.getHighlanderProviders(remotes);\n\t\tconst commandArgs: OpenOnRemoteCommandArgs = {\n\t\t\tresource: resource,\n\t\t\tremotes: remotes,\n\t\t\tclipboard: false,\n\t\t};\n\t\tsuper(\n\t\t\t`$(link-external) Open ${getNameFromRemoteResource(resource)} on ${\n\t\t\t\tproviders?.length === 1\n\t\t\t\t\t? providers[0].name\n\t\t\t\t\t: `${providers?.length ? providers[0].name : 'Remote'}${GlyphChars.Ellipsis}`\n\t\t\t}`,\n\t\t\tCommands.OpenOnRemote,\n\t\t\t[commandArgs],\n\t\t);\n\t}\n}\n\nnamespace QuickCommandButtons {\n\texport const SetRemoteAsDefault: QuickInputButton = {\n\t\ticonPath: new ThemeIcon('settings-gear'),\n\t\ttooltip: 'Set as Default Remote',\n\t};\n}\n\nexport namespace RemoteProviderPicker {\n\texport async function show(\n\t\ttitle: string,\n\t\tplaceHolder: string,\n\t\tresource: RemoteResource,\n\t\tremotes: GitRemote<RemoteProvider>[],\n\t\toptions?: { autoPick?: 'default' | boolean; clipboard?: boolean; setDefault?: boolean },\n\t): Promise<ConfigureCustomRemoteProviderCommandQuickPickItem | CopyOrOpenRemoteCommandQuickPickItem | undefined> {\n\t\tconst { autoPick, clipboard, setDefault } = { autoPick: false, clipboard: false, setDefault: true, ...options };\n\n\t\tlet items: (ConfigureCustomRemoteProviderCommandQuickPickItem | CopyOrOpenRemoteCommandQuickPickItem)[];\n\t\tif (remotes.length === 0) {\n\t\t\titems = [new ConfigureCustomRemoteProviderCommandQuickPickItem()];\n\t\t\tplaceHolder = 'No auto-detected or configured remote providers found';\n\t\t} else {\n\t\t\tif (autoPick === 'default' && remotes.length > 1) {\n\t\t\t\t// If there is a default just execute it directly\n\t\t\t\tconst remote = remotes.find(r => r.default);\n\t\t\t\tif (remote != null) {\n\t\t\t\t\tremotes = [remote];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\titems = remotes.map(\n\t\t\t\tr =>\n\t\t\t\t\tnew CopyOrOpenRemoteCommandQuickPickItem(\n\t\t\t\t\t\tr,\n\t\t\t\t\t\tresource,\n\t\t\t\t\t\tclipboard,\n\t\t\t\t\t\tsetDefault ? [QuickCommandButtons.SetRemoteAsDefault] : undefined,\n\t\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\tif (autoPick && remotes.length === 1) return items[0];\n\n\t\tconst quickpick = window.createQuickPick<\n\t\t\tConfigureCustomRemoteProviderCommandQuickPickItem | CopyOrOpenRemoteCommandQuickPickItem\n\t\t>();\n\t\tquickpick.ignoreFocusOut = getQuickPickIgnoreFocusOut();\n\n\t\tconst disposables: Disposable[] = [];\n\n\t\ttry {\n\t\t\tconst pick = await new Promise<\n\t\t\t\tConfigureCustomRemoteProviderCommandQuickPickItem | CopyOrOpenRemoteCommandQuickPickItem | undefined\n\t\t\t>(resolve => {\n\t\t\t\tdisposables.push(\n\t\t\t\t\tquickpick.onDidHide(() => resolve(undefined)),\n\t\t\t\t\tquickpick.onDidAccept(() => {\n\t\t\t\t\t\tif (quickpick.activeItems.length !== 0) {\n\t\t\t\t\t\t\tresolve(quickpick.activeItems[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tquickpick.onDidTriggerItemButton(async e => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\te.button === QuickCommandButtons.SetRemoteAsDefault &&\n\t\t\t\t\t\t\te.item instanceof CopyOrOpenRemoteCommandQuickPickItem\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tvoid (await e.item.setAsDefault());\n\t\t\t\t\t\t\tresolve(e.item);\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t);\n\n\t\t\t\tquickpick.title = title;\n\t\t\t\tquickpick.placeholder = placeHolder;\n\t\t\t\tquickpick.matchOnDetail = true;\n\t\t\t\tquickpick.items = items;\n\n\t\t\t\tquickpick.show();\n\t\t\t});\n\t\t\tif (pick == null) return undefined;\n\n\t\t\treturn pick;\n\t\t} finally {\n\t\t\tquickpick.dispose();\n\t\t\tdisposables.forEach(d => d.dispose());\n\t\t}\n\t}\n}\n","import { Disposable, TextEditor, Uri, window } from 'vscode';\nimport { Container } from '../container';\nimport { Repository } from '../git/models';\nimport { map } from '../system/iterable';\nimport { getQuickPickIgnoreFocusOut } from '../system/utils';\nimport { CommandQuickPickItem } from './items/common';\nimport { RepositoryQuickPickItem } from './items/gitCommands';\n\nexport namespace RepositoryPicker {\n\texport async function getBestRepositoryOrShow(\n\t\turi: Uri | undefined,\n\t\teditor: TextEditor | undefined,\n\t\ttitle: string,\n\t): Promise<Repository | undefined> {\n\t\tconst repository = Container.instance.git.getBestRepository(uri, editor);\n\t\tif (repository != null) return repository;\n\n\t\tconst pick = await RepositoryPicker.show(title);\n\t\tif (pick instanceof CommandQuickPickItem) {\n\t\t\tawait pick.execute();\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn pick?.item;\n\t}\n\n\texport async function getRepositoryOrShow(title: string, uri?: Uri): Promise<Repository | undefined> {\n\t\tif (uri == null) return Container.instance.git.highlander;\n\n\t\tconst repository = await Container.instance.git.getOrOpenRepository(uri);\n\t\tif (repository != null) return repository;\n\n\t\tconst pick = await RepositoryPicker.show(title);\n\t\tif (pick instanceof CommandQuickPickItem) {\n\t\t\tvoid (await pick.execute());\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn pick?.item;\n\t}\n\n\texport async function show(\n\t\ttitle: string | undefined,\n\t\tplaceholder: string = 'Choose a repository',\n\t\trepositories?: Repository[],\n\t): Promise<RepositoryQuickPickItem | undefined> {\n\t\tconst items: RepositoryQuickPickItem[] = await Promise.all([\n\t\t\t...map(repositories ?? Container.instance.git.openRepositories, r =>\n\t\t\t\tRepositoryQuickPickItem.create(r, undefined, { branch: true, status: true }),\n\t\t\t),\n\t\t]);\n\n\t\tconst quickpick = window.createQuickPick<RepositoryQuickPickItem>();\n\t\tquickpick.ignoreFocusOut = getQuickPickIgnoreFocusOut();\n\n\t\tconst disposables: Disposable[] = [];\n\n\t\ttry {\n\t\t\tconst pick = await new Promise<RepositoryQuickPickItem | undefined>(resolve => {\n\t\t\t\tdisposables.push(\n\t\t\t\t\tquickpick.onDidHide(() => resolve(undefined)),\n\t\t\t\t\tquickpick.onDidAccept(() => {\n\t\t\t\t\t\tif (quickpick.activeItems.length !== 0) {\n\t\t\t\t\t\t\tresolve(quickpick.activeItems[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t);\n\n\t\t\t\tquickpick.title = title;\n\t\t\t\tquickpick.placeholder = placeholder;\n\t\t\t\tquickpick.matchOnDescription = true;\n\t\t\t\tquickpick.matchOnDetail = true;\n\t\t\t\tquickpick.items = items;\n\n\t\t\t\tquickpick.show();\n\t\t\t});\n\t\t\tif (pick == null) return undefined;\n\n\t\t\treturn pick;\n\t\t} finally {\n\t\t\tquickpick.dispose();\n\t\t\tdisposables.forEach(d => d.dispose());\n\t\t}\n\t}\n}\n","import { Uri } from 'vscode';\nimport { isLinux } from '@env/platform';\nimport { Schemes } from './constants';\nimport { Repository } from './git/models/repository';\nimport { addVslsPrefixIfNeeded, normalizePath } from './system/path';\nimport { UriTrie } from './system/trie';\n// TODO@eamodio don't import from string here since it will break the tests because of ESM dependencies\n// import { CharCode } from './string';\n\nconst slash = 47; //CharCode.Slash;\n\nexport type RepoComparisionKey = string & { __type__: 'RepoComparisionKey' };\n\nexport function asRepoComparisonKey(uri: Uri): RepoComparisionKey {\n\tconst { path } = normalizeRepoUri(uri);\n\treturn path as RepoComparisionKey;\n}\n\nexport function normalizeRepoUri(uri: Uri): { path: string; ignoreCase: boolean } {\n\tlet path;\n\tswitch (uri.scheme.toLowerCase()) {\n\t\tcase Schemes.File:\n\t\t\tpath = normalizePath(uri.fsPath);\n\t\t\treturn { path: path, ignoreCase: !isLinux };\n\n\t\tcase Schemes.Git:\n\t\tcase Schemes.GitLens:\n\t\t\tpath = uri.path;\n\t\t\tif (path.charCodeAt(path.length - 1) === slash) {\n\t\t\t\tpath = path.slice(1, -1);\n\t\t\t} else {\n\t\t\t\tpath = path.slice(1);\n\t\t\t}\n\t\t\treturn { path: path, ignoreCase: !isLinux };\n\n\t\tcase Schemes.Virtual:\n\t\tcase Schemes.GitHub: {\n\t\t\tpath = uri.path;\n\t\t\tif (path.charCodeAt(path.length - 1) === slash) {\n\t\t\t\tpath = path.slice(0, -1);\n\t\t\t}\n\n\t\t\t// TODO@eamodio Revisit this, as we can't strip off the authority details (e.g. metadata) ultimately (since you in theory could have a workspace with more than 1 virtual repo which are the same except for the authority)\n\t\t\tconst authority = uri.authority?.split('+', 1)[0];\n\t\t\treturn { path: authority ? `${authority}${path}` : path.slice(1), ignoreCase: false };\n\t\t}\n\t\tcase Schemes.Vsls:\n\t\tcase Schemes.VslsScc:\n\t\t\t// Check if this is a root live share folder, if so add the required prefix (required to match repos correctly)\n\t\t\tpath = addVslsPrefixIfNeeded(uri.path);\n\n\t\t\tif (path.charCodeAt(path.length - 1) === slash) {\n\t\t\t\tpath = path.slice(1, -1);\n\t\t\t} else {\n\t\t\t\tpath = path.slice(1);\n\t\t\t}\n\n\t\t\treturn { path: path, ignoreCase: false };\n\n\t\tdefault:\n\t\t\tpath = uri.path;\n\t\t\tif (path.charCodeAt(path.length - 1) === slash) {\n\t\t\t\tpath = path.slice(1, -1);\n\t\t\t} else {\n\t\t\t\tpath = path.slice(1);\n\t\t\t}\n\t\t\treturn { path: path, ignoreCase: false };\n\t}\n}\n\nexport class Repositories {\n\tprivate readonly _trie: UriTrie<Repository>;\n\tprivate _count: number = 0;\n\n\tconstructor() {\n\t\tthis._trie = new UriTrie<Repository>(normalizeRepoUri);\n\t}\n\n\tget count(): number {\n\t\treturn this._count;\n\t}\n\n\tadd(repository: Repository): boolean {\n\t\tconst added = this._trie.set(repository.uri, repository);\n\t\tif (added) {\n\t\t\tthis._count++;\n\t\t}\n\t\treturn added;\n\t}\n\n\tclear(): void {\n\t\tthis._count = 0;\n\t\tthis._trie.clear();\n\t}\n\n\tforEach(fn: (repository: Repository) => void, thisArg?: unknown): void {\n\t\tfor (const value of this._trie.getDescendants()) {\n\t\t\tfn.call(thisArg, value);\n\t\t}\n\t}\n\n\tget(uri: Uri): Repository | undefined {\n\t\treturn this._trie.get(uri);\n\t}\n\n\tgetClosest(uri: Uri): Repository | undefined {\n\t\treturn this._trie.getClosest(uri);\n\t}\n\n\thas(uri: Uri): boolean {\n\t\treturn this._trie.has(uri);\n\t}\n\n\tremove(uri: Uri): boolean {\n\t\tconst deleted = this._trie.delete(uri);\n\t\tif (deleted) {\n\t\t\tthis._count--;\n\t\t}\n\t\treturn deleted;\n\t}\n\n\tvalues(): IterableIterator<Repository> {\n\t\treturn this._trie.getDescendants();\n\t}\n}\n","import { ExtensionContext } from 'vscode';\nimport type { ViewShowBranchComparison } from './config';\nimport type { SearchPattern } from './git/search';\n\nexport class Storage {\n\tconstructor(private readonly context: ExtensionContext) {}\n\n\tget<T>(key: StorageKeys | SyncedStorageKeys): T | undefined;\n\tget<T>(key: StorageKeys | SyncedStorageKeys, defaultValue: T): T;\n\tget<T>(key: StorageKeys | SyncedStorageKeys, defaultValue?: T): T | undefined {\n\t\treturn this.context.globalState.get(key, defaultValue);\n\t}\n\n\tasync delete(key: StorageKeys | SyncedStorageKeys): Promise<void> {\n\t\treturn this.context.globalState.update(key, undefined);\n\t}\n\n\tasync store<T>(key: StorageKeys | SyncedStorageKeys, value: T): Promise<void> {\n\t\treturn this.context.globalState.update(key, value);\n\t}\n\n\tasync getSecret(key: SecretKeys): Promise<string | undefined> {\n\t\treturn this.context.secrets.get(key);\n\t}\n\n\tasync deleteSecret(key: SecretKeys): Promise<void> {\n\t\treturn this.context.secrets.delete(key);\n\t}\n\n\tasync storeSecret(key: SecretKeys, value: string): Promise<void> {\n\t\treturn this.context.secrets.store(key, value);\n\t}\n\n\tgetWorkspace<T>(key: WorkspaceStorageKeys | `${WorkspaceStorageKeys.ConnectedPrefix}${string}`): T | undefined;\n\tgetWorkspace<T>(key: WorkspaceStorageKeys | `${WorkspaceStorageKeys.ConnectedPrefix}${string}`, defaultValue: T): T;\n\tgetWorkspace<T>(\n\t\tkey: WorkspaceStorageKeys | `${WorkspaceStorageKeys.ConnectedPrefix}${string}`,\n\t\tdefaultValue?: T,\n\t): T | undefined {\n\t\treturn this.context.workspaceState.get(key, defaultValue);\n\t}\n\n\tasync deleteWorkspace(\n\t\tkey: WorkspaceStorageKeys | `${WorkspaceStorageKeys.ConnectedPrefix}${string}`,\n\t): Promise<void> {\n\t\treturn this.context.workspaceState.update(key, undefined);\n\t}\n\n\tasync storeWorkspace<T>(\n\t\tkey: WorkspaceStorageKeys | `${WorkspaceStorageKeys.ConnectedPrefix}${string}`,\n\t\tvalue: T,\n\t): Promise<void> {\n\t\treturn this.context.workspaceState.update(key, value);\n\t}\n}\n\nexport type SecretKeys = string;\n\nexport const enum StorageKeys {\n\tAvatars = 'gitlens:avatars',\n\tPendingWelcomeOnFocus = 'gitlens:pendingWelcomeOnFocus',\n\tPendingWhatsNewOnFocus = 'gitlens:pendingWhatsNewOnFocus',\n\tVersion = 'gitlens:version',\n\n\tPremiumSubscription = 'gitlens:premium:subscription',\n\tPremiumPreview = 'gitlens:premium:preview',\n\n\tDeprecated_Version = 'gitlensVersion',\n}\n\nexport const enum SyncedStorageKeys {\n\tVersion = 'gitlens:synced:version',\n\tHomeViewWelcomeVisible = 'gitlens:views:welcome:visible',\n\n\tDeprecated_DisallowConnectionPrefix = 'gitlens:disallow:connection:',\n}\n\nexport const enum WorkspaceStorageKeys {\n\tAssumeRepositoriesOnStartup = 'gitlens:assumeRepositoriesOnStartup',\n\tGitPath = 'gitlens:gitPath',\n\n\tBranchComparisons = 'gitlens:branch:comparisons',\n\tConnectedPrefix = 'gitlens:connected:',\n\tDefaultRemote = 'gitlens:remote:default',\n\tGitCommandPaletteUsage = 'gitlens:gitComandPalette:usage',\n\tStarredBranches = 'gitlens:starred:branches',\n\tStarredRepositories = 'gitlens:starred:repositories',\n\tViewsRepositoriesAutoRefresh = 'gitlens:views:repositories:autoRefresh',\n\tViewsSearchAndCompareKeepResults = 'gitlens:views:searchAndCompare:keepResults',\n\tViewsSearchAndComparePinnedItems = 'gitlens:views:searchAndCompare:pinned',\n\n\tDeprecated_DisallowConnectionPrefix = 'gitlens:disallow:connection:',\n\tDeprecated_PinnedComparisons = 'gitlens:pinned:comparisons',\n}\n\nexport interface BranchComparison {\n\tref: string;\n\tnotation: '..' | '...' | undefined;\n\ttype: Exclude<ViewShowBranchComparison, false> | undefined;\n}\n\nexport interface BranchComparisons {\n\t[id: string]: string | BranchComparison;\n}\n\nexport interface NamedRef {\n\tlabel?: string;\n\tref: string;\n}\n\nexport interface PinnedComparison {\n\ttype: 'comparison';\n\ttimestamp: number;\n\tpath: string;\n\tref1: NamedRef;\n\tref2: NamedRef;\n\tnotation?: '..' | '...';\n}\n\nexport interface PinnedSearch {\n\ttype: 'search';\n\ttimestamp: number;\n\tpath: string;\n\tlabels: {\n\t\tlabel: string;\n\t\tqueryLabel:\n\t\t\t| string\n\t\t\t| {\n\t\t\t\t\tlabel: string;\n\t\t\t\t\tresultsType?: { singular: string; plural: string };\n\t\t\t  };\n\t};\n\tsearch: SearchPattern;\n}\n\nexport type PinnedItem = PinnedComparison | PinnedSearch;\n\nexport interface PinnedItems {\n\t[id: string]: PinnedItem;\n}\n\nexport interface Starred {\n\t[id: string]: boolean;\n}\n\nexport interface Usage {\n\t[id: string]: number;\n}\n","import { getDateDifference } from './system/date';\n\nexport const enum SubscriptionPlanId {\n\tFree = 'free',\n\tFreePlus = 'free+',\n\tPro = 'pro',\n\tTeams = 'teams',\n\tEnterprise = 'enterprise',\n}\n\nexport type FreeSubscriptionPlans = Extract<SubscriptionPlanId, SubscriptionPlanId.Free | SubscriptionPlanId.FreePlus>;\nexport type PaidSubscriptionPlans = Exclude<SubscriptionPlanId, SubscriptionPlanId.Free | SubscriptionPlanId.FreePlus>;\nexport type RequiredSubscriptionPlans = Exclude<SubscriptionPlanId, SubscriptionPlanId.Free>;\n\nexport interface Subscription {\n\treadonly plan: {\n\t\treadonly actual: SubscriptionPlan;\n\t\treadonly effective: SubscriptionPlan;\n\t};\n\taccount: SubscriptionAccount | undefined;\n\tpreviewTrial?: SubscriptionPreviewTrial;\n\n\tstate: SubscriptionState;\n}\n\nexport interface SubscriptionPlan {\n\treadonly id: SubscriptionPlanId;\n\treadonly name: string;\n\treadonly startedOn: string;\n\treadonly expiresOn?: string | undefined;\n}\n\nexport interface SubscriptionAccount {\n\treadonly id: string;\n\treadonly name: string;\n\treadonly email: string | undefined;\n\treadonly verified: boolean;\n}\n\nexport interface SubscriptionPreviewTrial {\n\treadonly startedOn: string;\n\treadonly expiresOn: string;\n}\n\nexport const enum SubscriptionState {\n\t/** Indicates a user who hasn't verified their email address yet */\n\tVerificationRequired = -1,\n\t/** Indicates a Free user who hasn't yet started the preview trial */\n\tFree = 0,\n\t/** Indicates a Free user who is in preview trial */\n\tFreeInPreview,\n\t/** Indicates a Free user who's preview has expired trial */\n\tFreePreviewExpired,\n\t/** Indicates a Free+ user with a completed trial */\n\tFreePlusInTrial,\n\t/** Indicates a Free+ user who's trial has expired */\n\tFreePlusTrialExpired,\n\t/** Indicates a Paid user */\n\tPaid,\n}\n\nexport function computeSubscriptionState(subscription: Optional<Subscription, 'state'>): SubscriptionState {\n\tconst {\n\t\taccount,\n\t\tplan: { actual, effective },\n\t\tpreviewTrial: preview,\n\t} = subscription;\n\n\tif (account?.verified === false) return SubscriptionState.VerificationRequired;\n\n\tif (actual.id === effective.id) {\n\t\tswitch (effective.id) {\n\t\t\tcase SubscriptionPlanId.Free:\n\t\t\t\treturn preview == null ? SubscriptionState.Free : SubscriptionState.FreePreviewExpired;\n\n\t\t\tcase SubscriptionPlanId.FreePlus:\n\t\t\t\treturn SubscriptionState.FreePlusTrialExpired;\n\n\t\t\tcase SubscriptionPlanId.Pro:\n\t\t\tcase SubscriptionPlanId.Teams:\n\t\t\tcase SubscriptionPlanId.Enterprise:\n\t\t\t\treturn SubscriptionState.Paid;\n\t\t}\n\t}\n\n\tswitch (effective.id) {\n\t\tcase SubscriptionPlanId.Free:\n\t\t\treturn preview == null ? SubscriptionState.Free : SubscriptionState.FreeInPreview;\n\n\t\tcase SubscriptionPlanId.FreePlus:\n\t\t\treturn SubscriptionState.FreePlusTrialExpired;\n\n\t\tcase SubscriptionPlanId.Pro:\n\t\t\treturn actual.id === SubscriptionPlanId.Free\n\t\t\t\t? SubscriptionState.FreeInPreview\n\t\t\t\t: SubscriptionState.FreePlusInTrial;\n\n\t\tcase SubscriptionPlanId.Teams:\n\t\tcase SubscriptionPlanId.Enterprise:\n\t\t\treturn SubscriptionState.Paid;\n\t}\n}\n\nexport function getSubscriptionPlan(id: SubscriptionPlanId, startedOn?: Date, expiresOn?: Date): SubscriptionPlan {\n\treturn {\n\t\tid: id,\n\t\tname: getSubscriptionPlanName(id),\n\t\tstartedOn: (startedOn ?? new Date()).toISOString(),\n\t\texpiresOn: expiresOn != null ? expiresOn.toISOString() : undefined,\n\t};\n}\n\nexport function getSubscriptionPlanName(id: SubscriptionPlanId) {\n\tswitch (id) {\n\t\tcase SubscriptionPlanId.FreePlus:\n\t\t\treturn 'GitLens Free+';\n\t\tcase SubscriptionPlanId.Pro:\n\t\t\treturn 'GitLens Pro';\n\t\tcase SubscriptionPlanId.Teams:\n\t\t\treturn 'GitLens Teams';\n\t\tcase SubscriptionPlanId.Enterprise:\n\t\t\treturn 'GitLens Enterprise';\n\t\tcase SubscriptionPlanId.Free:\n\t\tdefault:\n\t\t\treturn 'GitLens Free';\n\t}\n}\n\nconst plansPriority = new Map<SubscriptionPlanId | undefined, number>([\n\t[undefined, -1],\n\t[SubscriptionPlanId.Free, 0],\n\t[SubscriptionPlanId.FreePlus, 1],\n\t[SubscriptionPlanId.Pro, 2],\n\t[SubscriptionPlanId.Teams, 3],\n\t[SubscriptionPlanId.Enterprise, 4],\n]);\n\nexport function getSubscriptionPlanPriority(id: SubscriptionPlanId | undefined): number {\n\treturn plansPriority.get(id)!;\n}\n\nexport function getSubscriptionTimeRemaining(\n\tsubscription: Optional<Subscription, 'state'>,\n\tunit?: 'days' | 'hours' | 'minutes' | 'seconds',\n): number | undefined {\n\treturn getTimeRemaining(subscription.plan.effective.expiresOn, unit);\n}\n\nexport function getTimeRemaining(\n\texpiresOn: string | undefined,\n\tunit?: 'days' | 'hours' | 'minutes' | 'seconds',\n): number | undefined {\n\treturn expiresOn != null ? getDateDifference(Date.now(), new Date(expiresOn), unit) : undefined;\n}\n\nexport function isSubscriptionPaid(subscription: Optional<Subscription, 'state'>): boolean {\n\treturn isSubscriptionPaidPlan(subscription.plan.effective.id);\n}\n\nexport function isSubscriptionPaidPlan(id: SubscriptionPlanId): id is PaidSubscriptionPlans {\n\treturn id !== SubscriptionPlanId.Free && id !== SubscriptionPlanId.FreePlus;\n}\n\nexport function isSubscriptionExpired(subscription: Optional<Subscription, 'state'>): boolean {\n\tconst remaining = getSubscriptionTimeRemaining(subscription);\n\treturn remaining != null && remaining <= 0;\n}\n\nexport function isSubscriptionTrial(subscription: Optional<Subscription, 'state'>): boolean {\n\treturn subscription.plan.actual.id !== subscription.plan.effective.id;\n}\n\nexport function isSubscriptionPreviewTrialExpired(subscription: Optional<Subscription, 'state'>): boolean | undefined {\n\tconst remaining = getTimeRemaining(subscription.previewTrial?.expiresOn);\n\treturn remaining != null ? remaining <= 0 : undefined;\n}\n","// eslint-disable-next-line no-restricted-imports\nexport { findLastIndex, intersectionWith as intersection } from 'lodash-es';\n\nexport function chunk<T>(source: T[], size: number): T[][] {\n\tconst chunks = [];\n\n\tlet index = 0;\n\twhile (index < source.length) {\n\t\tchunks.push(source.slice(index, size + index));\n\t\tindex += size;\n\t}\n\treturn chunks;\n}\n\nexport function countStringLength(source: string[]): number {\n\tlet length = 0;\n\tfor (const s of source) {\n\t\tlength += s.length;\n\t}\n\treturn length;\n}\n\nexport function countUniques<T>(source: T[], accessor: (item: T) => string): Record<string, number> {\n\tconst uniqueCounts = Object.create(null) as Record<string, number>;\n\tfor (const item of source) {\n\t\tconst value = accessor(item);\n\t\tuniqueCounts[value] = (uniqueCounts[value] ?? 0) + 1;\n\t}\n\treturn uniqueCounts;\n}\n\nexport function ensure<T>(source: T | T[] | undefined): T[] | undefined {\n\treturn source == null ? undefined : Array.isArray(source) ? source : [source];\n}\n\nexport function filterMap<T, TMapped>(\n\tsource: T[],\n\tpredicateMapper: (item: T, index: number) => TMapped | null | undefined,\n): TMapped[] {\n\tlet index = 0;\n\treturn source.reduce((accumulator, current) => {\n\t\tconst mapped = predicateMapper(current, index++);\n\t\tif (mapped != null) {\n\t\t\taccumulator.push(mapped);\n\t\t}\n\t\treturn accumulator;\n\t}, [] as TMapped[]);\n}\n\nexport function filterMapAsync<T, TMapped>(\n\tsource: T[],\n\tpredicateMapper: (item: T, index: number) => Promise<TMapped | null | undefined>,\n): Promise<TMapped[]> {\n\tlet index = 0;\n\treturn source.reduce(async (accumulator, current) => {\n\t\tconst mapped = await predicateMapper(current, index++);\n\t\tif (mapped != null) {\n\t\t\taccumulator.push(mapped);\n\t\t}\n\t\treturn accumulator;\n\t}, [] as any);\n}\n\nexport function groupBy<T>(source: T[], groupingKey: (item: T) => string): Record<string, T[]> {\n\treturn source.reduce((groupings, current) => {\n\t\tconst value = groupingKey(current);\n\t\tconst group = groupings[value];\n\t\tif (group === undefined) {\n\t\t\tgroupings[value] = [current];\n\t\t} else {\n\t\t\tgroup.push(current);\n\t\t}\n\t\treturn groupings;\n\t}, Object.create(null) as Record<string, T[]>);\n}\n\nexport function groupByMap<TKey, TValue>(source: TValue[], groupingKey: (item: TValue) => TKey): Map<TKey, TValue[]> {\n\treturn source.reduce((groupings, current) => {\n\t\tconst value = groupingKey(current);\n\t\tconst group = groupings.get(value);\n\t\tif (group === undefined) {\n\t\t\tgroupings.set(value, [current]);\n\t\t} else {\n\t\t\tgroup.push(current);\n\t\t}\n\t\treturn groupings;\n\t}, new Map<TKey, TValue[]>());\n}\n\nexport function groupByFilterMap<TKey, TValue, TMapped>(\n\tsource: TValue[],\n\tgroupingKey: (item: TValue) => TKey,\n\tpredicateMapper: (item: TValue) => TMapped | null | undefined,\n): Map<TKey, TMapped[]> {\n\treturn source.reduce((groupings, current) => {\n\t\tconst mapped = predicateMapper(current);\n\t\tif (mapped != null) {\n\t\t\tconst value = groupingKey(current);\n\t\t\tconst group = groupings.get(value);\n\t\t\tif (group === undefined) {\n\t\t\t\tgroupings.set(value, [mapped]);\n\t\t\t} else {\n\t\t\t\tgroup.push(mapped);\n\t\t\t}\n\t\t}\n\t\treturn groupings;\n\t}, new Map<TKey, TMapped[]>());\n}\n\nexport function isStringArray<T extends any[]>(array: string[] | T): array is string[] {\n\treturn typeof array[0] === 'string';\n}\n\nexport interface HierarchicalItem<T> {\n\tname: string;\n\trelativePath: string;\n\tvalue?: T;\n\n\tparent?: HierarchicalItem<T>;\n\tchildren: Map<string, HierarchicalItem<T>> | undefined;\n\tdescendants: T[] | undefined;\n}\n\nexport function makeHierarchical<T>(\n\tvalues: T[],\n\tsplitPath: (i: T) => string[],\n\tjoinPath: (...paths: string[]) => string,\n\tcompact: boolean = false,\n\tcanCompact?: (i: T) => boolean,\n): HierarchicalItem<T> {\n\tconst seed = {\n\t\tname: '',\n\t\trelativePath: '',\n\t\tchildren: new Map(),\n\t\tdescendants: [],\n\t};\n\n\tlet hierarchy = values.reduce((root: HierarchicalItem<T>, value) => {\n\t\tlet folder = root;\n\n\t\tlet relativePath = '';\n\t\tfor (const folderName of splitPath(value)) {\n\t\t\trelativePath = joinPath(relativePath, folderName);\n\n\t\t\tif (folder.children === undefined) {\n\t\t\t\tfolder.children = new Map();\n\t\t\t}\n\n\t\t\tlet f = folder.children.get(folderName);\n\t\t\tif (f === undefined) {\n\t\t\t\tf = {\n\t\t\t\t\tname: folderName,\n\t\t\t\t\trelativePath: relativePath,\n\t\t\t\t\tparent: folder,\n\t\t\t\t\tchildren: undefined,\n\t\t\t\t\tdescendants: undefined,\n\t\t\t\t};\n\t\t\t\tfolder.children.set(folderName, f);\n\t\t\t}\n\n\t\t\tif (folder.descendants === undefined) {\n\t\t\t\tfolder.descendants = [];\n\t\t\t}\n\t\t\tfolder.descendants.push(value);\n\t\t\tfolder = f;\n\t\t}\n\n\t\tfolder.value = value;\n\n\t\treturn root;\n\t}, seed);\n\n\tif (compact) {\n\t\thierarchy = compactHierarchy(hierarchy, joinPath, true, canCompact);\n\t}\n\n\treturn hierarchy;\n}\n\nexport function compactHierarchy<T>(\n\troot: HierarchicalItem<T>,\n\tjoinPath: (...paths: string[]) => string,\n\tisRoot: boolean = true,\n\tcanCompact?: (i: T) => boolean,\n): HierarchicalItem<T> {\n\tif (root.children === undefined) return root;\n\n\tconst children = [...root.children.values()];\n\tfor (const child of children) {\n\t\tcompactHierarchy(child, joinPath, false, canCompact);\n\t}\n\n\tif (!isRoot && children.length === 1) {\n\t\tconst child = children[0];\n\t\tif (child.value === undefined || canCompact?.(child.value)) {\n\t\t\troot.name = joinPath(root.name, child.name);\n\t\t\troot.relativePath = child.relativePath;\n\t\t\troot.children = child.children;\n\t\t\troot.descendants = child.descendants;\n\t\t\troot.value = child.value;\n\t\t}\n\t}\n\n\treturn root;\n}\n\nexport function uniqueBy<TKey, TValue>(\n\tsource: TValue[],\n\tuniqueKey: (item: TValue) => TKey,\n\tonDuplicate: (original: TValue, current: TValue) => TValue | void,\n): TValue[] {\n\tconst map = source.reduce((uniques, current) => {\n\t\tconst value = uniqueKey(current);\n\t\tconst original = uniques.get(value);\n\t\tif (original === undefined) {\n\t\t\tuniques.set(value, current);\n\t\t} else {\n\t\t\tconst updated = onDuplicate(original, current);\n\t\t\tif (updated !== undefined) {\n\t\t\t\tuniques.set(value, updated);\n\t\t\t}\n\t\t}\n\t\treturn uniques;\n\t}, new Map<TKey, TValue>());\n\treturn [...map.values()];\n}\n","import { commands, Command as CoreCommand, Disposable, Uri } from 'vscode';\nimport { Action, ActionContext } from '../api/gitlens';\nimport type { Command } from '../commands/base';\nimport { Commands, CoreCommands, CoreGitCommands } from '../constants';\nimport type { Container } from '../container';\n\ninterface CommandConstructor {\n\tnew (container: Container): Command;\n}\nconst registrableCommands: CommandConstructor[] = [];\n\nexport function command(): ClassDecorator {\n\treturn (target: any) => {\n\t\tregistrableCommands.push(target);\n\t};\n}\n\nexport function registerCommands(container: Container): Disposable[] {\n\treturn registrableCommands.map(c => new c(container));\n}\n\nexport function asCommand<T extends unknown[]>(\n\tcommand: Omit<CoreCommand, 'arguments'> & { arguments: [...T] },\n): CoreCommand {\n\treturn command;\n}\n\nexport function executeActionCommand<T extends ActionContext>(action: Action<T>, args: Omit<T, 'type'>) {\n\treturn commands.executeCommand(`${Commands.ActionPrefix}${action}`, { ...args, type: action });\n}\n\ntype SupportedCommands = Commands | `gitlens.views.${string}.focus` | `gitlens.views.${string}.resetViewLocation`;\n\nexport function executeCommand<U = any>(command: SupportedCommands): Thenable<U>;\nexport function executeCommand<T = unknown, U = any>(command: SupportedCommands, arg: T): Thenable<U>;\nexport function executeCommand<T extends [...unknown[]] = [], U = any>(\n\tcommand: SupportedCommands,\n\t...args: T\n): Thenable<U>;\nexport function executeCommand<T extends [...unknown[]] = [], U = any>(\n\tcommand: SupportedCommands,\n\t...args: T\n): Thenable<U> {\n\treturn commands.executeCommand<U>(command, ...args);\n}\n\nexport function executeCoreCommand<T = unknown, U = any>(command: CoreCommands, arg: T): Thenable<U>;\nexport function executeCoreCommand<T extends [...unknown[]] = [], U = any>(\n\tcommand: CoreCommands,\n\t...args: T\n): Thenable<U>;\nexport function executeCoreCommand<T extends [...unknown[]] = [], U = any>(\n\tcommand: CoreCommands,\n\t...args: T\n): Thenable<U> {\n\treturn commands.executeCommand<U>(command, ...args);\n}\n\nexport function executeCoreGitCommand<U = any>(command: CoreGitCommands): Thenable<U>;\nexport function executeCoreGitCommand<T = unknown, U = any>(command: CoreGitCommands, arg: T): Thenable<U>;\nexport function executeCoreGitCommand<T extends [...unknown[]] = [], U = any>(\n\tcommand: CoreGitCommands,\n\t...args: T\n): Thenable<U>;\nexport function executeCoreGitCommand<T extends [...unknown[]] = [], U = any>(\n\tcommand: CoreGitCommands,\n\t...args: T\n): Thenable<U> {\n\treturn commands.executeCommand<U>(command, ...args);\n}\n\nexport function executeEditorCommand<T>(command: Commands, uri: Uri | undefined, args: T) {\n\treturn commands.executeCommand(command, uri, args);\n}\n","// NOTE@eamodio If this changes we need to update the replacement function too (since its parameter number/order relies on the matching)\nconst customDateTimeFormatParserRegex =\n\t/(?<literal>\\[.*?\\])|(?<year>YYYY|YY)|(?<month>M{1,4})|(?<day>Do|DD?)|(?<weekday>d{2,4})|(?<hour>HH?|hh?)|(?<minute>mm?)|(?<second>ss?)|(?<fractionalSecond>SSS)|(?<dayPeriod>A|a)|(?<timeZoneName>ZZ?)/g;\nconst dateTimeFormatCache = new Map<string | undefined, Intl.DateTimeFormat>();\nconst dateTimeFormatRegex = /(?<dateStyle>full|long|medium|short)(?:\\+(?<timeStyle>full|long|medium|short))?/;\nlet defaultRelativeTimeFormat: InstanceType<typeof Intl.RelativeTimeFormat> | undefined;\nlet defaultShortRelativeTimeFormat: InstanceType<typeof Intl.RelativeTimeFormat> | undefined;\nlet locale: string | undefined;\nconst relativeUnitThresholds: [Intl.RelativeTimeFormatUnit, number, string][] = [\n\t['year', 24 * 60 * 60 * 1000 * 365, 'yr'],\n\t['month', (24 * 60 * 60 * 1000 * 365) / 12, 'mo'],\n\t['week', 24 * 60 * 60 * 1000 * 7, 'wk'],\n\t['day', 24 * 60 * 60 * 1000, 'd'],\n\t['hour', 60 * 60 * 1000, 'h'],\n\t['minute', 60 * 1000, 'm'],\n\t['second', 1000, 's'],\n];\n\ntype DateStyle = 'full' | 'long' | 'medium' | 'short';\ntype TimeStyle = 'full' | 'long' | 'medium' | 'short';\nexport type DateTimeFormat = DateStyle | `${DateStyle}+${TimeStyle}`;\n\nexport function createFromDateDelta(\n\tdate: Date,\n\tdelta: { years?: number; months?: number; days?: number; hours?: number; minutes?: number; seconds?: number },\n): Date {\n\tconst d = new Date(date.getTime());\n\n\tfor (const [key, value] of Object.entries(delta)) {\n\t\tif (!value) continue;\n\n\t\tswitch (key) {\n\t\t\tcase 'years':\n\t\t\t\td.setFullYear(d.getFullYear() + value);\n\t\t\t\tbreak;\n\t\t\tcase 'months':\n\t\t\t\td.setMonth(d.getMonth() + value);\n\t\t\t\tbreak;\n\t\t\tcase 'days':\n\t\t\t\td.setDate(d.getDate() + value);\n\t\t\t\tbreak;\n\t\t\tcase 'hours':\n\t\t\t\td.setHours(d.getHours() + value);\n\t\t\t\tbreak;\n\t\t\tcase 'minutes':\n\t\t\t\td.setMinutes(d.getMinutes() + value);\n\t\t\t\tbreak;\n\t\t\tcase 'seconds':\n\t\t\t\td.setSeconds(d.getSeconds() + value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn d;\n}\n\nexport function fromNow(date: Date, short?: boolean): string {\n\tconst elapsed = date.getTime() - new Date().getTime();\n\n\tfor (const [unit, threshold, shortUnit] of relativeUnitThresholds) {\n\t\tconst elapsedABS = Math.abs(elapsed);\n\t\tif (elapsedABS >= threshold || threshold === 1000 /* second */) {\n\t\t\tif (short) {\n\t\t\t\tif (locale == null) {\n\t\t\t\t\tif (defaultShortRelativeTimeFormat != null) {\n\t\t\t\t\t\tlocale = defaultShortRelativeTimeFormat.resolvedOptions().locale;\n\t\t\t\t\t} else if (defaultRelativeTimeFormat != null) {\n\t\t\t\t\t\tlocale = defaultRelativeTimeFormat.resolvedOptions().locale;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdefaultShortRelativeTimeFormat = new Intl.RelativeTimeFormat(undefined, {\n\t\t\t\t\t\t\tlocaleMatcher: 'best fit',\n\t\t\t\t\t\t\tnumeric: 'always',\n\t\t\t\t\t\t\tstyle: 'narrow',\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlocale = defaultShortRelativeTimeFormat.resolvedOptions().locale;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (locale === 'en' || locale?.startsWith('en-')) {\n\t\t\t\t\tconst value = Math.round(elapsedABS / threshold);\n\t\t\t\t\treturn `${value}${shortUnit}`;\n\t\t\t\t}\n\n\t\t\t\tif (defaultShortRelativeTimeFormat == null) {\n\t\t\t\t\tdefaultShortRelativeTimeFormat = new Intl.RelativeTimeFormat(undefined, {\n\t\t\t\t\t\tlocaleMatcher: 'best fit',\n\t\t\t\t\t\tnumeric: 'always',\n\t\t\t\t\t\tstyle: 'narrow',\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn defaultShortRelativeTimeFormat.format(Math.round(elapsed / threshold), unit);\n\t\t\t}\n\n\t\t\tif (defaultRelativeTimeFormat == null) {\n\t\t\t\tdefaultRelativeTimeFormat = new Intl.RelativeTimeFormat(undefined, {\n\t\t\t\t\tlocaleMatcher: 'best fit',\n\t\t\t\t\tnumeric: 'auto',\n\t\t\t\t\tstyle: 'long',\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn defaultRelativeTimeFormat.format(Math.round(elapsed / threshold), unit);\n\t\t}\n\t}\n\n\treturn '';\n}\n\nexport function formatDate(date: Date, format: 'full' | 'long' | 'medium' | 'short' | string | null | undefined) {\n\tformat = format ?? undefined;\n\n\tlet formatter = dateTimeFormatCache.get(format);\n\tif (formatter == null) {\n\t\tconst options = getDateTimeFormatOptionsFromFormatString(format);\n\t\tformatter = new Intl.DateTimeFormat(undefined, options);\n\t\tdateTimeFormatCache.set(format, formatter);\n\t}\n\n\tif (format == null || dateTimeFormatRegex.test(format)) {\n\t\treturn formatter.format(date);\n\t}\n\n\tconst parts = formatter.formatToParts(date);\n\treturn format.replace(\n\t\tcustomDateTimeFormatParserRegex,\n\t\t(\n\t\t\t_match,\n\t\t\tliteral,\n\t\t\t_year,\n\t\t\t_month,\n\t\t\t_day,\n\t\t\t_weekday,\n\t\t\t_hour,\n\t\t\t_minute,\n\t\t\t_second,\n\t\t\t_fractionalSecond,\n\t\t\t_dayPeriod,\n\t\t\t_timeZoneName,\n\t\t\t_offset,\n\t\t\t_s,\n\t\t\tgroups,\n\t\t) => {\n\t\t\tif (literal != null) return (literal as string).substring(1, literal.length - 1);\n\n\t\t\tfor (const key in groups) {\n\t\t\t\tconst value = groups[key];\n\t\t\t\tif (value == null) continue;\n\n\t\t\t\tconst part = parts.find(p => p.type === key);\n\n\t\t\t\tif (value === 'Do' && part?.type === 'day') {\n\t\t\t\t\treturn formatWithOrdinal(Number(part.value));\n\t\t\t\t} else if (value === 'a' && part?.type === 'dayPeriod') {\n\t\t\t\t\treturn part.value.toLocaleLowerCase();\n\t\t\t\t}\n\t\t\t\treturn part?.value ?? '';\n\t\t\t}\n\n\t\t\treturn '';\n\t\t},\n\t);\n}\n\nexport function getDateDifference(\n\tfirst: Date | number,\n\tsecond: Date | number,\n\tunit?: 'days' | 'hours' | 'minutes' | 'seconds',\n): number {\n\tconst diff =\n\t\t(typeof second === 'number' ? second : second.getTime()) -\n\t\t(typeof first === 'number' ? first : first.getTime());\n\tswitch (unit) {\n\t\tcase 'days':\n\t\t\treturn Math.floor(diff / (1000 * 60 * 60 * 24));\n\t\tcase 'hours':\n\t\t\treturn Math.floor(diff / (1000 * 60 * 60));\n\t\tcase 'minutes':\n\t\t\treturn Math.floor(diff / (1000 * 60));\n\t\tcase 'seconds':\n\t\t\treturn Math.floor(diff / 1000);\n\t\tdefault:\n\t\t\treturn diff;\n\t}\n}\n\nfunction getDateTimeFormatOptionsFromFormatString(\n\tformat: DateTimeFormat | string | undefined,\n): Intl.DateTimeFormatOptions {\n\tif (format == null) return { localeMatcher: 'best fit', dateStyle: 'full', timeStyle: 'short' };\n\n\tconst match = dateTimeFormatRegex.exec(format);\n\tif (match?.groups != null) {\n\t\tconst { dateStyle, timeStyle } = match.groups;\n\t\treturn {\n\t\t\tlocaleMatcher: 'best fit',\n\t\t\tdateStyle: (dateStyle as Intl.DateTimeFormatOptions['dateStyle']) || 'full',\n\t\t\ttimeStyle: (timeStyle as Intl.DateTimeFormatOptions['timeStyle']) || undefined,\n\t\t};\n\t}\n\n\tconst options: Intl.DateTimeFormatOptions = { localeMatcher: 'best fit' };\n\n\tfor (const { groups } of format.matchAll(customDateTimeFormatParserRegex)) {\n\t\tif (groups == null) continue;\n\n\t\tfor (const key in groups) {\n\t\t\tconst value = groups[key];\n\t\t\tif (value == null) continue;\n\n\t\t\tswitch (key) {\n\t\t\t\tcase 'year':\n\t\t\t\t\toptions.year = value.length === 4 ? 'numeric' : '2-digit';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'month':\n\t\t\t\t\tswitch (value.length) {\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\toptions.month = 'long';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\toptions.month = 'short';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\toptions.month = '2-digit';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\toptions.month = 'numeric';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'day':\n\t\t\t\t\tif (value === 'DD') {\n\t\t\t\t\t\toptions.day = '2-digit';\n\t\t\t\t\t} else {\n\t\t\t\t\t\toptions.day = 'numeric';\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'weekday':\n\t\t\t\t\tswitch (value.length) {\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\toptions.weekday = 'long';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\toptions.weekday = 'short';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\toptions.weekday = 'narrow';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'hour':\n\t\t\t\t\toptions.hour = value.length === 2 ? '2-digit' : 'numeric';\n\t\t\t\t\toptions.hour12 = value === 'hh' || value === 'h';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'minute':\n\t\t\t\t\toptions.minute = value.length === 2 ? '2-digit' : 'numeric';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'second':\n\t\t\t\t\toptions.second = value.length === 2 ? '2-digit' : 'numeric';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'fractionalSecond':\n\t\t\t\t\t(options as any).fractionalSecondDigits = 3;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'dayPeriod':\n\t\t\t\t\toptions.dayPeriod = 'narrow';\n\t\t\t\t\toptions.hour12 = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'timeZoneName':\n\t\t\t\t\toptions.timeZoneName = (value.length === 2 ? 'longOffset' : 'shortOffset') as any;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn options;\n}\n\nconst ordinals = ['th', 'st', 'nd', 'rd'];\nfunction formatWithOrdinal(n: number): string {\n\tconst v = n % 100;\n\treturn `${n}${ordinals[(v - 20) % 10] ?? ordinals[v] ?? ordinals[0]}`;\n}\n","import { isPromise } from '../promise';\nimport { resolveProp } from './resolver';\n\nexport function gate<T extends (...arg: any) => any>(resolver?: (...args: Parameters<T>) => string) {\n\treturn (target: any, key: string, descriptor: PropertyDescriptor) => {\n\t\tlet fn: Function | undefined;\n\t\tif (typeof descriptor.value === 'function') {\n\t\t\tfn = descriptor.value;\n\t\t} else if (typeof descriptor.get === 'function') {\n\t\t\tfn = descriptor.get;\n\t\t}\n\t\tif (fn == null) throw new Error('Not supported');\n\n\t\tconst gateKey = `$gate$${key}`;\n\n\t\tdescriptor.value = function (this: any, ...args: any[]) {\n\t\t\tconst prop = resolveProp(gateKey, resolver, ...(args as Parameters<T>));\n\t\t\tif (!Object.prototype.hasOwnProperty.call(this, prop)) {\n\t\t\t\tObject.defineProperty(this, prop, {\n\t\t\t\t\tconfigurable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: true,\n\t\t\t\t\tvalue: undefined,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet promise = this[prop];\n\t\t\tif (promise === undefined) {\n\t\t\t\tlet result;\n\t\t\t\ttry {\n\t\t\t\t\tresult = fn!.apply(this, args);\n\t\t\t\t\tif (result == null || !isPromise(result)) {\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis[prop] = promise = result\n\t\t\t\t\t\t.then((r: any) => {\n\t\t\t\t\t\t\tthis[prop] = undefined;\n\t\t\t\t\t\t\treturn r;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(ex => {\n\t\t\t\t\t\t\tthis[prop] = undefined;\n\t\t\t\t\t\t\tthrow ex;\n\t\t\t\t\t\t});\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tthis[prop] = undefined;\n\t\t\t\t\tthrow ex;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn promise;\n\t\t};\n\t};\n}\n","import { hrtime } from '@env/hrtime';\nimport { LogCorrelationContext, Logger, LogLevel } from '../../logger';\nimport { filterMap } from '../array';\nimport { getParameters } from '../function';\nimport { isPromise } from '../promise';\nimport { getDurationMilliseconds } from '../string';\n\nconst emptyStr = '';\n\nconst correlationContext = new Map<number, LogCorrelationContext>();\nlet correlationCounter = 0;\n\nexport function getCorrelationContext() {\n\treturn correlationContext.get(correlationCounter);\n}\n\nexport function getCorrelationId() {\n\treturn correlationCounter;\n}\n\nexport function getNextCorrelationId() {\n\tif (correlationCounter === Number.MAX_SAFE_INTEGER) {\n\t\tcorrelationCounter = 0;\n\t}\n\treturn ++correlationCounter;\n}\n\nfunction clearCorrelationContext(correlationId: number) {\n\tcorrelationContext.delete(correlationId);\n}\n\nfunction setCorrelationContext(correlationId: number, context: LogCorrelationContext) {\n\tcorrelationContext.set(correlationId, context);\n}\n\nexport interface LogContext {\n\tid: number;\n\tinstance: any;\n\tinstanceName: string;\n\tname: string;\n\tprefix: string;\n}\n\nexport const LogInstanceNameFn = Symbol('logInstanceNameFn');\n\nexport function logName<T>(fn: (c: T, name: string) => string) {\n\treturn (target: Function) => {\n\t\t(target as any)[LogInstanceNameFn] = fn;\n\t};\n}\n\nexport function debug<T extends (...arg: any) => any>(\n\toptions: {\n\t\targs?:\n\t\t\t| false\n\t\t\t| {\n\t\t\t\t\t0?: ((arg: Parameters<T>[0]) => unknown) | string | false;\n\t\t\t\t\t1?: ((arg: Parameters<T>[1]) => unknown) | string | false;\n\t\t\t\t\t2?: ((arg: Parameters<T>[2]) => unknown) | string | false;\n\t\t\t\t\t3?: ((arg: Parameters<T>[3]) => unknown) | string | false;\n\t\t\t\t\t4?: ((arg: Parameters<T>[4]) => unknown) | string | false;\n\t\t\t\t\t[key: number]: (((arg: any) => unknown) | string | false) | undefined;\n\t\t\t  };\n\t\tcondition?(...args: Parameters<T>): boolean;\n\t\tcorrelate?: boolean;\n\t\tenter?(...args: Parameters<T>): string;\n\t\texit?(result: PromiseType<ReturnType<T>>): string;\n\t\tprefix?(context: LogContext, ...args: Parameters<T>): string;\n\t\tsanitize?(key: string, value: any): any;\n\t\tsingleLine?: boolean;\n\t\ttimed?: boolean;\n\t} = { timed: true },\n) {\n\treturn log<T>({ debug: true, ...options });\n}\n\ntype PromiseType<T> = T extends Promise<infer U> ? U : T;\n\nexport function log<T extends (...arg: any) => any>(\n\toptions: {\n\t\targs?:\n\t\t\t| false\n\t\t\t| {\n\t\t\t\t\t0?: ((arg: Parameters<T>[0]) => unknown) | string | false;\n\t\t\t\t\t1?: ((arg: Parameters<T>[1]) => unknown) | string | false;\n\t\t\t\t\t2?: ((arg: Parameters<T>[2]) => unknown) | string | false;\n\t\t\t\t\t3?: ((arg: Parameters<T>[3]) => unknown) | string | false;\n\t\t\t\t\t4?: ((arg: Parameters<T>[4]) => unknown) | string | false;\n\t\t\t\t\t[key: number]: (((arg: any) => unknown) | string | false) | undefined;\n\t\t\t  };\n\t\tcondition?(...args: Parameters<T>): boolean;\n\t\tcorrelate?: boolean;\n\t\tdebug?: boolean;\n\t\tenter?(...args: Parameters<T>): string;\n\t\texit?(result: PromiseType<ReturnType<T>>): string;\n\t\tprefix?(context: LogContext, ...args: Parameters<T>): string;\n\t\tsanitize?(key: string, value: any): any;\n\t\tsingleLine?: boolean;\n\t\ttimed?: boolean;\n\t} = { timed: true },\n) {\n\toptions = { timed: true, ...options };\n\n\tconst logFn = (options.debug ? Logger.debug.bind(Logger) : Logger.log.bind(Logger)) as\n\t\t| typeof Logger.debug\n\t\t| typeof Logger.log;\n\tconst warnFn = Logger.warn.bind(Logger);\n\n\treturn (target: any, key: string, descriptor: PropertyDescriptor & Record<string, any>) => {\n\t\tlet fn: Function | undefined;\n\t\tlet fnKey: string | undefined;\n\t\tif (typeof descriptor.value === 'function') {\n\t\t\tfn = descriptor.value;\n\t\t\tfnKey = 'value';\n\t\t} else if (typeof descriptor.get === 'function') {\n\t\t\tfn = descriptor.get;\n\t\t\tfnKey = 'get';\n\t\t}\n\t\tif (fn == null || fnKey == null) throw new Error('Not supported');\n\n\t\tconst parameters = getParameters(fn);\n\n\t\tdescriptor[fnKey] = function (this: any, ...args: Parameters<T>) {\n\t\t\tconst correlationId = getNextCorrelationId();\n\n\t\t\tif (\n\t\t\t\t(!Logger.isDebugging &&\n\t\t\t\t\t!Logger.enabled(LogLevel.Debug) &&\n\t\t\t\t\t!(Logger.enabled(LogLevel.Info) && !options.debug)) ||\n\t\t\t\t(typeof options.condition === 'function' && !options.condition(...args))\n\t\t\t) {\n\t\t\t\treturn fn!.apply(this, args);\n\t\t\t}\n\n\t\t\tlet instanceName: string;\n\t\t\tif (this != null) {\n\t\t\t\tinstanceName = Logger.toLoggableName(this);\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\t\t\tif (this.constructor?.[LogInstanceNameFn]) {\n\t\t\t\t\tinstanceName = target.constructor[LogInstanceNameFn](this, instanceName);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tinstanceName = emptyStr;\n\t\t\t}\n\n\t\t\tlet { correlate } = options;\n\t\t\tif (!correlate && options.timed) {\n\t\t\t\tcorrelate = true;\n\t\t\t}\n\n\t\t\tlet prefix = `${correlate ? `[${correlationId.toString(16).padStart(5)}] ` : emptyStr}${\n\t\t\t\tinstanceName ? `${instanceName}.` : emptyStr\n\t\t\t}${key}`;\n\n\t\t\tif (options.prefix != null) {\n\t\t\t\tprefix = options.prefix(\n\t\t\t\t\t{\n\t\t\t\t\t\tid: correlationId,\n\t\t\t\t\t\tinstance: this,\n\t\t\t\t\t\tinstanceName: instanceName,\n\t\t\t\t\t\tname: key,\n\t\t\t\t\t\tprefix: prefix,\n\t\t\t\t\t},\n\t\t\t\t\t...args,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tlet correlationContext: LogCorrelationContext | undefined;\n\t\t\tif (correlate) {\n\t\t\t\tcorrelationContext = { correlationId: correlationId, prefix: prefix };\n\t\t\t\tsetCorrelationContext(correlationId, correlationContext);\n\t\t\t}\n\n\t\t\tconst enter = options.enter != null ? options.enter(...args) : emptyStr;\n\n\t\t\tlet loggableParams: string;\n\t\t\tif (options.args === false || args.length === 0) {\n\t\t\t\tloggableParams = emptyStr;\n\n\t\t\t\tif (!options.singleLine) {\n\t\t\t\t\tlogFn(`${prefix}${enter}`);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst argControllers = typeof options.args === 'object' ? options.args : undefined;\n\t\t\t\tlet argController;\n\t\t\t\tlet loggable;\n\t\t\t\tloggableParams = filterMap(args, (v: any, index: number) => {\n\t\t\t\t\tconst p = parameters[index];\n\n\t\t\t\t\targController = argControllers != null ? argControllers[index] : undefined;\n\t\t\t\t\tif (argController != null) {\n\t\t\t\t\t\tif (typeof argController === 'boolean') return undefined;\n\t\t\t\t\t\tif (typeof argController === 'string') return argController;\n\t\t\t\t\t\tloggable = String(argController(v));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tloggable = Logger.toLoggable(v, options.sanitize);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn p ? `${p}=${loggable}` : loggable;\n\t\t\t\t}).join(', ');\n\n\t\t\t\tif (!options.singleLine) {\n\t\t\t\t\tlogFn(\n\t\t\t\t\t\t`${prefix}${enter}`,\n\t\t\t\t\t\t!options.debug && !Logger.enabled(LogLevel.Debug) && !Logger.isDebugging\n\t\t\t\t\t\t\t? emptyStr\n\t\t\t\t\t\t\t: loggableParams,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (options.singleLine || options.timed || options.exit != null) {\n\t\t\t\tconst start = options.timed ? hrtime() : undefined;\n\n\t\t\t\tconst logError = (ex: Error) => {\n\t\t\t\t\tconst timing = start !== undefined ? ` \\u2022 ${getDurationMilliseconds(start)} ms` : emptyStr;\n\t\t\t\t\tif (options.singleLine) {\n\t\t\t\t\t\tLogger.error(\n\t\t\t\t\t\t\tex,\n\t\t\t\t\t\t\t`${prefix}${enter}`,\n\t\t\t\t\t\t\t`failed${\n\t\t\t\t\t\t\t\tcorrelationContext?.exitDetails ? correlationContext.exitDetails : emptyStr\n\t\t\t\t\t\t\t}${timing}`,\n\t\t\t\t\t\t\tloggableParams,\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tLogger.error(\n\t\t\t\t\t\t\tex,\n\t\t\t\t\t\t\tprefix,\n\t\t\t\t\t\t\t`failed${\n\t\t\t\t\t\t\t\tcorrelationContext?.exitDetails ? correlationContext.exitDetails : emptyStr\n\t\t\t\t\t\t\t}${timing}`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (correlate) {\n\t\t\t\t\t\tclearCorrelationContext(correlationId);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tlet result;\n\t\t\t\ttry {\n\t\t\t\t\tresult = fn!.apply(this, args);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tlogError(ex);\n\t\t\t\t\tthrow ex;\n\t\t\t\t}\n\n\t\t\t\tconst logResult = (r: any) => {\n\t\t\t\t\tlet exitLogFn;\n\t\t\t\t\tlet timing;\n\t\t\t\t\tif (start != null) {\n\t\t\t\t\t\tconst duration = getDurationMilliseconds(start);\n\t\t\t\t\t\tif (duration > Logger.slowCallWarningThreshold) {\n\t\t\t\t\t\t\texitLogFn = warnFn;\n\t\t\t\t\t\t\ttiming = ` \\u2022 ${duration} ms (slow)`;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\texitLogFn = logFn;\n\t\t\t\t\t\t\ttiming = ` \\u2022 ${duration} ms`;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttiming = emptyStr;\n\t\t\t\t\t\texitLogFn = logFn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet exit;\n\t\t\t\t\tif (options.exit != null) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\texit = options.exit(r);\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\texit = `@log.exit error: ${ex}`;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\texit = 'completed';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (options.singleLine) {\n\t\t\t\t\t\texitLogFn(\n\t\t\t\t\t\t\t`${prefix}${enter} ${exit}${\n\t\t\t\t\t\t\t\tcorrelationContext?.exitDetails ? correlationContext.exitDetails : emptyStr\n\t\t\t\t\t\t\t}${timing}`,\n\t\t\t\t\t\t\t!options.debug && !Logger.enabled(LogLevel.Debug) && !Logger.isDebugging\n\t\t\t\t\t\t\t\t? emptyStr\n\t\t\t\t\t\t\t\t: loggableParams,\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\texitLogFn(\n\t\t\t\t\t\t\t`${prefix} ${exit}${\n\t\t\t\t\t\t\t\tcorrelationContext?.exitDetails ? correlationContext.exitDetails : emptyStr\n\t\t\t\t\t\t\t}${timing}`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (correlate) {\n\t\t\t\t\t\tclearCorrelationContext(correlationId);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tif (result != null && isPromise(result)) {\n\t\t\t\t\tconst promise = result.then(logResult);\n\t\t\t\t\tpromise.catch(logError);\n\t\t\t\t} else {\n\t\t\t\t\tlogResult(result);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\treturn fn!.apply(this, args);\n\t\t};\n\t};\n}\n","import { resolveProp } from './resolver';\n\nexport function memoize<T extends (...arg: any) => any>(resolver?: (...args: Parameters<T>) => string) {\n\treturn (target: any, key: string, descriptor: PropertyDescriptor & Record<string, any>) => {\n\t\tlet fn: Function | undefined;\n\t\tlet fnKey: string | undefined;\n\n\t\tif (typeof descriptor.value === 'function') {\n\t\t\tfn = descriptor.value;\n\t\t\tfnKey = 'value';\n\t\t} else if (typeof descriptor.get === 'function') {\n\t\t\tfn = descriptor.get;\n\t\t\tfnKey = 'get';\n\t\t} else {\n\t\t\tthrow new Error('Not supported');\n\t\t}\n\n\t\tif (fn == null) throw new Error('Not supported');\n\n\t\tconst memoizeKey = `$memoize$${key}`;\n\n\t\tlet result;\n\t\tdescriptor[fnKey] = function (...args: any[]) {\n\t\t\tconst prop = resolveProp(memoizeKey, resolver, ...(args as Parameters<T>));\n\t\t\tif (Object.prototype.hasOwnProperty.call(this, prop)) {\n\t\t\t\tresult = this[prop];\n\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tresult = fn!.apply(this, args);\n\t\t\tObject.defineProperty(this, prop, {\n\t\t\t\tconfigurable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\twritable: false,\n\t\t\t\tvalue: result,\n\t\t\t});\n\n\t\t\treturn result;\n\t\t};\n\t};\n}\n","import { Uri } from 'vscode';\n\nfunction replacer(key: string, value: any): any {\n\tif (key === '') return value;\n\n\tif (value == null) return value;\n\tif (value instanceof Error) return String(value);\n\tif (value instanceof Uri) {\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\tif ('sha' in (value as any) && (value as any).sha) {\n\t\t\treturn `${(value as any).sha}:${value.toString()}`;\n\t\t}\n\t\treturn value.toString();\n\t}\n\n\treturn value;\n}\n\nexport function defaultResolver(...args: any[]): string {\n\tif (args.length === 0) return '';\n\tif (args.length !== 1) {\n\t\treturn JSON.stringify(args, replacer);\n\t}\n\n\tconst arg0 = args[0];\n\tif (arg0 == null) return '';\n\tif (typeof arg0 === 'string') return arg0;\n\tif (typeof arg0 === 'number' || typeof arg0 === 'boolean' || arg0 instanceof Error) return String(arg0);\n\tif (arg0 instanceof Uri) {\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\tif ('sha' in (arg0 as any) && (arg0 as any).sha) {\n\t\t\treturn `${(arg0 as any).sha}:${arg0.toString()}`;\n\t\t}\n\t\treturn arg0.toString();\n\t}\n\n\treturn JSON.stringify(arg0, replacer);\n}\n\nexport type Resolver<T extends (...arg: any) => any> = (...args: Parameters<T>) => string;\n\nexport function resolveProp<T extends (...arg: any) => any>(\n\tkey: string,\n\tresolver: Resolver<T> | undefined,\n\t...args: Parameters<T>\n) {\n\tif (args.length === 0) return key;\n\n\tlet resolved;\n\tif (resolver != null) {\n\t\ttry {\n\t\t\tresolved = resolver(...args);\n\t\t} catch {\n\t\t\tdebugger;\n\t\t\tresolved = defaultResolver(...(args as any));\n\t\t}\n\t} else {\n\t\tresolved = defaultResolver(...(args as any));\n\t}\n\n\treturn `${key}$${resolved}`;\n}\n","import { cancellable, isPromise } from '../promise';\n\nexport function timeout(timeout: number): any;\nexport function timeout(timeoutFromLastArg: true, defaultTimeout?: number): any;\nexport function timeout(timeoutOrTimeoutFromLastArg: number | boolean, defaultTimeout?: number): any {\n\tlet timeout: number | undefined;\n\tlet timeoutFromLastArg = false;\n\tif (typeof timeoutOrTimeoutFromLastArg === 'boolean') {\n\t\ttimeoutFromLastArg = timeoutOrTimeoutFromLastArg;\n\t} else {\n\t\ttimeout = timeoutOrTimeoutFromLastArg;\n\t}\n\n\treturn (target: any, key: string, descriptor: PropertyDescriptor) => {\n\t\tlet fn: Function | undefined;\n\t\tif (typeof descriptor.value === 'function') {\n\t\t\tfn = descriptor.value;\n\t\t}\n\t\tif (fn == null) throw new Error('Not supported');\n\n\t\tdescriptor.value = function (this: any, ...args: any[]) {\n\t\t\tif (timeoutFromLastArg) {\n\t\t\t\tconst lastArg = args[args.length - 1];\n\t\t\t\tif (lastArg != null && typeof lastArg === 'number') {\n\t\t\t\t\ttimeout = lastArg;\n\t\t\t\t} else {\n\t\t\t\t\ttimeout = defaultTimeout;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst result = fn?.apply(this, args);\n\t\t\tif (timeout == null || timeout < 1 || !isPromise(result)) return result;\n\n\t\t\treturn cancellable(result, timeout, { onDidCancel: resolve => resolve(undefined) });\n\t\t};\n\t};\n}\n","export function encodeUrl(url: string): string;\nexport function encodeUrl(url: string | undefined): string | undefined;\nexport function encodeUrl(url: string | undefined): string | undefined {\n\tif (url == null) return undefined;\n\n\t// Not a fan of this, but it's hard to gauge previous encoding and this is the most common case\n\treturn encodeURI(url.replace(/%20/g, ' '));\n}\n","import { Disposable, Event } from 'vscode';\n\nexport function once<T>(event: Event<T>): Event<T> {\n\treturn (listener: (e: T) => unknown, thisArgs?: unknown, disposables?: Disposable[]) => {\n\t\tconst result = event(\n\t\t\te => {\n\t\t\t\tresult.dispose();\n\t\t\t\treturn listener.call(thisArgs, e);\n\t\t\t},\n\t\t\tnull,\n\t\t\tdisposables,\n\t\t);\n\n\t\treturn result;\n\t};\n}\n\nexport function promisify<T>(event: Event<T>): Promise<T> {\n\treturn new Promise<T>(resolve => once(event)(resolve));\n}\n\nexport function until<T>(event: Event<T>, predicate: (e: T) => boolean): Event<T> {\n\treturn (listener: (e: T) => unknown, thisArgs?: unknown, disposables?: Disposable[]) => {\n\t\tconst result = event(\n\t\t\te => {\n\t\t\t\tif (predicate(e)) {\n\t\t\t\t\tresult.dispose();\n\t\t\t\t}\n\t\t\t\treturn listener.call(thisArgs, e);\n\t\t\t},\n\t\t\tnull,\n\t\t\tdisposables,\n\t\t);\n\n\t\treturn result;\n\t};\n}\n","import { Uri } from 'vscode';\nimport { basename, getBestPath, relativeDir } from './path';\nimport { truncateLeft, truncateMiddle } from './string';\n\nexport function formatPath(\n\tpathOrUri: string | Uri,\n\toptions?:\n\t\t| {\n\t\t\t\tfileOnly?: false;\n\t\t\t\trelativeTo?: string;\n\t\t\t\tsuffix?: string;\n\t\t\t\ttruncateTo?: number;\n\t\t  }\n\t\t| {\n\t\t\t\tfileOnly?: true;\n\t\t\t\trelativeTo?: never;\n\t\t\t\tsuffix?: string;\n\t\t\t\ttruncateTo?: number;\n\t\t  },\n): string {\n\tconst path = getBestPath(pathOrUri);\n\tlet file = basename(path);\n\n\tif (options?.truncateTo != null && file.length >= options.truncateTo) {\n\t\treturn truncateMiddle(file, options.truncateTo);\n\t}\n\n\tif (options?.suffix) {\n\t\tif (options.truncateTo != null && file.length + options.suffix.length >= options.truncateTo) {\n\t\t\treturn `${truncateMiddle(file, options.truncateTo - options.suffix.length)}${options.suffix}`;\n\t\t}\n\n\t\tfile += options.suffix;\n\t}\n\n\tif (options?.fileOnly) return file;\n\n\tconst directory = relativeDir(path, options?.relativeTo);\n\tif (!directory) return file;\n\n\tfile = `/${file}`;\n\n\tif (options?.truncateTo != null && file.length + directory.length >= options.truncateTo) {\n\t\treturn `${truncateLeft(directory, options.truncateTo - file.length)}${file}`;\n\t}\n\n\treturn `${directory}${file}`;\n}\n","import root from './_root.js';\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nexport default now;\n","import isObject from './isObject.js';\nimport now from './now.js';\nimport toNumber from './toNumber.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nexport default debounce;\n","import toInteger from './toInteger.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a function that invokes `func`, with the `this` binding and arguments\n * of the created function, while it's called less than `n` times. Subsequent\n * calls to the created function return the result of the last `func` invocation.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Function\n * @param {number} n The number of calls at which `func` is no longer invoked.\n * @param {Function} func The function to restrict.\n * @returns {Function} Returns the new restricted function.\n * @example\n *\n * jQuery(element).on('click', _.before(5, addContactToList));\n * // => Allows adding up to 4 contacts to the list.\n */\nfunction before(n, func) {\n  var result;\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  n = toInteger(n);\n  return function() {\n    if (--n > 0) {\n      result = func.apply(this, arguments);\n    }\n    if (n <= 1) {\n      func = undefined;\n    }\n    return result;\n  };\n}\n\nexport default before;\n","import before from './before.js';\n\n/**\n * Creates a function that is restricted to invoking `func` once. Repeat calls\n * to the function return the value of the first invocation. The `func` is\n * invoked with the `this` binding and arguments of the created function.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to restrict.\n * @returns {Function} Returns the new restricted function.\n * @example\n *\n * var initialize = _.once(createApplication);\n * initialize();\n * initialize();\n * // => `createApplication` is invoked once\n */\nfunction once(func) {\n  return before(2, func);\n}\n\nexport default once;\n","// eslint-disable-next-line no-restricted-imports\nimport { debounce as _debounce, once as _once } from 'lodash-es';\nimport { Disposable } from 'vscode';\n\nexport interface Deferrable<T extends (...args: any[]) => any> {\n\t(...args: Parameters<T>): ReturnType<T> | undefined;\n\tcancel(): void;\n\tflush(): ReturnType<T> | undefined;\n\tpending?(): boolean;\n}\n\ninterface PropOfValue {\n\t(): any;\n\tvalue: string | undefined;\n}\n\nexport interface DebounceOptions {\n\tleading?: boolean;\n\tmaxWait?: number;\n\ttrack?: boolean;\n\ttrailing?: boolean;\n}\n\nexport function debounce<T extends (...args: any[]) => any>(\n\tfn: T,\n\twait?: number,\n\toptions?: DebounceOptions,\n): Deferrable<T> {\n\tconst { track, ...opts }: DebounceOptions = {\n\t\ttrack: false,\n\t\t...(options ?? {}),\n\t};\n\n\tif (track !== true) return _debounce(fn, wait, opts);\n\n\tlet pending = false;\n\n\tconst debounced = _debounce(\n\t\tfunction (this: any, ...args: any[]) {\n\t\t\tpending = false;\n\t\t\treturn fn.apply(this, args);\n\t\t} as any as T,\n\t\twait,\n\t\toptions,\n\t);\n\n\tconst tracked: Deferrable<T> = function (this: any, ...args: Parameters<T>) {\n\t\tpending = true;\n\t\treturn debounced.apply(this, args);\n\t} as any;\n\n\ttracked.pending = function () {\n\t\treturn pending;\n\t};\n\ttracked.cancel = function () {\n\t\treturn debounced.cancel.apply(debounced);\n\t};\n\ttracked.flush = function () {\n\t\treturn debounced.flush.apply(debounced);\n\t};\n\n\treturn tracked;\n}\n\n// export function debounceMemoized<T extends (...args: any[]) => any>(\n// \tfn: T,\n// \twait?: number,\n// \toptions?: DebounceOptions & { resolver?(...args: any[]): any }\n// ): T {\n// \tconst { resolver, ...opts } = options || ({} as DebounceOptions & { resolver?: T });\n\n// \tconst memo = _memoize(() => {\n// \t\treturn debounce(fn, wait, opts);\n// \t}, resolver);\n\n// \treturn function(this: any, ...args: []) {\n// \t\treturn memo.apply(this, args).apply(this, args);\n// \t} as T;\n// }\n\nconst comma = ',';\nconst emptyStr = '';\nconst equals = '=';\nconst openBrace = '{';\nconst openParen = '(';\nconst closeParen = ')';\n\nconst fnBodyRegex = /\\(([\\s\\S]*)\\)/;\nconst fnBodyStripCommentsRegex = /(\\/\\*([\\s\\S]*?)\\*\\/|([^:]|^)\\/\\/(.*)$)/gm;\nconst fnBodyStripParamDefaultValueRegex = /\\s?=.*$/;\n\nexport function getParameters(fn: Function): string[] {\n\tif (typeof fn !== 'function') throw new Error('Not supported');\n\n\tif (fn.length === 0) return [];\n\n\tlet fnBody: string = Function.prototype.toString.call(fn);\n\tfnBody = fnBody.replace(fnBodyStripCommentsRegex, emptyStr) || fnBody;\n\tfnBody = fnBody.slice(0, fnBody.indexOf(openBrace));\n\n\tlet open = fnBody.indexOf(openParen);\n\tlet close = fnBody.indexOf(closeParen);\n\n\topen = open >= 0 ? open + 1 : 0;\n\tclose = close > 0 ? close : fnBody.indexOf(equals);\n\n\tfnBody = fnBody.slice(open, close);\n\tfnBody = `(${fnBody})`;\n\n\tconst match = fnBodyRegex.exec(fnBody);\n\treturn match != null\n\t\t? match[1].split(comma).map(param => param.trim().replace(fnBodyStripParamDefaultValueRegex, emptyStr))\n\t\t: [];\n}\n\nexport function is<T extends object>(o: T | null | undefined): o is T;\nexport function is<T extends object>(o: object, prop: keyof T, value?: any): o is T;\nexport function is<T extends object>(o: object, matcher: (o: object) => boolean): o is T;\nexport function is<T extends object>(o: object, propOrMatcher?: keyof T | ((o: any) => boolean), value?: any): o is T {\n\tif (propOrMatcher == null) return o != null;\n\tif (typeof propOrMatcher === 'function') return propOrMatcher(o);\n\n\treturn value === undefined ? (o as any)[propOrMatcher] !== undefined : (o as any)[propOrMatcher] === value;\n}\n\nexport function once<T extends (...args: any[]) => any>(fn: T): T {\n\treturn _once(fn);\n}\n\nexport function propOf<T, K extends Extract<keyof T, string>>(o: T, key: K) {\n\tconst propOfCore = <T, K extends Extract<keyof T, string>>(o: T, key: K) => {\n\t\tconst value: string =\n\t\t\t(propOfCore as PropOfValue).value === undefined ? key : `${(propOfCore as PropOfValue).value}.${key}`;\n\t\t(propOfCore as PropOfValue).value = value;\n\t\tconst fn = <Y extends Extract<keyof T[K], string>>(k: Y) => propOfCore(o[key], k);\n\t\treturn Object.assign(fn, { value: value });\n\t};\n\treturn propOfCore(o, key);\n}\n\nexport function disposableInterval(fn: (...args: any[]) => void, ms: number): Disposable {\n\tlet timer: ReturnType<typeof setInterval> | undefined;\n\tconst disposable = {\n\t\tdispose: () => {\n\t\t\tif (timer != null) {\n\t\t\t\tclearInterval(timer);\n\t\t\t\ttimer = undefined;\n\t\t\t}\n\t\t},\n\t};\n\ttimer = setInterval(fn, ms);\n\n\treturn disposable;\n}\n\n/**\n * Szudzik elegant pairing function\n * http://szudzik.com/ElegantPairing.pdf\n */\nexport function szudzikPairing(x: number, y: number): number {\n\treturn x >= y ? x * x + x + y : x + y * y;\n}\n\nexport async function wait(ms: number) {\n\tawait new Promise(resolve => setTimeout(resolve, ms));\n}\n","export function* chunk<T>(source: T[], size: number): Iterable<T[]> {\n\tlet chunk: T[] = [];\n\n\tfor (const item of source) {\n\t\tif (chunk.length < size) {\n\t\t\tchunk.push(item);\n\t\t\tcontinue;\n\t\t}\n\n\t\tyield chunk;\n\t\tchunk = [];\n\t}\n\n\tif (chunk.length > 0) {\n\t\tyield chunk;\n\t}\n}\n\nexport function* chunkByStringLength(source: string[], maxLength: number): Iterable<string[]> {\n\tlet chunk: string[] = [];\n\n\tlet chunkLength = 0;\n\tfor (const item of source) {\n\t\tlet length = chunkLength + item.length;\n\t\tif (length > maxLength && chunk.length > 0) {\n\t\t\tyield chunk;\n\n\t\t\tchunk = [];\n\t\t\tlength = item.length;\n\t\t}\n\n\t\tchunk.push(item);\n\t\tchunkLength = length;\n\t}\n\n\tif (chunk.length > 0) {\n\t\tyield chunk;\n\t}\n}\n\nexport function count<T>(source: Iterable<T> | IterableIterator<T>, predicate?: (item: T) => boolean): number {\n\tlet count = 0;\n\tlet next: IteratorResult<T>;\n\n\twhile (true) {\n\t\tnext = (source as IterableIterator<T>).next();\n\t\tif (next.done) break;\n\n\t\tif (predicate === undefined || predicate(next.value)) {\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}\n\nexport function every<T>(source: Iterable<T> | IterableIterator<T>, predicate: (item: T) => boolean): boolean {\n\tfor (const item of source) {\n\t\tif (!predicate(item)) return false;\n\t}\n\treturn true;\n}\n\nexport function filter<T>(source: Iterable<T | undefined | null> | IterableIterator<T | undefined | null>): Iterable<T>;\nexport function filter<T>(source: Iterable<T> | IterableIterator<T>, predicate: (item: T) => boolean): Iterable<T>;\nexport function filter<T, U extends T>(\n\tsource: Iterable<T> | IterableIterator<T>,\n\tpredicate: (item: T) => item is U,\n): Iterable<U>;\nexport function* filter<T, U extends T = T>(\n\tsource: Iterable<T> | IterableIterator<T>,\n\tpredicate?: ((item: T) => item is U) | ((item: T) => boolean),\n): Iterable<T | U> {\n\tif (predicate === undefined) {\n\t\tfor (const item of source) {\n\t\t\tif (item != null) yield item;\n\t\t}\n\t} else {\n\t\tfor (const item of source) {\n\t\t\tif (predicate(item)) yield item;\n\t\t}\n\t}\n}\n\nexport function* filterMap<T, TMapped>(\n\tsource: Iterable<T> | IterableIterator<T>,\n\tpredicateMapper: (item: T) => TMapped | undefined | null,\n): Iterable<TMapped> {\n\tfor (const item of source) {\n\t\tconst mapped = predicateMapper(item);\n\t\tif (mapped != null) yield mapped;\n\t}\n}\n\nexport function forEach<T>(source: Iterable<T> | IterableIterator<T>, fn: (item: T, index: number) => void): void {\n\tlet i = 0;\n\tfor (const item of source) {\n\t\tfn(item, i);\n\t\ti++;\n\t}\n}\n\nexport function find<T>(source: Iterable<T> | IterableIterator<T>, predicate: (item: T) => boolean): T | null {\n\tfor (const item of source) {\n\t\tif (predicate(item)) return item;\n\t}\n\treturn null;\n}\n\nexport function first<T>(source: Iterable<T> | IterableIterator<T>): T {\n\treturn source[Symbol.iterator]().next().value;\n}\n\nexport function* flatMap<T, TMapped>(\n\tsource: Iterable<T> | IterableIterator<T>,\n\tmapper: (item: T) => Iterable<TMapped>,\n): Iterable<TMapped> {\n\tfor (const item of source) {\n\t\tyield* mapper(item);\n\t}\n}\n\nexport function has<T>(source: Iterable<T> | IterableIterator<T>, item: T): boolean {\n\treturn some(source, i => i === item);\n}\n\nexport function isIterable(source: Iterable<any>): boolean {\n\treturn typeof source[Symbol.iterator] === 'function';\n}\n\nexport function join(source: Iterable<any>, separator: string): string {\n\tlet value = '';\n\n\tconst iterator = source[Symbol.iterator]();\n\tlet next = iterator.next();\n\tif (next.done) return value;\n\n\twhile (true) {\n\t\tconst s = next.value.toString();\n\n\t\tnext = iterator.next();\n\t\tif (next.done) {\n\t\t\tvalue += s;\n\t\t\tbreak;\n\t\t}\n\n\t\tvalue += `${s}${separator}`;\n\t}\n\n\treturn value;\n}\n\nexport function last<T>(source: Iterable<T>): T | undefined {\n\tlet item: T | undefined;\n\tfor (item of source) {\n\t\t/* noop */\n\t}\n\treturn item;\n}\n\nexport function* map<T, TMapped>(\n\tsource: Iterable<T> | IterableIterator<T>,\n\tmapper: (item: T) => TMapped,\n): IterableIterator<TMapped> {\n\tfor (const item of source) {\n\t\tyield mapper(item);\n\t}\n}\n\nexport function next<T>(source: IterableIterator<T>): T {\n\treturn source.next().value;\n}\n\nexport function* skip<T>(source: Iterable<T> | IterableIterator<T>, count: number): IterableIterator<T> {\n\tlet i = 0;\n\tfor (const item of source) {\n\t\tif (i >= count) yield item;\n\t\ti++;\n\t}\n}\n\nexport function some<T>(source: Iterable<T> | IterableIterator<T>, predicate: (item: T) => boolean): boolean {\n\tfor (const item of source) {\n\t\tif (predicate(item)) return true;\n\t}\n\treturn false;\n}\n\nexport function* take<T>(source: Iterable<T> | IterableIterator<T>, count: number): Iterable<T> {\n\tif (count > 0) {\n\t\tlet i = 0;\n\t\tfor (const item of source) {\n\t\t\tyield item;\n\t\t\ti++;\n\t\t\tif (i >= count) break;\n\t\t}\n\t}\n}\n\nexport function* union<T>(...sources: (Iterable<T> | IterableIterator<T>)[]): Iterable<T> {\n\tfor (const source of sources) {\n\t\tfor (const item of source) {\n\t\t\tyield item;\n\t\t}\n\t}\n}\n\nexport function uniqueBy<TKey, TValue>(\n\tsource: Iterable<TValue> | IterableIterator<TValue>,\n\tuniqueKey: (item: TValue) => TKey,\n\tonDuplicate: (original: TValue, current: TValue) => TValue | void,\n): IterableIterator<TValue> {\n\tconst uniques = new Map<TKey, TValue>();\n\n\tfor (const current of source) {\n\t\tconst value = uniqueKey(current);\n\n\t\tconst original = uniques.get(value);\n\t\tif (original === undefined) {\n\t\t\tuniques.set(value, current);\n\t\t} else {\n\t\t\tconst updated = onDuplicate(original, current);\n\t\t\tif (updated !== undefined) {\n\t\t\t\tuniques.set(value, updated);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn uniques.values();\n}\n","// eslint-disable-next-line no-restricted-imports\nimport { isAbsolute as _isAbsolute, basename, dirname } from 'path';\nimport { Uri } from 'vscode';\nimport { isLinux, isWindows } from '@env/platform';\nimport { Schemes } from '../constants';\n// TODO@eamodio don't import from string here since it will break the tests because of ESM dependencies\n// import { CharCode } from './string';\n\n// eslint-disable-next-line no-restricted-imports\nexport { basename, dirname, extname, join as joinPaths } from 'path';\n\nconst slash = 47; //slash;\n\nconst driveLetterNormalizeRegex = /(?<=^\\/?)([A-Z])(?=:\\/)/;\nconst hasSchemeRegex = /^([a-zA-Z][\\w+.-]+):/;\nconst pathNormalizeRegex = /\\\\/g;\nconst vslsHasPrefixRegex = /^[/|\\\\]~(?:\\d+?|external)(?:[/|\\\\]|$)/;\nconst vslsRootUriRegex = /^[/|\\\\]~(?:\\d+?|external)(?:[/|\\\\]|$)/;\n\nexport function addVslsPrefixIfNeeded(path: string): string;\nexport function addVslsPrefixIfNeeded(uri: Uri): Uri;\nexport function addVslsPrefixIfNeeded(pathOrUri: string | Uri): string | Uri;\nexport function addVslsPrefixIfNeeded(pathOrUri: string | Uri): string | Uri {\n\tif (typeof pathOrUri === 'string') {\n\t\tif (maybeUri(pathOrUri)) {\n\t\t\tpathOrUri = Uri.parse(pathOrUri);\n\t\t}\n\t}\n\n\tif (typeof pathOrUri === 'string') {\n\t\tif (hasVslsPrefix(pathOrUri)) return pathOrUri;\n\n\t\tpathOrUri = normalizePath(pathOrUri);\n\t\treturn `/~0${pathOrUri.charCodeAt(0) === slash ? pathOrUri : `/${pathOrUri}`}`;\n\t}\n\n\tlet path = pathOrUri.fsPath;\n\tif (hasVslsPrefix(path)) return pathOrUri;\n\n\tpath = normalizePath(path);\n\treturn pathOrUri.with({ path: `/~0${path.charCodeAt(0) === slash ? path : `/${path}`}` });\n}\n\nexport function hasVslsPrefix(path: string): boolean {\n\treturn vslsHasPrefixRegex.test(path);\n}\n\nexport function isVslsRoot(path: string): boolean {\n\treturn vslsRootUriRegex.test(path);\n}\n\nexport function commonBase(s1: string, s2: string, delimiter: string, ignoreCase?: boolean): string | undefined {\n\tconst index = commonBaseIndex(s1, s2, delimiter, ignoreCase);\n\treturn index > 0 ? s1.substring(0, index + 1) : undefined;\n}\n\nexport function commonBaseIndex(s1: string, s2: string, delimiter: string, ignoreCase?: boolean): number {\n\tif (s1.length === 0 || s2.length === 0) return 0;\n\n\tif (ignoreCase ?? !isLinux) {\n\t\ts1 = s1.toLowerCase();\n\t\ts2 = s2.toLowerCase();\n\t}\n\n\tlet char;\n\tlet index = 0;\n\tfor (let i = 0; i < s1.length; i++) {\n\t\tchar = s1[i];\n\t\tif (char !== s2[i]) break;\n\n\t\tif (char === delimiter) {\n\t\t\tindex = i;\n\t\t}\n\t}\n\n\treturn index;\n}\n\nexport function getBestPath(uri: Uri): string;\nexport function getBestPath(pathOrUri: string | Uri): string;\nexport function getBestPath(pathOrUri: string | Uri): string {\n\tif (typeof pathOrUri === 'string') {\n\t\tif (!hasSchemeRegex.test(pathOrUri)) return normalizePath(pathOrUri);\n\n\t\tpathOrUri = Uri.parse(pathOrUri, true);\n\t}\n\n\treturn normalizePath(pathOrUri.scheme === Schemes.File ? pathOrUri.fsPath : pathOrUri.path);\n}\n\nexport function getScheme(path: string): string | undefined {\n\treturn hasSchemeRegex.exec(path)?.[1];\n}\n\nexport function isChild(path: string, base: string | Uri): boolean;\nexport function isChild(uri: Uri, base: string | Uri): boolean;\nexport function isChild(pathOrUri: string | Uri, base: string | Uri): boolean {\n\tif (typeof base === 'string') {\n\t\tif (base.charCodeAt(0) !== slash) {\n\t\t\tbase = `/${base}`;\n\t\t}\n\n\t\treturn (\n\t\t\tisDescendent(pathOrUri, base) &&\n\t\t\t(typeof pathOrUri === 'string' ? pathOrUri : pathOrUri.path)\n\t\t\t\t.substr(base.length + (base.charCodeAt(base.length - 1) === slash ? 0 : 1))\n\t\t\t\t.split('/').length === 1\n\t\t);\n\t}\n\n\treturn (\n\t\tisDescendent(pathOrUri, base) &&\n\t\t(typeof pathOrUri === 'string' ? pathOrUri : pathOrUri.path)\n\t\t\t.substr(base.path.length + (base.path.charCodeAt(base.path.length - 1) === slash ? 0 : 1))\n\t\t\t.split('/').length === 1\n\t);\n}\n\nexport function isDescendent(path: string, base: string | Uri): boolean;\nexport function isDescendent(uri: Uri, base: string | Uri): boolean;\nexport function isDescendent(pathOrUri: string | Uri, base: string | Uri): boolean;\nexport function isDescendent(pathOrUri: string | Uri, base: string | Uri): boolean {\n\tif (typeof base === 'string') {\n\t\tbase = normalizePath(base);\n\t\tif (base.charCodeAt(0) !== slash) {\n\t\t\tbase = `/${base}`;\n\t\t}\n\t}\n\n\tif (typeof pathOrUri === 'string') {\n\t\tpathOrUri = normalizePath(pathOrUri);\n\t\tif (pathOrUri.charCodeAt(0) !== slash) {\n\t\t\tpathOrUri = `/${pathOrUri}`;\n\t\t}\n\t}\n\n\tif (typeof base === 'string') {\n\t\treturn (\n\t\t\tbase.length === 1 ||\n\t\t\t(typeof pathOrUri === 'string' ? pathOrUri : pathOrUri.path).startsWith(\n\t\t\t\tbase.charCodeAt(base.length - 1) === slash ? base : `${base}/`,\n\t\t\t)\n\t\t);\n\t}\n\n\tif (typeof pathOrUri === 'string') {\n\t\treturn (\n\t\t\tbase.path.length === 1 ||\n\t\t\tpathOrUri.startsWith(base.path.charCodeAt(base.path.length - 1) === slash ? base.path : `${base.path}/`)\n\t\t);\n\t}\n\n\treturn (\n\t\tbase.scheme === pathOrUri.scheme &&\n\t\tbase.authority === pathOrUri.authority &&\n\t\t(base.path.length === 1 ||\n\t\t\tpathOrUri.path.startsWith(\n\t\t\t\tbase.path.charCodeAt(base.path.length - 1) === slash ? base.path : `${base.path}/`,\n\t\t\t))\n\t);\n}\n\nexport function isAbsolute(path: string): boolean {\n\treturn !maybeUri(path) && _isAbsolute(path);\n}\n\nexport function isFolderGlob(path: string): boolean {\n\treturn basename(path) === '*';\n}\n\nexport function maybeUri(path: string): boolean {\n\treturn hasSchemeRegex.test(path);\n}\n\nexport function normalizePath(path: string): string {\n\tif (!path) return path;\n\n\tpath = path.replace(pathNormalizeRegex, '/');\n\tif (path.charCodeAt(path.length - 1) === slash) {\n\t\tpath = path.slice(0, -1);\n\t}\n\n\tif (isWindows) {\n\t\t// Ensure that drive casing is normalized (lower case)\n\t\tpath = path.replace(driveLetterNormalizeRegex, d => d.toLowerCase());\n\t}\n\n\treturn path;\n}\n\nexport function relative(from: string, to: string, ignoreCase?: boolean): string {\n\tfrom = hasSchemeRegex.test(from) ? Uri.parse(from, true).path : normalizePath(from);\n\tto = hasSchemeRegex.test(to) ? Uri.parse(to, true).path : normalizePath(to);\n\n\tconst index = commonBaseIndex(`${to}/`, `${from}/`, '/', ignoreCase);\n\treturn index > 0 ? to.substring(index + 1) : to;\n}\n\nexport function relativeDir(relativePath: string, relativeTo?: string): string {\n\tconst dirPath = dirname(relativePath);\n\tif (!dirPath || dirPath === '.' || dirPath === relativeTo) return '';\n\tif (!relativeTo) return dirPath;\n\n\tconst [relativeDirPath] = splitPath(dirPath, relativeTo);\n\treturn relativeDirPath;\n}\n\nexport function splitPath(\n\tpathOrUri: string | Uri,\n\trepoPath: string | undefined,\n\tsplitOnBaseIfMissing: boolean = false,\n\tignoreCase?: boolean,\n): [string, string] {\n\tpathOrUri = getBestPath(pathOrUri);\n\n\tif (repoPath) {\n\t\tlet repoUri;\n\t\tif (hasSchemeRegex.test(repoPath)) {\n\t\t\trepoUri = Uri.parse(repoPath, true);\n\t\t\trepoPath = getBestPath(repoUri);\n\t\t} else {\n\t\t\trepoPath = normalizePath(repoPath);\n\t\t}\n\n\t\tconst index = commonBaseIndex(`${repoPath}/`, `${pathOrUri}/`, '/', ignoreCase);\n\t\tif (index > 0) {\n\t\t\trepoPath = pathOrUri.substring(0, index);\n\t\t\tpathOrUri = pathOrUri.substring(index + 1);\n\t\t} else if (pathOrUri.charCodeAt(0) === slash) {\n\t\t\tpathOrUri = pathOrUri.slice(1);\n\t\t}\n\n\t\tif (repoUri != null) {\n\t\t\trepoPath = repoUri.with({ path: repoPath }).toString();\n\t\t}\n\t} else {\n\t\trepoPath = normalizePath(splitOnBaseIfMissing ? dirname(pathOrUri) : '');\n\t\tpathOrUri = splitOnBaseIfMissing ? basename(pathOrUri) : pathOrUri;\n\t}\n\n\treturn [pathOrUri, repoPath];\n}\n","import { CancellationToken, Disposable } from 'vscode';\nimport { map } from './iterable';\n\nexport type PromiseOrValue<T> = Promise<T> | T;\n\nexport function any<T>(...promises: Promise<T>[]): Promise<T> {\n\treturn new Promise<T>((resolve, reject) => {\n\t\tconst errors: Error[] = [];\n\t\tlet settled = false;\n\n\t\tfor (const promise of promises) {\n\t\t\t// eslint-disable-next-line no-loop-func\n\t\t\tvoid (async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst result = await promise;\n\t\t\t\t\tif (settled) return;\n\n\t\t\t\t\tresolve(result);\n\t\t\t\t\tsettled = true;\n\t\t\t\t} catch (ex) {\n\t\t\t\t\terrors.push(ex);\n\t\t\t\t} finally {\n\t\t\t\t\tif (!settled) {\n\t\t\t\t\t\tif (promises.length - errors.length < 1) {\n\t\t\t\t\t\t\treject(new AggregateError(errors));\n\t\t\t\t\t\t\tsettled = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\t});\n}\n\nexport class PromiseCancelledError<T extends Promise<any> = Promise<any>> extends Error {\n\tconstructor(public readonly promise: T, message: string) {\n\t\tsuper(message);\n\t}\n}\n\nexport class PromiseCancelledErrorWithId<TKey, T extends Promise<any> = Promise<any>> extends PromiseCancelledError<T> {\n\tconstructor(public readonly id: TKey, promise: T, message: string) {\n\t\tsuper(promise, message);\n\t}\n}\n\nexport function cancellable<T>(\n\tpromise: Promise<T>,\n\ttimeoutOrToken?: number | CancellationToken,\n\toptions: {\n\t\tcancelMessage?: string;\n\t\tonDidCancel?(resolve: (value: T | PromiseLike<T>) => void, reject: (reason?: any) => void): void;\n\t} = {},\n): Promise<T> {\n\tif (timeoutOrToken == null || (typeof timeoutOrToken === 'number' && timeoutOrToken <= 0)) return promise;\n\n\treturn new Promise((resolve, reject) => {\n\t\tlet fulfilled = false;\n\t\tlet timer: ReturnType<typeof setTimeout> | undefined;\n\t\tlet disposable: Disposable | undefined;\n\n\t\tif (typeof timeoutOrToken === 'number') {\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tif (typeof options.onDidCancel === 'function') {\n\t\t\t\t\toptions.onDidCancel(resolve, reject);\n\t\t\t\t} else {\n\t\t\t\t\treject(new PromiseCancelledError(promise, options.cancelMessage ?? 'TIMED OUT'));\n\t\t\t\t}\n\t\t\t}, timeoutOrToken);\n\t\t} else {\n\t\t\tdisposable = timeoutOrToken.onCancellationRequested(() => {\n\t\t\t\tdisposable?.dispose();\n\t\t\t\tif (fulfilled) return;\n\n\t\t\t\tif (typeof options.onDidCancel === 'function') {\n\t\t\t\t\toptions.onDidCancel(resolve, reject);\n\t\t\t\t} else {\n\t\t\t\t\treject(new PromiseCancelledError(promise, options.cancelMessage ?? 'CANCELLED'));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tpromise.then(\n\t\t\t() => {\n\t\t\t\tfulfilled = true;\n\t\t\t\tif (timer != null) {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t}\n\t\t\t\tdisposable?.dispose();\n\t\t\t\tresolve(promise);\n\t\t\t},\n\t\t\tex => {\n\t\t\t\tfulfilled = true;\n\t\t\t\tif (timer != null) {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t}\n\t\t\t\tdisposable?.dispose();\n\t\t\t\treject(ex);\n\t\t\t},\n\t\t);\n\t});\n}\n\nexport interface Deferred<T> {\n\tpromise: Promise<T>;\n\tfulfill: (value: T) => void;\n\tcancel(): void;\n}\n\nexport function defer<T>(): Deferred<T> {\n\tconst deferred: Deferred<T> = { promise: undefined!, fulfill: undefined!, cancel: undefined! };\n\tdeferred.promise = new Promise((resolve, reject) => {\n\t\tdeferred.fulfill = resolve;\n\t\tdeferred.cancel = reject;\n\t});\n\treturn deferred;\n}\n\nexport function isPromise<T>(obj: PromiseLike<T> | T): obj is Promise<T> {\n\treturn obj instanceof Promise || typeof (obj as PromiseLike<T>)?.then === 'function';\n}\n\nexport function progress<T>(promise: Promise<T>, intervalMs: number, onProgress: () => boolean): Promise<T> {\n\treturn new Promise((resolve, reject) => {\n\t\tlet timer: ReturnType<typeof setInterval> | undefined;\n\t\ttimer = setInterval(() => {\n\t\t\tif (onProgress()) {\n\t\t\t\tif (timer != null) {\n\t\t\t\t\tclearInterval(timer);\n\t\t\t\t\ttimer = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}, intervalMs);\n\n\t\tpromise.then(\n\t\t\t() => {\n\t\t\t\tif (timer != null) {\n\t\t\t\t\tclearInterval(timer);\n\t\t\t\t\ttimer = undefined;\n\t\t\t\t}\n\n\t\t\t\tresolve(promise);\n\t\t\t},\n\t\t\tex => {\n\t\t\t\tif (timer != null) {\n\t\t\t\t\tclearInterval(timer);\n\t\t\t\t\ttimer = undefined;\n\t\t\t\t}\n\n\t\t\t\treject(ex);\n\t\t\t},\n\t\t);\n\t});\n}\n\nexport function raceAll<TPromise>(\n\tpromises: Promise<TPromise>[],\n\ttimeout?: number,\n): Promise<(TPromise | PromiseCancelledError<Promise<TPromise>>)[]>;\nexport function raceAll<TPromise, T>(\n\tpromises: Map<T, Promise<TPromise>>,\n\ttimeout?: number,\n): Promise<Map<T, TPromise | PromiseCancelledErrorWithId<T, Promise<TPromise>>>>;\nexport function raceAll<TPromise, T>(\n\tids: Iterable<T>,\n\tfn: (id: T) => Promise<TPromise>,\n\ttimeout?: number,\n): Promise<Map<T, TPromise | PromiseCancelledErrorWithId<T, Promise<TPromise>>>>;\nexport async function raceAll<TPromise, T>(\n\tpromisesOrIds: Promise<TPromise>[] | Map<T, Promise<TPromise>> | Iterable<T>,\n\ttimeoutOrFn?: number | ((id: T) => Promise<TPromise>),\n\ttimeout?: number,\n) {\n\tlet promises;\n\tif (timeoutOrFn != null && typeof timeoutOrFn !== 'number') {\n\t\tpromises = new Map(map<T, [T, Promise<TPromise>]>(promisesOrIds as Iterable<T>, id => [id, timeoutOrFn(id)]));\n\t} else {\n\t\ttimeout = timeoutOrFn;\n\t\tpromises = promisesOrIds as Promise<TPromise>[] | Map<T, Promise<TPromise>>;\n\t}\n\n\tif (promises instanceof Map) {\n\t\treturn new Map(\n\t\t\tawait Promise.all(\n\t\t\t\tmap<[T, Promise<TPromise>], Promise<[T, TPromise | PromiseCancelledErrorWithId<T, Promise<TPromise>>]>>(\n\t\t\t\t\tpromises.entries(),\n\t\t\t\t\ttimeout == null\n\t\t\t\t\t\t? ([id, promise]) => promise.then(p => [id, p])\n\t\t\t\t\t\t: ([id, promise]) =>\n\t\t\t\t\t\t\t\tPromise.race([\n\t\t\t\t\t\t\t\t\tpromise,\n\n\t\t\t\t\t\t\t\t\tnew Promise<PromiseCancelledErrorWithId<T, Promise<TPromise>>>(resolve =>\n\t\t\t\t\t\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t\t\t\t\t\t() => resolve(new PromiseCancelledErrorWithId(id, promise, 'TIMED OUT')),\n\t\t\t\t\t\t\t\t\t\t\ttimeout,\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t]).then(p => [id, p]),\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t}\n\n\treturn Promise.all(\n\t\ttimeout == null\n\t\t\t? promises\n\t\t\t: promises.map(p =>\n\t\t\t\t\tPromise.race([\n\t\t\t\t\t\tp,\n\t\t\t\t\t\tnew Promise<PromiseCancelledError<Promise<TPromise>>>(resolve =>\n\t\t\t\t\t\t\tsetTimeout(() => resolve(new PromiseCancelledError(p, 'TIMED OUT')), timeout),\n\t\t\t\t\t\t),\n\t\t\t\t\t]),\n\t\t\t  ),\n\t);\n}\n\nexport async function wait(ms: number): Promise<void> {\n\tawait new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport class AggregateError extends Error {\n\tconstructor(readonly errors: Error[]) {\n\t\tsuper(`AggregateError(${errors.length})\\n${errors.map(e => `\\t${String(e)}`).join('\\n')}`);\n\n\t\tError.captureStackTrace?.(this, AggregateError);\n\t}\n}\n","import { hrtime } from '@env/hrtime';\nimport { GlyphChars } from '../constants';\nimport { LogCorrelationContext, Logger, LogLevel } from '../logger';\nimport { getNextCorrelationId } from '../system/decorators/log';\n\ntype StopwatchLogOptions = { message?: string; suffix?: string };\ntype StopwatchOptions = {\n\tlog?: boolean | StopwatchLogOptions;\n\tlogLevel?: StopwatchLogLevel;\n};\ntype StopwatchLogLevel = Exclude<LogLevel, LogLevel.Off>;\n\nexport class Stopwatch {\n\tprivate readonly instance = `[${String(getNextCorrelationId()).padStart(5)}] `;\n\tprivate readonly logLevel: StopwatchLogLevel;\n\tprivate time: [number, number];\n\n\tconstructor(public readonly context: string | LogCorrelationContext, options?: StopwatchOptions, ...params: any[]) {\n\t\tlet cc;\n\t\tif (typeof context !== 'string') {\n\t\t\tcc = context;\n\t\t\tcontext = '';\n\t\t\tthis.instance = '';\n\t\t}\n\n\t\tlet logOptions: StopwatchLogOptions | undefined;\n\t\tif (typeof options?.log === 'boolean') {\n\t\t\tlogOptions = options.log ? {} : undefined;\n\t\t} else {\n\t\t\tlogOptions = options?.log ?? {};\n\t\t}\n\n\t\tthis.logLevel = options?.logLevel ?? LogLevel.Info;\n\t\tthis.time = hrtime();\n\n\t\tif (logOptions != null) {\n\t\t\tif (!Logger.enabled(this.logLevel)) return;\n\n\t\t\tif (params.length) {\n\t\t\t\tlog(\n\t\t\t\t\tthis.logLevel,\n\t\t\t\t\tcc,\n\t\t\t\t\t`${this.instance}${context}${logOptions.message ?? ''}${logOptions.suffix ?? ''}`,\n\t\t\t\t\t...params,\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tlog(\n\t\t\t\t\tthis.logLevel,\n\t\t\t\t\tcc,\n\t\t\t\t\t`${this.instance}${context}${logOptions.message ?? ''}${logOptions.suffix ?? ''}`,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tlog(options?: StopwatchLogOptions): void {\n\t\tthis.logCore(this.context, options, false);\n\t}\n\n\trestart(options?: StopwatchLogOptions): void {\n\t\tthis.logCore(this.context, options, true);\n\t\tthis.time = hrtime();\n\t}\n\n\tstop(options?: StopwatchLogOptions): void {\n\t\tthis.restart(options);\n\t}\n\n\tprivate logCore(\n\t\tcontext: string | LogCorrelationContext,\n\t\toptions: StopwatchLogOptions | undefined,\n\t\tlogTotalElapsed: boolean,\n\t): void {\n\t\tif (!Logger.enabled(this.logLevel)) return;\n\n\t\tlet cc;\n\t\tif (typeof context !== 'string') {\n\t\t\tcc = context;\n\t\t\tcontext = '';\n\t\t}\n\n\t\tif (!logTotalElapsed) {\n\t\t\tlog(this.logLevel, cc, `${this.instance}${context}${options?.message ?? ''}${options?.suffix ?? ''}`);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst [secs, nanosecs] = hrtime(this.time);\n\t\tconst ms = secs * 1000 + Math.floor(nanosecs / 1000000);\n\n\t\tconst prefix = `${this.instance}${context}${options?.message ?? ''}`;\n\t\tlog(\n\t\t\tms > 250 ? LogLevel.Warn : this.logLevel,\n\t\t\tcc,\n\t\t\t`${prefix ? `${prefix} ${GlyphChars.Dot} ` : ''}${ms} ms${options?.suffix ?? ''}`,\n\t\t);\n\t}\n\n\tprivate static readonly watches = new Map<string, Stopwatch>();\n\n\tstatic start(key: string, options?: StopwatchOptions, ...params: any[]): void {\n\t\tStopwatch.watches.get(key)?.log();\n\t\tStopwatch.watches.set(key, new Stopwatch(key, options, ...params));\n\t}\n\n\tstatic log(key: string, options?: StopwatchLogOptions): void {\n\t\tStopwatch.watches.get(key)?.log(options);\n\t}\n\n\tstatic stop(key: string, options?: StopwatchLogOptions): void {\n\t\tStopwatch.watches.get(key)?.stop(options);\n\t\tStopwatch.watches.delete(key);\n\t}\n}\n\nfunction log(logLevel: StopwatchLogLevel, cc: LogCorrelationContext | undefined, message: string, ...params: any[]) {\n\tswitch (logLevel) {\n\t\tcase LogLevel.Error:\n\t\t\tLogger.error('', cc, message, ...params);\n\t\t\tbreak;\n\t\tcase LogLevel.Warn:\n\t\t\tLogger.warn(cc, message, ...params);\n\t\t\tbreak;\n\t\tcase LogLevel.Info:\n\t\t\tLogger.log(cc, message, ...params);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tLogger.debug(cc, message, ...params);\n\t\t\tbreak;\n\t}\n}\n","export default function ansiRegex({onlyFirst = false} = {}) {\n\tconst pattern = [\n\t    '[\\\\u001B\\\\u009B][[\\\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\\\d\\\\/#&.:=?%@~_]+)*|[a-zA-Z\\\\d]+(?:;[-a-zA-Z\\\\d\\\\/#&.:=?%@~_]*)*)?\\\\u0007)',\n\t\t'(?:(?:\\\\d{1,4}(?:;\\\\d{0,4})*)?[\\\\dA-PR-TZcf-ntqry=><~]))'\n\t].join('|');\n\n\treturn new RegExp(pattern, onlyFirst ? undefined : 'g');\n}\n","export function base64(s: string): string;\nexport function base64(bytes: Uint8Array): string;\nexport function base64(data: string | Uint8Array): string {\n\treturn Buffer.from(data).toString('base64');\n}\n\nexport function fromBase64(s: string): Uint8Array {\n\treturn Buffer.from(s, 'base64');\n}\n","import ansiRegex from 'ansi-regex';\nimport { md5 as _md5 } from '@env/crypto';\nimport { hrtime } from '@env/hrtime';\nimport { CharCode } from '../constants';\n\nexport { fromBase64, base64 } from '@env/base64';\n\nconst compareCollator = new Intl.Collator(undefined, { sensitivity: 'accent' });\nexport function compareIgnoreCase(a: string, b: string): 0 | -1 | 1 {\n\tconst result = compareCollator.compare(a, b);\n\t// Intl.Collator.compare isn't guaranteed to always return 1 or -1 on all platforms so normalize it\n\treturn result === 0 ? 0 : result > 0 ? 1 : -1;\n}\n\nexport function equalsIgnoreCase(a: string | null | undefined, b: string | null | undefined): boolean {\n\t// Treat `null` & `undefined` as equivalent\n\tif (a == null && b == null) return true;\n\tif (a == null || b == null) return false;\n\treturn compareIgnoreCase(a, b) === 0;\n}\n\nexport const sortCollator = new Intl.Collator(undefined, { numeric: true, sensitivity: 'base' });\nexport const sortCompare = sortCollator.compare;\n\nexport function compareSubstring(\n\ta: string,\n\tb: string,\n\taStart: number = 0,\n\taEnd: number = a.length,\n\tbStart: number = 0,\n\tbEnd: number = b.length,\n): number {\n\tfor (; aStart < aEnd && bStart < bEnd; aStart++, bStart++) {\n\t\tconst codeA = a.charCodeAt(aStart);\n\t\tconst codeB = b.charCodeAt(bStart);\n\t\tif (codeA < codeB) {\n\t\t\treturn -1;\n\t\t} else if (codeA > codeB) {\n\t\t\treturn 1;\n\t\t}\n\t}\n\tconst aLen = aEnd - aStart;\n\tconst bLen = bEnd - bStart;\n\tif (aLen < bLen) {\n\t\treturn -1;\n\t} else if (aLen > bLen) {\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nexport function compareSubstringIgnoreCase(\n\ta: string,\n\tb: string,\n\taStart: number = 0,\n\taEnd: number = a.length,\n\tbStart: number = 0,\n\tbEnd: number = b.length,\n): number {\n\tfor (; aStart < aEnd && bStart < bEnd; aStart++, bStart++) {\n\t\tconst codeA = a.charCodeAt(aStart);\n\t\tconst codeB = b.charCodeAt(bStart);\n\n\t\tif (codeA === codeB) {\n\t\t\t// equal\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst diff = codeA - codeB;\n\t\tif (diff === 32 && isUpperAsciiLetter(codeB)) {\n\t\t\t//codeB =[65-90] && codeA =[97-122]\n\t\t\tcontinue;\n\t\t} else if (diff === -32 && isUpperAsciiLetter(codeA)) {\n\t\t\t//codeB =[97-122] && codeA =[65-90]\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (isLowerAsciiLetter(codeA) && isLowerAsciiLetter(codeB)) {\n\t\t\t//\n\t\t\treturn diff;\n\t\t}\n\t\treturn compareSubstring(a.toLowerCase(), b.toLowerCase(), aStart, aEnd, bStart, bEnd);\n\t}\n\n\tconst aLen = aEnd - aStart;\n\tconst bLen = bEnd - bStart;\n\n\tif (aLen < bLen) {\n\t\treturn -1;\n\t} else if (aLen > bLen) {\n\t\treturn 1;\n\t}\n\n\treturn 0;\n}\n\nconst escapeMarkdownRegex = /[\\\\`*_{}[\\]()#+\\-.!]/g;\nconst escapeMarkdownHeaderRegex = /^===/gm;\n// const sampleMarkdown = '## message `not code` *not important* _no underline_ \\n> don\\'t quote me \\n- don\\'t list me \\n+ don\\'t list me \\n1. don\\'t list me \\nnot h1 \\n=== \\nnot h2 \\n---\\n***\\n---\\n___';\nconst markdownQuotedRegex = /\\n/g;\n\nexport function escapeMarkdown(s: string, options: { quoted?: boolean } = {}): string {\n\ts = s\n\t\t// Escape markdown\n\t\t.replace(escapeMarkdownRegex, '\\\\$&')\n\t\t// Escape markdown header (since the above regex won't match it)\n\t\t.replace(escapeMarkdownHeaderRegex, '\\u200b===');\n\n\tif (!options.quoted) return s;\n\n\t// Keep under the same block-quote but with line breaks\n\treturn s.replace(markdownQuotedRegex, '\\t\\n>  ');\n}\n\nexport function escapeRegex(s: string) {\n\treturn s.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&');\n}\n\nexport function getDurationMilliseconds(start: [number, number]) {\n\tconst [secs, nanosecs] = hrtime(start);\n\treturn secs * 1000 + Math.floor(nanosecs / 1000000);\n}\n\nexport function* getLines(s: string, char: string = '\\n'): IterableIterator<string> {\n\tlet i = 0;\n\twhile (i < s.length) {\n\t\tlet j = s.indexOf(char, i);\n\t\tif (j === -1) {\n\t\t\tj = s.length;\n\t\t}\n\n\t\tyield s.substring(i, j);\n\t\ti = j + 1;\n\t}\n}\n\nconst superscripts = ['\\u00B9', '\\u00B2', '\\u00B3', '\\u2074', '\\u2075', '\\u2076', '\\u2077', '\\u2078', '\\u2079'];\n\nexport function getSuperscript(num: number) {\n\treturn superscripts[num - 1] ?? '';\n}\n\nconst tokenRegex = /\\$\\{('.*?[^\\\\]'|\\W*)?([^|]*?)(?:\\|(\\d+)(-|\\?)?)?('.*?[^\\\\]'|\\W*)?\\}/g;\nconst tokenSanitizeRegex = /\\$\\{(?:'.*?[^\\\\]'|\\W*)?(\\w*?)(?:'.*?[^\\\\]'|[\\W\\d]*)\\}/g;\nconst tokenGroupCharacter = \"'\";\nconst tokenGroupCharacterEscapedRegex = /(\\\\')/g;\nconst tokenGroupRegex = /^'?(.*?)'?$/;\n\nexport interface TokenOptions {\n\tcollapseWhitespace: boolean;\n\tpadDirection: 'left' | 'right';\n\tprefix: string | undefined;\n\tsuffix: string | undefined;\n\ttruncateTo: number | undefined;\n}\n\nexport function getTokensFromTemplate(template: string) {\n\tconst tokens: { key: string; options: TokenOptions }[] = [];\n\n\tlet match;\n\tdo {\n\t\tmatch = tokenRegex.exec(template);\n\t\tif (match == null) break;\n\n\t\tlet [, prefix, key, truncateTo, option, suffix] = match;\n\t\t// Check for a prefix group\n\t\tif (prefix != null) {\n\t\t\tmatch = tokenGroupRegex.exec(prefix);\n\t\t\tif (match != null) {\n\t\t\t\t[, prefix] = match;\n\t\t\t\tprefix = prefix.replace(tokenGroupCharacterEscapedRegex, tokenGroupCharacter);\n\t\t\t}\n\t\t}\n\n\t\t// Check for a suffix group\n\t\tif (suffix != null) {\n\t\t\tmatch = tokenGroupRegex.exec(suffix);\n\t\t\tif (match != null) {\n\t\t\t\t[, suffix] = match;\n\t\t\t\tsuffix = suffix.replace(tokenGroupCharacterEscapedRegex, tokenGroupCharacter);\n\t\t\t}\n\t\t}\n\n\t\ttokens.push({\n\t\t\tkey: key,\n\t\t\toptions: {\n\t\t\t\tcollapseWhitespace: option === '?',\n\t\t\t\tpadDirection: option === '-' ? 'left' : 'right',\n\t\t\t\tprefix: prefix || undefined,\n\t\t\t\tsuffix: suffix || undefined,\n\t\t\t\ttruncateTo: truncateTo == null ? undefined : parseInt(truncateTo, 10),\n\t\t\t},\n\t\t});\n\t} while (true);\n\n\treturn tokens;\n}\n\nconst tokenSanitizeReplacement = `$\\${$1=this.$1,($1 == null ? '' : $1)}`;\nconst interpolationMap = new Map<string, Function>();\n\nexport function interpolate(template: string, context: object | undefined): string {\n\tif (template == null || template.length === 0) return template;\n\tif (context == null) return template.replace(tokenSanitizeRegex, '');\n\n\tlet fn = interpolationMap.get(template);\n\tif (fn == null) {\n\t\t// eslint-disable-next-line @typescript-eslint/no-implied-eval\n\t\tfn = new Function(`return \\`${template.replace(tokenSanitizeRegex, tokenSanitizeReplacement)}\\`;`);\n\t\tinterpolationMap.set(template, fn);\n\t}\n\n\treturn fn.call(context);\n}\n\n// eslint-disable-next-line prefer-arrow-callback\nconst AsyncFunction = Object.getPrototypeOf(async function () {\n\t/* noop */\n}).constructor;\n\nconst tokenSanitizeReplacementAsync = `$\\${$1=this.$1,($1 == null ? '' : typeof $1.then === 'function' ? (($1 = await $1),$1 == null ? '' : $1) : $1)}`;\n\nconst interpolationAsyncMap = new Map<string, typeof AsyncFunction>();\n\nexport async function interpolateAsync(template: string, context: object | undefined): Promise<string> {\n\tif (template == null || template.length === 0) return template;\n\tif (context == null) return template.replace(tokenSanitizeRegex, '');\n\n\tlet fn = interpolationAsyncMap.get(template);\n\tif (fn == null) {\n\t\t// // eslint-disable-next-line @typescript-eslint/no-implied-eval\n\t\tconst body = `return \\`${template.replace(tokenSanitizeRegex, tokenSanitizeReplacementAsync)}\\`;`;\n\t\tfn = new AsyncFunction(body);\n\t\tinterpolationAsyncMap.set(template, fn);\n\t}\n\n\tconst value = await fn.call(context);\n\treturn value;\n}\n\nexport function isLowerAsciiLetter(code: number): boolean {\n\treturn code >= CharCode.a && code <= CharCode.z;\n}\n\nexport function isUpperAsciiLetter(code: number): boolean {\n\treturn code >= CharCode.A && code <= CharCode.Z;\n}\n\nexport function md5(s: string, encoding: 'base64' | 'hex' = 'base64'): string {\n\treturn _md5(s, encoding);\n}\n\nexport function pad(s: string, before: number = 0, after: number = 0, padding: string = '\\u00a0') {\n\tif (before === 0 && after === 0) return s;\n\n\treturn `${before === 0 ? '' : padding.repeat(before)}${s}${after === 0 ? '' : padding.repeat(after)}`;\n}\n\nexport function padLeft(s: string, padTo: number, padding: string = '\\u00a0', width?: number) {\n\tconst diff = padTo - (width ?? getWidth(s));\n\treturn diff <= 0 ? s : padding.repeat(diff) + s;\n}\n\nexport function padLeftOrTruncate(s: string, max: number, padding?: string, width?: number) {\n\twidth = width ?? getWidth(s);\n\tif (width < max) return padLeft(s, max, padding, width);\n\tif (width > max) return truncate(s, max, undefined, width);\n\treturn s;\n}\n\nexport function padRight(s: string, padTo: number, padding: string = '\\u00a0', width?: number) {\n\tconst diff = padTo - (width ?? getWidth(s));\n\treturn diff <= 0 ? s : s + padding.repeat(diff);\n}\n\nexport function padOrTruncate(s: string, max: number, padding?: string, width?: number) {\n\tconst left = max < 0;\n\tmax = Math.abs(max);\n\n\twidth = width ?? getWidth(s);\n\tif (width < max) return left ? padLeft(s, max, padding, width) : padRight(s, max, padding, width);\n\tif (width > max) return truncate(s, max, undefined, width);\n\treturn s;\n}\n\nexport function padRightOrTruncate(s: string, max: number, padding?: string, width?: number) {\n\twidth = width ?? getWidth(s);\n\tif (width < max) return padRight(s, max, padding, width);\n\tif (width > max) return truncate(s, max);\n\treturn s;\n}\n\nexport function pluralize(\n\ts: string,\n\tcount: number,\n\toptions?: {\n\t\t/** Controls the character/string between the count and the string */\n\t\tinfix?: string;\n\t\t/** Formats the count */\n\t\tformat?: (count: number) => string | undefined;\n\t\t/** Controls if only the string should be included */\n\t\tonly?: boolean;\n\t\t/** Controls the plural version of the string */\n\t\tplural?: string;\n\t\t/** Controls the string for a zero value */\n\t\tzero?: string;\n\t},\n) {\n\tif (options == null) return `${count} ${s}${count === 1 ? '' : 's'}`;\n\n\tconst suffix = count === 1 ? s : options.plural ?? `${s}s`;\n\tif (options.only) return suffix;\n\n\treturn `${count === 0 ? options.zero ?? count : options.format?.(count) ?? count}${options.infix ?? ' '}${suffix}`;\n}\n\n// Removes \\ / : * ? \" < > | and C0 and C1 control codes\n// eslint-disable-next-line no-control-regex\nconst illegalCharsForFSRegex = /[\\\\/:*?\"<>|\\x00-\\x1f\\x80-\\x9f]/g;\n\nexport function sanitizeForFileSystem(s: string, replacement: string = '_') {\n\tif (!s) return s;\n\treturn s.replace(illegalCharsForFSRegex, replacement);\n}\n\nexport function splitLast(s: string, splitter: string) {\n\tconst index = s.lastIndexOf(splitter);\n\tif (index === -1) return [s];\n\n\treturn [s.substr(index), s.substring(0, index - 1)];\n}\n\nexport function splitSingle(s: string, splitter: string) {\n\tconst parts = s.split(splitter, 1);\n\tconst first = parts[0];\n\treturn first.length === s.length ? parts : [first, s.substr(first.length + 1)];\n}\n\nexport function truncate(s: string, truncateTo: number, ellipsis: string = '\\u2026', width?: number) {\n\tif (!s) return s;\n\tif (truncateTo <= 1) return ellipsis;\n\n\twidth = width ?? getWidth(s);\n\tif (width <= truncateTo) return s;\n\tif (width === s.length) return `${s.substring(0, truncateTo - 1)}${ellipsis}`;\n\n\t// Skip ahead to start as far as we can by assuming all the double-width characters won't be truncated\n\tlet chars = Math.floor(truncateTo / (width / s.length));\n\tlet count = getWidth(s.substring(0, chars));\n\twhile (count < truncateTo) {\n\t\tcount += getWidth(s[chars++]);\n\t}\n\n\tif (count >= truncateTo) {\n\t\tchars--;\n\t}\n\n\treturn `${s.substring(0, chars)}${ellipsis}`;\n}\n\nexport function truncateLeft(s: string, truncateTo: number, ellipsis: string = '\\u2026', width?: number) {\n\tif (!s) return s;\n\tif (truncateTo <= 1) return ellipsis;\n\n\twidth = width ?? getWidth(s);\n\tif (width <= truncateTo) return s;\n\tif (width === s.length) return `${ellipsis}${s.substring(width - truncateTo)}`;\n\n\t// Skip ahead to start as far as we can by assuming all the double-width characters won't be truncated\n\tlet chars = Math.floor(truncateTo / (width / s.length));\n\tlet count = getWidth(s.substring(0, chars));\n\twhile (count < truncateTo) {\n\t\tcount += getWidth(s[chars++]);\n\t}\n\n\tif (count >= truncateTo) {\n\t\tchars--;\n\t}\n\n\treturn `${ellipsis}${s.substring(s.length - chars)}`;\n}\n\nexport function truncateMiddle(s: string, truncateTo: number, ellipsis: string = '\\u2026') {\n\tif (!s) return s;\n\tif (truncateTo <= 1) return ellipsis;\n\n\tconst width = getWidth(s);\n\tif (width <= truncateTo) return s;\n\n\treturn `${s.slice(0, Math.floor(truncateTo / 2) - 1)}${ellipsis}${s.slice(width - Math.ceil(truncateTo / 2))}`;\n}\n\nlet cachedAnsiRegex: RegExp | undefined;\nconst containsNonAsciiRegex = /[^\\x20-\\x7F\\u00a0\\u2026]/;\n\n// See sindresorhus/string-width\nexport function getWidth(s: string): number {\n\tif (s == null || s.length === 0) return 0;\n\n\t// Shortcut to avoid needless string `RegExp`s, replacements, and allocations\n\tif (!containsNonAsciiRegex.test(s)) return s.length;\n\n\tif (cachedAnsiRegex == null) {\n\t\tcachedAnsiRegex = ansiRegex();\n\t}\n\ts = s.replace(cachedAnsiRegex, '');\n\n\tlet count = 0;\n\tlet emoji = 0;\n\tlet joiners = 0;\n\n\tconst graphemes = [...s];\n\tfor (let i = 0; i < graphemes.length; i++) {\n\t\tconst code = graphemes[i].codePointAt(0)!;\n\n\t\t// Ignore control characters\n\t\tif (code <= 0x1f || (code >= 0x7f && code <= 0x9f)) continue;\n\n\t\t// Ignore combining characters\n\t\tif (code >= 0x300 && code <= 0x36f) continue;\n\n\t\tif (\n\t\t\t(code >= 0x1f600 && code <= 0x1f64f) || // Emoticons\n\t\t\t(code >= 0x1f300 && code <= 0x1f5ff) || // Misc Symbols and Pictographs\n\t\t\t(code >= 0x1f680 && code <= 0x1f6ff) || // Transport and Map\n\t\t\t(code >= 0x2600 && code <= 0x26ff) || // Misc symbols\n\t\t\t(code >= 0x2700 && code <= 0x27bf) || // Dingbats\n\t\t\t(code >= 0xfe00 && code <= 0xfe0f) || // Variation Selectors\n\t\t\t(code >= 0x1f900 && code <= 0x1f9ff) || // Supplemental Symbols and Pictographs\n\t\t\t(code >= 65024 && code <= 65039) || // Variation selector\n\t\t\t(code >= 8400 && code <= 8447) // Combining Diacritical Marks for Symbols\n\t\t) {\n\t\t\tif (code >= 0x1f3fb && code <= 0x1f3ff) continue; // emoji modifier fitzpatrick type\n\n\t\t\temoji++;\n\t\t\tcount += 2;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Ignore zero-width joiners '\\u200d'\n\t\tif (code === 8205) {\n\t\t\tjoiners++;\n\t\t\tcount -= 2;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Surrogates\n\t\tif (code > 0xffff) {\n\t\t\ti++;\n\t\t}\n\n\t\tcount += isFullwidthCodePoint(code) ? 2 : 1;\n\t}\n\n\tconst offset = emoji - joiners;\n\tif (offset > 1) {\n\t\tcount += offset - 1;\n\t}\n\treturn count;\n}\n\n// See sindresorhus/is-fullwidth-code-point\nfunction isFullwidthCodePoint(cp: number) {\n\t// code points are derived from:\n\t// http://www.unix.org/Public/UNIDATA/EastAsianWidth.txt\n\tif (\n\t\tcp >= 0x1100 &&\n\t\t(cp <= 0x115f || // Hangul Jamo\n\t\t\tcp === 0x2329 || // LEFT-POINTING ANGLE BRACKET\n\t\t\tcp === 0x232a || // RIGHT-POINTING ANGLE BRACKET\n\t\t\t// CJK Radicals Supplement .. Enclosed CJK Letters and Months\n\t\t\t(cp >= 0x2e80 && cp <= 0x3247 && cp !== 0x303f) ||\n\t\t\t// Enclosed CJK Letters and Months .. CJK Unified Ideographs Extension A\n\t\t\t(cp >= 0x3250 && cp <= 0x4dbf) ||\n\t\t\t// CJK Unified Ideographs .. Yi Radicals\n\t\t\t(cp >= 0x4e00 && cp <= 0xa4c6) ||\n\t\t\t// Hangul Jamo Extended-A\n\t\t\t(cp >= 0xa960 && cp <= 0xa97c) ||\n\t\t\t// Hangul Syllables\n\t\t\t(cp >= 0xac00 && cp <= 0xd7a3) ||\n\t\t\t// CJK Compatibility Ideographs\n\t\t\t(cp >= 0xf900 && cp <= 0xfaff) ||\n\t\t\t// Vertical Forms\n\t\t\t(cp >= 0xfe10 && cp <= 0xfe19) ||\n\t\t\t// CJK Compatibility Forms .. Small Form Variants\n\t\t\t(cp >= 0xfe30 && cp <= 0xfe6b) ||\n\t\t\t// Halfwidth and Fullwidth Forms\n\t\t\t(cp >= 0xff01 && cp <= 0xff60) ||\n\t\t\t(cp >= 0xffe0 && cp <= 0xffe6) ||\n\t\t\t// Kana Supplement\n\t\t\t(cp >= 0x1b000 && cp <= 0x1b001) ||\n\t\t\t// Enclosed Ideographic Supplement\n\t\t\t(cp >= 0x1f200 && cp <= 0x1f251) ||\n\t\t\t// CJK Unified Ideographs Extension B .. Tertiary Ideographic Plane\n\t\t\t(cp >= 0x20000 && cp <= 0x3fffd))\n\t) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n","import { Uri } from 'vscode';\nimport { isLinux } from '@env/platform';\nimport { Schemes } from '../constants';\nimport { filterMap } from './iterable';\nimport { normalizePath as _normalizePath } from './path';\n// TODO@eamodio don't import from string here since it will break the tests because of ESM dependencies\n// import { CharCode } from './string';\n\nconst slash = 47; //CharCode.Slash;\n\nfunction normalizeUri(uri: Uri): { path: string; ignoreCase: boolean } {\n\tlet path;\n\tswitch (uri.scheme.toLowerCase()) {\n\t\tcase Schemes.File:\n\t\t\tpath = normalizePath(uri.fsPath);\n\t\t\treturn { path: path, ignoreCase: !isLinux };\n\n\t\tcase Schemes.Git:\n\t\t\tpath = normalizePath(uri.fsPath);\n\t\t\t// TODO@eamodio parse the ref out of the query\n\t\t\treturn { path: path, ignoreCase: !isLinux };\n\n\t\tcase Schemes.GitLens:\n\t\t\tpath = uri.path;\n\t\t\tif (path.charCodeAt(path.length - 1) === slash) {\n\t\t\t\tpath = path.slice(0, -1);\n\t\t\t}\n\n\t\t\tif (!isLinux) {\n\t\t\t\tpath = path.toLowerCase();\n\t\t\t}\n\n\t\t\treturn { path: uri.authority ? `${uri.authority}${path}` : path.slice(1), ignoreCase: false };\n\n\t\tcase Schemes.Virtual:\n\t\tcase Schemes.GitHub:\n\t\t\tpath = uri.path;\n\t\t\tif (path.charCodeAt(path.length - 1) === slash) {\n\t\t\t\tpath = path.slice(0, -1);\n\t\t\t}\n\t\t\treturn { path: uri.authority ? `${uri.authority}${path}` : path.slice(1), ignoreCase: false };\n\n\t\tdefault:\n\t\t\tpath = uri.path;\n\t\t\tif (path.charCodeAt(path.length - 1) === slash) {\n\t\t\t\tpath = path.slice(0, -1);\n\t\t\t}\n\t\t\treturn { path: path.slice(1), ignoreCase: false };\n\t}\n}\n\nfunction normalizePath(path: string): string {\n\tpath = _normalizePath(path);\n\tif (path.charCodeAt(0) === slash) {\n\t\tpath = path.slice(1);\n\t}\n\n\treturn path;\n}\n\nexport type UriEntry<T> = PathEntry<T>;\n\nexport class UriEntryTrie<T> {\n\tprivate readonly trie: PathEntryTrie<T>;\n\n\tconstructor(private readonly normalize: (uri: Uri) => { path: string; ignoreCase: boolean } = normalizeUri) {\n\t\tthis.trie = new PathEntryTrie<T>();\n\t}\n\n\tclear(): void {\n\t\tthis.trie.clear();\n\t}\n\n\tdelete(uri: Uri): boolean {\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.delete(path, ignoreCase);\n\t}\n\n\tget(uri: Uri): UriEntry<T> | undefined {\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.get(path, ignoreCase);\n\t}\n\n\tgetChildren(uri: Uri): UriEntry<T>[] {\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.getChildren(path, ignoreCase);\n\t}\n\n\tgetClosest(uri: Uri, excludeSelf?: boolean, predicate?: (value: T) => boolean): UriEntry<T> | undefined {\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.getClosest(path, excludeSelf, predicate, ignoreCase);\n\t}\n\n\tgetDescendants(uri?: Uri, predicate?: (value: T) => boolean): Generator<UriEntry<T>> {\n\t\tif (uri == null) return this.trie.getDescendants();\n\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.getDescendants(path, predicate, ignoreCase);\n\t}\n\n\thas(uri: Uri): boolean {\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.has(path, ignoreCase);\n\t}\n\n\tset(uri: Uri, value: T): boolean {\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.set(path, value, ignoreCase);\n\t}\n}\n\nexport class UriTrie<T> {\n\tprivate readonly trie: PathTrie<T>;\n\n\tconstructor(private readonly normalize: (uri: Uri) => { path: string; ignoreCase: boolean } = normalizeUri) {\n\t\tthis.trie = new PathTrie<T>();\n\t}\n\n\tclear(): void {\n\t\tthis.trie.clear();\n\t}\n\n\tdelete(uri: Uri): boolean {\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.delete(path, ignoreCase);\n\t}\n\n\tget(uri: Uri): T | undefined {\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.get(path, ignoreCase);\n\t}\n\n\tgetChildren(uri: Uri): T[] {\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.getChildren(path, ignoreCase);\n\t}\n\n\tgetClosest(uri: Uri, excludeSelf?: boolean, predicate?: (value: T) => boolean): T | undefined {\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.getClosest(path, excludeSelf, predicate, ignoreCase);\n\t}\n\n\tgetDescendants(uri?: Uri, predicate?: (value: T) => boolean): Generator<T> {\n\t\tif (uri == null) return this.trie.getDescendants();\n\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.getDescendants(path, predicate, ignoreCase);\n\t}\n\n\thas(uri: Uri): boolean {\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.has(path, ignoreCase);\n\t}\n\n\tset(uri: Uri, value: T): boolean {\n\t\tconst { path, ignoreCase } = this.normalize(uri);\n\t\treturn this.trie.set(path, value, ignoreCase);\n\t}\n}\n\nexport interface PathEntry<T> {\n\tvalue: T;\n\tpath: string;\n\tfullPath: string;\n}\n\nclass PathNode<T> {\n\tvalue: T | undefined;\n\tchildren: Map<string, PathNode<T>> | undefined;\n\n\tconstructor(public readonly path: string) {}\n}\n\nexport class PathEntryTrie<T> {\n\tprivate root: PathNode<T>;\n\n\tconstructor(private readonly normalize: (path: string) => string = normalizePath) {\n\t\tthis.root = new PathNode<T>('');\n\t}\n\n\tclear(): void {\n\t\tthis.root.children = undefined;\n\t}\n\n\tdelete(path: string, ignoreCase?: boolean): boolean {\n\t\tpath = this.normalize(path);\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet node: PathNode<T> | undefined;\n\t\tlet parent: PathNode<T> | undefined;\n\n\t\tfor (const segment of path.split('/')) {\n\t\t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t\t\tif (n == null) return false;\n\n\t\t\tparent = node ?? this.root;\n\t\t\tnode = n;\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\tif (!node?.value) return false;\n\n\t\tnode.value = undefined;\n\t\tif ((node.children == null || node.children.size === 0) && parent?.children != null) {\n\t\t\tparent.children.delete(ignoreCase ? node.path.toLowerCase() : node.path);\n\t\t\tif (parent.children.size === 0) {\n\t\t\t\tparent.children = undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tget(path: string, ignoreCase?: boolean): PathEntry<T> | undefined {\n\t\treturn this.getCore(path, ignoreCase);\n\t}\n\n\tprivate getCore(path: string, ignoreCase?: boolean): PathEntry<T> | undefined;\n\tprivate getCore(path: string, ignoreCase: boolean | undefined, existenceOnly: true): boolean;\n\tprivate getCore(\n\t\tpath: string,\n\t\tignoreCase: boolean | undefined,\n\t\texistenceOnly?: boolean,\n\t): (PathEntry<T> | undefined) | boolean {\n\t\tpath = this.normalize(path);\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet fullPath = '';\n\t\tlet node: PathNode<T> | undefined;\n\n\t\tfor (const segment of path.split('/')) {\n\t\t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t\t\tif (n == null) return existenceOnly ? false : undefined;\n\n\t\t\tnode = n;\n\t\t\tif (!existenceOnly) {\n\t\t\t\tfullPath += `${n.path}/`;\n\t\t\t}\n\t\t}\n\n\t\t// Avoids allocations & garbage on `has` calls\n\t\tif (existenceOnly) return node?.value != null;\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\tif (!node?.value) return undefined;\n\n\t\treturn {\n\t\t\tvalue: node.value,\n\t\t\tpath: node.path,\n\t\t\tfullPath: fullPath.slice(0, -1),\n\t\t};\n\t}\n\n\tgetChildren(path: string, ignoreCase?: boolean): PathEntry<T>[] {\n\t\tpath = this.normalize(path);\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet fullPath = '';\n\t\tlet node: PathNode<T> | undefined;\n\n\t\tif (path) {\n\t\t\tfor (const segment of path.split('/')) {\n\t\t\t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t\t\t\tif (n == null) return [];\n\n\t\t\t\tnode = n;\n\t\t\t\tfullPath += `${n.path}/`;\n\t\t\t}\n\t\t} else {\n\t\t\tnode = this.root;\n\t\t}\n\n\t\tif (node?.children == null) return [];\n\t\treturn [\n\t\t\t...filterMap(node.children.values(), n =>\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\t\t\tn.value ? { value: n.value, path: n.path, fullPath: fullPath } : undefined,\n\t\t\t),\n\t\t];\n\t}\n\n\tgetClosest(\n\t\tpath: string,\n\t\texcludeSelf?: boolean,\n\t\tpredicate?: (value: T) => boolean,\n\t\tignoreCase?: boolean,\n\t): PathEntry<T> | undefined {\n\t\tpath = this.normalize(path);\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet fullPath = '';\n\t\tlet fullAncestorPath!: string;\n\t\tlet node: PathNode<T> | undefined;\n\t\tlet ancestor: PathNode<T> | undefined;\n\n\t\tfor (const segment of path.split('/')) {\n\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\t\tif (node?.value && (!predicate || predicate?.(node.value))) {\n\t\t\t\tancestor = node;\n\t\t\t\tfullAncestorPath = fullPath;\n\t\t\t}\n\n\t\t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t\t\tif (n == null) break;\n\n\t\t\tnode = n;\n\t\t\tfullPath += `${n.path}/`;\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\tif (!excludeSelf && node?.value && (!predicate || predicate?.(node.value))) {\n\t\t\treturn { value: node.value, path: node.path, fullPath: fullPath.slice(0, -1) };\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\treturn ancestor?.value\n\t\t\t? { value: ancestor.value, path: ancestor.path, fullPath: fullAncestorPath.slice(0, -1) }\n\t\t\t: undefined;\n\t}\n\n\t// getAncestors(\n\t// \tpath: string,\n\t// \tpredicate?: (value: T) => boolean,\n\t// \tignoreCase?: boolean,\n\t// \texcludeSelf?: boolean,\n\t// ): PathEntry<T>[] {\n\t// \tpath = this.normalize(path);\n\t// \tignoreCase = ignoreCase ?? !isLinux;\n\n\t// \tconst ancestors: PathEntry<T>[] = [];\n\n\t// \tlet fullPath = '';\n\t// \tlet node: PathNode<T> | undefined;\n\n\t// \tfor (const segment of path.split('/')) {\n\t// \t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t// \t\tif (node?.value && (!predicate || predicate?.(node.value))) {\n\t// \t\t\tancestors.push({ value: node.value, path: node.path, fullPath: fullPath.slice(0, -1) });\n\t// \t\t}\n\n\t// \t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t// \t\tif (n == null) break;\n\n\t// \t\tnode = n;\n\t// \t\tfullPath += `${n.path}/`;\n\t// \t}\n\n\t// \t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t// \tif (!excludeSelf && node?.value && (!predicate || predicate?.(node.value))) {\n\t// \t\tancestors.push({ value: node.value, path: node.path, fullPath: fullPath.slice(0, -1) });\n\t// \t}\n\n\t// \treturn ancestors.reverse();\n\t// }\n\n\t*getDescendants(path?: string, predicate?: (value: T) => boolean, ignoreCase?: boolean): Generator<PathEntry<T>> {\n\t\tpath = path ? this.normalize(path) : '';\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet fullPath = '';\n\t\tlet node: PathNode<T> | undefined;\n\n\t\tif (path) {\n\t\t\tfor (const segment of path.split('/')) {\n\t\t\t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t\t\t\tif (n == null) return;\n\n\t\t\t\tnode = n;\n\t\t\t\tfullPath += `${n.path}/`;\n\t\t\t}\n\t\t} else {\n\t\t\tnode = this.root;\n\t\t}\n\n\t\tif (node?.children == null) return;\n\n\t\tfunction* getDescendantsCore(\n\t\t\tchildren: NonNullable<PathNode<T>['children']>,\n\t\t\tpath: string,\n\t\t\tfullPath: string,\n\t\t): Generator<PathEntry<T>> {\n\t\t\tfor (const node of children.values()) {\n\t\t\t\tconst relativePath = path ? `${path}/${node.path}` : node.path;\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\t\t\tif (node.value && (!predicate || predicate?.(node.value))) {\n\t\t\t\t\tyield {\n\t\t\t\t\t\tvalue: node.value,\n\t\t\t\t\t\tpath: relativePath,\n\t\t\t\t\t\tfullPath: fullPath ? `${fullPath}/${relativePath}` : relativePath,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (node.children != null) {\n\t\t\t\t\tyield* getDescendantsCore(node.children, relativePath, fullPath);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tyield* getDescendantsCore(node.children, '', fullPath);\n\t}\n\n\thas(path: string, ignoreCase?: boolean): boolean {\n\t\treturn this.getCore(path, ignoreCase, true);\n\t}\n\n\tset(path: string, value: T, ignoreCase?: boolean): boolean {\n\t\tpath = this.normalize(path);\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet node = this.root;\n\n\t\tfor (const segment of path.split('/')) {\n\t\t\tconst key = ignoreCase ? segment.toLowerCase() : segment;\n\n\t\t\tlet n = node.children?.get(key);\n\t\t\tif (n == null) {\n\t\t\t\tif (node.children == null) {\n\t\t\t\t\tnode.children = new Map<string, PathNode<T>>();\n\t\t\t\t}\n\n\t\t\t\tn = new PathNode(segment);\n\t\t\t\tnode.children.set(key, n);\n\t\t\t}\n\n\t\t\tnode = n;\n\t\t}\n\n\t\tconst added = node.value == null;\n\t\tnode.value = value;\n\t\treturn added;\n\t}\n}\n\nexport class PathTrie<T> {\n\tprivate root: PathNode<T>;\n\n\tconstructor(private readonly normalize: (path: string) => string = normalizePath) {\n\t\tthis.root = new PathNode<T>('');\n\t}\n\n\tclear(): void {\n\t\tthis.root.children = undefined;\n\t}\n\n\tdelete(path: string, ignoreCase?: boolean): boolean {\n\t\tpath = this.normalize(path);\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet node: PathNode<T> | undefined;\n\t\tlet parent: PathNode<T> | undefined;\n\n\t\tfor (const segment of path.split('/')) {\n\t\t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t\t\tif (n == null) return false;\n\n\t\t\tparent = node ?? this.root;\n\t\t\tnode = n;\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\tif (!node?.value) return false;\n\n\t\tnode.value = undefined;\n\t\tif ((node.children == null || node.children.size === 0) && parent?.children != null) {\n\t\t\tparent.children.delete(ignoreCase ? node.path.toLowerCase() : node.path);\n\t\t\tif (parent.children.size === 0) {\n\t\t\t\tparent.children = undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tget(path: string, ignoreCase?: boolean): T | undefined {\n\t\treturn this.getCore(path, ignoreCase);\n\t}\n\n\tprivate getCore(path: string, ignoreCase?: boolean): T | undefined {\n\t\tpath = this.normalize(path);\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet node: PathNode<T> | undefined;\n\n\t\tfor (const segment of path.split('/')) {\n\t\t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t\t\tif (n == null) return undefined;\n\n\t\t\tnode = n;\n\t\t}\n\n\t\treturn node?.value;\n\t}\n\n\tgetChildren(path: string, ignoreCase?: boolean): T[] {\n\t\tpath = this.normalize(path);\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet node: PathNode<T> | undefined;\n\n\t\tif (path) {\n\t\t\tfor (const segment of path.split('/')) {\n\t\t\t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t\t\t\tif (n == null) return [];\n\n\t\t\t\tnode = n;\n\t\t\t}\n\t\t} else {\n\t\t\tnode = this.root;\n\t\t}\n\n\t\tif (node?.children == null) return [];\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\treturn [...filterMap(node.children.values(), n => n.value || undefined)];\n\t}\n\n\tgetClosest(\n\t\tpath: string,\n\t\texcludeSelf?: boolean,\n\t\tpredicate?: (value: T) => boolean,\n\t\tignoreCase?: boolean,\n\t): T | undefined {\n\t\tpath = this.normalize(path);\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet node: PathNode<T> | undefined;\n\t\tlet ancestor: PathNode<T> | undefined;\n\n\t\tfor (const segment of path.split('/')) {\n\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\t\tif (node?.value && (!predicate || predicate?.(node.value))) {\n\t\t\t\tancestor = node;\n\t\t\t}\n\n\t\t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t\t\tif (n == null) break;\n\n\t\t\tnode = n;\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\tif (!excludeSelf && node?.value && (!predicate || predicate?.(node.value))) {\n\t\t\treturn node.value;\n\t\t}\n\n\t\treturn ancestor?.value;\n\t}\n\n\t*getDescendants(path?: string, predicate?: (value: T) => boolean, ignoreCase?: boolean): Generator<T> {\n\t\tpath = path ? this.normalize(path) : '';\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet fullPath = '';\n\t\tlet node: PathNode<T> | undefined;\n\n\t\tif (path) {\n\t\t\tfor (const segment of path.split('/')) {\n\t\t\t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t\t\t\tif (n == null) return;\n\n\t\t\t\tnode = n;\n\t\t\t\tfullPath += `${n.path}/`;\n\t\t\t}\n\t\t} else {\n\t\t\tnode = this.root;\n\t\t}\n\n\t\tif (node?.children == null) return;\n\n\t\tfunction* getDescendantsCore(\n\t\t\tchildren: NonNullable<PathNode<T>['children']>,\n\t\t\tpath: string,\n\t\t\tfullPath: string,\n\t\t): Generator<T> {\n\t\t\tfor (const node of children.values()) {\n\t\t\t\tconst relativePath = path ? `${path}/${node.path}` : node.path;\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\t\t\tif (node.value && (!predicate || predicate?.(node.value))) {\n\t\t\t\t\tyield node.value;\n\t\t\t\t}\n\n\t\t\t\tif (node.children != null) {\n\t\t\t\t\tyield* getDescendantsCore(node.children, relativePath, fullPath);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tyield* getDescendantsCore(node.children, '', fullPath);\n\t}\n\n\thas(path: string, ignoreCase?: boolean): boolean {\n\t\treturn this.getCore(path, ignoreCase) != null;\n\t}\n\n\tset(path: string, value: T, ignoreCase?: boolean): boolean {\n\t\tpath = this.normalize(path);\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet node = this.root;\n\n\t\tfor (const segment of path.split('/')) {\n\t\t\tconst key = ignoreCase ? segment.toLowerCase() : segment;\n\n\t\t\tlet n = node.children?.get(key);\n\t\t\tif (n == null) {\n\t\t\t\tif (node.children == null) {\n\t\t\t\t\tnode.children = new Map<string, PathNode<T>>();\n\t\t\t\t}\n\n\t\t\t\tn = new PathNode(segment);\n\t\t\t\tnode.children.set(key, n);\n\t\t\t}\n\n\t\t\tnode = n;\n\t\t}\n\n\t\tconst added = node.value == null;\n\t\tnode.value = value;\n\t\treturn added;\n\t}\n}\n\nclass VisitedPathNode {\n\tchildren: Map<string, VisitedPathNode> | undefined;\n\n\tconstructor(public readonly path: string) {}\n}\n\nexport class VisitedPathsTrie {\n\tprivate root: VisitedPathNode;\n\n\tconstructor(private readonly normalize: (path: string) => string = normalizePath) {\n\t\tthis.root = new VisitedPathNode('');\n\t}\n\n\tclear(): void {\n\t\tthis.root.children = undefined;\n\t}\n\n\t// delete(path: string, ignoreCase?: boolean): boolean {\n\t// \tpath = this.normalize(path);\n\t// \tignoreCase = ignoreCase ?? !isLinux;\n\n\t// \tlet node: SeenPathNode | undefined;\n\t// \tlet parent: SeenPathNode | undefined;\n\n\t// \tfor (const segment of path.split('/')) {\n\t// \t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t// \t\tif (n == null) return false;\n\n\t// \t\tparent = node ?? this.root;\n\t// \t\tnode = n;\n\t// \t}\n\n\t// \tif (node == null) return false;\n\n\t// \tif ((node.children == null || node.children.size === 0) && parent?.children != null) {\n\t// \t\tparent.children.delete(ignoreCase ? node.path.toLowerCase() : node.path);\n\t// \t\tif (parent.children.size === 0) {\n\t// \t\t\tparent.children = undefined;\n\t// \t\t}\n\t// \t}\n\n\t// \treturn true;\n\t// }\n\n\t// getClosest(path: string, excludeSelf?: boolean, ignoreCase?: boolean): string | undefined {\n\t// \tpath = this.normalize(path);\n\t// \tignoreCase = ignoreCase ?? !isLinux;\n\n\t// \tlet fullPath = '';\n\t// \tlet fullAncestorPath!: string;\n\t// \tlet node: SeenPathNode | undefined;\n\t// \tlet ancestor: SeenPathNode | undefined;\n\n\t// \tfor (const segment of path.split('/')) {\n\t// \t\tancestor = node;\n\t// \t\tfullAncestorPath = fullPath;\n\n\t// \t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t// \t\tif (n == null) break;\n\n\t// \t\tnode = n;\n\t// \t\tfullPath += `${n.path}/`;\n\t// \t}\n\n\t// \tif (!excludeSelf && node != null) return fullPath.slice(0, -1);\n\t// \treturn ancestor != null ? fullAncestorPath.slice(0, -1) : undefined;\n\t// }\n\n\thas(path: string, ignoreCase?: boolean): boolean {\n\t\tpath = this.normalize(path);\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet node: VisitedPathNode | undefined;\n\n\t\tfor (const segment of path.split('/')) {\n\t\t\tconst n = (node ?? this.root).children?.get(ignoreCase ? segment.toLowerCase() : segment);\n\t\t\tif (n == null) return false;\n\n\t\t\tnode = n;\n\t\t}\n\n\t\treturn node != null;\n\t}\n\n\tset(path: string, ignoreCase?: boolean): void {\n\t\tpath = this.normalize(path);\n\t\tignoreCase = ignoreCase ?? !isLinux;\n\n\t\tlet node = this.root;\n\n\t\tfor (const segment of path.split('/')) {\n\t\t\tconst key = ignoreCase ? segment.toLowerCase() : segment;\n\n\t\t\tlet n = node.children?.get(key);\n\t\t\tif (n == null) {\n\t\t\t\tif (node.children == null) {\n\t\t\t\t\tnode.children = new Map<string, VisitedPathNode>();\n\t\t\t\t}\n\n\t\t\t\tn = new VisitedPathNode(segment);\n\t\t\t\tnode.children.set(key, n);\n\t\t\t}\n\n\t\t\tnode = n;\n\t\t}\n\t}\n}\n","import { TextDocument, TextDocumentShowOptions, TextEditor, Uri, ViewColumn, window, workspace } from 'vscode';\nimport { configuration } from '../configuration';\nimport { CoreCommands, ImageMimetypes, Schemes } from '../constants';\nimport { GitUri } from '../git/gitUri';\nimport { Logger } from '../logger';\nimport { executeCoreCommand } from './command';\nimport { extname } from './path';\n\nexport function findEditor(uri: Uri): TextEditor | undefined {\n\tconst active = window.activeTextEditor;\n\tconst normalizedUri = uri.toString();\n\n\tfor (const e of [...(active != null ? [active] : []), ...window.visibleTextEditors]) {\n\t\t// Don't include diff editors\n\t\tif (e.document.uri.toString() === normalizedUri && e?.viewColumn != null) {\n\t\t\treturn e;\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\nexport async function findOrOpenEditor(\n\turi: Uri,\n\toptions?: TextDocumentShowOptions & { throwOnError?: boolean },\n): Promise<TextEditor | undefined> {\n\tconst e = findEditor(uri);\n\tif (e != null) {\n\t\tif (!options?.preserveFocus) {\n\t\t\tawait window.showTextDocument(e.document, { ...options, viewColumn: e.viewColumn });\n\t\t}\n\n\t\treturn e;\n\t}\n\n\treturn openEditor(uri, { viewColumn: window.activeTextEditor?.viewColumn, ...options });\n}\n\nexport function findOrOpenEditors(uris: Uri[]): void {\n\tconst normalizedUris = new Map(uris.map(uri => [uri.toString(), uri]));\n\n\tfor (const e of window.visibleTextEditors) {\n\t\t// Don't include diff editors\n\t\tif (e?.viewColumn != null) {\n\t\t\tnormalizedUris.delete(e.document.uri.toString());\n\t\t}\n\t}\n\n\tfor (const uri of normalizedUris.values()) {\n\t\tvoid executeCoreCommand(CoreCommands.Open, uri, { background: true, preview: false });\n\t}\n}\n\nexport function getEditorIfActive(document: TextDocument): TextEditor | undefined {\n\tconst editor = window.activeTextEditor;\n\treturn editor != null && editor.document === document ? editor : undefined;\n}\n\nexport function getQuickPickIgnoreFocusOut() {\n\treturn !configuration.get('advanced.quickPick.closeOnFocusOut');\n}\n\nexport function hasVisibleTextEditor(): boolean {\n\tif (window.visibleTextEditors.length === 0) return false;\n\n\treturn window.visibleTextEditors.some(e => isTextEditor(e));\n}\n\nexport function isActiveDocument(document: TextDocument): boolean {\n\tconst editor = window.activeTextEditor;\n\treturn editor != null && editor.document === document;\n}\n\nexport function isVisibleDocument(document: TextDocument): boolean {\n\tif (window.visibleTextEditors.length === 0) return false;\n\n\treturn window.visibleTextEditors.some(e => e.document === document);\n}\n\nexport function isTextEditor(editor: TextEditor): boolean {\n\tconst scheme = editor.document.uri.scheme;\n\treturn scheme !== Schemes.Output && scheme !== Schemes.DebugConsole;\n}\n\nexport async function openEditor(\n\turi: Uri,\n\toptions: TextDocumentShowOptions & { rethrow?: boolean } = {},\n): Promise<TextEditor | undefined> {\n\tconst { rethrow, ...opts } = options;\n\ttry {\n\t\tif (GitUri.is(uri)) {\n\t\t\turi = uri.documentUri();\n\t\t}\n\n\t\tif (uri.scheme === Schemes.GitLens && ImageMimetypes[extname(uri.fsPath)]) {\n\t\t\tawait executeCoreCommand(CoreCommands.Open, uri);\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst document = await workspace.openTextDocument(uri);\n\t\treturn window.showTextDocument(document, {\n\t\t\tpreserveFocus: false,\n\t\t\tpreview: true,\n\t\t\tviewColumn: ViewColumn.Active,\n\t\t\t...opts,\n\t\t});\n\t} catch (ex) {\n\t\tconst msg: string = ex?.toString() ?? '';\n\t\tif (msg.includes('File seems to be binary and cannot be opened as text')) {\n\t\t\tawait executeCoreCommand(CoreCommands.Open, uri);\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (rethrow) throw ex;\n\n\t\tLogger.error(ex, 'openEditor');\n\t\treturn undefined;\n\t}\n}\n\nexport async function openWalkthrough(\n\textensionId: string,\n\twalkthroughId: string,\n\tstepId?: string,\n\topenToSide: boolean = true,\n): Promise<void> {\n\t// Takes the following params: walkthroughID: string | { category: string, step: string } | undefined, toSide: boolean | undefined\n\tvoid (await executeCoreCommand(\n\t\tCoreCommands.OpenWalkthrough,\n\t\t{\n\t\t\tcategory: `${extensionId}#${walkthroughId}`,\n\t\t\tstep: stepId ? `${extensionId}#${walkthroughId}#${stepId}` : undefined,\n\t\t},\n\t\topenToSide,\n\t));\n}\n\nexport const enum OpenWorkspaceLocation {\n\tCurrentWindow = 'currentWindow',\n\tNewWindow = 'newWindow',\n\tAddToWorkspace = 'addToWorkspace',\n}\n\nexport function openWorkspace(\n\turi: Uri,\n\toptions: { location?: OpenWorkspaceLocation; name?: string } = { location: OpenWorkspaceLocation.CurrentWindow },\n): void {\n\tif (options?.location === OpenWorkspaceLocation.AddToWorkspace) {\n\t\tconst count = workspace.workspaceFolders?.length ?? 0;\n\t\treturn void workspace.updateWorkspaceFolders(count, 0, { uri: uri, name: options?.name });\n\t}\n\n\treturn void executeCoreCommand(CoreCommands.OpenFolder, uri, {\n\t\tforceNewWindow: options?.location === OpenWorkspaceLocation.NewWindow,\n\t});\n}\n","import { compareIgnoreCase } from './string';\n\ndeclare type VersionComparisonResult = -1 | 0 | 1;\n\nexport interface Version {\n\tmajor: number;\n\tminor: number;\n\tpatch: number;\n\tpre?: string;\n}\n\nexport function compare(v1: string | Version, v2: string | Version): VersionComparisonResult {\n\tif (typeof v1 === 'string') {\n\t\tv1 = fromString(v1);\n\t}\n\tif (typeof v2 === 'string') {\n\t\tv2 = fromString(v2);\n\t}\n\n\tif (v1.major > v2.major) return 1;\n\tif (v1.major < v2.major) return -1;\n\n\tif (v1.minor > v2.minor) return 1;\n\tif (v1.minor < v2.minor) return -1;\n\n\tif (v1.patch > v2.patch) return 1;\n\tif (v1.patch < v2.patch) return -1;\n\n\tif (v1.pre === undefined && v2.pre !== undefined) return 1;\n\tif (v1.pre !== undefined && v2.pre === undefined) return -1;\n\n\tif (v1.pre !== undefined && v2.pre !== undefined) return compareIgnoreCase(v1.pre, v2.pre);\n\n\treturn 0;\n}\n\nexport function from(major: string | number, minor: string | number, patch?: string | number, pre?: string): Version {\n\treturn {\n\t\tmajor: typeof major === 'string' ? parseInt(major, 10) : major,\n\t\tminor: typeof minor === 'string' ? parseInt(minor, 10) : minor,\n\t\tpatch: patch == null ? 0 : typeof patch === 'string' ? parseInt(patch, 10) : patch,\n\t\tpre: pre,\n\t};\n}\n\nexport function fromString(version: string): Version {\n\tconst [ver, pre] = version.split('-');\n\tconst [major, minor, patch] = ver.split('.');\n\treturn from(major, minor, patch, pre);\n}\n","import { Disposable, Terminal, window } from 'vscode';\nimport { Container } from './container';\n\nlet _terminal: Terminal | undefined;\nlet _terminalCwd: string | undefined;\nlet _disposable: Disposable | undefined;\n\nconst extensionTerminalName = 'GitLens';\n\nfunction ensureTerminal(cwd: string): Terminal {\n\tif (_terminal === undefined) {\n\t\t_terminal = window.createTerminal(extensionTerminalName);\n\t\t_disposable = window.onDidCloseTerminal((e: Terminal) => {\n\t\t\tif (e.name === extensionTerminalName) {\n\t\t\t\t_terminal = undefined;\n\t\t\t\t_disposable!.dispose();\n\t\t\t\t_disposable = undefined;\n\t\t\t}\n\t\t});\n\n\t\tContainer.instance.context.subscriptions.push(_disposable);\n\t\t_terminalCwd = undefined;\n\t}\n\n\tif (_terminalCwd !== cwd) {\n\t\t_terminal.sendText(`cd \"${cwd}\"`, true);\n\t\t_terminalCwd = cwd;\n\t}\n\n\treturn _terminal;\n}\n\nexport function runGitCommandInTerminal(command: string, args: string, cwd: string, execute: boolean = false) {\n\t// let git = Git.getGitPath();\n\t// if (git.includes(' ')) {\n\t//     git = `\"${git}\"`;\n\t// }\n\n\tconst terminal = ensureTerminal(cwd);\n\tterminal.show(false);\n\tterminal.sendText(`git ${command} ${args}`, execute);\n}\n","import { Disposable, Event, EventEmitter, TextDocument, TextEditor } from 'vscode';\nimport { ContextKeys } from '../constants';\nimport { Container } from '../container';\nimport { setContext } from '../context';\nimport { GitUri } from '../git/gitUri';\nimport { GitRevision } from '../git/models';\nimport { Logger } from '../logger';\nimport { debounce, Deferrable } from '../system/function';\nimport { getEditorIfActive, isActiveDocument } from '../system/utils';\n\nexport interface DocumentBlameStateChangeEvent<T> {\n\treadonly editor: TextEditor;\n\treadonly document: TrackedDocument<T>;\n\treadonly blameable: boolean;\n}\n\nexport class TrackedDocument<T> implements Disposable {\n\tstatic async create<T>(\n\t\tdocument: TextDocument,\n\t\tkey: string,\n\t\tdirty: boolean,\n\t\teventDelegates: { onDidBlameStateChange(e: DocumentBlameStateChangeEvent<T>): void },\n\t\tcontainer: Container,\n\t) {\n\t\tconst doc = new TrackedDocument(document, key, dirty, eventDelegates, container);\n\t\tawait doc.initialize();\n\t\treturn doc;\n\t}\n\n\tprivate _onDidBlameStateChange = new EventEmitter<DocumentBlameStateChangeEvent<T>>();\n\tget onDidBlameStateChange(): Event<DocumentBlameStateChangeEvent<T>> {\n\t\treturn this._onDidBlameStateChange.event;\n\t}\n\n\tstate: T | undefined;\n\n\tprivate _disposable: Disposable | undefined;\n\tprivate _disposed: boolean = false;\n\tprivate _uri!: GitUri;\n\n\tprivate constructor(\n\t\treadonly document: TextDocument,\n\t\tpublic readonly key: string,\n\t\tpublic dirty: boolean,\n\t\tprivate _eventDelegates: { onDidBlameStateChange(e: DocumentBlameStateChangeEvent<T>): void },\n\t\tprivate readonly container: Container,\n\t) {}\n\n\tdispose() {\n\t\tthis.state = undefined;\n\n\t\tthis._disposed = true;\n\t\tthis._disposable?.dispose();\n\t}\n\n\tprivate initializing = true;\n\tprivate async initialize(): Promise<void> {\n\t\tconst uri = this.document.uri;\n\n\t\tthis._uri = await GitUri.fromUri(uri);\n\t\tif (!this._disposed) {\n\t\t\tawait this.update();\n\t\t}\n\n\t\tthis.initializing = false;\n\t}\n\n\tprivate _forceDirtyStateChangeOnNextDocumentChange: boolean = false;\n\tget forceDirtyStateChangeOnNextDocumentChange() {\n\t\treturn this._forceDirtyStateChangeOnNextDocumentChange;\n\t}\n\n\tprivate _hasRemotes: boolean = false;\n\tget hasRemotes() {\n\t\treturn this._hasRemotes;\n\t}\n\n\tget isBlameable() {\n\t\treturn this._blameFailed ? false : this._isTracked;\n\t}\n\n\tprivate _isDirtyIdle: boolean = false;\n\tget isDirtyIdle() {\n\t\treturn this._isDirtyIdle;\n\t}\n\tset isDirtyIdle(value: boolean) {\n\t\tthis._isDirtyIdle = value;\n\t}\n\n\tget isRevision() {\n\t\treturn this._uri != null ? Boolean(this._uri.sha) && this._uri.sha !== GitRevision.deletedOrMissing : false;\n\t}\n\n\tprivate _isTracked: boolean = false;\n\tget isTracked() {\n\t\treturn this._isTracked;\n\t}\n\n\tget lineCount(): number {\n\t\treturn this.document.lineCount;\n\t}\n\n\tget uri(): GitUri {\n\t\treturn this._uri;\n\t}\n\n\tasync activate(): Promise<void> {\n\t\tif (this._requiresUpdate) {\n\t\t\tawait this.update();\n\t\t}\n\t\tvoid setContext(ContextKeys.ActiveFileStatus, this.getStatus());\n\t}\n\n\tis(document: TextDocument) {\n\t\treturn document === this.document;\n\t}\n\n\tprivate _updateDebounced:\n\t\t| Deferrable<({ forceBlameChange }?: { forceBlameChange?: boolean | undefined }) => Promise<void>>\n\t\t| undefined;\n\n\treset(reason: 'config' | 'document' | 'repository') {\n\t\tthis._requiresUpdate = true;\n\t\tthis._blameFailed = false;\n\t\tthis._isDirtyIdle = false;\n\n\t\tif (this.state != null) {\n\t\t\tthis.state = undefined;\n\t\t\tLogger.log(`Reset state for '${this.key}', reason=${reason}`);\n\t\t}\n\n\t\tif (reason === 'repository' && isActiveDocument(this.document)) {\n\t\t\tif (this._updateDebounced == null) {\n\t\t\t\tthis._updateDebounced = debounce(this.update.bind(this), 250);\n\t\t\t}\n\n\t\t\tvoid this._updateDebounced();\n\t\t}\n\t}\n\n\tprivate _blameFailed: boolean = false;\n\tsetBlameFailure() {\n\t\tconst wasBlameable = this.isBlameable;\n\n\t\tthis._blameFailed = true;\n\n\t\tif (wasBlameable && isActiveDocument(this.document)) {\n\t\t\tvoid this.update({ forceBlameChange: true });\n\t\t}\n\t}\n\n\tresetForceDirtyStateChangeOnNextDocumentChange() {\n\t\tthis._forceDirtyStateChangeOnNextDocumentChange = false;\n\t}\n\n\tsetForceDirtyStateChangeOnNextDocumentChange() {\n\t\tthis._forceDirtyStateChangeOnNextDocumentChange = true;\n\t}\n\n\tprivate _requiresUpdate: boolean = true;\n\tasync update({ forceBlameChange }: { forceBlameChange?: boolean } = {}) {\n\t\tthis._requiresUpdate = false;\n\n\t\tif (this._disposed || this._uri == null) {\n\t\t\tthis._hasRemotes = false;\n\t\t\tthis._isTracked = false;\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isDirtyIdle = false;\n\n\t\t// Caches these before the awaits\n\t\tconst active = getEditorIfActive(this.document);\n\t\tconst wasBlameable = forceBlameChange ? undefined : this.isBlameable;\n\n\t\tconst repo = this.container.git.getRepository(this._uri);\n\t\tif (repo == null) {\n\t\t\tthis._isTracked = false;\n\t\t\tthis._hasRemotes = false;\n\t\t} else {\n\t\t\tthis._isTracked = true;\n\t\t\tthis._hasRemotes = await repo.hasRemotes();\n\t\t}\n\n\t\tif (active != null) {\n\t\t\tconst blameable = this.isBlameable;\n\n\t\t\tvoid setContext(ContextKeys.ActiveFileStatus, this.getStatus());\n\n\t\t\tif (!this.initializing && wasBlameable !== blameable) {\n\t\t\t\tconst e: DocumentBlameStateChangeEvent<T> = { editor: active, document: this, blameable: blameable };\n\t\t\t\tthis._onDidBlameStateChange.fire(e);\n\t\t\t\tthis._eventDelegates.onDidBlameStateChange(e);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getStatus() {\n\t\tlet status = '';\n\t\tif (this.isTracked) {\n\t\t\tstatus += 'tracked|';\n\t\t}\n\t\tif (this.isBlameable) {\n\t\t\tstatus += 'blameable|';\n\t\t}\n\t\tif (this.isRevision) {\n\t\t\tstatus += 'revision|';\n\t\t}\n\t\tif (this.hasRemotes) {\n\t\t\tstatus += 'remotes|';\n\t\t}\n\n\t\treturn status ? status : undefined;\n\t}\n}\n","import {\n\tConfigurationChangeEvent,\n\tDisposable,\n\tEndOfLine,\n\tEvent,\n\tEventEmitter,\n\tPosition,\n\tRange,\n\tTextDocument,\n\tTextDocumentChangeEvent,\n\tTextDocumentContentChangeEvent,\n\tTextEditor,\n\tTextLine,\n\tUri,\n\twindow,\n\tworkspace,\n} from 'vscode';\nimport { configuration } from '../configuration';\nimport { ContextKeys } from '../constants';\nimport { Container } from '../container';\nimport { setContext } from '../context';\nimport { RepositoriesChangeEvent } from '../git/gitProviderService';\nimport { GitUri } from '../git/gitUri';\nimport { RepositoryChange, RepositoryChangeComparisonMode, RepositoryChangeEvent } from '../git/models';\nimport { once } from '../system/event';\nimport { debounce, Deferrable } from '../system/function';\nimport { filter, map } from '../system/iterable';\nimport { getBestPath } from '../system/path';\nimport { isActiveDocument, isTextEditor } from '../system/utils';\nimport { DocumentBlameStateChangeEvent, TrackedDocument } from './trackedDocument';\n\nexport * from './trackedDocument';\n\nexport interface DocumentContentChangeEvent<T> {\n\treadonly editor: TextEditor;\n\treadonly document: TrackedDocument<T>;\n\treadonly contentChanges: ReadonlyArray<TextDocumentContentChangeEvent>;\n}\n\nexport interface DocumentDirtyStateChangeEvent<T> {\n\treadonly editor: TextEditor;\n\treadonly document: TrackedDocument<T>;\n\treadonly dirty: boolean;\n}\n\nexport interface DocumentDirtyIdleTriggerEvent<T> {\n\treadonly editor: TextEditor;\n\treadonly document: TrackedDocument<T>;\n}\n\nexport class DocumentTracker<T> implements Disposable {\n\tprivate _onDidChangeBlameState = new EventEmitter<DocumentBlameStateChangeEvent<T>>();\n\tget onDidChangeBlameState(): Event<DocumentBlameStateChangeEvent<T>> {\n\t\treturn this._onDidChangeBlameState.event;\n\t}\n\n\tprivate _onDidChangeContent = new EventEmitter<DocumentContentChangeEvent<T>>();\n\tget onDidChangeContent(): Event<DocumentContentChangeEvent<T>> {\n\t\treturn this._onDidChangeContent.event;\n\t}\n\n\tprivate _onDidChangeDirtyState = new EventEmitter<DocumentDirtyStateChangeEvent<T>>();\n\tget onDidChangeDirtyState(): Event<DocumentDirtyStateChangeEvent<T>> {\n\t\treturn this._onDidChangeDirtyState.event;\n\t}\n\n\tprivate _onDidTriggerDirtyIdle = new EventEmitter<DocumentDirtyIdleTriggerEvent<T>>();\n\tget onDidTriggerDirtyIdle(): Event<DocumentDirtyIdleTriggerEvent<T>> {\n\t\treturn this._onDidTriggerDirtyIdle.event;\n\t}\n\n\tprivate _dirtyIdleTriggerDelay: number;\n\tprivate readonly _disposable: Disposable;\n\t// TODO@eamodio: replace with a trie?\n\tprotected readonly _documentMap = new Map<TextDocument | string, Promise<TrackedDocument<T>>>();\n\n\tconstructor(protected readonly container: Container) {\n\t\tthis._disposable = Disposable.from(\n\t\t\tonce(container.onReady)(this.onReady, this),\n\t\t\tconfiguration.onDidChange(this.onConfigurationChanged, this),\n\t\t\twindow.onDidChangeActiveTextEditor(this.onActiveTextEditorChanged, this),\n\t\t\t// window.onDidChangeVisibleTextEditors(debounce(this.onVisibleEditorsChanged, 5000), this),\n\t\t\tworkspace.onDidChangeTextDocument(debounce(this.onTextDocumentChanged, 50), this),\n\t\t\tworkspace.onDidCloseTextDocument(this.onTextDocumentClosed, this),\n\t\t\tworkspace.onDidSaveTextDocument(this.onTextDocumentSaved, this),\n\t\t\tthis.container.git.onDidChangeRepositories(this.onRepositoriesChanged, this),\n\t\t\tthis.container.git.onDidChangeRepository(this.onRepositoryChanged, this),\n\t\t);\n\n\t\tthis._dirtyIdleTriggerDelay = configuration.get('advanced.blame.delayAfterEdit');\n\t}\n\n\tdispose() {\n\t\tthis._disposable.dispose();\n\n\t\tvoid this.clear();\n\t}\n\n\tprivate onReady(): void {\n\t\tthis.onConfigurationChanged();\n\t\tthis.onActiveTextEditorChanged(window.activeTextEditor);\n\t}\n\n\tprivate _timer: ReturnType<typeof setTimeout> | undefined;\n\tprivate onActiveTextEditorChanged(editor: TextEditor | undefined) {\n\t\tif (editor != null && !isTextEditor(editor)) return;\n\n\t\tif (this._timer != null) {\n\t\t\tclearTimeout(this._timer);\n\t\t\tthis._timer = undefined;\n\t\t}\n\n\t\tif (editor == null) {\n\t\t\tthis._timer = setTimeout(() => {\n\t\t\t\tthis._timer = undefined;\n\n\t\t\t\tvoid setContext(ContextKeys.ActiveFileStatus, undefined);\n\t\t\t}, 250);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst doc = this._documentMap.get(editor.document);\n\t\tif (doc != null) {\n\t\t\tvoid doc.then(\n\t\t\t\td => d.activate(),\n\t\t\t\t() => {},\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\t// No need to activate this, as it is implicit in initialization if currently active\n\t\tvoid this.addCore(editor.document);\n\t}\n\n\tprivate onConfigurationChanged(e?: ConfigurationChangeEvent) {\n\t\t// Only rest the cached state if we aren't initializing\n\t\tif (\n\t\t\te != null &&\n\t\t\t(configuration.changed(e, 'blame.ignoreWhitespace') || configuration.changed(e, 'advanced.caching.enabled'))\n\t\t) {\n\t\t\tthis.reset('config');\n\t\t}\n\n\t\tif (configuration.changed(e, 'advanced.blame.delayAfterEdit')) {\n\t\t\tthis._dirtyIdleTriggerDelay = configuration.get('advanced.blame.delayAfterEdit');\n\t\t\tthis._dirtyIdleTriggeredDebounced = undefined;\n\t\t}\n\t}\n\n\tprivate onRepositoriesChanged(e: RepositoriesChangeEvent) {\n\t\tthis.reset(\n\t\t\t'repository',\n\t\t\te.added.length ? new Set<string>(e.added.map(r => r.path)) : undefined,\n\t\t\te.removed.length ? new Set<string>(e.removed.map(r => r.path)) : undefined,\n\t\t);\n\t}\n\n\tprivate onRepositoryChanged(e: RepositoryChangeEvent) {\n\t\tif (\n\t\t\te.changed(\n\t\t\t\tRepositoryChange.Index,\n\t\t\t\tRepositoryChange.Heads,\n\t\t\t\tRepositoryChange.Status,\n\t\t\t\tRepositoryChange.Unknown,\n\t\t\t\tRepositoryChangeComparisonMode.Any,\n\t\t\t)\n\t\t) {\n\t\t\tvoid this.reset('repository', new Set([e.repository.path]));\n\t\t}\n\t}\n\n\tprivate async onTextDocumentChanged(e: TextDocumentChangeEvent) {\n\t\tconst { scheme } = e.document.uri;\n\t\tif (!this.container.git.supportedSchemes.has(scheme)) return;\n\n\t\tconst doc = await (this._documentMap.get(e.document) ?? this.addCore(e.document));\n\t\tdoc.reset('document');\n\n\t\tconst dirty = e.document.isDirty;\n\t\tconst editor = window.activeTextEditor;\n\n\t\t// If we have an idle tracker, either reset or cancel it\n\t\tif (this._dirtyIdleTriggeredDebounced != null) {\n\t\t\tif (dirty) {\n\t\t\t\tthis._dirtyIdleTriggeredDebounced({ editor: editor!, document: doc });\n\t\t\t} else {\n\t\t\t\tthis._dirtyIdleTriggeredDebounced.cancel();\n\t\t\t}\n\t\t}\n\n\t\t// Only fire change events for the active document\n\t\tif (editor?.document === e.document) {\n\t\t\tthis._onDidChangeContent.fire({ editor: editor, document: doc, contentChanges: e.contentChanges });\n\t\t}\n\n\t\tif (!doc.forceDirtyStateChangeOnNextDocumentChange && doc.dirty === dirty) return;\n\n\t\tdoc.resetForceDirtyStateChangeOnNextDocumentChange();\n\t\tdoc.dirty = dirty;\n\n\t\t// Only fire state change events for the active document\n\t\tif (editor == null || editor.document !== e.document) return;\n\n\t\tthis.fireDocumentDirtyStateChanged({ editor: editor, document: doc, dirty: doc.dirty });\n\t}\n\n\tprivate onTextDocumentClosed(document: TextDocument) {\n\t\tvoid this.remove(document);\n\t}\n\n\tprivate async onTextDocumentSaved(document: TextDocument) {\n\t\tconst doc = this._documentMap.get(document);\n\t\tif (doc != null) {\n\t\t\tvoid (await doc).update({ forceBlameChange: true });\n\n\t\t\treturn;\n\t\t}\n\n\t\t// If we are saving the active document make sure we are tracking it\n\t\tif (isActiveDocument(document)) {\n\t\t\tvoid this.addCore(document);\n\t\t}\n\t}\n\n\t// private onVisibleEditorsChanged(editors: TextEditor[]) {\n\t//     if (this._documentMap.size === 0) return;\n\n\t//     // If we have no visible editors, or no \"real\" visible editors reset our cache\n\t//     if (editors.length === 0 || editors.every(e => !isTextEditor(e))) {\n\t//         this.clear();\n\t//     }\n\t// }\n\n\tadd(document: TextDocument): Promise<TrackedDocument<T>>;\n\tadd(uri: Uri): Promise<TrackedDocument<T>>;\n\tadd(documentOrUri: TextDocument | Uri): Promise<TrackedDocument<T>>;\n\tasync add(documentOrUri: TextDocument | Uri): Promise<TrackedDocument<T>> {\n\t\tlet document;\n\t\tif (GitUri.is(documentOrUri)) {\n\t\t\ttry {\n\t\t\t\tdocument = await workspace.openTextDocument(documentOrUri.documentUri());\n\t\t\t} catch (ex) {\n\t\t\t\tconst msg: string = ex?.toString() ?? '';\n\t\t\t\tif (msg.includes('File seems to be binary and cannot be opened as text')) {\n\t\t\t\t\tdocument = new BinaryTextDocument(documentOrUri);\n\t\t\t\t} else if (\n\t\t\t\t\tmsg.includes('File not found') ||\n\t\t\t\t\tmsg.includes('Unable to read file') ||\n\t\t\t\t\tmsg.includes('Unable to resolve non-existing file')\n\t\t\t\t) {\n\t\t\t\t\t// If we can't find the file, assume it is because the file has been renamed or deleted at some point\n\t\t\t\t\tdocument = new MissingRevisionTextDocument(documentOrUri);\n\n\t\t\t\t\t// const [fileName, repoPath] = await this.container.git.findWorkingFileName(documentOrUri, undefined, ref);\n\t\t\t\t\t// if (fileName == null) throw new Error(`Failed to add tracking for document: ${documentOrUri}`);\n\n\t\t\t\t\t// documentOrUri = await workspace.openTextDocument(path.resolve(repoPath!, fileName));\n\t\t\t\t} else {\n\t\t\t\t\tthrow ex;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (documentOrUri instanceof Uri) {\n\t\t\tdocument = await workspace.openTextDocument(documentOrUri);\n\t\t} else {\n\t\t\tdocument = documentOrUri;\n\t\t}\n\n\t\tconst doc = this.addCore(document);\n\t\treturn doc;\n\t}\n\n\tprivate async addCore(document: TextDocument): Promise<TrackedDocument<T>> {\n\t\tconst key = getUriKey(document.uri);\n\n\t\t// Always start out false, so we will fire the event if needed\n\t\tconst doc = TrackedDocument.create<T>(\n\t\t\tdocument,\n\t\t\tkey,\n\t\t\tfalse,\n\t\t\t{\n\t\t\t\tonDidBlameStateChange: (e: DocumentBlameStateChangeEvent<T>) => this._onDidChangeBlameState.fire(e),\n\t\t\t},\n\t\t\tthis.container,\n\t\t);\n\n\t\tthis._documentMap.set(document, doc);\n\t\tthis._documentMap.set(key, doc);\n\n\t\treturn doc;\n\t}\n\n\tasync clear() {\n\t\tfor (const d of this._documentMap.values()) {\n\t\t\t(await d).dispose();\n\t\t}\n\n\t\tthis._documentMap.clear();\n\t}\n\n\tget(document: TextDocument): Promise<TrackedDocument<T>> | undefined;\n\tget(uri: Uri): Promise<TrackedDocument<T>> | undefined;\n\tget(documentOrUri: TextDocument | Uri): Promise<TrackedDocument<T>> | undefined;\n\tget(documentOrUri: TextDocument | Uri): Promise<TrackedDocument<T>> | undefined {\n\t\tlet key;\n\t\tif (GitUri.is(documentOrUri)) {\n\t\t\tkey = getUriKey(documentOrUri.documentUri());\n\t\t} else if (documentOrUri instanceof Uri) {\n\t\t\tkey = getUriKey(documentOrUri);\n\t\t} else {\n\t\t\tkey = documentOrUri;\n\t\t}\n\n\t\tconst doc = this._documentMap.get(key);\n\t\treturn doc;\n\t}\n\n\tgetOrAdd(document: TextDocument): Promise<TrackedDocument<T>>;\n\tgetOrAdd(uri: Uri): Promise<TrackedDocument<T>>;\n\tasync getOrAdd(documentOrUri: TextDocument | Uri): Promise<TrackedDocument<T>> {\n\t\tconst doc = this.get(documentOrUri) ?? this.add(documentOrUri);\n\t\treturn doc;\n\t}\n\n\thas(document: TextDocument): boolean;\n\thas(uri: Uri): boolean;\n\thas(documentOrUri: TextDocument | Uri): boolean {\n\t\tif (documentOrUri instanceof Uri) {\n\t\t\treturn this._documentMap.has(getUriKey(documentOrUri));\n\t\t}\n\t\treturn this._documentMap.has(documentOrUri);\n\t}\n\n\tprivate async remove(document: TextDocument, tracked?: TrackedDocument<T>): Promise<void> {\n\t\tlet promise;\n\t\tif (tracked != null) {\n\t\t\tpromise = this._documentMap.get(document);\n\t\t}\n\n\t\tthis._documentMap.delete(document);\n\t\tthis._documentMap.delete(getUriKey(document.uri));\n\n\t\t(tracked ?? (await promise))?.dispose();\n\t}\n\n\tprivate _dirtyIdleTriggeredDebounced: Deferrable<(e: DocumentDirtyIdleTriggerEvent<T>) => void> | undefined;\n\tprivate _dirtyStateChangedDebounced: Deferrable<(e: DocumentDirtyStateChangeEvent<T>) => void> | undefined;\n\tprivate fireDocumentDirtyStateChanged(e: DocumentDirtyStateChangeEvent<T>) {\n\t\tif (e.dirty) {\n\t\t\tqueueMicrotask(() => {\n\t\t\t\tthis._dirtyStateChangedDebounced?.cancel();\n\t\t\t\tif (window.activeTextEditor !== e.editor) return;\n\n\t\t\t\tthis._onDidChangeDirtyState.fire(e);\n\t\t\t});\n\n\t\t\tif (this._dirtyIdleTriggerDelay > 0) {\n\t\t\t\tif (this._dirtyIdleTriggeredDebounced == null) {\n\t\t\t\t\tthis._dirtyIdleTriggeredDebounced = debounce(\n\t\t\t\t\t\t(e: DocumentDirtyIdleTriggerEvent<T>) => {\n\t\t\t\t\t\t\tif (this._dirtyIdleTriggeredDebounced?.pending!()) return;\n\n\t\t\t\t\t\t\te.document.isDirtyIdle = true;\n\t\t\t\t\t\t\tthis._onDidTriggerDirtyIdle.fire(e);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthis._dirtyIdleTriggerDelay,\n\t\t\t\t\t\t{ track: true },\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis._dirtyIdleTriggeredDebounced({ editor: e.editor, document: e.document });\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._dirtyStateChangedDebounced == null) {\n\t\t\tthis._dirtyStateChangedDebounced = debounce((e: DocumentDirtyStateChangeEvent<T>) => {\n\t\t\t\tif (window.activeTextEditor !== e.editor) return;\n\n\t\t\t\tthis._onDidChangeDirtyState.fire(e);\n\t\t\t}, 250);\n\t\t}\n\n\t\tthis._dirtyStateChangedDebounced(e);\n\t}\n\n\tprivate reset(reason: 'config' | 'repository', changedRepoPaths?: Set<string>, removedRepoPaths?: Set<string>) {\n\t\tvoid Promise.allSettled(\n\t\t\tmap(\n\t\t\t\tfilter(this._documentMap, ([key]) => typeof key === 'string'),\n\t\t\t\tasync ([, promise]) => {\n\t\t\t\t\tconst doc = await promise;\n\t\t\t\t\tif (removedRepoPaths?.has(doc.uri.repoPath!)) {\n\t\t\t\t\t\tvoid this.remove(doc.document, doc);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (changedRepoPaths == null || changedRepoPaths.has(doc.uri.repoPath!)) {\n\t\t\t\t\t\tdoc.reset(reason);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n}\n\nclass EmptyTextDocument implements TextDocument {\n\treadonly eol: EndOfLine;\n\treadonly fileName: string;\n\treadonly isClosed: boolean;\n\treadonly isDirty: boolean;\n\treadonly isUntitled: boolean;\n\treadonly languageId: string;\n\treadonly lineCount: number;\n\treadonly uri: Uri;\n\treadonly version: number;\n\n\tconstructor(public readonly gitUri: GitUri) {\n\t\tthis.uri = gitUri.documentUri();\n\n\t\tthis.eol = EndOfLine.LF;\n\t\tthis.fileName = this.uri.fsPath;\n\t\tthis.isClosed = false;\n\t\tthis.isDirty = false;\n\t\tthis.isUntitled = false;\n\t\tthis.languageId = '';\n\t\tthis.lineCount = 0;\n\t\tthis.version = 0;\n\t}\n\n\tgetText(_range?: Range | undefined): string {\n\t\tthrow new Error('Method not supported.');\n\t}\n\n\tgetWordRangeAtPosition(_position: Position, _regex?: RegExp | undefined): Range | undefined {\n\t\tthrow new Error('Method not supported.');\n\t}\n\n\tlineAt(line: number): TextLine;\n\tlineAt(position: Position): TextLine;\n\tlineAt(_position: any): TextLine {\n\t\tthrow new Error('Method not supported.');\n\t}\n\n\toffsetAt(_position: Position): number {\n\t\tthrow new Error('Method not supported.');\n\t}\n\n\tpositionAt(_offset: number): Position {\n\t\tthrow new Error('Method not supported.');\n\t}\n\n\tsave(): Thenable<boolean> {\n\t\tthrow new Error('Method not supported.');\n\t}\n\n\tvalidatePosition(_position: Position): Position {\n\t\tthrow new Error('Method not supported.');\n\t}\n\n\tvalidateRange(_range: Range): Range {\n\t\tthrow new Error('Method not supported.');\n\t}\n}\n\nclass BinaryTextDocument extends EmptyTextDocument {}\nclass MissingRevisionTextDocument extends EmptyTextDocument {}\n\nfunction getUriKey(pathOrUri: string | Uri): string {\n\treturn getBestPath(pathOrUri);\n}\n","import { TextDocument, Uri } from 'vscode';\nimport { GitBlame, GitDiff, GitLog } from '../git/models';\nimport { DocumentTracker } from './documentTracker';\n\nexport * from './documentTracker';\n\ninterface CachedItem<T> {\n\titem: Promise<T>;\n\terrorMessage?: string;\n}\n\nexport type CachedBlame = CachedItem<GitBlame>;\nexport type CachedDiff = CachedItem<GitDiff>;\nexport type CachedLog = CachedItem<GitLog>;\n\nexport class GitDocumentState {\n\tprivate readonly blameCache = new Map<string, CachedBlame>();\n\tprivate readonly diffCache = new Map<string, CachedDiff>();\n\tprivate readonly logCache = new Map<string, CachedLog>();\n\n\tconstructor(public readonly key: string) {}\n\n\tclearBlame(key?: string): void {\n\t\tif (key == null) {\n\t\t\tthis.blameCache.clear();\n\t\t\treturn;\n\t\t}\n\t\tthis.blameCache.delete(key);\n\t}\n\n\tclearDiff(key?: string): void {\n\t\tif (key == null) {\n\t\t\tthis.diffCache.clear();\n\t\t\treturn;\n\t\t}\n\t\tthis.diffCache.delete(key);\n\t}\n\n\tclearLog(key?: string): void {\n\t\tif (key == null) {\n\t\t\tthis.logCache.clear();\n\t\t\treturn;\n\t\t}\n\t\tthis.logCache.delete(key);\n\t}\n\n\tgetBlame(key: string): CachedBlame | undefined {\n\t\treturn this.blameCache.get(key);\n\t}\n\n\tgetDiff(key: string): CachedDiff | undefined {\n\t\treturn this.diffCache.get(key);\n\t}\n\n\tgetLog(key: string): CachedLog | undefined {\n\t\treturn this.logCache.get(key);\n\t}\n\n\tsetBlame(key: string, value: CachedBlame | undefined) {\n\t\tif (value == null) {\n\t\t\tthis.blameCache.delete(key);\n\t\t\treturn;\n\t\t}\n\t\tthis.blameCache.set(key, value);\n\t}\n\n\tsetDiff(key: string, value: CachedDiff | undefined) {\n\t\tif (value == null) {\n\t\t\tthis.diffCache.delete(key);\n\t\t\treturn;\n\t\t}\n\t\tthis.diffCache.set(key, value);\n\t}\n\n\tsetLog(key: string, value: CachedLog | undefined) {\n\t\tif (value == null) {\n\t\t\tthis.logCache.delete(key);\n\t\t\treturn;\n\t\t}\n\t\tthis.logCache.set(key, value);\n\t}\n}\n\nexport class GitDocumentTracker extends DocumentTracker<GitDocumentState> {\n\tresetCache(document: TextDocument, affects: 'blame' | 'diff' | 'log'): Promise<void>;\n\tresetCache(uri: Uri, affects: 'blame' | 'diff' | 'log'): Promise<void>;\n\tasync resetCache(documentOrUri: TextDocument | Uri, affects: 'blame' | 'diff' | 'log'): Promise<void> {\n\t\tconst doc = this.get(documentOrUri);\n\t\tif (doc == null) return;\n\n\t\tswitch (affects) {\n\t\t\tcase 'blame':\n\t\t\t\t(await doc).state?.clearBlame();\n\t\t\t\tbreak;\n\t\t\tcase 'diff':\n\t\t\t\t(await doc).state?.clearDiff();\n\t\t\t\tbreak;\n\t\t\tcase 'log':\n\t\t\t\t(await doc).state?.clearLog();\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n","import { commands, ConfigurationChangeEvent, Disposable } from 'vscode';\nimport { configuration, FileHistoryViewConfig } from '../configuration';\nimport { Commands, ContextKeys } from '../constants';\nimport { Container } from '../container';\nimport { setContext } from '../context';\nimport { GitUri } from '../git/gitUri';\nimport { executeCommand } from '../system/command';\nimport { FileHistoryTrackerNode, LineHistoryTrackerNode } from './nodes';\nimport { ViewBase } from './viewBase';\n\nconst pinnedSuffix = ' (pinned)';\n\nexport class FileHistoryView extends ViewBase<FileHistoryTrackerNode | LineHistoryTrackerNode, FileHistoryViewConfig> {\n\tprotected readonly configKey = 'fileHistory';\n\n\tprivate _followCursor: boolean = false;\n\tprivate _followEditor: boolean = true;\n\n\tconstructor(container: Container) {\n\t\tsuper('gitlens.views.fileHistory', 'File History', container);\n\n\t\tvoid setContext(ContextKeys.ViewsFileHistoryCursorFollowing, this._followCursor);\n\t\tvoid setContext(ContextKeys.ViewsFileHistoryEditorFollowing, this._followEditor);\n\t}\n\n\tprotected override get showCollapseAll(): boolean {\n\t\treturn false;\n\t}\n\n\tgetRoot(): LineHistoryTrackerNode | FileHistoryTrackerNode {\n\t\treturn this._followCursor ? new LineHistoryTrackerNode(this) : new FileHistoryTrackerNode(this);\n\t}\n\n\tprotected registerCommands(): Disposable[] {\n\t\tvoid this.container.viewCommands;\n\n\t\treturn [\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('copy'),\n\t\t\t\t() => executeCommand(Commands.ViewsCopy, this.selection),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(this.getQualifiedCommand('refresh'), () => this.refresh(true), this),\n\t\t\tcommands.registerCommand(this.getQualifiedCommand('changeBase'), () => this.changeBase(), this),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setCursorFollowingOn'),\n\t\t\t\t() => this.setCursorFollowing(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setCursorFollowingOff'),\n\t\t\t\t() => this.setCursorFollowing(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setEditorFollowingOn'),\n\t\t\t\t() => this.setEditorFollowing(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setEditorFollowingOff'),\n\t\t\t\t() => this.setEditorFollowing(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setRenameFollowingOn'),\n\t\t\t\t() => this.setRenameFollowing(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setRenameFollowingOff'),\n\t\t\t\t() => this.setRenameFollowing(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAllBranchesOn'),\n\t\t\t\t() => this.setShowAllBranches(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAllBranchesOff'),\n\t\t\t\t() => this.setShowAllBranches(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOn'),\n\t\t\t\t() => this.setShowAvatars(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOff'),\n\t\t\t\t() => this.setShowAvatars(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\t}\n\n\tprotected override filterConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tconst changed = super.filterConfigurationChanged(e);\n\t\tif (\n\t\t\t!changed &&\n\t\t\t!configuration.changed(e, 'defaultDateFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateShortFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateSource') &&\n\t\t\t!configuration.changed(e, 'defaultDateStyle') &&\n\t\t\t!configuration.changed(e, 'defaultGravatarsStyle') &&\n\t\t\t!configuration.changed(e, 'defaultTimeFormat') &&\n\t\t\t!configuration.changed(e, 'advanced.fileHistoryFollowsRenames') &&\n\t\t\t!configuration.changed(e, 'advanced.fileHistoryShowAllBranches')\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync showHistoryForUri(uri: GitUri) {\n\t\tthis.setCursorFollowing(false);\n\n\t\tconst root = this.ensureRoot(true);\n\n\t\tif (root instanceof FileHistoryTrackerNode) {\n\t\t\tawait root.showHistoryForUri(uri);\n\n\t\t\tthis.setEditorFollowing(false);\n\t\t}\n\n\t\treturn this.show();\n\t}\n\n\tprivate changeBase() {\n\t\tvoid this.root?.changeBase();\n\t}\n\n\tprivate setCursorFollowing(enabled: boolean) {\n\t\tconst uri = !this._followEditor && this.root?.hasUri ? this.root.uri : undefined;\n\n\t\tthis._followCursor = enabled;\n\t\tvoid setContext(ContextKeys.ViewsFileHistoryCursorFollowing, enabled);\n\n\t\tthis.title = this._followCursor ? 'Line History' : 'File History';\n\n\t\tconst root = this.ensureRoot(true);\n\t\tif (uri != null) {\n\t\t\troot.setUri(uri);\n\t\t}\n\t\troot.setEditorFollowing(this._followEditor);\n\t\tvoid root.ensureSubscription();\n\t\tvoid this.refresh(true);\n\t}\n\n\tprivate setEditorFollowing(enabled: boolean) {\n\t\tconst root = this.ensureRoot();\n\t\tif (!root.hasUri) return;\n\n\t\tthis._followEditor = enabled;\n\t\tvoid setContext(ContextKeys.ViewsFileHistoryEditorFollowing, enabled);\n\n\t\troot.setEditorFollowing(enabled);\n\n\t\tif (this.description?.endsWith(pinnedSuffix)) {\n\t\t\tif (enabled) {\n\t\t\t\tthis.description = this.description.substr(0, this.description.length - pinnedSuffix.length);\n\t\t\t}\n\t\t} else if (!enabled && this.description != null) {\n\t\t\tthis.description += pinnedSuffix;\n\t\t}\n\n\t\tif (enabled) {\n\t\t\tvoid root.ensureSubscription();\n\t\t\tvoid this.refresh(true);\n\t\t}\n\t}\n\n\tprivate setRenameFollowing(enabled: boolean) {\n\t\treturn configuration.updateEffective('advanced.fileHistoryFollowsRenames', enabled);\n\t}\n\n\tprivate setShowAllBranches(enabled: boolean) {\n\t\treturn configuration.updateEffective('advanced.fileHistoryShowAllBranches', enabled);\n\t}\n\n\tprivate setShowAvatars(enabled: boolean) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.avatars` as const, enabled);\n\t}\n}\n","import { Command, ThemeIcon, TreeItem, TreeItemCollapsibleState, Uri } from 'vscode';\nimport { GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { GitUri } from '../../git/gitUri';\nimport { View } from '../viewBase';\nimport { ContextValues, PageableViewNode, ViewNode } from './viewNode';\n\nexport class MessageNode extends ViewNode {\n\tconstructor(\n\t\tview: View,\n\t\tparent: ViewNode,\n\t\tprivate readonly _message: string,\n\t\tprivate readonly _description?: string,\n\t\tprivate readonly _tooltip?: string,\n\t\tprivate readonly _iconPath?:\n\t\t\t| string\n\t\t\t| Uri\n\t\t\t| {\n\t\t\t\t\tlight: string | Uri;\n\t\t\t\t\tdark: string | Uri;\n\t\t\t  }\n\t\t\t| ThemeIcon,\n\t\tprivate readonly _contextValue?: string,\n\t) {\n\t\tsuper(GitUri.unknown, view, parent);\n\t}\n\n\tgetChildren(): ViewNode[] | Promise<ViewNode[]> {\n\t\treturn [];\n\t}\n\n\tgetTreeItem(): TreeItem | Promise<TreeItem> {\n\t\tconst item = new TreeItem(this._message, TreeItemCollapsibleState.None);\n\t\titem.contextValue = this._contextValue ?? ContextValues.Message;\n\t\titem.description = this._description;\n\t\titem.tooltip = this._tooltip;\n\t\titem.iconPath = this._iconPath;\n\t\treturn item;\n\t}\n}\n\nexport class CommandMessageNode extends MessageNode {\n\tconstructor(\n\t\tview: View,\n\t\tparent: ViewNode,\n\t\tprivate readonly _command: Command,\n\t\tmessage: string,\n\t\tdescription?: string,\n\t\ttooltip?: string,\n\t\ticonPath?:\n\t\t\t| string\n\t\t\t| Uri\n\t\t\t| {\n\t\t\t\t\tlight: string | Uri;\n\t\t\t\t\tdark: string | Uri;\n\t\t\t  }\n\t\t\t| ThemeIcon,\n\t) {\n\t\tsuper(view, parent, message, description, tooltip, iconPath);\n\t}\n\n\toverride getTreeItem(): TreeItem | Promise<TreeItem> {\n\t\tconst item = super.getTreeItem();\n\t\tif (item instanceof TreeItem) {\n\t\t\titem.command = this._command;\n\t\t\treturn item;\n\t\t}\n\n\t\treturn item.then(i => {\n\t\t\ti.command = this._command;\n\t\t\treturn i;\n\t\t});\n\t}\n}\n\nexport class UpdateableMessageNode extends ViewNode {\n\toverride readonly id: string;\n\n\tconstructor(\n\t\tview: View,\n\t\tparent: ViewNode,\n\t\tid: string,\n\t\tprivate _message: string,\n\t\tprivate _tooltip?: string,\n\t\tprivate _iconPath?:\n\t\t\t| string\n\t\t\t| Uri\n\t\t\t| {\n\t\t\t\t\tlight: string | Uri;\n\t\t\t\t\tdark: string | Uri;\n\t\t\t  }\n\t\t\t| ThemeIcon,\n\t) {\n\t\tsuper(GitUri.unknown, view, parent);\n\t\tthis.id = id;\n\t}\n\n\tgetChildren(): ViewNode[] | Promise<ViewNode[]> {\n\t\treturn [];\n\t}\n\n\tgetTreeItem(): TreeItem | Promise<TreeItem> {\n\t\tconst item = new TreeItem(this._message, TreeItemCollapsibleState.None);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.Message;\n\t\titem.tooltip = this._tooltip;\n\t\titem.iconPath = this._iconPath;\n\t\treturn item;\n\t}\n\n\tupdate(\n\t\tchanges: {\n\t\t\tmessage?: string;\n\t\t\ttooltip?: string | null;\n\t\t\ticonPath?:\n\t\t\t\t| string\n\t\t\t\t| null\n\t\t\t\t| Uri\n\t\t\t\t| {\n\t\t\t\t\t\tlight: string | Uri;\n\t\t\t\t\t\tdark: string | Uri;\n\t\t\t\t  }\n\t\t\t\t| ThemeIcon;\n\t\t},\n\t\tview: View,\n\t) {\n\t\tif (changes.message !== undefined) {\n\t\t\tthis._message = changes.message;\n\t\t}\n\n\t\tif (changes.tooltip !== undefined) {\n\t\t\tthis._tooltip = changes.tooltip === null ? undefined : changes.tooltip;\n\t\t}\n\n\t\tif (changes.iconPath !== undefined) {\n\t\t\tthis._iconPath = changes.iconPath === null ? undefined : changes.iconPath;\n\t\t}\n\n\t\tview.triggerNodeChange(this);\n\t}\n}\n\nexport abstract class PagerNode extends ViewNode {\n\tconstructor(\n\t\tview: View,\n\t\tparent: ViewNode & PageableViewNode,\n\t\tprotected readonly message: string,\n\t\tprotected readonly previousNode?: ViewNode,\n\t\tprotected readonly pageSize: number = Container.instance.config.views.pageItemLimit,\n\t\tprotected readonly countFn?: () => Promise<number | undefined>,\n\t) {\n\t\tsuper(GitUri.unknown, view, parent);\n\t}\n\n\tasync loadAll() {\n\t\tconst count = (await this.countFn?.()) ?? 0;\n\t\treturn this.view.loadMoreNodeChildren(\n\t\t\tthis.parent! as ViewNode & PageableViewNode,\n\t\t\tcount > 5000 ? 5000 : 0,\n\t\t\tthis.previousNode,\n\t\t);\n\t}\n\n\tloadMore() {\n\t\treturn this.view.loadMoreNodeChildren(\n\t\t\tthis.parent! as ViewNode & PageableViewNode,\n\t\t\tthis.pageSize,\n\t\t\tthis.previousNode,\n\t\t);\n\t}\n\n\tgetChildren(): ViewNode[] | Promise<ViewNode[]> {\n\t\treturn [];\n\t}\n\n\tgetTreeItem(): TreeItem | Promise<TreeItem> {\n\t\tconst item = new TreeItem(this.message, TreeItemCollapsibleState.None);\n\t\titem.contextValue = ContextValues.Pager;\n\t\titem.command = this.getCommand();\n\t\treturn item;\n\t}\n\n\toverride getCommand(): Command | undefined {\n\t\treturn {\n\t\t\ttitle: 'Load more',\n\t\t\tcommand: 'gitlens.views.loadMoreChildren',\n\t\t\targuments: [this],\n\t\t};\n\t}\n}\n\nexport class LoadMoreNode extends PagerNode {\n\tconstructor(\n\t\tview: View,\n\t\tparent: ViewNode & PageableViewNode,\n\t\tpreviousNode: ViewNode,\n\t\tpageSize?: number,\n\t\tcountFn?: () => Promise<number | undefined>,\n\t) {\n\t\tsuper(\n\t\t\tview,\n\t\t\tparent,\n\t\t\tpageSize === 0\n\t\t\t\t? `Load all ${GlyphChars.Space}${GlyphChars.Dash}${GlyphChars.Space} this may take a while`\n\t\t\t\t: 'Load more',\n\t\t\tpreviousNode,\n\t\t\tpageSize,\n\t\t\tcountFn,\n\t\t);\n\t}\n}\n","import { ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { ViewFilesLayout, ViewsFilesConfig } from '../../configuration';\nimport { GitUri } from '../../git/gitUri';\nimport { HierarchicalItem } from '../../system/array';\nimport { sortCompare } from '../../system/string';\nimport { FileHistoryView } from '../fileHistoryView';\nimport { StashesView } from '../stashesView';\nimport { ViewsWithCommits } from '../viewBase';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport interface FileNode extends ViewNode {\n\tfolderName: string;\n\tlabel?: string;\n\tpriority: number;\n\trelativePath?: string;\n\troot?: HierarchicalItem<FileNode>;\n}\n\nexport class FolderNode extends ViewNode<ViewsWithCommits | FileHistoryView | StashesView> {\n\treadonly priority: number = 1;\n\n\tconstructor(\n\t\tview: ViewsWithCommits | FileHistoryView | StashesView,\n\t\tparent: ViewNode,\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly folderName: string,\n\t\tpublic readonly root: HierarchicalItem<FileNode>,\n\t\tprivate readonly containsWorkingFiles?: boolean,\n\t\tpublic readonly relativePath?: string,\n\t) {\n\t\tsuper(GitUri.fromRepoPath(repoPath), view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.folderName;\n\t}\n\n\tgetChildren(): (FolderNode | FileNode)[] {\n\t\tif (this.root.descendants === undefined || this.root.children === undefined) return [];\n\n\t\tlet children: (FolderNode | FileNode)[];\n\n\t\tconst nesting = FolderNode.getFileNesting(\n\t\t\tthis.view.config.files,\n\t\t\tthis.root.descendants,\n\t\t\tthis.relativePath === undefined,\n\t\t);\n\t\tif (nesting === ViewFilesLayout.List) {\n\t\t\tthis.root.descendants.forEach(n => (n.relativePath = this.root.relativePath));\n\t\t\tchildren = this.root.descendants;\n\t\t} else {\n\t\t\tchildren = [];\n\t\t\tfor (const folder of this.root.children.values()) {\n\t\t\t\tif (folder.value === undefined) {\n\t\t\t\t\tchildren.push(\n\t\t\t\t\t\tnew FolderNode(\n\t\t\t\t\t\t\tthis.view,\n\t\t\t\t\t\t\tthis.folderName ? this : this.parent!,\n\t\t\t\t\t\t\tthis.repoPath,\n\t\t\t\t\t\t\tfolder.name,\n\t\t\t\t\t\t\tfolder,\n\t\t\t\t\t\t\tthis.containsWorkingFiles,\n\t\t\t\t\t\t\tfolder.relativePath,\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Make sure to set the parent\n\t\t\t\t(folder.value as any).parent = this.folderName ? this : this.parent!;\n\t\t\t\tfolder.value.relativePath = this.root.relativePath;\n\t\t\t\tchildren.push(folder.value);\n\t\t\t}\n\t\t}\n\n\t\tchildren.sort((a, b) => {\n\t\t\treturn (\n\t\t\t\t(a instanceof FolderNode ? -1 : 1) - (b instanceof FolderNode ? -1 : 1) ||\n\t\t\t\ta.priority - b.priority ||\n\t\t\t\tsortCompare(a.label!, b.label!)\n\t\t\t);\n\t\t});\n\n\t\treturn children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(this.label, TreeItemCollapsibleState.Expanded);\n\t\titem.contextValue = ContextValues.Folder;\n\t\tif (this.containsWorkingFiles) {\n\t\t\titem.contextValue += '+working';\n\t\t}\n\t\titem.iconPath = ThemeIcon.Folder;\n\t\titem.tooltip = this.label;\n\t\treturn item;\n\t}\n\n\tget label(): string {\n\t\treturn this.folderName;\n\t}\n\n\tstatic getFileNesting<T extends FileNode>(\n\t\tconfig: ViewsFilesConfig,\n\t\tchildren: T[],\n\t\tisRoot: boolean,\n\t): ViewFilesLayout {\n\t\tconst nesting = config.layout || ViewFilesLayout.Auto;\n\t\tif (nesting === ViewFilesLayout.Auto) {\n\t\t\tif (isRoot || config.compact) {\n\t\t\t\tconst nestingThreshold = config.threshold || 5;\n\t\t\t\tif (children.length <= nestingThreshold) return ViewFilesLayout.List;\n\t\t\t}\n\t\t\treturn ViewFilesLayout.Tree;\n\t\t}\n\t\treturn nesting;\n\t}\n}\n","import { Command, MarkdownString, ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport type { DiffWithCommandArgs } from '../../commands';\nimport { Commands, CoreCommands, GlyphChars } from '../../constants';\nimport { CommitFormatter } from '../../git/formatters';\nimport { GitUri } from '../../git/gitUri';\nimport { GitFile, GitMergeStatus, GitRebaseStatus, GitReference } from '../../git/models';\nimport { FileHistoryView } from '../fileHistoryView';\nimport { LineHistoryView } from '../lineHistoryView';\nimport { ViewsWithCommits } from '../viewBase';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class MergeConflictCurrentChangesNode extends ViewNode<ViewsWithCommits | FileHistoryView | LineHistoryView> {\n\tconstructor(\n\t\tview: ViewsWithCommits | FileHistoryView | LineHistoryView,\n\t\tparent: ViewNode,\n\t\tprivate readonly status: GitMergeStatus | GitRebaseStatus,\n\t\tprivate readonly file: GitFile,\n\t) {\n\t\tsuper(GitUri.fromFile(file, status.repoPath, 'HEAD'), view, parent);\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\treturn [];\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tconst commit = await this.view.container.git.getCommit(this.status.repoPath, 'HEAD');\n\n\t\tconst item = new TreeItem('Current changes', TreeItemCollapsibleState.None);\n\t\titem.contextValue = ContextValues.MergeConflictCurrentChanges;\n\t\titem.description = `${GitReference.toString(this.status.current, { expand: false, icon: false })}${\n\t\t\tcommit != null ? ` (${GitReference.toString(commit, { expand: false, icon: false })})` : ' (HEAD)'\n\t\t}`;\n\t\titem.iconPath = this.view.config.avatars\n\t\t\t? (await commit?.getAvatarUri({ defaultStyle: this.view.container.config.defaultGravatarsStyle })) ??\n\t\t\t  new ThemeIcon('diff')\n\t\t\t: new ThemeIcon('diff');\n\n\t\tconst markdown = new MarkdownString(\n\t\t\t`Current changes to $(file)${GlyphChars.Space}${this.file.path} on ${GitReference.toString(\n\t\t\t\tthis.status.current,\n\t\t\t)}${\n\t\t\t\tcommit != null\n\t\t\t\t\t? `\\n\\n${await CommitFormatter.fromTemplateAsync(\n\t\t\t\t\t\t\t`\\${avatar}&nbsp;__\\${author}__, \\${ago} &nbsp; _(\\${date})_ \\n\\n\\${message}\\n\\n\\${link}\\${' via 'pullRequest}`,\n\t\t\t\t\t\t\tcommit,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tavatarSize: 16,\n\t\t\t\t\t\t\t\tdateFormat: this.view.container.config.defaultDateFormat,\n\t\t\t\t\t\t\t\tmarkdown: true,\n\t\t\t\t\t\t\t\t// messageAutolinks: true,\n\t\t\t\t\t\t\t\tmessageIndent: 4,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t  )}`\n\t\t\t\t\t: ''\n\t\t\t}`,\n\t\t\ttrue,\n\t\t);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\n\t\titem.tooltip = markdown;\n\t\titem.command = this.getCommand();\n\n\t\treturn item;\n\t}\n\n\toverride getCommand(): Command | undefined {\n\t\tif (this.status.mergeBase == null) {\n\t\t\treturn {\n\t\t\t\ttitle: 'Open Revision',\n\t\t\t\tcommand: CoreCommands.Open,\n\t\t\t\targuments: [this.view.container.git.getRevisionUri('HEAD', this.file.path, this.status.repoPath)],\n\t\t\t};\n\t\t}\n\n\t\tconst commandArgs: DiffWithCommandArgs = {\n\t\t\tlhs: {\n\t\t\t\tsha: this.status.mergeBase,\n\t\t\t\turi: GitUri.fromFile(this.file, this.status.repoPath, undefined, true),\n\t\t\t\ttitle: `${this.file.path} (merge-base)`,\n\t\t\t},\n\t\t\trhs: {\n\t\t\t\tsha: 'HEAD',\n\t\t\t\turi: GitUri.fromFile(this.file, this.status.repoPath),\n\t\t\t\ttitle: `${this.file.path} (${GitReference.toString(this.status.current, {\n\t\t\t\t\texpand: false,\n\t\t\t\t\ticon: false,\n\t\t\t\t})})`,\n\t\t\t},\n\t\t\trepoPath: this.status.repoPath,\n\t\t\tline: 0,\n\t\t\tshowOptions: {\n\t\t\t\tpreserveFocus: true,\n\t\t\t\tpreview: true,\n\t\t\t},\n\t\t};\n\t\treturn {\n\t\t\ttitle: 'Open Changes',\n\t\t\tcommand: Commands.DiffWith,\n\t\t\targuments: [commandArgs],\n\t\t};\n\t}\n}\n","import { Command, MarkdownString, ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport type { DiffWithCommandArgs } from '../../commands';\nimport { Commands, CoreCommands, GlyphChars } from '../../constants';\nimport { CommitFormatter } from '../../git/formatters';\nimport { GitUri } from '../../git/gitUri';\nimport { GitFile, GitMergeStatus, GitRebaseStatus, GitReference } from '../../git/models';\nimport { FileHistoryView } from '../fileHistoryView';\nimport { LineHistoryView } from '../lineHistoryView';\nimport { ViewsWithCommits } from '../viewBase';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class MergeConflictIncomingChangesNode extends ViewNode<ViewsWithCommits | FileHistoryView | LineHistoryView> {\n\tconstructor(\n\t\tview: ViewsWithCommits | FileHistoryView | LineHistoryView,\n\t\tparent: ViewNode,\n\t\tprivate readonly status: GitMergeStatus | GitRebaseStatus,\n\t\tprivate readonly file: GitFile,\n\t) {\n\t\tsuper(GitUri.fromFile(file, status.repoPath, status.HEAD.ref), view, parent);\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\treturn [];\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tconst commit = await this.view.container.git.getCommit(\n\t\t\tthis.status.repoPath,\n\t\t\tthis.status.type === 'rebase' ? this.status.steps.current.commit.ref : this.status.HEAD.ref,\n\t\t);\n\n\t\tconst item = new TreeItem('Incoming changes', TreeItemCollapsibleState.None);\n\t\titem.contextValue = ContextValues.MergeConflictIncomingChanges;\n\t\titem.description = `${GitReference.toString(this.status.incoming, { expand: false, icon: false })}${\n\t\t\tthis.status.type === 'rebase'\n\t\t\t\t? ` (${GitReference.toString(this.status.steps.current.commit, { expand: false, icon: false })})`\n\t\t\t\t: ` (${GitReference.toString(this.status.HEAD, { expand: false, icon: false })})`\n\t\t}`;\n\t\titem.iconPath = this.view.config.avatars\n\t\t\t? (await commit?.getAvatarUri({ defaultStyle: this.view.container.config.defaultGravatarsStyle })) ??\n\t\t\t  new ThemeIcon('diff')\n\t\t\t: new ThemeIcon('diff');\n\n\t\tconst markdown = new MarkdownString(\n\t\t\t`Incoming changes to $(file)${GlyphChars.Space}${this.file.path}${\n\t\t\t\tthis.status.incoming != null\n\t\t\t\t\t? ` from ${GitReference.toString(this.status.incoming)}${\n\t\t\t\t\t\t\tcommit != null\n\t\t\t\t\t\t\t\t? `\\n\\n${await CommitFormatter.fromTemplateAsync(\n\t\t\t\t\t\t\t\t\t\t`\\${avatar}&nbsp;__\\${author}__, \\${ago} &nbsp; _(\\${date})_ \\n\\n\\${message}\\n\\n\\${link}\\${' via 'pullRequest}`,\n\t\t\t\t\t\t\t\t\t\tcommit,\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tavatarSize: 16,\n\t\t\t\t\t\t\t\t\t\t\tdateFormat: this.view.container.config.defaultDateFormat,\n\t\t\t\t\t\t\t\t\t\t\tmarkdown: true,\n\t\t\t\t\t\t\t\t\t\t\t// messageAutolinks: true,\n\t\t\t\t\t\t\t\t\t\t\tmessageIndent: 4,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t  )}`\n\t\t\t\t\t\t\t\t: this.status.type === 'rebase'\n\t\t\t\t\t\t\t\t? `\\n\\n${GitReference.toString(this.status.steps.current.commit, {\n\t\t\t\t\t\t\t\t\t\tcapitalize: true,\n\t\t\t\t\t\t\t\t\t\tlabel: false,\n\t\t\t\t\t\t\t\t  })}`\n\t\t\t\t\t\t\t\t: `\\n\\n${GitReference.toString(this.status.HEAD, { capitalize: true, label: false })}`\n\t\t\t\t\t  }`\n\t\t\t\t\t: ''\n\t\t\t}`,\n\t\t\ttrue,\n\t\t);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\n\t\titem.tooltip = markdown;\n\t\titem.command = this.getCommand();\n\n\t\treturn item;\n\t}\n\n\toverride getCommand(): Command | undefined {\n\t\tif (this.status.mergeBase == null) {\n\t\t\treturn {\n\t\t\t\ttitle: 'Open Revision',\n\t\t\t\tcommand: CoreCommands.Open,\n\t\t\t\targuments: [\n\t\t\t\t\tthis.view.container.git.getRevisionUri(this.status.HEAD.ref, this.file.path, this.status.repoPath),\n\t\t\t\t],\n\t\t\t};\n\t\t}\n\n\t\tconst commandArgs: DiffWithCommandArgs = {\n\t\t\tlhs: {\n\t\t\t\tsha: this.status.mergeBase,\n\t\t\t\turi: GitUri.fromFile(this.file, this.status.repoPath, undefined, true),\n\t\t\t\ttitle: `${this.file.path} (merge-base)`,\n\t\t\t},\n\t\t\trhs: {\n\t\t\t\tsha: this.status.HEAD.ref,\n\t\t\t\turi: GitUri.fromFile(this.file, this.status.repoPath),\n\t\t\t\ttitle: `${this.file.path} (${\n\t\t\t\t\tthis.status.incoming != null\n\t\t\t\t\t\t? GitReference.toString(this.status.incoming, { expand: false, icon: false })\n\t\t\t\t\t\t: 'incoming'\n\t\t\t\t})`,\n\t\t\t},\n\t\t\trepoPath: this.status.repoPath,\n\t\t\tline: 0,\n\t\t\tshowOptions: {\n\t\t\t\tpreserveFocus: true,\n\t\t\t\tpreview: true,\n\t\t\t},\n\t\t};\n\t\treturn {\n\t\t\ttitle: 'Open Changes',\n\t\t\tcommand: Commands.DiffWith,\n\t\t\targuments: [commandArgs],\n\t\t};\n\t}\n}\n","import {\n\tCommand,\n\tMarkdownString,\n\tSelection,\n\tThemeColor,\n\tThemeIcon,\n\tTreeItem,\n\tTreeItemCollapsibleState,\n\tUri,\n} from 'vscode';\nimport type { DiffWithPreviousCommandArgs } from '../../commands';\nimport { Colors, Commands } from '../../constants';\nimport { CommitFormatter, StatusFileFormatter } from '../../git/formatters';\nimport { GitUri } from '../../git/gitUri';\nimport { GitBranch, GitCommit, GitFile, GitRevisionReference } from '../../git/models';\nimport { joinPaths } from '../../system/path';\nimport { FileHistoryView } from '../fileHistoryView';\nimport { LineHistoryView } from '../lineHistoryView';\nimport { ViewsWithCommits } from '../viewBase';\nimport { MergeConflictCurrentChangesNode } from './mergeConflictCurrentChangesNode';\nimport { MergeConflictIncomingChangesNode } from './mergeConflictIncomingChangesNode';\nimport { ContextValues, ViewNode, ViewRefFileNode } from './viewNode';\n\nexport class FileRevisionAsCommitNode extends ViewRefFileNode<ViewsWithCommits | FileHistoryView | LineHistoryView> {\n\tconstructor(\n\t\tview: ViewsWithCommits | FileHistoryView | LineHistoryView,\n\t\tparent: ViewNode,\n\t\tpublic readonly file: GitFile,\n\t\tpublic commit: GitCommit,\n\t\tprivate readonly _options: {\n\t\t\tbranch?: GitBranch;\n\t\t\tgetBranchAndTagTips?: (sha: string, options?: { compact?: boolean }) => string | undefined;\n\t\t\tselection?: Selection;\n\t\t\tunpublished?: boolean;\n\t\t} = {},\n\t) {\n\t\tsuper(GitUri.fromFile(file, commit.repoPath, commit.sha), view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn `${this.commit.shortSha}: ${this.commit.summary}`;\n\t}\n\n\tget fileName(): string {\n\t\treturn this.file.path;\n\t}\n\n\tget isTip(): boolean {\n\t\treturn (this._options.branch?.current && this._options.branch.sha === this.commit.ref) ?? false;\n\t}\n\n\tget ref(): GitRevisionReference {\n\t\treturn this.commit;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (!this.commit.file?.hasConflicts) return [];\n\n\t\tconst [mergeStatus, rebaseStatus] = await Promise.all([\n\t\t\tthis.view.container.git.getMergeStatus(this.commit.repoPath),\n\t\t\tthis.view.container.git.getRebaseStatus(this.commit.repoPath),\n\t\t]);\n\t\tif (mergeStatus == null && rebaseStatus == null) return [];\n\n\t\treturn [\n\t\t\tnew MergeConflictCurrentChangesNode(this.view, this, (mergeStatus ?? rebaseStatus)!, this.file),\n\t\t\tnew MergeConflictIncomingChangesNode(this.view, this, (mergeStatus ?? rebaseStatus)!, this.file),\n\t\t];\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tif (this.commit.file == null) {\n\t\t\t// Try to get the commit directly from the multi-file commit\n\t\t\tconst commit = await this.commit.getCommitForFile(this.file);\n\t\t\tif (commit == null) {\n\t\t\t\tconst log = await this.view.container.git.getLogForFile(this.repoPath, this.file.path, {\n\t\t\t\t\tlimit: 2,\n\t\t\t\t\tref: this.commit.sha,\n\t\t\t\t});\n\t\t\t\tif (log != null) {\n\t\t\t\t\tthis.commit = log.commits.get(this.commit.sha) ?? this.commit;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.commit = commit;\n\t\t\t}\n\t\t}\n\n\t\tconst item = new TreeItem(\n\t\t\tCommitFormatter.fromTemplate(this.view.config.formats.commits.label, this.commit, {\n\t\t\t\tdateFormat: this.view.container.config.defaultDateFormat,\n\t\t\t\tgetBranchAndTagTips: (sha: string) => this._options.getBranchAndTagTips?.(sha, { compact: true }),\n\t\t\t\tmessageTruncateAtNewLine: true,\n\t\t\t}),\n\t\t\tthis.commit.file?.hasConflicts ? TreeItemCollapsibleState.Expanded : TreeItemCollapsibleState.None,\n\t\t);\n\n\t\titem.contextValue = this.contextValue;\n\n\t\titem.description = CommitFormatter.fromTemplate(this.view.config.formats.commits.description, this.commit, {\n\t\t\tdateFormat: this.view.container.config.defaultDateFormat,\n\t\t\tgetBranchAndTagTips: (sha: string) => this._options.getBranchAndTagTips?.(sha, { compact: true }),\n\t\t\tmessageTruncateAtNewLine: true,\n\t\t});\n\n\t\titem.resourceUri = Uri.parse(`gitlens-view://commit-file/status/${this.file.status}`);\n\n\t\tif (!this.commit.isUncommitted && this.view.config.avatars) {\n\t\t\titem.iconPath = this._options.unpublished\n\t\t\t\t? new ThemeIcon('arrow-up', new ThemeColor(Colors.UnpublishedCommitIconColor))\n\t\t\t\t: await this.commit.getAvatarUri({ defaultStyle: this.view.container.config.defaultGravatarsStyle });\n\t\t}\n\n\t\tif (item.iconPath == null) {\n\t\t\tconst icon = GitFile.getStatusIcon(this.file.status);\n\t\t\titem.iconPath = {\n\t\t\t\tdark: this.view.container.context.asAbsolutePath(joinPaths('images', 'dark', icon)),\n\t\t\t\tlight: this.view.container.context.asAbsolutePath(joinPaths('images', 'light', icon)),\n\t\t\t};\n\t\t}\n\n\t\titem.command = this.getCommand();\n\n\t\treturn item;\n\t}\n\n\tprotected get contextValue(): string {\n\t\tif (!this.commit.isUncommitted) {\n\t\t\treturn `${ContextValues.File}+committed${this._options.branch?.current ? '+current' : ''}${\n\t\t\t\tthis.isTip ? '+HEAD' : ''\n\t\t\t}${this._options.unpublished ? '+unpublished' : ''}`;\n\t\t}\n\n\t\treturn this.commit.file?.hasConflicts\n\t\t\t? `${ContextValues.File}+conflicted`\n\t\t\t: this.commit.isUncommittedStaged\n\t\t\t? `${ContextValues.File}+staged`\n\t\t\t: `${ContextValues.File}+unstaged`;\n\t}\n\n\toverride getCommand(): Command | undefined {\n\t\tlet line;\n\t\tif (this.commit.lines.length) {\n\t\t\tline = this.commit.lines[0].line - 1;\n\t\t} else {\n\t\t\tline = this._options.selection?.active.line ?? 0;\n\t\t}\n\n\t\tif (this.commit.file?.hasConflicts) {\n\t\t\treturn {\n\t\t\t\ttitle: 'Open Changes',\n\t\t\t\tcommand: Commands.DiffWith,\n\t\t\t\targuments: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlhs: {\n\t\t\t\t\t\t\tsha: 'MERGE_HEAD',\n\t\t\t\t\t\t\turi: GitUri.fromFile(this.file, this.repoPath, undefined, true),\n\t\t\t\t\t\t},\n\t\t\t\t\t\trhs: {\n\t\t\t\t\t\t\tsha: 'HEAD',\n\t\t\t\t\t\t\turi: GitUri.fromFile(this.file, this.repoPath),\n\t\t\t\t\t\t},\n\t\t\t\t\t\trepoPath: this.repoPath,\n\t\t\t\t\t\tline: 0,\n\t\t\t\t\t\tshowOptions: {\n\t\t\t\t\t\t\tpreserveFocus: false,\n\t\t\t\t\t\t\tpreview: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\t\t}\n\n\t\tconst commandArgs: DiffWithPreviousCommandArgs = {\n\t\t\tcommit: this.commit,\n\t\t\turi: GitUri.fromFile(this.file, this.commit.repoPath),\n\t\t\tline: line,\n\t\t\tshowOptions: {\n\t\t\t\tpreserveFocus: true,\n\t\t\t\tpreview: true,\n\t\t\t},\n\t\t};\n\t\treturn {\n\t\t\ttitle: 'Open Changes with Previous Revision',\n\t\t\tcommand: Commands.DiffWithPrevious,\n\t\t\targuments: [undefined, commandArgs],\n\t\t};\n\t}\n\n\toverride async resolveTreeItem(item: TreeItem): Promise<TreeItem> {\n\t\tif (item.tooltip == null) {\n\t\t\titem.tooltip = await this.getTooltip();\n\t\t}\n\t\treturn item;\n\t}\n\n\tasync getConflictBaseUri(): Promise<Uri | undefined> {\n\t\tif (!this.commit.file?.hasConflicts) return undefined;\n\n\t\tconst mergeBase = await this.view.container.git.getMergeBase(this.repoPath, 'MERGE_HEAD', 'HEAD');\n\t\treturn GitUri.fromFile(this.file, this.repoPath, mergeBase ?? 'HEAD');\n\t}\n\n\tprivate async getTooltip() {\n\t\tconst remotes = await this.view.container.git.getRemotesWithProviders(this.commit.repoPath);\n\t\tconst remote = await this.view.container.git.getRichRemoteProvider(remotes);\n\n\t\tif (this.commit.message == null) {\n\t\t\tawait this.commit.ensureFullDetails();\n\t\t}\n\n\t\tlet autolinkedIssuesOrPullRequests;\n\t\tlet pr;\n\n\t\tif (remote?.provider != null) {\n\t\t\t[autolinkedIssuesOrPullRequests, pr] = await Promise.all([\n\t\t\t\tthis.view.container.autolinks.getIssueOrPullRequestLinks(\n\t\t\t\t\tthis.commit.message ?? this.commit.summary,\n\t\t\t\t\tremote,\n\t\t\t\t),\n\t\t\t\tthis.view.container.git.getPullRequestForCommit(this.commit.ref, remote.provider),\n\t\t\t]);\n\t\t}\n\n\t\tconst status = StatusFileFormatter.fromTemplate(`\\${status}\\${ (originalPath)}`, this.file);\n\t\tconst tooltip = await CommitFormatter.fromTemplateAsync(\n\t\t\t`\\${link}\\${' via 'pullRequest} \\u2022 ${status}\\${ \\u2022 changesDetail}\\${'&nbsp;&nbsp;&nbsp;'tips}\\n\\n\\${avatar} &nbsp;__\\${author}__, \\${ago} &nbsp; _(\\${date})_ \\n\\n\\${message}\\${\\n\\n---\\n\\nfootnotes}`,\n\t\t\tthis.commit,\n\t\t\t{\n\t\t\t\tautolinkedIssuesOrPullRequests: autolinkedIssuesOrPullRequests,\n\t\t\t\tdateFormat: this.view.container.config.defaultDateFormat,\n\t\t\t\tgetBranchAndTagTips: this._options.getBranchAndTagTips,\n\t\t\t\tmarkdown: true,\n\t\t\t\tmessageAutolinks: true,\n\t\t\t\tmessageIndent: 4,\n\t\t\t\tpullRequestOrRemote: pr,\n\t\t\t\tremotes: remotes,\n\t\t\t\tunpublished: this._options.unpublished,\n\t\t\t},\n\t\t);\n\n\t\tconst markdown = new MarkdownString(tooltip, true);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\n\t\treturn markdown;\n\t}\n}\n","import { Command, ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport type { DiffWithCommandArgs } from '../../commands';\nimport { DiffWithPreviousCommandArgs } from '../../commands/diffWithPrevious';\nimport { Commands } from '../../constants';\nimport { StatusFileFormatter } from '../../git/formatters/statusFormatter';\nimport { GitUri } from '../../git/gitUri';\nimport { GitCommit, GitFile } from '../../git/models';\nimport { joinPaths, relativeDir } from '../../system/path';\nimport { pluralize } from '../../system/string';\nimport { ViewsWithCommits } from '../viewBase';\nimport { FileRevisionAsCommitNode } from './fileRevisionAsCommitNode';\nimport { FileNode } from './folderNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class StatusFileNode extends ViewNode<ViewsWithCommits> implements FileNode {\n\tpublic readonly commits: GitCommit[];\n\tpublic readonly file: GitFile;\n\tpublic readonly repoPath: string;\n\n\tprivate readonly _hasStagedChanges: boolean;\n\tprivate readonly _hasUnstagedChanges: boolean;\n\n\tconstructor(view: ViewsWithCommits, parent: ViewNode, repoPath: string, file: GitFile, commits: GitCommit[]) {\n\t\tlet hasStagedChanges = false;\n\t\tlet hasUnstagedChanges = false;\n\t\tlet ref = undefined;\n\t\tfor (const c of commits) {\n\t\t\tif (c.isUncommitted) {\n\t\t\t\tif (c.isUncommittedStaged) {\n\t\t\t\t\thasStagedChanges = true;\n\t\t\t\t\tif (!hasUnstagedChanges) {\n\t\t\t\t\t\tref = c.sha;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\tref = undefined;\n\t\t\t\t\thasUnstagedChanges = true;\n\t\t\t\t}\n\t\t\t} else if (hasUnstagedChanges) {\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tref = c.sha;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tsuper(GitUri.fromFile(file, repoPath, ref), view, parent);\n\n\t\tthis.repoPath = repoPath;\n\t\tthis.file = file;\n\t\tthis.commits = commits;\n\n\t\tthis._hasStagedChanges = hasStagedChanges;\n\t\tthis._hasUnstagedChanges = hasUnstagedChanges;\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.fileName;\n\t}\n\n\tget fileName(): string {\n\t\treturn this.file.path;\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\treturn this.commits.map(c => new FileRevisionAsCommitNode(this.view, this, this.file, c));\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(this.label, TreeItemCollapsibleState.None);\n\t\titem.description = this.description;\n\n\t\tif ((this._hasStagedChanges || this._hasUnstagedChanges) && this.commits.length === 1) {\n\t\t\titem.contextValue = ContextValues.File;\n\t\t\tif (this._hasStagedChanges) {\n\t\t\t\titem.contextValue += '+staged';\n\t\t\t\titem.tooltip = StatusFileFormatter.fromTemplate(\n\t\t\t\t\t`\\${file}\\n\\${directory}/\\n\\n\\${status}\\${ (originalPath)} in Index (staged)`,\n\t\t\t\t\tthis.file,\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\titem.contextValue += '+unstaged';\n\t\t\t\titem.tooltip = StatusFileFormatter.fromTemplate(\n\t\t\t\t\t`\\${file}\\n\\${directory}/\\n\\n\\${status}\\${ (originalPath)} in Working Tree`,\n\t\t\t\t\tthis.file,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Use the file icon and decorations\n\t\t\titem.resourceUri = this.view.container.git.getAbsoluteUri(this.file.path, this.repoPath);\n\t\t\titem.iconPath = ThemeIcon.File;\n\n\t\t\titem.command = this.getCommand();\n\t\t} else {\n\t\t\titem.collapsibleState = TreeItemCollapsibleState.Collapsed;\n\t\t\tif (this._hasStagedChanges || this._hasUnstagedChanges) {\n\t\t\t\titem.contextValue = ContextValues.File;\n\t\t\t\tif (this._hasStagedChanges && this._hasUnstagedChanges) {\n\t\t\t\t\titem.contextValue += '+staged+unstaged';\n\t\t\t\t} else if (this._hasStagedChanges) {\n\t\t\t\t\titem.contextValue += '+staged';\n\t\t\t\t} else {\n\t\t\t\t\titem.contextValue += '+unstaged';\n\t\t\t\t}\n\n\t\t\t\t// Use the file icon and decorations\n\t\t\t\titem.resourceUri = this.view.container.git.getAbsoluteUri(this.file.path, this.repoPath);\n\t\t\t\titem.iconPath = ThemeIcon.File;\n\t\t\t} else {\n\t\t\t\titem.contextValue = ContextValues.StatusFileCommits;\n\n\t\t\t\tconst icon = GitFile.getStatusIcon(this.file.status);\n\t\t\t\titem.iconPath = {\n\t\t\t\t\tdark: this.view.container.context.asAbsolutePath(joinPaths('images', 'dark', icon)),\n\t\t\t\t\tlight: this.view.container.context.asAbsolutePath(joinPaths('images', 'light', icon)),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\titem.tooltip = StatusFileFormatter.fromTemplate(\n\t\t\t\t`\\${file}\\n\\${directory}/\\n\\n\\${status}\\${ (originalPath)} in ${this.getChangedIn()}`,\n\t\t\t\tthis.file,\n\t\t\t);\n\n\t\t\titem.command = this.getCommand();\n\t\t}\n\n\t\t// Only cache the label/description for a single refresh\n\t\tthis._label = undefined;\n\t\tthis._description = undefined;\n\n\t\treturn item;\n\t}\n\n\tprivate _description: string | undefined;\n\tget description() {\n\t\tif (this._description == null) {\n\t\t\tthis._description = StatusFileFormatter.fromTemplate(\n\t\t\t\tthis.view.config.formats.files.description,\n\t\t\t\t{\n\t\t\t\t\t...this.file,\n\t\t\t\t\tcommit: this.commit,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\trelativePath: this.relativePath,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\treturn this._description;\n\t}\n\n\tprivate _folderName: string | undefined;\n\tget folderName() {\n\t\tif (this._folderName == null) {\n\t\t\tthis._folderName = relativeDir(this.uri.relativePath);\n\t\t}\n\t\treturn this._folderName;\n\t}\n\n\tprivate _label: string | undefined;\n\tget label() {\n\t\tif (this._label == null) {\n\t\t\tthis._label = StatusFileFormatter.fromTemplate(\n\t\t\t\tthis.view.config.formats.files.label,\n\t\t\t\t{\n\t\t\t\t\t...this.file,\n\t\t\t\t\tcommit: this.commit,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\trelativePath: this.relativePath,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\treturn this._label;\n\t}\n\n\tget commit() {\n\t\treturn this.commits[0];\n\t}\n\n\tget priority(): number {\n\t\tif (this._hasStagedChanges && !this._hasUnstagedChanges) return -3;\n\t\tif (this._hasStagedChanges) return -2;\n\t\tif (this._hasUnstagedChanges) return -1;\n\t\treturn 0;\n\t}\n\n\tprivate _relativePath: string | undefined;\n\tget relativePath(): string | undefined {\n\t\treturn this._relativePath;\n\t}\n\tset relativePath(value: string | undefined) {\n\t\tthis._relativePath = value;\n\t\tthis._label = undefined;\n\t\tthis._description = undefined;\n\t}\n\n\tprivate getChangedIn(): string {\n\t\tconst changedIn = [];\n\n\t\tlet commits = 0;\n\n\t\tif (this._hasUnstagedChanges) {\n\t\t\tcommits++;\n\t\t\tchangedIn.push('Working Tree');\n\t\t}\n\n\t\tif (this._hasStagedChanges) {\n\t\t\tcommits++;\n\t\t\tchangedIn.push('Index (staged)');\n\t\t}\n\n\t\tif (this.commits.length > commits) {\n\t\t\tcommits = this.commits.length - commits;\n\t\t}\n\n\t\tif (commits > 0) {\n\t\t\tchangedIn.push(pluralize('commit', commits));\n\t\t}\n\n\t\tif (changedIn.length > 2) {\n\t\t\tchangedIn[changedIn.length - 1] = `and ${changedIn[changedIn.length - 1]}`;\n\t\t}\n\t\treturn changedIn.join(changedIn.length > 2 ? ', ' : ' and ');\n\t}\n\n\toverride getCommand(): Command | undefined {\n\t\tif ((this._hasStagedChanges || this._hasUnstagedChanges) && this.commits.length === 1) {\n\t\t\tconst commandArgs: DiffWithPreviousCommandArgs = {\n\t\t\t\tcommit: this.commit,\n\t\t\t\turi: GitUri.fromFile(this.file, this.repoPath),\n\t\t\t\tline: 0,\n\t\t\t\tshowOptions: {\n\t\t\t\t\tpreserveFocus: true,\n\t\t\t\t\tpreview: true,\n\t\t\t\t},\n\t\t\t};\n\t\t\treturn {\n\t\t\t\ttitle: 'Open Changes with Previous Revision',\n\t\t\t\tcommand: Commands.DiffWithPrevious,\n\t\t\t\targuments: [undefined, commandArgs],\n\t\t\t};\n\t\t}\n\n\t\tconst commit = this.commits[this.commits.length - 1];\n\t\tconst file = commit.files?.find(f => f.path === this.file.path) ?? this.file;\n\t\tconst commandArgs: DiffWithCommandArgs = {\n\t\t\tlhs: {\n\t\t\t\tsha: `${commit.sha}^`,\n\t\t\t\turi: GitUri.fromFile(file, this.repoPath, undefined, true),\n\t\t\t},\n\t\t\trhs: {\n\t\t\t\tsha: '',\n\t\t\t\turi: GitUri.fromFile(this.file, this.repoPath),\n\t\t\t},\n\t\t\trepoPath: this.repoPath,\n\t\t\tline: 0,\n\t\t\tshowOptions: {\n\t\t\t\tpreserveFocus: true,\n\t\t\t\tpreview: true,\n\t\t\t},\n\t\t};\n\t\treturn {\n\t\t\ttitle: 'Open Changes',\n\t\t\tcommand: Commands.DiffWith,\n\t\t\targuments: [commandArgs],\n\t\t};\n\t}\n}\n","import { TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { ViewFilesLayout } from '../../configuration';\nimport { GitUri } from '../../git/gitUri';\nimport { GitBranch, GitFileWithCommit, GitRevision } from '../../git/models';\nimport { groupBy, makeHierarchical } from '../../system/array';\nimport { filter, flatMap, map } from '../../system/iterable';\nimport { joinPaths, normalizePath } from '../../system/path';\nimport { pluralize, sortCompare } from '../../system/string';\nimport { ViewsWithCommits } from '../viewBase';\nimport { BranchNode } from './branchNode';\nimport { BranchTrackingStatus } from './branchTrackingStatusNode';\nimport { FileNode, FolderNode } from './folderNode';\nimport { StatusFileNode } from './statusFileNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class BranchTrackingStatusFilesNode extends ViewNode<ViewsWithCommits> {\n\tstatic key = ':status-branch:files';\n\tstatic getId(repoPath: string, name: string, root: boolean, upstream: string, direction: string): string {\n\t\treturn `${BranchNode.getId(repoPath, name, root)}${this.key}(${upstream}|${direction})`;\n\t}\n\n\treadonly repoPath: string;\n\n\tconstructor(\n\t\tview: ViewsWithCommits,\n\t\tparent: ViewNode,\n\t\tpublic readonly branch: GitBranch,\n\t\tpublic readonly status: Required<BranchTrackingStatus>,\n\t\tpublic readonly direction: 'ahead' | 'behind',\n\t\t// Specifies that the node is shown as a root\n\t\tprivate readonly root: boolean = false,\n\t) {\n\t\tsuper(GitUri.fromRepoPath(status.repoPath), view, parent);\n\t\tthis.repoPath = status.repoPath;\n\t}\n\n\toverride get id(): string {\n\t\treturn BranchTrackingStatusFilesNode.getId(\n\t\t\tthis.status.repoPath,\n\t\t\tthis.status.ref,\n\t\t\tthis.root,\n\t\t\tthis.status.upstream,\n\t\t\tthis.direction,\n\t\t);\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tconst log = await this.view.container.git.getLog(this.repoPath, {\n\t\t\tlimit: 0,\n\t\t\tref: GitRevision.createRange(\n\t\t\t\tthis.status.upstream,\n\t\t\t\tthis.branch.ref,\n\t\t\t\tthis.direction === 'behind' ? '...' : '..',\n\t\t\t),\n\t\t});\n\n\t\tlet files: GitFileWithCommit[];\n\n\t\tif (log != null) {\n\t\t\tawait Promise.allSettled(\n\t\t\t\tmap(\n\t\t\t\t\tfilter(log.commits.values(), c => c.files == null),\n\t\t\t\t\tc => c.ensureFullDetails(),\n\t\t\t\t),\n\t\t\t);\n\n\t\t\tfiles = [\n\t\t\t\t...flatMap(\n\t\t\t\t\tlog.commits.values(),\n\t\t\t\t\tc => c.files?.map<GitFileWithCommit>(f => ({ ...f, commit: c })) ?? [],\n\t\t\t\t),\n\t\t\t];\n\t\t} else {\n\t\t\tfiles = [];\n\t\t}\n\n\t\tfiles.sort((a, b) => b.commit.date.getTime() - a.commit.date.getTime());\n\n\t\tconst groups = groupBy(files, s => s.path);\n\n\t\tlet children: FileNode[] = Object.values(groups).map(\n\t\t\tfiles =>\n\t\t\t\tnew StatusFileNode(\n\t\t\t\t\tthis.view,\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.repoPath,\n\t\t\t\t\tfiles[files.length - 1],\n\t\t\t\t\tfiles.map(s => s.commit),\n\t\t\t\t),\n\t\t);\n\n\t\tif (this.view.config.files.layout !== ViewFilesLayout.List) {\n\t\t\tconst hierarchy = makeHierarchical(\n\t\t\t\tchildren,\n\t\t\t\tn => n.uri.relativePath.split('/'),\n\t\t\t\t(...parts: string[]) => normalizePath(joinPaths(...parts)),\n\t\t\t\tthis.view.config.files.compact,\n\t\t\t);\n\n\t\t\tconst root = new FolderNode(this.view, this, this.repoPath, '', hierarchy, false);\n\t\t\tchildren = root.getChildren() as FileNode[];\n\t\t} else {\n\t\t\tchildren.sort((a, b) => a.priority - b.priority || sortCompare(a.label!, b.label!));\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tconst stats = await this.view.container.git.getChangedFilesCount(\n\t\t\tthis.repoPath,\n\t\t\t`${this.status.upstream}${this.direction === 'behind' ? '..' : '...'}`,\n\t\t);\n\t\tconst files = stats?.changedFiles ?? 0;\n\n\t\tconst label = `${pluralize('file', files)} changed`;\n\t\tconst item = new TreeItem(label, TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.BranchStatusFiles;\n\n\t\treturn item;\n\t}\n}\n","import { Command, MarkdownString, Selection, TreeItem, TreeItemCollapsibleState, Uri } from 'vscode';\nimport type { DiffWithPreviousCommandArgs } from '../../commands';\nimport { Commands } from '../../constants';\nimport { StatusFileFormatter } from '../../git/formatters';\nimport { GitUri } from '../../git/gitUri';\nimport { GitBranch, GitCommit, GitFile, GitRevisionReference } from '../../git/models';\nimport { joinPaths, relativeDir } from '../../system/path';\nimport { FileHistoryView } from '../fileHistoryView';\nimport { View, ViewsWithCommits } from '../viewBase';\nimport { ContextValues, ViewNode, ViewRefFileNode } from './viewNode';\n\nexport class CommitFileNode<TView extends View = ViewsWithCommits | FileHistoryView> extends ViewRefFileNode<TView> {\n\tconstructor(\n\t\tview: TView,\n\t\tparent: ViewNode,\n\t\tpublic readonly file: GitFile,\n\t\tpublic commit: GitCommit,\n\t\tprivate readonly _options: {\n\t\t\tbranch?: GitBranch;\n\t\t\tselection?: Selection;\n\t\t\tunpublished?: boolean;\n\t\t} = {},\n\t) {\n\t\tsuper(GitUri.fromFile(file, commit.repoPath, commit.sha), view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.fileName;\n\t}\n\n\tget fileName(): string {\n\t\treturn this.file.path;\n\t}\n\n\tget priority(): number {\n\t\treturn 0;\n\t}\n\n\tget ref(): GitRevisionReference {\n\t\treturn this.commit;\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\treturn [];\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tif (this.commit.file == null) {\n\t\t\t// Try to get the commit directly from the multi-file commit\n\t\t\tconst commit = await this.commit.getCommitForFile(this.file);\n\t\t\tif (commit == null) {\n\t\t\t\tconst log = await this.view.container.git.getLogForFile(this.repoPath, this.file.path, {\n\t\t\t\t\tlimit: 2,\n\t\t\t\t\tref: this.commit.sha,\n\t\t\t\t});\n\t\t\t\tif (log != null) {\n\t\t\t\t\tthis.commit = log.commits.get(this.commit.sha) ?? this.commit;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.commit = commit;\n\t\t\t}\n\t\t}\n\n\t\tconst item = new TreeItem(this.label, TreeItemCollapsibleState.None);\n\t\titem.contextValue = this.contextValue;\n\t\titem.description = this.description;\n\t\titem.resourceUri = Uri.parse(`gitlens-view://commit-file/status/${this.file.status}`);\n\t\titem.tooltip = this.tooltip;\n\n\t\tconst icon = GitFile.getStatusIcon(this.file.status);\n\t\titem.iconPath = {\n\t\t\tdark: this.view.container.context.asAbsolutePath(joinPaths('images', 'dark', icon)),\n\t\t\tlight: this.view.container.context.asAbsolutePath(joinPaths('images', 'light', icon)),\n\t\t};\n\n\t\titem.command = this.getCommand();\n\n\t\t// Only cache the label for a single refresh (its only cached because it is used externally for sorting)\n\t\tthis._label = undefined;\n\n\t\treturn item;\n\t}\n\n\tprotected get contextValue(): string {\n\t\tif (!this.commit.isUncommitted) {\n\t\t\treturn `${ContextValues.File}+committed${this._options.branch?.current ? '+current' : ''}${\n\t\t\t\tthis._options.branch?.current && this._options.branch.sha === this.commit.ref ? '+HEAD' : ''\n\t\t\t}${this._options.unpublished ? '+unpublished' : ''}`;\n\t\t}\n\n\t\treturn this.commit.isUncommittedStaged ? `${ContextValues.File}+staged` : `${ContextValues.File}+unstaged`;\n\t}\n\n\tprivate get description() {\n\t\treturn StatusFileFormatter.fromTemplate(this.view.config.formats.files.description, this.file, {\n\t\t\trelativePath: this.relativePath,\n\t\t});\n\t}\n\n\tprivate _folderName: string | undefined;\n\tget folderName() {\n\t\tif (this._folderName === undefined) {\n\t\t\tthis._folderName = relativeDir(this.uri.relativePath);\n\t\t}\n\t\treturn this._folderName;\n\t}\n\n\tprivate _label: string | undefined;\n\tget label() {\n\t\tif (this._label === undefined) {\n\t\t\tthis._label = StatusFileFormatter.fromTemplate(this.view.config.formats.files.label, this.file, {\n\t\t\t\trelativePath: this.relativePath,\n\t\t\t});\n\t\t}\n\t\treturn this._label;\n\t}\n\n\tprivate _relativePath: string | undefined;\n\tget relativePath(): string | undefined {\n\t\treturn this._relativePath;\n\t}\n\tset relativePath(value: string | undefined) {\n\t\tthis._relativePath = value;\n\t\tthis._label = undefined;\n\t}\n\n\tprivate get tooltip() {\n\t\tconst tooltip = StatusFileFormatter.fromTemplate(\n\t\t\t`\\${file}\\${'&nbsp;&nbsp;\\u2022&nbsp;&nbsp;'changesDetail}\\\\\\\\\\n\\${directory}\\n\\n\\${status}\\${ (originalPath)}`,\n\t\t\tthis.file,\n\t\t);\n\n\t\tconst markdown = new MarkdownString(tooltip, true);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\n\t\treturn markdown;\n\t}\n\n\toverride getCommand(): Command | undefined {\n\t\tlet line;\n\t\tif (this.commit.lines.length) {\n\t\t\tline = this.commit.lines[0].line - 1;\n\t\t} else {\n\t\t\tline = this._options.selection?.active.line ?? 0;\n\t\t}\n\n\t\tconst commandArgs: DiffWithPreviousCommandArgs = {\n\t\t\tcommit: this.commit,\n\t\t\turi: GitUri.fromFile(this.file, this.commit.repoPath),\n\t\t\tline: line,\n\t\t\tshowOptions: {\n\t\t\t\tpreserveFocus: true,\n\t\t\t\tpreview: true,\n\t\t\t},\n\t\t};\n\t\treturn {\n\t\t\ttitle: 'Open Changes with Previous Revision',\n\t\t\tcommand: Commands.DiffWithPrevious,\n\t\t\targuments: [undefined, commandArgs],\n\t\t};\n\t}\n}\n","import Stack from './_Stack.js';\nimport baseIsEqual from './_baseIsEqual.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/**\n * The base implementation of `_.isMatch` without support for iteratee shorthands.\n *\n * @private\n * @param {Object} object The object to inspect.\n * @param {Object} source The object of property values to match.\n * @param {Array} matchData The property names, values, and compare flags to match.\n * @param {Function} [customizer] The function to customize comparisons.\n * @returns {boolean} Returns `true` if `object` is a match, else `false`.\n */\nfunction baseIsMatch(object, source, matchData, customizer) {\n  var index = matchData.length,\n      length = index,\n      noCustomizer = !customizer;\n\n  if (object == null) {\n    return !length;\n  }\n  object = Object(object);\n  while (index--) {\n    var data = matchData[index];\n    if ((noCustomizer && data[2])\n          ? data[1] !== object[data[0]]\n          : !(data[0] in object)\n        ) {\n      return false;\n    }\n  }\n  while (++index < length) {\n    data = matchData[index];\n    var key = data[0],\n        objValue = object[key],\n        srcValue = data[1];\n\n    if (noCustomizer && data[2]) {\n      if (objValue === undefined && !(key in object)) {\n        return false;\n      }\n    } else {\n      var stack = new Stack;\n      if (customizer) {\n        var result = customizer(objValue, srcValue, key, object, source, stack);\n      }\n      if (!(result === undefined\n            ? baseIsEqual(srcValue, objValue, COMPARE_PARTIAL_FLAG | COMPARE_UNORDERED_FLAG, customizer, stack)\n            : result\n          )) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\nexport default baseIsMatch;\n","import isObject from './isObject.js';\n\n/**\n * Checks if `value` is suitable for strict equality comparisons, i.e. `===`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` if suitable for strict\n *  equality comparisons, else `false`.\n */\nfunction isStrictComparable(value) {\n  return value === value && !isObject(value);\n}\n\nexport default isStrictComparable;\n","import isStrictComparable from './_isStrictComparable.js';\nimport keys from './keys.js';\n\n/**\n * Gets the property names, values, and compare flags of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the match data of `object`.\n */\nfunction getMatchData(object) {\n  var result = keys(object),\n      length = result.length;\n\n  while (length--) {\n    var key = result[length],\n        value = object[key];\n\n    result[length] = [key, value, isStrictComparable(value)];\n  }\n  return result;\n}\n\nexport default getMatchData;\n","/**\n * A specialized version of `matchesProperty` for source values suitable\n * for strict equality comparisons, i.e. `===`.\n *\n * @private\n * @param {string} key The key of the property to get.\n * @param {*} srcValue The value to match.\n * @returns {Function} Returns the new spec function.\n */\nfunction matchesStrictComparable(key, srcValue) {\n  return function(object) {\n    if (object == null) {\n      return false;\n    }\n    return object[key] === srcValue &&\n      (srcValue !== undefined || (key in Object(object)));\n  };\n}\n\nexport default matchesStrictComparable;\n","import baseIsMatch from './_baseIsMatch.js';\nimport getMatchData from './_getMatchData.js';\nimport matchesStrictComparable from './_matchesStrictComparable.js';\n\n/**\n * The base implementation of `_.matches` which doesn't clone `source`.\n *\n * @private\n * @param {Object} source The object of property values to match.\n * @returns {Function} Returns the new spec function.\n */\nfunction baseMatches(source) {\n  var matchData = getMatchData(source);\n  if (matchData.length == 1 && matchData[0][2]) {\n    return matchesStrictComparable(matchData[0][0], matchData[0][1]);\n  }\n  return function(object) {\n    return object === source || baseIsMatch(object, source, matchData);\n  };\n}\n\nexport default baseMatches;\n","import isArray from './isArray.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used to match property names within property paths. */\nvar reIsDeepProp = /\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,\n    reIsPlainProp = /^\\w*$/;\n\n/**\n * Checks if `value` is a property name and not a property path.\n *\n * @private\n * @param {*} value The value to check.\n * @param {Object} [object] The object to query keys on.\n * @returns {boolean} Returns `true` if `value` is a property name, else `false`.\n */\nfunction isKey(value, object) {\n  if (isArray(value)) {\n    return false;\n  }\n  var type = typeof value;\n  if (type == 'number' || type == 'symbol' || type == 'boolean' ||\n      value == null || isSymbol(value)) {\n    return true;\n  }\n  return reIsPlainProp.test(value) || !reIsDeepProp.test(value) ||\n    (object != null && value in Object(object));\n}\n\nexport default isKey;\n","import MapCache from './_MapCache.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a function that memoizes the result of `func`. If `resolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key. The `func`\n * is invoked with the `this` binding of the memoized function.\n *\n * **Note:** The cache is exposed as the `cache` property on the memoized\n * function. Its creation may be customized by replacing the `_.memoize.Cache`\n * constructor with one whose instances implement the\n * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n * method interface of `clear`, `delete`, `get`, `has`, and `set`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to have its output memoized.\n * @param {Function} [resolver] The function to resolve the cache key.\n * @returns {Function} Returns the new memoized function.\n * @example\n *\n * var object = { 'a': 1, 'b': 2 };\n * var other = { 'c': 3, 'd': 4 };\n *\n * var values = _.memoize(_.values);\n * values(object);\n * // => [1, 2]\n *\n * values(other);\n * // => [3, 4]\n *\n * object.a = 2;\n * values(object);\n * // => [1, 2]\n *\n * // Modify the result cache.\n * values.cache.set(object, ['a', 'b']);\n * values(object);\n * // => ['a', 'b']\n *\n * // Replace `_.memoize.Cache`.\n * _.memoize.Cache = WeakMap;\n */\nfunction memoize(func, resolver) {\n  if (typeof func != 'function' || (resolver != null && typeof resolver != 'function')) {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  var memoized = function() {\n    var args = arguments,\n        key = resolver ? resolver.apply(this, args) : args[0],\n        cache = memoized.cache;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    memoized.cache = cache.set(key, result) || cache;\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || MapCache);\n  return memoized;\n}\n\n// Expose `MapCache`.\nmemoize.Cache = MapCache;\n\nexport default memoize;\n","import memoize from './memoize.js';\n\n/** Used as the maximum memoize cache size. */\nvar MAX_MEMOIZE_SIZE = 500;\n\n/**\n * A specialized version of `_.memoize` which clears the memoized function's\n * cache when it exceeds `MAX_MEMOIZE_SIZE`.\n *\n * @private\n * @param {Function} func The function to have its output memoized.\n * @returns {Function} Returns the new memoized function.\n */\nfunction memoizeCapped(func) {\n  var result = memoize(func, function(key) {\n    if (cache.size === MAX_MEMOIZE_SIZE) {\n      cache.clear();\n    }\n    return key;\n  });\n\n  var cache = result.cache;\n  return result;\n}\n\nexport default memoizeCapped;\n","import memoizeCapped from './_memoizeCapped.js';\n\n/** Used to match property names within property paths. */\nvar rePropName = /[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g;\n\n/** Used to match backslashes in property paths. */\nvar reEscapeChar = /\\\\(\\\\)?/g;\n\n/**\n * Converts `string` to a property path array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the property path array.\n */\nvar stringToPath = memoizeCapped(function(string) {\n  var result = [];\n  if (string.charCodeAt(0) === 46 /* . */) {\n    result.push('');\n  }\n  string.replace(rePropName, function(match, number, quote, subString) {\n    result.push(quote ? subString.replace(reEscapeChar, '$1') : (number || match));\n  });\n  return result;\n});\n\nexport default stringToPath;\n","import Symbol from './_Symbol.js';\nimport arrayMap from './_arrayMap.js';\nimport isArray from './isArray.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isArray(value)) {\n    // Recursively convert values (susceptible to call stack limits).\n    return arrayMap(value, baseToString) + '';\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\nexport default baseToString;\n","import baseToString from './_baseToString.js';\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\nexport default toString;\n","import isArray from './isArray.js';\nimport isKey from './_isKey.js';\nimport stringToPath from './_stringToPath.js';\nimport toString from './toString.js';\n\n/**\n * Casts `value` to a path array if it's not one.\n *\n * @private\n * @param {*} value The value to inspect.\n * @param {Object} [object] The object to query keys on.\n * @returns {Array} Returns the cast property path array.\n */\nfunction castPath(value, object) {\n  if (isArray(value)) {\n    return value;\n  }\n  return isKey(value, object) ? [value] : stringToPath(toString(value));\n}\n\nexport default castPath;\n","import isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/**\n * Converts `value` to a string key if it's not a string or symbol.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {string|symbol} Returns the key.\n */\nfunction toKey(value) {\n  if (typeof value == 'string' || isSymbol(value)) {\n    return value;\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\nexport default toKey;\n","import castPath from './_castPath.js';\nimport toKey from './_toKey.js';\n\n/**\n * The base implementation of `_.get` without support for default values.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @returns {*} Returns the resolved value.\n */\nfunction baseGet(object, path) {\n  path = castPath(path, object);\n\n  var index = 0,\n      length = path.length;\n\n  while (object != null && index < length) {\n    object = object[toKey(path[index++])];\n  }\n  return (index && index == length) ? object : undefined;\n}\n\nexport default baseGet;\n","import baseGet from './_baseGet.js';\n\n/**\n * Gets the value at `path` of `object`. If the resolved value is\n * `undefined`, the `defaultValue` is returned in its place.\n *\n * @static\n * @memberOf _\n * @since 3.7.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @param {*} [defaultValue] The value returned for `undefined` resolved values.\n * @returns {*} Returns the resolved value.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n *\n * _.get(object, 'a[0].b.c');\n * // => 3\n *\n * _.get(object, ['a', '0', 'b', 'c']);\n * // => 3\n *\n * _.get(object, 'a.b.c', 'default');\n * // => 'default'\n */\nfunction get(object, path, defaultValue) {\n  var result = object == null ? undefined : baseGet(object, path);\n  return result === undefined ? defaultValue : result;\n}\n\nexport default get;\n","/**\n * The base implementation of `_.hasIn` without support for deep paths.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {Array|string} key The key to check.\n * @returns {boolean} Returns `true` if `key` exists, else `false`.\n */\nfunction baseHasIn(object, key) {\n  return object != null && key in Object(object);\n}\n\nexport default baseHasIn;\n","import castPath from './_castPath.js';\nimport isArguments from './isArguments.js';\nimport isArray from './isArray.js';\nimport isIndex from './_isIndex.js';\nimport isLength from './isLength.js';\nimport toKey from './_toKey.js';\n\n/**\n * Checks if `path` exists on `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path to check.\n * @param {Function} hasFunc The function to check properties.\n * @returns {boolean} Returns `true` if `path` exists, else `false`.\n */\nfunction hasPath(object, path, hasFunc) {\n  path = castPath(path, object);\n\n  var index = -1,\n      length = path.length,\n      result = false;\n\n  while (++index < length) {\n    var key = toKey(path[index]);\n    if (!(result = object != null && hasFunc(object, key))) {\n      break;\n    }\n    object = object[key];\n  }\n  if (result || ++index != length) {\n    return result;\n  }\n  length = object == null ? 0 : object.length;\n  return !!length && isLength(length) && isIndex(key, length) &&\n    (isArray(object) || isArguments(object));\n}\n\nexport default hasPath;\n","import baseHasIn from './_baseHasIn.js';\nimport hasPath from './_hasPath.js';\n\n/**\n * Checks if `path` is a direct or inherited property of `object`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path to check.\n * @returns {boolean} Returns `true` if `path` exists, else `false`.\n * @example\n *\n * var object = _.create({ 'a': _.create({ 'b': 2 }) });\n *\n * _.hasIn(object, 'a');\n * // => true\n *\n * _.hasIn(object, 'a.b');\n * // => true\n *\n * _.hasIn(object, ['a', 'b']);\n * // => true\n *\n * _.hasIn(object, 'b');\n * // => false\n */\nfunction hasIn(object, path) {\n  return object != null && hasPath(object, path, baseHasIn);\n}\n\nexport default hasIn;\n","import baseIsEqual from './_baseIsEqual.js';\nimport get from './get.js';\nimport hasIn from './hasIn.js';\nimport isKey from './_isKey.js';\nimport isStrictComparable from './_isStrictComparable.js';\nimport matchesStrictComparable from './_matchesStrictComparable.js';\nimport toKey from './_toKey.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/**\n * The base implementation of `_.matchesProperty` which doesn't clone `srcValue`.\n *\n * @private\n * @param {string} path The path of the property to get.\n * @param {*} srcValue The value to match.\n * @returns {Function} Returns the new spec function.\n */\nfunction baseMatchesProperty(path, srcValue) {\n  if (isKey(path) && isStrictComparable(srcValue)) {\n    return matchesStrictComparable(toKey(path), srcValue);\n  }\n  return function(object) {\n    var objValue = get(object, path);\n    return (objValue === undefined && objValue === srcValue)\n      ? hasIn(object, path)\n      : baseIsEqual(srcValue, objValue, COMPARE_PARTIAL_FLAG | COMPARE_UNORDERED_FLAG);\n  };\n}\n\nexport default baseMatchesProperty;\n","/**\n * The base implementation of `_.property` without support for deep paths.\n *\n * @private\n * @param {string} key The key of the property to get.\n * @returns {Function} Returns the new accessor function.\n */\nfunction baseProperty(key) {\n  return function(object) {\n    return object == null ? undefined : object[key];\n  };\n}\n\nexport default baseProperty;\n","import baseGet from './_baseGet.js';\n\n/**\n * A specialized version of `baseProperty` which supports deep paths.\n *\n * @private\n * @param {Array|string} path The path of the property to get.\n * @returns {Function} Returns the new accessor function.\n */\nfunction basePropertyDeep(path) {\n  return function(object) {\n    return baseGet(object, path);\n  };\n}\n\nexport default basePropertyDeep;\n","import baseProperty from './_baseProperty.js';\nimport basePropertyDeep from './_basePropertyDeep.js';\nimport isKey from './_isKey.js';\nimport toKey from './_toKey.js';\n\n/**\n * Creates a function that returns the value at `path` of a given object.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Util\n * @param {Array|string} path The path of the property to get.\n * @returns {Function} Returns the new accessor function.\n * @example\n *\n * var objects = [\n *   { 'a': { 'b': 2 } },\n *   { 'a': { 'b': 1 } }\n * ];\n *\n * _.map(objects, _.property('a.b'));\n * // => [2, 1]\n *\n * _.map(_.sortBy(objects, _.property(['a', 'b'])), 'a.b');\n * // => [1, 2]\n */\nfunction property(path) {\n  return isKey(path) ? baseProperty(toKey(path)) : basePropertyDeep(path);\n}\n\nexport default property;\n","import baseMatches from './_baseMatches.js';\nimport baseMatchesProperty from './_baseMatchesProperty.js';\nimport identity from './identity.js';\nimport isArray from './isArray.js';\nimport property from './property.js';\n\n/**\n * The base implementation of `_.iteratee`.\n *\n * @private\n * @param {*} [value=_.identity] The value to convert to an iteratee.\n * @returns {Function} Returns the iteratee.\n */\nfunction baseIteratee(value) {\n  // Don't store the `typeof` result in a variable to avoid a JIT bug in Safari 9.\n  // See https://bugs.webkit.org/show_bug.cgi?id=156034 for more details.\n  if (typeof value == 'function') {\n    return value;\n  }\n  if (value == null) {\n    return identity;\n  }\n  if (typeof value == 'object') {\n    return isArray(value)\n      ? baseMatchesProperty(value[0], value[1])\n      : baseMatches(value);\n  }\n  return property(value);\n}\n\nexport default baseIteratee;\n","import baseFindIndex from './_baseFindIndex.js';\nimport baseIteratee from './_baseIteratee.js';\nimport toInteger from './toInteger.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * This method is like `_.findIndex` except that it iterates over elements\n * of `collection` from right to left.\n *\n * @static\n * @memberOf _\n * @since 2.0.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @param {Function} [predicate=_.identity] The function invoked per iteration.\n * @param {number} [fromIndex=array.length-1] The index to search from.\n * @returns {number} Returns the index of the found element, else `-1`.\n * @example\n *\n * var users = [\n *   { 'user': 'barney',  'active': true },\n *   { 'user': 'fred',    'active': false },\n *   { 'user': 'pebbles', 'active': false }\n * ];\n *\n * _.findLastIndex(users, function(o) { return o.user == 'pebbles'; });\n * // => 2\n *\n * // The `_.matches` iteratee shorthand.\n * _.findLastIndex(users, { 'user': 'barney', 'active': true });\n * // => 0\n *\n * // The `_.matchesProperty` iteratee shorthand.\n * _.findLastIndex(users, ['active', false]);\n * // => 2\n *\n * // The `_.property` iteratee shorthand.\n * _.findLastIndex(users, 'active');\n * // => 0\n */\nfunction findLastIndex(array, predicate, fromIndex) {\n  var length = array == null ? 0 : array.length;\n  if (!length) {\n    return -1;\n  }\n  var index = length - 1;\n  if (fromIndex !== undefined) {\n    index = toInteger(fromIndex);\n    index = fromIndex < 0\n      ? nativeMax(length + index, 0)\n      : nativeMin(index, length - 1);\n  }\n  return baseFindIndex(array, baseIteratee(predicate, 3), index, true);\n}\n\nexport default findLastIndex;\n","import { TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GitUri } from '../../git/gitUri';\nimport { GitFile, GitLog, GitRemote, IssueOrPullRequest, PullRequest } from '../../git/models';\nimport { RichRemoteProvider } from '../../git/remotes/provider';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { PromiseCancelledErrorWithId } from '../../system/promise';\nimport { ViewsWithCommits } from '../viewBase';\nimport { AutolinkedItemNode } from './autolinkedItemNode';\nimport { MessageNode } from './common';\nimport { PullRequestNode } from './pullRequestNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport interface FilesQueryResults {\n\tlabel: string;\n\tfiles: GitFile[] | undefined;\n\tfiltered?: {\n\t\tfilter: 'left' | 'right';\n\t\tfiles: GitFile[];\n\t};\n}\n\nlet instanceId = 0;\n\nexport class AutolinkedItemsNode extends ViewNode<ViewsWithCommits> {\n\tprivate _children: ViewNode[] | undefined;\n\tprivate _instanceId: number;\n\n\tconstructor(\n\t\tview: ViewsWithCommits,\n\t\tparent: ViewNode,\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly remote: GitRemote<RichRemoteProvider>,\n\t\tpublic readonly log: GitLog,\n\t) {\n\t\tsuper(GitUri.fromRepoPath(repoPath), view, parent);\n\t\tthis._instanceId = instanceId++;\n\t}\n\n\toverride get id(): string {\n\t\treturn `${this.parent!.id}:results:autolinked:${this._instanceId}`;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._children == null) {\n\t\t\tconst commits = [...this.log.commits.values()];\n\n\t\t\tlet children: ViewNode[] | undefined;\n\t\t\tif (commits.length) {\n\t\t\t\tconst combineMessages = commits.map(c => c.message).join('\\n');\n\n\t\t\t\tconst [autolinkedMapResult /*, ...prsResults*/] = await Promise.allSettled([\n\t\t\t\t\tthis.view.container.autolinks.getIssueOrPullRequestLinks(combineMessages, this.remote),\n\t\t\t\t\t// Only get PRs from the first 100 commits to attempt to avoid hitting the api limits\n\t\t\t\t\t// ...commits.slice(0, 100).map(c => this.remote.provider.getPullRequestForCommit(c.sha)),\n\t\t\t\t]);\n\n\t\t\t\tconst items = new Map<string, IssueOrPullRequest | PullRequest>();\n\n\t\t\t\tif (autolinkedMapResult.status === 'fulfilled' && autolinkedMapResult.value != null) {\n\t\t\t\t\tfor (const [id, issue] of autolinkedMapResult.value) {\n\t\t\t\t\t\tif (issue == null || issue instanceof PromiseCancelledErrorWithId) continue;\n\n\t\t\t\t\t\titems.set(id, issue);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// for (const result of prsResults) {\n\t\t\t\t// \tif (result.status !== 'fulfilled' || result.value == null) continue;\n\n\t\t\t\t// \titems.set(result.value.id, result.value);\n\t\t\t\t// }\n\n\t\t\t\tchildren = [...items.values()].map(item =>\n\t\t\t\t\tPullRequest.is(item)\n\t\t\t\t\t\t? new PullRequestNode(this.view, this, item, this.log.repoPath)\n\t\t\t\t\t\t: new AutolinkedItemNode(this.view, this, this.repoPath, item),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (children == null || children.length === 0) {\n\t\t\t\tchildren = [new MessageNode(this.view, this, 'No autolinked issues or pull requests could be found.')];\n\t\t\t}\n\n\t\t\tthis._children = children;\n\t\t}\n\t\treturn this._children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Autolinked Issues and Pull Requests', TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.AutolinkedItems;\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset: boolean = false) {\n\t\tif (!reset) return;\n\n\t\tthis._children = undefined;\n\t}\n}\n","import { GitCommit } from '../../git/models';\nimport { MessageNode } from './common';\nimport { ContextValues, ViewNode } from './viewNode';\n\nconst markers: [number, string][] = [\n\t[0, 'Less than a week ago'],\n\t[7, 'Over a week ago'],\n\t[25, 'Over a month ago'],\n\t[77, 'Over 3 months ago'],\n];\n\nexport function* insertDateMarkers<T extends ViewNode & { commit: GitCommit }>(\n\titerable: Iterable<T>,\n\tparent: ViewNode,\n\tskip?: number,\n\t{ show }: { show: boolean } = { show: true },\n): Iterable<ViewNode> {\n\tif (!parent.view.config.showRelativeDateMarkers || !show) {\n\t\treturn yield* iterable;\n\t}\n\n\tlet index = skip ?? 0;\n\tlet time = undefined;\n\tconst now = Date.now();\n\n\tlet first = true;\n\n\tfor (const node of iterable) {\n\t\tif (index < markers.length) {\n\t\t\tlet [daysAgo, marker] = markers[index];\n\t\t\tif (time === undefined) {\n\t\t\t\tconst date = new Date(now);\n\t\t\t\ttime = date.setDate(date.getDate() - daysAgo);\n\t\t\t}\n\n\t\t\tconst date = new Date(node.commit.committer.date).setUTCHours(0, 0, 0, 0);\n\t\t\tif (date <= time) {\n\t\t\t\twhile (index < markers.length - 1) {\n\t\t\t\t\t[daysAgo] = markers[index + 1];\n\t\t\t\t\tconst nextDate = new Date(now);\n\t\t\t\t\tconst nextTime = nextDate.setDate(nextDate.getDate() - daysAgo);\n\n\t\t\t\t\tif (date > nextTime) break;\n\n\t\t\t\t\tindex++;\n\t\t\t\t\ttime = undefined;\n\t\t\t\t\t[, marker] = markers[index];\n\t\t\t\t}\n\n\t\t\t\t// Don't show the marker if it is the first node\n\t\t\t\tif (!first) {\n\t\t\t\t\tyield new MessageNode(\n\t\t\t\t\t\tparent.view,\n\t\t\t\t\t\tparent,\n\t\t\t\t\t\t'',\n\t\t\t\t\t\tmarker,\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tContextValues.DateMarker,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tindex++;\n\t\t\t\ttime = undefined;\n\t\t\t}\n\t\t}\n\n\t\tfirst = false;\n\t\tyield node;\n\t}\n\n\treturn undefined;\n}\n","import { Command, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport type { DiffWithCommandArgs } from '../../commands';\nimport { Commands } from '../../constants';\nimport { StatusFileFormatter } from '../../git/formatters';\nimport { GitUri } from '../../git/gitUri';\nimport { GitFile, GitReference, GitRevisionReference } from '../../git/models';\nimport { joinPaths, relativeDir } from '../../system/path';\nimport { View } from '../viewBase';\nimport { FileNode } from './folderNode';\nimport { ContextValues, ViewNode, ViewRefFileNode } from './viewNode';\n\nexport class ResultsFileNode extends ViewRefFileNode implements FileNode {\n\tconstructor(\n\t\tview: View,\n\t\tparent: ViewNode,\n\t\trepoPath: string,\n\t\tpublic readonly file: GitFile,\n\t\tpublic readonly ref1: string,\n\t\tpublic readonly ref2: string,\n\t\tprivate readonly direction: 'ahead' | 'behind' | undefined,\n\t) {\n\t\tsuper(GitUri.fromFile(file, repoPath, ref1 || ref2), view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.fileName;\n\t}\n\n\tget fileName(): string {\n\t\treturn this.file.path;\n\t}\n\n\tget ref(): GitRevisionReference {\n\t\treturn GitReference.create(this.ref1 || this.ref2, this.uri.repoPath!);\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\treturn [];\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(this.label, TreeItemCollapsibleState.None);\n\t\titem.contextValue = ContextValues.ResultsFile;\n\t\titem.description = this.description;\n\t\titem.tooltip = StatusFileFormatter.fromTemplate(\n\t\t\t`\\${file}\\n\\${directory}/\\n\\n\\${status}\\${ (originalPath)}`,\n\t\t\tthis.file,\n\t\t);\n\n\t\tconst statusIcon = GitFile.getStatusIcon(this.file.status);\n\t\titem.iconPath = {\n\t\t\tdark: this.view.container.context.asAbsolutePath(joinPaths('images', 'dark', statusIcon)),\n\t\t\tlight: this.view.container.context.asAbsolutePath(joinPaths('images', 'light', statusIcon)),\n\t\t};\n\n\t\titem.command = this.getCommand();\n\t\treturn item;\n\t}\n\n\tprivate _description: string | undefined;\n\tget description() {\n\t\tif (this._description === undefined) {\n\t\t\tthis._description = StatusFileFormatter.fromTemplate(\n\t\t\t\tthis.view.config.formats.files.description,\n\t\t\t\tthis.file,\n\t\t\t\t{\n\t\t\t\t\trelativePath: this.relativePath,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\treturn this._description;\n\t}\n\n\tprivate _folderName: string | undefined;\n\tget folderName() {\n\t\tif (this._folderName === undefined) {\n\t\t\tthis._folderName = relativeDir(this.uri.relativePath);\n\t\t}\n\t\treturn this._folderName;\n\t}\n\n\tprivate _label: string | undefined;\n\tget label() {\n\t\tif (this._label === undefined) {\n\t\t\tthis._label = StatusFileFormatter.fromTemplate(this.view.config.formats.files.label, this.file, {\n\t\t\t\trelativePath: this.relativePath,\n\t\t\t});\n\t\t}\n\t\treturn this._label;\n\t}\n\n\tprivate _relativePath: string | undefined;\n\tget relativePath(): string | undefined {\n\t\treturn this._relativePath;\n\t}\n\tset relativePath(value: string | undefined) {\n\t\tthis._relativePath = value;\n\t\tthis._label = undefined;\n\t\tthis._description = undefined;\n\t}\n\n\tget priority(): number {\n\t\treturn 0;\n\t}\n\n\toverride getCommand(): Command | undefined {\n\t\tconst commandArgs: DiffWithCommandArgs = {\n\t\t\tlhs: {\n\t\t\t\tsha: this.ref1,\n\t\t\t\turi:\n\t\t\t\t\t(this.file.status === 'R' || this.file.status === 'C') && this.direction === 'behind'\n\t\t\t\t\t\t? GitUri.fromFile(this.file, this.uri.repoPath!, this.ref2, true)\n\t\t\t\t\t\t: this.uri,\n\t\t\t},\n\t\t\trhs: {\n\t\t\t\tsha: this.ref2,\n\t\t\t\turi:\n\t\t\t\t\t(this.file.status === 'R' || this.file.status === 'C') && this.direction !== 'behind'\n\t\t\t\t\t\t? GitUri.fromFile(this.file, this.uri.repoPath!, this.ref2, true)\n\t\t\t\t\t\t: this.uri,\n\t\t\t},\n\t\t\trepoPath: this.uri.repoPath!,\n\n\t\t\tline: 0,\n\t\t\tshowOptions: {\n\t\t\t\tpreserveFocus: true,\n\t\t\t\tpreview: true,\n\t\t\t},\n\t\t};\n\t\treturn {\n\t\t\ttitle: 'Open Changes',\n\t\t\tcommand: Commands.DiffWith,\n\t\t\targuments: [commandArgs],\n\t\t};\n\t}\n}\n","import { ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { ViewFilesLayout } from '../../configuration';\nimport { GitUri } from '../../git/gitUri';\nimport { GitFile } from '../../git/models';\nimport { makeHierarchical } from '../../system/array';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { map } from '../../system/iterable';\nimport { joinPaths, normalizePath } from '../../system/path';\nimport { cancellable, PromiseCancelledError } from '../../system/promise';\nimport { sortCompare } from '../../system/string';\nimport { ViewsWithCommits } from '../viewBase';\nimport { FileNode, FolderNode } from './folderNode';\nimport { ResultsFileNode } from './resultsFileNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport interface FilesQueryResults {\n\tlabel: string;\n\tfiles: GitFile[] | undefined;\n\tfiltered?: {\n\t\tfilter: 'left' | 'right';\n\t\tfiles: GitFile[];\n\t};\n}\n\nexport class ResultsFilesNode extends ViewNode<ViewsWithCommits> {\n\tconstructor(\n\t\tview: ViewsWithCommits,\n\t\tparent: ViewNode,\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly ref1: string,\n\t\tpublic readonly ref2: string,\n\t\tprivate readonly _filesQuery: () => Promise<FilesQueryResults>,\n\t\tprivate readonly direction: 'ahead' | 'behind' | undefined,\n\t\tprivate readonly _options: {\n\t\t\texpand?: boolean;\n\t\t} = {},\n\t) {\n\t\tsuper(GitUri.fromRepoPath(repoPath), view, parent);\n\n\t\tthis._options = { expand: true, ..._options };\n\t}\n\n\toverride get id(): string {\n\t\treturn `${this.parent!.id}:results:files`;\n\t}\n\n\tprivate _filter: 'left' | 'right' | false = false;\n\tget filter(): 'left' | 'right' | false {\n\t\treturn this._filter;\n\t}\n\tset filter(value: 'left' | 'right' | false) {\n\t\tif (this._filter === value) return;\n\n\t\tthis._filter = value;\n\t\tthis._filterResults = undefined;\n\n\t\tvoid this.triggerChange(false);\n\t}\n\n\tget filterable(): boolean {\n\t\treturn this.filtered || (this.ref1 !== this.ref2 && this.direction === undefined);\n\t}\n\n\tget filtered(): boolean {\n\t\treturn Boolean(this.filter);\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tconst results = await this.getFilesQueryResults();\n\t\tconst files = (this.filtered ? results.filtered?.files : undefined) ?? results.files;\n\t\tif (files == null) return [];\n\n\t\tlet children: FileNode[] = [\n\t\t\t...map(\n\t\t\t\tfiles,\n\t\t\t\ts => new ResultsFileNode(this.view, this, this.repoPath, s, this.ref1, this.ref2, this.direction),\n\t\t\t),\n\t\t];\n\n\t\tif (this.view.config.files.layout !== ViewFilesLayout.List) {\n\t\t\tconst hierarchy = makeHierarchical(\n\t\t\t\tchildren,\n\t\t\t\tn => n.uri.relativePath.split('/'),\n\t\t\t\t(...parts: string[]) => normalizePath(joinPaths(...parts)),\n\t\t\t\tthis.view.config.files.compact,\n\t\t\t);\n\n\t\t\tconst root = new FolderNode(this.view, this, this.repoPath, '', hierarchy);\n\t\t\tchildren = root.getChildren() as FileNode[];\n\t\t} else {\n\t\t\tchildren.sort((a, b) => a.priority - b.priority || sortCompare(a.label!, b.label!));\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tlet label;\n\t\tlet icon;\n\t\tlet files: GitFile[] | undefined;\n\t\tlet state;\n\n\t\ttry {\n\t\t\tconst results = await cancellable(this.getFilesQueryResults(), 100);\n\t\t\tlabel = results.label;\n\t\t\tfiles = (this.filtered ? results.filtered?.files : undefined) ?? results.files;\n\n\t\t\tif (this.filtered && results.filtered == null) {\n\t\t\t\tlabel = 'files changed';\n\t\t\t\ticon = new ThemeIcon('ellipsis');\n\t\t\t}\n\n\t\t\tstate =\n\t\t\t\tfiles == null || files.length === 0\n\t\t\t\t\t? TreeItemCollapsibleState.None\n\t\t\t\t\t: this._options.expand\n\t\t\t\t\t? TreeItemCollapsibleState.Expanded\n\t\t\t\t\t: TreeItemCollapsibleState.Collapsed;\n\t\t} catch (ex) {\n\t\t\tif (ex instanceof PromiseCancelledError) {\n\t\t\t\tex.promise.then(() => queueMicrotask(() => this.triggerChange(false)));\n\t\t\t}\n\n\t\t\tlabel = 'files changed';\n\t\t\ticon = new ThemeIcon('ellipsis');\n\t\t\t// Need to use Collapsed before we have results or the item won't show up in the view until the children are awaited\n\t\t\t// https://github.com/microsoft/vscode/issues/54806 & https://github.com/microsoft/vscode/issues/62214\n\t\t\tstate = TreeItemCollapsibleState.Collapsed;\n\t\t}\n\n\t\tconst item = new TreeItem(\n\t\t\t`${this.filtered && files != null ? `Showing ${files.length} of ` : ''}${label}`,\n\t\t\tstate,\n\t\t);\n\t\titem.id = this.id;\n\t\titem.iconPath = icon;\n\t\titem.contextValue = `${ContextValues.ResultsFiles}${this.filterable ? '+filterable' : ''}${\n\t\t\tthis.filtered ? `+filtered~${this.filter}` : ''\n\t\t}`;\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset: boolean = false) {\n\t\tif (!reset) return;\n\n\t\tthis._filterResults = undefined;\n\t\tthis._filesQueryResults = this._filesQuery();\n\t}\n\n\tprivate _filesQueryResults: Promise<FilesQueryResults> | undefined;\n\tprivate _filterResults: Promise<void> | undefined;\n\n\tasync getFilesQueryResults() {\n\t\tif (this._filesQueryResults === undefined) {\n\t\t\tthis._filesQueryResults = this._filesQuery();\n\t\t}\n\n\t\tconst results = await this._filesQueryResults;\n\t\tif (\n\t\t\tresults.files == null ||\n\t\t\t!this.filterable ||\n\t\t\tthis.filter === false ||\n\t\t\tresults.filtered?.filter === this.filter\n\t\t) {\n\t\t\treturn results;\n\t\t}\n\n\t\tif (this._filterResults === undefined) {\n\t\t\tthis._filterResults = this.filterResults(this.filter, results);\n\t\t}\n\n\t\tawait this._filterResults;\n\n\t\treturn results;\n\t}\n\n\tprivate async filterResults(filter: 'left' | 'right', results: FilesQueryResults) {\n\t\tlet filterTo: Set<string> | undefined;\n\n\t\tconst ref = this.filter === 'left' ? this.ref2 : this.ref1;\n\n\t\tconst mergeBase = await this.view.container.git.getMergeBase(\n\t\t\tthis.repoPath,\n\t\t\tthis.ref1 || 'HEAD',\n\t\t\tthis.ref2 || 'HEAD',\n\t\t);\n\t\tif (mergeBase != null) {\n\t\t\tconst files = await this.view.container.git.getDiffStatus(this.uri.repoPath!, `${mergeBase}..${ref}`);\n\t\t\tif (files != null) {\n\t\t\t\tfilterTo = new Set<string>(files.map(f => f.path));\n\t\t\t}\n\t\t} else {\n\t\t\tconst commit = await this.view.container.git.getCommit(this.uri.repoPath!, ref || 'HEAD');\n\t\t\tif (commit?.files != null) {\n\t\t\t\tfilterTo = new Set<string>(commit.files.map(f => f.path));\n\t\t\t}\n\t\t}\n\n\t\tif (filterTo == null) return;\n\n\t\tresults.filtered = {\n\t\t\tfilter: filter,\n\t\t\tfiles: results.files!.filter(f => filterTo!.has(f.path)),\n\t\t};\n\t}\n}\n","import { TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GitUri } from '../../git/gitUri';\nimport { GitLog } from '../../git/models';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { map } from '../../system/iterable';\nimport { cancellable, PromiseCancelledError } from '../../system/promise';\nimport { ViewsWithCommits } from '../viewBase';\nimport { AutolinkedItemsNode } from './autolinkedItemsNode';\nimport { CommitNode } from './commitNode';\nimport { LoadMoreNode } from './common';\nimport { insertDateMarkers } from './helpers';\nimport { FilesQueryResults, ResultsFilesNode } from './resultsFilesNode';\nimport { ContextValues, PageableViewNode, ViewNode } from './viewNode';\n\nexport interface CommitsQueryResults {\n\treadonly label: string;\n\treadonly log: GitLog | undefined;\n\treadonly hasMore: boolean;\n\tmore?(limit: number | undefined): Promise<void>;\n}\n\nexport class ResultsCommitsNode<View extends ViewsWithCommits = ViewsWithCommits>\n\textends ViewNode<View>\n\timplements PageableViewNode\n{\n\tconstructor(\n\t\tview: View,\n\t\tparent: ViewNode,\n\t\tpublic readonly repoPath: string,\n\t\tprivate _label: string,\n\t\tprivate readonly _results: {\n\t\t\tquery: (limit: number | undefined) => Promise<CommitsQueryResults>;\n\t\t\tcomparison?: { ref1: string; ref2: string };\n\t\t\tdeferred?: boolean;\n\t\t\tdirection?: 'ahead' | 'behind';\n\t\t\tfiles?: {\n\t\t\t\tref1: string;\n\t\t\t\tref2: string;\n\t\t\t\tquery: () => Promise<FilesQueryResults>;\n\t\t\t};\n\t\t},\n\t\tprivate readonly _options: {\n\t\t\tid?: string;\n\t\t\tdescription?: string;\n\t\t\texpand?: boolean;\n\t\t} = {},\n\t\tsplatted?: boolean,\n\t) {\n\t\tsuper(GitUri.fromRepoPath(repoPath), view, parent);\n\n\t\tif (splatted != null) {\n\t\t\tthis.splatted = splatted;\n\t\t}\n\t\tthis._options = { expand: true, ..._options };\n\t}\n\n\tget ref1(): string | undefined {\n\t\treturn this._results.comparison?.ref1;\n\t}\n\n\tget ref2(): string | undefined {\n\t\treturn this._results.comparison?.ref2;\n\t}\n\n\toverride get id(): string {\n\t\treturn `${this.parent!.id}:results:commits${this._options.id ? `:${this._options.id}` : ''}`;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tconst { log } = await this.getCommitsQueryResults();\n\t\tif (log == null) return [];\n\n\t\tconst getBranchAndTagTips = await this.view.container.git.getBranchesAndTagsTipsFn(this.uri.repoPath);\n\t\tconst children = [];\n\n\t\tconst remote = await this.view.container.git.getRichRemoteProvider(this.repoPath);\n\t\tif (remote != null) {\n\t\t\tchildren.push(new AutolinkedItemsNode(this.view, this, this.uri.repoPath!, remote, log));\n\t\t}\n\n\t\tconst { files } = this._results;\n\t\tif (files != null) {\n\t\t\tchildren.push(\n\t\t\t\tnew ResultsFilesNode(\n\t\t\t\t\tthis.view,\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.uri.repoPath!,\n\t\t\t\t\tfiles.ref1,\n\t\t\t\t\tfiles.ref2,\n\t\t\t\t\tfiles.query,\n\t\t\t\t\tthis._results.direction,\n\t\t\t\t\t{\n\t\t\t\t\t\texpand: false,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tconst options = { expand: this._options.expand && log.count === 1 };\n\n\t\tchildren.push(\n\t\t\t...insertDateMarkers(\n\t\t\t\tmap(\n\t\t\t\t\tlog.commits.values(),\n\t\t\t\t\tc => new CommitNode(this.view, this, c, undefined, undefined, getBranchAndTagTips, options),\n\t\t\t\t),\n\t\t\t\tthis,\n\t\t\t\tundefined,\n\t\t\t\t{ show: log.count > 1 },\n\t\t\t),\n\t\t);\n\n\t\tif (log.hasMore) {\n\t\t\tchildren.push(new LoadMoreNode(this.view, this, children[children.length - 1]));\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tlet label;\n\t\tlet state;\n\n\t\tif (this._results.deferred) {\n\t\t\tlabel = this._label;\n\t\t\tstate = TreeItemCollapsibleState.Collapsed;\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tlet log;\n\t\t\t\t({ label, log } = await cancellable(this.getCommitsQueryResults(), 100));\n\t\t\t\tstate =\n\t\t\t\t\tlog == null || log.count === 0\n\t\t\t\t\t\t? TreeItemCollapsibleState.None\n\t\t\t\t\t\t: this._options.expand || log.count === 1\n\t\t\t\t\t\t? TreeItemCollapsibleState.Expanded\n\t\t\t\t\t\t: TreeItemCollapsibleState.Collapsed;\n\t\t\t} catch (ex) {\n\t\t\t\tif (ex instanceof PromiseCancelledError) {\n\t\t\t\t\tex.promise.then(() => this.triggerChange(false));\n\t\t\t\t}\n\n\t\t\t\t// Need to use Collapsed before we have results or the item won't show up in the view until the children are awaited\n\t\t\t\t// https://github.com/microsoft/vscode/issues/54806 & https://github.com/microsoft/vscode/issues/62214\n\t\t\t\tstate = TreeItemCollapsibleState.Collapsed;\n\t\t\t}\n\t\t}\n\n\t\tconst item = new TreeItem(label ?? this._label, state);\n\t\titem.id = this.id;\n\t\titem.contextValue =\n\t\t\tthis._results.comparison != null ? ContextValues.CompareResultsCommits : ContextValues.SearchResultsCommits;\n\t\titem.description = this._options.description;\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset: boolean = false) {\n\t\tif (reset) {\n\t\t\tthis._commitsQueryResults = undefined;\n\t\t\tvoid this.getCommitsQueryResults();\n\t\t}\n\t}\n\n\tprivate _commitsQueryResults: Promise<CommitsQueryResults> | undefined;\n\tprivate async getCommitsQueryResults() {\n\t\tif (this._commitsQueryResults == null) {\n\t\t\tthis._commitsQueryResults = this._results.query(\n\t\t\t\tthis.limit ?? this.view.container.config.advanced.maxSearchItems,\n\t\t\t);\n\t\t\tconst results = await this._commitsQueryResults;\n\t\t\tthis._hasMore = results.hasMore;\n\n\t\t\tif (this._results.deferred) {\n\t\t\t\tthis._results.deferred = false;\n\n\t\t\t\tvoid this.triggerChange(false);\n\t\t\t}\n\t\t}\n\n\t\treturn this._commitsQueryResults;\n\t}\n\n\tprivate _hasMore = true;\n\tget hasMore() {\n\t\treturn this._hasMore;\n\t}\n\n\tlimit: number | undefined = this.view.getNodeLastKnownLimit(this);\n\tasync loadMore(limit?: number) {\n\t\tconst results = await this.getCommitsQueryResults();\n\t\tif (results == null || !results.hasMore) return;\n\n\t\tawait results.more?.(limit ?? this.view.config.pageItemLimit);\n\n\t\tthis.limit = results.log?.count;\n\n\t\tvoid this.triggerChange(false);\n\t}\n}\n","import { ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { ViewShowBranchComparison } from '../../configuration';\nimport { GlyphChars } from '../../constants';\nimport { GitUri } from '../../git/gitUri';\nimport { GitBranch, GitRevision } from '../../git/models';\nimport { CommandQuickPickItem } from '../../quickpicks/items/common';\nimport { ReferencePicker } from '../../quickpicks/referencePicker';\nimport { BranchComparison, BranchComparisons, WorkspaceStorageKeys } from '../../storage';\nimport { gate } from '../../system/decorators/gate';\nimport { debug, log } from '../../system/decorators/log';\nimport { pluralize } from '../../system/string';\nimport { BranchesView } from '../branchesView';\nimport { CommitsView } from '../commitsView';\nimport { RepositoriesView } from '../repositoriesView';\nimport { WorktreesView } from '../worktreesView';\nimport { RepositoryNode } from './repositoryNode';\nimport { CommitsQueryResults, ResultsCommitsNode } from './resultsCommitsNode';\nimport { FilesQueryResults, ResultsFilesNode } from './resultsFilesNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class CompareBranchNode extends ViewNode<BranchesView | CommitsView | RepositoriesView | WorktreesView> {\n\tstatic key = ':compare-branch';\n\tstatic getId(repoPath: string, name: string, root: boolean): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${name})${root ? ':root' : ''}`;\n\t}\n\n\tprivate _children: ViewNode[] | undefined;\n\tprivate _compareWith: BranchComparison | undefined;\n\n\tconstructor(\n\t\turi: GitUri,\n\t\tview: BranchesView | CommitsView | RepositoriesView | WorktreesView,\n\t\tparent: ViewNode,\n\t\tpublic readonly branch: GitBranch,\n\t\tprivate showComparison: ViewShowBranchComparison,\n\t\t// Specifies that the node is shown as a root\n\t\tpublic readonly root: boolean = false,\n\t) {\n\t\tsuper(uri, view, parent);\n\n\t\tthis.loadCompareWith();\n\t}\n\n\tget ahead(): { readonly ref1: string; readonly ref2: string } {\n\t\treturn {\n\t\t\tref1: this._compareWith?.ref || 'HEAD',\n\t\t\tref2: this.branch.ref,\n\t\t};\n\t}\n\n\tget behind(): { readonly ref1: string; readonly ref2: string } {\n\t\treturn {\n\t\t\tref1: this.branch.ref,\n\t\t\tref2: this._compareWith?.ref || 'HEAD',\n\t\t};\n\t}\n\n\toverride get id(): string {\n\t\treturn CompareBranchNode.getId(this.branch.repoPath, this.branch.name, this.root);\n\t}\n\n\tget repoPath(): string {\n\t\treturn this.branch.repoPath;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._compareWith == null) return [];\n\n\t\tif (this._children == null) {\n\t\t\tconst ahead = this.ahead;\n\t\t\tconst behind = this.behind;\n\n\t\t\tconst aheadBehindCounts = await this.view.container.git.getAheadBehindCommitCount(this.branch.repoPath, [\n\t\t\t\tGitRevision.createRange(behind.ref1, behind.ref2, '...'),\n\t\t\t]);\n\t\t\tconst mergeBase =\n\t\t\t\t(await this.view.container.git.getMergeBase(this.repoPath, behind.ref1, behind.ref2, {\n\t\t\t\t\tforkPoint: true,\n\t\t\t\t})) ?? (await this.view.container.git.getMergeBase(this.repoPath, behind.ref1, behind.ref2));\n\n\t\t\tthis._children = [\n\t\t\t\tnew ResultsCommitsNode(\n\t\t\t\t\tthis.view,\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.uri.repoPath!,\n\t\t\t\t\t'Behind',\n\t\t\t\t\t{\n\t\t\t\t\t\tquery: this.getCommitsQuery(GitRevision.createRange(behind.ref1, behind.ref2, '..')),\n\t\t\t\t\t\tcomparison: behind,\n\t\t\t\t\t\tdirection: 'behind',\n\t\t\t\t\t\tfiles: {\n\t\t\t\t\t\t\tref1: this.compareWithWorkingTree ? '' : mergeBase ?? behind.ref1,\n\t\t\t\t\t\t\tref2: behind.ref2,\n\t\t\t\t\t\t\tquery: this.getBehindFilesQuery.bind(this),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'behind',\n\t\t\t\t\t\tdescription: pluralize('commit', aheadBehindCounts?.behind ?? 0),\n\t\t\t\t\t\texpand: false,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t\tnew ResultsCommitsNode(\n\t\t\t\t\tthis.view,\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.uri.repoPath!,\n\t\t\t\t\t'Ahead',\n\t\t\t\t\t{\n\t\t\t\t\t\tquery: this.getCommitsQuery(\n\t\t\t\t\t\t\tGitRevision.createRange(ahead.ref1, this.compareWithWorkingTree ? '' : ahead.ref2, '..'),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tcomparison: ahead,\n\t\t\t\t\t\tdirection: 'ahead',\n\t\t\t\t\t\tfiles: {\n\t\t\t\t\t\t\tref1: mergeBase ?? ahead.ref1,\n\t\t\t\t\t\t\tref2: this.compareWithWorkingTree ? '' : ahead.ref2,\n\t\t\t\t\t\t\tquery: this.getAheadFilesQuery.bind(this),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'ahead',\n\t\t\t\t\t\tdescription: pluralize('commit', aheadBehindCounts?.ahead ?? 0),\n\t\t\t\t\t\texpand: false,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t\tnew ResultsFilesNode(\n\t\t\t\t\tthis.view,\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.uri.repoPath!,\n\t\t\t\t\tthis._compareWith.ref || 'HEAD',\n\t\t\t\t\tthis.compareWithWorkingTree ? '' : this.branch.ref,\n\t\t\t\t\tthis.getFilesQuery.bind(this),\n\t\t\t\t\tundefined,\n\t\t\t\t\t{\n\t\t\t\t\t\texpand: false,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t];\n\t\t}\n\t\treturn this._children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tlet state: TreeItemCollapsibleState;\n\t\tlet label;\n\t\tlet tooltip;\n\t\tif (this._compareWith == null) {\n\t\t\tlabel = `Compare ${\n\t\t\t\tthis.compareWithWorkingTree ? 'Working Tree' : this.branch.name\n\t\t\t} with <branch, tag, or ref>`;\n\t\t\tstate = TreeItemCollapsibleState.None;\n\t\t\ttooltip = `Click to compare ${\n\t\t\t\tthis.compareWithWorkingTree ? 'Working Tree' : this.branch.name\n\t\t\t} with a branch, tag, or ref`;\n\t\t} else {\n\t\t\tlabel = `Compare ${\n\t\t\t\tthis.compareWithWorkingTree ? 'Working Tree' : this.branch.name\n\t\t\t} with ${GitRevision.shorten(this._compareWith.ref, {\n\t\t\t\tstrings: { working: 'Working Tree' },\n\t\t\t})}`;\n\t\t\tstate = TreeItemCollapsibleState.Collapsed;\n\t\t}\n\n\t\tconst item = new TreeItem(label, state);\n\t\titem.id = this.id;\n\t\titem.contextValue = `${ContextValues.CompareBranch}${this.branch.current ? '+current' : ''}+${\n\t\t\tthis.comparisonType\n\t\t}${this._compareWith == null ? '' : '+comparing'}${this.root ? '+root' : ''}`;\n\n\t\tif (this._compareWith == null) {\n\t\t\titem.command = {\n\t\t\t\ttitle: `Compare ${this.branch.name}${this.compareWithWorkingTree ? ' (working)' : ''} with${\n\t\t\t\t\tGlyphChars.Ellipsis\n\t\t\t\t}`,\n\t\t\t\tcommand: 'gitlens.views.editNode',\n\t\t\t\targuments: [this],\n\t\t\t};\n\t\t}\n\n\t\titem.iconPath = new ThemeIcon('git-compare');\n\t\titem.tooltip = tooltip;\n\n\t\treturn item;\n\t}\n\n\t@log()\n\tasync clear() {\n\t\tthis._compareWith = undefined;\n\t\tawait this.updateCompareWith(undefined);\n\n\t\tthis._children = undefined;\n\t\tthis.view.triggerNodeChange(this);\n\t}\n\n\t@log()\n\tasync edit() {\n\t\tawait this.compareWith();\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh() {\n\t\tthis._children = undefined;\n\t\tthis.loadCompareWith();\n\t}\n\n\t@log()\n\tasync setComparisonType(comparisonType: Exclude<ViewShowBranchComparison, false>) {\n\t\tif (this._compareWith != null) {\n\t\t\tawait this.updateCompareWith({ ...this._compareWith, type: comparisonType });\n\t\t} else {\n\t\t\tthis.showComparison = comparisonType;\n\t\t}\n\n\t\tthis._children = undefined;\n\t\tthis.view.triggerNodeChange(this);\n\t}\n\n\tprivate get comparisonType() {\n\t\treturn this._compareWith?.type ?? this.showComparison;\n\t}\n\n\tprivate get compareWithWorkingTree() {\n\t\treturn this.comparisonType === ViewShowBranchComparison.Working;\n\t}\n\n\tprivate async compareWith() {\n\t\tconst pick = await ReferencePicker.show(\n\t\t\tthis.branch.repoPath,\n\t\t\t`Compare ${this.branch.name}${this.compareWithWorkingTree ? ' (working)' : ''} with`,\n\t\t\t'Choose a reference to compare with',\n\t\t\t{\n\t\t\t\tallowEnteringRefs: true,\n\t\t\t\tpicked: this.branch.ref,\n\t\t\t\t// checkmarks: true,\n\t\t\t\tsort: { branches: { current: true }, tags: {} },\n\t\t\t},\n\t\t);\n\t\tif (pick == null || pick instanceof CommandQuickPickItem) return;\n\n\t\tawait this.updateCompareWith({\n\t\t\tref: pick.ref,\n\t\t\tnotation: undefined,\n\t\t\ttype: this.comparisonType,\n\t\t});\n\n\t\tthis._children = undefined;\n\t\tthis.view.triggerNodeChange(this);\n\t}\n\n\tprivate async getAheadFilesQuery(): Promise<FilesQueryResults> {\n\t\tlet files = await this.view.container.git.getDiffStatus(\n\t\t\tthis.repoPath,\n\t\t\tGitRevision.createRange(this._compareWith?.ref || 'HEAD', this.branch.ref || 'HEAD', '...'),\n\t\t);\n\n\t\tif (this.compareWithWorkingTree) {\n\t\t\tconst workingFiles = await this.view.container.git.getDiffStatus(this.repoPath, 'HEAD');\n\t\t\tif (workingFiles != null) {\n\t\t\t\tif (files != null) {\n\t\t\t\t\tfor (const wf of workingFiles) {\n\t\t\t\t\t\tconst index = files.findIndex(f => f.path === wf.path);\n\t\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\t\tfiles.splice(index, 1, wf);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfiles.push(wf);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfiles = workingFiles;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tlabel: `${pluralize('file', files?.length ?? 0, { zero: 'No' })} changed`,\n\t\t\tfiles: files,\n\t\t};\n\t}\n\n\tprivate async getBehindFilesQuery(): Promise<FilesQueryResults> {\n\t\tconst files = await this.view.container.git.getDiffStatus(\n\t\t\tthis.uri.repoPath!,\n\t\t\tGitRevision.createRange(this.branch.ref, this._compareWith?.ref || 'HEAD', '...'),\n\t\t);\n\n\t\treturn {\n\t\t\tlabel: `${pluralize('file', files?.length ?? 0, { zero: 'No' })} changed`,\n\t\t\tfiles: files,\n\t\t};\n\t}\n\n\tprivate getCommitsQuery(range: string): (limit: number | undefined) => Promise<CommitsQueryResults> {\n\t\tconst repoPath = this.uri.repoPath!;\n\t\treturn async (limit: number | undefined) => {\n\t\t\tconst log = await this.view.container.git.getLog(repoPath, {\n\t\t\t\tlimit: limit,\n\t\t\t\tref: range,\n\t\t\t});\n\n\t\t\tconst results: Mutable<Partial<CommitsQueryResults>> = {\n\t\t\t\tlog: log,\n\t\t\t\thasMore: log?.hasMore ?? true,\n\t\t\t};\n\t\t\tif (results.hasMore) {\n\t\t\t\tresults.more = async (limit: number | undefined) => {\n\t\t\t\t\tresults.log = (await results.log?.more?.(limit)) ?? results.log;\n\t\t\t\t\tresults.hasMore = results.log?.hasMore ?? true;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn results as CommitsQueryResults;\n\t\t};\n\t}\n\n\tprivate async getFilesQuery(): Promise<FilesQueryResults> {\n\t\tlet comparison;\n\t\tif (!this._compareWith?.ref) {\n\t\t\tcomparison = this.branch.ref;\n\t\t} else if (this.compareWithWorkingTree) {\n\t\t\tcomparison = this._compareWith.ref;\n\t\t} else {\n\t\t\tcomparison = `${this._compareWith.ref}..${this.branch.ref}`;\n\t\t}\n\n\t\tconst files = await this.view.container.git.getDiffStatus(this.uri.repoPath!, comparison);\n\n\t\treturn {\n\t\t\tlabel: `${pluralize('file', files?.length ?? 0, { zero: 'No' })} changed`,\n\t\t\tfiles: files,\n\t\t};\n\t}\n\n\tprivate loadCompareWith() {\n\t\tconst comparisons = this.view.container.storage.getWorkspace<BranchComparisons>(\n\t\t\tWorkspaceStorageKeys.BranchComparisons,\n\t\t);\n\n\t\tconst id = `${this.branch.id}${this.branch.current ? '+current' : ''}`;\n\t\tconst compareWith = comparisons?.[id];\n\t\tif (compareWith != null && typeof compareWith === 'string') {\n\t\t\tthis._compareWith = {\n\t\t\t\tref: compareWith,\n\t\t\t\tnotation: undefined,\n\t\t\t\ttype: this.showComparison,\n\t\t\t};\n\t\t} else {\n\t\t\tthis._compareWith = compareWith;\n\t\t}\n\t}\n\n\tprivate async updateCompareWith(compareWith: BranchComparison | undefined) {\n\t\tthis._compareWith = compareWith;\n\n\t\tlet comparisons = this.view.container.storage.getWorkspace<BranchComparisons>(\n\t\t\tWorkspaceStorageKeys.BranchComparisons,\n\t\t);\n\t\tif (comparisons == null) {\n\t\t\tif (compareWith == null) return;\n\n\t\t\tcomparisons = Object.create(null) as BranchComparisons;\n\t\t}\n\n\t\tconst id = `${this.branch.id}${this.branch.current ? '+current' : ''}`;\n\n\t\tif (compareWith != null) {\n\t\t\tcomparisons[id] = { ...compareWith };\n\t\t} else {\n\t\t\tif (comparisons[id] == null) return;\n\n\t\t\tconst { [id]: _, ...rest } = comparisons;\n\t\t\tcomparisons = rest;\n\t\t}\n\t\tawait this.view.container.storage.storeWorkspace(WorkspaceStorageKeys.BranchComparisons, comparisons);\n\t}\n}\n","import { MarkdownString, TreeItem, TreeItemCollapsibleState, window } from 'vscode';\nimport { getPresenceDataUri } from '../../avatars';\nimport { GlyphChars } from '../../constants';\nimport { GitUri } from '../../git/gitUri';\nimport { GitContributor, GitLog } from '../../git/models';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { map } from '../../system/iterable';\nimport { pluralize } from '../../system/string';\nimport { ContactPresence } from '../../vsls/vsls';\nimport { ContributorsView } from '../contributorsView';\nimport { RepositoriesView } from '../repositoriesView';\nimport { CommitNode } from './commitNode';\nimport { LoadMoreNode, MessageNode } from './common';\nimport { insertDateMarkers } from './helpers';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, PageableViewNode, ViewNode } from './viewNode';\n\nexport class ContributorNode extends ViewNode<ContributorsView | RepositoriesView> implements PageableViewNode {\n\tstatic key = ':contributor';\n\tstatic getId(\n\t\trepoPath: string,\n\t\tname: string | undefined,\n\t\temail: string | undefined,\n\t\tusername: string | undefined,\n\t): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${name}|${email}|${username})`;\n\t}\n\n\tconstructor(\n\t\turi: GitUri,\n\t\tview: ContributorsView | RepositoriesView,\n\t\tparent: ViewNode,\n\t\tpublic readonly contributor: GitContributor,\n\t\tprivate readonly _options?: {\n\t\t\tall?: boolean;\n\t\t\tref?: string;\n\t\t\tpresence: Map<string, ContactPresence> | undefined;\n\t\t},\n\t) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn `${this.contributor.name}${this.contributor.email ? ` <${this.contributor.email}>` : ''}`;\n\t}\n\n\toverride get id(): string {\n\t\treturn ContributorNode.getId(\n\t\t\tthis.contributor.repoPath,\n\t\t\tthis.contributor.name,\n\t\t\tthis.contributor.email,\n\t\t\tthis.contributor.username,\n\t\t);\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tconst log = await this.getLog();\n\t\tif (log == null) return [new MessageNode(this.view, this, 'No commits could be found.')];\n\n\t\tconst getBranchAndTagTips = await this.view.container.git.getBranchesAndTagsTipsFn(this.uri.repoPath);\n\t\tconst children = [\n\t\t\t...insertDateMarkers(\n\t\t\t\tmap(\n\t\t\t\t\tlog.commits.values(),\n\t\t\t\t\tc => new CommitNode(this.view, this, c, undefined, undefined, getBranchAndTagTips),\n\t\t\t\t),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\n\t\tif (log.hasMore) {\n\t\t\tchildren.push(new LoadMoreNode(this.view, this, children[children.length - 1]));\n\t\t}\n\t\treturn children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tconst presence = this._options?.presence?.get(this.contributor.email!);\n\n\t\tconst item = new TreeItem(\n\t\t\tthis.contributor.current ? `${this.contributor.label} (you)` : this.contributor.label,\n\t\t\tTreeItemCollapsibleState.Collapsed,\n\t\t);\n\t\titem.id = this.id;\n\t\titem.contextValue = this.contributor.current\n\t\t\t? `${ContextValues.Contributor}+current`\n\t\t\t: ContextValues.Contributor;\n\t\titem.description = `${\n\t\t\tpresence != null && presence.status !== 'offline'\n\t\t\t\t? `${presence.statusText} ${GlyphChars.Space}${GlyphChars.Dot}${GlyphChars.Space} `\n\t\t\t\t: ''\n\t\t}${this.contributor.date != null ? `${this.contributor.formatDateFromNow()}, ` : ''}${pluralize(\n\t\t\t'commit',\n\t\t\tthis.contributor.count,\n\t\t)}`;\n\n\t\tlet avatarUri;\n\t\tlet avatarMarkdown;\n\t\tif (this.view.config.avatars) {\n\t\t\tconst size = this.view.container.config.hovers.avatarSize;\n\t\t\tavatarUri = await this.contributor.getAvatarUri({\n\t\t\t\tdefaultStyle: this.view.container.config.defaultGravatarsStyle,\n\t\t\t\tsize: size,\n\t\t\t});\n\n\t\t\tif (presence != null) {\n\t\t\t\tconst title = `${this.contributor.count ? 'You are' : `${this.contributor.label} is`} ${\n\t\t\t\t\tpresence.status === 'dnd' ? 'in ' : ''\n\t\t\t\t}${presence.statusText.toLocaleLowerCase()}`;\n\n\t\t\t\tavatarMarkdown = `![${title}](${avatarUri.toString(\n\t\t\t\t\ttrue,\n\t\t\t\t)}|width=${size},height=${size} \"${title}\")![${title}](${getPresenceDataUri(\n\t\t\t\t\tpresence.status,\n\t\t\t\t)} \"${title}\")`;\n\t\t\t} else {\n\t\t\t\tavatarMarkdown = `![${this.contributor.label}](${avatarUri.toString(\n\t\t\t\t\ttrue,\n\t\t\t\t)}|width=${size},height=${size} \"${this.contributor.label}\")`;\n\t\t\t}\n\t\t}\n\n\t\tconst numberFormatter = new Intl.NumberFormat();\n\n\t\tconst stats =\n\t\t\tthis.contributor.stats != null\n\t\t\t\t? `\\\\\\n${pluralize('file', this.contributor.stats.files, {\n\t\t\t\t\t\tformat: numberFormatter.format,\n\t\t\t\t  })} changed, ${pluralize('addition', this.contributor.stats.additions, {\n\t\t\t\t\t\tformat: numberFormatter.format,\n\t\t\t\t  })}, ${pluralize('deletion', this.contributor.stats.deletions, {\n\t\t\t\t\t\tformat: numberFormatter.format,\n\t\t\t\t  })}`\n\t\t\t\t: '';\n\n\t\tconst link = this.contributor.email\n\t\t\t? `__[${this.contributor.name}](mailto:${this.contributor.email} \"Email ${this.contributor.label} (${this.contributor.email})\")__`\n\t\t\t: `__${this.contributor.label}__`;\n\n\t\tconst lastCommitted =\n\t\t\tthis.contributor.date != null\n\t\t\t\t? `Last commit ${this.contributor.formatDateFromNow()} (${this.contributor.formatDate()})\\\\\\n`\n\t\t\t\t: '';\n\n\t\tconst markdown = new MarkdownString(\n\t\t\t`${avatarMarkdown != null ? avatarMarkdown : ''} &nbsp;${link} \\n\\n${lastCommitted}${pluralize(\n\t\t\t\t'commit',\n\t\t\t\tthis.contributor.count,\n\t\t\t\t{ format: numberFormatter.format },\n\t\t\t)}${stats}`,\n\t\t);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\n\t\titem.tooltip = markdown;\n\t\titem.iconPath = avatarUri;\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset?: boolean) {\n\t\tif (reset) {\n\t\t\tthis._log = undefined;\n\t\t}\n\t}\n\n\tprivate _log: GitLog | undefined;\n\tprivate async getLog() {\n\t\tif (this._log == null) {\n\t\t\tthis._log = await this.view.container.git.getLog(this.uri.repoPath!, {\n\t\t\t\tall: this._options?.all,\n\t\t\t\tref: this._options?.ref,\n\t\t\t\tlimit: this.limit ?? this.view.config.defaultItemLimit,\n\t\t\t\tauthors: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: this.contributor.name,\n\t\t\t\t\t\temail: this.contributor.email,\n\t\t\t\t\t\tusername: this.contributor.username,\n\t\t\t\t\t\tid: this.contributor.id,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t}\n\n\t\treturn this._log;\n\t}\n\n\tget hasMore() {\n\t\treturn this._log?.hasMore ?? true;\n\t}\n\n\tlimit: number | undefined = this.view.getNodeLastKnownLimit(this);\n\t@gate()\n\tasync loadMore(limit?: number | { until?: any }) {\n\t\tlet log = await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: { viewId: this.view.id },\n\t\t\t},\n\t\t\t() => this.getLog(),\n\t\t);\n\t\tif (log == null || !log.hasMore) return;\n\n\t\tlog = await log.more?.(limit ?? this.view.config.pageItemLimit);\n\t\tif (this._log === log) return;\n\n\t\tthis._log = log;\n\t\tthis.limit = log?.count;\n\n\t\tvoid this.triggerChange(false);\n\t}\n}\n","import { ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GitUri } from '../../git/gitUri';\nimport { GitContributor, Repository } from '../../git/models';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { timeout } from '../../system/decorators/timeout';\nimport { ContributorsView } from '../contributorsView';\nimport { RepositoriesView } from '../repositoriesView';\nimport { MessageNode } from './common';\nimport { ContributorNode } from './contributorNode';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class ContributorsNode extends ViewNode<ContributorsView | RepositoriesView> {\n\tstatic key = ':contributors';\n\tstatic getId(repoPath: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}`;\n\t}\n\n\tprotected override splatted = true;\n\n\tprivate _children: ContributorNode[] | undefined;\n\n\tconstructor(\n\t\turi: GitUri,\n\t\tview: ContributorsView | RepositoriesView,\n\t\tparent: ViewNode,\n\t\tpublic readonly repo: Repository,\n\t) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride get id(): string {\n\t\treturn ContributorsNode.getId(this.repo.path);\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._children == null) {\n\t\t\tconst all = this.view.container.config.views.contributors.showAllBranches;\n\n\t\t\tlet ref: string | undefined;\n\t\t\t// If we aren't getting all branches, get the upstream of the current branch if there is one\n\t\t\tif (!all) {\n\t\t\t\ttry {\n\t\t\t\t\tconst branch = await this.view.container.git.getBranch(this.uri.repoPath);\n\t\t\t\t\tif (branch?.upstream?.name != null && !branch.upstream.missing) {\n\t\t\t\t\t\tref = '@{u}';\n\t\t\t\t\t}\n\t\t\t\t} catch {}\n\t\t\t}\n\n\t\t\tconst stats = this.view.container.config.views.contributors.showStatistics;\n\n\t\t\tconst contributors = await this.repo.getContributors({ all: all, ref: ref, stats: stats });\n\t\t\tif (contributors.length === 0) return [new MessageNode(this.view, this, 'No contributors could be found.')];\n\n\t\t\tGitContributor.sort(contributors);\n\t\t\tconst presenceMap = await this.maybeGetPresenceMap(contributors);\n\n\t\t\tthis._children = contributors.map(\n\t\t\t\tc => new ContributorNode(this.uri, this.view, this, c, { all: all, ref: ref, presence: presenceMap }),\n\t\t\t);\n\t\t}\n\n\t\treturn this._children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tthis.splatted = false;\n\n\t\tconst item = new TreeItem('Contributors', TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.Contributors;\n\t\titem.iconPath = new ThemeIcon('organization');\n\t\treturn item;\n\t}\n\n\tupdateAvatar(email: string) {\n\t\tif (this._children == null) return;\n\n\t\tfor (const child of this._children) {\n\t\t\tif (child.contributor.email === email) {\n\t\t\t\tvoid child.triggerChange();\n\t\t\t}\n\t\t}\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh() {\n\t\tthis._children = undefined;\n\t}\n\n\t@debug({ args: false })\n\t@timeout(250)\n\tprivate async maybeGetPresenceMap(contributors: GitContributor[]) {\n\t\t// Only get presence for the current user, because it is far too slow otherwise\n\t\tconst email = contributors.find(c => c.current)?.email;\n\t\tif (email == null) return undefined;\n\n\t\treturn this.view.container.vsls.getContactsPresence([email]);\n\t}\n}\n","import { Command, MarkdownString, ThemeIcon, TreeItem, TreeItemCollapsibleState, Uri } from 'vscode';\nimport { CoreCommands } from '../../constants';\nimport { StatusFileFormatter } from '../../git/formatters';\nimport { GitUri } from '../../git/gitUri';\nimport { GitFile, GitMergeStatus, GitRebaseStatus } from '../../git/models';\nimport { relativeDir } from '../../system/path';\nimport { ViewsWithCommits } from '../viewBase';\nimport { FileNode } from './folderNode';\nimport { MergeConflictCurrentChangesNode } from './mergeConflictCurrentChangesNode';\nimport { MergeConflictIncomingChangesNode } from './mergeConflictIncomingChangesNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class MergeConflictFileNode extends ViewNode<ViewsWithCommits> implements FileNode {\n\tconstructor(\n\t\tview: ViewsWithCommits,\n\t\tparent: ViewNode,\n\t\tpublic readonly status: GitMergeStatus | GitRebaseStatus,\n\t\tpublic readonly file: GitFile,\n\t) {\n\t\tsuper(GitUri.fromFile(file, status.repoPath, status.HEAD.ref), view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.fileName;\n\t}\n\n\tget baseUri(): Uri {\n\t\treturn GitUri.fromFile(this.file, this.status.repoPath, this.status.mergeBase ?? 'HEAD');\n\t}\n\n\tget fileName(): string {\n\t\treturn this.file.path;\n\t}\n\n\tget repoPath(): string {\n\t\treturn this.status.repoPath;\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\treturn [\n\t\t\tnew MergeConflictCurrentChangesNode(this.view, this, this.status, this.file),\n\t\t\tnew MergeConflictIncomingChangesNode(this.view, this, this.status, this.file),\n\t\t];\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(this.label, TreeItemCollapsibleState.Collapsed);\n\t\titem.description = this.description;\n\t\titem.contextValue = `${ContextValues.File}+conflicted`;\n\n\t\tconst tooltip = StatusFileFormatter.fromTemplate(\n\t\t\t`\\${file}\\${ \\u2022 changesDetail}\\${\\\\\\\\\\ndirectory}\\${\\n\\nstatus}\\${ (originalPath)} in Index (staged)`,\n\t\t\tthis.file,\n\t\t);\n\t\tconst markdown = new MarkdownString(tooltip, true);\n\t\tmarkdown.isTrusted = true;\n\t\tmarkdown.supportHtml = true;\n\n\t\titem.tooltip = markdown;\n\n\t\t// Use the file icon and decorations\n\t\titem.resourceUri = this.view.container.git.getAbsoluteUri(this.file.path, this.repoPath);\n\t\titem.iconPath = ThemeIcon.File;\n\t\titem.command = this.getCommand();\n\n\t\t// Only cache the label/description for a single refresh\n\t\tthis._label = undefined;\n\t\tthis._description = undefined;\n\n\t\treturn item;\n\t}\n\n\tprivate _description: string | undefined;\n\tget description() {\n\t\tif (this._description == null) {\n\t\t\tthis._description = StatusFileFormatter.fromTemplate(\n\t\t\t\tthis.view.config.formats.files.description,\n\t\t\t\tthis.file,\n\t\t\t\t{\n\t\t\t\t\trelativePath: this.relativePath,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\treturn this._description;\n\t}\n\n\tprivate _folderName: string | undefined;\n\tget folderName() {\n\t\tif (this._folderName == null) {\n\t\t\tthis._folderName = relativeDir(this.uri.relativePath);\n\t\t}\n\t\treturn this._folderName;\n\t}\n\n\tprivate _label: string | undefined;\n\tget label() {\n\t\tif (this._label == null) {\n\t\t\tthis._label = StatusFileFormatter.fromTemplate(this.view.config.formats.files.label, this.file, {\n\t\t\t\trelativePath: this.relativePath,\n\t\t\t});\n\t\t}\n\t\treturn this._label;\n\t}\n\n\tget priority(): number {\n\t\treturn 0;\n\t}\n\n\tprivate _relativePath: string | undefined;\n\tget relativePath(): string | undefined {\n\t\treturn this._relativePath;\n\t}\n\tset relativePath(value: string | undefined) {\n\t\tthis._relativePath = value;\n\t\tthis._label = undefined;\n\t\tthis._description = undefined;\n\t}\n\n\toverride getCommand(): Command | undefined {\n\t\treturn {\n\t\t\ttitle: 'Open File',\n\t\t\tcommand: CoreCommands.Open,\n\t\t\targuments: [\n\t\t\t\tthis.view.container.git.getAbsoluteUri(this.file.path, this.repoPath),\n\t\t\t\t{\n\t\t\t\t\tpreserveFocus: true,\n\t\t\t\t\tpreview: true,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import { MarkdownString, ThemeColor, ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { ViewFilesLayout } from '../../configuration';\nimport { GitUri } from '../../git/gitUri';\nimport { GitBranch, GitMergeStatus, GitReference, GitStatus } from '../../git/models';\nimport { makeHierarchical } from '../../system/array';\nimport { joinPaths, normalizePath } from '../../system/path';\nimport { pluralize, sortCompare } from '../../system/string';\nimport { ViewsWithCommits } from '../viewBase';\nimport { BranchNode } from './branchNode';\nimport { FileNode, FolderNode } from './folderNode';\nimport { MergeConflictFileNode } from './mergeConflictFileNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class MergeStatusNode extends ViewNode<ViewsWithCommits> {\n\tstatic key = ':merge';\n\tstatic getId(repoPath: string, name: string, root: boolean): string {\n\t\treturn `${BranchNode.getId(repoPath, name, root)}${this.key}`;\n\t}\n\n\tconstructor(\n\t\tview: ViewsWithCommits,\n\t\tparent: ViewNode,\n\t\tpublic readonly branch: GitBranch,\n\t\tpublic readonly mergeStatus: GitMergeStatus,\n\t\tpublic readonly status: GitStatus | undefined,\n\t\t// Specifies that the node is shown as a root\n\t\tpublic readonly root: boolean,\n\t) {\n\t\tsuper(GitUri.fromRepoPath(mergeStatus.repoPath), view, parent);\n\t}\n\n\toverride get id(): string {\n\t\treturn MergeStatusNode.getId(this.mergeStatus.repoPath, this.mergeStatus.current.name, this.root);\n\t}\n\n\tget repoPath(): string {\n\t\treturn this.uri.repoPath!;\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\tif (this.status?.hasConflicts !== true) return [];\n\n\t\tlet children: FileNode[] = this.status.conflicts.map(\n\t\t\tf => new MergeConflictFileNode(this.view, this, this.mergeStatus, f),\n\t\t);\n\n\t\tif (this.view.config.files.layout !== ViewFilesLayout.List) {\n\t\t\tconst hierarchy = makeHierarchical(\n\t\t\t\tchildren,\n\t\t\t\tn => n.uri.relativePath.split('/'),\n\t\t\t\t(...parts: string[]) => normalizePath(joinPaths(...parts)),\n\t\t\t\tthis.view.config.files.compact,\n\t\t\t);\n\n\t\t\tconst root = new FolderNode(this.view, this, this.repoPath, '', hierarchy);\n\t\t\tchildren = root.getChildren() as FileNode[];\n\t\t} else {\n\t\t\tchildren.sort((a, b) => sortCompare(a.label!, b.label!));\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(\n\t\t\t`${this.status?.hasConflicts ? 'Resolve conflicts before merging' : 'Merging'} ${\n\t\t\t\tthis.mergeStatus.incoming != null\n\t\t\t\t\t? `${GitReference.toString(this.mergeStatus.incoming, { expand: false, icon: false })} `\n\t\t\t\t\t: ''\n\t\t\t}into ${GitReference.toString(this.mergeStatus.current, { expand: false, icon: false })}`,\n\t\t\tTreeItemCollapsibleState.Expanded,\n\t\t);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.Merge;\n\t\titem.description = this.status?.hasConflicts ? pluralize('conflict', this.status.conflicts.length) : undefined;\n\t\titem.iconPath = this.status?.hasConflicts\n\t\t\t? new ThemeIcon('warning', new ThemeColor('list.warningForeground'))\n\t\t\t: new ThemeIcon('debug-pause', new ThemeColor('list.foreground'));\n\n\t\tconst markdown = new MarkdownString(\n\t\t\t`${`Merging ${\n\t\t\t\tthis.mergeStatus.incoming != null ? GitReference.toString(this.mergeStatus.incoming) : ''\n\t\t\t}into ${GitReference.toString(this.mergeStatus.current)}`}${\n\t\t\t\tthis.status?.hasConflicts ? `\\n\\n${pluralize('conflicted file', this.status.conflicts.length)}` : ''\n\t\t\t}`,\n\t\t\ttrue,\n\t\t);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\n\t\titem.tooltip = markdown;\n\n\t\treturn item;\n\t}\n}\n","import { Command, MarkdownString, ThemeColor, ThemeIcon, TreeItem, TreeItemCollapsibleState, Uri } from 'vscode';\nimport type { DiffWithPreviousCommandArgs } from '../../commands';\nimport { ViewFilesLayout } from '../../configuration';\nimport { Commands, CoreCommands } from '../../constants';\nimport { CommitFormatter } from '../../git/formatters';\nimport { GitUri } from '../../git/gitUri';\nimport { GitBranch, GitCommit, GitRebaseStatus, GitReference, GitRevisionReference, GitStatus } from '../../git/models';\nimport { makeHierarchical } from '../../system/array';\nimport { executeCoreCommand } from '../../system/command';\nimport { joinPaths, normalizePath } from '../../system/path';\nimport { pluralize, sortCompare } from '../../system/string';\nimport { ViewsWithCommits } from '../viewBase';\nimport { BranchNode } from './branchNode';\nimport { CommitFileNode } from './commitFileNode';\nimport { FileNode, FolderNode } from './folderNode';\nimport { MergeConflictFileNode } from './mergeConflictFileNode';\nimport { ContextValues, ViewNode, ViewRefNode } from './viewNode';\n\nexport class RebaseStatusNode extends ViewNode<ViewsWithCommits> {\n\tstatic key = ':rebase';\n\tstatic getId(repoPath: string, name: string, root: boolean): string {\n\t\treturn `${BranchNode.getId(repoPath, name, root)}${this.key}`;\n\t}\n\n\tconstructor(\n\t\tview: ViewsWithCommits,\n\t\tparent: ViewNode,\n\t\tpublic readonly branch: GitBranch,\n\t\tpublic readonly rebaseStatus: GitRebaseStatus,\n\t\tpublic readonly status: GitStatus | undefined,\n\t\t// Specifies that the node is shown as a root\n\t\tpublic readonly root: boolean,\n\t) {\n\t\tsuper(GitUri.fromRepoPath(rebaseStatus.repoPath), view, parent);\n\t}\n\n\toverride get id(): string {\n\t\treturn RebaseStatusNode.getId(this.rebaseStatus.repoPath, this.rebaseStatus.incoming.name, this.root);\n\t}\n\n\tget repoPath(): string {\n\t\treturn this.uri.repoPath!;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tlet children: FileNode[] =\n\t\t\tthis.status?.conflicts.map(f => new MergeConflictFileNode(this.view, this, this.rebaseStatus, f)) ?? [];\n\n\t\tif (this.view.config.files.layout !== ViewFilesLayout.List) {\n\t\t\tconst hierarchy = makeHierarchical(\n\t\t\t\tchildren,\n\t\t\t\tn => n.uri.relativePath.split('/'),\n\t\t\t\t(...parts: string[]) => normalizePath(joinPaths(...parts)),\n\t\t\t\tthis.view.config.files.compact,\n\t\t\t);\n\n\t\t\tconst root = new FolderNode(this.view, this, this.repoPath, '', hierarchy);\n\t\t\tchildren = root.getChildren() as FileNode[];\n\t\t} else {\n\t\t\tchildren.sort((a, b) => sortCompare(a.label!, b.label!));\n\t\t}\n\n\t\tconst commit = await this.view.container.git.getCommit(\n\t\t\tthis.rebaseStatus.repoPath,\n\t\t\tthis.rebaseStatus.steps.current.commit.ref,\n\t\t);\n\t\tif (commit != null) {\n\t\t\tchildren.splice(0, 0, new RebaseCommitNode(this.view, this, commit) as any);\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(\n\t\t\t`${this.status?.hasConflicts ? 'Resolve conflicts to continue rebasing' : 'Rebasing'} ${\n\t\t\t\tthis.rebaseStatus.incoming != null\n\t\t\t\t\t? `${GitReference.toString(this.rebaseStatus.incoming, { expand: false, icon: false })}`\n\t\t\t\t\t: ''\n\t\t\t} (${this.rebaseStatus.steps.current.number}/${this.rebaseStatus.steps.total})`,\n\t\t\tTreeItemCollapsibleState.Expanded,\n\t\t);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.Rebase;\n\t\titem.description = this.status?.hasConflicts ? pluralize('conflict', this.status.conflicts.length) : undefined;\n\t\titem.iconPath = this.status?.hasConflicts\n\t\t\t? new ThemeIcon('warning', new ThemeColor('list.warningForeground'))\n\t\t\t: new ThemeIcon('debug-pause', new ThemeColor('list.foreground'));\n\n\t\tconst markdown = new MarkdownString(\n\t\t\t`${`Rebasing ${\n\t\t\t\tthis.rebaseStatus.incoming != null ? GitReference.toString(this.rebaseStatus.incoming) : ''\n\t\t\t}onto ${GitReference.toString(this.rebaseStatus.current)}`}\\n\\nStep ${\n\t\t\t\tthis.rebaseStatus.steps.current.number\n\t\t\t} of ${this.rebaseStatus.steps.total}\\\\\\nPaused at ${GitReference.toString(\n\t\t\t\tthis.rebaseStatus.steps.current.commit,\n\t\t\t\t{ icon: true },\n\t\t\t)}${this.status?.hasConflicts ? `\\n\\n${pluralize('conflicted file', this.status.conflicts.length)}` : ''}`,\n\t\t\ttrue,\n\t\t);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\n\t\titem.tooltip = markdown;\n\n\t\treturn item;\n\t}\n\n\tasync openEditor() {\n\t\tconst rebaseTodoUri = Uri.joinPath(this.uri, '.git', 'rebase-merge', 'git-rebase-todo');\n\t\tawait executeCoreCommand(CoreCommands.OpenWith, rebaseTodoUri, 'gitlens.rebase', {\n\t\t\tpreview: false,\n\t\t});\n\t}\n}\n\nexport class RebaseCommitNode extends ViewRefNode<ViewsWithCommits, GitRevisionReference> {\n\tconstructor(view: ViewsWithCommits, parent: ViewNode, public readonly commit: GitCommit) {\n\t\tsuper(commit.getGitUri(), view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn `${this.commit.shortSha}: ${this.commit.summary}`;\n\t}\n\n\tget ref(): GitRevisionReference {\n\t\treturn this.commit;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tconst commit = this.commit;\n\n\t\tconst commits = await commit.getCommitsForFiles();\n\t\tlet children: FileNode[] = commits.map(c => new CommitFileNode(this.view, this, c.file!, c));\n\n\t\tif (this.view.config.files.layout !== ViewFilesLayout.List) {\n\t\t\tconst hierarchy = makeHierarchical(\n\t\t\t\tchildren,\n\t\t\t\tn => n.uri.relativePath.split('/'),\n\t\t\t\t(...parts: string[]) => normalizePath(joinPaths(...parts)),\n\t\t\t\tthis.view.config.files.compact,\n\t\t\t);\n\n\t\t\tconst root = new FolderNode(this.view, this, this.repoPath, '', hierarchy);\n\t\t\tchildren = root.getChildren() as FileNode[];\n\t\t} else {\n\t\t\tchildren.sort((a, b) => sortCompare(a.label!, b.label!));\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(`Paused at commit ${this.commit.shortSha}`, TreeItemCollapsibleState.Collapsed);\n\n\t\t// item.contextValue = ContextValues.RebaseCommit;\n\n\t\titem.description = CommitFormatter.fromTemplate(`\\${message}`, this.commit, {\n\t\t\tmessageTruncateAtNewLine: true,\n\t\t});\n\t\titem.iconPath = new ThemeIcon('git-commit');\n\n\t\treturn item;\n\t}\n\n\toverride getCommand(): Command | undefined {\n\t\tconst commandArgs: DiffWithPreviousCommandArgs = {\n\t\t\tcommit: this.commit,\n\t\t\turi: this.uri,\n\t\t\tline: 0,\n\t\t\tshowOptions: {\n\t\t\t\tpreserveFocus: true,\n\t\t\t\tpreview: true,\n\t\t\t},\n\t\t};\n\t\treturn {\n\t\t\ttitle: 'Open Changes with Previous Revision',\n\t\t\tcommand: Commands.DiffWithPrevious,\n\t\t\targuments: [undefined, commandArgs],\n\t\t};\n\t}\n\n\toverride async resolveTreeItem(item: TreeItem): Promise<TreeItem> {\n\t\tif (item.tooltip == null) {\n\t\t\titem.tooltip = await this.getTooltip();\n\t\t}\n\t\treturn item;\n\t}\n\n\tprivate async getTooltip() {\n\t\tconst remotes = await this.view.container.git.getRemotesWithProviders(this.commit.repoPath);\n\t\tconst remote = await this.view.container.git.getRichRemoteProvider(remotes);\n\n\t\tif (this.commit.message == null) {\n\t\t\tawait this.commit.ensureFullDetails();\n\t\t}\n\n\t\tlet autolinkedIssuesOrPullRequests;\n\t\tlet pr;\n\n\t\tif (remote?.provider != null) {\n\t\t\t[autolinkedIssuesOrPullRequests, pr] = await Promise.all([\n\t\t\t\tthis.view.container.autolinks.getIssueOrPullRequestLinks(\n\t\t\t\t\tthis.commit.message ?? this.commit.summary,\n\t\t\t\t\tremote,\n\t\t\t\t),\n\t\t\t\tthis.view.container.git.getPullRequestForCommit(this.commit.ref, remote.provider),\n\t\t\t]);\n\t\t}\n\n\t\tconst tooltip = await CommitFormatter.fromTemplateAsync(\n\t\t\t`Rebase paused at \\${link}\\${' via 'pullRequest}\\${'&nbsp;&nbsp;\\u2022&nbsp;&nbsp;'changesDetail}\\${'&nbsp;&nbsp;&nbsp;&nbsp;'tips}\\n\\n\\${avatar} &nbsp;__\\${author}__, \\${ago} &nbsp; _(\\${date})_ \\n\\n\\${message}\\${\\n\\n---\\n\\nfootnotes}`,\n\t\t\tthis.commit,\n\t\t\t{\n\t\t\t\tautolinkedIssuesOrPullRequests: autolinkedIssuesOrPullRequests,\n\t\t\t\tdateFormat: this.view.container.config.defaultDateFormat,\n\t\t\t\tmarkdown: true,\n\t\t\t\tmessageAutolinks: true,\n\t\t\t\tmessageIndent: 4,\n\t\t\t\tpullRequestOrRemote: pr,\n\t\t\t\tremotes: remotes,\n\t\t\t},\n\t\t);\n\n\t\tconst markdown = new MarkdownString(tooltip, true);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\n\t\treturn markdown;\n\t}\n}\n","import { TreeItem, TreeItemCollapsibleState, window } from 'vscode';\nimport { GlyphChars } from '../../constants';\nimport { GitUri } from '../../git/gitUri';\nimport { GitLog, GitReflogRecord } from '../../git/models';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { map } from '../../system/iterable';\nimport { ViewsWithCommits } from '../viewBase';\nimport { CommitNode } from './commitNode';\nimport { LoadMoreNode, MessageNode } from './common';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, PageableViewNode, ViewNode } from './viewNode';\n\nexport class ReflogRecordNode extends ViewNode<ViewsWithCommits> implements PageableViewNode {\n\tstatic key = ':reflog-record';\n\tstatic getId(\n\t\trepoPath: string,\n\t\tsha: string,\n\t\tselector: string,\n\t\tcommand: string,\n\t\tcommandArgs: string | undefined,\n\t\tdate: Date,\n\t): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${sha}|${selector}|${command}|${\n\t\t\tcommandArgs ?? ''\n\t\t}|${date.getTime()})`;\n\t}\n\n\tconstructor(view: ViewsWithCommits, parent: ViewNode, public readonly record: GitReflogRecord) {\n\t\tsuper(GitUri.fromRepoPath(record.repoPath), view, parent);\n\t}\n\n\toverride get id(): string {\n\t\treturn ReflogRecordNode.getId(\n\t\t\tthis.uri.repoPath!,\n\t\t\tthis.record.sha,\n\t\t\tthis.record.selector,\n\t\t\tthis.record.command,\n\t\t\tthis.record.commandArgs,\n\t\t\tthis.record.date,\n\t\t);\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tconst log = await this.getLog();\n\t\tif (log === undefined) return [new MessageNode(this.view, this, 'No commits could be found.')];\n\n\t\tconst children: (CommitNode | LoadMoreNode)[] = [\n\t\t\t...map(log.commits.values(), c => new CommitNode(this.view, this, c)),\n\t\t];\n\n\t\tif (log.hasMore) {\n\t\t\tchildren.push(new LoadMoreNode(this.view, this, children[children.length - 1]));\n\t\t}\n\t\treturn children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(\n\t\t\t`${this.record.command}${this.record.commandArgs ? ` ${this.record.commandArgs}` : ''}`,\n\t\t\tTreeItemCollapsibleState.Collapsed,\n\t\t);\n\t\titem.id = this.id;\n\t\titem.description = `${\n\t\t\tthis.record.HEAD.length === 0\n\t\t\t\t? ''\n\t\t\t\t: `${this.record.HEAD} ${GlyphChars.Space}${GlyphChars.Dot}${GlyphChars.Space} `\n\t\t}${this.record.formattedDate}`;\n\t\titem.contextValue = ContextValues.ReflogRecord;\n\t\titem.tooltip = `${this.record.HEAD.length === 0 ? '' : `${this.record.HEAD}\\n`}${this.record.command}${\n\t\t\tthis.record.commandArgs ? ` ${this.record.commandArgs}` : ''\n\t\t}${\n\t\t\tthis.record.details ? ` (${this.record.details})` : ''\n\t\t}\\n${this.record.formatDateFromNow()} (${this.record.formatDate()})\\n${this.record.previousShortSha} ${\n\t\t\tGlyphChars.Space\n\t\t}${GlyphChars.ArrowRight}${GlyphChars.Space} ${this.record.shortSha}`;\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset?: boolean) {\n\t\tif (reset) {\n\t\t\tthis._log = undefined;\n\t\t}\n\t}\n\n\tprivate _log: GitLog | undefined;\n\tprivate async getLog() {\n\t\tif (this._log === undefined) {\n\t\t\tconst range = `${this.record.previousSha}..${this.record.sha}`;\n\t\t\tthis._log = await this.view.container.git.getLog(this.uri.repoPath!, {\n\t\t\t\tlimit: this.limit ?? this.view.config.defaultItemLimit,\n\t\t\t\tref: range,\n\t\t\t});\n\t\t}\n\n\t\treturn this._log;\n\t}\n\n\tget hasMore() {\n\t\treturn this._log?.hasMore ?? true;\n\t}\n\n\tlimit: number | undefined = this.view.getNodeLastKnownLimit(this);\n\t@gate()\n\tasync loadMore(limit?: number | { until?: any }) {\n\t\tlet log = await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: { viewId: this.view.id },\n\t\t\t},\n\t\t\t() => this.getLog(),\n\t\t);\n\t\tif (log === undefined || !log.hasMore) return;\n\n\t\tlog = await log.more?.(limit ?? this.view.config.pageItemLimit);\n\t\tif (this._log === log) return;\n\n\t\tthis._log = log;\n\t\tthis.limit = log?.count;\n\t\tvoid this.triggerChange(false);\n\t}\n}\n","import { TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GitUri } from '../../git/gitUri';\nimport { GitReflog, Repository } from '../../git/models';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { RepositoriesView } from '../repositoriesView';\nimport { LoadMoreNode, MessageNode } from './common';\nimport { ReflogRecordNode } from './reflogRecordNode';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, PageableViewNode, ViewNode } from './viewNode';\n\nexport class ReflogNode extends ViewNode<RepositoriesView> implements PageableViewNode {\n\tstatic key = ':reflog';\n\tstatic getId(repoPath: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}`;\n\t}\n\n\tprivate _children: ViewNode[] | undefined;\n\n\tconstructor(uri: GitUri, view: RepositoriesView, parent: ViewNode, public readonly repo: Repository) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride get id(): string {\n\t\treturn ReflogNode.getId(this.repo.path);\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._children === undefined) {\n\t\t\tconst children = [];\n\n\t\t\tconst reflog = await this.getReflog();\n\t\t\tif (reflog === undefined || reflog.records.length === 0) {\n\t\t\t\treturn [new MessageNode(this.view, this, 'No activity could be found.')];\n\t\t\t}\n\n\t\t\tchildren.push(...reflog.records.map(r => new ReflogRecordNode(this.view, this, r)));\n\n\t\t\tif (reflog.hasMore) {\n\t\t\t\tchildren.push(new LoadMoreNode(this.view, this, children[children.length - 1]));\n\t\t\t}\n\n\t\t\tthis._children = children;\n\t\t}\n\t\treturn this._children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Incoming Activity', TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.Reflog;\n\t\titem.description = 'experimental';\n\t\titem.iconPath = {\n\t\t\tdark: this.view.container.context.asAbsolutePath('images/dark/icon-activity.svg'),\n\t\t\tlight: this.view.container.context.asAbsolutePath('images/light/icon-activity.svg'),\n\t\t};\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset?: boolean) {\n\t\tthis._children = undefined;\n\t\tif (reset) {\n\t\t\tthis._reflog = undefined;\n\t\t}\n\t}\n\n\tprivate _reflog: GitReflog | undefined;\n\tprivate async getReflog() {\n\t\tif (this._reflog === undefined) {\n\t\t\tthis._reflog = await this.view.container.git.getIncomingActivity(this.repo.path, {\n\t\t\t\tall: true,\n\t\t\t\tlimit: this.limit ?? this.view.config.defaultItemLimit,\n\t\t\t});\n\t\t}\n\n\t\treturn this._reflog;\n\t}\n\n\tget hasMore() {\n\t\treturn this._reflog?.hasMore ?? true;\n\t}\n\n\tlimit: number | undefined = this.view.getNodeLastKnownLimit(this);\n\tasync loadMore(limit?: number) {\n\t\tlet reflog = await this.getReflog();\n\t\tif (reflog === undefined || !reflog.hasMore) return;\n\n\t\treflog = await reflog.more?.(limit ?? this.view.config.pageItemLimit);\n\t\tif (this._reflog === reflog) return;\n\n\t\tthis._reflog = reflog;\n\t\tthis.limit = reflog?.count;\n\t\tvoid this.triggerChange(false);\n\t}\n}\n","import { ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GitUri } from '../../git/gitUri';\nimport { HierarchicalItem } from '../../system/array';\nimport { View } from '../viewBase';\nimport { BranchNode } from './branchNode';\nimport { RepositoryNode } from './repositoryNode';\nimport { TagNode } from './tagNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class BranchOrTagFolderNode extends ViewNode {\n\tstatic getId(repoPath: string, key: string | undefined, type: string, relativePath: string | undefined): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}:${\n\t\t\tkey === undefined ? type : `${key}:${type}`\n\t\t}-folder(${relativePath})`;\n\t}\n\n\tconstructor(\n\t\tview: View,\n\t\tparent: ViewNode,\n\t\tpublic readonly type: 'branch' | 'remote-branch' | 'tag',\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly folderName: string,\n\t\tpublic readonly relativePath: string | undefined,\n\t\tpublic readonly root: HierarchicalItem<BranchNode | TagNode>,\n\t\tprivate readonly _key?: string,\n\t\tprivate readonly _expanded: boolean = false,\n\t) {\n\t\tsuper(GitUri.fromRepoPath(repoPath), view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.folderName;\n\t}\n\n\toverride get id(): string {\n\t\treturn BranchOrTagFolderNode.getId(this.repoPath, this._key, this.type, this.relativePath);\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\tif (this.root.descendants === undefined || this.root.children === undefined) return [];\n\n\t\tconst children: (BranchOrTagFolderNode | BranchNode | TagNode)[] = [];\n\n\t\tfor (const folder of this.root.children.values()) {\n\t\t\tif (folder.value === undefined) {\n\t\t\t\t// If the folder contains the current branch, expand it by default\n\t\t\t\tconst expanded = folder.descendants?.some(n => n instanceof BranchNode && n.current);\n\t\t\t\tchildren.push(\n\t\t\t\t\tnew BranchOrTagFolderNode(\n\t\t\t\t\t\tthis.view,\n\t\t\t\t\t\tthis.folderName ? this : this.parent!,\n\t\t\t\t\t\tthis.type,\n\t\t\t\t\t\tthis.repoPath,\n\t\t\t\t\t\tfolder.name,\n\t\t\t\t\t\tfolder.relativePath,\n\t\t\t\t\t\tfolder,\n\t\t\t\t\t\tthis._key,\n\t\t\t\t\t\texpanded,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Make sure to set the parent\n\t\t\t(folder.value as any).parent = this.folderName ? this : this.parent!;\n\t\t\tchildren.push(folder.value);\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(\n\t\t\tthis.label,\n\t\t\tthis._expanded ? TreeItemCollapsibleState.Expanded : TreeItemCollapsibleState.Collapsed,\n\t\t);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.Folder;\n\t\titem.iconPath = ThemeIcon.Folder;\n\t\titem.tooltip = this.label;\n\t\treturn item;\n\t}\n\n\tget label(): string {\n\t\treturn this.folderName;\n\t}\n}\n","import { ThemeIcon, TreeItem, TreeItemCollapsibleState, Uri } from 'vscode';\nimport { ViewBranchesLayout } from '../../configuration';\nimport { GlyphChars } from '../../constants';\nimport { GitUri } from '../../git/gitUri';\nimport { GitRemote, GitRemoteType, Repository } from '../../git/models';\nimport { makeHierarchical } from '../../system/array';\nimport { log } from '../../system/decorators/log';\nimport { RemotesView } from '../remotesView';\nimport { RepositoriesView } from '../repositoriesView';\nimport { BranchNode } from './branchNode';\nimport { BranchOrTagFolderNode } from './branchOrTagFolderNode';\nimport { MessageNode } from './common';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class RemoteNode extends ViewNode<RemotesView | RepositoriesView> {\n\tstatic key = ':remote';\n\tstatic getId(repoPath: string, name: string, id: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${name}|${id})`;\n\t}\n\n\tconstructor(\n\t\turi: GitUri,\n\t\tview: RemotesView | RepositoriesView,\n\t\tparent: ViewNode,\n\t\tpublic readonly remote: GitRemote,\n\t\tpublic readonly repo: Repository,\n\t) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.remote.name;\n\t}\n\n\toverride get id(): string {\n\t\treturn RemoteNode.getId(this.remote.repoPath, this.remote.name, this.remote.id);\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tconst branches = await this.repo.getBranches({\n\t\t\t// only show remote branches for this remote\n\t\t\tfilter: b => b.remote && b.name.startsWith(this.remote.name),\n\t\t\tsort: true,\n\t\t});\n\t\tif (branches.values.length === 0) return [new MessageNode(this.view, this, 'No branches could be found.')];\n\n\t\t// TODO@eamodio handle paging\n\t\tconst branchNodes = branches.values.map(\n\t\t\tb =>\n\t\t\t\tnew BranchNode(GitUri.fromRepoPath(this.uri.repoPath!, b.ref), this.view, this, b, false, {\n\t\t\t\t\tshowComparison: false,\n\t\t\t\t\tshowTracking: false,\n\t\t\t\t}),\n\t\t);\n\t\tif (this.view.config.branches.layout === ViewBranchesLayout.List) return branchNodes;\n\n\t\tconst hierarchy = makeHierarchical(\n\t\t\tbranchNodes,\n\t\t\tn => n.treeHierarchy,\n\t\t\t(...paths) => paths.join('/'),\n\t\t\tthis.view.config.files.compact,\n\t\t\tb => {\n\t\t\t\tb.compacted = true;\n\t\t\t\treturn true;\n\t\t\t},\n\t\t);\n\n\t\tconst root = new BranchOrTagFolderNode(\n\t\t\tthis.view,\n\t\t\tthis,\n\t\t\t'remote-branch',\n\t\t\tthis.repo.path,\n\t\t\t'',\n\t\t\tundefined,\n\t\t\thierarchy,\n\t\t\t`remote(${this.remote.name})`,\n\t\t);\n\t\tconst children = root.getChildren();\n\t\treturn children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tlet arrows;\n\t\tlet left;\n\t\tlet right;\n\t\tfor (const { type } of this.remote.urls) {\n\t\t\tif (type === GitRemoteType.Fetch) {\n\t\t\t\tleft = true;\n\n\t\t\t\tif (right) break;\n\t\t\t} else if (type === GitRemoteType.Push) {\n\t\t\t\tright = true;\n\n\t\t\t\tif (left) break;\n\t\t\t}\n\t\t}\n\n\t\tif (left && right) {\n\t\t\tarrows = GlyphChars.ArrowsRightLeft;\n\t\t} else if (right) {\n\t\t\tarrows = GlyphChars.ArrowRight;\n\t\t} else if (left) {\n\t\t\tarrows = GlyphChars.ArrowLeft;\n\t\t} else {\n\t\t\tarrows = GlyphChars.Dash;\n\t\t}\n\n\t\tconst item = new TreeItem(this.remote.name, TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\n\t\tif (this.remote.provider != null) {\n\t\t\tconst { provider } = this.remote;\n\n\t\t\titem.description = `${arrows}${GlyphChars.Space} ${provider.name} ${GlyphChars.Space}${GlyphChars.Dot}${GlyphChars.Space} ${provider.displayPath}`;\n\t\t\titem.iconPath =\n\t\t\t\tprovider.icon === 'remote'\n\t\t\t\t\t? new ThemeIcon('cloud')\n\t\t\t\t\t: {\n\t\t\t\t\t\t\tdark: this.view.container.context.asAbsolutePath(`images/dark/icon-${provider.icon}.svg`),\n\t\t\t\t\t\t\tlight: this.view.container.context.asAbsolutePath(`images/light/icon-${provider.icon}.svg`),\n\t\t\t\t\t  };\n\n\t\t\tif (provider.hasRichApi()) {\n\t\t\t\tconst connected = provider.maybeConnected ?? (await provider.isConnected());\n\n\t\t\t\titem.contextValue = `${ContextValues.Remote}${connected ? '+connected' : '+disconnected'}`;\n\t\t\t\titem.tooltip = `${this.remote.name} (${provider.name} ${GlyphChars.Dash} ${\n\t\t\t\t\tconnected ? 'connected' : 'not connected'\n\t\t\t\t})\\n${provider.displayPath}\\n`;\n\t\t\t} else {\n\t\t\t\titem.contextValue = ContextValues.Remote;\n\t\t\t\titem.tooltip = `${this.remote.name} (${provider.name})\\n${provider.displayPath}\\n`;\n\t\t\t}\n\t\t} else {\n\t\t\titem.description = `${arrows}${GlyphChars.Space} ${\n\t\t\t\tthis.remote.domain\n\t\t\t\t\t? `${this.remote.domain} ${GlyphChars.Space}${GlyphChars.Dot}${GlyphChars.Space} `\n\t\t\t\t\t: ''\n\t\t\t}${this.remote.path}`;\n\t\t\titem.contextValue = ContextValues.Remote;\n\t\t\titem.iconPath = new ThemeIcon('cloud');\n\t\t\titem.tooltip = `${this.remote.name} (${this.remote.domain})\\n${this.remote.path}\\n`;\n\t\t}\n\n\t\tif (this.remote.default) {\n\t\t\titem.contextValue += '+default';\n\t\t\titem.resourceUri = Uri.parse('gitlens-view://remote/default');\n\t\t}\n\n\t\tfor (const { type, url } of this.remote.urls) {\n\t\t\titem.tooltip += `\\n${url} (${type})`;\n\t\t}\n\n\t\treturn item;\n\t}\n\n\t@log()\n\tasync setAsDefault(state: boolean = true) {\n\t\tvoid (await this.remote.setAsDefault(state));\n\t\tvoid this.triggerChange();\n\t}\n}\n","import { ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GitUri } from '../../git/gitUri';\nimport { Repository } from '../../git/models';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { RemotesView } from '../remotesView';\nimport { RepositoriesView } from '../repositoriesView';\nimport { MessageNode } from './common';\nimport { RemoteNode } from './remoteNode';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class RemotesNode extends ViewNode<RemotesView | RepositoriesView> {\n\tstatic key = ':remotes';\n\tstatic getId(repoPath: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}`;\n\t}\n\n\tprivate _children: ViewNode[] | undefined;\n\n\tconstructor(uri: GitUri, view: RemotesView | RepositoriesView, parent: ViewNode, public readonly repo: Repository) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride get id(): string {\n\t\treturn RemotesNode.getId(this.repo.path);\n\t}\n\n\tget repoPath(): string {\n\t\treturn this.repo.path;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._children == null) {\n\t\t\tconst remotes = await this.repo.getRemotes({ sort: true });\n\t\t\tif (remotes.length === 0) {\n\t\t\t\treturn [new MessageNode(this.view, this, 'No remotes could be found')];\n\t\t\t}\n\n\t\t\tthis._children = remotes.map(r => new RemoteNode(this.uri, this.view, this, r, this.repo));\n\t\t}\n\n\t\treturn this._children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Remotes', TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.Remotes;\n\t\titem.iconPath = new ThemeIcon('cloud');\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh() {\n\t\tthis._children = undefined;\n\t}\n}\n","import { TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { ViewFilesLayout } from '../../config';\nimport { CommitFormatter } from '../../git/formatters';\nimport { GitStashCommit, GitStashReference } from '../../git/models';\nimport { makeHierarchical } from '../../system/array';\nimport { joinPaths, normalizePath } from '../../system/path';\nimport { sortCompare } from '../../system/string';\nimport { ContextValues, FileNode, FolderNode, RepositoryNode, StashFileNode, ViewNode, ViewRefNode } from '../nodes';\nimport { RepositoriesView } from '../repositoriesView';\nimport { StashesView } from '../stashesView';\n\nexport class StashNode extends ViewRefNode<StashesView | RepositoriesView, GitStashReference> {\n\tstatic key = ':stash';\n\tstatic getId(repoPath: string, ref: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${ref})`;\n\t}\n\n\tconstructor(view: StashesView | RepositoriesView, parent: ViewNode, public readonly commit: GitStashCommit) {\n\t\tsuper(commit.getGitUri(), view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.commit.stashName;\n\t}\n\n\toverride get id(): string {\n\t\treturn StashNode.getId(this.commit.repoPath, this.commit.sha);\n\t}\n\n\tget ref(): GitStashReference {\n\t\treturn this.commit;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\t// Ensure we have checked for untracked files (inside the getCommitsForFiles call)\n\t\tconst commits = await this.commit.getCommitsForFiles();\n\t\tlet children: FileNode[] = commits.map(c => new StashFileNode(this.view, this, c.file!, c as GitStashCommit));\n\n\t\tif (this.view.config.files.layout !== ViewFilesLayout.List) {\n\t\t\tconst hierarchy = makeHierarchical(\n\t\t\t\tchildren,\n\t\t\t\tn => n.uri.relativePath.split('/'),\n\t\t\t\t(...parts: string[]) => normalizePath(joinPaths(...parts)),\n\t\t\t\tthis.view.config.files.compact,\n\t\t\t);\n\n\t\t\tconst root = new FolderNode(this.view, this, this.repoPath, '', hierarchy);\n\t\t\tchildren = root.getChildren() as FileNode[];\n\t\t} else {\n\t\t\tchildren.sort((a, b) => sortCompare(a.label!, b.label!));\n\t\t}\n\t\treturn children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(\n\t\t\tCommitFormatter.fromTemplate(this.view.config.formats.stashes.label, this.commit, {\n\t\t\t\tmessageTruncateAtNewLine: true,\n\t\t\t\tdateFormat: this.view.container.config.defaultDateFormat,\n\t\t\t}),\n\t\t\tTreeItemCollapsibleState.Collapsed,\n\t\t);\n\t\titem.id = this.id;\n\t\titem.description = CommitFormatter.fromTemplate(this.view.config.formats.stashes.description, this.commit, {\n\t\t\tmessageTruncateAtNewLine: true,\n\t\t\tdateFormat: this.view.container.config.defaultDateFormat,\n\t\t});\n\t\titem.contextValue = ContextValues.Stash;\n\t\titem.tooltip = CommitFormatter.fromTemplate(`\\${ago} (\\${date})\\n\\n\\${message}`, this.commit, {\n\t\t\tdateFormat: this.view.container.config.defaultDateFormat,\n\t\t\t// messageAutolinks: true,\n\t\t});\n\n\t\treturn item;\n\t}\n}\n","import { TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GitUri } from '../../git/gitUri';\nimport { Repository } from '../../git/models';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { map } from '../../system/iterable';\nimport { RepositoriesView } from '../repositoriesView';\nimport { StashesView } from '../stashesView';\nimport { MessageNode } from './common';\nimport { RepositoryNode } from './repositoryNode';\nimport { StashNode } from './stashNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class StashesNode extends ViewNode<StashesView | RepositoriesView> {\n\tstatic key = ':stashes';\n\tstatic getId(repoPath: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}`;\n\t}\n\n\tprivate _children: ViewNode[] | undefined;\n\n\tconstructor(uri: GitUri, view: StashesView | RepositoriesView, parent: ViewNode, public readonly repo: Repository) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride get id(): string {\n\t\treturn StashesNode.getId(this.repo.path);\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._children == null) {\n\t\t\tconst stash = await this.repo.getStash();\n\t\t\tif (stash == null) return [new MessageNode(this.view, this, 'No stashes could be found.')];\n\n\t\t\tthis._children = [...map(stash.commits.values(), c => new StashNode(this.view, this, c))];\n\t\t}\n\n\t\treturn this._children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Stashes', TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.Stashes;\n\n\t\titem.iconPath = {\n\t\t\tdark: this.view.container.context.asAbsolutePath('images/dark/icon-stash.svg'),\n\t\t\tlight: this.view.container.context.asAbsolutePath('images/light/icon-stash.svg'),\n\t\t};\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh() {\n\t\tthis._children = undefined;\n\t}\n}\n","import { TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { ViewFilesLayout } from '../../configuration';\nimport { GitUri } from '../../git/gitUri';\nimport { GitCommit, GitFileWithCommit, GitLog, GitStatus, GitStatusFile, GitTrackingState } from '../../git/models';\nimport { groupBy, makeHierarchical } from '../../system/array';\nimport { filter, flatMap, map } from '../../system/iterable';\nimport { joinPaths, normalizePath } from '../../system/path';\nimport { pluralize, sortCompare } from '../../system/string';\nimport { RepositoriesView } from '../repositoriesView';\nimport { WorktreesView } from '../worktreesView';\nimport { FileNode, FolderNode } from './folderNode';\nimport { RepositoryNode } from './repositoryNode';\nimport { StatusFileNode } from './statusFileNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class StatusFilesNode extends ViewNode<RepositoriesView | WorktreesView> {\n\tstatic key = ':status-files';\n\tstatic getId(repoPath: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}`;\n\t}\n\n\treadonly repoPath: string;\n\n\tconstructor(\n\t\tview: RepositoriesView | WorktreesView,\n\t\tparent: ViewNode,\n\t\tpublic readonly status:\n\t\t\t| GitStatus\n\t\t\t| {\n\t\t\t\t\treadonly repoPath: string;\n\t\t\t\t\treadonly files: GitStatusFile[];\n\t\t\t\t\treadonly state: GitTrackingState;\n\t\t\t\t\treadonly upstream?: string;\n\t\t\t  },\n\t\tpublic readonly range: string | undefined,\n\t) {\n\t\tsuper(GitUri.fromRepoPath(status.repoPath), view, parent);\n\t\tthis.repoPath = status.repoPath;\n\t}\n\n\toverride get id(): string {\n\t\treturn StatusFilesNode.getId(this.repoPath);\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tlet files: GitFileWithCommit[] = [];\n\n\t\tconst repoPath = this.repoPath;\n\n\t\tlet log: GitLog | undefined;\n\t\tif (this.range != null) {\n\t\t\tlog = await this.view.container.git.getLog(repoPath, { limit: 0, ref: this.range });\n\t\t\tif (log != null) {\n\t\t\t\tawait Promise.allSettled(\n\t\t\t\t\tmap(\n\t\t\t\t\t\tfilter(log.commits.values(), c => c.files == null),\n\t\t\t\t\t\tc => c.ensureFullDetails(),\n\t\t\t\t\t),\n\t\t\t\t);\n\n\t\t\t\tfiles = [\n\t\t\t\t\t...flatMap(\n\t\t\t\t\t\tlog.commits.values(),\n\t\t\t\t\t\tc => c.files?.map<GitFileWithCommit>(f => ({ ...f, commit: c })) ?? [],\n\t\t\t\t\t),\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\t(this.view instanceof WorktreesView || this.view.config.includeWorkingTree) &&\n\t\t\tthis.status.files.length !== 0\n\t\t) {\n\t\t\tfiles.splice(\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\t...flatMap(this.status.files, f =>\n\t\t\t\t\tmap(f.getPseudoCommits(this.view.container, undefined), c => this.getFileWithPseudoCommit(f, c)),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tfiles.sort((a, b) => b.commit.date.getTime() - a.commit.date.getTime());\n\n\t\tconst groups = groupBy(files, s => s.path);\n\n\t\tlet children: FileNode[] = Object.values(groups).map(\n\t\t\tfiles =>\n\t\t\t\tnew StatusFileNode(\n\t\t\t\t\tthis.view,\n\t\t\t\t\tthis,\n\t\t\t\t\trepoPath,\n\t\t\t\t\tfiles[files.length - 1],\n\t\t\t\t\tfiles.map(s => s.commit),\n\t\t\t\t),\n\t\t);\n\n\t\tif (this.view.config.files.layout !== ViewFilesLayout.List) {\n\t\t\tconst hierarchy = makeHierarchical(\n\t\t\t\tchildren,\n\t\t\t\tn => n.uri.relativePath.split('/'),\n\t\t\t\t(...parts: string[]) => normalizePath(joinPaths(...parts)),\n\t\t\t\tthis.view.config.files.compact,\n\t\t\t);\n\n\t\t\tconst root = new FolderNode(this.view, this, repoPath, '', hierarchy, true);\n\t\t\tchildren = root.getChildren() as FileNode[];\n\t\t} else {\n\t\t\tchildren.sort((a, b) => a.priority - b.priority || sortCompare(a.label!, b.label!));\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tlet files =\n\t\t\tthis.view instanceof WorktreesView || this.view.config.includeWorkingTree ? this.status.files.length : 0;\n\n\t\tif (this.range != null) {\n\t\t\tif (this.status.upstream != null && this.status.state.ahead > 0) {\n\t\t\t\tif (files > 0) {\n\t\t\t\t\tconst aheadFiles = await this.view.container.git.getDiffStatus(\n\t\t\t\t\t\tthis.repoPath,\n\t\t\t\t\t\t`${this.status.upstream}...`,\n\t\t\t\t\t);\n\n\t\t\t\t\tif (aheadFiles != null) {\n\t\t\t\t\t\tconst uniques = new Set();\n\t\t\t\t\t\tfor (const f of this.status.files) {\n\t\t\t\t\t\t\tuniques.add(f.path);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (const f of aheadFiles) {\n\t\t\t\t\t\t\tuniques.add(f.path);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfiles = uniques.size;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst stats = await this.view.container.git.getChangedFilesCount(\n\t\t\t\t\t\tthis.repoPath,\n\t\t\t\t\t\t`${this.status.upstream}...`,\n\t\t\t\t\t);\n\t\t\t\t\tif (stats != null) {\n\t\t\t\t\t\tfiles += stats.changedFiles;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfiles = -1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst label = files === -1 ? '?? files changed' : `${pluralize('file', files)} changed`;\n\t\tconst item = new TreeItem(label, TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.StatusFiles;\n\t\titem.iconPath = {\n\t\t\tdark: this.view.container.context.asAbsolutePath('images/dark/icon-diff.svg'),\n\t\t\tlight: this.view.container.context.asAbsolutePath('images/light/icon-diff.svg'),\n\t\t};\n\n\t\treturn item;\n\t}\n\n\tprivate getFileWithPseudoCommit(file: GitStatusFile, commit: GitCommit): GitFileWithCommit {\n\t\treturn {\n\t\t\tstatus: file.status,\n\t\t\trepoPath: file.repoPath,\n\t\t\tindexStatus: file.indexStatus,\n\t\t\tworkingTreeStatus: file.workingTreeStatus,\n\t\t\tpath: file.path,\n\t\t\toriginalPath: file.originalPath,\n\t\t\tcommit: commit,\n\t\t};\n\t}\n}\n","import { TreeItem, TreeItemCollapsibleState, window } from 'vscode';\nimport { ViewBranchesLayout } from '../../configuration';\nimport { GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { emojify } from '../../emojis';\nimport { GitUri } from '../../git/gitUri';\nimport { GitLog, GitRevision, GitTag, GitTagReference } from '../../git/models';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { map } from '../../system/iterable';\nimport { pad } from '../../system/string';\nimport { RepositoriesView } from '../repositoriesView';\nimport { TagsView } from '../tagsView';\nimport { CommitNode } from './commitNode';\nimport { LoadMoreNode, MessageNode } from './common';\nimport { insertDateMarkers } from './helpers';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, PageableViewNode, ViewNode, ViewRefNode } from './viewNode';\n\nexport class TagNode extends ViewRefNode<TagsView | RepositoriesView, GitTagReference> implements PageableViewNode {\n\tstatic key = ':tag';\n\tstatic getId(repoPath: string, name: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${name})`;\n\t}\n\n\tconstructor(uri: GitUri, view: TagsView | RepositoriesView, parent: ViewNode, public readonly tag: GitTag) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.tag.name;\n\t}\n\n\toverride get id(): string {\n\t\treturn TagNode.getId(this.tag.repoPath, this.tag.name);\n\t}\n\n\tget label(): string {\n\t\treturn this.view.config.branches.layout === ViewBranchesLayout.Tree ? this.tag.getBasename() : this.tag.name;\n\t}\n\n\tget ref(): GitTagReference {\n\t\treturn this.tag;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tconst log = await this.getLog();\n\t\tif (log == null) return [new MessageNode(this.view, this, 'No commits could be found.')];\n\n\t\tconst getBranchAndTagTips = await this.view.container.git.getBranchesAndTagsTipsFn(\n\t\t\tthis.uri.repoPath,\n\t\t\tthis.tag.name,\n\t\t);\n\t\tconst children = [\n\t\t\t...insertDateMarkers(\n\t\t\t\tmap(\n\t\t\t\t\tlog.commits.values(),\n\t\t\t\t\tc => new CommitNode(this.view, this, c, undefined, undefined, getBranchAndTagTips),\n\t\t\t\t),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\n\t\tif (log.hasMore) {\n\t\t\tchildren.push(\n\t\t\t\tnew LoadMoreNode(this.view, this, children[children.length - 1], undefined, () =>\n\t\t\t\t\tthis.view.container.git.getCommitCount(this.tag.repoPath, this.tag.name),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t\treturn children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(this.label, TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.Tag;\n\t\titem.description = emojify(this.tag.message);\n\t\titem.tooltip = `${this.tag.name}${pad(GlyphChars.Dash, 2, 2)}${GitRevision.shorten(this.tag.sha, {\n\t\t\tforce: true,\n\t\t})}\\n${this.tag.formatDateFromNow()} (${this.tag.formatDate(\n\t\t\tContainer.instance.TagDateFormatting.dateFormat,\n\t\t)})\\n\\n${emojify(this.tag.message)}${\n\t\t\tthis.tag.commitDate != null && this.tag.date !== this.tag.commitDate\n\t\t\t\t? `\\n${this.tag.formatCommitDateFromNow()} (${this.tag.formatCommitDate(\n\t\t\t\t\t\tContainer.instance.TagDateFormatting.dateFormat,\n\t\t\t\t  )})`\n\t\t\t\t: ''\n\t\t}`;\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset?: boolean) {\n\t\tif (reset) {\n\t\t\tthis._log = undefined;\n\t\t}\n\t}\n\n\tprivate _log: GitLog | undefined;\n\tprivate async getLog() {\n\t\tif (this._log == null) {\n\t\t\tthis._log = await this.view.container.git.getLog(this.uri.repoPath!, {\n\t\t\t\tlimit: this.limit ?? this.view.config.defaultItemLimit,\n\t\t\t\tref: this.tag.name,\n\t\t\t});\n\t\t}\n\n\t\treturn this._log;\n\t}\n\n\tget hasMore() {\n\t\treturn this._log?.hasMore ?? true;\n\t}\n\n\tlimit: number | undefined = this.view.getNodeLastKnownLimit(this);\n\t@gate()\n\tasync loadMore(limit?: number | { until?: any }) {\n\t\tlet log = await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: { viewId: this.view.id },\n\t\t\t},\n\t\t\t() => this.getLog(),\n\t\t);\n\t\tif (log == null || !log.hasMore) return;\n\n\t\tlog = await log.more?.(limit ?? this.view.config.pageItemLimit);\n\t\tif (this._log === log) return;\n\n\t\tthis._log = log;\n\t\tthis.limit = log?.count;\n\n\t\tvoid this.triggerChange(false);\n\t}\n}\n","import { ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { ViewBranchesLayout } from '../../configuration';\nimport { GitUri } from '../../git/gitUri';\nimport { Repository } from '../../git/models';\nimport { makeHierarchical } from '../../system/array';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { RepositoriesView } from '../repositoriesView';\nimport { TagsView } from '../tagsView';\nimport { BranchOrTagFolderNode } from './branchOrTagFolderNode';\nimport { MessageNode } from './common';\nimport { RepositoryNode } from './repositoryNode';\nimport { TagNode } from './tagNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class TagsNode extends ViewNode<TagsView | RepositoriesView> {\n\tstatic key = ':tags';\n\tstatic getId(repoPath: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}`;\n\t}\n\n\tprivate _children: ViewNode[] | undefined;\n\n\tconstructor(uri: GitUri, view: TagsView | RepositoriesView, parent: ViewNode, public readonly repo: Repository) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride get id(): string {\n\t\treturn TagsNode.getId(this.repo.path);\n\t}\n\n\tget repoPath(): string {\n\t\treturn this.repo.path;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._children == null) {\n\t\t\tconst tags = await this.repo.getTags({ sort: true });\n\t\t\tif (tags.values.length === 0) return [new MessageNode(this.view, this, 'No tags could be found.')];\n\n\t\t\t// TODO@eamodio handle paging\n\t\t\tconst tagNodes = tags.values.map(\n\t\t\t\tt => new TagNode(GitUri.fromRepoPath(this.uri.repoPath!, t.ref), this.view, this, t),\n\t\t\t);\n\t\t\tif (this.view.config.branches.layout === ViewBranchesLayout.List) return tagNodes;\n\n\t\t\tconst hierarchy = makeHierarchical(\n\t\t\t\ttagNodes,\n\t\t\t\tn => n.tag.name.split('/'),\n\t\t\t\t(...paths) => paths.join('/'),\n\t\t\t\tthis.view.config.files.compact,\n\t\t\t);\n\n\t\t\tconst root = new BranchOrTagFolderNode(\n\t\t\t\tthis.view,\n\t\t\t\tthis,\n\t\t\t\t'tag',\n\t\t\t\tthis.repo.path,\n\t\t\t\t'',\n\t\t\t\tundefined,\n\t\t\t\thierarchy,\n\t\t\t\t'tags',\n\t\t\t);\n\t\t\tthis._children = root.getChildren();\n\t\t}\n\n\t\treturn this._children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Tags', TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.Tags;\n\t\titem.iconPath = new ThemeIcon('tag');\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh() {\n\t\tthis._children = undefined;\n\t}\n}\n","import { Command, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { DiffWithPreviousCommandArgs } from '../../commands';\nimport { Commands } from '../../constants';\nimport { StatusFileFormatter } from '../../git/formatters';\nimport { GitUri } from '../../git/gitUri';\nimport { GitFile } from '../../git/models';\nimport { dirname, joinPaths } from '../../system/path';\nimport { ViewsWithCommits } from '../viewBase';\nimport { FileNode } from './folderNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class UncommittedFileNode extends ViewNode<ViewsWithCommits> implements FileNode {\n\tpublic readonly file: GitFile;\n\tpublic readonly repoPath: string;\n\n\tconstructor(view: ViewsWithCommits, parent: ViewNode, repoPath: string, file: GitFile) {\n\t\tsuper(GitUri.fromFile(file, repoPath), view, parent);\n\n\t\tthis.repoPath = repoPath;\n\t\tthis.file = file;\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.path;\n\t}\n\n\tget path(): string {\n\t\treturn this.file.path;\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\treturn [];\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(this.label, TreeItemCollapsibleState.None);\n\t\titem.contextValue = ContextValues.File;\n\t\titem.description = this.description;\n\t\t// Use the file icon and decorations\n\t\titem.resourceUri = this.view.container.git.getAbsoluteUri(this.file.path, this.repoPath);\n\n\t\tconst icon = GitFile.getStatusIcon(this.file.status);\n\t\titem.iconPath = {\n\t\t\tdark: this.view.container.context.asAbsolutePath(joinPaths('images', 'dark', icon)),\n\t\t\tlight: this.view.container.context.asAbsolutePath(joinPaths('images', 'light', icon)),\n\t\t};\n\n\t\titem.tooltip = StatusFileFormatter.fromTemplate(\n\t\t\t`\\${file}\\n\\${directory}/\\n\\n\\${status}\\${ (originalPath)}`,\n\t\t\tthis.file,\n\t\t);\n\n\t\titem.command = this.getCommand();\n\n\t\t// Only cache the label/description for a single refresh\n\t\tthis._label = undefined;\n\t\tthis._description = undefined;\n\n\t\treturn item;\n\t}\n\n\tprivate _description: string | undefined;\n\tget description() {\n\t\tif (this._description == null) {\n\t\t\tthis._description = StatusFileFormatter.fromTemplate(\n\t\t\t\tthis.view.config.formats.files.description,\n\t\t\t\t{ ...this.file },\n\t\t\t\t{ relativePath: this.relativePath },\n\t\t\t);\n\t\t}\n\t\treturn this._description;\n\t}\n\n\tprivate _folderName: string | undefined;\n\tget folderName() {\n\t\tif (this._folderName == null) {\n\t\t\tthis._folderName = dirname(this.uri.relativePath);\n\t\t}\n\t\treturn this._folderName;\n\t}\n\n\tprivate _label: string | undefined;\n\tget label() {\n\t\tif (this._label == null) {\n\t\t\tthis._label = StatusFileFormatter.fromTemplate(\n\t\t\t\t`\\${file}`,\n\t\t\t\t{ ...this.file },\n\t\t\t\t{ relativePath: this.relativePath },\n\t\t\t);\n\t\t}\n\t\treturn this._label;\n\t}\n\n\tget priority(): number {\n\t\treturn 0;\n\t}\n\n\tprivate _relativePath: string | undefined;\n\tget relativePath(): string | undefined {\n\t\treturn this._relativePath;\n\t}\n\tset relativePath(value: string | undefined) {\n\t\tthis._relativePath = value;\n\t\tthis._label = undefined;\n\t\tthis._description = undefined;\n\t}\n\n\toverride getCommand(): Command | undefined {\n\t\tconst commandArgs: DiffWithPreviousCommandArgs = {\n\t\t\turi: GitUri.fromFile(this.file, this.repoPath),\n\t\t\tline: 0,\n\t\t\tshowOptions: {\n\t\t\t\tpreserveFocus: true,\n\t\t\t\tpreview: true,\n\t\t\t},\n\t\t};\n\t\treturn {\n\t\t\ttitle: 'Open Changes with Previous Revision',\n\t\t\tcommand: Commands.DiffWithPrevious,\n\t\t\targuments: [undefined, commandArgs],\n\t\t};\n\t}\n}\n","'use strict';\nimport { ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { ViewFilesLayout } from '../../config';\nimport { GitUri } from '../../git/gitUri';\nimport {\n\tGitCommit,\n\tGitCommitIdentity,\n\tGitFileChange,\n\tGitFileWithCommit,\n\tGitRevision,\n\tGitStatus,\n\tGitStatusFile,\n\tGitTrackingState,\n} from '../../git/models';\nimport { groupBy, makeHierarchical } from '../../system/array';\nimport { flatMap } from '../../system/iterable';\nimport { joinPaths, normalizePath } from '../../system/path';\nimport { RepositoriesView } from '../repositoriesView';\nimport { WorktreesView } from '../worktreesView';\nimport { FileNode, FolderNode } from './folderNode';\nimport { RepositoryNode } from './repositoryNode';\nimport { UncommittedFileNode } from './UncommittedFileNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class UncommittedFilesNode extends ViewNode<RepositoriesView | WorktreesView> {\n\tstatic key = ':uncommitted-files';\n\tstatic getId(repoPath: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}`;\n\t}\n\n\treadonly repoPath: string;\n\n\tconstructor(\n\t\tview: RepositoriesView | WorktreesView,\n\t\tparent: ViewNode,\n\t\tpublic readonly status:\n\t\t\t| GitStatus\n\t\t\t| {\n\t\t\t\t\treadonly repoPath: string;\n\t\t\t\t\treadonly files: GitStatusFile[];\n\t\t\t\t\treadonly state: GitTrackingState;\n\t\t\t\t\treadonly upstream?: string;\n\t\t\t  },\n\t\tpublic readonly range: string | undefined,\n\t) {\n\t\tsuper(GitUri.fromRepoPath(status.repoPath), view, parent);\n\t\tthis.repoPath = status.repoPath;\n\t}\n\n\toverride get id(): string {\n\t\treturn UncommittedFilesNode.getId(this.repoPath);\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\tconst repoPath = this.repoPath;\n\n\t\tconst files: GitFileWithCommit[] = [\n\t\t\t...flatMap(this.status.files, f => {\n\t\t\t\tif (f.workingTreeStatus != null && f.indexStatus != null) {\n\t\t\t\t\t// Decrements the date to guarantee this entry will be sorted after the previous entry (most recent first)\n\t\t\t\t\tconst older = new Date();\n\t\t\t\t\tolder.setMilliseconds(older.getMilliseconds() - 1);\n\n\t\t\t\t\treturn [\n\t\t\t\t\t\tthis.getFileWithPseudoCommit(f, GitRevision.uncommitted, GitRevision.uncommittedStaged),\n\t\t\t\t\t\tthis.getFileWithPseudoCommit(f, GitRevision.uncommittedStaged, 'HEAD', older),\n\t\t\t\t\t];\n\t\t\t\t} else if (f.indexStatus != null) {\n\t\t\t\t\treturn [this.getFileWithPseudoCommit(f, GitRevision.uncommittedStaged, 'HEAD')];\n\t\t\t\t}\n\n\t\t\t\treturn [this.getFileWithPseudoCommit(f, GitRevision.uncommitted, 'HEAD')];\n\t\t\t}),\n\t\t];\n\n\t\tfiles.sort((a, b) => b.commit.date.getTime() - a.commit.date.getTime());\n\n\t\tconst groups = groupBy(files, f => f.path);\n\n\t\tlet children: FileNode[] = Object.values(groups).map(\n\t\t\tfiles => new UncommittedFileNode(this.view, this, repoPath, files[files.length - 1]),\n\t\t);\n\n\t\tif (this.view.config.files.layout !== ViewFilesLayout.List) {\n\t\t\tconst hierarchy = makeHierarchical(\n\t\t\t\tchildren,\n\t\t\t\tn => n.uri.relativePath.split('/'),\n\t\t\t\t(...parts: string[]) => normalizePath(joinPaths(...parts)),\n\t\t\t\tthis.view.config.files.compact,\n\t\t\t);\n\n\t\t\tconst root = new FolderNode(this.view, this, repoPath, '', hierarchy, true);\n\t\t\tchildren = root.getChildren() as FileNode[];\n\t\t} else {\n\t\t\tchildren.sort(\n\t\t\t\t(a, b) =>\n\t\t\t\t\ta.priority - b.priority ||\n\t\t\t\t\ta.label!.localeCompare(b.label!, undefined, { numeric: true, sensitivity: 'base' }),\n\t\t\t);\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Uncommitted changes', TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.UncommittedFiles;\n\t\titem.iconPath = new ThemeIcon('folder');\n\n\t\treturn item;\n\t}\n\n\tprivate getFileWithPseudoCommit(\n\t\tfile: GitStatusFile,\n\t\tref: string,\n\t\tpreviousRef: string,\n\t\tdate?: Date,\n\t): GitFileWithCommit {\n\t\tdate = date ?? new Date();\n\t\treturn {\n\t\t\tstatus: file.status,\n\t\t\trepoPath: file.repoPath,\n\t\t\tindexStatus: file.indexStatus,\n\t\t\tworkingTreeStatus: file.workingTreeStatus,\n\t\t\tpath: file.path,\n\t\t\toriginalPath: file.originalPath,\n\t\t\tcommit: new GitCommit(\n\t\t\t\tthis.view.container,\n\t\t\t\tfile.repoPath,\n\t\t\t\tref,\n\t\t\t\tnew GitCommitIdentity('You', undefined, date),\n\t\t\t\tnew GitCommitIdentity('You', undefined, date),\n\t\t\t\t'Uncommitted changes',\n\t\t\t\t[previousRef],\n\t\t\t\t'Uncommitted changes',\n\t\t\t\tnew GitFileChange(file.repoPath, file.path, file.status, file.originalPath, previousRef),\n\t\t\t\tundefined,\n\t\t\t\t[],\n\t\t\t),\n\t\t};\n\t}\n}\n","import { MarkdownString, ThemeIcon, TreeItem, TreeItemCollapsibleState, Uri, window } from 'vscode';\nimport { GlyphChars } from '../../constants';\nimport { GitUri } from '../../git/gitUri';\nimport {\n\tGitBranch,\n\tGitLog,\n\tGitRemote,\n\tGitRemoteType,\n\tGitRevision,\n\tGitWorktree,\n\tPullRequestState,\n} from '../../git/models';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { map } from '../../system/iterable';\nimport { pad } from '../../system/string';\nimport { RepositoriesView } from '../repositoriesView';\nimport { WorktreesView } from '../worktreesView';\nimport { CommitNode } from './commitNode';\nimport { LoadMoreNode, MessageNode } from './common';\nimport { CompareBranchNode } from './compareBranchNode';\nimport { insertDateMarkers } from './helpers';\nimport { PullRequestNode } from './pullRequestNode';\nimport { RepositoryNode } from './repositoryNode';\nimport { UncommittedFilesNode } from './UncommittedFilesNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class WorktreeNode extends ViewNode<WorktreesView | RepositoriesView> {\n\tstatic key = ':worktree';\n\tstatic getId(repoPath: string, uri: Uri): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${uri.path})`;\n\t}\n\n\tprivate _branch: GitBranch | undefined;\n\tprivate _children: ViewNode[] | undefined;\n\n\tconstructor(\n\t\turi: GitUri,\n\t\tview: WorktreesView | RepositoriesView,\n\t\tparent: ViewNode,\n\t\tpublic readonly worktree: GitWorktree,\n\t) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.worktree.uri.fsPath;\n\t}\n\n\toverride get id(): string {\n\t\treturn WorktreeNode.getId(this.worktree.repoPath, this.worktree.uri);\n\t}\n\n\tget repoPath(): string {\n\t\treturn this.uri.repoPath!;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._children == null) {\n\t\t\tconst branch = this._branch;\n\n\t\t\tlet prPromise;\n\t\t\tif (\n\t\t\t\tbranch != null &&\n\t\t\t\tthis.view.config.pullRequests.enabled &&\n\t\t\t\tthis.view.config.pullRequests.showForBranches &&\n\t\t\t\t(branch.upstream != null || branch.remote)\n\t\t\t) {\n\t\t\t\tprPromise = branch.getAssociatedPullRequest({\n\t\t\t\t\tinclude: [PullRequestState.Open, PullRequestState.Merged],\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst range =\n\t\t\t\tbranch != null && !branch.remote\n\t\t\t\t\t? await this.view.container.git.getBranchAheadRange(branch)\n\t\t\t\t\t: undefined;\n\t\t\tconst [log, getBranchAndTagTips, status, unpublishedCommits] = await Promise.all([\n\t\t\t\tthis.getLog(),\n\t\t\t\tthis.view.container.git.getBranchesAndTagsTipsFn(this.uri.repoPath),\n\t\t\t\tthis.worktree.getStatus(),\n\t\t\t\trange\n\t\t\t\t\t? this.view.container.git.getLogRefsOnly(this.uri.repoPath!, {\n\t\t\t\t\t\t\tlimit: 0,\n\t\t\t\t\t\t\tref: range,\n\t\t\t\t\t  })\n\t\t\t\t\t: undefined,\n\t\t\t]);\n\t\t\tif (log == null) return [new MessageNode(this.view, this, 'No commits could be found.')];\n\n\t\t\tconst children = [];\n\n\t\t\tlet prInsertIndex = 0;\n\n\t\t\tif (branch != null && this.view.config.showBranchComparison !== false) {\n\t\t\t\tprInsertIndex++;\n\t\t\t\tchildren.push(\n\t\t\t\t\tnew CompareBranchNode(\n\t\t\t\t\t\tthis.uri,\n\t\t\t\t\t\tthis.view,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tbranch,\n\t\t\t\t\t\tthis.view.config.showBranchComparison,\n\t\t\t\t\t\tthis.splatted,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tchildren.push(\n\t\t\t\t...insertDateMarkers(\n\t\t\t\t\tmap(\n\t\t\t\t\t\tlog.commits.values(),\n\t\t\t\t\t\tc =>\n\t\t\t\t\t\t\tnew CommitNode(\n\t\t\t\t\t\t\t\tthis.view,\n\t\t\t\t\t\t\t\tthis,\n\t\t\t\t\t\t\t\tc,\n\t\t\t\t\t\t\t\tunpublishedCommits?.has(c.ref),\n\t\t\t\t\t\t\t\tbranch,\n\t\t\t\t\t\t\t\tgetBranchAndTagTips,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t\tthis,\n\t\t\t\t),\n\t\t\t);\n\n\t\t\tif (log.hasMore) {\n\t\t\t\tchildren.push(new LoadMoreNode(this.view, this, children[children.length - 1]));\n\t\t\t}\n\n\t\t\tif (status?.hasChanges) {\n\t\t\t\tchildren.splice(0, 0, new UncommittedFilesNode(this.view, this, status, undefined));\n\t\t\t}\n\n\t\t\tif (prPromise != null) {\n\t\t\t\tconst pr = await prPromise;\n\t\t\t\tif (pr != null) {\n\t\t\t\t\tchildren.splice(prInsertIndex, 0, new PullRequestNode(this.view, this, pr, branch!));\n\t\t\t\t}\n\n\t\t\t\t// const pr = await Promise.race([\n\t\t\t\t// \tprPromise,\n\t\t\t\t// \tnew Promise<null>(resolve => setTimeout(() => resolve(null), 100)),\n\t\t\t\t// ]);\n\t\t\t\t// if (pr != null) {\n\t\t\t\t// \tchildren.splice(prInsertIndex, 0, new PullRequestNode(this.view, this, pr, this.branch));\n\t\t\t\t// } else if (pr === null) {\n\t\t\t\t// \tvoid prPromise.then(pr => {\n\t\t\t\t// \t\tif (pr == null) return;\n\n\t\t\t\t// \t\tvoid this.triggerChange();\n\t\t\t\t// \t});\n\t\t\t\t// }\n\t\t\t}\n\n\t\t\tthis._children = children;\n\t\t}\n\t\treturn this._children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tthis.splatted = false;\n\n\t\tlet description = '';\n\t\tconst tooltip = new MarkdownString('', true);\n\t\tlet icon: ThemeIcon | undefined;\n\t\tlet hasChanges = false;\n\n\t\tconst indicators =\n\t\t\tthis.worktree.main || this.worktree.opened\n\t\t\t\t? `${pad(GlyphChars.Dash, 2, 2)} ${\n\t\t\t\t\t\tthis.worktree.main\n\t\t\t\t\t\t\t? `_Main${this.worktree.opened ? ', Active_' : '_'}`\n\t\t\t\t\t\t\t: this.worktree.opened\n\t\t\t\t\t\t\t? '_Active_'\n\t\t\t\t\t\t\t: ''\n\t\t\t\t  } `\n\t\t\t\t: '';\n\n\t\tswitch (this.worktree.type) {\n\t\t\tcase 'bare':\n\t\t\t\ticon = new ThemeIcon('folder');\n\t\t\t\ttooltip.appendMarkdown(\n\t\t\t\t\t`${this.worktree.main ? '$(pass) ' : ''}Bare Worktree${indicators}\\\\\\n\\`${\n\t\t\t\t\t\tthis.worktree.friendlyPath\n\t\t\t\t\t}\\``,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase 'branch': {\n\t\t\t\tconst [branch, status] = await Promise.all([this.worktree.getBranch(), this.worktree.getStatus()]);\n\t\t\t\tthis._branch = branch;\n\n\t\t\t\ttooltip.appendMarkdown(\n\t\t\t\t\t`${this.worktree.main ? '$(pass) ' : ''}Worktree for Branch $(git-branch) ${\n\t\t\t\t\t\tbranch?.getNameWithoutRemote() ?? this.worktree.branch\n\t\t\t\t\t}${indicators}\\\\\\n\\`${this.worktree.friendlyPath}\\``,\n\t\t\t\t);\n\t\t\t\ticon = new ThemeIcon('git-branch');\n\n\t\t\t\tif (status != null) {\n\t\t\t\t\thasChanges = status.hasChanges;\n\t\t\t\t\ttooltip.appendMarkdown(\n\t\t\t\t\t\t`\\n\\n${status.getFormattedDiffStatus({\n\t\t\t\t\t\t\tprefix: 'Has Uncommitted Changes\\\\\\n',\n\t\t\t\t\t\t\tempty: 'No Uncommitted Changes',\n\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t})}`,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (branch != null) {\n\t\t\t\t\ttooltip.appendMarkdown(`\\n\\nBranch $(git-branch) ${branch.getNameWithoutRemote()}`);\n\n\t\t\t\t\tif (!branch.remote) {\n\t\t\t\t\t\tif (branch.upstream != null) {\n\t\t\t\t\t\t\tlet arrows = GlyphChars.Dash;\n\n\t\t\t\t\t\t\tconst remote = await branch.getRemote();\n\t\t\t\t\t\t\tif (!branch.upstream.missing) {\n\t\t\t\t\t\t\t\tif (remote != null) {\n\t\t\t\t\t\t\t\t\tlet left;\n\t\t\t\t\t\t\t\t\tlet right;\n\t\t\t\t\t\t\t\t\tfor (const { type } of remote.urls) {\n\t\t\t\t\t\t\t\t\t\tif (type === GitRemoteType.Fetch) {\n\t\t\t\t\t\t\t\t\t\t\tleft = true;\n\n\t\t\t\t\t\t\t\t\t\t\tif (right) break;\n\t\t\t\t\t\t\t\t\t\t} else if (type === GitRemoteType.Push) {\n\t\t\t\t\t\t\t\t\t\t\tright = true;\n\n\t\t\t\t\t\t\t\t\t\t\tif (left) break;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (left && right) {\n\t\t\t\t\t\t\t\t\t\tarrows = GlyphChars.ArrowsRightLeft;\n\t\t\t\t\t\t\t\t\t} else if (right) {\n\t\t\t\t\t\t\t\t\t\tarrows = GlyphChars.ArrowRight;\n\t\t\t\t\t\t\t\t\t} else if (left) {\n\t\t\t\t\t\t\t\t\t\tarrows = GlyphChars.ArrowLeft;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tarrows = GlyphChars.Warning;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdescription = `${branch.getTrackingStatus({\n\t\t\t\t\t\t\t\tempty: pad(arrows, 0, 2),\n\t\t\t\t\t\t\t\tsuffix: pad(arrows, 2, 2),\n\t\t\t\t\t\t\t})}${branch.upstream.name}`;\n\n\t\t\t\t\t\t\ttooltip.appendMarkdown(\n\t\t\t\t\t\t\t\t` is ${branch.getTrackingStatus({\n\t\t\t\t\t\t\t\t\tempty: branch.upstream.missing\n\t\t\t\t\t\t\t\t\t\t? `missing upstream $(git-branch) ${branch.upstream.name}`\n\t\t\t\t\t\t\t\t\t\t: `up to date with $(git-branch)  ${branch.upstream.name}${\n\t\t\t\t\t\t\t\t\t\t\t\tremote?.provider?.name ? ` on ${remote.provider.name}` : ''\n\t\t\t\t\t\t\t\t\t\t  }`,\n\t\t\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t\t\t\ticons: true,\n\t\t\t\t\t\t\t\t\tseparator: ', ',\n\t\t\t\t\t\t\t\t\tsuffix: ` $(git-branch) ${branch.upstream.name}${\n\t\t\t\t\t\t\t\t\t\tremote?.provider?.name ? ` on ${remote.provider.name}` : ''\n\t\t\t\t\t\t\t\t\t}`,\n\t\t\t\t\t\t\t\t})}`,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst providerName = GitRemote.getHighlanderProviderName(\n\t\t\t\t\t\t\t\tawait this.view.container.git.getRemotesWithProviders(branch.repoPath),\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\ttooltip.appendMarkdown(` hasn't been published to ${providerName ?? 'a remote'}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'detached': {\n\t\t\t\ticon = new ThemeIcon('git-commit');\n\t\t\t\ttooltip.appendMarkdown(\n\t\t\t\t\t`${this.worktree.main ? '$(pass) ' : ''}Detached Worktree at $(git-commit) ${GitRevision.shorten(\n\t\t\t\t\t\tthis.worktree.sha,\n\t\t\t\t\t)}${indicators}\\\\\\n\\`${this.worktree.friendlyPath}\\``,\n\t\t\t\t);\n\n\t\t\t\tconst status = await this.worktree.getStatus();\n\t\t\t\tif (status != null) {\n\t\t\t\t\thasChanges = status.hasChanges;\n\t\t\t\t\ttooltip.appendMarkdown(\n\t\t\t\t\t\t`\\n\\n${status.getFormattedDiffStatus({\n\t\t\t\t\t\t\tprefix: 'Has Uncommitted Changes',\n\t\t\t\t\t\t\tempty: 'No Uncommitted Changes',\n\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t})}`,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconst item = new TreeItem(this.worktree.name, TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\t\titem.description = description;\n\t\titem.contextValue = `${ContextValues.Worktree}${this.worktree.main ? '+main' : ''}${\n\t\t\tthis.worktree.opened ? '+active' : ''\n\t\t}`;\n\t\titem.iconPath = this.worktree.opened ? new ThemeIcon('check') : icon;\n\t\titem.tooltip = tooltip;\n\t\titem.resourceUri = hasChanges ? Uri.parse('gitlens-view://worktree/changes') : undefined;\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset?: boolean) {\n\t\tthis._children = undefined;\n\t\tif (reset) {\n\t\t\tthis._log = undefined;\n\t\t}\n\t}\n\n\tprivate _log: GitLog | undefined;\n\tprivate async getLog() {\n\t\tif (this._log == null) {\n\t\t\tthis._log = await this.view.container.git.getLog(this.uri.repoPath!, {\n\t\t\t\tref: this.worktree.sha,\n\t\t\t\tlimit: this.limit ?? this.view.config.defaultItemLimit,\n\t\t\t});\n\t\t}\n\n\t\treturn this._log;\n\t}\n\n\tget hasMore() {\n\t\treturn this._log?.hasMore ?? true;\n\t}\n\n\tlimit: number | undefined = this.view.getNodeLastKnownLimit(this);\n\t@gate()\n\tasync loadMore(limit?: number | { until?: any }) {\n\t\tlet log = await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: { viewId: this.view.id },\n\t\t\t},\n\t\t\t() => this.getLog(),\n\t\t);\n\t\tif (log == null || !log.hasMore) return;\n\n\t\tlog = await log.more?.(limit ?? this.view.config.pageItemLimit);\n\t\tif (this._log === log) return;\n\n\t\tthis._log = log;\n\t\tthis.limit = log?.count;\n\n\t\tthis._children = undefined;\n\t\tvoid this.triggerChange(false);\n\t}\n}\n","import { ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GlyphChars } from '../../constants';\nimport { PremiumFeatures } from '../../features';\nimport { GitUri } from '../../git/gitUri';\nimport { Repository } from '../../git/models';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { RepositoriesView } from '../repositoriesView';\nimport { WorktreesView } from '../worktreesView';\nimport { MessageNode } from './common';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, ViewNode } from './viewNode';\nimport { WorktreeNode } from './worktreeNode';\n\nexport class WorktreesNode extends ViewNode<WorktreesView | RepositoriesView> {\n\tstatic key = ':worktrees';\n\tstatic getId(repoPath: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}`;\n\t}\n\n\tprivate _children: WorktreeNode[] | undefined;\n\n\tconstructor(\n\t\turi: GitUri,\n\t\tview: WorktreesView | RepositoriesView,\n\t\tparent: ViewNode,\n\t\tpublic readonly repo: Repository,\n\t) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride get id(): string {\n\t\treturn WorktreesNode.getId(this.repo.path);\n\t}\n\n\tget repoPath(): string {\n\t\treturn this.repo.path;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._children == null) {\n\t\t\tconst access = await this.repo.access(PremiumFeatures.Worktrees);\n\t\t\tif (!access.allowed) return [];\n\n\t\t\tconst worktrees = await this.repo.getWorktrees();\n\t\t\tif (worktrees.length === 0) return [new MessageNode(this.view, this, 'No worktrees could be found.')];\n\n\t\t\tthis._children = worktrees.map(c => new WorktreeNode(this.uri, this.view, this, c));\n\t\t}\n\n\t\treturn this._children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tconst access = await this.repo.access(PremiumFeatures.Worktrees);\n\n\t\tconst item = new TreeItem(\n\t\t\t'Worktrees',\n\t\t\taccess.allowed ? TreeItemCollapsibleState.Collapsed : TreeItemCollapsibleState.None,\n\t\t);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.Worktrees;\n\t\titem.description = access.allowed\n\t\t\t? undefined\n\t\t\t: ` ${GlyphChars.Warning}  Premium feature which requires an account`;\n\t\t// TODO@eamodio `folder` icon won't work here for some reason\n\t\titem.iconPath = new ThemeIcon('folder-opened');\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh() {\n\t\tthis._children = undefined;\n\t}\n}\n","import { Disposable, MarkdownString, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GlyphChars } from '../../constants';\nimport { Features } from '../../features';\nimport { GitUri } from '../../git/gitUri';\nimport {\n\tGitBranch,\n\tGitRemote,\n\tGitStatus,\n\tRepository,\n\tRepositoryChange,\n\tRepositoryChangeComparisonMode,\n\tRepositoryChangeEvent,\n\tRepositoryFileSystemChangeEvent,\n} from '../../git/models';\nimport { findLastIndex } from '../../system/array';\nimport { gate } from '../../system/decorators/gate';\nimport { debug, log } from '../../system/decorators/log';\nimport { disposableInterval } from '../../system/function';\nimport { pad } from '../../system/string';\nimport { RepositoriesView } from '../repositoriesView';\nimport { BranchesNode } from './branchesNode';\nimport { BranchNode } from './branchNode';\nimport { BranchTrackingStatusNode } from './branchTrackingStatusNode';\nimport { MessageNode } from './common';\nimport { CompareBranchNode } from './compareBranchNode';\nimport { ContributorsNode } from './contributorsNode';\nimport { MergeStatusNode } from './mergeStatusNode';\nimport { RebaseStatusNode } from './rebaseStatusNode';\nimport { ReflogNode } from './reflogNode';\nimport { RemotesNode } from './remotesNode';\nimport { StashesNode } from './stashesNode';\nimport { StatusFilesNode } from './statusFilesNode';\nimport { TagsNode } from './tagsNode';\nimport { ContextValues, SubscribeableViewNode, ViewNode } from './viewNode';\nimport { WorktreesNode } from './worktreesNode';\n\nexport class RepositoryNode extends SubscribeableViewNode<RepositoriesView> {\n\tstatic key = ':repository';\n\tstatic getId(repoPath: string): string {\n\t\treturn `gitlens${this.key}(${repoPath})`;\n\t}\n\n\tprivate _children: ViewNode[] | undefined;\n\tprivate _status: Promise<GitStatus | undefined>;\n\n\tconstructor(uri: GitUri, view: RepositoriesView, parent: ViewNode, public readonly repo: Repository) {\n\t\tsuper(uri, view, parent);\n\n\t\tthis._status = this.repo.getStatus();\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.repo.path;\n\t}\n\n\toverride get id(): string {\n\t\treturn RepositoryNode.getId(this.repo.path);\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._children === undefined) {\n\t\t\tconst children = [];\n\n\t\t\tconst status = await this._status;\n\t\t\tif (status != null) {\n\t\t\t\tconst branch = new GitBranch(\n\t\t\t\t\tstatus.repoPath,\n\t\t\t\t\tstatus.branch,\n\t\t\t\t\tfalse,\n\t\t\t\t\ttrue,\n\t\t\t\t\tundefined,\n\t\t\t\t\tstatus.sha,\n\t\t\t\t\tstatus.upstream ? { name: status.upstream, missing: false } : undefined,\n\t\t\t\t\tstatus.state.ahead,\n\t\t\t\t\tstatus.state.behind,\n\t\t\t\t\tstatus.detached,\n\t\t\t\t\tstatus.rebasing,\n\t\t\t\t);\n\n\t\t\t\tif (this.view.config.showBranchComparison !== false) {\n\t\t\t\t\tchildren.push(\n\t\t\t\t\t\tnew CompareBranchNode(\n\t\t\t\t\t\t\tthis.uri,\n\t\t\t\t\t\t\tthis.view,\n\t\t\t\t\t\t\tthis,\n\t\t\t\t\t\t\tbranch,\n\t\t\t\t\t\t\tthis.view.config.showBranchComparison,\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tconst [mergeStatus, rebaseStatus] = await Promise.all([\n\t\t\t\t\tthis.view.container.git.getMergeStatus(status.repoPath),\n\t\t\t\t\tthis.view.container.git.getRebaseStatus(status.repoPath),\n\t\t\t\t]);\n\n\t\t\t\tif (mergeStatus != null) {\n\t\t\t\t\tchildren.push(new MergeStatusNode(this.view, this, branch, mergeStatus, status, true));\n\t\t\t\t} else if (rebaseStatus != null) {\n\t\t\t\t\tchildren.push(new RebaseStatusNode(this.view, this, branch, rebaseStatus, status, true));\n\t\t\t\t} else if (this.view.config.showUpstreamStatus) {\n\t\t\t\t\tif (status.upstream) {\n\t\t\t\t\t\tif (!status.state.behind && !status.state.ahead) {\n\t\t\t\t\t\t\tchildren.push(new BranchTrackingStatusNode(this.view, this, branch, status, 'same', true));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (status.state.behind) {\n\t\t\t\t\t\t\t\tchildren.push(\n\t\t\t\t\t\t\t\t\tnew BranchTrackingStatusNode(this.view, this, branch, status, 'behind', true),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (status.state.ahead) {\n\t\t\t\t\t\t\t\tchildren.push(\n\t\t\t\t\t\t\t\t\tnew BranchTrackingStatusNode(this.view, this, branch, status, 'ahead', true, {\n\t\t\t\t\t\t\t\t\t\tshowAheadCommits: true,\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchildren.push(new BranchTrackingStatusNode(this.view, this, branch, status, 'none', true));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.view.config.includeWorkingTree && status.files.length !== 0) {\n\t\t\t\t\tconst range = undefined; //status.upstream ? GitRevision.createRange(status.upstream, branch.ref) : undefined;\n\t\t\t\t\tchildren.push(new StatusFilesNode(this.view, this, status, range));\n\t\t\t\t}\n\n\t\t\t\tif (children.length !== 0 && !this.view.config.compact) {\n\t\t\t\t\tchildren.push(new MessageNode(this.view, this, '', GlyphChars.Dash.repeat(2), ''));\n\t\t\t\t}\n\n\t\t\t\tif (this.view.config.showCommits) {\n\t\t\t\t\tchildren.push(\n\t\t\t\t\t\tnew BranchNode(this.uri, this.view, this, branch, true, {\n\t\t\t\t\t\t\tshowAsCommits: true,\n\t\t\t\t\t\t\tshowComparison: false,\n\t\t\t\t\t\t\tshowCurrent: false,\n\t\t\t\t\t\t\tshowStatus: false,\n\t\t\t\t\t\t\tshowTracking: false,\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.view.config.showBranches) {\n\t\t\t\tchildren.push(new BranchesNode(this.uri, this.view, this, this.repo));\n\t\t\t}\n\n\t\t\tif (this.view.config.showRemotes) {\n\t\t\t\tchildren.push(new RemotesNode(this.uri, this.view, this, this.repo));\n\t\t\t}\n\n\t\t\tif (this.view.config.showStashes && (await this.repo.supports(Features.Stashes))) {\n\t\t\t\tchildren.push(new StashesNode(this.uri, this.view, this, this.repo));\n\t\t\t}\n\n\t\t\tif (this.view.config.showTags) {\n\t\t\t\tchildren.push(new TagsNode(this.uri, this.view, this, this.repo));\n\t\t\t}\n\n\t\t\tif (this.view.config.showWorktrees && (await this.repo.supports(Features.Worktrees))) {\n\t\t\t\tchildren.push(new WorktreesNode(this.uri, this.view, this, this.repo));\n\t\t\t}\n\n\t\t\tif (this.view.config.showContributors) {\n\t\t\t\tchildren.push(new ContributorsNode(this.uri, this.view, this, this.repo));\n\t\t\t}\n\n\t\t\tif (this.view.config.showIncomingActivity) {\n\t\t\t\tchildren.push(new ReflogNode(this.uri, this.view, this, this.repo));\n\t\t\t}\n\n\t\t\tthis._children = children;\n\t\t}\n\t\treturn this._children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tconst label = this.repo.formattedName ?? this.uri.repoPath ?? '';\n\n\t\tconst lastFetched = (await this.repo?.getLastFetched()) ?? 0;\n\n\t\tlet description;\n\t\tlet tooltip = `${this.repo.formattedName ?? this.uri.repoPath ?? ''}${\n\t\t\tlastFetched\n\t\t\t\t? `${pad(GlyphChars.Dash, 2, 2)}Last fetched ${Repository.formatLastFetched(lastFetched, false)}`\n\t\t\t\t: ''\n\t\t}${this.repo.formattedName ? `\\n${this.uri.repoPath}` : ''}`;\n\t\tlet iconSuffix = '';\n\t\tlet workingStatus = '';\n\n\t\tlet contextValue: string = ContextValues.Repository;\n\t\tif (this.repo.starred) {\n\t\t\tcontextValue += '+starred';\n\t\t}\n\n\t\tconst status = await this._status;\n\t\tif (status != null) {\n\t\t\ttooltip += `\\n\\nCurrent branch $(git-branch) ${status.branch}${status.rebasing ? ' (Rebasing)' : ''}`;\n\n\t\t\tif (this.view.config.includeWorkingTree && status.files.length !== 0) {\n\t\t\t\tworkingStatus = status.getFormattedDiffStatus({\n\t\t\t\t\tcompact: true,\n\t\t\t\t\tprefix: pad(GlyphChars.Dot, 1, 1),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst upstreamStatus = status.getUpstreamStatus({\n\t\t\t\tsuffix: pad(GlyphChars.Dot, 1, 1),\n\t\t\t});\n\n\t\t\tdescription = `${upstreamStatus}${status.branch}${status.rebasing ? ' (Rebasing)' : ''}${workingStatus}`;\n\n\t\t\tlet providerName;\n\t\t\tif (status.upstream != null) {\n\t\t\t\tconst providers = GitRemote.getHighlanderProviders(\n\t\t\t\t\tawait this.view.container.git.getRemotesWithProviders(status.repoPath),\n\t\t\t\t);\n\t\t\t\tproviderName = providers?.length ? providers[0].name : undefined;\n\t\t\t} else {\n\t\t\t\tconst remote = await status.getRemote();\n\t\t\t\tproviderName = remote?.provider?.name;\n\t\t\t}\n\n\t\t\ticonSuffix = workingStatus ? '-blue' : '';\n\t\t\tif (status.upstream != null) {\n\t\t\t\ttooltip += ` is ${status.getUpstreamStatus({\n\t\t\t\t\tempty: `up to date with $(git-branch) ${status.upstream}${\n\t\t\t\t\t\tproviderName ? ` on ${providerName}` : ''\n\t\t\t\t\t}`,\n\t\t\t\t\texpand: true,\n\t\t\t\t\ticons: true,\n\t\t\t\t\tseparator: ', ',\n\t\t\t\t\tsuffix: ` $(git-branch) ${status.upstream}${providerName ? ` on ${providerName}` : ''}`,\n\t\t\t\t})}`;\n\n\t\t\t\tif (status.state.behind) {\n\t\t\t\t\tcontextValue += '+behind';\n\t\t\t\t\ticonSuffix = '-red';\n\t\t\t\t}\n\t\t\t\tif (status.state.ahead) {\n\t\t\t\t\ticonSuffix = status.state.behind ? '-yellow' : '-green';\n\t\t\t\t\tcontextValue += '+ahead';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (workingStatus) {\n\t\t\t\ttooltip += `\\n\\nWorking tree has uncommitted changes${status.getFormattedDiffStatus({\n\t\t\t\t\texpand: true,\n\t\t\t\t\tprefix: '\\n',\n\t\t\t\t\tseparator: '\\n',\n\t\t\t\t})}`;\n\t\t\t}\n\t\t}\n\n\t\tconst item = new TreeItem(label, TreeItemCollapsibleState.Expanded);\n\t\titem.id = this.id;\n\t\titem.contextValue = contextValue;\n\t\titem.description = `${description ?? ''}${\n\t\t\tlastFetched ? `${pad(GlyphChars.Dot, 1, 1)}Last fetched ${Repository.formatLastFetched(lastFetched)}` : ''\n\t\t}`;\n\t\titem.iconPath = {\n\t\t\tdark: this.view.container.context.asAbsolutePath(`images/dark/icon-repo${iconSuffix}.svg`),\n\t\t\tlight: this.view.container.context.asAbsolutePath(`images/light/icon-repo${iconSuffix}.svg`),\n\t\t};\n\n\t\tconst markdown = new MarkdownString(tooltip, true);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\n\t\titem.tooltip = markdown;\n\n\t\treturn item;\n\t}\n\n\t@log()\n\tfetch(options: { all?: boolean; progress?: boolean; prune?: boolean; remote?: string } = {}) {\n\t\treturn this.repo.fetch(options);\n\t}\n\n\t@log()\n\tpull(options: { progress?: boolean; rebase?: boolean } = {}) {\n\t\treturn this.repo.pull(options);\n\t}\n\n\t@log()\n\tpush(options: { force?: boolean; progress?: boolean } = {}) {\n\t\treturn this.repo.push(options);\n\t}\n\n\t@gate()\n\t@debug()\n\toverride async refresh(reset: boolean = false) {\n\t\tif (reset) {\n\t\t\tthis._status = this.repo.getStatus();\n\n\t\t\tthis._children = undefined;\n\t\t}\n\n\t\tawait this.ensureSubscription();\n\t}\n\n\t@log()\n\tasync star() {\n\t\tawait this.repo.star();\n\t\tvoid this.parent!.triggerChange();\n\t}\n\n\t@log()\n\tasync unstar() {\n\t\tawait this.repo.unstar();\n\t\tvoid this.parent!.triggerChange();\n\t}\n\n\t@debug()\n\tprotected async subscribe() {\n\t\tconst lastFetched = (await this.repo?.getLastFetched()) ?? 0;\n\n\t\tconst disposables = [this.repo.onDidChange(this.onRepositoryChanged, this)];\n\n\t\tconst interval = Repository.getLastFetchedUpdateInterval(lastFetched);\n\t\tif (lastFetched !== 0 && interval > 0) {\n\t\t\tdisposables.push(\n\t\t\t\tdisposableInterval(() => {\n\t\t\t\t\t// Check if the interval should change, and if so, reset it\n\t\t\t\t\tif (interval !== Repository.getLastFetchedUpdateInterval(lastFetched)) {\n\t\t\t\t\t\tvoid this.resetSubscription();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.splatted) {\n\t\t\t\t\t\tvoid this.view.triggerNodeChange(this.parent ?? this);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvoid this.view.triggerNodeChange(this);\n\t\t\t\t\t}\n\t\t\t\t}, interval),\n\t\t\t);\n\t\t}\n\n\t\tif (this.view.config.includeWorkingTree) {\n\t\t\tdisposables.push(\n\t\t\t\tthis.repo.onDidChangeFileSystem(this.onFileSystemChanged, this),\n\t\t\t\tthis.repo.startWatchingFileSystem(),\n\t\t\t);\n\t\t}\n\n\t\treturn Disposable.from(...disposables);\n\t}\n\n\tprotected override etag(): number {\n\t\treturn this.repo.etag;\n\t}\n\n\t@debug<RepositoryNode['onFileSystemChanged']>({\n\t\targs: {\n\t\t\t0: e =>\n\t\t\t\t`{ repository: ${e.repository?.name ?? ''}, uris(${e.uris.length}): [${e.uris\n\t\t\t\t\t.slice(0, 1)\n\t\t\t\t\t.map(u => u.fsPath)\n\t\t\t\t\t.join(', ')}${e.uris.length > 1 ? ', ...' : ''}] }`,\n\t\t},\n\t})\n\tprivate async onFileSystemChanged(_e: RepositoryFileSystemChangeEvent) {\n\t\tthis._status = this.repo.getStatus();\n\n\t\tif (this._children !== undefined) {\n\t\t\tconst status = await this._status;\n\n\t\t\tlet index = this._children.findIndex(c => c instanceof StatusFilesNode);\n\t\t\tif (status !== undefined && (status.state.ahead || status.files.length !== 0)) {\n\t\t\t\tlet deleteCount = 1;\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tindex = findLastIndex(\n\t\t\t\t\t\tthis._children,\n\t\t\t\t\t\tc => c instanceof BranchTrackingStatusNode || c instanceof BranchNode,\n\t\t\t\t\t);\n\t\t\t\t\tdeleteCount = 0;\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\n\t\t\t\tconst range = undefined; //status.upstream ? GitRevision.createRange(status.upstream, status.sha) : undefined;\n\t\t\t\tthis._children.splice(index, deleteCount, new StatusFilesNode(this.view, this, status, range));\n\t\t\t} else if (index !== -1) {\n\t\t\t\tthis._children.splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\tvoid this.triggerChange(false);\n\t}\n\n\t@debug<RepositoryNode['onRepositoryChanged']>({ args: { 0: e => e.toString() } })\n\tprivate onRepositoryChanged(e: RepositoryChangeEvent) {\n\t\tif (e.changed(RepositoryChange.Closed, RepositoryChangeComparisonMode.Any)) {\n\t\t\tthis.dispose();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tthis._children == null ||\n\t\t\te.changed(\n\t\t\t\tRepositoryChange.Config,\n\t\t\t\tRepositoryChange.Index,\n\t\t\t\tRepositoryChange.Heads,\n\t\t\t\tRepositoryChange.Status,\n\t\t\t\tRepositoryChange.Unknown,\n\t\t\t\tRepositoryChangeComparisonMode.Any,\n\t\t\t)\n\t\t) {\n\t\t\tvoid this.triggerChange(true);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.changed(RepositoryChange.Remotes, RepositoryChange.RemoteProviders, RepositoryChangeComparisonMode.Any)) {\n\t\t\tconst node = this._children.find(c => c instanceof RemotesNode);\n\t\t\tif (node != null) {\n\t\t\t\tvoid this.view.triggerNodeChange(node);\n\t\t\t}\n\t\t}\n\n\t\tif (e.changed(RepositoryChange.Stash, RepositoryChangeComparisonMode.Any)) {\n\t\t\tconst node = this._children.find(c => c instanceof StashesNode);\n\t\t\tif (node != null) {\n\t\t\t\tvoid this.view.triggerNodeChange(node);\n\t\t\t}\n\t\t}\n\n\t\tif (e.changed(RepositoryChange.Tags, RepositoryChangeComparisonMode.Any)) {\n\t\t\tconst node = this._children.find(c => c instanceof TagsNode);\n\t\t\tif (node != null) {\n\t\t\t\tvoid this.view.triggerNodeChange(node);\n\t\t\t}\n\t\t}\n\t}\n}\n","import { MarkdownString, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GitUri } from '../../git/gitUri';\nimport { GitBranch, GitCommit, PullRequest, PullRequestState } from '../../git/models';\nimport { ViewsWithCommits } from '../viewBase';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class PullRequestNode extends ViewNode<ViewsWithCommits> {\n\tstatic key = ':pullrequest';\n\tstatic getId(repoPath: string, id: string, refOrParent: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${id}):${refOrParent}`;\n\t}\n\n\tpublic readonly pullRequest: PullRequest;\n\tprivate readonly branchOrCommit?: GitBranch | GitCommit;\n\tprivate readonly repoPath: string;\n\n\tconstructor(\n\t\tview: ViewsWithCommits,\n\t\tparent: ViewNode,\n\t\tpullRequest: PullRequest,\n\t\tbranchOrCommitOrRepoPath: GitBranch | GitCommit | string,\n\t) {\n\t\tlet branchOrCommit;\n\t\tlet repoPath;\n\t\tif (typeof branchOrCommitOrRepoPath === 'string') {\n\t\t\trepoPath = branchOrCommitOrRepoPath;\n\t\t} else {\n\t\t\trepoPath = branchOrCommitOrRepoPath.repoPath;\n\t\t\tbranchOrCommit = branchOrCommitOrRepoPath;\n\t\t}\n\n\t\tsuper(GitUri.fromRepoPath(repoPath), view, parent);\n\n\t\tthis.branchOrCommit = branchOrCommit;\n\t\tthis.pullRequest = pullRequest;\n\t\tthis.repoPath = repoPath;\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.pullRequest.url;\n\t}\n\n\toverride get id(): string {\n\t\treturn PullRequestNode.getId(this.repoPath, this.pullRequest.id, this.branchOrCommit?.ref ?? this.parent!.id!);\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\treturn [];\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem(`#${this.pullRequest.id}: ${this.pullRequest.title}`, TreeItemCollapsibleState.None);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.PullRequest;\n\t\titem.description = `${this.pullRequest.state}, ${this.pullRequest.formatDateFromNow()}`;\n\t\titem.iconPath = PullRequest.getThemeIcon(this.pullRequest);\n\n\t\tconst tooltip = new MarkdownString('', true);\n\t\ttooltip.supportHtml = true;\n\t\ttooltip.isTrusted = true;\n\n\t\tif (GitCommit.is(this.branchOrCommit)) {\n\t\t\ttooltip.appendMarkdown(\n\t\t\t\t`Commit \\`$(git-commit) ${this.branchOrCommit.shortSha}\\` was introduced by $(git-pull-request) PR #${this.pullRequest.id}\\n\\n`,\n\t\t\t);\n\t\t}\n\n\t\tconst linkTitle = ` \"Open Pull Request \\\\#${this.pullRequest.id} on ${this.pullRequest.provider.name}\"`;\n\t\ttooltip.appendMarkdown(\n\t\t\t`${PullRequest.getMarkdownIcon(this.pullRequest)} [**${this.pullRequest.title.trim()}**](${\n\t\t\t\tthis.pullRequest.url\n\t\t\t}${linkTitle}) \\\\\\n[#${this.pullRequest.id}](${this.pullRequest.url}${linkTitle}) by [@${\n\t\t\t\tthis.pullRequest.author.name\n\t\t\t}](${this.pullRequest.author.url} \"Open @${this.pullRequest.author.name} on ${\n\t\t\t\tthis.pullRequest.provider.name\n\t\t\t}\") was ${\n\t\t\t\tthis.pullRequest.state === PullRequestState.Open ? 'opened' : this.pullRequest.state.toLowerCase()\n\t\t\t} ${this.pullRequest.formatDateFromNow()}`,\n\t\t);\n\n\t\titem.tooltip = tooltip;\n\n\t\treturn item;\n\t}\n}\n","import { Command, MarkdownString, ThemeColor, ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport type { DiffWithPreviousCommandArgs } from '../../commands';\nimport { ViewFilesLayout } from '../../configuration';\nimport { Colors, Commands } from '../../constants';\nimport { CommitFormatter } from '../../git/formatters';\nimport { GitBranch, GitCommit, GitRevisionReference } from '../../git/models';\nimport { makeHierarchical } from '../../system/array';\nimport { joinPaths, normalizePath } from '../../system/path';\nimport { sortCompare } from '../../system/string';\nimport { FileHistoryView } from '../fileHistoryView';\nimport { TagsView } from '../tagsView';\nimport { ViewsWithCommits } from '../viewBase';\nimport { CommitFileNode } from './commitFileNode';\nimport { FileNode, FolderNode } from './folderNode';\nimport { PullRequestNode } from './pullRequestNode';\nimport { ContextValues, ViewNode, ViewRefNode } from './viewNode';\n\nexport class CommitNode extends ViewRefNode<ViewsWithCommits | FileHistoryView, GitRevisionReference> {\n\tconstructor(\n\t\tview: ViewsWithCommits | FileHistoryView,\n\t\tparent: ViewNode,\n\t\tpublic readonly commit: GitCommit,\n\t\tprivate readonly unpublished?: boolean,\n\t\tpublic readonly branch?: GitBranch,\n\t\tprivate readonly getBranchAndTagTips?: (sha: string, options?: { compact?: boolean }) => string | undefined,\n\t\tprivate readonly _options: { expand?: boolean } = {},\n\t) {\n\t\tsuper(commit.getGitUri(), view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn `${this.commit.shortSha}: ${this.commit.summary}`;\n\t}\n\n\tget isTip(): boolean {\n\t\treturn (this.branch?.current && this.branch.sha === this.commit.ref) ?? false;\n\t}\n\n\tget ref(): GitRevisionReference {\n\t\treturn this.commit;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tconst commit = this.commit;\n\n\t\tconst commits = await commit.getCommitsForFiles();\n\t\tlet children: (PullRequestNode | FileNode)[] = commits.map(\n\t\t\tc => new CommitFileNode(this.view, this, c.file!, c),\n\t\t);\n\n\t\tif (this.view.config.files.layout !== ViewFilesLayout.List) {\n\t\t\tconst hierarchy = makeHierarchical(\n\t\t\t\tchildren as FileNode[],\n\t\t\t\tn => n.uri.relativePath.split('/'),\n\t\t\t\t(...parts: string[]) => normalizePath(joinPaths(...parts)),\n\t\t\t\tthis.view.config.files.compact,\n\t\t\t);\n\n\t\t\tconst root = new FolderNode(this.view, this, this.repoPath, '', hierarchy);\n\t\t\tchildren = root.getChildren() as FileNode[];\n\t\t} else {\n\t\t\t(children as FileNode[]).sort((a, b) => sortCompare(a.label!, b.label!));\n\t\t}\n\n\t\tif (!(this.view instanceof TagsView) && !(this.view instanceof FileHistoryView)) {\n\t\t\tif (this.view.config.pullRequests.enabled && this.view.config.pullRequests.showForCommits) {\n\t\t\t\tconst pr = await commit.getAssociatedPullRequest();\n\t\t\t\tif (pr != null) {\n\t\t\t\t\tchildren.splice(0, 0, new PullRequestNode(this.view, this, pr, commit));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tconst label = CommitFormatter.fromTemplate(this.view.config.formats.commits.label, this.commit, {\n\t\t\tdateFormat: this.view.container.config.defaultDateFormat,\n\t\t\tgetBranchAndTagTips: (sha: string) => this.getBranchAndTagTips?.(sha, { compact: true }),\n\t\t\tmessageTruncateAtNewLine: true,\n\t\t});\n\n\t\tconst item = new TreeItem(\n\t\t\tlabel,\n\t\t\tthis._options.expand ? TreeItemCollapsibleState.Expanded : TreeItemCollapsibleState.Collapsed,\n\t\t);\n\n\t\titem.contextValue = `${ContextValues.Commit}${this.branch?.current ? '+current' : ''}${\n\t\t\tthis.isTip ? '+HEAD' : ''\n\t\t}${this.unpublished ? '+unpublished' : ''}`;\n\n\t\titem.description = CommitFormatter.fromTemplate(this.view.config.formats.commits.description, this.commit, {\n\t\t\tdateFormat: this.view.container.config.defaultDateFormat,\n\t\t\tgetBranchAndTagTips: (sha: string) => this.getBranchAndTagTips?.(sha, { compact: true }),\n\t\t\tmessageTruncateAtNewLine: true,\n\t\t});\n\t\titem.iconPath = this.unpublished\n\t\t\t? new ThemeIcon('arrow-up', new ThemeColor(Colors.UnpublishedCommitIconColor))\n\t\t\t: this.view.config.avatars\n\t\t\t? await this.commit.getAvatarUri({ defaultStyle: this.view.container.config.defaultGravatarsStyle })\n\t\t\t: new ThemeIcon('git-commit');\n\t\t// item.tooltip = this.tooltip;\n\n\t\treturn item;\n\t}\n\n\toverride getCommand(): Command | undefined {\n\t\tconst commandArgs: DiffWithPreviousCommandArgs = {\n\t\t\tcommit: this.commit,\n\t\t\turi: this.uri,\n\t\t\tline: 0,\n\t\t\tshowOptions: {\n\t\t\t\tpreserveFocus: true,\n\t\t\t\tpreview: true,\n\t\t\t},\n\t\t};\n\t\treturn {\n\t\t\ttitle: 'Open Changes with Previous Revision',\n\t\t\tcommand: Commands.DiffWithPrevious,\n\t\t\targuments: [undefined, commandArgs],\n\t\t};\n\t}\n\n\toverride async resolveTreeItem(item: TreeItem): Promise<TreeItem> {\n\t\tif (item.tooltip == null) {\n\t\t\titem.tooltip = await this.getTooltip();\n\t\t}\n\t\treturn item;\n\t}\n\n\tprivate async getTooltip() {\n\t\tconst remotes = await this.view.container.git.getRemotesWithProviders(this.commit.repoPath);\n\t\tconst remote = await this.view.container.git.getRichRemoteProvider(remotes);\n\n\t\tif (this.commit.message == null) {\n\t\t\tawait this.commit.ensureFullDetails();\n\t\t}\n\n\t\tlet autolinkedIssuesOrPullRequests;\n\t\tlet pr;\n\n\t\tif (remote?.provider != null) {\n\t\t\t[autolinkedIssuesOrPullRequests, pr] = await Promise.all([\n\t\t\t\tthis.view.container.autolinks.getIssueOrPullRequestLinks(\n\t\t\t\t\tthis.commit.message ?? this.commit.summary,\n\t\t\t\t\tremote,\n\t\t\t\t),\n\t\t\t\tthis.view.container.git.getPullRequestForCommit(this.commit.ref, remote.provider),\n\t\t\t]);\n\t\t}\n\n\t\tconst tooltip = await CommitFormatter.fromTemplateAsync(\n\t\t\t`\\${link}\\${' via 'pullRequest}\\${'&nbsp;&nbsp;\\u2022&nbsp;&nbsp;'changesDetail}\\${'&nbsp;&nbsp;&nbsp;&nbsp;'tips}\\n\\n\\${avatar} &nbsp;__\\${author}__, \\${ago} &nbsp; _(\\${date})_ \\n\\n\\${message}\\${\\n\\n---\\n\\nfootnotes}`,\n\t\t\tthis.commit,\n\t\t\t{\n\t\t\t\tautolinkedIssuesOrPullRequests: autolinkedIssuesOrPullRequests,\n\t\t\t\tdateFormat: this.view.container.config.defaultDateFormat,\n\t\t\t\tgetBranchAndTagTips: this.getBranchAndTagTips,\n\t\t\t\tmarkdown: true,\n\t\t\t\tmessageAutolinks: true,\n\t\t\t\tmessageIndent: 4,\n\t\t\t\tpullRequestOrRemote: pr,\n\t\t\t\tremotes: remotes,\n\t\t\t\tunpublished: this.unpublished,\n\t\t\t},\n\t\t);\n\n\t\tconst markdown = new MarkdownString(tooltip, true);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\n\t\treturn markdown;\n\t}\n}\n","import { MarkdownString, ThemeColor, ThemeIcon, TreeItem, TreeItemCollapsibleState, window } from 'vscode';\nimport { Colors } from '../../constants';\nimport { GitUri } from '../../git/gitUri';\nimport { GitBranch, GitLog, GitRemote, GitRevision, GitTrackingState } from '../../git/models';\nimport { fromNow } from '../../system/date';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { first, map } from '../../system/iterable';\nimport { pluralize } from '../../system/string';\nimport { ViewsWithCommits } from '../viewBase';\nimport { BranchNode } from './branchNode';\nimport { BranchTrackingStatusFilesNode } from './branchTrackingStatusFilesNode';\nimport { CommitNode } from './commitNode';\nimport { LoadMoreNode } from './common';\nimport { insertDateMarkers } from './helpers';\nimport { ContextValues, PageableViewNode, ViewNode } from './viewNode';\n\nexport interface BranchTrackingStatus {\n\tref: string;\n\trepoPath: string;\n\tstate: GitTrackingState;\n\tupstream?: string;\n}\n\nexport class BranchTrackingStatusNode extends ViewNode<ViewsWithCommits> implements PageableViewNode {\n\tstatic key = ':status-branch:upstream';\n\tstatic getId(\n\t\trepoPath: string,\n\t\tname: string,\n\t\troot: boolean,\n\t\tupstream: string | undefined,\n\t\tupstreamType: string,\n\t): string {\n\t\treturn `${BranchNode.getId(repoPath, name, root)}${this.key}(${upstream ?? ''}):${upstreamType}`;\n\t}\n\n\tprivate readonly options: {\n\t\tshowAheadCommits?: boolean;\n\t};\n\n\tconstructor(\n\t\tview: ViewsWithCommits,\n\t\tparent: ViewNode,\n\t\tpublic readonly branch: GitBranch,\n\t\tpublic readonly status: BranchTrackingStatus,\n\t\tpublic readonly upstreamType: 'ahead' | 'behind' | 'same' | 'none',\n\t\t// Specifies that the node is shown as a root\n\t\tpublic readonly root: boolean = false,\n\t\toptions?: {\n\t\t\tshowAheadCommits?: boolean;\n\t\t},\n\t) {\n\t\tsuper(GitUri.fromRepoPath(status.repoPath), view, parent);\n\n\t\tthis.options = { showAheadCommits: false, ...options };\n\t}\n\n\toverride get id(): string {\n\t\treturn BranchTrackingStatusNode.getId(\n\t\t\tthis.status.repoPath,\n\t\t\tthis.status.ref,\n\t\t\tthis.root,\n\t\t\tthis.status.upstream,\n\t\t\tthis.upstreamType,\n\t\t);\n\t}\n\n\tget repoPath(): string {\n\t\treturn this.uri.repoPath!;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.upstreamType === 'same' || this.upstreamType === 'none') return [];\n\n\t\tconst log = await this.getLog();\n\t\tif (log == null) return [];\n\n\t\tlet commits;\n\t\tif (this.upstreamType === 'ahead') {\n\t\t\t// Since the last commit when we are looking 'ahead' can have no previous (because of the range given) -- look it up\n\t\t\tcommits = [...log.commits.values()];\n\t\t\tconst commit = commits[commits.length - 1];\n\t\t\tconst previousSha = await commit.getPreviousSha();\n\t\t\tif (previousSha == null) {\n\t\t\t\tconst previousLog = await this.view.container.git.getLog(this.uri.repoPath!, {\n\t\t\t\t\tlimit: 2,\n\t\t\t\t\tref: commit.sha,\n\t\t\t\t});\n\t\t\t\tif (previousLog != null) {\n\t\t\t\t\tcommits[commits.length - 1] = first(previousLog.commits.values());\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tcommits = log.commits.values();\n\t\t}\n\n\t\tconst children = [];\n\n\t\tlet showFiles = true;\n\t\tif (\n\t\t\t!this.options.showAheadCommits &&\n\t\t\tthis.upstreamType === 'ahead' &&\n\t\t\tthis.status.upstream &&\n\t\t\tthis.status.state.ahead > 0\n\t\t) {\n\t\t\tshowFiles = false;\n\t\t\t// TODO@eamodio fix this\n\t\t\tchildren.push(\n\t\t\t\t...(await new BranchTrackingStatusFilesNode(\n\t\t\t\t\tthis.view,\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.branch,\n\t\t\t\t\tthis.status as Required<BranchTrackingStatus>,\n\t\t\t\t\tthis.upstreamType,\n\t\t\t\t\tthis.root,\n\t\t\t\t).getChildren()),\n\t\t\t);\n\t\t} else {\n\t\t\tchildren.push(\n\t\t\t\t...insertDateMarkers(\n\t\t\t\t\tmap(commits, c => new CommitNode(this.view, this, c, this.upstreamType === 'ahead', this.branch)),\n\t\t\t\t\tthis,\n\t\t\t\t\t1,\n\t\t\t\t),\n\t\t\t);\n\n\t\t\tif (log.hasMore) {\n\t\t\t\tchildren.push(new LoadMoreNode(this.view, this, children[children.length - 1]));\n\t\t\t}\n\t\t}\n\n\t\tif (showFiles) {\n\t\t\tchildren.splice(\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tnew BranchTrackingStatusFilesNode(\n\t\t\t\t\tthis.view,\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.branch,\n\t\t\t\t\tthis.status as Required<BranchTrackingStatus>,\n\t\t\t\t\tthis.upstreamType,\n\t\t\t\t\tthis.root,\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tlet lastFetched = 0;\n\n\t\tif (this.upstreamType !== 'none') {\n\t\t\tconst repo = this.view.container.git.getRepository(this.repoPath);\n\t\t\tlastFetched = (await repo?.getLastFetched()) ?? 0;\n\t\t}\n\n\t\tlet label;\n\t\tlet description;\n\t\tlet collapsibleState;\n\t\tlet contextValue;\n\t\tlet icon;\n\t\tlet tooltip;\n\t\tswitch (this.upstreamType) {\n\t\t\tcase 'ahead': {\n\t\t\t\tconst remote = await this.branch.getRemote();\n\n\t\t\t\tlabel = `Changes to push to ${remote?.name ?? GitBranch.getRemote(this.status.upstream!)}${\n\t\t\t\t\tremote?.provider?.name ? ` on ${remote?.provider.name}` : ''\n\t\t\t\t}`;\n\t\t\t\tdescription = pluralize('commit', this.status.state.ahead);\n\t\t\t\ttooltip = `Branch $(git-branch) ${this.branch.name} is ${pluralize('commit', this.status.state.ahead, {\n\t\t\t\t\tinfix: '$(arrow-up) ',\n\t\t\t\t})} ahead of $(git-branch) ${this.status.upstream}${\n\t\t\t\t\tremote?.provider?.name ? ` on ${remote.provider.name}` : ''\n\t\t\t\t}`;\n\n\t\t\t\tcollapsibleState = TreeItemCollapsibleState.Collapsed;\n\t\t\t\tcontextValue = this.root\n\t\t\t\t\t? ContextValues.StatusAheadOfUpstream\n\t\t\t\t\t: ContextValues.BranchStatusAheadOfUpstream;\n\t\t\t\ticon = new ThemeIcon('cloud-upload', new ThemeColor(Colors.UnpublishedChangesIconColor));\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'behind': {\n\t\t\t\tconst remote = await this.branch.getRemote();\n\n\t\t\t\tlabel = `Changes to pull from ${remote?.name ?? GitBranch.getRemote(this.status.upstream!)}${\n\t\t\t\t\tremote?.provider?.name ? ` on ${remote.provider.name}` : ''\n\t\t\t\t}`;\n\t\t\t\tdescription = pluralize('commit', this.status.state.behind);\n\t\t\t\ttooltip = `Branch $(git-branch) ${this.branch.name} is ${pluralize('commit', this.status.state.behind, {\n\t\t\t\t\tinfix: '$(arrow-down) ',\n\t\t\t\t})} behind $(git-branch) ${this.status.upstream}${\n\t\t\t\t\tremote?.provider?.name ? ` on ${remote.provider.name}` : ''\n\t\t\t\t}`;\n\n\t\t\t\tcollapsibleState = TreeItemCollapsibleState.Collapsed;\n\t\t\t\tcontextValue = this.root\n\t\t\t\t\t? ContextValues.StatusBehindUpstream\n\t\t\t\t\t: ContextValues.BranchStatusBehindUpstream;\n\t\t\t\ticon = new ThemeIcon('cloud-download', new ThemeColor(Colors.UnpulledChangesIconColor));\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'same': {\n\t\t\t\tconst remote = await this.branch.getRemote();\n\n\t\t\t\tlabel = `Up to date with ${remote?.name ?? GitBranch.getRemote(this.status.upstream!)}${\n\t\t\t\t\tremote?.provider?.name ? ` on ${remote.provider.name}` : ''\n\t\t\t\t}`;\n\t\t\t\tdescription = lastFetched ? `Last fetched ${fromNow(new Date(lastFetched))}` : '';\n\t\t\t\ttooltip = `Branch $(git-branch) ${this.branch.name} is up to date with $(git-branch) ${\n\t\t\t\t\tthis.status.upstream\n\t\t\t\t}${remote?.provider?.name ? ` on ${remote.provider.name}` : ''}`;\n\n\t\t\t\tcollapsibleState = TreeItemCollapsibleState.None;\n\t\t\t\tcontextValue = this.root\n\t\t\t\t\t? ContextValues.StatusSameAsUpstream\n\t\t\t\t\t: ContextValues.BranchStatusSameAsUpstream;\n\t\t\t\ticon = new ThemeIcon('cloud');\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'none': {\n\t\t\t\tconst remotes = await this.view.container.git.getRemotesWithProviders(this.branch.repoPath);\n\t\t\t\tconst providers = GitRemote.getHighlanderProviders(remotes);\n\t\t\t\tconst providerName = providers?.length ? providers[0].name : undefined;\n\n\t\t\t\tlabel = `Publish ${this.branch.name} to ${providerName ?? 'a remote'}`;\n\t\t\t\ttooltip = `Branch $(git-branch) ${this.branch.name} hasn't been published to ${\n\t\t\t\t\tproviderName ?? 'a remote'\n\t\t\t\t}`;\n\n\t\t\t\tcollapsibleState = TreeItemCollapsibleState.None;\n\t\t\t\tcontextValue = this.root ? ContextValues.StatusNoUpstream : ContextValues.BranchStatusNoUpstream;\n\t\t\t\ticon = new ThemeIcon(\n\t\t\t\t\t'cloud-upload',\n\t\t\t\t\tremotes.length ? new ThemeColor(Colors.UnpublishedChangesIconColor) : undefined,\n\t\t\t\t);\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconst item = new TreeItem(label, collapsibleState);\n\t\titem.id = this.id;\n\t\titem.contextValue = contextValue;\n\t\titem.description = description;\n\t\tif (lastFetched) {\n\t\t\ttooltip += `\\n\\nLast fetched ${fromNow(new Date(lastFetched))}`;\n\t\t}\n\t\titem.iconPath = icon;\n\n\t\tconst markdown = new MarkdownString(tooltip, true);\n\t\tmarkdown.supportHtml = true;\n\t\tmarkdown.isTrusted = true;\n\n\t\titem.tooltip = markdown;\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset?: boolean) {\n\t\tif (reset) {\n\t\t\tthis._log = undefined;\n\t\t}\n\t}\n\n\tprivate _log: GitLog | undefined;\n\tprivate async getLog() {\n\t\tif (this.upstreamType === 'same' || this.upstreamType === 'none') return undefined;\n\n\t\tif (this._log == null) {\n\t\t\tconst range =\n\t\t\t\tthis.upstreamType === 'ahead'\n\t\t\t\t\t? GitRevision.createRange(this.status.upstream, this.status.ref)\n\t\t\t\t\t: GitRevision.createRange(this.status.ref, this.status.upstream);\n\n\t\t\tthis._log = await this.view.container.git.getLog(this.uri.repoPath!, {\n\t\t\t\tlimit: this.limit ?? this.view.config.defaultItemLimit,\n\t\t\t\tref: range,\n\t\t\t});\n\t\t}\n\n\t\treturn this._log;\n\t}\n\n\tget hasMore() {\n\t\treturn this._log?.hasMore ?? true;\n\t}\n\n\tlimit: number | undefined = this.view.getNodeLastKnownLimit(this);\n\t@gate()\n\tasync loadMore(limit?: number | { until?: any }) {\n\t\tlet log = await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: { viewId: this.view.id },\n\t\t\t},\n\t\t\t() => this.getLog(),\n\t\t);\n\t\tif (log == null || !log.hasMore) return;\n\n\t\tlog = await log.more?.(limit ?? this.view.config.pageItemLimit);\n\t\tif (this._log === log) return;\n\n\t\tthis._log = log;\n\t\tthis.limit = log?.count;\n\n\t\tvoid this.triggerChange(false);\n\t}\n}\n","import { MarkdownString, ThemeColor, ThemeIcon, TreeItem, TreeItemCollapsibleState, Uri, window } from 'vscode';\nimport { ViewBranchesLayout, ViewShowBranchComparison } from '../../configuration';\nimport { Colors, GlyphChars } from '../../constants';\nimport { Container } from '../../container';\nimport { GitUri } from '../../git/gitUri';\nimport {\n\tGitBranch,\n\tGitBranchReference,\n\tGitLog,\n\tGitRemote,\n\tGitRemoteType,\n\tGitUser,\n\tPullRequestState,\n} from '../../git/models';\nimport { gate } from '../../system/decorators/gate';\nimport { debug, log } from '../../system/decorators/log';\nimport { map } from '../../system/iterable';\nimport { pad } from '../../system/string';\nimport { BranchesView } from '../branchesView';\nimport { CommitsView } from '../commitsView';\nimport { RemotesView } from '../remotesView';\nimport { RepositoriesView } from '../repositoriesView';\nimport { BranchTrackingStatusNode } from './branchTrackingStatusNode';\nimport { CommitNode } from './commitNode';\nimport { LoadMoreNode, MessageNode } from './common';\nimport { CompareBranchNode } from './compareBranchNode';\nimport { insertDateMarkers } from './helpers';\nimport { MergeStatusNode } from './mergeStatusNode';\nimport { PullRequestNode } from './pullRequestNode';\nimport { RebaseStatusNode } from './rebaseStatusNode';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, PageableViewNode, ViewNode, ViewRefNode } from './viewNode';\n\nexport class BranchNode\n\textends ViewRefNode<BranchesView | CommitsView | RemotesView | RepositoriesView, GitBranchReference>\n\timplements PageableViewNode\n{\n\tstatic key = ':branch';\n\tstatic getId(repoPath: string, name: string, root: boolean): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${name})${root ? ':root' : ''}`;\n\t}\n\n\tprivate _children: ViewNode[] | undefined;\n\tprivate readonly options: {\n\t\texpanded: boolean;\n\t\tlimitCommits: boolean;\n\t\tshowAsCommits: boolean;\n\t\tshowComparison: false | ViewShowBranchComparison;\n\t\tshowCurrent: boolean;\n\t\tshowStatus: boolean;\n\t\tshowTracking: boolean;\n\t\tauthors?: GitUser[];\n\t};\n\tprotected override splatted = true;\n\n\tconstructor(\n\t\turi: GitUri,\n\t\tview: BranchesView | CommitsView | RemotesView | RepositoriesView,\n\t\tparent: ViewNode,\n\t\tpublic readonly branch: GitBranch,\n\t\t// Specifies that the node is shown as a root\n\t\tpublic readonly root: boolean,\n\n\t\toptions?: {\n\t\t\texpanded?: boolean;\n\t\t\tlimitCommits?: boolean;\n\t\t\tshowAsCommits?: boolean;\n\t\t\tshowComparison?: false | ViewShowBranchComparison;\n\t\t\tshowCurrent?: boolean;\n\t\t\tshowStatus?: boolean;\n\t\t\tshowTracking?: boolean;\n\t\t\tauthors?: GitUser[];\n\t\t},\n\t) {\n\t\tsuper(uri, view, parent);\n\n\t\tthis.options = {\n\t\t\texpanded: false,\n\t\t\tlimitCommits: false,\n\t\t\tshowAsCommits: false,\n\t\t\tshowComparison: false,\n\t\t\t// Hide the current branch checkmark when the node is displayed as a root\n\t\t\tshowCurrent: !this.root,\n\t\t\t// Don't show merge/rebase status info the node is displayed as a root\n\t\t\tshowStatus: true, //!this.root,\n\t\t\t// Don't show tracking info the node is displayed as a root\n\t\t\tshowTracking: !this.root,\n\t\t\t...options,\n\t\t};\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.branch.name;\n\t}\n\n\toverride get id(): string {\n\t\treturn BranchNode.getId(this.branch.repoPath, this.branch.name, this.root);\n\t}\n\n\tcompacted: boolean = false;\n\n\tget current(): boolean {\n\t\treturn this.branch.current;\n\t}\n\n\tget label(): string {\n\t\tif (this.options.showAsCommits) return 'Commits';\n\n\t\tconst branchName = this.branch.getNameWithoutRemote();\n\t\treturn `${\n\t\t\tthis.view.config.branches?.layout !== ViewBranchesLayout.Tree ||\n\t\t\tthis.compacted ||\n\t\t\tthis.root ||\n\t\t\tthis.current ||\n\t\t\tthis.branch.detached ||\n\t\t\tthis.branch.starred\n\t\t\t\t? branchName\n\t\t\t\t: this.branch.getBasename()\n\t\t}${this.branch.rebasing ? ' (Rebasing)' : ''}`;\n\t}\n\n\tget ref(): GitBranchReference {\n\t\treturn this.branch;\n\t}\n\n\tget treeHierarchy(): string[] {\n\t\treturn this.root || this.current || this.branch.detached || this.branch.starred\n\t\t\t? [this.branch.name]\n\t\t\t: this.branch.getNameWithoutRemote().split('/');\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._children == null) {\n\t\t\tlet prPromise;\n\t\t\tif (\n\t\t\t\tthis.view.config.pullRequests.enabled &&\n\t\t\t\tthis.view.config.pullRequests.showForBranches &&\n\t\t\t\t(this.branch.upstream != null || this.branch.remote)\n\t\t\t) {\n\t\t\t\tprPromise = this.branch.getAssociatedPullRequest(\n\t\t\t\t\tthis.root ? { include: [PullRequestState.Open, PullRequestState.Merged] } : undefined,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst range = !this.branch.remote\n\t\t\t\t? await this.view.container.git.getBranchAheadRange(this.branch)\n\t\t\t\t: undefined;\n\t\t\tconst [log, getBranchAndTagTips, status, mergeStatus, rebaseStatus, unpublishedCommits] = await Promise.all(\n\t\t\t\t[\n\t\t\t\t\tthis.getLog(),\n\t\t\t\t\tthis.view.container.git.getBranchesAndTagsTipsFn(this.uri.repoPath, this.branch.name),\n\t\t\t\t\tthis.options.showStatus && this.branch.current\n\t\t\t\t\t\t? this.view.container.git.getStatusForRepo(this.uri.repoPath)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tthis.options.showStatus && this.branch.current\n\t\t\t\t\t\t? this.view.container.git.getMergeStatus(this.uri.repoPath!)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tthis.options.showStatus ? this.view.container.git.getRebaseStatus(this.uri.repoPath!) : undefined,\n\t\t\t\t\trange\n\t\t\t\t\t\t? this.view.container.git.getLogRefsOnly(this.uri.repoPath!, {\n\t\t\t\t\t\t\t\tlimit: 0,\n\t\t\t\t\t\t\t\tref: range,\n\t\t\t\t\t\t  })\n\t\t\t\t\t\t: undefined,\n\t\t\t\t],\n\t\t\t);\n\t\t\tif (log == null) return [new MessageNode(this.view, this, 'No commits could be found.')];\n\n\t\t\tconst children = [];\n\n\t\t\tlet prInsertIndex = 0;\n\n\t\t\tif (this.options.showComparison !== false && !(this.view instanceof RemotesView)) {\n\t\t\t\tprInsertIndex++;\n\t\t\t\tchildren.push(\n\t\t\t\t\tnew CompareBranchNode(\n\t\t\t\t\t\tthis.uri,\n\t\t\t\t\t\tthis.view,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tthis.branch,\n\t\t\t\t\t\tthis.options.showComparison,\n\t\t\t\t\t\tthis.splatted,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (this.options.showStatus && mergeStatus != null) {\n\t\t\t\tchildren.push(\n\t\t\t\t\tnew MergeStatusNode(\n\t\t\t\t\t\tthis.view,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tthis.branch,\n\t\t\t\t\t\tmergeStatus,\n\t\t\t\t\t\tstatus ?? (await this.view.container.git.getStatusForRepo(this.uri.repoPath)),\n\t\t\t\t\t\tthis.root,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t} else if (\n\t\t\t\tthis.options.showStatus &&\n\t\t\t\trebaseStatus != null &&\n\t\t\t\t(this.branch.current || this.branch.name === rebaseStatus.incoming.name)\n\t\t\t) {\n\t\t\t\tchildren.push(\n\t\t\t\t\tnew RebaseStatusNode(\n\t\t\t\t\t\tthis.view,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tthis.branch,\n\t\t\t\t\t\trebaseStatus,\n\t\t\t\t\t\tstatus ?? (await this.view.container.git.getStatusForRepo(this.uri.repoPath)),\n\t\t\t\t\t\tthis.root,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t} else if (this.options.showTracking) {\n\t\t\t\tconst status = {\n\t\t\t\t\tref: this.branch.ref,\n\t\t\t\t\trepoPath: this.branch.repoPath,\n\t\t\t\t\tstate: this.branch.state,\n\t\t\t\t\tupstream: this.branch.upstream?.name,\n\t\t\t\t};\n\n\t\t\t\tif (this.branch.upstream != null) {\n\t\t\t\t\tif (this.root && !status.state.behind && !status.state.ahead) {\n\t\t\t\t\t\tchildren.push(\n\t\t\t\t\t\t\tnew BranchTrackingStatusNode(this.view, this, this.branch, status, 'same', this.root),\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (status.state.behind) {\n\t\t\t\t\t\t\tchildren.push(\n\t\t\t\t\t\t\t\tnew BranchTrackingStatusNode(this.view, this, this.branch, status, 'behind', this.root),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (status.state.ahead) {\n\t\t\t\t\t\t\tchildren.push(\n\t\t\t\t\t\t\t\tnew BranchTrackingStatusNode(this.view, this, this.branch, status, 'ahead', this.root),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tchildren.push(\n\t\t\t\t\t\tnew BranchTrackingStatusNode(this.view, this, this.branch, status, 'none', this.root),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (children.length !== 0) {\n\t\t\t\tchildren.push(new MessageNode(this.view, this, '', GlyphChars.Dash.repeat(2), ''));\n\t\t\t}\n\n\t\t\tchildren.push(\n\t\t\t\t...insertDateMarkers(\n\t\t\t\t\tmap(\n\t\t\t\t\t\tlog.commits.values(),\n\t\t\t\t\t\tc =>\n\t\t\t\t\t\t\tnew CommitNode(\n\t\t\t\t\t\t\t\tthis.view,\n\t\t\t\t\t\t\t\tthis,\n\t\t\t\t\t\t\t\tc,\n\t\t\t\t\t\t\t\tunpublishedCommits?.has(c.ref),\n\t\t\t\t\t\t\t\tthis.branch,\n\t\t\t\t\t\t\t\tgetBranchAndTagTips,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t\tthis,\n\t\t\t\t),\n\t\t\t);\n\n\t\t\tif (log.hasMore) {\n\t\t\t\tchildren.push(\n\t\t\t\t\tnew LoadMoreNode(this.view, this, children[children.length - 1], undefined, () =>\n\t\t\t\t\t\tthis.view.container.git.getCommitCount(this.branch.repoPath, this.branch.name),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (prPromise != null) {\n\t\t\t\tconst pr = await prPromise;\n\t\t\t\tif (pr != null) {\n\t\t\t\t\tchildren.splice(prInsertIndex, 0, new PullRequestNode(this.view, this, pr, this.branch));\n\t\t\t\t}\n\n\t\t\t\t// const pr = await Promise.race([\n\t\t\t\t// \tprPromise,\n\t\t\t\t// \tnew Promise<null>(resolve => setTimeout(() => resolve(null), 100)),\n\t\t\t\t// ]);\n\t\t\t\t// if (pr != null) {\n\t\t\t\t// \tchildren.splice(prInsertIndex, 0, new PullRequestNode(this.view, this, pr, this.branch));\n\t\t\t\t// } else if (pr === null) {\n\t\t\t\t// \tvoid prPromise.then(pr => {\n\t\t\t\t// \t\tif (pr == null) return;\n\n\t\t\t\t// \t\tvoid this.triggerChange();\n\t\t\t\t// \t});\n\t\t\t\t// }\n\t\t\t}\n\n\t\t\tthis._children = children;\n\t\t}\n\t\treturn this._children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tthis.splatted = false;\n\n\t\tlet tooltip: string | MarkdownString = `${\n\t\t\tthis.current ? 'Current branch' : 'Branch'\n\t\t} $(git-branch) ${this.branch.getNameWithoutRemote()}${this.branch.rebasing ? ' (Rebasing)' : ''}`;\n\n\t\tlet contextValue: string = ContextValues.Branch;\n\t\tif (this.current) {\n\t\t\tcontextValue += '+current';\n\t\t}\n\t\tif (this.branch.remote) {\n\t\t\tcontextValue += '+remote';\n\t\t}\n\t\tif (this.branch.starred) {\n\t\t\tcontextValue += '+starred';\n\t\t}\n\t\tif (this.branch.upstream != null && !this.branch.upstream.missing) {\n\t\t\tcontextValue += '+tracking';\n\t\t}\n\t\tif (this.options.showAsCommits) {\n\t\t\tcontextValue += '+commits';\n\t\t}\n\n\t\tlet color: ThemeColor | undefined;\n\t\tlet description;\n\t\tlet iconSuffix = '';\n\t\tif (!this.branch.remote) {\n\t\t\tif (this.branch.upstream != null) {\n\t\t\t\tlet arrows = GlyphChars.Dash;\n\n\t\t\t\tconst remote = await this.branch.getRemote();\n\t\t\t\tif (!this.branch.upstream.missing) {\n\t\t\t\t\tif (remote != null) {\n\t\t\t\t\t\tlet left;\n\t\t\t\t\t\tlet right;\n\t\t\t\t\t\tfor (const { type } of remote.urls) {\n\t\t\t\t\t\t\tif (type === GitRemoteType.Fetch) {\n\t\t\t\t\t\t\t\tleft = true;\n\n\t\t\t\t\t\t\t\tif (right) break;\n\t\t\t\t\t\t\t} else if (type === GitRemoteType.Push) {\n\t\t\t\t\t\t\t\tright = true;\n\n\t\t\t\t\t\t\t\tif (left) break;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (left && right) {\n\t\t\t\t\t\t\tarrows = GlyphChars.ArrowsRightLeft;\n\t\t\t\t\t\t} else if (right) {\n\t\t\t\t\t\t\tarrows = GlyphChars.ArrowRight;\n\t\t\t\t\t\t} else if (left) {\n\t\t\t\t\t\t\tarrows = GlyphChars.ArrowLeft;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tarrows = GlyphChars.Warning;\n\t\t\t\t}\n\n\t\t\t\tdescription = this.options.showAsCommits\n\t\t\t\t\t? `${this.branch.getTrackingStatus({\n\t\t\t\t\t\t\tsuffix: pad(GlyphChars.Dot, 1, 1),\n\t\t\t\t\t  })}${this.branch.getNameWithoutRemote()}${this.branch.rebasing ? ' (Rebasing)' : ''}${pad(\n\t\t\t\t\t\t\tarrows,\n\t\t\t\t\t\t\t2,\n\t\t\t\t\t\t\t2,\n\t\t\t\t\t  )}${this.branch.upstream.name}`\n\t\t\t\t\t: `${this.branch.getTrackingStatus({ suffix: `${GlyphChars.Space} ` })}${arrows}${\n\t\t\t\t\t\t\tGlyphChars.Space\n\t\t\t\t\t  } ${this.branch.upstream.name}`;\n\n\t\t\t\ttooltip += ` is ${this.branch.getTrackingStatus({\n\t\t\t\t\tempty: this.branch.upstream.missing\n\t\t\t\t\t\t? `missing upstream $(git-branch) ${this.branch.upstream.name}`\n\t\t\t\t\t\t: `up to date with $(git-branch)  ${this.branch.upstream.name}${\n\t\t\t\t\t\t\t\tremote?.provider?.name ? ` on ${remote.provider.name}` : ''\n\t\t\t\t\t\t  }`,\n\t\t\t\t\texpand: true,\n\t\t\t\t\ticons: true,\n\t\t\t\t\tseparator: ', ',\n\t\t\t\t\tsuffix: ` $(git-branch) ${this.branch.upstream.name}${\n\t\t\t\t\t\tremote?.provider?.name ? ` on ${remote.provider.name}` : ''\n\t\t\t\t\t}`,\n\t\t\t\t})}`;\n\n\t\t\t\tif (this.branch.state.ahead || this.branch.state.behind) {\n\t\t\t\t\tif (this.branch.state.ahead) {\n\t\t\t\t\t\tcontextValue += '+ahead';\n\t\t\t\t\t\tcolor = new ThemeColor(Colors.UnpublishedChangesIconColor);\n\t\t\t\t\t\ticonSuffix = '-green';\n\t\t\t\t\t}\n\t\t\t\t\tif (this.branch.state.behind) {\n\t\t\t\t\t\tcontextValue += '+behind';\n\t\t\t\t\t\tcolor = new ThemeColor(Colors.UnpulledChangesIconColor);\n\t\t\t\t\t\ticonSuffix = this.branch.state.ahead ? '-yellow' : '-red';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst providers = GitRemote.getHighlanderProviders(\n\t\t\t\t\tawait this.view.container.git.getRemotesWithProviders(this.branch.repoPath),\n\t\t\t\t);\n\t\t\t\tconst providerName = providers?.length ? providers[0].name : undefined;\n\n\t\t\t\ttooltip += ` hasn't been published to ${providerName ?? 'a remote'}`;\n\t\t\t}\n\t\t}\n\n\t\tif (this.branch.date != null) {\n\t\t\tdescription = `${description ? `${description}${pad(GlyphChars.Dot, 2, 2)}` : ''}${\n\t\t\t\tthis.branch.formattedDate\n\t\t\t}`;\n\n\t\t\ttooltip += `\\n\\nLast commit ${this.branch.formatDateFromNow()} (${this.branch.formatDate(\n\t\t\t\tContainer.instance.BranchDateFormatting.dateFormat,\n\t\t\t)})`;\n\t\t}\n\n\t\ttooltip = new MarkdownString(tooltip, true);\n\t\ttooltip.supportHtml = true;\n\t\ttooltip.isTrusted = true;\n\n\t\tif (this.branch.starred) {\n\t\t\ttooltip.appendMarkdown('\\\\\\n$(star-full) Favorited');\n\t\t}\n\n\t\tconst item = new TreeItem(\n\t\t\tthis.label,\n\t\t\tthis.options.expanded ? TreeItemCollapsibleState.Expanded : TreeItemCollapsibleState.Collapsed,\n\t\t);\n\t\titem.id = this.id;\n\t\titem.contextValue = contextValue;\n\t\titem.description = description;\n\t\titem.iconPath = this.options.showAsCommits\n\t\t\t? new ThemeIcon('git-commit', color)\n\t\t\t: {\n\t\t\t\t\tdark: this.view.container.context.asAbsolutePath(`images/dark/icon-branch${iconSuffix}.svg`),\n\t\t\t\t\tlight: this.view.container.context.asAbsolutePath(`images/light/icon-branch${iconSuffix}.svg`),\n\t\t\t  };\n\t\titem.tooltip = tooltip;\n\t\titem.resourceUri = Uri.parse(\n\t\t\t`gitlens-view://branch/status/${await this.branch.getStatus()}${\n\t\t\t\tthis.options.showCurrent && this.current ? '/current' : ''\n\t\t\t}`,\n\t\t);\n\n\t\treturn item;\n\t}\n\n\t@log()\n\tasync star() {\n\t\tawait this.branch.star();\n\t\tvoid this.view.refresh(true);\n\t}\n\n\t@log()\n\tasync unstar() {\n\t\tawait this.branch.unstar();\n\t\tvoid this.view.refresh(true);\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset?: boolean) {\n\t\tthis._children = undefined;\n\t\tif (reset) {\n\t\t\tthis._log = undefined;\n\t\t}\n\t}\n\n\tprivate _log: GitLog | undefined;\n\tprivate async getLog() {\n\t\tif (this._log == null) {\n\t\t\tlet limit =\n\t\t\t\tthis.limit ??\n\t\t\t\t(this.root && !this.options.limitCommits\n\t\t\t\t\t? this.view.config.pageItemLimit\n\t\t\t\t\t: this.view.config.defaultItemLimit);\n\t\t\t// Try to show more commits if they are unpublished\n\t\t\tif (limit !== 0 && this.branch.state.ahead > limit) {\n\t\t\t\tlimit = Math.min(this.branch.state.ahead + 1, limit * 2);\n\t\t\t}\n\n\t\t\tthis._log = await this.view.container.git.getLog(this.uri.repoPath!, {\n\t\t\t\tlimit: limit,\n\t\t\t\tref: this.ref.ref,\n\t\t\t\tauthors: this.options?.authors,\n\t\t\t});\n\t\t}\n\n\t\treturn this._log;\n\t}\n\n\tget hasMore() {\n\t\treturn this._log?.hasMore ?? true;\n\t}\n\n\tlimit: number | undefined = this.view.getNodeLastKnownLimit(this);\n\t@gate()\n\tasync loadMore(limit?: number | { until?: any }) {\n\t\tlet log = await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: { viewId: this.view.id },\n\t\t\t},\n\t\t\t() => this.getLog(),\n\t\t);\n\t\tif (log == null || !log.hasMore) return;\n\n\t\tlog = await log.more?.(limit ?? this.view.config.pageItemLimit);\n\t\tif (this._log === log) return;\n\n\t\tthis._log = log;\n\t\tthis.limit = log?.count;\n\n\t\tthis._children = undefined;\n\t\tvoid this.triggerChange(false);\n\t}\n}\n","import { ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { ViewBranchesLayout } from '../../configuration';\nimport { GitUri } from '../../git/gitUri';\nimport { Repository } from '../../git/models';\nimport { makeHierarchical } from '../../system/array';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { BranchesView } from '../branchesView';\nimport { RepositoriesView } from '../repositoriesView';\nimport { BranchNode } from './branchNode';\nimport { BranchOrTagFolderNode } from './branchOrTagFolderNode';\nimport { MessageNode } from './common';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class BranchesNode extends ViewNode<BranchesView | RepositoriesView> {\n\tstatic key = ':branches';\n\tstatic getId(repoPath: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}`;\n\t}\n\n\tprivate _children: ViewNode[] | undefined;\n\n\tconstructor(\n\t\turi: GitUri,\n\t\tview: BranchesView | RepositoriesView,\n\t\tparent: ViewNode,\n\t\tpublic readonly repo: Repository,\n\t) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride get id(): string {\n\t\treturn BranchesNode.getId(this.repo.path);\n\t}\n\n\tget repoPath(): string {\n\t\treturn this.repo.path;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._children == null) {\n\t\t\tconst branches = await this.repo.getBranches({\n\t\t\t\t// only show local branches\n\t\t\t\tfilter: b => !b.remote,\n\t\t\t\tsort: { current: false },\n\t\t\t});\n\t\t\tif (branches.values.length === 0) return [new MessageNode(this.view, this, 'No branches could be found.')];\n\n\t\t\t// TODO@eamodio handle paging\n\t\t\tconst branchNodes = branches.values.map(\n\t\t\t\tb =>\n\t\t\t\t\tnew BranchNode(GitUri.fromRepoPath(this.uri.repoPath!, b.ref), this.view, this, b, false, {\n\t\t\t\t\t\tshowComparison:\n\t\t\t\t\t\t\tthis.view instanceof RepositoriesView\n\t\t\t\t\t\t\t\t? this.view.config.branches.showBranchComparison\n\t\t\t\t\t\t\t\t: this.view.config.showBranchComparison,\n\t\t\t\t\t}),\n\t\t\t);\n\t\t\tif (this.view.config.branches.layout === ViewBranchesLayout.List) return branchNodes;\n\n\t\t\tconst hierarchy = makeHierarchical(\n\t\t\t\tbranchNodes,\n\t\t\t\tn => n.treeHierarchy,\n\t\t\t\t(...paths) => paths.join('/'),\n\t\t\t\tthis.view.config.files.compact,\n\t\t\t\tb => {\n\t\t\t\t\tb.compacted = true;\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tconst root = new BranchOrTagFolderNode(\n\t\t\t\tthis.view,\n\t\t\t\tthis,\n\t\t\t\t'branch',\n\t\t\t\tthis.repo.path,\n\t\t\t\t'',\n\t\t\t\tundefined,\n\t\t\t\thierarchy,\n\t\t\t\t'branches',\n\t\t\t);\n\t\t\tthis._children = root.getChildren();\n\t\t}\n\n\t\treturn this._children;\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tconst item = new TreeItem('Branches', TreeItemCollapsibleState.Collapsed);\n\t\titem.id = this.id;\n\t\titem.contextValue = ContextValues.Branches;\n\t\tif (await this.repo.hasRemotes()) {\n\t\t\titem.contextValue += '+remotes';\n\t\t}\n\t\titem.iconPath = new ThemeIcon('git-branch');\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh() {\n\t\tthis._children = undefined;\n\t}\n}\n","import { ThemeIcon, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GitUri } from '../../git/gitUri';\nimport { GitRevision } from '../../git/models';\nimport { NamedRef } from '../../storage';\nimport { gate } from '../../system/decorators/gate';\nimport { debug, log } from '../../system/decorators/log';\nimport { md5, pluralize } from '../../system/string';\nimport { SearchAndCompareView } from '../searchAndCompareView';\nimport { RepositoryNode } from './repositoryNode';\nimport { CommitsQueryResults, ResultsCommitsNode } from './resultsCommitsNode';\nimport { FilesQueryResults, ResultsFilesNode } from './resultsFilesNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nlet instanceId = 0;\n\nexport class CompareResultsNode extends ViewNode<SearchAndCompareView> {\n\tstatic key = ':compare-results';\n\tstatic getId(repoPath: string, ref1: string, ref2: string, instanceId: number): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${ref1}|${ref2}):${instanceId}`;\n\t}\n\n\tstatic getPinnableId(repoPath: string, ref1: string, ref2: string) {\n\t\treturn md5(`${repoPath}|${ref1}|${ref2}`);\n\t}\n\n\tprivate _children: ViewNode[] | undefined;\n\tprivate _instanceId: number;\n\n\tconstructor(\n\t\tview: SearchAndCompareView,\n\t\tparent: ViewNode,\n\t\tpublic readonly repoPath: string,\n\t\tprivate _ref: NamedRef,\n\t\tprivate _compareWith: NamedRef,\n\t\tprivate _pinned: number = 0,\n\t) {\n\t\tsuper(GitUri.fromRepoPath(repoPath), view, parent);\n\t\tthis._instanceId = instanceId++;\n\t}\n\n\tget ahead(): { readonly ref1: string; readonly ref2: string } {\n\t\treturn {\n\t\t\tref1: this._compareWith.ref || 'HEAD',\n\t\t\tref2: this._ref.ref,\n\t\t};\n\t}\n\n\tget behind(): { readonly ref1: string; readonly ref2: string } {\n\t\treturn {\n\t\t\tref1: this._ref.ref,\n\t\t\tref2: this._compareWith.ref || 'HEAD',\n\t\t};\n\t}\n\n\toverride get id(): string {\n\t\treturn CompareResultsNode.getId(this.repoPath, this._ref.ref, this._compareWith.ref, this._instanceId);\n\t}\n\n\tget canDismiss(): boolean {\n\t\treturn !this.pinned;\n\t}\n\n\tprivate readonly _order: number = Date.now();\n\tget order(): number {\n\t\treturn this._pinned || this._order;\n\t}\n\n\tget pinned(): boolean {\n\t\treturn this._pinned !== 0;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._children == null) {\n\t\t\tconst ahead = this.ahead;\n\t\t\tconst behind = this.behind;\n\n\t\t\tconst aheadBehindCounts = await this.view.container.git.getAheadBehindCommitCount(this.repoPath, [\n\t\t\t\tGitRevision.createRange(behind.ref1 || 'HEAD', behind.ref2, '...'),\n\t\t\t]);\n\t\t\tconst mergeBase =\n\t\t\t\t(await this.view.container.git.getMergeBase(this.repoPath, behind.ref1, behind.ref2, {\n\t\t\t\t\tforkPoint: true,\n\t\t\t\t})) ?? (await this.view.container.git.getMergeBase(this.repoPath, behind.ref1, behind.ref2));\n\n\t\t\tthis._children = [\n\t\t\t\tnew ResultsCommitsNode(\n\t\t\t\t\tthis.view,\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.uri.repoPath!,\n\t\t\t\t\t'Behind',\n\t\t\t\t\t{\n\t\t\t\t\t\tquery: this.getCommitsQuery(GitRevision.createRange(behind.ref1, behind.ref2, '..')),\n\t\t\t\t\t\tcomparison: behind,\n\t\t\t\t\t\tdirection: 'behind',\n\t\t\t\t\t\tfiles: {\n\t\t\t\t\t\t\tref1: behind.ref1 === '' ? '' : mergeBase ?? behind.ref1,\n\t\t\t\t\t\t\tref2: behind.ref2,\n\t\t\t\t\t\t\tquery: this.getBehindFilesQuery.bind(this),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'behind',\n\t\t\t\t\t\tdescription: pluralize('commit', aheadBehindCounts?.behind ?? 0),\n\t\t\t\t\t\texpand: false,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t\tnew ResultsCommitsNode(\n\t\t\t\t\tthis.view,\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.uri.repoPath!,\n\t\t\t\t\t'Ahead',\n\t\t\t\t\t{\n\t\t\t\t\t\tquery: this.getCommitsQuery(GitRevision.createRange(ahead.ref1, ahead.ref2, '..')),\n\t\t\t\t\t\tcomparison: ahead,\n\t\t\t\t\t\tdirection: 'ahead',\n\t\t\t\t\t\tfiles: {\n\t\t\t\t\t\t\tref1: mergeBase ?? ahead.ref1,\n\t\t\t\t\t\t\tref2: ahead.ref2,\n\t\t\t\t\t\t\tquery: this.getAheadFilesQuery.bind(this),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'ahead',\n\t\t\t\t\t\tdescription: pluralize('commit', aheadBehindCounts?.ahead ?? 0),\n\t\t\t\t\t\texpand: false,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t\tnew ResultsFilesNode(\n\t\t\t\t\tthis.view,\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.uri.repoPath!,\n\t\t\t\t\tthis._compareWith.ref,\n\t\t\t\t\tthis._ref.ref,\n\t\t\t\t\tthis.getFilesQuery.bind(this),\n\t\t\t\t\tundefined,\n\t\t\t\t\t{\n\t\t\t\t\t\texpand: false,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t];\n\t\t}\n\t\treturn this._children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tlet description;\n\t\tif (this.view.container.git.repositoryCount > 1) {\n\t\t\tconst repo = this.uri.repoPath ? this.view.container.git.getRepository(this.uri.repoPath) : undefined;\n\t\t\tdescription = repo?.formattedName ?? this.uri.repoPath;\n\t\t}\n\n\t\tconst item = new TreeItem(\n\t\t\t`Comparing ${\n\t\t\t\tthis._ref.label ?? GitRevision.shorten(this._ref.ref, { strings: { working: 'Working Tree' } })\n\t\t\t} with ${\n\t\t\t\tthis._compareWith.label ??\n\t\t\t\tGitRevision.shorten(this._compareWith.ref, { strings: { working: 'Working Tree' } })\n\t\t\t}`,\n\t\t\tTreeItemCollapsibleState.Collapsed,\n\t\t);\n\t\titem.id = this.id;\n\t\titem.contextValue = `${ContextValues.CompareResults}${this._pinned ? '+pinned' : ''}`;\n\t\titem.description = description;\n\t\tif (this._pinned) {\n\t\t\titem.iconPath = new ThemeIcon('pinned');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\tasync getDiffRefs(): Promise<[string, string]> {\n\t\treturn Promise.resolve([this._compareWith.ref, this._ref.ref]);\n\t}\n\n\t@log()\n\tasync pin() {\n\t\tif (this.pinned) return;\n\n\t\tthis._pinned = Date.now();\n\t\tawait this.updatePinned();\n\n\t\tqueueMicrotask(() => this.view.reveal(this, { focus: true, select: true }));\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset: boolean = false) {\n\t\tif (!reset) return;\n\n\t\tthis._children = undefined;\n\t}\n\n\t@log()\n\tasync swap() {\n\t\t// Save the current id so we can update it later\n\t\tconst currentId = this.getPinnableId();\n\n\t\tconst ref1 = this._ref;\n\t\tthis._ref = this._compareWith;\n\t\tthis._compareWith = ref1;\n\n\t\t// If we were pinned, remove the existing pin and save a new one\n\t\tif (this.pinned) {\n\t\t\tawait this.view.updatePinned(currentId);\n\t\t\tawait this.updatePinned();\n\t\t}\n\n\t\tthis._children = undefined;\n\t\tthis.view.triggerNodeChange(this.parent);\n\t\tqueueMicrotask(() => this.view.reveal(this, { expand: true, focus: true, select: true }));\n\t}\n\n\t@log()\n\tasync unpin() {\n\t\tif (!this.pinned) return;\n\n\t\tthis._pinned = 0;\n\t\tawait this.view.updatePinned(this.getPinnableId());\n\n\t\tqueueMicrotask(() => this.view.reveal(this, { focus: true, select: true }));\n\t}\n\n\tprivate getPinnableId() {\n\t\treturn CompareResultsNode.getPinnableId(this.repoPath, this._ref.ref, this._compareWith.ref);\n\t}\n\n\tprivate async getAheadFilesQuery(): Promise<FilesQueryResults> {\n\t\tlet files = await this.view.container.git.getDiffStatus(\n\t\t\tthis.repoPath,\n\t\t\tGitRevision.createRange(this._compareWith?.ref || 'HEAD', this._ref.ref || 'HEAD', '...'),\n\t\t);\n\n\t\tif (this._ref.ref === '') {\n\t\t\tconst workingFiles = await this.view.container.git.getDiffStatus(this.repoPath, 'HEAD');\n\t\t\tif (workingFiles != null) {\n\t\t\t\tif (files != null) {\n\t\t\t\t\tfor (const wf of workingFiles) {\n\t\t\t\t\t\tconst index = files.findIndex(f => f.path === wf.path);\n\t\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\t\tfiles.splice(index, 1, wf);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfiles.push(wf);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfiles = workingFiles;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tlabel: `${pluralize('file', files?.length ?? 0, { zero: 'No' })} changed`,\n\t\t\tfiles: files,\n\t\t};\n\t}\n\n\tprivate async getBehindFilesQuery(): Promise<FilesQueryResults> {\n\t\tlet files = await this.view.container.git.getDiffStatus(\n\t\t\tthis.repoPath,\n\t\t\tGitRevision.createRange(this._ref.ref || 'HEAD', this._compareWith.ref || 'HEAD', '...'),\n\t\t);\n\n\t\tif (this._compareWith.ref === '') {\n\t\t\tconst workingFiles = await this.view.container.git.getDiffStatus(this.repoPath, 'HEAD');\n\t\t\tif (workingFiles != null) {\n\t\t\t\tif (files != null) {\n\t\t\t\t\tfor (const wf of workingFiles) {\n\t\t\t\t\t\tconst index = files.findIndex(f => f.path === wf.path);\n\t\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\t\tfiles.splice(index, 1, wf);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfiles.push(wf);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfiles = workingFiles;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tlabel: `${pluralize('file', files?.length ?? 0, { zero: 'No' })} changed`,\n\t\t\tfiles: files,\n\t\t};\n\t}\n\n\tprivate getCommitsQuery(range: string): (limit: number | undefined) => Promise<CommitsQueryResults> {\n\t\tconst repoPath = this.repoPath;\n\t\treturn async (limit: number | undefined) => {\n\t\t\tconst log = await this.view.container.git.getLog(repoPath, {\n\t\t\t\tlimit: limit,\n\t\t\t\tref: range,\n\t\t\t});\n\n\t\t\tconst results: Mutable<Partial<CommitsQueryResults>> = {\n\t\t\t\tlog: log,\n\t\t\t\thasMore: log?.hasMore ?? true,\n\t\t\t};\n\t\t\tif (results.hasMore) {\n\t\t\t\tresults.more = async (limit: number | undefined) => {\n\t\t\t\t\tresults.log = (await results.log?.more?.(limit)) ?? results.log;\n\t\t\t\t\tresults.hasMore = results.log?.hasMore ?? true;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn results as CommitsQueryResults;\n\t\t};\n\t}\n\n\tprivate async getFilesQuery(): Promise<FilesQueryResults> {\n\t\tlet comparison;\n\t\tif (this._compareWith.ref === '') {\n\t\t\tcomparison = this._ref.ref;\n\t\t} else if (this._ref.ref === '') {\n\t\t\tcomparison = this._compareWith.ref;\n\t\t} else {\n\t\t\tcomparison = `${this._compareWith.ref}..${this._ref.ref}`;\n\t\t}\n\n\t\tconst files = await this.view.container.git.getDiffStatus(this.uri.repoPath!, comparison);\n\n\t\treturn {\n\t\t\tlabel: `${pluralize('file', files?.length ?? 0, { zero: 'No' })} changed`,\n\t\t\tfiles: files,\n\t\t};\n\t}\n\n\tprivate updatePinned() {\n\t\treturn this.view.updatePinned(this.getPinnableId(), {\n\t\t\ttype: 'comparison',\n\t\t\ttimestamp: this._pinned,\n\t\t\tpath: this.repoPath,\n\t\t\tref1: { label: this._ref.label, ref: this._ref.ref },\n\t\t\tref2: { label: this._compareWith.label, ref: this._compareWith.ref },\n\t\t});\n\t}\n}\n","import { Disposable, FileType, TextEditor, TreeItem, TreeItemCollapsibleState, window, workspace } from 'vscode';\nimport { UriComparer } from '../../comparers';\nimport { ContextKeys, Schemes } from '../../constants';\nimport { setContext } from '../../context';\nimport { GitCommitish, GitUri } from '../../git/gitUri';\nimport { GitReference, GitRevision } from '../../git/models';\nimport { Logger } from '../../logger';\nimport { ReferencePicker } from '../../quickpicks/referencePicker';\nimport { gate } from '../../system/decorators/gate';\nimport { debug, log } from '../../system/decorators/log';\nimport { debounce, Deferrable } from '../../system/function';\nimport { FileHistoryView } from '../fileHistoryView';\nimport { FileHistoryNode } from './fileHistoryNode';\nimport { ContextValues, SubscribeableViewNode, ViewNode } from './viewNode';\n\nexport class FileHistoryTrackerNode extends SubscribeableViewNode<FileHistoryView> {\n\tprivate _base: string | undefined;\n\tprivate _child: FileHistoryNode | undefined;\n\tprotected override splatted = true;\n\n\tconstructor(view: FileHistoryView) {\n\t\tsuper(GitUri.unknown, view);\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\n\t\tthis.resetChild();\n\t}\n\n\t@debug()\n\tprivate resetChild() {\n\t\tif (this._child == null) return;\n\n\t\tthis._child.dispose();\n\t\tthis._child = undefined;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._child == null) {\n\t\t\tif (!this.hasUri) {\n\t\t\t\tthis.view.description = undefined;\n\n\t\t\t\tthis.view.message = 'There are no editors open that can provide file history information.';\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\n\t\t\tconst commitish: GitCommitish = {\n\t\t\t\t...this.uri,\n\t\t\t\trepoPath: this.uri.repoPath!,\n\t\t\t\tsha: this._base ?? this.uri.sha,\n\t\t\t};\n\t\t\tconst fileUri = new GitUri(this.uri, commitish);\n\n\t\t\tlet folder = false;\n\t\t\ttry {\n\t\t\t\tconst stat = await workspace.fs.stat(this.uri);\n\t\t\t\tif (stat.type === FileType.Directory) {\n\t\t\t\t\tfolder = true;\n\t\t\t\t}\n\t\t\t} catch {}\n\n\t\t\tthis.view.title = folder ? 'Folder History' : 'File History';\n\n\t\t\tlet branch;\n\t\t\tif (!commitish.sha || commitish.sha === 'HEAD') {\n\t\t\t\tbranch = await this.view.container.git.getBranch(this.uri.repoPath);\n\t\t\t} else if (!GitRevision.isSha(commitish.sha)) {\n\t\t\t\t({\n\t\t\t\t\tvalues: [branch],\n\t\t\t\t} = await this.view.container.git.getBranches(this.uri.repoPath, {\n\t\t\t\t\tfilter: b => b.name === commitish.sha,\n\t\t\t\t}));\n\t\t\t}\n\t\t\tthis._child = new FileHistoryNode(fileUri, this.view, this, folder, branch);\n\t\t}\n\n\t\treturn this._child.getChildren();\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tthis.splatted = false;\n\n\t\tconst item = new TreeItem('File History', TreeItemCollapsibleState.Expanded);\n\t\titem.contextValue = ContextValues.ActiveFileHistory;\n\n\t\treturn item;\n\t}\n\n\tget followingEditor(): boolean {\n\t\treturn this.canSubscribe;\n\t}\n\n\tget hasUri(): boolean {\n\t\treturn this._uri != GitUri.unknown;\n\t}\n\n\t@gate()\n\t@log()\n\tasync changeBase() {\n\t\tconst pick = await ReferencePicker.show(\n\t\t\tthis.uri.repoPath!,\n\t\t\t'Change File History Base',\n\t\t\t'Choose a reference to set as the new base',\n\t\t\t{\n\t\t\t\tallowEnteringRefs: true,\n\t\t\t\tpicked: this._base,\n\t\t\t\t// checkmarks: true,\n\t\t\t\tsort: { branches: { current: true }, tags: {} },\n\t\t\t},\n\t\t);\n\t\tif (pick == null) return;\n\n\t\tif (GitReference.isBranch(pick)) {\n\t\t\tconst branch = await this.view.container.git.getBranch(this.uri.repoPath);\n\t\t\tthis._base = branch?.name === pick.name ? undefined : pick.ref;\n\t\t} else {\n\t\t\tthis._base = pick.ref;\n\t\t}\n\t\tif (this._child == null) return;\n\n\t\tthis.setUri();\n\t\tawait this.triggerChange();\n\t}\n\n\t@gate()\n\t@debug({\n\t\texit: r => `returned ${r}`,\n\t})\n\toverride async refresh(reset: boolean = false) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tif (!this.canSubscribe) return false;\n\n\t\tif (reset) {\n\t\t\tif (this._uri != null && this._uri !== GitUri.unknown) {\n\t\t\t\tawait this.view.container.tracker.resetCache(this._uri, 'log');\n\t\t\t}\n\n\t\t\tthis.reset();\n\t\t}\n\n\t\tconst editor = window.activeTextEditor;\n\t\tif (editor == null || !this.view.container.git.isTrackable(editor.document.uri)) {\n\t\t\tif (\n\t\t\t\t!this.hasUri ||\n\t\t\t\t(this.view.container.git.isTrackable(this.uri) &&\n\t\t\t\t\twindow.visibleTextEditors.some(e => e.document?.uri.path === this.uri.path))\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.reset();\n\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = `, uri=${Logger.toLoggable(this._uri)}`;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tif (editor.document.uri.path === this.uri.path) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = `, uri=${Logger.toLoggable(this._uri)}`;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tlet gitUri = await GitUri.fromUri(editor.document.uri);\n\n\t\tlet uri;\n\t\tif (gitUri.sha != null) {\n\t\t\t// If we have a sha, normalize the history to the working file (so we get a full history all the time)\n\t\t\tconst workingUri = await this.view.container.git.getWorkingUri(gitUri.repoPath!, gitUri);\n\t\t\tif (workingUri != null) {\n\t\t\t\turi = workingUri;\n\t\t\t}\n\t\t}\n\n\t\tif (this.hasUri && UriComparer.equals(uri ?? gitUri, this.uri)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (uri != null) {\n\t\t\tgitUri = await GitUri.fromUri(uri);\n\t\t}\n\n\t\t// If we have no repoPath then don't attempt to use the Uri\n\t\tif (gitUri.repoPath == null) {\n\t\t\tthis.reset();\n\t\t} else {\n\t\t\tthis.setUri(gitUri);\n\t\t\tthis.resetChild();\n\t\t}\n\n\t\tif (cc != null) {\n\t\t\tcc.exitDetails = `, uri=${Logger.toLoggable(this._uri)}`;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate reset() {\n\t\tthis.setUri();\n\t\tthis.resetChild();\n\t}\n\n\t@log()\n\tsetEditorFollowing(enabled: boolean) {\n\t\tif (enabled) {\n\t\t\tthis.setUri();\n\t\t\t// Don't need to call triggerChange here, since canSubscribe will do it\n\t\t}\n\n\t\tthis.canSubscribe = enabled;\n\t\tif (!enabled) {\n\t\t\tvoid this.triggerChange();\n\t\t}\n\t}\n\n\t@log()\n\tasync showHistoryForUri(uri: GitUri) {\n\t\tthis.setUri(uri);\n\t\tawait this.triggerChange();\n\t}\n\n\t@debug()\n\tprotected subscribe() {\n\t\treturn Disposable.from(window.onDidChangeActiveTextEditor(debounce(this.onActiveEditorChanged, 250), this));\n\t}\n\n\tprotected override etag(): number {\n\t\treturn 0;\n\t}\n\n\tprivate _triggerChangeDebounced: Deferrable<() => Promise<void>> | undefined;\n\t@debug({ args: false })\n\tprivate onActiveEditorChanged(editor: TextEditor | undefined) {\n\t\t// If we are losing the active editor, give more time before assuming its really gone\n\t\t// For virtual repositories the active editor event takes a while to fire\n\t\t// Ultimately we need to be using the upcoming Tabs api to avoid this\n\t\tif (editor == null && (this._uri?.scheme === Schemes.Virtual || this._uri?.scheme === Schemes.GitHub)) {\n\t\t\tif (this._triggerChangeDebounced == null) {\n\t\t\t\tthis._triggerChangeDebounced = debounce(() => this.triggerChange(), 1500);\n\t\t\t}\n\n\t\t\tvoid this._triggerChangeDebounced();\n\t\t\treturn;\n\t\t}\n\t\tvoid this.triggerChange();\n\t}\n\n\tsetUri(uri?: GitUri) {\n\t\tthis._uri = uri ?? GitUri.unknown;\n\t\tvoid setContext(ContextKeys.ViewsFileHistoryCanPin, this.hasUri);\n\t}\n}\n","import { Disposable, TreeItem, TreeItemCollapsibleState, Uri, window } from 'vscode';\nimport { configuration } from '../../configuration';\nimport type { GitUri } from '../../git/gitUri';\nimport {\n\tGitBranch,\n\tGitLog,\n\tGitRevision,\n\tRepositoryChange,\n\tRepositoryChangeComparisonMode,\n\tRepositoryChangeEvent,\n\tRepositoryFileSystemChangeEvent,\n} from '../../git/models';\nimport { Logger } from '../../logger';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { memoize } from '../../system/decorators/memoize';\nimport { filterMap, flatMap, map, uniqueBy } from '../../system/iterable';\nimport { basename } from '../../system/path';\nimport { FileHistoryView } from '../fileHistoryView';\nimport { CommitNode } from './commitNode';\nimport { LoadMoreNode, MessageNode } from './common';\nimport { FileHistoryTrackerNode } from './fileHistoryTrackerNode';\nimport { FileRevisionAsCommitNode } from './fileRevisionAsCommitNode';\nimport { insertDateMarkers } from './helpers';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, PageableViewNode, SubscribeableViewNode, ViewNode } from './viewNode';\n\nexport class FileHistoryNode extends SubscribeableViewNode<FileHistoryView> implements PageableViewNode {\n\tstatic key = ':history:file';\n\tstatic getId(repoPath: string, uri: string): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${uri})`;\n\t}\n\n\tprotected override splatted = true;\n\n\tconstructor(\n\t\turi: GitUri,\n\t\tview: FileHistoryView,\n\t\tparent: ViewNode,\n\t\tprivate readonly folder: boolean,\n\t\tprivate readonly branch: GitBranch | undefined,\n\t) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.uri.fileName;\n\t}\n\n\toverride get id(): string {\n\t\treturn FileHistoryNode.getId(this.uri.repoPath!, this.uri.toString(true));\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tthis.view.description = `${this.label}${\n\t\t\tthis.parent instanceof FileHistoryTrackerNode && !this.parent.followingEditor ? ' (pinned)' : ''\n\t\t}`;\n\n\t\tconst children: ViewNode[] = [];\n\n\t\tconst range = this.branch != null ? await this.view.container.git.getBranchAheadRange(this.branch) : undefined;\n\t\tconst [log, fileStatuses, currentUser, getBranchAndTagTips, unpublishedCommits] = await Promise.all([\n\t\t\tthis.getLog(),\n\t\t\tthis.uri.sha == null\n\t\t\t\t? this.view.container.git.getStatusForFiles(this.uri.repoPath!, this.getPathOrGlob())\n\t\t\t\t: undefined,\n\t\t\tthis.uri.sha == null ? this.view.container.git.getCurrentUser(this.uri.repoPath!) : undefined,\n\t\t\tthis.branch != null\n\t\t\t\t? this.view.container.git.getBranchesAndTagsTipsFn(this.uri.repoPath, this.branch.name)\n\t\t\t\t: undefined,\n\t\t\trange\n\t\t\t\t? this.view.container.git.getLogRefsOnly(this.uri.repoPath!, {\n\t\t\t\t\t\tlimit: 0,\n\t\t\t\t\t\tref: range,\n\t\t\t\t  })\n\t\t\t\t: undefined,\n\t\t]);\n\n\t\tif (fileStatuses?.length) {\n\t\t\tif (this.folder) {\n\t\t\t\t// Combine all the working/staged changes into single pseudo commits\n\t\t\t\tconst commits = map(\n\t\t\t\t\tuniqueBy(\n\t\t\t\t\t\tflatMap(fileStatuses, f => f.getPseudoCommits(this.view.container, currentUser)),\n\t\t\t\t\t\tc => c.sha,\n\t\t\t\t\t\t(original, c) => original.with({ files: { files: [...original.files!, ...c.files!] } }),\n\t\t\t\t\t),\n\t\t\t\t\tcommit => new CommitNode(this.view, this, commit),\n\t\t\t\t);\n\t\t\t\tchildren.push(...commits);\n\t\t\t} else {\n\t\t\t\tconst [file] = fileStatuses;\n\t\t\t\tconst commits = file.getPseudoCommits(this.view.container, currentUser);\n\t\t\t\tif (commits.length) {\n\t\t\t\t\tchildren.push(\n\t\t\t\t\t\t...commits.map(commit => new FileRevisionAsCommitNode(this.view, this, file, commit)),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (log != null) {\n\t\t\tchildren.push(\n\t\t\t\t...insertDateMarkers(\n\t\t\t\t\tfilterMap(log.commits.values(), c =>\n\t\t\t\t\t\tthis.folder\n\t\t\t\t\t\t\t? new CommitNode(\n\t\t\t\t\t\t\t\t\tthis.view,\n\t\t\t\t\t\t\t\t\tthis,\n\t\t\t\t\t\t\t\t\tc,\n\t\t\t\t\t\t\t\t\tunpublishedCommits?.has(c.ref),\n\t\t\t\t\t\t\t\t\tthis.branch,\n\t\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\texpand: false,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t: c.file != null\n\t\t\t\t\t\t\t? new FileRevisionAsCommitNode(this.view, this, c.file, c, {\n\t\t\t\t\t\t\t\t\tbranch: this.branch,\n\t\t\t\t\t\t\t\t\tgetBranchAndTagTips: getBranchAndTagTips,\n\t\t\t\t\t\t\t\t\tunpublished: unpublishedCommits?.has(c.ref),\n\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t),\n\t\t\t\t\tthis,\n\t\t\t\t),\n\t\t\t);\n\n\t\t\tif (log.hasMore) {\n\t\t\t\tchildren.push(new LoadMoreNode(this.view, this, children[children.length - 1]));\n\t\t\t}\n\t\t}\n\n\t\tif (children.length === 0) return [new MessageNode(this.view, this, 'No file history could be found.')];\n\t\treturn children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tthis.splatted = false;\n\n\t\tconst label = this.label;\n\t\tconst item = new TreeItem(label, TreeItemCollapsibleState.Expanded);\n\t\titem.contextValue = ContextValues.FileHistory;\n\t\titem.description = this.uri.directory;\n\t\titem.tooltip = `History of ${this.uri.fileName}\\n${this.uri.directory}/${\n\t\t\tthis.uri.sha == null ? '' : `\\n\\n${this.uri.sha}`\n\t\t}`;\n\n\t\tthis.view.description = `${label}${\n\t\t\tthis.parent instanceof FileHistoryTrackerNode && !this.parent.followingEditor ? ' (pinned)' : ''\n\t\t}`;\n\n\t\treturn item;\n\t}\n\n\tget label() {\n\t\t// Check if this is a base folder\n\t\tif (this.folder && this.uri.fileName === '') {\n\t\t\treturn `${basename(this.uri.path)}${\n\t\t\t\tthis.uri.sha\n\t\t\t\t\t? ` ${this.uri.sha === GitRevision.deletedOrMissing ? this.uri.shortSha : `(${this.uri.shortSha})`}`\n\t\t\t\t\t: ''\n\t\t\t}`;\n\t\t}\n\n\t\treturn `${this.uri.fileName}${\n\t\t\tthis.uri.sha\n\t\t\t\t? ` ${this.uri.sha === GitRevision.deletedOrMissing ? this.uri.shortSha : `(${this.uri.shortSha})`}`\n\t\t\t\t: ''\n\t\t}`;\n\t}\n\n\t@debug()\n\tprotected subscribe() {\n\t\tconst repo = this.view.container.git.getRepository(this.uri);\n\t\tif (repo == null) return undefined;\n\n\t\tconst subscription = Disposable.from(\n\t\t\trepo.onDidChange(this.onRepositoryChanged, this),\n\t\t\trepo.onDidChangeFileSystem(this.onFileSystemChanged, this),\n\t\t\trepo.startWatchingFileSystem(),\n\t\t\tconfiguration.onDidChange(e => {\n\t\t\t\tif (configuration.changed(e, 'advanced.fileHistoryFollowsRenames')) {\n\t\t\t\t\tthis.view.resetNodeLastKnownLimit(this);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\treturn subscription;\n\t}\n\n\tprotected override etag(): number {\n\t\treturn Date.now();\n\t}\n\n\tprivate onRepositoryChanged(e: RepositoryChangeEvent) {\n\t\tif (\n\t\t\t!e.changed(\n\t\t\t\tRepositoryChange.Index,\n\t\t\t\tRepositoryChange.Heads,\n\t\t\t\tRepositoryChange.Remotes,\n\t\t\t\tRepositoryChange.RemoteProviders,\n\t\t\t\tRepositoryChange.Status,\n\t\t\t\tRepositoryChange.Unknown,\n\t\t\t\tRepositoryChangeComparisonMode.Any,\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.debug(`FileHistoryNode.onRepositoryChanged(${e.toString()}); triggering node refresh`);\n\n\t\tvoid this.triggerChange(true);\n\t}\n\n\tprivate onFileSystemChanged(e: RepositoryFileSystemChangeEvent) {\n\t\tif (this.folder) {\n\t\t\tif (!e.uris.some(uri => uri.fsPath.startsWith(this.uri.fsPath))) return;\n\t\t} else if (!e.uris.some(uri => uri.toString() === this.uri.toString())) {\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.debug(`FileHistoryNode.onFileSystemChanged(${this.uri.toString(true)}); triggering node refresh`);\n\n\t\tvoid this.triggerChange(true);\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset?: boolean) {\n\t\tif (reset) {\n\t\t\tthis._log = undefined;\n\t\t}\n\t}\n\n\tprivate _log: GitLog | undefined;\n\tprivate async getLog() {\n\t\tif (this._log == null) {\n\t\t\tthis._log = await this.view.container.git.getLogForFile(this.uri.repoPath, this.getPathOrGlob(), {\n\t\t\t\tlimit: this.limit ?? this.view.config.pageItemLimit,\n\t\t\t\tref: this.uri.sha,\n\t\t\t});\n\t\t}\n\n\t\treturn this._log;\n\t}\n\n\t@memoize()\n\tprivate getPathOrGlob() {\n\t\treturn this.folder ? Uri.joinPath(this.uri, '*') : this.uri;\n\t}\n\n\tget hasMore() {\n\t\treturn this._log?.hasMore ?? true;\n\t}\n\n\tlimit: number | undefined = this.view.getNodeLastKnownLimit(this);\n\t@gate()\n\tasync loadMore(limit?: number | { until?: any }) {\n\t\tlet log = await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: { viewId: this.view.id },\n\t\t\t},\n\t\t\t() => this.getLog(),\n\t\t);\n\t\tif (log == null || !log.hasMore) return;\n\n\t\tlog = await log.more?.(limit ?? this.view.config.pageItemLimit);\n\t\tif (this._log === log) return;\n\n\t\tthis._log = log;\n\t\tthis.limit = log?.count;\n\n\t\t// Needs to force if splatted, since the parent node will cancel the refresh (since it thinks nothing changed)\n\t\tvoid this.triggerChange(false, this.splatted);\n\t}\n}\n","import { Selection, TreeItem, TreeItemCollapsibleState, window } from 'vscode';\nimport { UriComparer } from '../../comparers';\nimport { ContextKeys } from '../../constants';\nimport { setContext } from '../../context';\nimport { GitCommitish, GitUri } from '../../git/gitUri';\nimport { GitReference, GitRevision } from '../../git/models';\nimport { Logger } from '../../logger';\nimport { ReferencePicker } from '../../quickpicks/referencePicker';\nimport { gate } from '../../system/decorators/gate';\nimport { debug, log } from '../../system/decorators/log';\nimport { debounce } from '../../system/function';\nimport { LinesChangeEvent } from '../../trackers/gitLineTracker';\nimport { FileHistoryView } from '../fileHistoryView';\nimport { LineHistoryView } from '../lineHistoryView';\nimport { LineHistoryNode } from './lineHistoryNode';\nimport { ContextValues, SubscribeableViewNode, ViewNode } from './viewNode';\n\nexport class LineHistoryTrackerNode extends SubscribeableViewNode<FileHistoryView | LineHistoryView> {\n\tprivate _base: string | undefined;\n\tprivate _child: LineHistoryNode | undefined;\n\tprivate _editorContents: string | undefined;\n\tprivate _selection: Selection | undefined;\n\tprotected override splatted = true;\n\n\tconstructor(view: FileHistoryView | LineHistoryView) {\n\t\tsuper(GitUri.unknown, view);\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\n\t\tthis.resetChild();\n\t}\n\n\t@debug()\n\tprivate resetChild() {\n\t\tif (this._child == null) return;\n\n\t\tthis._child.dispose();\n\t\tthis._child = undefined;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this._child == null) {\n\t\t\tif (!this.hasUri) {\n\t\t\t\tthis.view.description = undefined;\n\n\t\t\t\tthis.view.message = 'There are no editors open that can provide line history information.';\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tif (this._selection == null) {\n\t\t\t\tthis.view.description = undefined;\n\n\t\t\t\tthis.view.message = 'There was no selection provided for line history.';\n\t\t\t\tthis.view.description = `${this.uri.fileName}${\n\t\t\t\t\tthis.uri.sha\n\t\t\t\t\t\t? ` ${\n\t\t\t\t\t\t\t\tthis.uri.sha === GitRevision.deletedOrMissing\n\t\t\t\t\t\t\t\t\t? this.uri.shortSha\n\t\t\t\t\t\t\t\t\t: `(${this.uri.shortSha})`\n\t\t\t\t\t\t  }`\n\t\t\t\t\t\t: ''\n\t\t\t\t}${!this.followingEditor ? ' (pinned)' : ''}`;\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\n\t\t\tconst commitish: GitCommitish = {\n\t\t\t\t...this.uri,\n\t\t\t\trepoPath: this.uri.repoPath!,\n\t\t\t\tsha: this.uri.sha ?? this._base,\n\t\t\t};\n\t\t\tconst fileUri = new GitUri(this.uri, commitish);\n\n\t\t\tlet branch;\n\t\t\tif (!commitish.sha || commitish.sha === 'HEAD') {\n\t\t\t\tbranch = await this.view.container.git.getBranch(this.uri.repoPath);\n\t\t\t} else if (!GitRevision.isSha(commitish.sha)) {\n\t\t\t\t({\n\t\t\t\t\tvalues: [branch],\n\t\t\t\t} = await this.view.container.git.getBranches(this.uri.repoPath, {\n\t\t\t\t\tfilter: b => b.name === commitish.sha,\n\t\t\t\t}));\n\t\t\t}\n\t\t\tthis._child = new LineHistoryNode(fileUri, this.view, this, branch, this._selection, this._editorContents);\n\t\t}\n\n\t\treturn this._child.getChildren();\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tthis.splatted = false;\n\n\t\tconst item = new TreeItem('Line History', TreeItemCollapsibleState.Expanded);\n\t\titem.contextValue = ContextValues.ActiveLineHistory;\n\n\t\tvoid this.ensureSubscription();\n\n\t\treturn item;\n\t}\n\n\tget followingEditor(): boolean {\n\t\treturn this.canSubscribe;\n\t}\n\n\tget hasUri(): boolean {\n\t\treturn this._uri != GitUri.unknown;\n\t}\n\n\t@gate()\n\t@log()\n\tasync changeBase() {\n\t\tconst pick = await ReferencePicker.show(\n\t\t\tthis.uri.repoPath!,\n\t\t\t'Change Line History Base',\n\t\t\t'Choose a reference to set as the new base',\n\t\t\t{\n\t\t\t\tallowEnteringRefs: true,\n\t\t\t\tpicked: this._base,\n\t\t\t\t// checkmarks: true,\n\t\t\t\tsort: { branches: { current: true }, tags: {} },\n\t\t\t},\n\t\t);\n\t\tif (pick == null) return;\n\n\t\tif (GitReference.isBranch(pick)) {\n\t\t\tconst branch = await this.view.container.git.getBranch(this.uri.repoPath);\n\t\t\tthis._base = branch?.name === pick.name ? undefined : pick.ref;\n\t\t} else {\n\t\t\tthis._base = pick.ref;\n\t\t}\n\t\tif (this._child == null) return;\n\n\t\tthis.setUri();\n\t\tawait this.triggerChange();\n\t}\n\n\t@gate()\n\t@debug({\n\t\texit: r => `returned ${r}`,\n\t})\n\toverride async refresh(reset: boolean = false) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tif (!this.canSubscribe) return false;\n\n\t\tif (reset) {\n\t\t\tif (this._uri != null && this._uri !== GitUri.unknown) {\n\t\t\t\tawait this.view.container.tracker.resetCache(this._uri, 'log');\n\t\t\t}\n\n\t\t\tthis.reset();\n\t\t}\n\n\t\tconst editor = window.activeTextEditor;\n\t\tif (editor == null || !this.view.container.git.isTrackable(editor.document.uri)) {\n\t\t\tif (\n\t\t\t\t!this.hasUri ||\n\t\t\t\t(this.view.container.git.isTrackable(this.uri) &&\n\t\t\t\t\twindow.visibleTextEditors.some(e => e.document?.uri.path === this.uri.path))\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.reset();\n\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = `, uri=${Logger.toLoggable(this._uri)}`;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\teditor.document.uri.path === this.uri.path &&\n\t\t\tthis._selection != null &&\n\t\t\teditor.selection.isEqual(this._selection)\n\t\t) {\n\t\t\tif (cc != null) {\n\t\t\t\tcc.exitDetails = `, uri=${Logger.toLoggable(this._uri)}`;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tconst gitUri = await GitUri.fromUri(editor.document.uri);\n\n\t\tif (\n\t\t\tthis.hasUri &&\n\t\t\tUriComparer.equals(gitUri, this.uri) &&\n\t\t\tthis._selection != null &&\n\t\t\teditor.selection.isEqual(this._selection)\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// If we have no repoPath then don't attempt to use the Uri\n\t\tif (gitUri.repoPath == null) {\n\t\t\tthis.reset();\n\t\t} else {\n\t\t\tthis.setUri(gitUri);\n\t\t\tthis._editorContents = editor.document.isDirty ? editor.document.getText() : undefined;\n\t\t\tthis._selection = editor.selection;\n\t\t\tthis.resetChild();\n\t\t}\n\n\t\tif (cc != null) {\n\t\t\tcc.exitDetails = `, uri=${Logger.toLoggable(this._uri)}`;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate reset() {\n\t\tthis.setUri();\n\t\tthis._editorContents = undefined;\n\t\tthis._selection = undefined;\n\t\tthis.resetChild();\n\t}\n\n\t@log()\n\tsetEditorFollowing(enabled: boolean) {\n\t\tthis.canSubscribe = enabled;\n\t}\n\n\t@debug()\n\tprotected subscribe() {\n\t\tif (this.view.container.lineTracker.subscribed(this)) return undefined;\n\n\t\tconst onActiveLinesChanged = debounce(this.onActiveLinesChanged.bind(this), 250);\n\n\t\treturn this.view.container.lineTracker.subscribe(\n\t\t\tthis,\n\t\t\tthis.view.container.lineTracker.onDidChangeActiveLines((e: LinesChangeEvent) => {\n\t\t\t\tif (e.pending) return;\n\n\t\t\t\tonActiveLinesChanged(e);\n\t\t\t}),\n\t\t);\n\t}\n\n\tprotected override etag(): number {\n\t\treturn 0;\n\t}\n\n\t@debug<LineHistoryTrackerNode['onActiveLinesChanged']>({\n\t\targs: {\n\t\t\t0: e =>\n\t\t\t\t`editor=${e.editor?.document.uri.toString(true)}, selections=${e.selections\n\t\t\t\t\t?.map(s => `[${s.anchor}-${s.active}]`)\n\t\t\t\t\t.join(',')}, pending=${Boolean(e.pending)}, reason=${e.reason}`,\n\t\t},\n\t})\n\tprivate onActiveLinesChanged(_e: LinesChangeEvent) {\n\t\tvoid this.triggerChange();\n\t}\n\n\tsetUri(uri?: GitUri) {\n\t\tthis._uri = uri ?? GitUri.unknown;\n\t\tvoid setContext(ContextKeys.ViewsFileHistoryCanPin, this.hasUri);\n\t}\n}\n","import { Disposable, Selection, TreeItem, TreeItemCollapsibleState, window } from 'vscode';\nimport type { GitUri } from '../../git/gitUri';\nimport {\n\tGitBranch,\n\tGitFile,\n\tGitFileIndexStatus,\n\tGitLog,\n\tGitRevision,\n\tRepositoryChange,\n\tRepositoryChangeComparisonMode,\n\tRepositoryChangeEvent,\n\tRepositoryFileSystemChangeEvent,\n} from '../../git/models';\nimport { Logger } from '../../logger';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { memoize } from '../../system/decorators/memoize';\nimport { filterMap } from '../../system/iterable';\nimport { FileHistoryView } from '../fileHistoryView';\nimport { LineHistoryView } from '../lineHistoryView';\nimport { LoadMoreNode, MessageNode } from './common';\nimport { FileRevisionAsCommitNode } from './fileRevisionAsCommitNode';\nimport { insertDateMarkers } from './helpers';\nimport { LineHistoryTrackerNode } from './lineHistoryTrackerNode';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, PageableViewNode, SubscribeableViewNode, ViewNode } from './viewNode';\n\nexport class LineHistoryNode\n\textends SubscribeableViewNode<FileHistoryView | LineHistoryView>\n\timplements PageableViewNode\n{\n\tstatic key = ':history:line';\n\tstatic getId(repoPath: string, uri: string, selection: Selection): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${uri}[${selection.start.line},${\n\t\t\tselection.start.character\n\t\t}-${selection.end.line},${selection.end.character}])`;\n\t}\n\n\tprotected override splatted = true;\n\n\tconstructor(\n\t\turi: GitUri,\n\t\tview: FileHistoryView | LineHistoryView,\n\t\tparent: ViewNode,\n\t\tprivate readonly branch: GitBranch | undefined,\n\t\tpublic readonly selection: Selection,\n\t\tprivate readonly editorContents: string | undefined,\n\t) {\n\t\tsuper(uri, view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.uri.fileName;\n\t}\n\n\toverride get id(): string {\n\t\treturn LineHistoryNode.getId(this.uri.repoPath!, this.uri.toString(true), this.selection);\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tthis.view.description = `${this.label}${\n\t\t\tthis.parent instanceof LineHistoryTrackerNode && !this.parent.followingEditor ? ' (pinned)' : ''\n\t\t}`;\n\n\t\tconst children: ViewNode[] = [];\n\n\t\tlet selection = this.selection;\n\n\t\tconst range = this.branch != null ? await this.view.container.git.getBranchAheadRange(this.branch) : undefined;\n\t\tconst [log, blame, getBranchAndTagTips, unpublishedCommits] = await Promise.all([\n\t\t\tthis.getLog(selection),\n\t\t\tthis.uri.sha == null || GitRevision.isUncommitted(this.uri.sha)\n\t\t\t\t? this.editorContents\n\t\t\t\t\t? await this.view.container.git.getBlameForRangeContents(this.uri, selection, this.editorContents)\n\t\t\t\t\t: await this.view.container.git.getBlameForRange(this.uri, selection)\n\t\t\t\t: undefined,\n\t\t\tthis.branch != null\n\t\t\t\t? this.view.container.git.getBranchesAndTagsTipsFn(this.uri.repoPath, this.branch.name)\n\t\t\t\t: undefined,\n\t\t\trange\n\t\t\t\t? this.view.container.git.getLogRefsOnly(this.uri.repoPath!, {\n\t\t\t\t\t\tlimit: 0,\n\t\t\t\t\t\tref: range,\n\t\t\t\t  })\n\t\t\t\t: undefined,\n\t\t]);\n\n\t\t// Check for any uncommitted changes in the range\n\t\tif (blame != null) {\n\t\t\tfor (const commit of blame.commits.values()) {\n\t\t\t\tif (!commit.isUncommitted) continue;\n\n\t\t\t\tconst firstLine = blame.lines[0];\n\t\t\t\tconst lastLine = blame.lines[blame.lines.length - 1];\n\n\t\t\t\t// Since there could be a change in the line numbers, update the selection\n\t\t\t\tconst firstActive = selection.active.line === firstLine.line - 1;\n\t\t\t\tselection = new Selection(\n\t\t\t\t\t(firstActive ? lastLine : firstLine).originalLine - 1,\n\t\t\t\t\tselection.anchor.character,\n\t\t\t\t\t(firstActive ? firstLine : lastLine).originalLine - 1,\n\t\t\t\t\tselection.active.character,\n\t\t\t\t);\n\n\t\t\t\tconst status = await this.view.container.git.getStatusForFile(this.uri.repoPath!, this.uri);\n\n\t\t\t\tif (status != null) {\n\t\t\t\t\tconst file: GitFile = {\n\t\t\t\t\t\tconflictStatus: status?.conflictStatus,\n\t\t\t\t\t\tpath: commit.file?.path ?? '',\n\t\t\t\t\t\tindexStatus: status?.indexStatus,\n\t\t\t\t\t\toriginalPath: commit.file?.originalPath,\n\t\t\t\t\t\trepoPath: this.uri.repoPath!,\n\t\t\t\t\t\tstatus: status?.status ?? GitFileIndexStatus.Modified,\n\t\t\t\t\t\tworkingTreeStatus: status?.workingTreeStatus,\n\t\t\t\t\t};\n\n\t\t\t\t\tconst currentUser = await this.view.container.git.getCurrentUser(this.uri.repoPath!);\n\t\t\t\t\tconst pseudoCommits = status?.getPseudoCommits(this.view.container, currentUser);\n\t\t\t\t\tif (pseudoCommits != null) {\n\t\t\t\t\t\tfor (const commit of pseudoCommits.reverse()) {\n\t\t\t\t\t\t\tchildren.splice(\n\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\tnew FileRevisionAsCommitNode(this.view, this, file, commit, {\n\t\t\t\t\t\t\t\t\tselection: selection,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (log != null) {\n\t\t\tchildren.push(\n\t\t\t\t...insertDateMarkers(\n\t\t\t\t\tfilterMap(log.commits.values(), c =>\n\t\t\t\t\t\tc.file != null\n\t\t\t\t\t\t\t? new FileRevisionAsCommitNode(this.view, this, c.file, c, {\n\t\t\t\t\t\t\t\t\tbranch: this.branch,\n\t\t\t\t\t\t\t\t\tgetBranchAndTagTips: getBranchAndTagTips,\n\t\t\t\t\t\t\t\t\tselection: selection,\n\t\t\t\t\t\t\t\t\tunpublished: unpublishedCommits?.has(c.ref),\n\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t),\n\t\t\t\t\tthis,\n\t\t\t\t),\n\t\t\t);\n\n\t\t\tif (log.hasMore) {\n\t\t\t\tchildren.push(new LoadMoreNode(this.view, this, children[children.length - 1]));\n\t\t\t}\n\t\t}\n\n\t\tif (children.length === 0) return [new MessageNode(this.view, this, 'No line history could be found.')];\n\t\treturn children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tthis.splatted = false;\n\n\t\tconst label = this.label;\n\t\tconst item = new TreeItem(label, TreeItemCollapsibleState.Expanded);\n\t\titem.contextValue = ContextValues.LineHistory;\n\t\titem.description = this.uri.directory;\n\t\titem.tooltip = `History of ${this.uri.fileName}${this.lines}\\n${this.uri.directory}/${\n\t\t\tthis.uri.sha == null ? '' : `\\n\\n${this.uri.sha}`\n\t\t}`;\n\n\t\tthis.view.description = `${label}${\n\t\t\tthis.parent instanceof LineHistoryTrackerNode && !this.parent.followingEditor ? ' (pinned)' : ''\n\t\t}`;\n\n\t\treturn item;\n\t}\n\n\tget label() {\n\t\treturn `${this.uri.fileName}${this.lines}${\n\t\t\tthis.uri.sha\n\t\t\t\t? ` ${this.uri.sha === GitRevision.deletedOrMissing ? this.uri.shortSha : `(${this.uri.shortSha})`}`\n\t\t\t\t: ''\n\t\t}`;\n\t}\n\n\t@memoize()\n\tget lines() {\n\t\treturn this.selection.isSingleLine\n\t\t\t? `:${this.selection.start.line + 1}`\n\t\t\t: `:${this.selection.start.line + 1}-${this.selection.end.line + 1}`;\n\t}\n\n\t@debug()\n\tprotected subscribe() {\n\t\tconst repo = this.view.container.git.getRepository(this.uri);\n\t\tif (repo == null) return undefined;\n\n\t\tconst subscription = Disposable.from(\n\t\t\trepo.onDidChange(this.onRepositoryChanged, this),\n\t\t\trepo.onDidChangeFileSystem(this.onFileSystemChanged, this),\n\t\t\trepo.startWatchingFileSystem(),\n\t\t);\n\n\t\treturn subscription;\n\t}\n\n\tprotected override etag(): number {\n\t\treturn Date.now();\n\t}\n\n\tprivate onRepositoryChanged(e: RepositoryChangeEvent) {\n\t\tif (\n\t\t\t!e.changed(\n\t\t\t\tRepositoryChange.Index,\n\t\t\t\tRepositoryChange.Heads,\n\t\t\t\tRepositoryChange.Remotes,\n\t\t\t\tRepositoryChange.RemoteProviders,\n\t\t\t\tRepositoryChange.Status,\n\t\t\t\tRepositoryChange.Unknown,\n\t\t\t\tRepositoryChangeComparisonMode.Any,\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.debug(`LineHistoryNode.onRepositoryChanged(${e.toString()}); triggering node refresh`);\n\n\t\tvoid this.triggerChange(true);\n\t}\n\n\tprivate onFileSystemChanged(e: RepositoryFileSystemChangeEvent) {\n\t\tif (!e.uris.some(uri => uri.toString() === this.uri.toString())) return;\n\n\t\tLogger.debug(`LineHistoryNode.onFileSystemChanged(${this.uri.toString(true)}); triggering node refresh`);\n\n\t\tvoid this.triggerChange(true);\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset?: boolean) {\n\t\tif (reset) {\n\t\t\tthis._log = undefined;\n\t\t}\n\t}\n\n\tprivate _log: GitLog | undefined;\n\tprivate async getLog(selection?: Selection) {\n\t\tif (this._log == null) {\n\t\t\tthis._log = await this.view.container.git.getLogForFile(this.uri.repoPath, this.uri, {\n\t\t\t\tall: false,\n\t\t\t\tlimit: this.limit ?? this.view.config.pageItemLimit,\n\t\t\t\trange: selection ?? this.selection,\n\t\t\t\tref: this.uri.sha,\n\t\t\t\trenames: false,\n\t\t\t});\n\t\t}\n\n\t\treturn this._log;\n\t}\n\n\tget hasMore() {\n\t\treturn this._log?.hasMore ?? true;\n\t}\n\n\tlimit: number | undefined = this.view.getNodeLastKnownLimit(this);\n\t@gate()\n\tasync loadMore(limit?: number | { until?: any }) {\n\t\tlet log = await window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: { viewId: this.view.id },\n\t\t\t},\n\t\t\t() => this.getLog(),\n\t\t);\n\t\tif (log == null || !log.hasMore) return;\n\n\t\tlog = await log.more?.(limit ?? this.view.config.pageItemLimit);\n\t\tif (this._log === log) return;\n\n\t\tthis._log = log;\n\t\tthis.limit = log?.count;\n\n\t\t// Needs to force if splatted, since the parent node will cancel the refresh (since it thinks nothing changed)\n\t\tvoid this.triggerChange(false, this.splatted);\n\t}\n}\n","import { Disposable, TextEditor, TreeItem, TreeItemCollapsibleState, window } from 'vscode';\nimport { RepositoriesChangeEvent } from '../../git/gitProviderService';\nimport { GitUri } from '../../git/gitUri';\nimport { Logger } from '../../logger';\nimport { gate } from '../../system/decorators/gate';\nimport { debug } from '../../system/decorators/log';\nimport { debounce, szudzikPairing } from '../../system/function';\nimport { RepositoriesView } from '../repositoriesView';\nimport { MessageNode } from './common';\nimport { RepositoryNode } from './repositoryNode';\nimport { ContextValues, SubscribeableViewNode, ViewNode } from './viewNode';\n\nexport class RepositoriesNode extends SubscribeableViewNode<RepositoriesView> {\n\tprivate _children: (RepositoryNode | MessageNode)[] | undefined;\n\n\tconstructor(view: RepositoriesView) {\n\t\tsuper(GitUri.unknown, view);\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\n\t\tthis.resetChildren();\n\t}\n\n\t@debug()\n\tprivate resetChildren() {\n\t\tif (this._children == null) return;\n\n\t\tfor (const child of this._children) {\n\t\t\tif (child instanceof RepositoryNode) {\n\t\t\t\tchild.dispose();\n\t\t\t}\n\t\t}\n\t\tthis._children = undefined;\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\tif (this._children == null) {\n\t\t\tconst repositories = this.view.container.git.openRepositories;\n\t\t\tif (repositories.length === 0) return [new MessageNode(this.view, this, 'No repositories could be found.')];\n\n\t\t\tthis._children = repositories.map(r => new RepositoryNode(GitUri.fromRepoPath(r.path), this.view, this, r));\n\t\t}\n\n\t\treturn this._children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Repositories', TreeItemCollapsibleState.Expanded);\n\t\titem.contextValue = ContextValues.Repositories;\n\n\t\treturn item;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride async refresh(reset: boolean = false) {\n\t\tif (this._children == null) return;\n\n\t\tif (reset) {\n\t\t\tthis.resetChildren();\n\t\t\tawait this.unsubscribe();\n\t\t\tvoid this.ensureSubscription();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst repositories = this.view.container.git.openRepositories;\n\t\tif (repositories.length === 0 && (this._children == null || this._children.length === 0)) return;\n\n\t\tif (repositories.length === 0) {\n\t\t\tthis._children = [new MessageNode(this.view, this, 'No repositories could be found.')];\n\t\t\treturn;\n\t\t}\n\n\t\tconst children = [];\n\t\tfor (const repo of repositories) {\n\t\t\tconst id = repo.id;\n\t\t\tconst child = (this._children as RepositoryNode[]).find(c => c.repo.id === id);\n\t\t\tif (child != null) {\n\t\t\t\tchildren.push(child);\n\t\t\t\tvoid child.refresh();\n\t\t\t} else {\n\t\t\t\tchildren.push(new RepositoryNode(GitUri.fromRepoPath(repo.path), this.view, this, repo));\n\t\t\t}\n\t\t}\n\n\t\tfor (const child of this._children as RepositoryNode[]) {\n\t\t\tif (children.includes(child)) continue;\n\n\t\t\tchild.dispose();\n\t\t}\n\n\t\tthis._children = children;\n\n\t\tvoid this.ensureSubscription();\n\t}\n\n\t@debug()\n\tprotected subscribe() {\n\t\tconst subscriptions = [this.view.container.git.onDidChangeRepositories(this.onRepositoriesChanged, this)];\n\n\t\tif (this.view.config.autoReveal) {\n\t\t\tsubscriptions.push(window.onDidChangeActiveTextEditor(debounce(this.onActiveEditorChanged, 500), this));\n\t\t}\n\n\t\treturn Disposable.from(...subscriptions);\n\t}\n\n\tprotected override etag(): number {\n\t\treturn szudzikPairing(this.view.container.git.etag, this.view.container.subscription.etag);\n\t}\n\n\t@debug({ args: false })\n\tprivate onActiveEditorChanged(editor: TextEditor | undefined) {\n\t\tif (editor == null || this._children == null || this._children.length === 1) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst uri = editor.document.uri;\n\t\t\tconst node = this._children.find(n => n instanceof RepositoryNode && n.repo.containsUri(uri)) as\n\t\t\t\t| RepositoryNode\n\t\t\t\t| undefined;\n\t\t\tif (node == null) return;\n\n\t\t\t// Check to see if this repo has a descendent that is already selected\n\t\t\tlet parent = this.view.selection.length === 0 ? undefined : this.view.selection[0];\n\t\t\twhile (parent != null) {\n\t\t\t\tif (parent === node) return;\n\n\t\t\t\tparent = parent.getParent();\n\t\t\t}\n\n\t\t\tvoid this.view.reveal(node, { expand: true });\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\t\t}\n\t}\n\n\t@debug()\n\tprivate onRepositoriesChanged(_e: RepositoriesChangeEvent) {\n\t\tvoid this.triggerChange();\n\t}\n}\n","import { ThemeIcon, TreeItem } from 'vscode';\nimport { executeGitCommand } from '../../commands/gitCommands.actions';\nimport { GitUri } from '../../git/gitUri';\nimport { GitLog } from '../../git/models';\nimport { SearchPattern } from '../../git/search';\nimport { gate } from '../../system/decorators/gate';\nimport { debug, log } from '../../system/decorators/log';\nimport { md5, pluralize } from '../../system/string';\nimport { SearchAndCompareView } from '../searchAndCompareView';\nimport { RepositoryNode } from './repositoryNode';\nimport { CommitsQueryResults, ResultsCommitsNode } from './resultsCommitsNode';\nimport { ContextValues, PageableViewNode, ViewNode } from './viewNode';\n\nlet instanceId = 0;\n\ninterface SearchQueryResults {\n\treadonly label: string;\n\treadonly log: GitLog | undefined;\n\treadonly hasMore: boolean;\n\tmore?(limit: number | undefined): Promise<void>;\n}\n\nexport class SearchResultsNode extends ViewNode<SearchAndCompareView> implements PageableViewNode {\n\tstatic key = ':search-results';\n\tstatic getId(repoPath: string, search: SearchPattern | undefined, instanceId: number): string {\n\t\treturn `${RepositoryNode.getId(repoPath)}${this.key}(${\n\t\t\tsearch == null ? '?' : SearchPattern.toKey(search)\n\t\t}):${instanceId}`;\n\t}\n\n\tstatic getPinnableId(repoPath: string, search: SearchPattern) {\n\t\treturn md5(`${repoPath}|${SearchPattern.toKey(search)}`);\n\t}\n\n\tstatic override is(node: any): node is SearchResultsNode {\n\t\treturn node instanceof SearchResultsNode;\n\t}\n\n\tprivate _instanceId: number;\n\tconstructor(\n\t\tview: SearchAndCompareView,\n\t\tparent: ViewNode,\n\t\tpublic readonly repoPath: string,\n\t\tsearch: SearchPattern,\n\t\tprivate _labels: {\n\t\t\tlabel: string;\n\t\t\tqueryLabel:\n\t\t\t\t| string\n\t\t\t\t| {\n\t\t\t\t\t\tlabel: string;\n\t\t\t\t\t\tresultsType?: { singular: string; plural: string };\n\t\t\t\t  };\n\t\t\tresultsType?: { singular: string; plural: string };\n\t\t},\n\t\tprivate _searchQueryOrLog?:\n\t\t\t| ((limit: number | undefined) => Promise<CommitsQueryResults>)\n\t\t\t| Promise<GitLog | undefined>\n\t\t\t| GitLog\n\t\t\t| undefined,\n\t\tprivate _pinned: number = 0,\n\t) {\n\t\tsuper(GitUri.fromRepoPath(repoPath), view, parent);\n\n\t\tthis._search = search;\n\t\tthis._instanceId = instanceId++;\n\t\tthis._order = Date.now();\n\t}\n\n\toverride get id(): string {\n\t\treturn SearchResultsNode.getId(this.repoPath, this.search, this._instanceId);\n\t}\n\n\tget canDismiss(): boolean {\n\t\treturn !this.pinned;\n\t}\n\n\tprivate readonly _order: number = Date.now();\n\tget order(): number {\n\t\treturn this._pinned || this._order;\n\t}\n\n\tget pinned(): boolean {\n\t\treturn this._pinned !== 0;\n\t}\n\n\tprivate _search: SearchPattern;\n\tget search(): SearchPattern {\n\t\treturn this._search;\n\t}\n\n\tprivate _resultsNode: ResultsCommitsNode | undefined;\n\tprivate ensureResults() {\n\t\tif (this._resultsNode == null) {\n\t\t\tlet deferred;\n\t\t\tif (this._searchQueryOrLog == null) {\n\t\t\t\tdeferred = true;\n\t\t\t\tthis._searchQueryOrLog = this.getSearchQuery({\n\t\t\t\t\tlabel: this._labels.queryLabel,\n\t\t\t\t});\n\t\t\t} else if (typeof this._searchQueryOrLog !== 'function') {\n\t\t\t\tthis._searchQueryOrLog = this.getSearchQuery(\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: this._labels.queryLabel,\n\t\t\t\t\t},\n\t\t\t\t\tthis._searchQueryOrLog,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis._resultsNode = new ResultsCommitsNode(\n\t\t\t\tthis.view,\n\t\t\t\tthis,\n\t\t\t\tthis.repoPath,\n\t\t\t\tthis._labels.label,\n\t\t\t\t{\n\t\t\t\t\tquery: this._searchQueryOrLog,\n\t\t\t\t\tdeferred: deferred,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\texpand: !this.pinned,\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t);\n\t\t}\n\n\t\treturn this._resultsNode;\n\t}\n\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\treturn this.ensureResults().getChildren();\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tconst item = await this.ensureResults().getTreeItem();\n\t\titem.id = this.id;\n\t\titem.contextValue = `${ContextValues.SearchResults}${this._pinned ? '+pinned' : ''}`;\n\t\tif (this.view.container.git.repositoryCount > 1) {\n\t\t\tconst repo = this.view.container.git.getRepository(this.repoPath);\n\t\t\titem.description = repo?.formattedName ?? this.repoPath;\n\t\t}\n\t\tif (this._pinned) {\n\t\t\titem.iconPath = new ThemeIcon('pinned');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tget hasMore() {\n\t\treturn this.ensureResults().hasMore;\n\t}\n\n\tasync loadMore(limit?: number) {\n\t\treturn this.ensureResults().loadMore(limit);\n\t}\n\n\tasync edit(search?: {\n\t\tpattern: SearchPattern;\n\t\tlabels: {\n\t\t\tlabel: string;\n\t\t\tqueryLabel:\n\t\t\t\t| string\n\t\t\t\t| {\n\t\t\t\t\t\tlabel: string;\n\t\t\t\t\t\tresultsType?: { singular: string; plural: string };\n\t\t\t\t  };\n\t\t\tresultsType?: { singular: string; plural: string };\n\t\t};\n\t\tlog: Promise<GitLog | undefined> | GitLog | undefined;\n\t}) {\n\t\tif (search == null) {\n\t\t\tvoid (await executeGitCommand({\n\t\t\t\tcommand: 'search',\n\t\t\t\tprefillOnly: true,\n\t\t\t\tstate: {\n\t\t\t\t\trepo: this.repoPath,\n\t\t\t\t\t...this.search,\n\t\t\t\t\tshowResultsInSideBar: this,\n\t\t\t\t},\n\t\t\t}));\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Save the current id so we can update it later\n\t\tconst currentId = this.getPinnableId();\n\n\t\tthis._search = search.pattern;\n\t\tthis._labels = search.labels;\n\t\tthis._searchQueryOrLog = search.log;\n\t\tthis._resultsNode = undefined;\n\n\t\t// If we were pinned, remove the existing pin and save a new one\n\t\tif (this.pinned) {\n\t\t\tawait this.view.updatePinned(currentId);\n\t\t\tawait this.updatePinned();\n\t\t}\n\n\t\tvoid this.triggerChange(false);\n\t\tqueueMicrotask(() => this.view.reveal(this, { expand: true, focus: true, select: true }));\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset: boolean = false) {\n\t\tthis._resultsNode?.refresh(reset);\n\t}\n\n\t@log()\n\tasync pin() {\n\t\tif (this.pinned) return;\n\n\t\tthis._pinned = Date.now();\n\t\tawait this.updatePinned();\n\n\t\tqueueMicrotask(() => this.view.reveal(this, { focus: true, select: true }));\n\t}\n\n\t@log()\n\tasync unpin() {\n\t\tif (!this.pinned) return;\n\n\t\tthis._pinned = 0;\n\t\tawait this.view.updatePinned(this.getPinnableId());\n\n\t\tqueueMicrotask(() => this.view.reveal(this, { focus: true, select: true }));\n\t}\n\n\tprivate getPinnableId() {\n\t\treturn SearchResultsNode.getPinnableId(this.repoPath, this.search);\n\t}\n\n\tprivate getSearchLabel(\n\t\tlabel:\n\t\t\t| string\n\t\t\t| {\n\t\t\t\t\tlabel: string;\n\t\t\t\t\tresultsType?: { singular: string; plural: string };\n\t\t\t  },\n\t\tlog: GitLog | undefined,\n\t): string {\n\t\tif (typeof label === 'string') return label;\n\n\t\tconst count = log?.count ?? 0;\n\n\t\tconst resultsType =\n\t\t\tlabel.resultsType === undefined ? { singular: 'result', plural: 'results' } : label.resultsType;\n\n\t\treturn `${pluralize(resultsType.singular, count, {\n\t\t\tformat: c => (log?.hasMore ? `${c}+` : undefined),\n\t\t\tplural: resultsType.plural,\n\t\t\tzero: 'No',\n\t\t})} ${label.label}`;\n\t}\n\n\tprivate getSearchQuery(\n\t\toptions: {\n\t\t\tlabel:\n\t\t\t\t| string\n\t\t\t\t| {\n\t\t\t\t\t\tlabel: string;\n\t\t\t\t\t\tresultsType?: { singular: string; plural: string };\n\t\t\t\t  };\n\t\t},\n\t\tlog?: Promise<GitLog | undefined> | GitLog,\n\t): (limit: number | undefined) => Promise<SearchQueryResults> {\n\t\tlet useCacheOnce = true;\n\n\t\treturn async (limit: number | undefined) => {\n\t\t\tlog = await (log ?? this.view.container.git.getLogForSearch(this.repoPath, this.search));\n\n\t\t\tif (!useCacheOnce && log != null && log.query != null) {\n\t\t\t\tlog = await log.query(limit);\n\t\t\t}\n\t\t\tuseCacheOnce = false;\n\n\t\t\tconst results: Mutable<SearchQueryResults> = {\n\t\t\t\tlabel: this.getSearchLabel(options.label, log),\n\t\t\t\tlog: log,\n\t\t\t\thasMore: log?.hasMore ?? false,\n\t\t\t};\n\t\t\tif (results.hasMore) {\n\t\t\t\tresults.more = async (limit: number | undefined) => {\n\t\t\t\t\tresults.log = (await results.log?.more?.(limit)) ?? results.log;\n\n\t\t\t\t\tresults.label = this.getSearchLabel(options.label, results.log);\n\t\t\t\t\tresults.hasMore = results.log?.hasMore ?? true;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn results;\n\t\t};\n\t}\n\n\tprivate updatePinned() {\n\t\treturn this.view.updatePinned(this.getPinnableId(), {\n\t\t\ttype: 'search',\n\t\t\ttimestamp: this._pinned,\n\t\t\tpath: this.repoPath,\n\t\t\tlabels: this._labels,\n\t\t\tsearch: this.search,\n\t\t});\n\t}\n}\n","import { GitFile, GitStashCommit } from '../../git/models';\nimport { RepositoriesView } from '../repositoriesView';\nimport { StashesView } from '../stashesView';\nimport { CommitFileNode } from './commitFileNode';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport class StashFileNode extends CommitFileNode<StashesView | RepositoriesView> {\n\tconstructor(view: StashesView | RepositoriesView, parent: ViewNode, file: GitFile, commit: GitStashCommit) {\n\t\tsuper(view, parent, file, commit);\n\t}\n\n\tprotected override get contextValue(): string {\n\t\treturn `${ContextValues.File}+stashed`;\n\t}\n}\n","import { MarkdownString, TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GitUri } from '../../git/gitUri';\nimport { GitFile, IssueOrPullRequest, IssueOrPullRequestType } from '../../git/models';\nimport { fromNow } from '../../system/date';\nimport { ViewsWithCommits } from '../viewBase';\nimport { ContextValues, ViewNode } from './viewNode';\n\nexport interface FilesQueryResults {\n\tlabel: string;\n\tfiles: GitFile[] | undefined;\n\tfiltered?: {\n\t\tfilter: 'left' | 'right';\n\t\tfiles: GitFile[];\n\t};\n}\n\nexport class AutolinkedItemNode extends ViewNode<ViewsWithCommits> {\n\tconstructor(\n\t\tview: ViewsWithCommits,\n\t\tparent: ViewNode,\n\t\tpublic readonly repoPath: string,\n\t\tpublic readonly issue: IssueOrPullRequest,\n\t) {\n\t\tsuper(GitUri.fromRepoPath(repoPath), view, parent);\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.issue.url;\n\t}\n\n\toverride get id(): string {\n\t\treturn `${this.parent!.id!}:item(${this.issue.id})`;\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\treturn [];\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst relativeTime = fromNow(this.issue.closedDate ?? this.issue.date);\n\n\t\tconst item = new TreeItem(`${this.issue.id}: ${this.issue.title}`, TreeItemCollapsibleState.None);\n\t\titem.description = relativeTime;\n\t\titem.iconPath = IssueOrPullRequest.getThemeIcon(this.issue);\n\t\titem.contextValue =\n\t\t\tthis.issue.type === IssueOrPullRequestType.PullRequest\n\t\t\t\t? ContextValues.PullRequest\n\t\t\t\t: ContextValues.AutolinkedIssue;\n\n\t\tconst linkTitle = ` \"Open ${\n\t\t\tthis.issue.type === IssueOrPullRequestType.PullRequest ? 'Pull Request' : 'Issue'\n\t\t} \\\\#${this.issue.id} on ${this.issue.provider.name}\"`;\n\t\tconst tooltip = new MarkdownString(\n\t\t\t`${IssueOrPullRequest.getMarkdownIcon(this.issue)} [**${this.issue.title.trim()}**](${\n\t\t\t\tthis.issue.url\n\t\t\t}${linkTitle}) \\\\\\n[#${this.issue.id}](${this.issue.url}${linkTitle}) was ${\n\t\t\t\tthis.issue.closed ? 'closed' : 'opened'\n\t\t\t} ${relativeTime}`,\n\t\t\ttrue,\n\t\t);\n\t\ttooltip.supportHtml = true;\n\t\ttooltip.isTrusted = true;\n\n\t\titem.tooltip = tooltip;\n\n\t\treturn item;\n\t}\n}\n","import { TreeItem, TreeItemCollapsibleState } from 'vscode';\nimport { GlyphChars } from '../../constants';\nimport { GitUri } from '../../git/gitUri';\nimport { NamedRef } from '../../storage';\nimport { SearchAndCompareView, SearchAndCompareViewNode } from '../searchAndCompareView';\nimport { ContextValues, ViewNode } from './viewNode';\n\ninterface RepoRef {\n\tlabel: string;\n\trepoPath: string;\n\tref: string | NamedRef;\n}\n\nexport class ComparePickerNode extends ViewNode<SearchAndCompareView> {\n\treadonly order: number = Date.now();\n\treadonly pinned: boolean = false;\n\n\tconstructor(view: SearchAndCompareView, parent: SearchAndCompareViewNode, public readonly selectedRef: RepoRef) {\n\t\tsuper(GitUri.unknown, view, parent);\n\t}\n\n\tget canDismiss(): boolean {\n\t\treturn true;\n\t}\n\n\tgetChildren(): ViewNode[] {\n\t\treturn [];\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst selectedRef = this.selectedRef;\n\t\tconst repoPath = selectedRef?.repoPath;\n\n\t\tlet description;\n\t\tif (repoPath !== undefined) {\n\t\t\tif (this.view.container.git.repositoryCount > 1) {\n\t\t\t\tconst repo = this.view.container.git.getRepository(repoPath);\n\t\t\t\tdescription = repo?.formattedName ?? repoPath;\n\t\t\t}\n\t\t}\n\n\t\tlet item;\n\t\tif (selectedRef == null) {\n\t\t\titem = new TreeItem(\n\t\t\t\t'Compare <branch, tag, or ref> with <branch, tag, or ref>',\n\t\t\t\tTreeItemCollapsibleState.None,\n\t\t\t);\n\t\t\titem.contextValue = ContextValues.ComparePicker;\n\t\t\titem.description = description;\n\t\t\titem.tooltip = `Click to select or enter a reference for compare${GlyphChars.Ellipsis}`;\n\t\t\titem.command = {\n\t\t\t\ttitle: `Compare${GlyphChars.Ellipsis}`,\n\t\t\t\tcommand: this.view.getQualifiedCommand('selectForCompare'),\n\t\t\t};\n\t\t} else {\n\t\t\titem = new TreeItem(\n\t\t\t\t`Compare ${selectedRef.label} with <branch, tag, or ref>`,\n\t\t\t\tTreeItemCollapsibleState.None,\n\t\t\t);\n\t\t\titem.contextValue = ContextValues.ComparePickerWithRef;\n\t\t\titem.description = description;\n\t\t\titem.tooltip = `Click to compare ${selectedRef.label} with${GlyphChars.Ellipsis}`;\n\t\t\titem.command = {\n\t\t\t\ttitle: `Compare ${selectedRef.label} with${GlyphChars.Ellipsis}`,\n\t\t\t\tcommand: this.view.getQualifiedCommand('compareWithSelected'),\n\t\t\t};\n\t\t}\n\n\t\treturn item;\n\t}\n}\n","import {\n\tCommand,\n\tDisposable,\n\tEvent,\n\tMarkdownString,\n\tTreeItem,\n\tTreeItemCollapsibleState,\n\tTreeViewVisibilityChangeEvent,\n} from 'vscode';\nimport { GlyphChars } from '../../constants';\nimport { RepositoriesChangeEvent } from '../../git/gitProviderService';\nimport { GitUri } from '../../git/gitUri';\nimport {\n\tGitFile,\n\tGitReference,\n\tGitRemote,\n\tGitRevisionReference,\n\tRepository,\n\tRepositoryChange,\n\tRepositoryChangeComparisonMode,\n\tRepositoryChangeEvent,\n} from '../../git/models';\nimport { Logger } from '../../logger';\nimport { SubscriptionChangeEvent } from '../../premium/subscription/subscriptionService';\nimport { gate } from '../../system/decorators/gate';\nimport { debug, log, logName } from '../../system/decorators/log';\nimport { is as isA, szudzikPairing } from '../../system/function';\nimport { pad } from '../../system/string';\nimport { TreeViewNodeCollapsibleStateChangeEvent, View } from '../viewBase';\n\nexport const enum ContextValues {\n\tActiveFileHistory = 'gitlens:history:active:file',\n\tActiveLineHistory = 'gitlens:history:active:line',\n\tAutolinkedItems = 'gitlens:autolinked:items',\n\tAutolinkedIssue = 'gitlens:autolinked:issue',\n\tBranch = 'gitlens:branch',\n\tBranches = 'gitlens:branches',\n\tBranchStatusAheadOfUpstream = 'gitlens:status-branch:upstream:ahead',\n\tBranchStatusBehindUpstream = 'gitlens:status-branch:upstream:behind',\n\tBranchStatusNoUpstream = 'gitlens:status-branch:upstream:none',\n\tBranchStatusSameAsUpstream = 'gitlens:status-branch:upstream:same',\n\tBranchStatusFiles = 'gitlens:status-branch:files',\n\tCommit = 'gitlens:commit',\n\tCommits = 'gitlens:commits',\n\tCompare = 'gitlens:compare',\n\tCompareBranch = 'gitlens:compare:branch',\n\tComparePicker = 'gitlens:compare:picker',\n\tComparePickerWithRef = 'gitlens:compare:picker:ref',\n\tCompareResults = 'gitlens:compare:results',\n\tCompareResultsCommits = 'gitlens:compare:results:commits',\n\tContributor = 'gitlens:contributor',\n\tContributors = 'gitlens:contributors',\n\tDateMarker = 'gitlens:date-marker',\n\tFile = 'gitlens:file',\n\tFileHistory = 'gitlens:history:file',\n\tFolder = 'gitlens:folder',\n\tLineHistory = 'gitlens:history:line',\n\tMerge = 'gitlens:merge',\n\tMergeConflictCurrentChanges = 'gitlens:merge-conflict:current',\n\tMergeConflictIncomingChanges = 'gitlens:merge-conflict:incoming',\n\tMessage = 'gitlens:message',\n\tPager = 'gitlens:pager',\n\tPullRequest = 'gitlens:pullrequest',\n\tRebase = 'gitlens:rebase',\n\tReflog = 'gitlens:reflog',\n\tReflogRecord = 'gitlens:reflog-record',\n\tRemote = 'gitlens:remote',\n\tRemotes = 'gitlens:remotes',\n\tRepositories = 'gitlens:repositories',\n\tRepository = 'gitlens:repository',\n\tRepositoryFolder = 'gitlens:repo-folder',\n\tResultsFile = 'gitlens:file:results',\n\tResultsFiles = 'gitlens:results:files',\n\tSearchAndCompare = 'gitlens:searchAndCompare',\n\tSearchResults = 'gitlens:search:results',\n\tSearchResultsCommits = 'gitlens:search:results:commits',\n\tStash = 'gitlens:stash',\n\tStashes = 'gitlens:stashes',\n\tStatusFileCommits = 'gitlens:status:file:commits',\n\tStatusFiles = 'gitlens:status:files',\n\tStatusAheadOfUpstream = 'gitlens:status:upstream:ahead',\n\tStatusBehindUpstream = 'gitlens:status:upstream:behind',\n\tStatusNoUpstream = 'gitlens:status:upstream:none',\n\tStatusSameAsUpstream = 'gitlens:status:upstream:same',\n\tTag = 'gitlens:tag',\n\tTags = 'gitlens:tags',\n\tUncommittedFiles = 'gitlens:uncommitted:files',\n\tWorktree = 'gitlens:worktree',\n\tWorktrees = 'gitlens:worktrees',\n}\n\nexport interface ViewNode {\n\treadonly id?: string;\n}\n\n@logName<ViewNode>((c, name) => `${name}${c.id != null ? `(${c.id})` : ''}`)\nexport abstract class ViewNode<TView extends View = View> {\n\tstatic is(node: any): node is ViewNode {\n\t\treturn node instanceof ViewNode;\n\t}\n\n\tprotected splatted = false;\n\n\tconstructor(uri: GitUri, public readonly view: TView, protected readonly parent?: ViewNode) {\n\t\tthis._uri = uri;\n\t}\n\n\ttoClipboard?(): string;\n\n\ttoString(): string {\n\t\treturn `${Logger.toLoggableName(this)}${this.id != null ? `(${this.id})` : ''}`;\n\t}\n\n\tprotected _uri: GitUri;\n\tget uri() {\n\t\treturn this._uri;\n\t}\n\n\tabstract getChildren(): ViewNode[] | Promise<ViewNode[]>;\n\n\tgetParent(): ViewNode | undefined {\n\t\t// If this node's parent has been splatted (e.g. not shown itself, but its children are), then return its grandparent\n\t\treturn this.parent?.splatted ? this.parent?.getParent() : this.parent;\n\t}\n\n\tabstract getTreeItem(): TreeItem | Promise<TreeItem>;\n\n\tresolveTreeItem?(item: TreeItem): TreeItem | Promise<TreeItem>;\n\n\tgetCommand(): Command | undefined {\n\t\treturn undefined;\n\t}\n\n\trefresh?(reset?: boolean): boolean | void | Promise<void> | Promise<boolean>;\n\n\t@gate<ViewNode['triggerChange']>((reset: boolean = false, force: boolean = false, avoidSelf?: ViewNode) =>\n\t\tJSON.stringify([reset, force, avoidSelf?.toString()]),\n\t)\n\t@debug()\n\ttriggerChange(reset: boolean = false, force: boolean = false, avoidSelf?: ViewNode): Promise<void> {\n\t\t// If this node has been splatted (e.g. not shown itself, but its children are), then delegate the change to its parent\n\t\tif (this.splatted && this.parent != null && this.parent !== avoidSelf) {\n\t\t\treturn this.parent.triggerChange(reset, force);\n\t\t}\n\n\t\treturn this.view.refreshNode(this, reset, force);\n\t}\n\n\tgetSplattedChild?(): Promise<ViewNode | undefined>;\n}\n\nexport abstract class ViewRefNode<\n\tTView extends View = View,\n\tTReference extends GitReference = GitReference,\n> extends ViewNode<TView> {\n\tabstract get ref(): TReference;\n\n\tget repoPath(): string {\n\t\treturn this.uri.repoPath!;\n\t}\n\n\toverride toString(): string {\n\t\treturn `${super.toString()}:${GitReference.toString(this.ref, false)}`;\n\t}\n}\n\nexport abstract class ViewRefFileNode<TView extends View = View> extends ViewRefNode<TView, GitRevisionReference> {\n\tabstract get file(): GitFile;\n\tabstract get fileName(): string;\n\n\toverride toString(): string {\n\t\treturn `${super.toString()}:${this.fileName}`;\n\t}\n}\n\nexport interface PageableViewNode {\n\treadonly id: string;\n\tlimit?: number;\n\treadonly hasMore: boolean;\n\tloadMore(limit?: number | { until?: string | undefined }): Promise<void>;\n}\n\nexport namespace PageableViewNode {\n\texport function is(node: ViewNode): node is ViewNode & PageableViewNode {\n\t\treturn isA<ViewNode & PageableViewNode>(node, 'loadMore');\n\t}\n}\n\nexport abstract class SubscribeableViewNode<TView extends View = View> extends ViewNode<TView> {\n\tprotected disposable: Disposable;\n\tprotected subscription: Promise<Disposable | undefined> | undefined;\n\n\tprotected loaded: boolean = false;\n\n\tconstructor(uri: GitUri, view: TView, parent?: ViewNode) {\n\t\tsuper(uri, view, parent);\n\n\t\tconst disposables = [\n\t\t\tthis.view.onDidChangeVisibility(this.onVisibilityChanged, this),\n\t\t\tthis.view.onDidChangeNodeCollapsibleState(this.onNodeCollapsibleStateChanged, this),\n\t\t];\n\n\t\tif (canAutoRefreshView(this.view)) {\n\t\t\tdisposables.push(this.view.onDidChangeAutoRefresh(this.onAutoRefreshChanged, this));\n\t\t}\n\n\t\tconst getTreeItem = this.getTreeItem;\n\t\tthis.getTreeItem = function (this: SubscribeableViewNode<TView>) {\n\t\t\tthis.loaded = true;\n\t\t\tvoid this.ensureSubscription();\n\t\t\treturn getTreeItem.apply(this);\n\t\t};\n\n\t\tconst getChildren = this.getChildren;\n\t\tthis.getChildren = function (this: SubscribeableViewNode<TView>) {\n\t\t\tthis.loaded = true;\n\t\t\tvoid this.ensureSubscription();\n\t\t\treturn getChildren.apply(this);\n\t\t};\n\n\t\tthis.disposable = Disposable.from(...disposables);\n\t}\n\n\t@debug()\n\tdispose() {\n\t\tvoid this.unsubscribe();\n\n\t\tthis.disposable?.dispose();\n\t}\n\n\t@gate()\n\t@debug()\n\toverride async triggerChange(reset: boolean = false, force: boolean = false): Promise<void> {\n\t\tif (!this.loaded) return;\n\n\t\tif (reset && !this.view.visible) {\n\t\t\tthis._pendingReset = reset;\n\t\t}\n\t\tawait super.triggerChange(reset, force);\n\t}\n\n\tprivate _canSubscribe: boolean = true;\n\tprotected get canSubscribe(): boolean {\n\t\treturn this._canSubscribe;\n\t}\n\tprotected set canSubscribe(value: boolean) {\n\t\tif (this._canSubscribe === value) return;\n\n\t\tthis._canSubscribe = value;\n\n\t\tvoid this.ensureSubscription();\n\t\tif (value) {\n\t\t\tvoid this.triggerChange();\n\t\t}\n\t}\n\n\tprivate _etag: number | undefined;\n\tprotected abstract etag(): number;\n\n\tprivate _pendingReset: boolean = false;\n\tprivate get requiresResetOnVisible(): boolean {\n\t\tlet reset = this._pendingReset;\n\t\tthis._pendingReset = false;\n\n\t\tconst etag = this.etag();\n\t\tif (etag !== this._etag) {\n\t\t\tthis._etag = etag;\n\t\t\treset = true;\n\t\t}\n\n\t\treturn reset;\n\t}\n\n\tprotected abstract subscribe(): Disposable | undefined | Promise<Disposable | undefined>;\n\n\t@debug()\n\tprotected async unsubscribe(): Promise<void> {\n\t\tthis._etag = this.etag();\n\n\t\tif (this.subscription != null) {\n\t\t\tconst subscriptionPromise = this.subscription;\n\t\t\tthis.subscription = undefined;\n\n\t\t\t(await subscriptionPromise)?.dispose();\n\t\t}\n\t}\n\n\t@debug()\n\tprotected onAutoRefreshChanged() {\n\t\tthis.onVisibilityChanged({ visible: this.view.visible });\n\t}\n\n\tprotected onParentCollapsibleStateChanged?(state: TreeItemCollapsibleState): void;\n\tprotected onCollapsibleStateChanged?(state: TreeItemCollapsibleState): void;\n\n\tprotected collapsibleState: TreeItemCollapsibleState | undefined;\n\tprotected onNodeCollapsibleStateChanged(e: TreeViewNodeCollapsibleStateChangeEvent<ViewNode>) {\n\t\tif (e.element === this) {\n\t\t\tthis.collapsibleState = e.state;\n\t\t\tif (this.onCollapsibleStateChanged !== undefined) {\n\t\t\t\tthis.onCollapsibleStateChanged(e.state);\n\t\t\t}\n\t\t} else if (e.element === this.parent) {\n\t\t\tif (this.onParentCollapsibleStateChanged !== undefined) {\n\t\t\t\tthis.onParentCollapsibleStateChanged(e.state);\n\t\t\t}\n\t\t}\n\t}\n\n\t@debug()\n\tprotected onVisibilityChanged(e: TreeViewVisibilityChangeEvent) {\n\t\tvoid this.ensureSubscription();\n\n\t\tif (e.visible) {\n\t\t\tvoid this.triggerChange(this.requiresResetOnVisible);\n\t\t}\n\t}\n\n\t@gate()\n\t@debug()\n\tasync ensureSubscription() {\n\t\t// We only need to subscribe if we are visible and if auto-refresh enabled (when supported)\n\t\tif (!this.canSubscribe || !this.view.visible || (canAutoRefreshView(this.view) && !this.view.autoRefresh)) {\n\t\t\tawait this.unsubscribe();\n\n\t\t\treturn;\n\t\t}\n\n\t\t// If we already have a subscription, just kick out\n\t\tif (this.subscription != null) return;\n\n\t\tthis.subscription = Promise.resolve(this.subscribe());\n\t\tvoid (await this.subscription);\n\t}\n\n\t@gate()\n\t@debug()\n\tasync resetSubscription() {\n\t\tawait this.unsubscribe();\n\t\tawait this.ensureSubscription();\n\t}\n}\n\nexport abstract class RepositoryFolderNode<\n\tTView extends View = View,\n\tTChild extends ViewNode = ViewNode,\n> extends SubscribeableViewNode<TView> {\n\tstatic key = ':repository';\n\tstatic getId(repoPath: string): string {\n\t\treturn `gitlens${this.key}(${repoPath})`;\n\t}\n\n\tprotected override splatted = true;\n\tprotected child: TChild | undefined;\n\n\tconstructor(\n\t\turi: GitUri,\n\t\tview: TView,\n\t\tparent: ViewNode,\n\t\tpublic readonly repo: Repository,\n\t\tsplatted: boolean,\n\t\tprivate readonly options?: { showBranchAndLastFetched?: boolean },\n\t) {\n\t\tsuper(uri, view, parent);\n\n\t\tthis.splatted = splatted;\n\t}\n\n\toverride toClipboard(): string {\n\t\treturn this.repo.path;\n\t}\n\n\toverride get id(): string {\n\t\treturn RepositoryFolderNode.getId(this.repo.path);\n\t}\n\n\tasync getTreeItem(): Promise<TreeItem> {\n\t\tthis.splatted = false;\n\n\t\tconst branch = await this.repo.getBranch();\n\t\tconst ahead = (branch?.state.ahead ?? 0) > 0;\n\t\tconst behind = (branch?.state.behind ?? 0) > 0;\n\n\t\tconst expand = ahead || behind || this.repo.starred || this.view.container.git.isRepositoryForEditor(this.repo);\n\n\t\tconst item = new TreeItem(\n\t\t\tthis.repo.formattedName ?? this.uri.repoPath ?? '',\n\t\t\texpand ? TreeItemCollapsibleState.Expanded : TreeItemCollapsibleState.Collapsed,\n\t\t);\n\t\titem.contextValue = `${ContextValues.RepositoryFolder}${this.repo.starred ? '+starred' : ''}`;\n\t\tif (ahead) {\n\t\t\titem.contextValue += '+ahead';\n\t\t}\n\t\tif (behind) {\n\t\t\titem.contextValue += '+behind';\n\t\t}\n\n\t\tif (branch != null && this.options?.showBranchAndLastFetched) {\n\t\t\tconst lastFetched = (await this.repo.getLastFetched()) ?? 0;\n\n\t\t\tconst status = branch.getTrackingStatus();\n\t\t\titem.description = `${status ? `${status}${pad(GlyphChars.Dot, 1, 1)}` : ''}${branch.name}${\n\t\t\t\tlastFetched\n\t\t\t\t\t? `${pad(GlyphChars.Dot, 1, 1)}Last fetched ${Repository.formatLastFetched(lastFetched)}`\n\t\t\t\t\t: ''\n\t\t\t}`;\n\n\t\t\tlet providerName;\n\t\t\tif (branch.upstream != null) {\n\t\t\t\tconst providers = GitRemote.getHighlanderProviders(\n\t\t\t\t\tawait this.view.container.git.getRemotesWithProviders(branch.repoPath),\n\t\t\t\t);\n\t\t\t\tproviderName = providers?.length ? providers[0].name : undefined;\n\t\t\t} else {\n\t\t\t\tconst remote = await branch.getRemote();\n\t\t\t\tproviderName = remote?.provider?.name;\n\t\t\t}\n\n\t\t\titem.tooltip = new MarkdownString(\n\t\t\t\t`${this.repo.formattedName ?? this.uri.repoPath ?? ''}${\n\t\t\t\t\tlastFetched\n\t\t\t\t\t\t? `${pad(GlyphChars.Dash, 2, 2)}Last fetched ${Repository.formatLastFetched(\n\t\t\t\t\t\t\t\tlastFetched,\n\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t  )}`\n\t\t\t\t\t\t: ''\n\t\t\t\t}${this.repo.formattedName ? `\\n${this.uri.repoPath}` : ''}\\n\\nCurrent branch $(git-branch) ${\n\t\t\t\t\tbranch.name\n\t\t\t\t}${\n\t\t\t\t\tbranch.upstream != null\n\t\t\t\t\t\t? ` is ${branch.getTrackingStatus({\n\t\t\t\t\t\t\t\tempty: branch.upstream.missing\n\t\t\t\t\t\t\t\t\t? `missing upstream $(git-branch) ${branch.upstream.name}`\n\t\t\t\t\t\t\t\t\t: `up to date with $(git-branch) ${branch.upstream.name}${\n\t\t\t\t\t\t\t\t\t\t\tproviderName ? ` on ${providerName}` : ''\n\t\t\t\t\t\t\t\t\t  }`,\n\t\t\t\t\t\t\t\texpand: true,\n\t\t\t\t\t\t\t\ticons: true,\n\t\t\t\t\t\t\t\tseparator: ', ',\n\t\t\t\t\t\t\t\tsuffix: ` $(git-branch) ${branch.upstream.name}${\n\t\t\t\t\t\t\t\t\tproviderName ? ` on ${providerName}` : ''\n\t\t\t\t\t\t\t\t}`,\n\t\t\t\t\t\t  })}`\n\t\t\t\t\t\t: `hasn't been published to ${providerName ?? 'a remote'}`\n\t\t\t\t}`,\n\t\t\t\ttrue,\n\t\t\t);\n\t\t} else {\n\t\t\titem.tooltip = `${\n\t\t\t\tthis.repo.formattedName ? `${this.repo.formattedName}\\n${this.uri.repoPath}` : this.uri.repoPath ?? ''\n\t\t\t}`;\n\t\t}\n\n\t\treturn item;\n\t}\n\n\toverride async getSplattedChild() {\n\t\tif (this.child == null) {\n\t\t\tawait this.getChildren();\n\t\t}\n\n\t\treturn this.child;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride async refresh(reset: boolean = false) {\n\t\tawait this.child?.triggerChange(reset, false, this);\n\n\t\tawait this.ensureSubscription();\n\t}\n\n\t@log()\n\tasync star() {\n\t\tawait this.repo.star();\n\t\t// void this.parent!.triggerChange();\n\t}\n\n\t@log()\n\tasync unstar() {\n\t\tawait this.repo.unstar();\n\t\t// void this.parent!.triggerChange();\n\t}\n\n\t@debug()\n\tprotected subscribe(): Disposable | Promise<Disposable> {\n\t\treturn this.repo.onDidChange(this.onRepositoryChanged, this);\n\t}\n\n\tprotected override etag(): number {\n\t\treturn this.repo.etag;\n\t}\n\n\tprotected abstract changed(e: RepositoryChangeEvent): boolean;\n\n\t@debug<RepositoryFolderNode['onRepositoryChanged']>({ args: { 0: e => e.toString() } })\n\tprivate onRepositoryChanged(e: RepositoryChangeEvent) {\n\t\tif (e.changed(RepositoryChange.Closed, RepositoryChangeComparisonMode.Any)) {\n\t\t\tthis.dispose();\n\t\t\tvoid this.parent?.triggerChange(true);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.changed(RepositoryChange.Starred, RepositoryChangeComparisonMode.Any)) {\n\t\t\tvoid this.parent?.triggerChange(true);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.changed(e)) {\n\t\t\tvoid (this.loaded ? this : this.parent ?? this).triggerChange(true);\n\t\t}\n\t}\n}\n\nexport abstract class RepositoriesSubscribeableNode<\n\tTView extends View = View,\n\tTChild extends ViewNode & Disposable = ViewNode & Disposable,\n> extends SubscribeableViewNode<TView> {\n\tprotected override splatted = true;\n\tprotected children: TChild[] | undefined;\n\n\tconstructor(view: TView) {\n\t\tsuper(GitUri.unknown, view);\n\t}\n\n\toverride async getSplattedChild() {\n\t\tif (this.children == null) {\n\t\t\tawait this.getChildren();\n\t\t}\n\n\t\treturn this.children?.length === 1 ? this.children[0] : undefined;\n\t}\n\n\t@gate()\n\t@debug()\n\toverride refresh(reset: boolean = false) {\n\t\tif (reset && this.children != null) {\n\t\t\tfor (const child of this.children) {\n\t\t\t\tchild.dispose();\n\t\t\t}\n\t\t\tthis.children = undefined;\n\t\t}\n\t}\n\n\tprotected override etag(): number {\n\t\treturn szudzikPairing(this.view.container.git.etag, this.view.container.subscription.etag);\n\t}\n\n\t@debug()\n\tprotected subscribe(): Disposable | Promise<Disposable> {\n\t\treturn Disposable.from(\n\t\t\tthis.view.container.git.onDidChangeRepositories(this.onRepositoriesChanged, this),\n\t\t\tthis.view.container.subscription.onDidChange(this.onSubscriptionChanged, this),\n\t\t);\n\t}\n\n\tprivate onRepositoriesChanged(_e: RepositoriesChangeEvent) {\n\t\tvoid this.triggerChange(true);\n\t}\n\n\tprivate onSubscriptionChanged(e: SubscriptionChangeEvent) {\n\t\tif (e.current.plan !== e.previous.plan) {\n\t\t\tvoid this.triggerChange(true);\n\t\t}\n\t}\n}\n\ninterface AutoRefreshableView {\n\tautoRefresh: boolean;\n\tonDidChangeAutoRefresh: Event<void>;\n}\n\nexport function canAutoRefreshView(view: View): view is View & AutoRefreshableView {\n\treturn isA<View & AutoRefreshableView>(view, 'onDidChangeAutoRefresh');\n}\n\nexport function canClearNode(node: ViewNode): node is ViewNode & { clear(): void | Promise<void> } {\n\treturn typeof (node as ViewNode & { clear(): void | Promise<void> }).clear === 'function';\n}\n\nexport function canEditNode(node: ViewNode): node is ViewNode & { edit(): void | Promise<void> } {\n\treturn typeof (node as ViewNode & { edit(): void | Promise<void> }).edit === 'function';\n}\n\nexport function canViewDismissNode(view: View): view is View & { dismissNode(node: ViewNode): void } {\n\treturn typeof (view as View & { dismissNode(node: ViewNode): void }).dismissNode === 'function';\n}\n","import {\n\tCancellationToken,\n\tcommands,\n\tConfigurationChangeEvent,\n\tDisposable,\n\tProgressLocation,\n\tTreeItem,\n\tTreeItemCollapsibleState,\n\twindow,\n} from 'vscode';\nimport { configuration, RemotesViewConfig, ViewBranchesLayout, ViewFilesLayout } from '../configuration';\nimport { Commands } from '../constants';\nimport { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport {\n\tGitBranch,\n\tGitBranchReference,\n\tGitCommit,\n\tGitReference,\n\tGitRemote,\n\tGitRevisionReference,\n\tRepositoryChange,\n\tRepositoryChangeComparisonMode,\n\tRepositoryChangeEvent,\n} from '../git/models';\nimport { executeCommand } from '../system/command';\nimport { gate } from '../system/decorators/gate';\nimport {\n\tBranchNode,\n\tBranchOrTagFolderNode,\n\tRemoteNode,\n\tRemotesNode,\n\tRepositoriesSubscribeableNode,\n\tRepositoryFolderNode,\n\tRepositoryNode,\n\tViewNode,\n} from './nodes';\nimport { ViewBase } from './viewBase';\n\nexport class RemotesRepositoryNode extends RepositoryFolderNode<RemotesView, RemotesNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.child == null) {\n\t\t\tthis.child = new RemotesNode(this.uri, this.view, this, this.repo);\n\t\t}\n\n\t\treturn this.child.getChildren();\n\t}\n\n\tprotected changed(e: RepositoryChangeEvent) {\n\t\treturn e.changed(\n\t\t\tRepositoryChange.Config,\n\t\t\tRepositoryChange.Remotes,\n\t\t\tRepositoryChange.RemoteProviders,\n\t\t\tRepositoryChange.Unknown,\n\t\t\tRepositoryChangeComparisonMode.Any,\n\t\t);\n\t}\n}\n\nexport class RemotesViewNode extends RepositoriesSubscribeableNode<RemotesView, RemotesRepositoryNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.children == null) {\n\t\t\tconst repositories = this.view.container.git.openRepositories;\n\t\t\tif (repositories.length === 0) {\n\t\t\t\tthis.view.message = 'No remotes could be found.';\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\n\t\t\tconst splat = repositories.length === 1;\n\t\t\tthis.children = repositories.map(\n\t\t\t\tr => new RemotesRepositoryNode(GitUri.fromRepoPath(r.path), this.view, this, r, splat),\n\t\t\t);\n\t\t}\n\n\t\tif (this.children.length === 1) {\n\t\t\tconst [child] = this.children;\n\n\t\t\tconst remotes = await child.repo.getRemotes();\n\t\t\tif (remotes.length === 0) {\n\t\t\t\tthis.view.message = 'No remotes could be found.';\n\t\t\t\tthis.view.title = 'Remotes';\n\n\t\t\t\tvoid child.ensureSubscription();\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\t\t\tthis.view.title = `Remotes (${remotes.length})`;\n\n\t\t\treturn child.getChildren();\n\t\t}\n\n\t\treturn this.children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Remotes', TreeItemCollapsibleState.Expanded);\n\t\treturn item;\n\t}\n}\n\nexport class RemotesView extends ViewBase<RemotesViewNode, RemotesViewConfig> {\n\tprotected readonly configKey = 'remotes';\n\n\tconstructor(container: Container) {\n\t\tsuper('gitlens.views.remotes', 'Remotes', container);\n\t}\n\n\toverride get canReveal(): boolean {\n\t\treturn this.config.reveal || !configuration.get('views.repositories.showRemotes');\n\t}\n\n\tprotected getRoot() {\n\t\treturn new RemotesViewNode(this);\n\t}\n\n\tprotected registerCommands(): Disposable[] {\n\t\tvoid this.container.viewCommands;\n\n\t\treturn [\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('copy'),\n\t\t\t\t() => executeCommand(Commands.ViewsCopy, this.selection),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('refresh'),\n\t\t\t\t() => {\n\t\t\t\t\tthis.container.git.resetCaches('branches', 'remotes');\n\t\t\t\t\treturn this.refresh(true);\n\t\t\t\t},\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setLayoutToList'),\n\t\t\t\t() => this.setLayout(ViewBranchesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setLayoutToTree'),\n\t\t\t\t() => this.setLayout(ViewBranchesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToAuto'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Auto),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToList'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToTree'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOn'),\n\t\t\t\t() => this.setShowAvatars(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOff'),\n\t\t\t\t() => this.setShowAvatars(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchPullRequestOn'),\n\t\t\t\t() => this.setShowBranchPullRequest(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchPullRequestOff'),\n\t\t\t\t() => this.setShowBranchPullRequest(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\t}\n\n\tprotected override filterConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tconst changed = super.filterConfigurationChanged(e);\n\t\tif (\n\t\t\t!changed &&\n\t\t\t!configuration.changed(e, 'defaultDateFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateShortFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateSource') &&\n\t\t\t!configuration.changed(e, 'defaultDateStyle') &&\n\t\t\t!configuration.changed(e, 'defaultGravatarsStyle') &&\n\t\t\t!configuration.changed(e, 'defaultTimeFormat') &&\n\t\t\t!configuration.changed(e, 'integrations.enabled') &&\n\t\t\t!configuration.changed(e, 'sortBranchesBy')\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfindBranch(branch: GitBranchReference, token?: CancellationToken) {\n\t\tif (!branch.remote) return undefined;\n\n\t\tconst repoNodeId = RepositoryNode.getId(branch.repoPath);\n\n\t\treturn this.findNode((n: any) => n.branch?.ref === branch.ref, {\n\t\t\tallowPaging: true,\n\t\t\tmaxDepth: 5,\n\t\t\tcanTraverse: n => {\n\t\t\t\tif (n instanceof RemotesViewNode) return true;\n\n\t\t\t\tif (n instanceof RemotesRepositoryNode || n instanceof BranchOrTagFolderNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\tif (n instanceof RemoteNode) {\n\t\t\t\t\tif (!n.id.startsWith(repoNodeId)) return false;\n\n\t\t\t\t\treturn n.remote.name === GitBranch.getRemote(branch.name);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\tasync findCommit(commit: GitCommit | { repoPath: string; ref: string }, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(commit.repoPath);\n\n\t\t// Get all the remote branches the commit is on\n\t\tconst branches = await this.container.git.getCommitBranches(\n\t\t\tcommit.repoPath,\n\t\t\tcommit.ref,\n\t\t\tGitCommit.is(commit) ? { commitDate: commit.committer.date, remotes: true } : { remotes: true },\n\t\t);\n\t\tif (branches.length === 0) return undefined;\n\n\t\tconst remotes = branches.map(b => b.split('/', 1)[0]);\n\n\t\treturn this.findNode((n: any) => n.commit !== undefined && n.commit.ref === commit.ref, {\n\t\t\tallowPaging: true,\n\t\t\tmaxDepth: 6,\n\t\t\tcanTraverse: n => {\n\t\t\t\tif (n instanceof RemotesViewNode) return true;\n\n\t\t\t\tif (n instanceof RemotesRepositoryNode || n instanceof BranchOrTagFolderNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\tif (n instanceof RemoteNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId) && remotes.includes(n.remote.name);\n\t\t\t\t}\n\n\t\t\t\tif (n instanceof BranchNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId) && branches.includes(n.branch.name);\n\t\t\t\t}\n\n\t\t\t\tif (n instanceof RepositoryNode || n instanceof RemotesNode || n instanceof BranchOrTagFolderNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\tfindRemote(remote: GitRemote, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(remote.repoPath);\n\n\t\treturn this.findNode((n: any) => n.remote?.name === remote.name, {\n\t\t\tallowPaging: true,\n\t\t\tmaxDepth: 2,\n\t\t\tcanTraverse: n => {\n\t\t\t\tif (n instanceof RemotesViewNode) return true;\n\n\t\t\t\tif (n instanceof RemotesRepositoryNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\t@gate(() => '')\n\trevealBranch(\n\t\tbranch: GitBranchReference,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing ${GitReference.toString(branch, { icon: false, quoted: true })} in the side bar...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findBranch(branch, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\tasync revealCommit(\n\t\tcommit: GitRevisionReference,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing ${GitReference.toString(commit, { icon: false, quoted: true })} in the side bar...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findCommit(commit, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\trevealRemote(\n\t\tremote: GitRemote,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing remote '${remote.name}' in the side bar...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findRemote(remote, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\tasync revealRepository(\n\t\trepoPath: string,\n\t\toptions?: { select?: boolean; focus?: boolean; expand?: boolean | number },\n\t) {\n\t\tconst node = await this.findNode(RepositoryFolderNode.getId(repoPath), {\n\t\t\tmaxDepth: 1,\n\t\t\tcanTraverse: n => n instanceof RemotesViewNode || n instanceof RepositoryFolderNode,\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\tprivate setLayout(layout: ViewBranchesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.branches.layout` as const, layout);\n\t}\n\n\tprivate setFilesLayout(layout: ViewFilesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.files.layout` as const, layout);\n\t}\n\n\tprivate setShowAvatars(enabled: boolean) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.avatars` as const, enabled);\n\t}\n\n\tprivate async setShowBranchPullRequest(enabled: boolean) {\n\t\tawait configuration.updateEffective(`views.${this.configKey}.pullRequests.showForBranches` as const, enabled);\n\t\tawait configuration.updateEffective(`views.${this.configKey}.pullRequests.enabled` as const, enabled);\n\t}\n}\n","import {\n\tCancellationToken,\n\tcommands,\n\tConfigurationChangeEvent,\n\tDisposable,\n\tEvent,\n\tEventEmitter,\n\tProgressLocation,\n\twindow,\n} from 'vscode';\nimport {\n\tconfiguration,\n\tRepositoriesViewConfig,\n\tViewBranchesLayout,\n\tViewFilesLayout,\n\tViewShowBranchComparison,\n} from '../configuration';\nimport { Commands, ContextKeys } from '../constants';\nimport { Container } from '../container';\nimport { setContext } from '../context';\nimport {\n\tGitBranch,\n\tGitBranchReference,\n\tGitCommit,\n\tGitContributor,\n\tGitReference,\n\tGitRemote,\n\tGitRevisionReference,\n\tGitStashReference,\n\tGitTagReference,\n\tGitWorktree,\n} from '../git/models';\nimport { WorkspaceStorageKeys } from '../storage';\nimport { executeCommand } from '../system/command';\nimport { gate } from '../system/decorators/gate';\nimport {\n\tBranchesNode,\n\tBranchNode,\n\tBranchOrTagFolderNode,\n\tBranchTrackingStatusNode,\n\tCompareBranchNode,\n\tContributorNode,\n\tContributorsNode,\n\tReflogNode,\n\tRemoteNode,\n\tRemotesNode,\n\tRepositoriesNode,\n\tRepositoryNode,\n\tStashesNode,\n\tStashNode,\n\tTagsNode,\n\tWorktreeNode,\n\tWorktreesNode,\n} from './nodes';\nimport { ViewBase } from './viewBase';\n\nexport class RepositoriesView extends ViewBase<RepositoriesNode, RepositoriesViewConfig> {\n\tprotected readonly configKey = 'repositories';\n\n\tconstructor(container: Container) {\n\t\tsuper('gitlens.views.repositories', 'Repositories', container);\n\t}\n\n\tprivate _onDidChangeAutoRefresh = new EventEmitter<void>();\n\tget onDidChangeAutoRefresh(): Event<void> {\n\t\treturn this._onDidChangeAutoRefresh.event;\n\t}\n\n\tprotected getRoot() {\n\t\treturn new RepositoriesNode(this);\n\t}\n\n\tprotected registerCommands(): Disposable[] {\n\t\tvoid this.container.viewCommands;\n\n\t\treturn [\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('copy'),\n\t\t\t\t() => executeCommand(Commands.ViewsCopy, this.selection),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('refresh'),\n\t\t\t\t() => {\n\t\t\t\t\tthis.container.git.resetCaches('branches', 'contributors', 'remotes', 'stashes', 'status', 'tags');\n\t\t\t\t\treturn this.refresh(true);\n\t\t\t\t},\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setBranchesLayoutToList'),\n\t\t\t\t() => this.setBranchesLayout(ViewBranchesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setBranchesLayoutToTree'),\n\t\t\t\t() => this.setBranchesLayout(ViewBranchesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToAuto'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Auto),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToList'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToTree'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setAutoRefreshToOn'),\n\t\t\t\t() => this.setAutoRefresh(this.container.config.views.repositories.autoRefresh, true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setAutoRefreshToOff'),\n\t\t\t\t() => this.setAutoRefresh(this.container.config.views.repositories.autoRefresh, false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOn'),\n\t\t\t\t() => this.setShowAvatars(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOff'),\n\t\t\t\t() => this.setShowAvatars(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchComparisonOn'),\n\t\t\t\t() => this.setShowBranchComparison(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchComparisonOff'),\n\t\t\t\t() => this.setShowBranchComparison(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setBranchesShowBranchComparisonOn'),\n\t\t\t\t() => this.setBranchShowBranchComparison(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setBranchesShowBranchComparisonOff'),\n\t\t\t\t() => this.setBranchShowBranchComparison(false),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchesOn'),\n\t\t\t\t() => this.toggleSection('showBranches', true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchesOff'),\n\t\t\t\t() => this.toggleSection('showBranches', false),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowCommitsOn'),\n\t\t\t\t() => this.toggleSection('showCommits', true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowCommitsOff'),\n\t\t\t\t() => this.toggleSection('showCommits', false),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowContributorsOn'),\n\t\t\t\t() => this.toggleSection('showContributors', true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowContributorsOff'),\n\t\t\t\t() => this.toggleSection('showContributors', false),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowRemotesOn'),\n\t\t\t\t() => this.toggleSection('showRemotes', true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowRemotesOff'),\n\t\t\t\t() => this.toggleSection('showRemotes', false),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowStashesOn'),\n\t\t\t\t() => this.toggleSection('showStashes', true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowStashesOff'),\n\t\t\t\t() => this.toggleSection('showStashes', false),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowTagsOn'),\n\t\t\t\t() => this.toggleSection('showTags', true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowTagsOff'),\n\t\t\t\t() => this.toggleSection('showTags', false),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowWorktreesOn'),\n\t\t\t\t() => this.toggleSection('showWorktrees', true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowWorktreesOff'),\n\t\t\t\t() => this.toggleSection('showWorktrees', false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowUpstreamStatusOn'),\n\t\t\t\t() => this.toggleSection('showUpstreamStatus', true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowUpstreamStatusOff'),\n\t\t\t\t() => this.toggleSection('showUpstreamStatus', false),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowSectionOff'),\n\t\t\t\t(\n\t\t\t\t\tnode:\n\t\t\t\t\t\t| BranchesNode\n\t\t\t\t\t\t| BranchNode\n\t\t\t\t\t\t| BranchTrackingStatusNode\n\t\t\t\t\t\t| CompareBranchNode\n\t\t\t\t\t\t| ContributorsNode\n\t\t\t\t\t\t| ReflogNode\n\t\t\t\t\t\t| RemotesNode\n\t\t\t\t\t\t| StashesNode\n\t\t\t\t\t\t| TagsNode\n\t\t\t\t\t\t| WorktreesNode,\n\t\t\t\t) => this.toggleSectionByNode(node, false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\t}\n\n\tprotected override filterConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tconst changed = super.filterConfigurationChanged(e);\n\t\tif (\n\t\t\t!changed &&\n\t\t\t!configuration.changed(e, 'defaultDateFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateShortFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateSource') &&\n\t\t\t!configuration.changed(e, 'defaultDateStyle') &&\n\t\t\t!configuration.changed(e, 'defaultGravatarsStyle') &&\n\t\t\t!configuration.changed(e, 'defaultTimeFormat') &&\n\t\t\t!configuration.changed(e, 'sortBranchesBy') &&\n\t\t\t!configuration.changed(e, 'sortContributorsBy') &&\n\t\t\t!configuration.changed(e, 'sortTagsBy')\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\tprotected override onConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tif (configuration.changed(e, `views.${this.configKey}.autoRefresh` as const)) {\n\t\t\tvoid this.setAutoRefresh(this.container.config.views.repositories.autoRefresh);\n\t\t}\n\n\t\tsuper.onConfigurationChanged(e);\n\t}\n\n\tget autoRefresh() {\n\t\treturn (\n\t\t\tthis.config.autoRefresh &&\n\t\t\tthis.container.storage.getWorkspace<boolean>(WorkspaceStorageKeys.ViewsRepositoriesAutoRefresh, true)\n\t\t);\n\t}\n\n\tfindBranch(branch: GitBranchReference, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(branch.repoPath);\n\n\t\tif (branch.remote) {\n\t\t\treturn this.findNode((n: any) => n.branch !== undefined && n.branch.ref === branch.ref, {\n\t\t\t\tallowPaging: true,\n\t\t\t\tmaxDepth: 6,\n\t\t\t\tcanTraverse: n => {\n\t\t\t\t\t// Only search for branch nodes in the same repo within BranchesNode\n\t\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\t\tif (n instanceof RemoteNode) {\n\t\t\t\t\t\tif (!n.id.startsWith(repoNodeId)) return false;\n\n\t\t\t\t\t\treturn branch.remote && n.remote.name === GitBranch.getRemote(branch.name); //branch.getRemoteName();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tn instanceof RepositoryNode ||\n\t\t\t\t\t\tn instanceof BranchesNode ||\n\t\t\t\t\t\tn instanceof RemotesNode ||\n\t\t\t\t\t\tn instanceof BranchOrTagFolderNode\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\ttoken: token,\n\t\t\t});\n\t\t}\n\n\t\treturn this.findNode((n: any) => n.branch !== undefined && n.branch.ref === branch.ref, {\n\t\t\tallowPaging: true,\n\t\t\tmaxDepth: 5,\n\t\t\tcanTraverse: n => {\n\t\t\t\t// Only search for branch nodes in the same repo within BranchesNode\n\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\tif (n instanceof RepositoryNode || n instanceof BranchesNode || n instanceof BranchOrTagFolderNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\tasync findCommit(commit: GitCommit | { repoPath: string; ref: string }, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(commit.repoPath);\n\n\t\t// Get all the branches the commit is on\n\t\tlet branches = await this.container.git.getCommitBranches(\n\t\t\tcommit.repoPath,\n\t\t\tcommit.ref,\n\t\t\tGitCommit.is(commit) ? { commitDate: commit.committer.date } : undefined,\n\t\t);\n\t\tif (branches.length !== 0) {\n\t\t\treturn this.findNode((n: any) => n.commit !== undefined && n.commit.ref === commit.ref, {\n\t\t\t\tallowPaging: true,\n\t\t\t\tmaxDepth: 6,\n\t\t\t\tcanTraverse: async n => {\n\t\t\t\t\t// Only search for commit nodes in the same repo within BranchNodes\n\t\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\t\tif (n instanceof BranchNode) {\n\t\t\t\t\t\tif (n.id.startsWith(repoNodeId) && branches.includes(n.branch.name)) {\n\t\t\t\t\t\t\tawait n.loadMore({ until: commit.ref });\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tn instanceof RepositoryNode ||\n\t\t\t\t\t\tn instanceof BranchesNode ||\n\t\t\t\t\t\tn instanceof BranchOrTagFolderNode\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\ttoken: token,\n\t\t\t});\n\t\t}\n\n\t\t// If we didn't find the commit on any local branches, check remote branches\n\t\tbranches = await this.container.git.getCommitBranches(\n\t\t\tcommit.repoPath,\n\t\t\tcommit.ref,\n\t\t\tGitCommit.is(commit) ? { commitDate: commit.committer.date, remotes: true } : { remotes: true },\n\t\t);\n\t\tif (branches.length === 0) return undefined;\n\n\t\tconst remotes = branches.map(b => b.split('/', 1)[0]);\n\n\t\treturn this.findNode((n: any) => n.commit !== undefined && n.commit.ref === commit.ref, {\n\t\t\tallowPaging: true,\n\t\t\tmaxDepth: 8,\n\t\t\tcanTraverse: n => {\n\t\t\t\t// Only search for commit nodes in the same repo within BranchNode/RemoteNode\n\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\tif (n instanceof RemoteNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId) && remotes.includes(n.remote.name);\n\t\t\t\t}\n\n\t\t\t\tif (n instanceof BranchNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId) && branches.includes(n.branch.name);\n\t\t\t\t}\n\n\t\t\t\tif (n instanceof RepositoryNode || n instanceof RemotesNode || n instanceof BranchOrTagFolderNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\tfindContributor(contributor: GitContributor, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(contributor.repoPath);\n\n\t\treturn this.findNode(\n\t\t\tContributorNode.getId(contributor.repoPath, contributor.name, contributor.email, contributor.username),\n\t\t\t{\n\t\t\t\tmaxDepth: 2,\n\t\t\t\tcanTraverse: n => {\n\t\t\t\t\t// Only search for contributor nodes in the same repo within a ContributorsNode\n\t\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\t\tif (n instanceof RepositoryNode || n instanceof ContributorsNode) {\n\t\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\ttoken: token,\n\t\t\t},\n\t\t);\n\t}\n\n\tfindRemote(remote: GitRemote, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(remote.repoPath);\n\n\t\treturn this.findNode((n: any) => n.remote?.name === remote.name, {\n\t\t\tallowPaging: true,\n\t\t\tmaxDepth: 2,\n\t\t\tcanTraverse: n => {\n\t\t\t\t// Only search for remote nodes in the same repo within a RemotesNode\n\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\tif (n instanceof RepositoryNode || n instanceof RemotesNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\tfindStash(stash: GitStashReference, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(stash.repoPath);\n\n\t\treturn this.findNode(StashNode.getId(stash.repoPath, stash.ref), {\n\t\t\tmaxDepth: 3,\n\t\t\tcanTraverse: n => {\n\t\t\t\t// Only search for stash nodes in the same repo within a StashesNode\n\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\tif (n instanceof RepositoryNode || n instanceof StashesNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\tfindTag(tag: GitTagReference, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(tag.repoPath);\n\n\t\treturn this.findNode((n: any) => n.tag !== undefined && n.tag.ref === tag.ref, {\n\t\t\tallowPaging: true,\n\t\t\tmaxDepth: 5,\n\t\t\tcanTraverse: n => {\n\t\t\t\t// Only search for tag nodes in the same repo within TagsNode\n\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\tif (n instanceof RepositoryNode || n instanceof TagsNode || n instanceof BranchOrTagFolderNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\tfindWorktree(worktree: GitWorktree, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(worktree.repoPath);\n\n\t\treturn this.findNode(WorktreeNode.getId(worktree.repoPath, worktree.uri), {\n\t\t\tmaxDepth: 2,\n\t\t\tcanTraverse: n => {\n\t\t\t\t// Only search for worktree nodes in the same repo within WorktreesNode\n\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\tif (n instanceof RepositoryNode || n instanceof WorktreesNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\t@gate(() => '')\n\trevealBranch(\n\t\tbranch: GitBranchReference,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing ${GitReference.toString(branch, {\n\t\t\t\t\ticon: false,\n\t\t\t\t\tquoted: true,\n\t\t\t\t})} in the Repositories view...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findBranch(branch, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\tasync revealBranches(\n\t\trepoPath: string,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\tconst repoNodeId = RepositoryNode.getId(repoPath);\n\n\t\tconst node = await this.findNode(BranchesNode.getId(repoPath), {\n\t\t\tmaxDepth: 2,\n\t\t\tcanTraverse: n => {\n\t\t\t\t// Only search for branches nodes in the same repo\n\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\tif (n instanceof RepositoryNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t@gate(() => '')\n\tasync revealCommit(\n\t\tcommit: GitRevisionReference,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing ${GitReference.toString(commit, {\n\t\t\t\t\ticon: false,\n\t\t\t\t\tquoted: true,\n\t\t\t\t})} in the Repositories view...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findCommit(commit, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\tasync revealContributor(\n\t\tcontributor: GitContributor,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing contributor '${contributor.name} in the Repositories view...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findContributor(contributor, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\trevealRemote(\n\t\tremote: GitRemote,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing remote '${remote.name}' in the side bar...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findRemote(remote, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\tasync revealRepository(\n\t\trepoPath: string,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\tconst repoNodeId = RepositoryNode.getId(repoPath);\n\n\t\tconst node = await this.findNode(repoNodeId, {\n\t\t\tmaxDepth: 1,\n\t\t\tcanTraverse: n => n instanceof RepositoriesNode,\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t@gate(() => '')\n\tasync revealStash(\n\t\tstash: GitStashReference,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing ${GitReference.toString(stash, {\n\t\t\t\t\ticon: false,\n\t\t\t\t\tquoted: true,\n\t\t\t\t})} in the Repositories view...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findStash(stash, token);\n\t\t\t\tif (node !== undefined) {\n\t\t\t\t\tawait this.reveal(node, options);\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\tasync revealStashes(\n\t\trepoPath: string,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\tconst repoNodeId = RepositoryNode.getId(repoPath);\n\n\t\tconst node = await this.findNode(StashesNode.getId(repoPath), {\n\t\t\tmaxDepth: 2,\n\t\t\tcanTraverse: n => {\n\t\t\t\t// Only search for stashes nodes in the same repo\n\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\tif (n instanceof RepositoryNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t@gate(() => '')\n\trevealTag(\n\t\ttag: GitTagReference,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing ${GitReference.toString(tag, {\n\t\t\t\t\ticon: false,\n\t\t\t\t\tquoted: true,\n\t\t\t\t})} in the Repositories view...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findTag(tag, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\tasync revealTags(\n\t\trepoPath: string,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\tconst repoNodeId = RepositoryNode.getId(repoPath);\n\n\t\tconst node = await this.findNode(TagsNode.getId(repoPath), {\n\t\t\tmaxDepth: 2,\n\t\t\tcanTraverse: n => {\n\t\t\t\t// Only search for tags nodes in the same repo\n\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\tif (n instanceof RepositoryNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t@gate(() => '')\n\trevealWorktree(\n\t\tworktree: GitWorktree,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing worktree '${worktree.name}' in the side bar...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findWorktree(worktree, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\t@gate(() => '')\n\tasync revealWorktrees(\n\t\trepoPath: string,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\tconst repoNodeId = RepositoryNode.getId(repoPath);\n\n\t\tconst node = await this.findNode(WorktreesNode.getId(repoPath), {\n\t\t\tmaxDepth: 2,\n\t\t\tcanTraverse: n => {\n\t\t\t\t// Only search for worktrees nodes in the same repo\n\t\t\t\tif (n instanceof RepositoriesNode) return true;\n\n\t\t\t\tif (n instanceof RepositoryNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\tprivate async setAutoRefresh(enabled: boolean, workspaceEnabled?: boolean) {\n\t\tif (enabled) {\n\t\t\tif (workspaceEnabled === undefined) {\n\t\t\t\tworkspaceEnabled = this.container.storage.getWorkspace<boolean>(\n\t\t\t\t\tWorkspaceStorageKeys.ViewsRepositoriesAutoRefresh,\n\t\t\t\t\ttrue,\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tawait this.container.storage.storeWorkspace(\n\t\t\t\t\tWorkspaceStorageKeys.ViewsRepositoriesAutoRefresh,\n\t\t\t\t\tworkspaceEnabled,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tvoid setContext(ContextKeys.ViewsRepositoriesAutoRefresh, enabled && workspaceEnabled);\n\n\t\tthis._onDidChangeAutoRefresh.fire();\n\t}\n\n\tprivate setBranchesLayout(layout: ViewBranchesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.branches.layout` as const, layout);\n\t}\n\n\tprivate setFilesLayout(layout: ViewFilesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.files.layout` as const, layout);\n\t}\n\n\tprivate setShowAvatars(enabled: boolean) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.avatars` as const, enabled);\n\t}\n\n\tprivate setShowBranchComparison(enabled: boolean) {\n\t\treturn configuration.updateEffective(\n\t\t\t`views.${this.configKey}.showBranchComparison` as const,\n\t\t\tenabled ? ViewShowBranchComparison.Working : false,\n\t\t);\n\t}\n\n\tprivate setBranchShowBranchComparison(enabled: boolean) {\n\t\treturn configuration.updateEffective(\n\t\t\t`views.${this.configKey}.branches.showBranchComparison` as const,\n\t\t\tenabled ? ViewShowBranchComparison.Branch : false,\n\t\t);\n\t}\n\n\ttoggleSection(\n\t\tkey:\n\t\t\t| 'showBranches'\n\t\t\t| 'showCommits'\n\t\t\t| 'showContributors'\n\t\t\t// | 'showIncomingActivity'\n\t\t\t| 'showRemotes'\n\t\t\t| 'showStashes'\n\t\t\t| 'showTags'\n\t\t\t| 'showWorktrees'\n\t\t\t| 'showUpstreamStatus',\n\t\tenabled: boolean,\n\t) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.${key}` as const, enabled);\n\t}\n\n\ttoggleSectionByNode(\n\t\tnode:\n\t\t\t| BranchesNode\n\t\t\t| BranchNode\n\t\t\t| BranchTrackingStatusNode\n\t\t\t| CompareBranchNode\n\t\t\t| ContributorsNode\n\t\t\t| ReflogNode\n\t\t\t| RemotesNode\n\t\t\t| StashesNode\n\t\t\t| TagsNode\n\t\t\t| WorktreesNode,\n\t\tenabled: boolean,\n\t) {\n\t\tif (node instanceof BranchesNode) {\n\t\t\treturn configuration.updateEffective(`views.${this.configKey}.showBranches` as const, enabled);\n\t\t}\n\n\t\tif (node instanceof BranchNode) {\n\t\t\treturn configuration.updateEffective(`views.${this.configKey}.showCommits` as const, enabled);\n\t\t}\n\n\t\tif (node instanceof BranchTrackingStatusNode) {\n\t\t\treturn configuration.updateEffective(`views.${this.configKey}.showUpstreamStatus` as const, enabled);\n\t\t}\n\n\t\tif (node instanceof CompareBranchNode) {\n\t\t\treturn this.setShowBranchComparison(enabled);\n\t\t}\n\n\t\tif (node instanceof ContributorsNode) {\n\t\t\treturn configuration.updateEffective(`views.${this.configKey}.showContributors` as const, enabled);\n\t\t}\n\n\t\tif (node instanceof ReflogNode) {\n\t\t\treturn configuration.updateEffective(`views.${this.configKey}.showIncomingActivity` as const, enabled);\n\t\t}\n\n\t\tif (node instanceof RemotesNode) {\n\t\t\treturn configuration.updateEffective(`views.${this.configKey}.showRemotes` as const, enabled);\n\t\t}\n\n\t\tif (node instanceof StashesNode) {\n\t\t\treturn configuration.updateEffective(`views.${this.configKey}.showStashes` as const, enabled);\n\t\t}\n\n\t\tif (node instanceof TagsNode) {\n\t\t\treturn configuration.updateEffective(`views.${this.configKey}.showTags` as const, enabled);\n\t\t}\n\n\t\tif (node instanceof WorktreesNode) {\n\t\t\treturn configuration.updateEffective(`views.${this.configKey}.showWorktrees` as const, enabled);\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n}\n","import {\n\tCancellationToken,\n\tcommands,\n\tConfigurationChangeEvent,\n\tDisposable,\n\tProgressLocation,\n\tTreeItem,\n\tTreeItemCollapsibleState,\n\twindow,\n} from 'vscode';\nimport { configuration, TagsViewConfig, ViewBranchesLayout, ViewFilesLayout } from '../configuration';\nimport { Commands } from '../constants';\nimport { Container } from '../container';\nimport { GitUri } from '../git/gitUri';\nimport {\n\tGitReference,\n\tGitTagReference,\n\tRepositoryChange,\n\tRepositoryChangeComparisonMode,\n\tRepositoryChangeEvent,\n} from '../git/models';\nimport { executeCommand } from '../system/command';\nimport { gate } from '../system/decorators/gate';\nimport {\n\tBranchOrTagFolderNode,\n\tRepositoriesSubscribeableNode,\n\tRepositoryFolderNode,\n\tRepositoryNode,\n\tTagsNode,\n\tViewNode,\n} from './nodes';\nimport { ViewBase } from './viewBase';\n\nexport class TagsRepositoryNode extends RepositoryFolderNode<TagsView, TagsNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.child == null) {\n\t\t\tthis.child = new TagsNode(this.uri, this.view, this, this.repo);\n\t\t}\n\n\t\treturn this.child.getChildren();\n\t}\n\n\tprotected changed(e: RepositoryChangeEvent) {\n\t\treturn e.changed(RepositoryChange.Tags, RepositoryChange.Unknown, RepositoryChangeComparisonMode.Any);\n\t}\n}\n\nexport class TagsViewNode extends RepositoriesSubscribeableNode<TagsView, TagsRepositoryNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tif (this.children == null) {\n\t\t\tconst repositories = this.view.container.git.openRepositories;\n\t\t\tif (repositories.length === 0) {\n\t\t\t\tthis.view.message = 'No tags could be found.';\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\n\t\t\tconst splat = repositories.length === 1;\n\t\t\tthis.children = repositories.map(\n\t\t\t\tr => new TagsRepositoryNode(GitUri.fromRepoPath(r.path), this.view, this, r, splat),\n\t\t\t);\n\t\t}\n\n\t\tif (this.children.length === 1) {\n\t\t\tconst [child] = this.children;\n\n\t\t\tconst tags = await child.repo.getTags();\n\t\t\tif (tags.values.length === 0) {\n\t\t\t\tthis.view.message = 'No tags could be found.';\n\t\t\t\tthis.view.title = 'Tags';\n\n\t\t\t\tvoid child.ensureSubscription();\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\t\t\tthis.view.title = `Tags (${tags.values.length})`;\n\n\t\t\treturn child.getChildren();\n\t\t}\n\n\t\treturn this.children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Tags', TreeItemCollapsibleState.Expanded);\n\t\treturn item;\n\t}\n}\n\nexport class TagsView extends ViewBase<TagsViewNode, TagsViewConfig> {\n\tprotected readonly configKey = 'tags';\n\n\tconstructor(container: Container) {\n\t\tsuper('gitlens.views.tags', 'Tags', container);\n\t}\n\n\toverride get canReveal(): boolean {\n\t\treturn this.config.reveal || !configuration.get('views.repositories.showTags');\n\t}\n\n\tprotected getRoot() {\n\t\treturn new TagsViewNode(this);\n\t}\n\n\tprotected registerCommands(): Disposable[] {\n\t\tvoid this.container.viewCommands;\n\n\t\treturn [\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('copy'),\n\t\t\t\t() => executeCommand(Commands.ViewsCopy, this.selection),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('refresh'),\n\t\t\t\t() => {\n\t\t\t\t\tthis.container.git.resetCaches('tags');\n\t\t\t\t\treturn this.refresh(true);\n\t\t\t\t},\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setLayoutToList'),\n\t\t\t\t() => this.setLayout(ViewBranchesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setLayoutToTree'),\n\t\t\t\t() => this.setLayout(ViewBranchesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToAuto'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Auto),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToList'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToTree'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOn'),\n\t\t\t\t() => this.setShowAvatars(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOff'),\n\t\t\t\t() => this.setShowAvatars(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\t}\n\n\tprotected override filterConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tconst changed = super.filterConfigurationChanged(e);\n\t\tif (\n\t\t\t!changed &&\n\t\t\t!configuration.changed(e, 'defaultDateFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateShortFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateSource') &&\n\t\t\t!configuration.changed(e, 'defaultDateStyle') &&\n\t\t\t!configuration.changed(e, 'defaultGravatarsStyle') &&\n\t\t\t!configuration.changed(e, 'defaultTimeFormat') &&\n\t\t\t!configuration.changed(e, 'sortTagsBy')\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfindTag(tag: GitTagReference, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(tag.repoPath);\n\n\t\treturn this.findNode((n: any) => n.tag?.ref === tag.ref, {\n\t\t\tallowPaging: true,\n\t\t\tmaxDepth: 2,\n\t\t\tcanTraverse: n => {\n\t\t\t\tif (n instanceof TagsViewNode) return true;\n\n\t\t\t\tif (n instanceof TagsRepositoryNode || n instanceof BranchOrTagFolderNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\t@gate(() => '')\n\tasync revealRepository(\n\t\trepoPath: string,\n\t\toptions?: { select?: boolean; focus?: boolean; expand?: boolean | number },\n\t) {\n\t\tconst node = await this.findNode(RepositoryFolderNode.getId(repoPath), {\n\t\t\tmaxDepth: 1,\n\t\t\tcanTraverse: n => n instanceof TagsViewNode || n instanceof RepositoryFolderNode,\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t@gate(() => '')\n\trevealTag(\n\t\ttag: GitTagReference,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing ${GitReference.toString(tag, { icon: false, quoted: true })} in the side bar...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findTag(tag, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\tprivate setLayout(layout: ViewBranchesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.branches.layout` as const, layout);\n\t}\n\n\tprivate setFilesLayout(layout: ViewFilesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.files.layout` as const, layout);\n\t}\n\n\tprivate setShowAvatars(enabled: boolean) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.avatars` as const, enabled);\n\t}\n}\n","import {\n\tCancellationToken,\n\tConfigurationChangeEvent,\n\tDisposable,\n\tEvent,\n\tEventEmitter,\n\tMarkdownString,\n\tTreeDataProvider,\n\tTreeItem,\n\tTreeItemCollapsibleState,\n\tTreeView,\n\tTreeViewExpansionEvent,\n\tTreeViewVisibilityChangeEvent,\n\twindow,\n} from 'vscode';\nimport {\n\tBranchesViewConfig,\n\tCommitsViewConfig,\n\tconfiguration,\n\tContributorsViewConfig,\n\tFileHistoryViewConfig,\n\tLineHistoryViewConfig,\n\tRemotesViewConfig,\n\tRepositoriesViewConfig,\n\tSearchAndCompareViewConfig,\n\tStashesViewConfig,\n\tTagsViewConfig,\n\tViewsCommonConfig,\n\tviewsCommonConfigKeys,\n\tviewsConfigKeys,\n\tViewsConfigKeys,\n\tWorktreesViewConfig,\n} from '../configuration';\nimport { Container } from '../container';\nimport { Logger } from '../logger';\nimport { executeCommand } from '../system/command';\nimport { debug, log } from '../system/decorators/log';\nimport { once } from '../system/event';\nimport { debounce } from '../system/function';\nimport { cancellable, isPromise } from '../system/promise';\nimport { BranchesView } from './branchesView';\nimport { CommitsView } from './commitsView';\nimport { ContributorsView } from './contributorsView';\nimport { FileHistoryView } from './fileHistoryView';\nimport { LineHistoryView } from './lineHistoryView';\nimport { PageableViewNode, ViewNode } from './nodes';\nimport { RemotesView } from './remotesView';\nimport { RepositoriesView } from './repositoriesView';\nimport { SearchAndCompareView } from './searchAndCompareView';\nimport { StashesView } from './stashesView';\nimport { TagsView } from './tagsView';\nimport { WorktreesView } from './worktreesView';\n\nexport type View =\n\t| BranchesView\n\t| CommitsView\n\t| ContributorsView\n\t| FileHistoryView\n\t| LineHistoryView\n\t| RemotesView\n\t| RepositoriesView\n\t| SearchAndCompareView\n\t| StashesView\n\t| TagsView\n\t| WorktreesView;\nexport type ViewsWithCommits = Exclude<View, FileHistoryView | LineHistoryView | StashesView>;\nexport type ViewsWithRepositoryFolders = Exclude<View, RepositoriesView | FileHistoryView | LineHistoryView>;\n\nexport interface TreeViewNodeCollapsibleStateChangeEvent<T> extends TreeViewExpansionEvent<T> {\n\tstate: TreeItemCollapsibleState;\n}\n\nexport abstract class ViewBase<\n\tRootNode extends ViewNode<View>,\n\tViewConfig extends\n\t\t| BranchesViewConfig\n\t\t| ContributorsViewConfig\n\t\t| FileHistoryViewConfig\n\t\t| CommitsViewConfig\n\t\t| LineHistoryViewConfig\n\t\t| RemotesViewConfig\n\t\t| RepositoriesViewConfig\n\t\t| SearchAndCompareViewConfig\n\t\t| StashesViewConfig\n\t\t| TagsViewConfig\n\t\t| WorktreesViewConfig,\n> implements TreeDataProvider<ViewNode>, Disposable\n{\n\tprotected _onDidChangeTreeData = new EventEmitter<ViewNode | undefined>();\n\tget onDidChangeTreeData(): Event<ViewNode | undefined> {\n\t\treturn this._onDidChangeTreeData.event;\n\t}\n\n\tprivate _onDidChangeVisibility = new EventEmitter<TreeViewVisibilityChangeEvent>();\n\tget onDidChangeVisibility(): Event<TreeViewVisibilityChangeEvent> {\n\t\treturn this._onDidChangeVisibility.event;\n\t}\n\n\tprivate _onDidChangeNodeCollapsibleState = new EventEmitter<TreeViewNodeCollapsibleStateChangeEvent<ViewNode>>();\n\tget onDidChangeNodeCollapsibleState(): Event<TreeViewNodeCollapsibleStateChangeEvent<ViewNode>> {\n\t\treturn this._onDidChangeNodeCollapsibleState.event;\n\t}\n\n\tprotected disposables: Disposable[] = [];\n\tprotected root: RootNode | undefined;\n\tprotected tree: TreeView<ViewNode> | undefined;\n\n\tprivate readonly _lastKnownLimits = new Map<string, number | undefined>();\n\n\tconstructor(\n\t\tpublic readonly id: `gitlens.views.${string}`,\n\t\tpublic readonly name: string,\n\t\tpublic readonly container: Container,\n\t) {\n\t\tthis.disposables.push(once(container.onReady)(this.onReady, this));\n\n\t\tif (this.container.debugging || this.container.config.debug) {\n\t\t\tfunction addDebuggingInfo(item: TreeItem, node: ViewNode, parent: ViewNode | undefined) {\n\t\t\t\tif (item.tooltip == null) {\n\t\t\t\t\titem.tooltip = new MarkdownString(\n\t\t\t\t\t\titem.label != null && typeof item.label !== 'string' ? item.label.label : item.label ?? '',\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (typeof item.tooltip === 'string') {\n\t\t\t\t\titem.tooltip = `${item.tooltip}\\n\\n---\\ncontext: ${item.contextValue}\\nnode: ${node.toString()}${\n\t\t\t\t\t\tparent != null ? `\\nparent: ${parent.toString()}` : ''\n\t\t\t\t\t}`;\n\t\t\t\t} else {\n\t\t\t\t\titem.tooltip.appendMarkdown(\n\t\t\t\t\t\t`\\n\\n---\\n\\ncontext: \\`${item.contextValue}\\`\\\\\\nnode: \\`${node.toString()}\\`${\n\t\t\t\t\t\t\tparent != null ? `\\\\\\nparent: \\`${parent.toString()}\\`` : ''\n\t\t\t\t\t\t}`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst getTreeItemFn = this.getTreeItem;\n\t\t\tthis.getTreeItem = async function (this: ViewBase<RootNode, ViewConfig>, node: ViewNode) {\n\t\t\t\tconst item = await getTreeItemFn.apply(this, [node]);\n\n\t\t\t\tconst parent = node.getParent();\n\n\t\t\t\tif (node.resolveTreeItem != null) {\n\t\t\t\t\tif (item.tooltip != null) {\n\t\t\t\t\t\taddDebuggingInfo(item, node, parent);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst resolveTreeItemFn = node.resolveTreeItem;\n\t\t\t\t\tnode.resolveTreeItem = async function (this: ViewBase<RootNode, ViewConfig>, item: TreeItem) {\n\t\t\t\t\t\tconst resolvedItem = await resolveTreeItemFn.apply(this, [item]);\n\n\t\t\t\t\t\taddDebuggingInfo(resolvedItem, node, parent);\n\n\t\t\t\t\t\treturn resolvedItem;\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\taddDebuggingInfo(item, node, parent);\n\t\t\t\t}\n\n\t\t\t\treturn item;\n\t\t\t};\n\t\t}\n\n\t\tthis.disposables.push(...this.registerCommands());\n\t}\n\n\tdispose() {\n\t\tDisposable.from(...this.disposables).dispose();\n\t}\n\n\tprivate onReady() {\n\t\tthis.initialize({ showCollapseAll: this.showCollapseAll });\n\t\tqueueMicrotask(() => this.onConfigurationChanged());\n\t}\n\n\tget canReveal(): boolean {\n\t\treturn true;\n\t}\n\n\tprotected get showCollapseAll(): boolean {\n\t\treturn true;\n\t}\n\n\tprotected filterConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tif (!configuration.changed(e, 'views')) return false;\n\n\t\tif (configuration.changed(e, `views.${this.configKey}` as const)) return true;\n\t\tfor (const key of viewsCommonConfigKeys) {\n\t\t\tif (configuration.changed(e, `views.${key}` as const)) return true;\n\t\t}\n\n\t\treturn false;\n\t}\n\tprivate _title: string | undefined;\n\tget title(): string | undefined {\n\t\treturn this._title;\n\t}\n\tset title(value: string | undefined) {\n\t\tthis._title = value;\n\t\tif (this.tree != null) {\n\t\t\tthis.tree.title = value;\n\t\t}\n\t}\n\n\tprivate _description: string | undefined;\n\tget description(): string | undefined {\n\t\treturn this._description;\n\t}\n\tset description(value: string | undefined) {\n\t\tthis._description = value;\n\t\tif (this.tree != null) {\n\t\t\tthis.tree.description = value;\n\t\t}\n\t}\n\n\tprivate _message: string | undefined;\n\tget message(): string | undefined {\n\t\treturn this._message;\n\t}\n\tset message(value: string | undefined) {\n\t\tthis._message = value;\n\t\tif (this.tree != null) {\n\t\t\tthis.tree.message = value;\n\t\t}\n\t}\n\n\tgetQualifiedCommand(command: string) {\n\t\treturn `${this.id}.${command}`;\n\t}\n\n\tprotected abstract getRoot(): RootNode;\n\tprotected abstract registerCommands(): Disposable[];\n\tprotected onConfigurationChanged(e?: ConfigurationChangeEvent): void {\n\t\tif (e != null && this.root != null) {\n\t\t\tvoid this.refresh(true);\n\t\t}\n\t}\n\n\tprotected initialize(options: { showCollapseAll?: boolean } = {}) {\n\t\tthis.tree = window.createTreeView<ViewNode<View>>(this.id, {\n\t\t\t...options,\n\t\t\ttreeDataProvider: this,\n\t\t});\n\t\tthis.disposables.push(\n\t\t\tconfiguration.onDidChange(e => {\n\t\t\t\tif (!this.filterConfigurationChanged(e)) return;\n\n\t\t\t\tthis._config = undefined;\n\t\t\t\tthis.onConfigurationChanged(e);\n\t\t\t}, this),\n\t\t\tthis.tree,\n\t\t\tthis.tree.onDidChangeVisibility(debounce(this.onVisibilityChanged, 250), this),\n\t\t\tthis.tree.onDidCollapseElement(this.onElementCollapsed, this),\n\t\t\tthis.tree.onDidExpandElement(this.onElementExpanded, this),\n\t\t);\n\t\tthis._title = this.tree.title;\n\t}\n\n\tprotected ensureRoot(force: boolean = false) {\n\t\tif (this.root == null || force) {\n\t\t\tthis.root = this.getRoot();\n\t\t}\n\n\t\treturn this.root;\n\t}\n\n\tgetChildren(node?: ViewNode): ViewNode[] | Promise<ViewNode[]> {\n\t\tif (node != null) return node.getChildren();\n\n\t\tconst root = this.ensureRoot();\n\t\treturn root.getChildren();\n\t}\n\n\tgetParent(node: ViewNode): ViewNode | undefined {\n\t\treturn node.getParent();\n\t}\n\n\tgetTreeItem(node: ViewNode): TreeItem | Promise<TreeItem> {\n\t\treturn node.getTreeItem();\n\t}\n\n\tresolveTreeItem(item: TreeItem, node: ViewNode): TreeItem | Promise<TreeItem> {\n\t\treturn node.resolveTreeItem?.(item) ?? item;\n\t}\n\n\tprotected onElementCollapsed(e: TreeViewExpansionEvent<ViewNode>) {\n\t\tthis._onDidChangeNodeCollapsibleState.fire({ ...e, state: TreeItemCollapsibleState.Collapsed });\n\t}\n\n\tprotected onElementExpanded(e: TreeViewExpansionEvent<ViewNode>) {\n\t\tthis._onDidChangeNodeCollapsibleState.fire({ ...e, state: TreeItemCollapsibleState.Expanded });\n\t}\n\n\tprotected onVisibilityChanged(e: TreeViewVisibilityChangeEvent) {\n\t\tthis._onDidChangeVisibility.fire(e);\n\t}\n\n\tget selection(): readonly ViewNode[] {\n\t\tif (this.tree == null || this.root == null) return [];\n\n\t\treturn this.tree.selection;\n\t}\n\n\tget visible(): boolean {\n\t\treturn this.tree?.visible ?? false;\n\t}\n\n\tasync findNode(\n\t\tid: string,\n\t\toptions?: {\n\t\t\tallowPaging?: boolean;\n\t\t\tcanTraverse?: (node: ViewNode) => boolean | Promise<boolean>;\n\t\t\tmaxDepth?: number;\n\t\t\ttoken?: CancellationToken;\n\t\t},\n\t): Promise<ViewNode | undefined>;\n\tasync findNode(\n\t\tpredicate: (node: ViewNode) => boolean,\n\t\toptions?: {\n\t\t\tallowPaging?: boolean;\n\t\t\tcanTraverse?: (node: ViewNode) => boolean | Promise<boolean>;\n\t\t\tmaxDepth?: number;\n\t\t\ttoken?: CancellationToken;\n\t\t},\n\t): Promise<ViewNode | undefined>;\n\t@log<ViewBase<RootNode, ViewConfig>['findNode']>({\n\t\targs: {\n\t\t\t0: predicate => (typeof predicate === 'string' ? predicate : '<function>'),\n\t\t\t1: opts => `options=${JSON.stringify({ ...opts, canTraverse: undefined, token: undefined })}`,\n\t\t},\n\t})\n\tasync findNode(\n\t\tpredicate: string | ((node: ViewNode) => boolean),\n\t\t{\n\t\t\tallowPaging = false,\n\t\t\tcanTraverse,\n\t\t\tmaxDepth = 2,\n\t\t\ttoken,\n\t\t}: {\n\t\t\tallowPaging?: boolean;\n\t\t\tcanTraverse?: (node: ViewNode) => boolean | Promise<boolean>;\n\t\t\tmaxDepth?: number;\n\t\t\ttoken?: CancellationToken;\n\t\t} = {},\n\t): Promise<ViewNode | undefined> {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\tasync function find(this: ViewBase<RootNode, ViewConfig>) {\n\t\t\ttry {\n\t\t\t\tconst node = await this.findNodeCoreBFS(\n\t\t\t\t\ttypeof predicate === 'string' ? n => n.id === predicate : predicate,\n\t\t\t\t\tthis.ensureRoot(),\n\t\t\t\t\tallowPaging,\n\t\t\t\t\tcanTraverse,\n\t\t\t\t\tmaxDepth,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\n\t\t\t\treturn node;\n\t\t\t} catch (ex) {\n\t\t\t\tLogger.error(ex, cc);\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\n\t\tif (this.root != null) return find.call(this);\n\n\t\t// If we have no root (e.g. never been initialized) force it so the tree will load properly\n\t\tawait this.show({ preserveFocus: true });\n\t\t// Since we have to show the view, give the view time to load and let the callstack unwind before we try to find the node\n\t\treturn new Promise<ViewNode | undefined>(resolve => setTimeout(() => resolve(find.call(this)), 100));\n\t}\n\n\tprivate async findNodeCoreBFS(\n\t\tpredicate: (node: ViewNode) => boolean,\n\t\troot: ViewNode,\n\t\tallowPaging: boolean,\n\t\tcanTraverse: ((node: ViewNode) => boolean | Promise<boolean>) | undefined,\n\t\tmaxDepth: number,\n\t\ttoken: CancellationToken | undefined,\n\t): Promise<ViewNode | undefined> {\n\t\tconst queue: (ViewNode | undefined)[] = [root, undefined];\n\n\t\tconst defaultPageSize = this.container.config.advanced.maxListItems;\n\n\t\tlet depth = 0;\n\t\tlet node: ViewNode | undefined;\n\t\tlet children: ViewNode[];\n\t\tlet pagedChildren: ViewNode[];\n\t\twhile (queue.length > 1) {\n\t\t\tif (token?.isCancellationRequested) return undefined;\n\n\t\t\tnode = queue.shift();\n\t\t\tif (node == null) {\n\t\t\t\tdepth++;\n\n\t\t\t\tqueue.push(undefined);\n\t\t\t\tif (depth > maxDepth) break;\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (predicate(node)) return node;\n\t\t\tif (canTraverse != null) {\n\t\t\t\tconst traversable = canTraverse(node);\n\t\t\t\tif (isPromise(traversable)) {\n\t\t\t\t\tif (!(await traversable)) continue;\n\t\t\t\t} else if (!traversable) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tchildren = await node.getChildren();\n\t\t\tif (children.length === 0) continue;\n\n\t\t\twhile (node != null && !PageableViewNode.is(node)) {\n\t\t\t\tnode = await node.getSplattedChild?.();\n\t\t\t}\n\n\t\t\tif (node != null && PageableViewNode.is(node)) {\n\t\t\t\tlet child = children.find(predicate);\n\t\t\t\tif (child != null) return child;\n\n\t\t\t\tif (allowPaging && node.hasMore) {\n\t\t\t\t\twhile (true) {\n\t\t\t\t\t\tif (token?.isCancellationRequested) return undefined;\n\n\t\t\t\t\t\tawait this.loadMoreNodeChildren(node, defaultPageSize);\n\n\t\t\t\t\t\tpagedChildren = await cancellable(Promise.resolve(node.getChildren()), token ?? 60000, {\n\t\t\t\t\t\t\tonDidCancel: resolve => resolve([]),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tchild = pagedChildren.find(predicate);\n\t\t\t\t\t\tif (child != null) return child;\n\n\t\t\t\t\t\tif (!node.hasMore) break;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Don't traverse into paged children\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tqueue.push(...children);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprotected async ensureRevealNode(\n\t\tnode: ViewNode,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\t// Not sure why I need to reveal each parent, but without it the node won't be revealed\n\t\tconst nodes: ViewNode[] = [];\n\n\t\tlet parent: ViewNode | undefined = node;\n\t\twhile (parent != null) {\n\t\t\tnodes.push(parent);\n\t\t\tparent = parent.getParent();\n\t\t}\n\n\t\tif (nodes.length > 1) {\n\t\t\tnodes.pop();\n\t\t}\n\n\t\tfor (const n of nodes.reverse()) {\n\t\t\ttry {\n\t\t\t\tawait this.reveal(n, options);\n\t\t\t} catch {}\n\t\t}\n\t}\n\n\t@debug()\n\tasync refresh(reset: boolean = false) {\n\t\tawait this.root?.refresh?.(reset);\n\n\t\tthis.triggerNodeChange();\n\t}\n\n\t@debug<ViewBase<RootNode, ViewConfig>['refreshNode']>({ args: { 0: n => n.toString() } })\n\tasync refreshNode(node: ViewNode, reset: boolean = false, force: boolean = false) {\n\t\tconst cancel = await node.refresh?.(reset);\n\t\tif (!force && cancel === true) return;\n\n\t\tthis.triggerNodeChange(node);\n\t}\n\n\t@log<ViewBase<RootNode, ViewConfig>['reveal']>({ args: { 0: n => n.toString() } })\n\tasync reveal(\n\t\tnode: ViewNode,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\tif (this.tree == null) return;\n\n\t\ttry {\n\t\t\tawait this.tree.reveal(node, options);\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex);\n\t\t}\n\t}\n\n\t@log()\n\tasync show(options?: { preserveFocus?: boolean }) {\n\t\tconst cc = Logger.getCorrelationContext();\n\n\t\ttry {\n\t\t\tvoid (await executeCommand(`${this.id}.focus`, options));\n\t\t} catch (ex) {\n\t\t\tLogger.error(ex, cc);\n\t\t}\n\t}\n\n\t// @debug({ args: { 0: (n: ViewNode) => n.toString() }, singleLine: true })\n\tgetNodeLastKnownLimit(node: PageableViewNode) {\n\t\treturn this._lastKnownLimits.get(node.id);\n\t}\n\n\t@debug<ViewBase<RootNode, ViewConfig>['loadMoreNodeChildren']>({\n\t\targs: { 0: n => n.toString(), 2: n => n?.toString() },\n\t})\n\tasync loadMoreNodeChildren(\n\t\tnode: ViewNode & PageableViewNode,\n\t\tlimit: number | { until: string | undefined } | undefined,\n\t\tpreviousNode?: ViewNode,\n\t) {\n\t\tif (previousNode != null) {\n\t\t\tvoid (await this.reveal(previousNode, { select: true }));\n\t\t}\n\n\t\tawait node.loadMore(limit);\n\t\tthis._lastKnownLimits.set(node.id, node.limit);\n\t}\n\n\t@debug<ViewBase<RootNode, ViewConfig>['resetNodeLastKnownLimit']>({\n\t\targs: { 0: n => n.toString() },\n\t\tsingleLine: true,\n\t})\n\tresetNodeLastKnownLimit(node: PageableViewNode) {\n\t\tthis._lastKnownLimits.delete(node.id);\n\t}\n\n\t@debug<ViewBase<RootNode, ViewConfig>['triggerNodeChange']>({ args: { 0: n => n?.toString() } })\n\ttriggerNodeChange(node?: ViewNode) {\n\t\t// Since the root node won't actually refresh, force everything\n\t\tthis._onDidChangeTreeData.fire(node != null && node !== this.root ? node : undefined);\n\t}\n\n\tprotected abstract readonly configKey: ViewsConfigKeys;\n\n\tprivate _config: (ViewConfig & ViewsCommonConfig) | undefined;\n\tget config(): ViewConfig & ViewsCommonConfig {\n\t\tif (this._config == null) {\n\t\t\tconst cfg = { ...this.container.config.views };\n\t\t\tfor (const view of viewsConfigKeys) {\n\t\t\t\tdelete cfg[view];\n\t\t\t}\n\n\t\t\tthis._config = {\n\t\t\t\t...(cfg as ViewsCommonConfig),\n\t\t\t\t...(this.container.config.views[this.configKey] as ViewConfig),\n\t\t\t};\n\t\t}\n\n\t\treturn this._config;\n\t}\n}\n","import {\n\tCancellationToken,\n\tcommands,\n\tConfigurationChangeEvent,\n\tDisposable,\n\tProgressLocation,\n\tThemeColor,\n\tTreeItem,\n\tTreeItemCollapsibleState,\n\tTreeViewVisibilityChangeEvent,\n\twindow,\n} from 'vscode';\nimport { configuration, ViewFilesLayout, ViewShowBranchComparison, WorktreesViewConfig } from '../configuration';\nimport { Container } from '../container';\nimport { PremiumFeatures } from '../features';\nimport { GitUri } from '../git/gitUri';\nimport { GitWorktree, RepositoryChange, RepositoryChangeComparisonMode, RepositoryChangeEvent } from '../git/models';\nimport { getSubscriptionTimeRemaining, SubscriptionState } from '../subscription';\nimport { gate } from '../system/decorators/gate';\nimport { pluralize } from '../system/string';\nimport {\n\tRepositoriesSubscribeableNode,\n\tRepositoryFolderNode,\n\tRepositoryNode,\n\tViewNode,\n\tWorktreeNode,\n\tWorktreesNode,\n} from './nodes';\nimport { ViewBase } from './viewBase';\n\nexport class WorktreesRepositoryNode extends RepositoryFolderNode<WorktreesView, WorktreesNode> {\n\tgetChildren(): Promise<ViewNode[]> {\n\t\tif (this.child == null) {\n\t\t\tthis.child = new WorktreesNode(this.uri, this.view, this, this.repo);\n\t\t}\n\n\t\treturn this.child.getChildren();\n\t}\n\n\tprotected changed(e: RepositoryChangeEvent) {\n\t\treturn e.changed(\n\t\t\tRepositoryChange.Config,\n\t\t\tRepositoryChange.Worktrees,\n\t\t\tRepositoryChange.Unknown,\n\t\t\tRepositoryChangeComparisonMode.Any,\n\t\t);\n\t}\n}\n\nexport class WorktreesViewNode extends RepositoriesSubscribeableNode<WorktreesView, WorktreesRepositoryNode> {\n\tasync getChildren(): Promise<ViewNode[]> {\n\t\tconst access = await this.view.container.git.access(PremiumFeatures.Worktrees);\n\t\tif (!access.allowed) return [];\n\n\t\tif (this.children == null) {\n\t\t\tconst repositories = this.view.container.git.openRepositories;\n\t\t\tif (repositories.length === 0) {\n\t\t\t\tthis.view.message = 'No worktrees could be found.';\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\n\t\t\tconst splat = repositories.length === 1;\n\t\t\tthis.children = repositories.map(\n\t\t\t\tr => new WorktreesRepositoryNode(GitUri.fromRepoPath(r.path), this.view, this, r, splat),\n\t\t\t);\n\t\t}\n\n\t\tif (this.children.length === 1) {\n\t\t\tconst [child] = this.children;\n\n\t\t\tconst children = await child.getChildren();\n\t\t\tif (children.length <= 1) {\n\t\t\t\tthis.view.message = undefined;\n\t\t\t\tthis.view.title = 'Worktrees';\n\n\t\t\t\tvoid child.ensureSubscription();\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tthis.view.message = undefined;\n\t\t\tthis.view.title = `Worktrees (${children.length})`;\n\n\t\t\treturn children;\n\t\t}\n\n\t\treturn this.children;\n\t}\n\n\tgetTreeItem(): TreeItem {\n\t\tconst item = new TreeItem('Worktrees', TreeItemCollapsibleState.Expanded);\n\t\treturn item;\n\t}\n}\n\nexport class WorktreesView extends ViewBase<WorktreesViewNode, WorktreesViewConfig> {\n\tprotected readonly configKey = 'worktrees';\n\n\tconstructor(container: Container) {\n\t\tsuper('gitlens.views.worktrees', 'Worktrees', container);\n\n\t\tthis.disposables.push(\n\t\t\twindow.registerFileDecorationProvider({\n\t\t\t\tprovideFileDecoration: (uri, _token) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\turi.scheme !== 'gitlens-view' ||\n\t\t\t\t\t\turi.authority !== 'worktree' ||\n\t\t\t\t\t\t!uri.path.includes('/changes')\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tbadge: '',\n\t\t\t\t\t\tcolor: new ThemeColor('gitlens.decorations.worktreeView.hasUncommittedChangesForegroundColor'),\n\t\t\t\t\t\ttooltip: 'Has Uncommitted Changes',\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}\n\n\toverride get canReveal(): boolean {\n\t\treturn this.config.reveal || !configuration.get('views.repositories.showWorktrees');\n\t}\n\n\tprivate _visibleDisposable: Disposable | undefined;\n\tprotected override onVisibilityChanged(e: TreeViewVisibilityChangeEvent): void {\n\t\tif (e.visible) {\n\t\t\tvoid this.updateDescription();\n\t\t\tthis._visibleDisposable?.dispose();\n\t\t\tthis._visibleDisposable = this.container.subscription.onDidChange(() => void this.updateDescription());\n\t\t} else {\n\t\t\tthis._visibleDisposable?.dispose();\n\t\t\tthis._visibleDisposable = undefined;\n\t\t}\n\n\t\tsuper.onVisibilityChanged(e);\n\t}\n\n\tprivate async updateDescription() {\n\t\tconst subscription = await this.container.subscription.getSubscription();\n\n\t\tswitch (subscription.state) {\n\t\t\tcase SubscriptionState.Free:\n\t\t\tcase SubscriptionState.FreePreviewExpired:\n\t\t\tcase SubscriptionState.VerificationRequired:\n\t\t\t\tthis.description = ' premium feature';\n\t\t\t\tbreak;\n\t\t\tcase SubscriptionState.FreeInPreview: {\n\t\t\t\tconst days = getSubscriptionTimeRemaining(subscription, 'days')!;\n\t\t\t\tthis.description = ` ${pluralize('more day', days)} to try worktrees on public and private repos`;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase SubscriptionState.FreePlusInTrial: {\n\t\t\t\tconst days = getSubscriptionTimeRemaining(subscription, 'days')!;\n\t\t\t\tthis.description = ` ${pluralize('more day', days)} to try worktrees on private repos`;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase SubscriptionState.FreePlusTrialExpired:\n\t\t\tcase SubscriptionState.Paid:\n\t\t\t\tthis.description = undefined;\n\t\t}\n\t}\n\n\tprotected getRoot() {\n\t\treturn new WorktreesViewNode(this);\n\t}\n\n\tprotected registerCommands(): Disposable[] {\n\t\tvoid this.container.viewCommands;\n\n\t\treturn [\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('copy'),\n\t\t\t\t() => commands.executeCommand('gitlens.views.copy', this.selection),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('refresh'),\n\t\t\t\tasync () => {\n\t\t\t\t\t// this.container.git.resetCaches('worktrees');\n\t\t\t\t\treturn this.refresh(true);\n\t\t\t\t},\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToAuto'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Auto),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToList'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.List),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setFilesLayoutToTree'),\n\t\t\t\t() => this.setFilesLayout(ViewFilesLayout.Tree),\n\t\t\t\tthis,\n\t\t\t),\n\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOn'),\n\t\t\t\t() => this.setShowAvatars(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowAvatarsOff'),\n\t\t\t\t() => this.setShowAvatars(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchComparisonOn'),\n\t\t\t\t() => this.setShowBranchComparison(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchComparisonOff'),\n\t\t\t\t() => this.setShowBranchComparison(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchPullRequestOn'),\n\t\t\t\t() => this.setShowBranchPullRequest(true),\n\t\t\t\tthis,\n\t\t\t),\n\t\t\tcommands.registerCommand(\n\t\t\t\tthis.getQualifiedCommand('setShowBranchPullRequestOff'),\n\t\t\t\t() => this.setShowBranchPullRequest(false),\n\t\t\t\tthis,\n\t\t\t),\n\t\t];\n\t}\n\n\tprotected override filterConfigurationChanged(e: ConfigurationChangeEvent) {\n\t\tconst changed = super.filterConfigurationChanged(e);\n\t\tif (\n\t\t\t!changed &&\n\t\t\t!configuration.changed(e, 'defaultDateFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateShortFormat') &&\n\t\t\t!configuration.changed(e, 'defaultDateSource') &&\n\t\t\t!configuration.changed(e, 'defaultDateStyle') &&\n\t\t\t!configuration.changed(e, 'defaultGravatarsStyle') &&\n\t\t\t!configuration.changed(e, 'defaultTimeFormat')\n\t\t\t// !configuration.changed(e, 'sortWorktreesBy')\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfindWorktree(worktree: GitWorktree, token?: CancellationToken) {\n\t\tconst repoNodeId = RepositoryNode.getId(worktree.repoPath);\n\n\t\treturn this.findNode(WorktreeNode.getId(worktree.repoPath, worktree.uri), {\n\t\t\tmaxDepth: 2,\n\t\t\tcanTraverse: n => {\n\t\t\t\tif (n instanceof WorktreesViewNode) return true;\n\n\t\t\t\tif (n instanceof WorktreesRepositoryNode) {\n\t\t\t\t\treturn n.id.startsWith(repoNodeId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\ttoken: token,\n\t\t});\n\t}\n\n\t@gate(() => '')\n\tasync revealRepository(\n\t\trepoPath: string,\n\t\toptions?: { select?: boolean; focus?: boolean; expand?: boolean | number },\n\t) {\n\t\tconst node = await this.findNode(RepositoryFolderNode.getId(repoPath), {\n\t\t\tmaxDepth: 1,\n\t\t\tcanTraverse: n => n instanceof WorktreesViewNode || n instanceof RepositoryFolderNode,\n\t\t});\n\n\t\tif (node !== undefined) {\n\t\t\tawait this.reveal(node, options);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t@gate(() => '')\n\trevealWorktree(\n\t\tworktree: GitWorktree,\n\t\toptions?: {\n\t\t\tselect?: boolean;\n\t\t\tfocus?: boolean;\n\t\t\texpand?: boolean | number;\n\t\t},\n\t) {\n\t\treturn window.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Revealing worktree '${worktree.name}' in the side bar...`,\n\t\t\t\tcancellable: true,\n\t\t\t},\n\t\t\tasync (progress, token) => {\n\t\t\t\tconst node = await this.findWorktree(worktree, token);\n\t\t\t\tif (node == null) return undefined;\n\n\t\t\t\tawait this.ensureRevealNode(node, options);\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t);\n\t}\n\n\tprivate setFilesLayout(layout: ViewFilesLayout) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.files.layout` as const, layout);\n\t}\n\n\tprivate setShowAvatars(enabled: boolean) {\n\t\treturn configuration.updateEffective(`views.${this.configKey}.avatars` as const, enabled);\n\t}\n\n\tprivate setShowBranchComparison(enabled: boolean) {\n\t\treturn configuration.updateEffective(\n\t\t\t`views.${this.configKey}.showBranchComparison` as const,\n\t\t\tenabled ? ViewShowBranchComparison.Branch : false,\n\t\t);\n\t}\n\n\tprivate async setShowBranchPullRequest(enabled: boolean) {\n\t\tawait configuration.updateEffective(`views.${this.configKey}.pullRequests.showForBranches` as const, enabled);\n\t\tawait configuration.updateEffective(`views.${this.configKey}.pullRequests.enabled` as const, enabled);\n\t}\n}\n","\"use strict\";\nvar Buffer = require(\"safer-buffer\").Buffer;\n\n// Multibyte codec. In this scheme, a character is represented by 1 or more bytes.\n// Our codec supports UTF-16 surrogates, extensions for GB18030 and unicode sequences.\n// To save memory and loading time, we read table files only when requested.\n\nexports._dbcs = DBCSCodec;\n\nvar UNASSIGNED = -1,\n    GB18030_CODE = -2,\n    SEQ_START  = -10,\n    NODE_START = -1000,\n    UNASSIGNED_NODE = new Array(0x100),\n    DEF_CHAR = -1;\n\nfor (var i = 0; i < 0x100; i++)\n    UNASSIGNED_NODE[i] = UNASSIGNED;\n\n\n// Class DBCSCodec reads and initializes mapping tables.\nfunction DBCSCodec(codecOptions, iconv) {\n    this.encodingName = codecOptions.encodingName;\n    if (!codecOptions)\n        throw new Error(\"DBCS codec is called without the data.\")\n    if (!codecOptions.table)\n        throw new Error(\"Encoding '\" + this.encodingName + \"' has no data.\");\n\n    // Load tables.\n    var mappingTable = codecOptions.table();\n\n\n    // Decode tables: MBCS -> Unicode.\n\n    // decodeTables is a trie, encoded as an array of arrays of integers. Internal arrays are trie nodes and all have len = 256.\n    // Trie root is decodeTables[0].\n    // Values: >=  0 -> unicode character code. can be > 0xFFFF\n    //         == UNASSIGNED -> unknown/unassigned sequence.\n    //         == GB18030_CODE -> this is the end of a GB18030 4-byte sequence.\n    //         <= NODE_START -> index of the next node in our trie to process next byte.\n    //         <= SEQ_START  -> index of the start of a character code sequence, in decodeTableSeq.\n    this.decodeTables = [];\n    this.decodeTables[0] = UNASSIGNED_NODE.slice(0); // Create root node.\n\n    // Sometimes a MBCS char corresponds to a sequence of unicode chars. We store them as arrays of integers here. \n    this.decodeTableSeq = [];\n\n    // Actual mapping tables consist of chunks. Use them to fill up decode tables.\n    for (var i = 0; i < mappingTable.length; i++)\n        this._addDecodeChunk(mappingTable[i]);\n\n    // Load & create GB18030 tables when needed.\n    if (typeof codecOptions.gb18030 === 'function') {\n        this.gb18030 = codecOptions.gb18030(); // Load GB18030 ranges.\n\n        // Add GB18030 common decode nodes.\n        var commonThirdByteNodeIdx = this.decodeTables.length;\n        this.decodeTables.push(UNASSIGNED_NODE.slice(0));\n\n        var commonFourthByteNodeIdx = this.decodeTables.length;\n        this.decodeTables.push(UNASSIGNED_NODE.slice(0));\n\n        // Fill out the tree\n        var firstByteNode = this.decodeTables[0];\n        for (var i = 0x81; i <= 0xFE; i++) {\n            var secondByteNode = this.decodeTables[NODE_START - firstByteNode[i]];\n            for (var j = 0x30; j <= 0x39; j++) {\n                if (secondByteNode[j] === UNASSIGNED) {\n                    secondByteNode[j] = NODE_START - commonThirdByteNodeIdx;\n                } else if (secondByteNode[j] > NODE_START) {\n                    throw new Error(\"gb18030 decode tables conflict at byte 2\");\n                }\n\n                var thirdByteNode = this.decodeTables[NODE_START - secondByteNode[j]];\n                for (var k = 0x81; k <= 0xFE; k++) {\n                    if (thirdByteNode[k] === UNASSIGNED) {\n                        thirdByteNode[k] = NODE_START - commonFourthByteNodeIdx;\n                    } else if (thirdByteNode[k] === NODE_START - commonFourthByteNodeIdx) {\n                        continue;\n                    } else if (thirdByteNode[k] > NODE_START) {\n                        throw new Error(\"gb18030 decode tables conflict at byte 3\");\n                    }\n\n                    var fourthByteNode = this.decodeTables[NODE_START - thirdByteNode[k]];\n                    for (var l = 0x30; l <= 0x39; l++) {\n                        if (fourthByteNode[l] === UNASSIGNED)\n                            fourthByteNode[l] = GB18030_CODE;\n                    }\n                }\n            }\n        }\n    }\n\n    this.defaultCharUnicode = iconv.defaultCharUnicode;\n\n    \n    // Encode tables: Unicode -> DBCS.\n\n    // `encodeTable` is array mapping from unicode char to encoded char. All its values are integers for performance.\n    // Because it can be sparse, it is represented as array of buckets by 256 chars each. Bucket can be null.\n    // Values: >=  0 -> it is a normal char. Write the value (if <=256 then 1 byte, if <=65536 then 2 bytes, etc.).\n    //         == UNASSIGNED -> no conversion found. Output a default char.\n    //         <= SEQ_START  -> it's an index in encodeTableSeq, see below. The character starts a sequence.\n    this.encodeTable = [];\n    \n    // `encodeTableSeq` is used when a sequence of unicode characters is encoded as a single code. We use a tree of\n    // objects where keys correspond to characters in sequence and leafs are the encoded dbcs values. A special DEF_CHAR key\n    // means end of sequence (needed when one sequence is a strict subsequence of another).\n    // Objects are kept separately from encodeTable to increase performance.\n    this.encodeTableSeq = [];\n\n    // Some chars can be decoded, but need not be encoded.\n    var skipEncodeChars = {};\n    if (codecOptions.encodeSkipVals)\n        for (var i = 0; i < codecOptions.encodeSkipVals.length; i++) {\n            var val = codecOptions.encodeSkipVals[i];\n            if (typeof val === 'number')\n                skipEncodeChars[val] = true;\n            else\n                for (var j = val.from; j <= val.to; j++)\n                    skipEncodeChars[j] = true;\n        }\n        \n    // Use decode trie to recursively fill out encode tables.\n    this._fillEncodeTable(0, 0, skipEncodeChars);\n\n    // Add more encoding pairs when needed.\n    if (codecOptions.encodeAdd) {\n        for (var uChar in codecOptions.encodeAdd)\n            if (Object.prototype.hasOwnProperty.call(codecOptions.encodeAdd, uChar))\n                this._setEncodeChar(uChar.charCodeAt(0), codecOptions.encodeAdd[uChar]);\n    }\n\n    this.defCharSB  = this.encodeTable[0][iconv.defaultCharSingleByte.charCodeAt(0)];\n    if (this.defCharSB === UNASSIGNED) this.defCharSB = this.encodeTable[0]['?'];\n    if (this.defCharSB === UNASSIGNED) this.defCharSB = \"?\".charCodeAt(0);\n}\n\nDBCSCodec.prototype.encoder = DBCSEncoder;\nDBCSCodec.prototype.decoder = DBCSDecoder;\n\n// Decoder helpers\nDBCSCodec.prototype._getDecodeTrieNode = function(addr) {\n    var bytes = [];\n    for (; addr > 0; addr >>>= 8)\n        bytes.push(addr & 0xFF);\n    if (bytes.length == 0)\n        bytes.push(0);\n\n    var node = this.decodeTables[0];\n    for (var i = bytes.length-1; i > 0; i--) { // Traverse nodes deeper into the trie.\n        var val = node[bytes[i]];\n\n        if (val == UNASSIGNED) { // Create new node.\n            node[bytes[i]] = NODE_START - this.decodeTables.length;\n            this.decodeTables.push(node = UNASSIGNED_NODE.slice(0));\n        }\n        else if (val <= NODE_START) { // Existing node.\n            node = this.decodeTables[NODE_START - val];\n        }\n        else\n            throw new Error(\"Overwrite byte in \" + this.encodingName + \", addr: \" + addr.toString(16));\n    }\n    return node;\n}\n\n\nDBCSCodec.prototype._addDecodeChunk = function(chunk) {\n    // First element of chunk is the hex mbcs code where we start.\n    var curAddr = parseInt(chunk[0], 16);\n\n    // Choose the decoding node where we'll write our chars.\n    var writeTable = this._getDecodeTrieNode(curAddr);\n    curAddr = curAddr & 0xFF;\n\n    // Write all other elements of the chunk to the table.\n    for (var k = 1; k < chunk.length; k++) {\n        var part = chunk[k];\n        if (typeof part === \"string\") { // String, write as-is.\n            for (var l = 0; l < part.length;) {\n                var code = part.charCodeAt(l++);\n                if (0xD800 <= code && code < 0xDC00) { // Decode surrogate\n                    var codeTrail = part.charCodeAt(l++);\n                    if (0xDC00 <= codeTrail && codeTrail < 0xE000)\n                        writeTable[curAddr++] = 0x10000 + (code - 0xD800) * 0x400 + (codeTrail - 0xDC00);\n                    else\n                        throw new Error(\"Incorrect surrogate pair in \"  + this.encodingName + \" at chunk \" + chunk[0]);\n                }\n                else if (0x0FF0 < code && code <= 0x0FFF) { // Character sequence (our own encoding used)\n                    var len = 0xFFF - code + 2;\n                    var seq = [];\n                    for (var m = 0; m < len; m++)\n                        seq.push(part.charCodeAt(l++)); // Simple variation: don't support surrogates or subsequences in seq.\n\n                    writeTable[curAddr++] = SEQ_START - this.decodeTableSeq.length;\n                    this.decodeTableSeq.push(seq);\n                }\n                else\n                    writeTable[curAddr++] = code; // Basic char\n            }\n        } \n        else if (typeof part === \"number\") { // Integer, meaning increasing sequence starting with prev character.\n            var charCode = writeTable[curAddr - 1] + 1;\n            for (var l = 0; l < part; l++)\n                writeTable[curAddr++] = charCode++;\n        }\n        else\n            throw new Error(\"Incorrect type '\" + typeof part + \"' given in \"  + this.encodingName + \" at chunk \" + chunk[0]);\n    }\n    if (curAddr > 0xFF)\n        throw new Error(\"Incorrect chunk in \"  + this.encodingName + \" at addr \" + chunk[0] + \": too long\" + curAddr);\n}\n\n// Encoder helpers\nDBCSCodec.prototype._getEncodeBucket = function(uCode) {\n    var high = uCode >> 8; // This could be > 0xFF because of astral characters.\n    if (this.encodeTable[high] === undefined)\n        this.encodeTable[high] = UNASSIGNED_NODE.slice(0); // Create bucket on demand.\n    return this.encodeTable[high];\n}\n\nDBCSCodec.prototype._setEncodeChar = function(uCode, dbcsCode) {\n    var bucket = this._getEncodeBucket(uCode);\n    var low = uCode & 0xFF;\n    if (bucket[low] <= SEQ_START)\n        this.encodeTableSeq[SEQ_START-bucket[low]][DEF_CHAR] = dbcsCode; // There's already a sequence, set a single-char subsequence of it.\n    else if (bucket[low] == UNASSIGNED)\n        bucket[low] = dbcsCode;\n}\n\nDBCSCodec.prototype._setEncodeSequence = function(seq, dbcsCode) {\n    \n    // Get the root of character tree according to first character of the sequence.\n    var uCode = seq[0];\n    var bucket = this._getEncodeBucket(uCode);\n    var low = uCode & 0xFF;\n\n    var node;\n    if (bucket[low] <= SEQ_START) {\n        // There's already a sequence with  - use it.\n        node = this.encodeTableSeq[SEQ_START-bucket[low]];\n    }\n    else {\n        // There was no sequence object - allocate a new one.\n        node = {};\n        if (bucket[low] !== UNASSIGNED) node[DEF_CHAR] = bucket[low]; // If a char was set before - make it a single-char subsequence.\n        bucket[low] = SEQ_START - this.encodeTableSeq.length;\n        this.encodeTableSeq.push(node);\n    }\n\n    // Traverse the character tree, allocating new nodes as needed.\n    for (var j = 1; j < seq.length-1; j++) {\n        var oldVal = node[uCode];\n        if (typeof oldVal === 'object')\n            node = oldVal;\n        else {\n            node = node[uCode] = {}\n            if (oldVal !== undefined)\n                node[DEF_CHAR] = oldVal\n        }\n    }\n\n    // Set the leaf to given dbcsCode.\n    uCode = seq[seq.length-1];\n    node[uCode] = dbcsCode;\n}\n\nDBCSCodec.prototype._fillEncodeTable = function(nodeIdx, prefix, skipEncodeChars) {\n    var node = this.decodeTables[nodeIdx];\n    var hasValues = false;\n    var subNodeEmpty = {};\n    for (var i = 0; i < 0x100; i++) {\n        var uCode = node[i];\n        var mbCode = prefix + i;\n        if (skipEncodeChars[mbCode])\n            continue;\n\n        if (uCode >= 0) {\n            this._setEncodeChar(uCode, mbCode);\n            hasValues = true;\n        } else if (uCode <= NODE_START) {\n            var subNodeIdx = NODE_START - uCode;\n            if (!subNodeEmpty[subNodeIdx]) {  // Skip empty subtrees (they are too large in gb18030).\n                var newPrefix = (mbCode << 8) >>> 0;  // NOTE: '>>> 0' keeps 32-bit num positive.\n                if (this._fillEncodeTable(subNodeIdx, newPrefix, skipEncodeChars))\n                    hasValues = true;\n                else\n                    subNodeEmpty[subNodeIdx] = true;\n            }\n        } else if (uCode <= SEQ_START) {\n            this._setEncodeSequence(this.decodeTableSeq[SEQ_START - uCode], mbCode);\n            hasValues = true;\n        }\n    }\n    return hasValues;\n}\n\n\n\n// == Encoder ==================================================================\n\nfunction DBCSEncoder(options, codec) {\n    // Encoder state\n    this.leadSurrogate = -1;\n    this.seqObj = undefined;\n    \n    // Static data\n    this.encodeTable = codec.encodeTable;\n    this.encodeTableSeq = codec.encodeTableSeq;\n    this.defaultCharSingleByte = codec.defCharSB;\n    this.gb18030 = codec.gb18030;\n}\n\nDBCSEncoder.prototype.write = function(str) {\n    var newBuf = Buffer.alloc(str.length * (this.gb18030 ? 4 : 3)),\n        leadSurrogate = this.leadSurrogate,\n        seqObj = this.seqObj, nextChar = -1,\n        i = 0, j = 0;\n\n    while (true) {\n        // 0. Get next character.\n        if (nextChar === -1) {\n            if (i == str.length) break;\n            var uCode = str.charCodeAt(i++);\n        }\n        else {\n            var uCode = nextChar;\n            nextChar = -1;    \n        }\n\n        // 1. Handle surrogates.\n        if (0xD800 <= uCode && uCode < 0xE000) { // Char is one of surrogates.\n            if (uCode < 0xDC00) { // We've got lead surrogate.\n                if (leadSurrogate === -1) {\n                    leadSurrogate = uCode;\n                    continue;\n                } else {\n                    leadSurrogate = uCode;\n                    // Double lead surrogate found.\n                    uCode = UNASSIGNED;\n                }\n            } else { // We've got trail surrogate.\n                if (leadSurrogate !== -1) {\n                    uCode = 0x10000 + (leadSurrogate - 0xD800) * 0x400 + (uCode - 0xDC00);\n                    leadSurrogate = -1;\n                } else {\n                    // Incomplete surrogate pair - only trail surrogate found.\n                    uCode = UNASSIGNED;\n                }\n                \n            }\n        }\n        else if (leadSurrogate !== -1) {\n            // Incomplete surrogate pair - only lead surrogate found.\n            nextChar = uCode; uCode = UNASSIGNED; // Write an error, then current char.\n            leadSurrogate = -1;\n        }\n\n        // 2. Convert uCode character.\n        var dbcsCode = UNASSIGNED;\n        if (seqObj !== undefined && uCode != UNASSIGNED) { // We are in the middle of the sequence\n            var resCode = seqObj[uCode];\n            if (typeof resCode === 'object') { // Sequence continues.\n                seqObj = resCode;\n                continue;\n\n            } else if (typeof resCode == 'number') { // Sequence finished. Write it.\n                dbcsCode = resCode;\n\n            } else if (resCode == undefined) { // Current character is not part of the sequence.\n\n                // Try default character for this sequence\n                resCode = seqObj[DEF_CHAR];\n                if (resCode !== undefined) {\n                    dbcsCode = resCode; // Found. Write it.\n                    nextChar = uCode; // Current character will be written too in the next iteration.\n\n                } else {\n                    // TODO: What if we have no default? (resCode == undefined)\n                    // Then, we should write first char of the sequence as-is and try the rest recursively.\n                    // Didn't do it for now because no encoding has this situation yet.\n                    // Currently, just skip the sequence and write current char.\n                }\n            }\n            seqObj = undefined;\n        }\n        else if (uCode >= 0) {  // Regular character\n            var subtable = this.encodeTable[uCode >> 8];\n            if (subtable !== undefined)\n                dbcsCode = subtable[uCode & 0xFF];\n            \n            if (dbcsCode <= SEQ_START) { // Sequence start\n                seqObj = this.encodeTableSeq[SEQ_START-dbcsCode];\n                continue;\n            }\n\n            if (dbcsCode == UNASSIGNED && this.gb18030) {\n                // Use GB18030 algorithm to find character(s) to write.\n                var idx = findIdx(this.gb18030.uChars, uCode);\n                if (idx != -1) {\n                    var dbcsCode = this.gb18030.gbChars[idx] + (uCode - this.gb18030.uChars[idx]);\n                    newBuf[j++] = 0x81 + Math.floor(dbcsCode / 12600); dbcsCode = dbcsCode % 12600;\n                    newBuf[j++] = 0x30 + Math.floor(dbcsCode / 1260); dbcsCode = dbcsCode % 1260;\n                    newBuf[j++] = 0x81 + Math.floor(dbcsCode / 10); dbcsCode = dbcsCode % 10;\n                    newBuf[j++] = 0x30 + dbcsCode;\n                    continue;\n                }\n            }\n        }\n\n        // 3. Write dbcsCode character.\n        if (dbcsCode === UNASSIGNED)\n            dbcsCode = this.defaultCharSingleByte;\n        \n        if (dbcsCode < 0x100) {\n            newBuf[j++] = dbcsCode;\n        }\n        else if (dbcsCode < 0x10000) {\n            newBuf[j++] = dbcsCode >> 8;   // high byte\n            newBuf[j++] = dbcsCode & 0xFF; // low byte\n        }\n        else if (dbcsCode < 0x1000000) {\n            newBuf[j++] = dbcsCode >> 16;\n            newBuf[j++] = (dbcsCode >> 8) & 0xFF;\n            newBuf[j++] = dbcsCode & 0xFF;\n        } else {\n            newBuf[j++] = dbcsCode >>> 24;\n            newBuf[j++] = (dbcsCode >>> 16) & 0xFF;\n            newBuf[j++] = (dbcsCode >>> 8) & 0xFF;\n            newBuf[j++] = dbcsCode & 0xFF;\n        }\n    }\n\n    this.seqObj = seqObj;\n    this.leadSurrogate = leadSurrogate;\n    return newBuf.slice(0, j);\n}\n\nDBCSEncoder.prototype.end = function() {\n    if (this.leadSurrogate === -1 && this.seqObj === undefined)\n        return; // All clean. Most often case.\n\n    var newBuf = Buffer.alloc(10), j = 0;\n\n    if (this.seqObj) { // We're in the sequence.\n        var dbcsCode = this.seqObj[DEF_CHAR];\n        if (dbcsCode !== undefined) { // Write beginning of the sequence.\n            if (dbcsCode < 0x100) {\n                newBuf[j++] = dbcsCode;\n            }\n            else {\n                newBuf[j++] = dbcsCode >> 8;   // high byte\n                newBuf[j++] = dbcsCode & 0xFF; // low byte\n            }\n        } else {\n            // See todo above.\n        }\n        this.seqObj = undefined;\n    }\n\n    if (this.leadSurrogate !== -1) {\n        // Incomplete surrogate pair - only lead surrogate found.\n        newBuf[j++] = this.defaultCharSingleByte;\n        this.leadSurrogate = -1;\n    }\n    \n    return newBuf.slice(0, j);\n}\n\n// Export for testing\nDBCSEncoder.prototype.findIdx = findIdx;\n\n\n// == Decoder ==================================================================\n\nfunction DBCSDecoder(options, codec) {\n    // Decoder state\n    this.nodeIdx = 0;\n    this.prevBytes = [];\n\n    // Static data\n    this.decodeTables = codec.decodeTables;\n    this.decodeTableSeq = codec.decodeTableSeq;\n    this.defaultCharUnicode = codec.defaultCharUnicode;\n    this.gb18030 = codec.gb18030;\n}\n\nDBCSDecoder.prototype.write = function(buf) {\n    var newBuf = Buffer.alloc(buf.length*2),\n        nodeIdx = this.nodeIdx, \n        prevBytes = this.prevBytes, prevOffset = this.prevBytes.length,\n        seqStart = -this.prevBytes.length, // idx of the start of current parsed sequence.\n        uCode;\n\n    for (var i = 0, j = 0; i < buf.length; i++) {\n        var curByte = (i >= 0) ? buf[i] : prevBytes[i + prevOffset];\n\n        // Lookup in current trie node.\n        var uCode = this.decodeTables[nodeIdx][curByte];\n\n        if (uCode >= 0) { \n            // Normal character, just use it.\n        }\n        else if (uCode === UNASSIGNED) { // Unknown char.\n            // TODO: Callback with seq.\n            uCode = this.defaultCharUnicode.charCodeAt(0);\n            i = seqStart; // Skip one byte ('i' will be incremented by the for loop) and try to parse again.\n        }\n        else if (uCode === GB18030_CODE) {\n            if (i >= 3) {\n                var ptr = (buf[i-3]-0x81)*12600 + (buf[i-2]-0x30)*1260 + (buf[i-1]-0x81)*10 + (curByte-0x30);\n            } else {\n                var ptr = (prevBytes[i-3+prevOffset]-0x81)*12600 + \n                          (((i-2 >= 0) ? buf[i-2] : prevBytes[i-2+prevOffset])-0x30)*1260 + \n                          (((i-1 >= 0) ? buf[i-1] : prevBytes[i-1+prevOffset])-0x81)*10 + \n                          (curByte-0x30);\n            }\n            var idx = findIdx(this.gb18030.gbChars, ptr);\n            uCode = this.gb18030.uChars[idx] + ptr - this.gb18030.gbChars[idx];\n        }\n        else if (uCode <= NODE_START) { // Go to next trie node.\n            nodeIdx = NODE_START - uCode;\n            continue;\n        }\n        else if (uCode <= SEQ_START) { // Output a sequence of chars.\n            var seq = this.decodeTableSeq[SEQ_START - uCode];\n            for (var k = 0; k < seq.length - 1; k++) {\n                uCode = seq[k];\n                newBuf[j++] = uCode & 0xFF;\n                newBuf[j++] = uCode >> 8;\n            }\n            uCode = seq[seq.length-1];\n        }\n        else\n            throw new Error(\"iconv-lite internal error: invalid decoding table value \" + uCode + \" at \" + nodeIdx + \"/\" + curByte);\n\n        // Write the character to buffer, handling higher planes using surrogate pair.\n        if (uCode >= 0x10000) { \n            uCode -= 0x10000;\n            var uCodeLead = 0xD800 | (uCode >> 10);\n            newBuf[j++] = uCodeLead & 0xFF;\n            newBuf[j++] = uCodeLead >> 8;\n\n            uCode = 0xDC00 | (uCode & 0x3FF);\n        }\n        newBuf[j++] = uCode & 0xFF;\n        newBuf[j++] = uCode >> 8;\n\n        // Reset trie node.\n        nodeIdx = 0; seqStart = i+1;\n    }\n\n    this.nodeIdx = nodeIdx;\n    this.prevBytes = (seqStart >= 0)\n        ? Array.prototype.slice.call(buf, seqStart)\n        : prevBytes.slice(seqStart + prevOffset).concat(Array.prototype.slice.call(buf));\n\n    return newBuf.slice(0, j).toString('ucs2');\n}\n\nDBCSDecoder.prototype.end = function() {\n    var ret = '';\n\n    // Try to parse all remaining chars.\n    while (this.prevBytes.length > 0) {\n        // Skip 1 character in the buffer.\n        ret += this.defaultCharUnicode;\n        var bytesArr = this.prevBytes.slice(1);\n\n        // Parse remaining as usual.\n        this.prevBytes = [];\n        this.nodeIdx = 0;\n        if (bytesArr.length > 0)\n            ret += this.write(bytesArr);\n    }\n\n    this.prevBytes = [];\n    this.nodeIdx = 0;\n    return ret;\n}\n\n// Binary search for GB18030. Returns largest i such that table[i] <= val.\nfunction findIdx(table, val) {\n    if (table[0] > val)\n        return -1;\n\n    var l = 0, r = table.length;\n    while (l < r-1) { // always table[l] <= val < table[r]\n        var mid = l + ((r-l+1) >> 1);\n        if (table[mid] <= val)\n            l = mid;\n        else\n            r = mid;\n    }\n    return l;\n}\n\n","\"use strict\";\n\n// Description of supported double byte encodings and aliases.\n// Tables are not require()-d until they are needed to speed up library load.\n// require()-s are direct to support Browserify.\n\nmodule.exports = {\n    \n    // == Japanese/ShiftJIS ====================================================\n    // All japanese encodings are based on JIS X set of standards:\n    // JIS X 0201 - Single-byte encoding of ASCII +  + Kana chars at 0xA1-0xDF.\n    // JIS X 0208 - Main set of 6879 characters, placed in 94x94 plane, to be encoded by 2 bytes. \n    //              Has several variations in 1978, 1983, 1990 and 1997.\n    // JIS X 0212 - Supplementary plane of 6067 chars in 94x94 plane. 1990. Effectively dead.\n    // JIS X 0213 - Extension and modern replacement of 0208 and 0212. Total chars: 11233.\n    //              2 planes, first is superset of 0208, second - revised 0212.\n    //              Introduced in 2000, revised 2004. Some characters are in Unicode Plane 2 (0x2xxxx)\n\n    // Byte encodings are:\n    //  * Shift_JIS: Compatible with 0201, uses not defined chars in top half as lead bytes for double-byte\n    //               encoding of 0208. Lead byte ranges: 0x81-0x9F, 0xE0-0xEF; Trail byte ranges: 0x40-0x7E, 0x80-0x9E, 0x9F-0xFC.\n    //               Windows CP932 is a superset of Shift_JIS. Some companies added more chars, notably KDDI.\n    //  * EUC-JP:    Up to 3 bytes per character. Used mostly on *nixes.\n    //               0x00-0x7F       - lower part of 0201\n    //               0x8E, 0xA1-0xDF - upper part of 0201\n    //               (0xA1-0xFE)x2   - 0208 plane (94x94).\n    //               0x8F, (0xA1-0xFE)x2 - 0212 plane (94x94).\n    //  * JIS X 208: 7-bit, direct encoding of 0208. Byte ranges: 0x21-0x7E (94 values). Uncommon.\n    //               Used as-is in ISO2022 family.\n    //  * ISO2022-JP: Stateful encoding, with escape sequences to switch between ASCII, \n    //                0201-1976 Roman, 0208-1978, 0208-1983.\n    //  * ISO2022-JP-1: Adds esc seq for 0212-1990.\n    //  * ISO2022-JP-2: Adds esc seq for GB2313-1980, KSX1001-1992, ISO8859-1, ISO8859-7.\n    //  * ISO2022-JP-3: Adds esc seq for 0201-1976 Kana set, 0213-2000 Planes 1, 2.\n    //  * ISO2022-JP-2004: Adds 0213-2004 Plane 1.\n    //\n    // After JIS X 0213 appeared, Shift_JIS-2004, EUC-JISX0213 and ISO2022-JP-2004 followed, with just changing the planes.\n    //\n    // Overall, it seems that it's a mess :( http://www8.plala.or.jp/tkubota1/unicode-symbols-map2.html\n\n    'shiftjis': {\n        type: '_dbcs',\n        table: function() { return require('./tables/shiftjis.json') },\n        encodeAdd: {'\\u00a5': 0x5C, '\\u203E': 0x7E},\n        encodeSkipVals: [{from: 0xED40, to: 0xF940}],\n    },\n    'csshiftjis': 'shiftjis',\n    'mskanji': 'shiftjis',\n    'sjis': 'shiftjis',\n    'windows31j': 'shiftjis',\n    'ms31j': 'shiftjis',\n    'xsjis': 'shiftjis',\n    'windows932': 'shiftjis',\n    'ms932': 'shiftjis',\n    '932': 'shiftjis',\n    'cp932': 'shiftjis',\n\n    'eucjp': {\n        type: '_dbcs',\n        table: function() { return require('./tables/eucjp.json') },\n        encodeAdd: {'\\u00a5': 0x5C, '\\u203E': 0x7E},\n    },\n\n    // TODO: KDDI extension to Shift_JIS\n    // TODO: IBM CCSID 942 = CP932, but F0-F9 custom chars and other char changes.\n    // TODO: IBM CCSID 943 = Shift_JIS = CP932 with original Shift_JIS lower 128 chars.\n\n\n    // == Chinese/GBK ==========================================================\n    // http://en.wikipedia.org/wiki/GBK\n    // We mostly implement W3C recommendation: https://www.w3.org/TR/encoding/#gbk-encoder\n\n    // Oldest GB2312 (1981, ~7600 chars) is a subset of CP936\n    'gb2312': 'cp936',\n    'gb231280': 'cp936',\n    'gb23121980': 'cp936',\n    'csgb2312': 'cp936',\n    'csiso58gb231280': 'cp936',\n    'euccn': 'cp936',\n\n    // Microsoft's CP936 is a subset and approximation of GBK.\n    'windows936': 'cp936',\n    'ms936': 'cp936',\n    '936': 'cp936',\n    'cp936': {\n        type: '_dbcs',\n        table: function() { return require('./tables/cp936.json') },\n    },\n\n    // GBK (~22000 chars) is an extension of CP936 that added user-mapped chars and some other.\n    'gbk': {\n        type: '_dbcs',\n        table: function() { return require('./tables/cp936.json').concat(require('./tables/gbk-added.json')) },\n    },\n    'xgbk': 'gbk',\n    'isoir58': 'gbk',\n\n    // GB18030 is an algorithmic extension of GBK.\n    // Main source: https://www.w3.org/TR/encoding/#gbk-encoder\n    // http://icu-project.org/docs/papers/gb18030.html\n    // http://source.icu-project.org/repos/icu/data/trunk/charset/data/xml/gb-18030-2000.xml\n    // http://www.khngai.com/chinese/charmap/tblgbk.php?page=0\n    'gb18030': {\n        type: '_dbcs',\n        table: function() { return require('./tables/cp936.json').concat(require('./tables/gbk-added.json')) },\n        gb18030: function() { return require('./tables/gb18030-ranges.json') },\n        encodeSkipVals: [0x80],\n        encodeAdd: {'': 0xA2E3},\n    },\n\n    'chinese': 'gb18030',\n\n\n    // == Korean ===============================================================\n    // EUC-KR, KS_C_5601 and KS X 1001 are exactly the same.\n    'windows949': 'cp949',\n    'ms949': 'cp949',\n    '949': 'cp949',\n    'cp949': {\n        type: '_dbcs',\n        table: function() { return require('./tables/cp949.json') },\n    },\n\n    'cseuckr': 'cp949',\n    'csksc56011987': 'cp949',\n    'euckr': 'cp949',\n    'isoir149': 'cp949',\n    'korean': 'cp949',\n    'ksc56011987': 'cp949',\n    'ksc56011989': 'cp949',\n    'ksc5601': 'cp949',\n\n\n    // == Big5/Taiwan/Hong Kong ================================================\n    // There are lots of tables for Big5 and cp950. Please see the following links for history:\n    // http://moztw.org/docs/big5/  http://www.haible.de/bruno/charsets/conversion-tables/Big5.html\n    // Variations, in roughly number of defined chars:\n    //  * Windows CP 950: Microsoft variant of Big5. Canonical: http://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WINDOWS/CP950.TXT\n    //  * Windows CP 951: Microsoft variant of Big5-HKSCS-2001. Seems to be never public. http://me.abelcheung.org/articles/research/what-is-cp951/\n    //  * Big5-2003 (Taiwan standard) almost superset of cp950.\n    //  * Unicode-at-on (UAO) / Mozilla 1.8. Falling out of use on the Web. Not supported by other browsers.\n    //  * Big5-HKSCS (-2001, -2004, -2008). Hong Kong standard. \n    //    many unicode code points moved from PUA to Supplementary plane (U+2XXXX) over the years.\n    //    Plus, it has 4 combining sequences.\n    //    Seems that Mozilla refused to support it for 10 yrs. https://bugzilla.mozilla.org/show_bug.cgi?id=162431 https://bugzilla.mozilla.org/show_bug.cgi?id=310299\n    //    because big5-hkscs is the only encoding to include astral characters in non-algorithmic way.\n    //    Implementations are not consistent within browsers; sometimes labeled as just big5.\n    //    MS Internet Explorer switches from big5 to big5-hkscs when a patch applied.\n    //    Great discussion & recap of what's going on https://bugzilla.mozilla.org/show_bug.cgi?id=912470#c31\n    //    In the encoder, it might make sense to support encoding old PUA mappings to Big5 bytes seq-s.\n    //    Official spec: http://www.ogcio.gov.hk/en/business/tech_promotion/ccli/terms/doc/2003cmp_2008.txt\n    //                   http://www.ogcio.gov.hk/tc/business/tech_promotion/ccli/terms/doc/hkscs-2008-big5-iso.txt\n    // \n    // Current understanding of how to deal with Big5(-HKSCS) is in the Encoding Standard, http://encoding.spec.whatwg.org/#big5-encoder\n    // Unicode mapping (http://www.unicode.org/Public/MAPPINGS/OBSOLETE/EASTASIA/OTHER/BIG5.TXT) is said to be wrong.\n\n    'windows950': 'cp950',\n    'ms950': 'cp950',\n    '950': 'cp950',\n    'cp950': {\n        type: '_dbcs',\n        table: function() { return require('./tables/cp950.json') },\n    },\n\n    // Big5 has many variations and is an extension of cp950. We use Encoding Standard's as a consensus.\n    'big5': 'big5hkscs',\n    'big5hkscs': {\n        type: '_dbcs',\n        table: function() { return require('./tables/cp950.json').concat(require('./tables/big5-added.json')) },\n        encodeSkipVals: [\n            // Although Encoding Standard says we should avoid encoding to HKSCS area (See Step 1 of\n            // https://encoding.spec.whatwg.org/#index-big5-pointer), we still do it to increase compatibility with ICU.\n            // But if a single unicode point can be encoded both as HKSCS and regular Big5, we prefer the latter.\n            0x8e69, 0x8e6f, 0x8e7e, 0x8eab, 0x8eb4, 0x8ecd, 0x8ed0, 0x8f57, 0x8f69, 0x8f6e, 0x8fcb, 0x8ffe,\n            0x906d, 0x907a, 0x90c4, 0x90dc, 0x90f1, 0x91bf, 0x92af, 0x92b0, 0x92b1, 0x92b2, 0x92d1, 0x9447, 0x94ca,\n            0x95d9, 0x96fc, 0x9975, 0x9b76, 0x9b78, 0x9b7b, 0x9bc6, 0x9bde, 0x9bec, 0x9bf6, 0x9c42, 0x9c53, 0x9c62,\n            0x9c68, 0x9c6b, 0x9c77, 0x9cbc, 0x9cbd, 0x9cd0, 0x9d57, 0x9d5a, 0x9dc4, 0x9def, 0x9dfb, 0x9ea9, 0x9eef,\n            0x9efd, 0x9f60, 0x9fcb, 0xa077, 0xa0dc, 0xa0df, 0x8fcc, 0x92c8, 0x9644, 0x96ed,\n\n            // Step 2 of https://encoding.spec.whatwg.org/#index-big5-pointer: Use last pointer for U+2550, U+255E, U+2561, U+256A, U+5341, or U+5345\n            0xa2a4, 0xa2a5, 0xa2a7, 0xa2a6, 0xa2cc, 0xa2ce,\n        ],\n    },\n\n    'cnbig5': 'big5hkscs',\n    'csbig5': 'big5hkscs',\n    'xxbig5': 'big5hkscs',\n};\n","\"use strict\";\n\n// Update this array if you add/rename/remove files in this directory.\n// We support Browserify by skipping automatic module discovery and requiring modules directly.\nvar modules = [\n    require(\"./internal\"),\n    require(\"./utf32\"),\n    require(\"./utf16\"),\n    require(\"./utf7\"),\n    require(\"./sbcs-codec\"),\n    require(\"./sbcs-data\"),\n    require(\"./sbcs-data-generated\"),\n    require(\"./dbcs-codec\"),\n    require(\"./dbcs-data\"),\n];\n\n// Put all encoding/alias/codec definitions to single object and export it.\nfor (var i = 0; i < modules.length; i++) {\n    var module = modules[i];\n    for (var enc in module)\n        if (Object.prototype.hasOwnProperty.call(module, enc))\n            exports[enc] = module[enc];\n}\n","\"use strict\";\nvar Buffer = require(\"safer-buffer\").Buffer;\n\n// Export Node.js internal encodings.\n\nmodule.exports = {\n    // Encodings\n    utf8:   { type: \"_internal\", bomAware: true},\n    cesu8:  { type: \"_internal\", bomAware: true},\n    unicode11utf8: \"utf8\",\n\n    ucs2:   { type: \"_internal\", bomAware: true},\n    utf16le: \"ucs2\",\n\n    binary: { type: \"_internal\" },\n    base64: { type: \"_internal\" },\n    hex:    { type: \"_internal\" },\n\n    // Codec.\n    _internal: InternalCodec,\n};\n\n//------------------------------------------------------------------------------\n\nfunction InternalCodec(codecOptions, iconv) {\n    this.enc = codecOptions.encodingName;\n    this.bomAware = codecOptions.bomAware;\n\n    if (this.enc === \"base64\")\n        this.encoder = InternalEncoderBase64;\n    else if (this.enc === \"cesu8\") {\n        this.enc = \"utf8\"; // Use utf8 for decoding.\n        this.encoder = InternalEncoderCesu8;\n\n        // Add decoder for versions of Node not supporting CESU-8\n        if (Buffer.from('eda0bdedb2a9', 'hex').toString() !== '') {\n            this.decoder = InternalDecoderCesu8;\n            this.defaultCharUnicode = iconv.defaultCharUnicode;\n        }\n    }\n}\n\nInternalCodec.prototype.encoder = InternalEncoder;\nInternalCodec.prototype.decoder = InternalDecoder;\n\n//------------------------------------------------------------------------------\n\n// We use node.js internal decoder. Its signature is the same as ours.\nvar StringDecoder = require('string_decoder').StringDecoder;\n\nif (!StringDecoder.prototype.end) // Node v0.8 doesn't have this method.\n    StringDecoder.prototype.end = function() {};\n\n\nfunction InternalDecoder(options, codec) {\n    this.decoder = new StringDecoder(codec.enc);\n}\n\nInternalDecoder.prototype.write = function(buf) {\n    if (!Buffer.isBuffer(buf)) {\n        buf = Buffer.from(buf);\n    }\n\n    return this.decoder.write(buf);\n}\n\nInternalDecoder.prototype.end = function() {\n    return this.decoder.end();\n}\n\n\n//------------------------------------------------------------------------------\n// Encoder is mostly trivial\n\nfunction InternalEncoder(options, codec) {\n    this.enc = codec.enc;\n}\n\nInternalEncoder.prototype.write = function(str) {\n    return Buffer.from(str, this.enc);\n}\n\nInternalEncoder.prototype.end = function() {\n}\n\n\n//------------------------------------------------------------------------------\n// Except base64 encoder, which must keep its state.\n\nfunction InternalEncoderBase64(options, codec) {\n    this.prevStr = '';\n}\n\nInternalEncoderBase64.prototype.write = function(str) {\n    str = this.prevStr + str;\n    var completeQuads = str.length - (str.length % 4);\n    this.prevStr = str.slice(completeQuads);\n    str = str.slice(0, completeQuads);\n\n    return Buffer.from(str, \"base64\");\n}\n\nInternalEncoderBase64.prototype.end = function() {\n    return Buffer.from(this.prevStr, \"base64\");\n}\n\n\n//------------------------------------------------------------------------------\n// CESU-8 encoder is also special.\n\nfunction InternalEncoderCesu8(options, codec) {\n}\n\nInternalEncoderCesu8.prototype.write = function(str) {\n    var buf = Buffer.alloc(str.length * 3), bufIdx = 0;\n    for (var i = 0; i < str.length; i++) {\n        var charCode = str.charCodeAt(i);\n        // Naive implementation, but it works because CESU-8 is especially easy\n        // to convert from UTF-16 (which all JS strings are encoded in).\n        if (charCode < 0x80)\n            buf[bufIdx++] = charCode;\n        else if (charCode < 0x800) {\n            buf[bufIdx++] = 0xC0 + (charCode >>> 6);\n            buf[bufIdx++] = 0x80 + (charCode & 0x3f);\n        }\n        else { // charCode will always be < 0x10000 in javascript.\n            buf[bufIdx++] = 0xE0 + (charCode >>> 12);\n            buf[bufIdx++] = 0x80 + ((charCode >>> 6) & 0x3f);\n            buf[bufIdx++] = 0x80 + (charCode & 0x3f);\n        }\n    }\n    return buf.slice(0, bufIdx);\n}\n\nInternalEncoderCesu8.prototype.end = function() {\n}\n\n//------------------------------------------------------------------------------\n// CESU-8 decoder is not implemented in Node v4.0+\n\nfunction InternalDecoderCesu8(options, codec) {\n    this.acc = 0;\n    this.contBytes = 0;\n    this.accBytes = 0;\n    this.defaultCharUnicode = codec.defaultCharUnicode;\n}\n\nInternalDecoderCesu8.prototype.write = function(buf) {\n    var acc = this.acc, contBytes = this.contBytes, accBytes = this.accBytes, \n        res = '';\n    for (var i = 0; i < buf.length; i++) {\n        var curByte = buf[i];\n        if ((curByte & 0xC0) !== 0x80) { // Leading byte\n            if (contBytes > 0) { // Previous code is invalid\n                res += this.defaultCharUnicode;\n                contBytes = 0;\n            }\n\n            if (curByte < 0x80) { // Single-byte code\n                res += String.fromCharCode(curByte);\n            } else if (curByte < 0xE0) { // Two-byte code\n                acc = curByte & 0x1F;\n                contBytes = 1; accBytes = 1;\n            } else if (curByte < 0xF0) { // Three-byte code\n                acc = curByte & 0x0F;\n                contBytes = 2; accBytes = 1;\n            } else { // Four or more are not supported for CESU-8.\n                res += this.defaultCharUnicode;\n            }\n        } else { // Continuation byte\n            if (contBytes > 0) { // We're waiting for it.\n                acc = (acc << 6) | (curByte & 0x3f);\n                contBytes--; accBytes++;\n                if (contBytes === 0) {\n                    // Check for overlong encoding, but support Modified UTF-8 (encoding NULL as C0 80)\n                    if (accBytes === 2 && acc < 0x80 && acc > 0)\n                        res += this.defaultCharUnicode;\n                    else if (accBytes === 3 && acc < 0x800)\n                        res += this.defaultCharUnicode;\n                    else\n                        // Actually add character.\n                        res += String.fromCharCode(acc);\n                }\n            } else { // Unexpected continuation byte\n                res += this.defaultCharUnicode;\n            }\n        }\n    }\n    this.acc = acc; this.contBytes = contBytes; this.accBytes = accBytes;\n    return res;\n}\n\nInternalDecoderCesu8.prototype.end = function() {\n    var res = 0;\n    if (this.contBytes > 0)\n        res += this.defaultCharUnicode;\n    return res;\n}\n","\"use strict\";\nvar Buffer = require(\"safer-buffer\").Buffer;\n\n// Single-byte codec. Needs a 'chars' string parameter that contains 256 or 128 chars that\n// correspond to encoded bytes (if 128 - then lower half is ASCII). \n\nexports._sbcs = SBCSCodec;\nfunction SBCSCodec(codecOptions, iconv) {\n    if (!codecOptions)\n        throw new Error(\"SBCS codec is called without the data.\")\n    \n    // Prepare char buffer for decoding.\n    if (!codecOptions.chars || (codecOptions.chars.length !== 128 && codecOptions.chars.length !== 256))\n        throw new Error(\"Encoding '\"+codecOptions.type+\"' has incorrect 'chars' (must be of len 128 or 256)\");\n    \n    if (codecOptions.chars.length === 128) {\n        var asciiString = \"\";\n        for (var i = 0; i < 128; i++)\n            asciiString += String.fromCharCode(i);\n        codecOptions.chars = asciiString + codecOptions.chars;\n    }\n\n    this.decodeBuf = Buffer.from(codecOptions.chars, 'ucs2');\n    \n    // Encoding buffer.\n    var encodeBuf = Buffer.alloc(65536, iconv.defaultCharSingleByte.charCodeAt(0));\n\n    for (var i = 0; i < codecOptions.chars.length; i++)\n        encodeBuf[codecOptions.chars.charCodeAt(i)] = i;\n\n    this.encodeBuf = encodeBuf;\n}\n\nSBCSCodec.prototype.encoder = SBCSEncoder;\nSBCSCodec.prototype.decoder = SBCSDecoder;\n\n\nfunction SBCSEncoder(options, codec) {\n    this.encodeBuf = codec.encodeBuf;\n}\n\nSBCSEncoder.prototype.write = function(str) {\n    var buf = Buffer.alloc(str.length);\n    for (var i = 0; i < str.length; i++)\n        buf[i] = this.encodeBuf[str.charCodeAt(i)];\n    \n    return buf;\n}\n\nSBCSEncoder.prototype.end = function() {\n}\n\n\nfunction SBCSDecoder(options, codec) {\n    this.decodeBuf = codec.decodeBuf;\n}\n\nSBCSDecoder.prototype.write = function(buf) {\n    // Strings are immutable in JS -> we use ucs2 buffer to speed up computations.\n    var decodeBuf = this.decodeBuf;\n    var newBuf = Buffer.alloc(buf.length*2);\n    var idx1 = 0, idx2 = 0;\n    for (var i = 0; i < buf.length; i++) {\n        idx1 = buf[i]*2; idx2 = i*2;\n        newBuf[idx2] = decodeBuf[idx1];\n        newBuf[idx2+1] = decodeBuf[idx1+1];\n    }\n    return newBuf.toString('ucs2');\n}\n\nSBCSDecoder.prototype.end = function() {\n}\n","\"use strict\";\n\n// Generated data for sbcs codec. Don't edit manually. Regenerate using generation/gen-sbcs.js script.\nmodule.exports = {\n  \"437\": \"cp437\",\n  \"737\": \"cp737\",\n  \"775\": \"cp775\",\n  \"850\": \"cp850\",\n  \"852\": \"cp852\",\n  \"855\": \"cp855\",\n  \"856\": \"cp856\",\n  \"857\": \"cp857\",\n  \"858\": \"cp858\",\n  \"860\": \"cp860\",\n  \"861\": \"cp861\",\n  \"862\": \"cp862\",\n  \"863\": \"cp863\",\n  \"864\": \"cp864\",\n  \"865\": \"cp865\",\n  \"866\": \"cp866\",\n  \"869\": \"cp869\",\n  \"874\": \"windows874\",\n  \"922\": \"cp922\",\n  \"1046\": \"cp1046\",\n  \"1124\": \"cp1124\",\n  \"1125\": \"cp1125\",\n  \"1129\": \"cp1129\",\n  \"1133\": \"cp1133\",\n  \"1161\": \"cp1161\",\n  \"1162\": \"cp1162\",\n  \"1163\": \"cp1163\",\n  \"1250\": \"windows1250\",\n  \"1251\": \"windows1251\",\n  \"1252\": \"windows1252\",\n  \"1253\": \"windows1253\",\n  \"1254\": \"windows1254\",\n  \"1255\": \"windows1255\",\n  \"1256\": \"windows1256\",\n  \"1257\": \"windows1257\",\n  \"1258\": \"windows1258\",\n  \"28591\": \"iso88591\",\n  \"28592\": \"iso88592\",\n  \"28593\": \"iso88593\",\n  \"28594\": \"iso88594\",\n  \"28595\": \"iso88595\",\n  \"28596\": \"iso88596\",\n  \"28597\": \"iso88597\",\n  \"28598\": \"iso88598\",\n  \"28599\": \"iso88599\",\n  \"28600\": \"iso885910\",\n  \"28601\": \"iso885911\",\n  \"28603\": \"iso885913\",\n  \"28604\": \"iso885914\",\n  \"28605\": \"iso885915\",\n  \"28606\": \"iso885916\",\n  \"windows874\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"win874\": \"windows874\",\n  \"cp874\": \"windows874\",\n  \"windows1250\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"win1250\": \"windows1250\",\n  \"cp1250\": \"windows1250\",\n  \"windows1251\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"win1251\": \"windows1251\",\n  \"cp1251\": \"windows1251\",\n  \"windows1252\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"win1252\": \"windows1252\",\n  \"cp1252\": \"windows1252\",\n  \"windows1253\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"win1253\": \"windows1253\",\n  \"cp1253\": \"windows1253\",\n  \"windows1254\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"win1254\": \"windows1254\",\n  \"cp1254\": \"windows1254\",\n  \"windows1255\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"win1255\": \"windows1255\",\n  \"cp1255\": \"windows1255\",\n  \"windows1256\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"win1256\": \"windows1256\",\n  \"cp1256\": \"windows1256\",\n  \"windows1257\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"win1257\": \"windows1257\",\n  \"cp1257\": \"windows1257\",\n  \"windows1258\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"win1258\": \"windows1258\",\n  \"cp1258\": \"windows1258\",\n  \"iso88591\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28591\": \"iso88591\",\n  \"iso88592\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28592\": \"iso88592\",\n  \"iso88593\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28593\": \"iso88593\",\n  \"iso88594\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28594\": \"iso88594\",\n  \"iso88595\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28595\": \"iso88595\",\n  \"iso88596\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28596\": \"iso88596\",\n  \"iso88597\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28597\": \"iso88597\",\n  \"iso88598\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28598\": \"iso88598\",\n  \"iso88599\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28599\": \"iso88599\",\n  \"iso885910\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28600\": \"iso885910\",\n  \"iso885911\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28601\": \"iso885911\",\n  \"iso885913\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28603\": \"iso885913\",\n  \"iso885914\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28604\": \"iso885914\",\n  \"iso885915\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28605\": \"iso885915\",\n  \"iso885916\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"cp28606\": \"iso885916\",\n  \"cp437\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm437\": \"cp437\",\n  \"csibm437\": \"cp437\",\n  \"cp737\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm737\": \"cp737\",\n  \"csibm737\": \"cp737\",\n  \"cp775\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm775\": \"cp775\",\n  \"csibm775\": \"cp775\",\n  \"cp850\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm850\": \"cp850\",\n  \"csibm850\": \"cp850\",\n  \"cp852\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm852\": \"cp852\",\n  \"csibm852\": \"cp852\",\n  \"cp855\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm855\": \"cp855\",\n  \"csibm855\": \"cp855\",\n  \"cp856\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm856\": \"cp856\",\n  \"csibm856\": \"cp856\",\n  \"cp857\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm857\": \"cp857\",\n  \"csibm857\": \"cp857\",\n  \"cp858\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm858\": \"cp858\",\n  \"csibm858\": \"cp858\",\n  \"cp860\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm860\": \"cp860\",\n  \"csibm860\": \"cp860\",\n  \"cp861\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm861\": \"cp861\",\n  \"csibm861\": \"cp861\",\n  \"cp862\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm862\": \"cp862\",\n  \"csibm862\": \"cp862\",\n  \"cp863\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm863\": \"cp863\",\n  \"csibm863\": \"cp863\",\n  \"cp864\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\\u0000\\u0001\\u0002\\u0003\\u0004\\u0005\\u0006\\u0007\\b\\t\\n\\u000b\\f\\r\\u000e\\u000f\\u0010\\u0011\\u0012\\u0013\\u0014\\u0015\\u0016\\u0017\\u0018\\u0019\\u001a\\u001b\\u001c\\u001d\\u001e\\u001f !\\\"#$&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\"\n  },\n  \"ibm864\": \"cp864\",\n  \"csibm864\": \"cp864\",\n  \"cp865\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm865\": \"cp865\",\n  \"csibm865\": \"cp865\",\n  \"cp866\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm866\": \"cp866\",\n  \"csibm866\": \"cp866\",\n  \"cp869\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm869\": \"cp869\",\n  \"csibm869\": \"cp869\",\n  \"cp922\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm922\": \"cp922\",\n  \"csibm922\": \"cp922\",\n  \"cp1046\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm1046\": \"cp1046\",\n  \"csibm1046\": \"cp1046\",\n  \"cp1124\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm1124\": \"cp1124\",\n  \"csibm1124\": \"cp1124\",\n  \"cp1125\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm1125\": \"cp1125\",\n  \"csibm1125\": \"cp1125\",\n  \"cp1129\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm1129\": \"cp1129\",\n  \"csibm1129\": \"cp1129\",\n  \"cp1133\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm1133\": \"cp1133\",\n  \"csibm1133\": \"cp1133\",\n  \"cp1161\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm1161\": \"cp1161\",\n  \"csibm1161\": \"cp1161\",\n  \"cp1162\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm1162\": \"cp1162\",\n  \"csibm1162\": \"cp1162\",\n  \"cp1163\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ibm1163\": \"cp1163\",\n  \"csibm1163\": \"cp1163\",\n  \"maccroatian\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"maccyrillic\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"macgreek\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"maciceland\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"macroman\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"macromania\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"macthai\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"macturkish\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"macukraine\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"koi8r\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"koi8u\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"koi8ru\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"koi8t\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"armscii8\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \")(.,-\"\n  },\n  \"rk1048\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"tcvn\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\\u0000\\u0003\\u0007\\b\\t\\n\\u000b\\f\\r\\u000e\\u000f\\u0010\\u0018\\u0019\\u001a\\u001b\\u001c\\u001d\\u001e\\u001f !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\"\n  },\n  \"georgianacademy\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"georgianps\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"pt154\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"viscii\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\\u0000\\u0001\\u0003\\u0004\\u0007\\b\\t\\n\\u000b\\f\\r\\u000e\\u000f\\u0010\\u0011\\u0012\\u0013\\u0015\\u0016\\u0017\\u0018\\u001a\\u001b\\u001c\\u001d\\u001f !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\"\n  },\n  \"iso646cn\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\\u0000\\u0001\\u0002\\u0003\\u0004\\u0005\\u0006\\u0007\\b\\t\\n\\u000b\\f\\r\\u000e\\u000f\\u0010\\u0011\\u0012\\u0013\\u0014\\u0015\\u0016\\u0017\\u0018\\u0019\\u001a\\u001b\\u001c\\u001d\\u001e\\u001f !\\\"#%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}\"\n  },\n  \"iso646jp\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\\u0000\\u0001\\u0002\\u0003\\u0004\\u0005\\u0006\\u0007\\b\\t\\n\\u000b\\f\\r\\u000e\\u000f\\u0010\\u0011\\u0012\\u0013\\u0014\\u0015\\u0016\\u0017\\u0018\\u0019\\u001a\\u001b\\u001c\\u001d\\u001e\\u001f !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}\"\n  },\n  \"hproman8\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"macintosh\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"ascii\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  },\n  \"tis620\": {\n    \"type\": \"_sbcs\",\n    \"chars\": \"\"\n  }\n}","\"use strict\";\n\n// Manually added data to be used by sbcs codec in addition to generated one.\n\nmodule.exports = {\n    // Not supported by iconv, not sure why.\n    \"10029\": \"maccenteuro\",\n    \"maccenteuro\": {\n        \"type\": \"_sbcs\",\n        \"chars\": \"\"\n    },\n\n    \"808\": \"cp808\",\n    \"ibm808\": \"cp808\",\n    \"cp808\": {\n        \"type\": \"_sbcs\",\n        \"chars\": \"\"\n    },\n\n    \"mik\": {\n        \"type\": \"_sbcs\",\n        \"chars\": \"\"\n    },\n\n    \"cp720\": {\n        \"type\": \"_sbcs\",\n        \"chars\": \"\\x80\\x81\\x84\\x86\\x8d\\x8e\\x8f\\x90\\u0651\\u0652\\u064b\\u064c\\u064d\\u064e\\u064f\\u0650\\u00a0\"\n    },\n\n    // Aliases of generated encodings.\n    \"ascii8bit\": \"ascii\",\n    \"usascii\": \"ascii\",\n    \"ansix34\": \"ascii\",\n    \"ansix341968\": \"ascii\",\n    \"ansix341986\": \"ascii\",\n    \"csascii\": \"ascii\",\n    \"cp367\": \"ascii\",\n    \"ibm367\": \"ascii\",\n    \"isoir6\": \"ascii\",\n    \"iso646us\": \"ascii\",\n    \"iso646irv\": \"ascii\",\n    \"us\": \"ascii\",\n\n    \"latin1\": \"iso88591\",\n    \"latin2\": \"iso88592\",\n    \"latin3\": \"iso88593\",\n    \"latin4\": \"iso88594\",\n    \"latin5\": \"iso88599\",\n    \"latin6\": \"iso885910\",\n    \"latin7\": \"iso885913\",\n    \"latin8\": \"iso885914\",\n    \"latin9\": \"iso885915\",\n    \"latin10\": \"iso885916\",\n\n    \"csisolatin1\": \"iso88591\",\n    \"csisolatin2\": \"iso88592\",\n    \"csisolatin3\": \"iso88593\",\n    \"csisolatin4\": \"iso88594\",\n    \"csisolatincyrillic\": \"iso88595\",\n    \"csisolatinarabic\": \"iso88596\",\n    \"csisolatingreek\" : \"iso88597\",\n    \"csisolatinhebrew\": \"iso88598\",\n    \"csisolatin5\": \"iso88599\",\n    \"csisolatin6\": \"iso885910\",\n\n    \"l1\": \"iso88591\",\n    \"l2\": \"iso88592\",\n    \"l3\": \"iso88593\",\n    \"l4\": \"iso88594\",\n    \"l5\": \"iso88599\",\n    \"l6\": \"iso885910\",\n    \"l7\": \"iso885913\",\n    \"l8\": \"iso885914\",\n    \"l9\": \"iso885915\",\n    \"l10\": \"iso885916\",\n\n    \"isoir14\": \"iso646jp\",\n    \"isoir57\": \"iso646cn\",\n    \"isoir100\": \"iso88591\",\n    \"isoir101\": \"iso88592\",\n    \"isoir109\": \"iso88593\",\n    \"isoir110\": \"iso88594\",\n    \"isoir144\": \"iso88595\",\n    \"isoir127\": \"iso88596\",\n    \"isoir126\": \"iso88597\",\n    \"isoir138\": \"iso88598\",\n    \"isoir148\": \"iso88599\",\n    \"isoir157\": \"iso885910\",\n    \"isoir166\": \"tis620\",\n    \"isoir179\": \"iso885913\",\n    \"isoir199\": \"iso885914\",\n    \"isoir203\": \"iso885915\",\n    \"isoir226\": \"iso885916\",\n\n    \"cp819\": \"iso88591\",\n    \"ibm819\": \"iso88591\",\n\n    \"cyrillic\": \"iso88595\",\n\n    \"arabic\": \"iso88596\",\n    \"arabic8\": \"iso88596\",\n    \"ecma114\": \"iso88596\",\n    \"asmo708\": \"iso88596\",\n\n    \"greek\" : \"iso88597\",\n    \"greek8\" : \"iso88597\",\n    \"ecma118\" : \"iso88597\",\n    \"elot928\" : \"iso88597\",\n\n    \"hebrew\": \"iso88598\",\n    \"hebrew8\": \"iso88598\",\n\n    \"turkish\": \"iso88599\",\n    \"turkish8\": \"iso88599\",\n\n    \"thai\": \"iso885911\",\n    \"thai8\": \"iso885911\",\n\n    \"celtic\": \"iso885914\",\n    \"celtic8\": \"iso885914\",\n    \"isoceltic\": \"iso885914\",\n\n    \"tis6200\": \"tis620\",\n    \"tis62025291\": \"tis620\",\n    \"tis62025330\": \"tis620\",\n\n    \"10000\": \"macroman\",\n    \"10006\": \"macgreek\",\n    \"10007\": \"maccyrillic\",\n    \"10079\": \"maciceland\",\n    \"10081\": \"macturkish\",\n\n    \"cspc8codepage437\": \"cp437\",\n    \"cspc775baltic\": \"cp775\",\n    \"cspc850multilingual\": \"cp850\",\n    \"cspcp852\": \"cp852\",\n    \"cspc862latinhebrew\": \"cp862\",\n    \"cpgr\": \"cp869\",\n\n    \"msee\": \"cp1250\",\n    \"mscyrl\": \"cp1251\",\n    \"msansi\": \"cp1252\",\n    \"msgreek\": \"cp1253\",\n    \"msturk\": \"cp1254\",\n    \"mshebr\": \"cp1255\",\n    \"msarab\": \"cp1256\",\n    \"winbaltrim\": \"cp1257\",\n\n    \"cp20866\": \"koi8r\",\n    \"20866\": \"koi8r\",\n    \"ibm878\": \"koi8r\",\n    \"cskoi8r\": \"koi8r\",\n\n    \"cp21866\": \"koi8u\",\n    \"21866\": \"koi8u\",\n    \"ibm1168\": \"koi8u\",\n\n    \"strk10482002\": \"rk1048\",\n\n    \"tcvn5712\": \"tcvn\",\n    \"tcvn57121\": \"tcvn\",\n\n    \"gb198880\": \"iso646cn\",\n    \"cn\": \"iso646cn\",\n\n    \"csiso14jisc6220ro\": \"iso646jp\",\n    \"jisc62201969ro\": \"iso646jp\",\n    \"jp\": \"iso646jp\",\n\n    \"cshproman8\": \"hproman8\",\n    \"r8\": \"hproman8\",\n    \"roman8\": \"hproman8\",\n    \"xroman8\": \"hproman8\",\n    \"ibm1051\": \"hproman8\",\n\n    \"mac\": \"macintosh\",\n    \"csmacintosh\": \"macintosh\",\n};\n\n","\"use strict\";\nvar Buffer = require(\"safer-buffer\").Buffer;\n\n// Note: UTF16-LE (or UCS2) codec is Node.js native. See encodings/internal.js\n\n// == UTF16-BE codec. ==========================================================\n\nexports.utf16be = Utf16BECodec;\nfunction Utf16BECodec() {\n}\n\nUtf16BECodec.prototype.encoder = Utf16BEEncoder;\nUtf16BECodec.prototype.decoder = Utf16BEDecoder;\nUtf16BECodec.prototype.bomAware = true;\n\n\n// -- Encoding\n\nfunction Utf16BEEncoder() {\n}\n\nUtf16BEEncoder.prototype.write = function(str) {\n    var buf = Buffer.from(str, 'ucs2');\n    for (var i = 0; i < buf.length; i += 2) {\n        var tmp = buf[i]; buf[i] = buf[i+1]; buf[i+1] = tmp;\n    }\n    return buf;\n}\n\nUtf16BEEncoder.prototype.end = function() {\n}\n\n\n// -- Decoding\n\nfunction Utf16BEDecoder() {\n    this.overflowByte = -1;\n}\n\nUtf16BEDecoder.prototype.write = function(buf) {\n    if (buf.length == 0)\n        return '';\n\n    var buf2 = Buffer.alloc(buf.length + 1),\n        i = 0, j = 0;\n\n    if (this.overflowByte !== -1) {\n        buf2[0] = buf[0];\n        buf2[1] = this.overflowByte;\n        i = 1; j = 2;\n    }\n\n    for (; i < buf.length-1; i += 2, j+= 2) {\n        buf2[j] = buf[i+1];\n        buf2[j+1] = buf[i];\n    }\n\n    this.overflowByte = (i == buf.length-1) ? buf[buf.length-1] : -1;\n\n    return buf2.slice(0, j).toString('ucs2');\n}\n\nUtf16BEDecoder.prototype.end = function() {\n    this.overflowByte = -1;\n}\n\n\n// == UTF-16 codec =============================================================\n// Decoder chooses automatically from UTF-16LE and UTF-16BE using BOM and space-based heuristic.\n// Defaults to UTF-16LE, as it's prevalent and default in Node.\n// http://en.wikipedia.org/wiki/UTF-16 and http://encoding.spec.whatwg.org/#utf-16le\n// Decoder default can be changed: iconv.decode(buf, 'utf16', {defaultEncoding: 'utf-16be'});\n\n// Encoder uses UTF-16LE and prepends BOM (which can be overridden with addBOM: false).\n\nexports.utf16 = Utf16Codec;\nfunction Utf16Codec(codecOptions, iconv) {\n    this.iconv = iconv;\n}\n\nUtf16Codec.prototype.encoder = Utf16Encoder;\nUtf16Codec.prototype.decoder = Utf16Decoder;\n\n\n// -- Encoding (pass-through)\n\nfunction Utf16Encoder(options, codec) {\n    options = options || {};\n    if (options.addBOM === undefined)\n        options.addBOM = true;\n    this.encoder = codec.iconv.getEncoder('utf-16le', options);\n}\n\nUtf16Encoder.prototype.write = function(str) {\n    return this.encoder.write(str);\n}\n\nUtf16Encoder.prototype.end = function() {\n    return this.encoder.end();\n}\n\n\n// -- Decoding\n\nfunction Utf16Decoder(options, codec) {\n    this.decoder = null;\n    this.initialBufs = [];\n    this.initialBufsLen = 0;\n\n    this.options = options || {};\n    this.iconv = codec.iconv;\n}\n\nUtf16Decoder.prototype.write = function(buf) {\n    if (!this.decoder) {\n        // Codec is not chosen yet. Accumulate initial bytes.\n        this.initialBufs.push(buf);\n        this.initialBufsLen += buf.length;\n        \n        if (this.initialBufsLen < 16) // We need more bytes to use space heuristic (see below)\n            return '';\n\n        // We have enough bytes -> detect endianness.\n        var encoding = detectEncoding(this.initialBufs, this.options.defaultEncoding);\n        this.decoder = this.iconv.getDecoder(encoding, this.options);\n\n        var resStr = '';\n        for (var i = 0; i < this.initialBufs.length; i++)\n            resStr += this.decoder.write(this.initialBufs[i]);\n\n        this.initialBufs.length = this.initialBufsLen = 0;\n        return resStr;\n    }\n\n    return this.decoder.write(buf);\n}\n\nUtf16Decoder.prototype.end = function() {\n    if (!this.decoder) {\n        var encoding = detectEncoding(this.initialBufs, this.options.defaultEncoding);\n        this.decoder = this.iconv.getDecoder(encoding, this.options);\n\n        var resStr = '';\n        for (var i = 0; i < this.initialBufs.length; i++)\n            resStr += this.decoder.write(this.initialBufs[i]);\n\n        var trail = this.decoder.end();\n        if (trail)\n            resStr += trail;\n\n        this.initialBufs.length = this.initialBufsLen = 0;\n        return resStr;\n    }\n    return this.decoder.end();\n}\n\nfunction detectEncoding(bufs, defaultEncoding) {\n    var b = [];\n    var charsProcessed = 0;\n    var asciiCharsLE = 0, asciiCharsBE = 0; // Number of ASCII chars when decoded as LE or BE.\n\n    outer_loop:\n    for (var i = 0; i < bufs.length; i++) {\n        var buf = bufs[i];\n        for (var j = 0; j < buf.length; j++) {\n            b.push(buf[j]);\n            if (b.length === 2) {\n                if (charsProcessed === 0) {\n                    // Check BOM first.\n                    if (b[0] === 0xFF && b[1] === 0xFE) return 'utf-16le';\n                    if (b[0] === 0xFE && b[1] === 0xFF) return 'utf-16be';\n                }\n\n                if (b[0] === 0 && b[1] !== 0) asciiCharsBE++;\n                if (b[0] !== 0 && b[1] === 0) asciiCharsLE++;\n\n                b.length = 0;\n                charsProcessed++;\n\n                if (charsProcessed >= 100) {\n                    break outer_loop;\n                }\n            }\n        }\n    }\n\n    // Make decisions.\n    // Most of the time, the content has ASCII chars (U+00**), but the opposite (U+**00) is uncommon.\n    // So, we count ASCII as if it was LE or BE, and decide from that.\n    if (asciiCharsBE > asciiCharsLE) return 'utf-16be';\n    if (asciiCharsBE < asciiCharsLE) return 'utf-16le';\n\n    // Couldn't decide (likely all zeros or not enough data).\n    return defaultEncoding || 'utf-16le';\n}\n\n\n","'use strict';\n\nvar Buffer = require('safer-buffer').Buffer;\n\n// == UTF32-LE/BE codec. ==========================================================\n\nexports._utf32 = Utf32Codec;\n\nfunction Utf32Codec(codecOptions, iconv) {\n    this.iconv = iconv;\n    this.bomAware = true;\n    this.isLE = codecOptions.isLE;\n}\n\nexports.utf32le = { type: '_utf32', isLE: true };\nexports.utf32be = { type: '_utf32', isLE: false };\n\n// Aliases\nexports.ucs4le = 'utf32le';\nexports.ucs4be = 'utf32be';\n\nUtf32Codec.prototype.encoder = Utf32Encoder;\nUtf32Codec.prototype.decoder = Utf32Decoder;\n\n// -- Encoding\n\nfunction Utf32Encoder(options, codec) {\n    this.isLE = codec.isLE;\n    this.highSurrogate = 0;\n}\n\nUtf32Encoder.prototype.write = function(str) {\n    var src = Buffer.from(str, 'ucs2');\n    var dst = Buffer.alloc(src.length * 2);\n    var write32 = this.isLE ? dst.writeUInt32LE : dst.writeUInt32BE;\n    var offset = 0;\n\n    for (var i = 0; i < src.length; i += 2) {\n        var code = src.readUInt16LE(i);\n        var isHighSurrogate = (0xD800 <= code && code < 0xDC00);\n        var isLowSurrogate = (0xDC00 <= code && code < 0xE000);\n\n        if (this.highSurrogate) {\n            if (isHighSurrogate || !isLowSurrogate) {\n                // There shouldn't be two high surrogates in a row, nor a high surrogate which isn't followed by a low\n                // surrogate. If this happens, keep the pending high surrogate as a stand-alone semi-invalid character\n                // (technically wrong, but expected by some applications, like Windows file names).\n                write32.call(dst, this.highSurrogate, offset);\n                offset += 4;\n            }\n            else {\n                // Create 32-bit value from high and low surrogates;\n                var codepoint = (((this.highSurrogate - 0xD800) << 10) | (code - 0xDC00)) + 0x10000;\n\n                write32.call(dst, codepoint, offset);\n                offset += 4;\n                this.highSurrogate = 0;\n\n                continue;\n            }\n        }\n\n        if (isHighSurrogate)\n            this.highSurrogate = code;\n        else {\n            // Even if the current character is a low surrogate, with no previous high surrogate, we'll\n            // encode it as a semi-invalid stand-alone character for the same reasons expressed above for\n            // unpaired high surrogates.\n            write32.call(dst, code, offset);\n            offset += 4;\n            this.highSurrogate = 0;\n        }\n    }\n\n    if (offset < dst.length)\n        dst = dst.slice(0, offset);\n\n    return dst;\n};\n\nUtf32Encoder.prototype.end = function() {\n    // Treat any leftover high surrogate as a semi-valid independent character.\n    if (!this.highSurrogate)\n        return;\n\n    var buf = Buffer.alloc(4);\n\n    if (this.isLE)\n        buf.writeUInt32LE(this.highSurrogate, 0);\n    else\n        buf.writeUInt32BE(this.highSurrogate, 0);\n\n    this.highSurrogate = 0;\n\n    return buf;\n};\n\n// -- Decoding\n\nfunction Utf32Decoder(options, codec) {\n    this.isLE = codec.isLE;\n    this.badChar = codec.iconv.defaultCharUnicode.charCodeAt(0);\n    this.overflow = [];\n}\n\nUtf32Decoder.prototype.write = function(src) {\n    if (src.length === 0)\n        return '';\n\n    var i = 0;\n    var codepoint = 0;\n    var dst = Buffer.alloc(src.length + 4);\n    var offset = 0;\n    var isLE = this.isLE;\n    var overflow = this.overflow;\n    var badChar = this.badChar;\n\n    if (overflow.length > 0) {\n        for (; i < src.length && overflow.length < 4; i++)\n            overflow.push(src[i]);\n        \n        if (overflow.length === 4) {\n            // NOTE: codepoint is a signed int32 and can be negative.\n            // NOTE: We copied this block from below to help V8 optimize it (it works with array, not buffer).\n            if (isLE) {\n                codepoint = overflow[i] | (overflow[i+1] << 8) | (overflow[i+2] << 16) | (overflow[i+3] << 24);\n            } else {\n                codepoint = overflow[i+3] | (overflow[i+2] << 8) | (overflow[i+1] << 16) | (overflow[i] << 24);\n            }\n            overflow.length = 0;\n\n            offset = _writeCodepoint(dst, offset, codepoint, badChar);\n        }\n    }\n\n    // Main loop. Should be as optimized as possible.\n    for (; i < src.length - 3; i += 4) {\n        // NOTE: codepoint is a signed int32 and can be negative.\n        if (isLE) {\n            codepoint = src[i] | (src[i+1] << 8) | (src[i+2] << 16) | (src[i+3] << 24);\n        } else {\n            codepoint = src[i+3] | (src[i+2] << 8) | (src[i+1] << 16) | (src[i] << 24);\n        }\n        offset = _writeCodepoint(dst, offset, codepoint, badChar);\n    }\n\n    // Keep overflowing bytes.\n    for (; i < src.length; i++) {\n        overflow.push(src[i]);\n    }\n\n    return dst.slice(0, offset).toString('ucs2');\n};\n\nfunction _writeCodepoint(dst, offset, codepoint, badChar) {\n    // NOTE: codepoint is signed int32 and can be negative. We keep it that way to help V8 with optimizations.\n    if (codepoint < 0 || codepoint > 0x10FFFF) {\n        // Not a valid Unicode codepoint\n        codepoint = badChar;\n    } \n\n    // Ephemeral Planes: Write high surrogate.\n    if (codepoint >= 0x10000) {\n        codepoint -= 0x10000;\n\n        var high = 0xD800 | (codepoint >> 10);\n        dst[offset++] = high & 0xff;\n        dst[offset++] = high >> 8;\n\n        // Low surrogate is written below.\n        var codepoint = 0xDC00 | (codepoint & 0x3FF);\n    }\n\n    // Write BMP char or low surrogate.\n    dst[offset++] = codepoint & 0xff;\n    dst[offset++] = codepoint >> 8;\n\n    return offset;\n};\n\nUtf32Decoder.prototype.end = function() {\n    this.overflow.length = 0;\n};\n\n// == UTF-32 Auto codec =============================================================\n// Decoder chooses automatically from UTF-32LE and UTF-32BE using BOM and space-based heuristic.\n// Defaults to UTF-32LE. http://en.wikipedia.org/wiki/UTF-32\n// Encoder/decoder default can be changed: iconv.decode(buf, 'utf32', {defaultEncoding: 'utf-32be'});\n\n// Encoder prepends BOM (which can be overridden with (addBOM: false}).\n\nexports.utf32 = Utf32AutoCodec;\nexports.ucs4 = 'utf32';\n\nfunction Utf32AutoCodec(options, iconv) {\n    this.iconv = iconv;\n}\n\nUtf32AutoCodec.prototype.encoder = Utf32AutoEncoder;\nUtf32AutoCodec.prototype.decoder = Utf32AutoDecoder;\n\n// -- Encoding\n\nfunction Utf32AutoEncoder(options, codec) {\n    options = options || {};\n\n    if (options.addBOM === undefined)\n        options.addBOM = true;\n\n    this.encoder = codec.iconv.getEncoder(options.defaultEncoding || 'utf-32le', options);\n}\n\nUtf32AutoEncoder.prototype.write = function(str) {\n    return this.encoder.write(str);\n};\n\nUtf32AutoEncoder.prototype.end = function() {\n    return this.encoder.end();\n};\n\n// -- Decoding\n\nfunction Utf32AutoDecoder(options, codec) {\n    this.decoder = null;\n    this.initialBufs = [];\n    this.initialBufsLen = 0;\n    this.options = options || {};\n    this.iconv = codec.iconv;\n}\n\nUtf32AutoDecoder.prototype.write = function(buf) {\n    if (!this.decoder) { \n        // Codec is not chosen yet. Accumulate initial bytes.\n        this.initialBufs.push(buf);\n        this.initialBufsLen += buf.length;\n\n        if (this.initialBufsLen < 32) // We need more bytes to use space heuristic (see below)\n            return '';\n\n        // We have enough bytes -> detect endianness.\n        var encoding = detectEncoding(this.initialBufs, this.options.defaultEncoding);\n        this.decoder = this.iconv.getDecoder(encoding, this.options);\n\n        var resStr = '';\n        for (var i = 0; i < this.initialBufs.length; i++)\n            resStr += this.decoder.write(this.initialBufs[i]);\n\n        this.initialBufs.length = this.initialBufsLen = 0;\n        return resStr;\n    }\n\n    return this.decoder.write(buf);\n};\n\nUtf32AutoDecoder.prototype.end = function() {\n    if (!this.decoder) {\n        var encoding = detectEncoding(this.initialBufs, this.options.defaultEncoding);\n        this.decoder = this.iconv.getDecoder(encoding, this.options);\n\n        var resStr = '';\n        for (var i = 0; i < this.initialBufs.length; i++)\n            resStr += this.decoder.write(this.initialBufs[i]);\n\n        var trail = this.decoder.end();\n        if (trail)\n            resStr += trail;\n\n        this.initialBufs.length = this.initialBufsLen = 0;\n        return resStr;\n    }\n\n    return this.decoder.end();\n};\n\nfunction detectEncoding(bufs, defaultEncoding) {\n    var b = [];\n    var charsProcessed = 0;\n    var invalidLE = 0, invalidBE = 0;   // Number of invalid chars when decoded as LE or BE.\n    var bmpCharsLE = 0, bmpCharsBE = 0; // Number of BMP chars when decoded as LE or BE.\n\n    outer_loop:\n    for (var i = 0; i < bufs.length; i++) {\n        var buf = bufs[i];\n        for (var j = 0; j < buf.length; j++) {\n            b.push(buf[j]);\n            if (b.length === 4) {\n                if (charsProcessed === 0) {\n                    // Check BOM first.\n                    if (b[0] === 0xFF && b[1] === 0xFE && b[2] === 0 && b[3] === 0) {\n                        return 'utf-32le';\n                    }\n                    if (b[0] === 0 && b[1] === 0 && b[2] === 0xFE && b[3] === 0xFF) {\n                        return 'utf-32be';\n                    }\n                }\n\n                if (b[0] !== 0 || b[1] > 0x10) invalidBE++;\n                if (b[3] !== 0 || b[2] > 0x10) invalidLE++;\n\n                if (b[0] === 0 && b[1] === 0 && (b[2] !== 0 || b[3] !== 0)) bmpCharsBE++;\n                if ((b[0] !== 0 || b[1] !== 0) && b[2] === 0 && b[3] === 0) bmpCharsLE++;\n\n                b.length = 0;\n                charsProcessed++;\n\n                if (charsProcessed >= 100) {\n                    break outer_loop;\n                }\n            }\n        }\n    }\n\n    // Make decisions.\n    if (bmpCharsBE - invalidBE > bmpCharsLE - invalidLE)  return 'utf-32be';\n    if (bmpCharsBE - invalidBE < bmpCharsLE - invalidLE)  return 'utf-32le';\n\n    // Couldn't decide (likely all zeros or not enough data).\n    return defaultEncoding || 'utf-32le';\n}\n","\"use strict\";\nvar Buffer = require(\"safer-buffer\").Buffer;\n\n// UTF-7 codec, according to https://tools.ietf.org/html/rfc2152\n// See also below a UTF-7-IMAP codec, according to http://tools.ietf.org/html/rfc3501#section-5.1.3\n\nexports.utf7 = Utf7Codec;\nexports.unicode11utf7 = 'utf7'; // Alias UNICODE-1-1-UTF-7\nfunction Utf7Codec(codecOptions, iconv) {\n    this.iconv = iconv;\n};\n\nUtf7Codec.prototype.encoder = Utf7Encoder;\nUtf7Codec.prototype.decoder = Utf7Decoder;\nUtf7Codec.prototype.bomAware = true;\n\n\n// -- Encoding\n\nvar nonDirectChars = /[^A-Za-z0-9'\\(\\),-\\.\\/:\\? \\n\\r\\t]+/g;\n\nfunction Utf7Encoder(options, codec) {\n    this.iconv = codec.iconv;\n}\n\nUtf7Encoder.prototype.write = function(str) {\n    // Naive implementation.\n    // Non-direct chars are encoded as \"+<base64>-\"; single \"+\" char is encoded as \"+-\".\n    return Buffer.from(str.replace(nonDirectChars, function(chunk) {\n        return \"+\" + (chunk === '+' ? '' : \n            this.iconv.encode(chunk, 'utf16-be').toString('base64').replace(/=+$/, '')) \n            + \"-\";\n    }.bind(this)));\n}\n\nUtf7Encoder.prototype.end = function() {\n}\n\n\n// -- Decoding\n\nfunction Utf7Decoder(options, codec) {\n    this.iconv = codec.iconv;\n    this.inBase64 = false;\n    this.base64Accum = '';\n}\n\nvar base64Regex = /[A-Za-z0-9\\/+]/;\nvar base64Chars = [];\nfor (var i = 0; i < 256; i++)\n    base64Chars[i] = base64Regex.test(String.fromCharCode(i));\n\nvar plusChar = '+'.charCodeAt(0), \n    minusChar = '-'.charCodeAt(0),\n    andChar = '&'.charCodeAt(0);\n\nUtf7Decoder.prototype.write = function(buf) {\n    var res = \"\", lastI = 0,\n        inBase64 = this.inBase64,\n        base64Accum = this.base64Accum;\n\n    // The decoder is more involved as we must handle chunks in stream.\n\n    for (var i = 0; i < buf.length; i++) {\n        if (!inBase64) { // We're in direct mode.\n            // Write direct chars until '+'\n            if (buf[i] == plusChar) {\n                res += this.iconv.decode(buf.slice(lastI, i), \"ascii\"); // Write direct chars.\n                lastI = i+1;\n                inBase64 = true;\n            }\n        } else { // We decode base64.\n            if (!base64Chars[buf[i]]) { // Base64 ended.\n                if (i == lastI && buf[i] == minusChar) {// \"+-\" -> \"+\"\n                    res += \"+\";\n                } else {\n                    var b64str = base64Accum + this.iconv.decode(buf.slice(lastI, i), \"ascii\");\n                    res += this.iconv.decode(Buffer.from(b64str, 'base64'), \"utf16-be\");\n                }\n\n                if (buf[i] != minusChar) // Minus is absorbed after base64.\n                    i--;\n\n                lastI = i+1;\n                inBase64 = false;\n                base64Accum = '';\n            }\n        }\n    }\n\n    if (!inBase64) {\n        res += this.iconv.decode(buf.slice(lastI), \"ascii\"); // Write direct chars.\n    } else {\n        var b64str = base64Accum + this.iconv.decode(buf.slice(lastI), \"ascii\");\n\n        var canBeDecoded = b64str.length - (b64str.length % 8); // Minimal chunk: 2 quads -> 2x3 bytes -> 3 chars.\n        base64Accum = b64str.slice(canBeDecoded); // The rest will be decoded in future.\n        b64str = b64str.slice(0, canBeDecoded);\n\n        res += this.iconv.decode(Buffer.from(b64str, 'base64'), \"utf16-be\");\n    }\n\n    this.inBase64 = inBase64;\n    this.base64Accum = base64Accum;\n\n    return res;\n}\n\nUtf7Decoder.prototype.end = function() {\n    var res = \"\";\n    if (this.inBase64 && this.base64Accum.length > 0)\n        res = this.iconv.decode(Buffer.from(this.base64Accum, 'base64'), \"utf16-be\");\n\n    this.inBase64 = false;\n    this.base64Accum = '';\n    return res;\n}\n\n\n// UTF-7-IMAP codec.\n// RFC3501 Sec. 5.1.3 Modified UTF-7 (http://tools.ietf.org/html/rfc3501#section-5.1.3)\n// Differences:\n//  * Base64 part is started by \"&\" instead of \"+\"\n//  * Direct characters are 0x20-0x7E, except \"&\" (0x26)\n//  * In Base64, \",\" is used instead of \"/\"\n//  * Base64 must not be used to represent direct characters.\n//  * No implicit shift back from Base64 (should always end with '-')\n//  * String must end in non-shifted position.\n//  * \"-&\" while in base64 is not allowed.\n\n\nexports.utf7imap = Utf7IMAPCodec;\nfunction Utf7IMAPCodec(codecOptions, iconv) {\n    this.iconv = iconv;\n};\n\nUtf7IMAPCodec.prototype.encoder = Utf7IMAPEncoder;\nUtf7IMAPCodec.prototype.decoder = Utf7IMAPDecoder;\nUtf7IMAPCodec.prototype.bomAware = true;\n\n\n// -- Encoding\n\nfunction Utf7IMAPEncoder(options, codec) {\n    this.iconv = codec.iconv;\n    this.inBase64 = false;\n    this.base64Accum = Buffer.alloc(6);\n    this.base64AccumIdx = 0;\n}\n\nUtf7IMAPEncoder.prototype.write = function(str) {\n    var inBase64 = this.inBase64,\n        base64Accum = this.base64Accum,\n        base64AccumIdx = this.base64AccumIdx,\n        buf = Buffer.alloc(str.length*5 + 10), bufIdx = 0;\n\n    for (var i = 0; i < str.length; i++) {\n        var uChar = str.charCodeAt(i);\n        if (0x20 <= uChar && uChar <= 0x7E) { // Direct character or '&'.\n            if (inBase64) {\n                if (base64AccumIdx > 0) {\n                    bufIdx += buf.write(base64Accum.slice(0, base64AccumIdx).toString('base64').replace(/\\//g, ',').replace(/=+$/, ''), bufIdx);\n                    base64AccumIdx = 0;\n                }\n\n                buf[bufIdx++] = minusChar; // Write '-', then go to direct mode.\n                inBase64 = false;\n            }\n\n            if (!inBase64) {\n                buf[bufIdx++] = uChar; // Write direct character\n\n                if (uChar === andChar)  // Ampersand -> '&-'\n                    buf[bufIdx++] = minusChar;\n            }\n\n        } else { // Non-direct character\n            if (!inBase64) {\n                buf[bufIdx++] = andChar; // Write '&', then go to base64 mode.\n                inBase64 = true;\n            }\n            if (inBase64) {\n                base64Accum[base64AccumIdx++] = uChar >> 8;\n                base64Accum[base64AccumIdx++] = uChar & 0xFF;\n\n                if (base64AccumIdx == base64Accum.length) {\n                    bufIdx += buf.write(base64Accum.toString('base64').replace(/\\//g, ','), bufIdx);\n                    base64AccumIdx = 0;\n                }\n            }\n        }\n    }\n\n    this.inBase64 = inBase64;\n    this.base64AccumIdx = base64AccumIdx;\n\n    return buf.slice(0, bufIdx);\n}\n\nUtf7IMAPEncoder.prototype.end = function() {\n    var buf = Buffer.alloc(10), bufIdx = 0;\n    if (this.inBase64) {\n        if (this.base64AccumIdx > 0) {\n            bufIdx += buf.write(this.base64Accum.slice(0, this.base64AccumIdx).toString('base64').replace(/\\//g, ',').replace(/=+$/, ''), bufIdx);\n            this.base64AccumIdx = 0;\n        }\n\n        buf[bufIdx++] = minusChar; // Write '-', then go to direct mode.\n        this.inBase64 = false;\n    }\n\n    return buf.slice(0, bufIdx);\n}\n\n\n// -- Decoding\n\nfunction Utf7IMAPDecoder(options, codec) {\n    this.iconv = codec.iconv;\n    this.inBase64 = false;\n    this.base64Accum = '';\n}\n\nvar base64IMAPChars = base64Chars.slice();\nbase64IMAPChars[','.charCodeAt(0)] = true;\n\nUtf7IMAPDecoder.prototype.write = function(buf) {\n    var res = \"\", lastI = 0,\n        inBase64 = this.inBase64,\n        base64Accum = this.base64Accum;\n\n    // The decoder is more involved as we must handle chunks in stream.\n    // It is forgiving, closer to standard UTF-7 (for example, '-' is optional at the end).\n\n    for (var i = 0; i < buf.length; i++) {\n        if (!inBase64) { // We're in direct mode.\n            // Write direct chars until '&'\n            if (buf[i] == andChar) {\n                res += this.iconv.decode(buf.slice(lastI, i), \"ascii\"); // Write direct chars.\n                lastI = i+1;\n                inBase64 = true;\n            }\n        } else { // We decode base64.\n            if (!base64IMAPChars[buf[i]]) { // Base64 ended.\n                if (i == lastI && buf[i] == minusChar) { // \"&-\" -> \"&\"\n                    res += \"&\";\n                } else {\n                    var b64str = base64Accum + this.iconv.decode(buf.slice(lastI, i), \"ascii\").replace(/,/g, '/');\n                    res += this.iconv.decode(Buffer.from(b64str, 'base64'), \"utf16-be\");\n                }\n\n                if (buf[i] != minusChar) // Minus may be absorbed after base64.\n                    i--;\n\n                lastI = i+1;\n                inBase64 = false;\n                base64Accum = '';\n            }\n        }\n    }\n\n    if (!inBase64) {\n        res += this.iconv.decode(buf.slice(lastI), \"ascii\"); // Write direct chars.\n    } else {\n        var b64str = base64Accum + this.iconv.decode(buf.slice(lastI), \"ascii\").replace(/,/g, '/');\n\n        var canBeDecoded = b64str.length - (b64str.length % 8); // Minimal chunk: 2 quads -> 2x3 bytes -> 3 chars.\n        base64Accum = b64str.slice(canBeDecoded); // The rest will be decoded in future.\n        b64str = b64str.slice(0, canBeDecoded);\n\n        res += this.iconv.decode(Buffer.from(b64str, 'base64'), \"utf16-be\");\n    }\n\n    this.inBase64 = inBase64;\n    this.base64Accum = base64Accum;\n\n    return res;\n}\n\nUtf7IMAPDecoder.prototype.end = function() {\n    var res = \"\";\n    if (this.inBase64 && this.base64Accum.length > 0)\n        res = this.iconv.decode(Buffer.from(this.base64Accum, 'base64'), \"utf16-be\");\n\n    this.inBase64 = false;\n    this.base64Accum = '';\n    return res;\n}\n\n\n","\"use strict\";\n\nvar BOMChar = '\\uFEFF';\n\nexports.PrependBOM = PrependBOMWrapper\nfunction PrependBOMWrapper(encoder, options) {\n    this.encoder = encoder;\n    this.addBOM = true;\n}\n\nPrependBOMWrapper.prototype.write = function(str) {\n    if (this.addBOM) {\n        str = BOMChar + str;\n        this.addBOM = false;\n    }\n\n    return this.encoder.write(str);\n}\n\nPrependBOMWrapper.prototype.end = function() {\n    return this.encoder.end();\n}\n\n\n//------------------------------------------------------------------------------\n\nexports.StripBOM = StripBOMWrapper;\nfunction StripBOMWrapper(decoder, options) {\n    this.decoder = decoder;\n    this.pass = false;\n    this.options = options || {};\n}\n\nStripBOMWrapper.prototype.write = function(buf) {\n    var res = this.decoder.write(buf);\n    if (this.pass || !res)\n        return res;\n\n    if (res[0] === BOMChar) {\n        res = res.slice(1);\n        if (typeof this.options.stripBOM === 'function')\n            this.options.stripBOM();\n    }\n\n    this.pass = true;\n    return res;\n}\n\nStripBOMWrapper.prototype.end = function() {\n    return this.decoder.end();\n}\n\n","\"use strict\";\n\nvar Buffer = require(\"safer-buffer\").Buffer;\n\nvar bomHandling = require(\"./bom-handling\"),\n    iconv = module.exports;\n\n// All codecs and aliases are kept here, keyed by encoding name/alias.\n// They are lazy loaded in `iconv.getCodec` from `encodings/index.js`.\niconv.encodings = null;\n\n// Characters emitted in case of error.\niconv.defaultCharUnicode = '';\niconv.defaultCharSingleByte = '?';\n\n// Public API.\niconv.encode = function encode(str, encoding, options) {\n    str = \"\" + (str || \"\"); // Ensure string.\n\n    var encoder = iconv.getEncoder(encoding, options);\n\n    var res = encoder.write(str);\n    var trail = encoder.end();\n    \n    return (trail && trail.length > 0) ? Buffer.concat([res, trail]) : res;\n}\n\niconv.decode = function decode(buf, encoding, options) {\n    if (typeof buf === 'string') {\n        if (!iconv.skipDecodeWarning) {\n            console.error('Iconv-lite warning: decode()-ing strings is deprecated. Refer to https://github.com/ashtuchkin/iconv-lite/wiki/Use-Buffers-when-decoding');\n            iconv.skipDecodeWarning = true;\n        }\n\n        buf = Buffer.from(\"\" + (buf || \"\"), \"binary\"); // Ensure buffer.\n    }\n\n    var decoder = iconv.getDecoder(encoding, options);\n\n    var res = decoder.write(buf);\n    var trail = decoder.end();\n\n    return trail ? (res + trail) : res;\n}\n\niconv.encodingExists = function encodingExists(enc) {\n    try {\n        iconv.getCodec(enc);\n        return true;\n    } catch (e) {\n        return false;\n    }\n}\n\n// Legacy aliases to convert functions\niconv.toEncoding = iconv.encode;\niconv.fromEncoding = iconv.decode;\n\n// Search for a codec in iconv.encodings. Cache codec data in iconv._codecDataCache.\niconv._codecDataCache = {};\niconv.getCodec = function getCodec(encoding) {\n    if (!iconv.encodings)\n        iconv.encodings = require(\"../encodings\"); // Lazy load all encoding definitions.\n    \n    // Canonicalize encoding name: strip all non-alphanumeric chars and appended year.\n    var enc = iconv._canonicalizeEncoding(encoding);\n\n    // Traverse iconv.encodings to find actual codec.\n    var codecOptions = {};\n    while (true) {\n        var codec = iconv._codecDataCache[enc];\n        if (codec)\n            return codec;\n\n        var codecDef = iconv.encodings[enc];\n\n        switch (typeof codecDef) {\n            case \"string\": // Direct alias to other encoding.\n                enc = codecDef;\n                break;\n\n            case \"object\": // Alias with options. Can be layered.\n                for (var key in codecDef)\n                    codecOptions[key] = codecDef[key];\n\n                if (!codecOptions.encodingName)\n                    codecOptions.encodingName = enc;\n                \n                enc = codecDef.type;\n                break;\n\n            case \"function\": // Codec itself.\n                if (!codecOptions.encodingName)\n                    codecOptions.encodingName = enc;\n\n                // The codec function must load all tables and return object with .encoder and .decoder methods.\n                // It'll be called only once (for each different options object).\n                codec = new codecDef(codecOptions, iconv);\n\n                iconv._codecDataCache[codecOptions.encodingName] = codec; // Save it to be reused later.\n                return codec;\n\n            default:\n                throw new Error(\"Encoding not recognized: '\" + encoding + \"' (searched as: '\"+enc+\"')\");\n        }\n    }\n}\n\niconv._canonicalizeEncoding = function(encoding) {\n    // Canonicalize encoding name: strip all non-alphanumeric chars and appended year.\n    return (''+encoding).toLowerCase().replace(/:\\d{4}$|[^0-9a-z]/g, \"\");\n}\n\niconv.getEncoder = function getEncoder(encoding, options) {\n    var codec = iconv.getCodec(encoding),\n        encoder = new codec.encoder(options, codec);\n\n    if (codec.bomAware && options && options.addBOM)\n        encoder = new bomHandling.PrependBOM(encoder, options);\n\n    return encoder;\n}\n\niconv.getDecoder = function getDecoder(encoding, options) {\n    var codec = iconv.getCodec(encoding),\n        decoder = new codec.decoder(options, codec);\n\n    if (codec.bomAware && !(options && options.stripBOM === false))\n        decoder = new bomHandling.StripBOM(decoder, options);\n\n    return decoder;\n}\n\n// Streaming API\n// NOTE: Streaming API naturally depends on 'stream' module from Node.js. Unfortunately in browser environments this module can add\n// up to 100Kb to the output bundle. To avoid unnecessary code bloat, we don't enable Streaming API in browser by default.\n// If you would like to enable it explicitly, please add the following code to your app:\n// > iconv.enableStreamingAPI(require('stream'));\niconv.enableStreamingAPI = function enableStreamingAPI(stream_module) {\n    if (iconv.supportsStreams)\n        return;\n\n    // Dependency-inject stream module to create IconvLite stream classes.\n    var streams = require(\"./streams\")(stream_module);\n\n    // Not public API yet, but expose the stream classes.\n    iconv.IconvLiteEncoderStream = streams.IconvLiteEncoderStream;\n    iconv.IconvLiteDecoderStream = streams.IconvLiteDecoderStream;\n\n    // Streaming API.\n    iconv.encodeStream = function encodeStream(encoding, options) {\n        return new iconv.IconvLiteEncoderStream(iconv.getEncoder(encoding, options), options);\n    }\n\n    iconv.decodeStream = function decodeStream(encoding, options) {\n        return new iconv.IconvLiteDecoderStream(iconv.getDecoder(encoding, options), options);\n    }\n\n    iconv.supportsStreams = true;\n}\n\n// Enable Streaming API automatically if 'stream' module is available and non-empty (the majority of environments).\nvar stream_module;\ntry {\n    stream_module = require(\"stream\");\n} catch (e) {}\n\nif (stream_module && stream_module.Transform) {\n    iconv.enableStreamingAPI(stream_module);\n\n} else {\n    // In rare cases where 'stream' module is not available by default, throw a helpful exception.\n    iconv.encodeStream = iconv.decodeStream = function() {\n        throw new Error(\"iconv-lite Streaming API is not enabled. Use iconv.enableStreamingAPI(require('stream')); to enable it.\");\n    };\n}\n\nif (\"\" != \"\\u0100\") {\n    console.error(\"iconv-lite warning: js files use non-utf8 encoding. See https://github.com/ashtuchkin/iconv-lite/wiki/Javascript-source-file-encodings for more info.\");\n}\n","\"use strict\";\n\nvar Buffer = require(\"safer-buffer\").Buffer;\n\n// NOTE: Due to 'stream' module being pretty large (~100Kb, significant in browser environments), \n// we opt to dependency-inject it instead of creating a hard dependency.\nmodule.exports = function(stream_module) {\n    var Transform = stream_module.Transform;\n\n    // == Encoder stream =======================================================\n\n    function IconvLiteEncoderStream(conv, options) {\n        this.conv = conv;\n        options = options || {};\n        options.decodeStrings = false; // We accept only strings, so we don't need to decode them.\n        Transform.call(this, options);\n    }\n\n    IconvLiteEncoderStream.prototype = Object.create(Transform.prototype, {\n        constructor: { value: IconvLiteEncoderStream }\n    });\n\n    IconvLiteEncoderStream.prototype._transform = function(chunk, encoding, done) {\n        if (typeof chunk != 'string')\n            return done(new Error(\"Iconv encoding stream needs strings as its input.\"));\n        try {\n            var res = this.conv.write(chunk);\n            if (res && res.length) this.push(res);\n            done();\n        }\n        catch (e) {\n            done(e);\n        }\n    }\n\n    IconvLiteEncoderStream.prototype._flush = function(done) {\n        try {\n            var res = this.conv.end();\n            if (res && res.length) this.push(res);\n            done();\n        }\n        catch (e) {\n            done(e);\n        }\n    }\n\n    IconvLiteEncoderStream.prototype.collect = function(cb) {\n        var chunks = [];\n        this.on('error', cb);\n        this.on('data', function(chunk) { chunks.push(chunk); });\n        this.on('end', function() {\n            cb(null, Buffer.concat(chunks));\n        });\n        return this;\n    }\n\n\n    // == Decoder stream =======================================================\n\n    function IconvLiteDecoderStream(conv, options) {\n        this.conv = conv;\n        options = options || {};\n        options.encoding = this.encoding = 'utf8'; // We output strings.\n        Transform.call(this, options);\n    }\n\n    IconvLiteDecoderStream.prototype = Object.create(Transform.prototype, {\n        constructor: { value: IconvLiteDecoderStream }\n    });\n\n    IconvLiteDecoderStream.prototype._transform = function(chunk, encoding, done) {\n        if (!Buffer.isBuffer(chunk) && !(chunk instanceof Uint8Array))\n            return done(new Error(\"Iconv decoding stream needs buffers as its input.\"));\n        try {\n            var res = this.conv.write(chunk);\n            if (res && res.length) this.push(res, this.encoding);\n            done();\n        }\n        catch (e) {\n            done(e);\n        }\n    }\n\n    IconvLiteDecoderStream.prototype._flush = function(done) {\n        try {\n            var res = this.conv.end();\n            if (res && res.length) this.push(res, this.encoding);                \n            done();\n        }\n        catch (e) {\n            done(e);\n        }\n    }\n\n    IconvLiteDecoderStream.prototype.collect = function(cb) {\n        var res = '';\n        this.on('error', cb);\n        this.on('data', function(chunk) { res += chunk; });\n        this.on('end', function() {\n            cb(null, res);\n        });\n        return this;\n    }\n\n    return {\n        IconvLiteEncoderStream: IconvLiteEncoderStream,\n        IconvLiteDecoderStream: IconvLiteDecoderStream,\n    };\n};\n","/* eslint-disable node/no-deprecated-api */\n\n'use strict'\n\nvar buffer = require('buffer')\nvar Buffer = buffer.Buffer\n\nvar safer = {}\n\nvar key\n\nfor (key in buffer) {\n  if (!buffer.hasOwnProperty(key)) continue\n  if (key === 'SlowBuffer' || key === 'Buffer') continue\n  safer[key] = buffer[key]\n}\n\nvar Safer = safer.Buffer = {}\nfor (key in Buffer) {\n  if (!Buffer.hasOwnProperty(key)) continue\n  if (key === 'allocUnsafe' || key === 'allocUnsafeSlow') continue\n  Safer[key] = Buffer[key]\n}\n\nsafer.Buffer.prototype = Buffer.prototype\n\nif (!Safer.from || Safer.from === Uint8Array.from) {\n  Safer.from = function (value, encodingOrOffset, length) {\n    if (typeof value === 'number') {\n      throw new TypeError('The \"value\" argument must not be of type number. Received type ' + typeof value)\n    }\n    if (value && typeof value.length === 'undefined') {\n      throw new TypeError('The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type ' + typeof value)\n    }\n    return Buffer(value, encodingOrOffset, length)\n  }\n}\n\nif (!Safer.alloc) {\n  Safer.alloc = function (size, fill, encoding) {\n    if (typeof size !== 'number') {\n      throw new TypeError('The \"size\" argument must be of type number. Received type ' + typeof size)\n    }\n    if (size < 0 || size >= 2 * (1 << 30)) {\n      throw new RangeError('The value \"' + size + '\" is invalid for option \"size\"')\n    }\n    var buf = Buffer(size)\n    if (!fill || fill.length === 0) {\n      buf.fill(0)\n    } else if (typeof encoding === 'string') {\n      buf.fill(fill, encoding)\n    } else {\n      buf.fill(fill)\n    }\n    return buf\n  }\n}\n\nif (!safer.kStringMaxLength) {\n  try {\n    safer.kStringMaxLength = process.binding('buffer').kStringMaxLength\n  } catch (e) {\n    // we can't determine kStringMaxLength in environments where process.binding\n    // is unsupported, so let's not set it\n  }\n}\n\nif (!safer.constants) {\n  safer.constants = {\n    MAX_LENGTH: safer.kMaxLength\n  }\n  if (safer.kStringMaxLength) {\n    safer.constants.MAX_STRING_LENGTH = safer.kStringMaxLength\n  }\n}\n\nmodule.exports = safer\n","\"use strict\";\n\nvar conversions = {};\nmodule.exports = conversions;\n\nfunction sign(x) {\n    return x < 0 ? -1 : 1;\n}\n\nfunction evenRound(x) {\n    // Round x to the nearest integer, choosing the even integer if it lies halfway between two.\n    if ((x % 1) === 0.5 && (x & 1) === 0) { // [even number].5; round down (i.e. floor)\n        return Math.floor(x);\n    } else {\n        return Math.round(x);\n    }\n}\n\nfunction createNumberConversion(bitLength, typeOpts) {\n    if (!typeOpts.unsigned) {\n        --bitLength;\n    }\n    const lowerBound = typeOpts.unsigned ? 0 : -Math.pow(2, bitLength);\n    const upperBound = Math.pow(2, bitLength) - 1;\n\n    const moduloVal = typeOpts.moduloBitLength ? Math.pow(2, typeOpts.moduloBitLength) : Math.pow(2, bitLength);\n    const moduloBound = typeOpts.moduloBitLength ? Math.pow(2, typeOpts.moduloBitLength - 1) : Math.pow(2, bitLength - 1);\n\n    return function(V, opts) {\n        if (!opts) opts = {};\n\n        let x = +V;\n\n        if (opts.enforceRange) {\n            if (!Number.isFinite(x)) {\n                throw new TypeError(\"Argument is not a finite number\");\n            }\n\n            x = sign(x) * Math.floor(Math.abs(x));\n            if (x < lowerBound || x > upperBound) {\n                throw new TypeError(\"Argument is not in byte range\");\n            }\n\n            return x;\n        }\n\n        if (!isNaN(x) && opts.clamp) {\n            x = evenRound(x);\n\n            if (x < lowerBound) x = lowerBound;\n            if (x > upperBound) x = upperBound;\n            return x;\n        }\n\n        if (!Number.isFinite(x) || x === 0) {\n            return 0;\n        }\n\n        x = sign(x) * Math.floor(Math.abs(x));\n        x = x % moduloVal;\n\n        if (!typeOpts.unsigned && x >= moduloBound) {\n            return x - moduloVal;\n        } else if (typeOpts.unsigned) {\n            if (x < 0) {\n              x += moduloVal;\n            } else if (x === -0) { // don't return negative zero\n              return 0;\n            }\n        }\n\n        return x;\n    }\n}\n\nconversions[\"void\"] = function () {\n    return undefined;\n};\n\nconversions[\"boolean\"] = function (val) {\n    return !!val;\n};\n\nconversions[\"byte\"] = createNumberConversion(8, { unsigned: false });\nconversions[\"octet\"] = createNumberConversion(8, { unsigned: true });\n\nconversions[\"short\"] = createNumberConversion(16, { unsigned: false });\nconversions[\"unsigned short\"] = createNumberConversion(16, { unsigned: true });\n\nconversions[\"long\"] = createNumberConversion(32, { unsigned: false });\nconversions[\"unsigned long\"] = createNumberConversion(32, { unsigned: true });\n\nconversions[\"long long\"] = createNumberConversion(32, { unsigned: false, moduloBitLength: 64 });\nconversions[\"unsigned long long\"] = createNumberConversion(32, { unsigned: true, moduloBitLength: 64 });\n\nconversions[\"double\"] = function (V) {\n    const x = +V;\n\n    if (!Number.isFinite(x)) {\n        throw new TypeError(\"Argument is not a finite floating-point value\");\n    }\n\n    return x;\n};\n\nconversions[\"unrestricted double\"] = function (V) {\n    const x = +V;\n\n    if (isNaN(x)) {\n        throw new TypeError(\"Argument is NaN\");\n    }\n\n    return x;\n};\n\n// not quite valid, but good enough for JS\nconversions[\"float\"] = conversions[\"double\"];\nconversions[\"unrestricted float\"] = conversions[\"unrestricted double\"];\n\nconversions[\"DOMString\"] = function (V, opts) {\n    if (!opts) opts = {};\n\n    if (opts.treatNullAsEmptyString && V === null) {\n        return \"\";\n    }\n\n    return String(V);\n};\n\nconversions[\"ByteString\"] = function (V, opts) {\n    const x = String(V);\n    let c = undefined;\n    for (let i = 0; (c = x.codePointAt(i)) !== undefined; ++i) {\n        if (c > 255) {\n            throw new TypeError(\"Argument is not a valid bytestring\");\n        }\n    }\n\n    return x;\n};\n\nconversions[\"USVString\"] = function (V) {\n    const S = String(V);\n    const n = S.length;\n    const U = [];\n    for (let i = 0; i < n; ++i) {\n        const c = S.charCodeAt(i);\n        if (c < 0xD800 || c > 0xDFFF) {\n            U.push(String.fromCodePoint(c));\n        } else if (0xDC00 <= c && c <= 0xDFFF) {\n            U.push(String.fromCodePoint(0xFFFD));\n        } else {\n            if (i === n - 1) {\n                U.push(String.fromCodePoint(0xFFFD));\n            } else {\n                const d = S.charCodeAt(i + 1);\n                if (0xDC00 <= d && d <= 0xDFFF) {\n                    const a = c & 0x3FF;\n                    const b = d & 0x3FF;\n                    U.push(String.fromCodePoint((2 << 15) + (2 << 9) * a + b));\n                    ++i;\n                } else {\n                    U.push(String.fromCodePoint(0xFFFD));\n                }\n            }\n        }\n    }\n\n    return U.join('');\n};\n\nconversions[\"Date\"] = function (V, opts) {\n    if (!(V instanceof Date)) {\n        throw new TypeError(\"Argument is not a Date object\");\n    }\n    if (isNaN(V)) {\n        return undefined;\n    }\n\n    return V;\n};\n\nconversions[\"RegExp\"] = function (V, opts) {\n    if (!(V instanceof RegExp)) {\n        V = new RegExp(V);\n    }\n\n    return V;\n};\n","\"use strict\";\nconst usm = require(\"./url-state-machine\");\n\nexports.implementation = class URLImpl {\n  constructor(constructorArgs) {\n    const url = constructorArgs[0];\n    const base = constructorArgs[1];\n\n    let parsedBase = null;\n    if (base !== undefined) {\n      parsedBase = usm.basicURLParse(base);\n      if (parsedBase === \"failure\") {\n        throw new TypeError(\"Invalid base URL\");\n      }\n    }\n\n    const parsedURL = usm.basicURLParse(url, { baseURL: parsedBase });\n    if (parsedURL === \"failure\") {\n      throw new TypeError(\"Invalid URL\");\n    }\n\n    this._url = parsedURL;\n\n    // TODO: query stuff\n  }\n\n  get href() {\n    return usm.serializeURL(this._url);\n  }\n\n  set href(v) {\n    const parsedURL = usm.basicURLParse(v);\n    if (parsedURL === \"failure\") {\n      throw new TypeError(\"Invalid URL\");\n    }\n\n    this._url = parsedURL;\n  }\n\n  get origin() {\n    return usm.serializeURLOrigin(this._url);\n  }\n\n  get protocol() {\n    return this._url.scheme + \":\";\n  }\n\n  set protocol(v) {\n    usm.basicURLParse(v + \":\", { url: this._url, stateOverride: \"scheme start\" });\n  }\n\n  get username() {\n    return this._url.username;\n  }\n\n  set username(v) {\n    if (usm.cannotHaveAUsernamePasswordPort(this._url)) {\n      return;\n    }\n\n    usm.setTheUsername(this._url, v);\n  }\n\n  get password() {\n    return this._url.password;\n  }\n\n  set password(v) {\n    if (usm.cannotHaveAUsernamePasswordPort(this._url)) {\n      return;\n    }\n\n    usm.setThePassword(this._url, v);\n  }\n\n  get host() {\n    const url = this._url;\n\n    if (url.host === null) {\n      return \"\";\n    }\n\n    if (url.port === null) {\n      return usm.serializeHost(url.host);\n    }\n\n    return usm.serializeHost(url.host) + \":\" + usm.serializeInteger(url.port);\n  }\n\n  set host(v) {\n    if (this._url.cannotBeABaseURL) {\n      return;\n    }\n\n    usm.basicURLParse(v, { url: this._url, stateOverride: \"host\" });\n  }\n\n  get hostname() {\n    if (this._url.host === null) {\n      return \"\";\n    }\n\n    return usm.serializeHost(this._url.host);\n  }\n\n  set hostname(v) {\n    if (this._url.cannotBeABaseURL) {\n      return;\n    }\n\n    usm.basicURLParse(v, { url: this._url, stateOverride: \"hostname\" });\n  }\n\n  get port() {\n    if (this._url.port === null) {\n      return \"\";\n    }\n\n    return usm.serializeInteger(this._url.port);\n  }\n\n  set port(v) {\n    if (usm.cannotHaveAUsernamePasswordPort(this._url)) {\n      return;\n    }\n\n    if (v === \"\") {\n      this._url.port = null;\n    } else {\n      usm.basicURLParse(v, { url: this._url, stateOverride: \"port\" });\n    }\n  }\n\n  get pathname() {\n    if (this._url.cannotBeABaseURL) {\n      return this._url.path[0];\n    }\n\n    if (this._url.path.length === 0) {\n      return \"\";\n    }\n\n    return \"/\" + this._url.path.join(\"/\");\n  }\n\n  set pathname(v) {\n    if (this._url.cannotBeABaseURL) {\n      return;\n    }\n\n    this._url.path = [];\n    usm.basicURLParse(v, { url: this._url, stateOverride: \"path start\" });\n  }\n\n  get search() {\n    if (this._url.query === null || this._url.query === \"\") {\n      return \"\";\n    }\n\n    return \"?\" + this._url.query;\n  }\n\n  set search(v) {\n    // TODO: query stuff\n\n    const url = this._url;\n\n    if (v === \"\") {\n      url.query = null;\n      return;\n    }\n\n    const input = v[0] === \"?\" ? v.substring(1) : v;\n    url.query = \"\";\n    usm.basicURLParse(input, { url, stateOverride: \"query\" });\n  }\n\n  get hash() {\n    if (this._url.fragment === null || this._url.fragment === \"\") {\n      return \"\";\n    }\n\n    return \"#\" + this._url.fragment;\n  }\n\n  set hash(v) {\n    if (v === \"\") {\n      this._url.fragment = null;\n      return;\n    }\n\n    const input = v[0] === \"#\" ? v.substring(1) : v;\n    this._url.fragment = \"\";\n    usm.basicURLParse(input, { url: this._url, stateOverride: \"fragment\" });\n  }\n\n  toJSON() {\n    return this.href;\n  }\n};\n","\"use strict\";\n\nconst conversions = require(\"webidl-conversions\");\nconst utils = require(\"./utils.js\");\nconst Impl = require(\".//URL-impl.js\");\n\nconst impl = utils.implSymbol;\n\nfunction URL(url) {\n  if (!this || this[impl] || !(this instanceof URL)) {\n    throw new TypeError(\"Failed to construct 'URL': Please use the 'new' operator, this DOM object constructor cannot be called as a function.\");\n  }\n  if (arguments.length < 1) {\n    throw new TypeError(\"Failed to construct 'URL': 1 argument required, but only \" + arguments.length + \" present.\");\n  }\n  const args = [];\n  for (let i = 0; i < arguments.length && i < 2; ++i) {\n    args[i] = arguments[i];\n  }\n  args[0] = conversions[\"USVString\"](args[0]);\n  if (args[1] !== undefined) {\n  args[1] = conversions[\"USVString\"](args[1]);\n  }\n\n  module.exports.setup(this, args);\n}\n\nURL.prototype.toJSON = function toJSON() {\n  if (!this || !module.exports.is(this)) {\n    throw new TypeError(\"Illegal invocation\");\n  }\n  const args = [];\n  for (let i = 0; i < arguments.length && i < 0; ++i) {\n    args[i] = arguments[i];\n  }\n  return this[impl].toJSON.apply(this[impl], args);\n};\nObject.defineProperty(URL.prototype, \"href\", {\n  get() {\n    return this[impl].href;\n  },\n  set(V) {\n    V = conversions[\"USVString\"](V);\n    this[impl].href = V;\n  },\n  enumerable: true,\n  configurable: true\n});\n\nURL.prototype.toString = function () {\n  if (!this || !module.exports.is(this)) {\n    throw new TypeError(\"Illegal invocation\");\n  }\n  return this.href;\n};\n\nObject.defineProperty(URL.prototype, \"origin\", {\n  get() {\n    return this[impl].origin;\n  },\n  enumerable: true,\n  configurable: true\n});\n\nObject.defineProperty(URL.prototype, \"protocol\", {\n  get() {\n    return this[impl].protocol;\n  },\n  set(V) {\n    V = conversions[\"USVString\"](V);\n    this[impl].protocol = V;\n  },\n  enumerable: true,\n  configurable: true\n});\n\nObject.defineProperty(URL.prototype, \"username\", {\n  get() {\n    return this[impl].username;\n  },\n  set(V) {\n    V = conversions[\"USVString\"](V);\n    this[impl].username = V;\n  },\n  enumerable: true,\n  configurable: true\n});\n\nObject.defineProperty(URL.prototype, \"password\", {\n  get() {\n    return this[impl].password;\n  },\n  set(V) {\n    V = conversions[\"USVString\"](V);\n    this[impl].password = V;\n  },\n  enumerable: true,\n  configurable: true\n});\n\nObject.defineProperty(URL.prototype, \"host\", {\n  get() {\n    return this[impl].host;\n  },\n  set(V) {\n    V = conversions[\"USVString\"](V);\n    this[impl].host = V;\n  },\n  enumerable: true,\n  configurable: true\n});\n\nObject.defineProperty(URL.prototype, \"hostname\", {\n  get() {\n    return this[impl].hostname;\n  },\n  set(V) {\n    V = conversions[\"USVString\"](V);\n    this[impl].hostname = V;\n  },\n  enumerable: true,\n  configurable: true\n});\n\nObject.defineProperty(URL.prototype, \"port\", {\n  get() {\n    return this[impl].port;\n  },\n  set(V) {\n    V = conversions[\"USVString\"](V);\n    this[impl].port = V;\n  },\n  enumerable: true,\n  configurable: true\n});\n\nObject.defineProperty(URL.prototype, \"pathname\", {\n  get() {\n    return this[impl].pathname;\n  },\n  set(V) {\n    V = conversions[\"USVString\"](V);\n    this[impl].pathname = V;\n  },\n  enumerable: true,\n  configurable: true\n});\n\nObject.defineProperty(URL.prototype, \"search\", {\n  get() {\n    return this[impl].search;\n  },\n  set(V) {\n    V = conversions[\"USVString\"](V);\n    this[impl].search = V;\n  },\n  enumerable: true,\n  configurable: true\n});\n\nObject.defineProperty(URL.prototype, \"hash\", {\n  get() {\n    return this[impl].hash;\n  },\n  set(V) {\n    V = conversions[\"USVString\"](V);\n    this[impl].hash = V;\n  },\n  enumerable: true,\n  configurable: true\n});\n\n\nmodule.exports = {\n  is(obj) {\n    return !!obj && obj[impl] instanceof Impl.implementation;\n  },\n  create(constructorArgs, privateData) {\n    let obj = Object.create(URL.prototype);\n    this.setup(obj, constructorArgs, privateData);\n    return obj;\n  },\n  setup(obj, constructorArgs, privateData) {\n    if (!privateData) privateData = {};\n    privateData.wrapper = obj;\n\n    obj[impl] = new Impl.implementation(constructorArgs, privateData);\n    obj[impl][utils.wrapperSymbol] = obj;\n  },\n  interface: URL,\n  expose: {\n    Window: { URL: URL },\n    Worker: { URL: URL }\n  }\n};\n\n","\"use strict\";\n\nexports.URL = require(\"./URL\").interface;\nexports.serializeURL = require(\"./url-state-machine\").serializeURL;\nexports.serializeURLOrigin = require(\"./url-state-machine\").serializeURLOrigin;\nexports.basicURLParse = require(\"./url-state-machine\").basicURLParse;\nexports.setTheUsername = require(\"./url-state-machine\").setTheUsername;\nexports.setThePassword = require(\"./url-state-machine\").setThePassword;\nexports.serializeHost = require(\"./url-state-machine\").serializeHost;\nexports.serializeInteger = require(\"./url-state-machine\").serializeInteger;\nexports.parseURL = require(\"./url-state-machine\").parseURL;\n","\"use strict\";\r\nconst punycode = require(\"punycode\");\r\nconst tr46 = require(\"tr46\");\r\n\r\nconst specialSchemes = {\r\n  ftp: 21,\r\n  file: null,\r\n  gopher: 70,\r\n  http: 80,\r\n  https: 443,\r\n  ws: 80,\r\n  wss: 443\r\n};\r\n\r\nconst failure = Symbol(\"failure\");\r\n\r\nfunction countSymbols(str) {\r\n  return punycode.ucs2.decode(str).length;\r\n}\r\n\r\nfunction at(input, idx) {\r\n  const c = input[idx];\r\n  return isNaN(c) ? undefined : String.fromCodePoint(c);\r\n}\r\n\r\nfunction isASCIIDigit(c) {\r\n  return c >= 0x30 && c <= 0x39;\r\n}\r\n\r\nfunction isASCIIAlpha(c) {\r\n  return (c >= 0x41 && c <= 0x5A) || (c >= 0x61 && c <= 0x7A);\r\n}\r\n\r\nfunction isASCIIAlphanumeric(c) {\r\n  return isASCIIAlpha(c) || isASCIIDigit(c);\r\n}\r\n\r\nfunction isASCIIHex(c) {\r\n  return isASCIIDigit(c) || (c >= 0x41 && c <= 0x46) || (c >= 0x61 && c <= 0x66);\r\n}\r\n\r\nfunction isSingleDot(buffer) {\r\n  return buffer === \".\" || buffer.toLowerCase() === \"%2e\";\r\n}\r\n\r\nfunction isDoubleDot(buffer) {\r\n  buffer = buffer.toLowerCase();\r\n  return buffer === \"..\" || buffer === \"%2e.\" || buffer === \".%2e\" || buffer === \"%2e%2e\";\r\n}\r\n\r\nfunction isWindowsDriveLetterCodePoints(cp1, cp2) {\r\n  return isASCIIAlpha(cp1) && (cp2 === 58 || cp2 === 124);\r\n}\r\n\r\nfunction isWindowsDriveLetterString(string) {\r\n  return string.length === 2 && isASCIIAlpha(string.codePointAt(0)) && (string[1] === \":\" || string[1] === \"|\");\r\n}\r\n\r\nfunction isNormalizedWindowsDriveLetterString(string) {\r\n  return string.length === 2 && isASCIIAlpha(string.codePointAt(0)) && string[1] === \":\";\r\n}\r\n\r\nfunction containsForbiddenHostCodePoint(string) {\r\n  return string.search(/\\u0000|\\u0009|\\u000A|\\u000D|\\u0020|#|%|\\/|:|\\?|@|\\[|\\\\|\\]/) !== -1;\r\n}\r\n\r\nfunction containsForbiddenHostCodePointExcludingPercent(string) {\r\n  return string.search(/\\u0000|\\u0009|\\u000A|\\u000D|\\u0020|#|\\/|:|\\?|@|\\[|\\\\|\\]/) !== -1;\r\n}\r\n\r\nfunction isSpecialScheme(scheme) {\r\n  return specialSchemes[scheme] !== undefined;\r\n}\r\n\r\nfunction isSpecial(url) {\r\n  return isSpecialScheme(url.scheme);\r\n}\r\n\r\nfunction defaultPort(scheme) {\r\n  return specialSchemes[scheme];\r\n}\r\n\r\nfunction percentEncode(c) {\r\n  let hex = c.toString(16).toUpperCase();\r\n  if (hex.length === 1) {\r\n    hex = \"0\" + hex;\r\n  }\r\n\r\n  return \"%\" + hex;\r\n}\r\n\r\nfunction utf8PercentEncode(c) {\r\n  const buf = new Buffer(c);\r\n\r\n  let str = \"\";\r\n\r\n  for (let i = 0; i < buf.length; ++i) {\r\n    str += percentEncode(buf[i]);\r\n  }\r\n\r\n  return str;\r\n}\r\n\r\nfunction utf8PercentDecode(str) {\r\n  const input = new Buffer(str);\r\n  const output = [];\r\n  for (let i = 0; i < input.length; ++i) {\r\n    if (input[i] !== 37) {\r\n      output.push(input[i]);\r\n    } else if (input[i] === 37 && isASCIIHex(input[i + 1]) && isASCIIHex(input[i + 2])) {\r\n      output.push(parseInt(input.slice(i + 1, i + 3).toString(), 16));\r\n      i += 2;\r\n    } else {\r\n      output.push(input[i]);\r\n    }\r\n  }\r\n  return new Buffer(output).toString();\r\n}\r\n\r\nfunction isC0ControlPercentEncode(c) {\r\n  return c <= 0x1F || c > 0x7E;\r\n}\r\n\r\nconst extraPathPercentEncodeSet = new Set([32, 34, 35, 60, 62, 63, 96, 123, 125]);\r\nfunction isPathPercentEncode(c) {\r\n  return isC0ControlPercentEncode(c) || extraPathPercentEncodeSet.has(c);\r\n}\r\n\r\nconst extraUserinfoPercentEncodeSet =\r\n  new Set([47, 58, 59, 61, 64, 91, 92, 93, 94, 124]);\r\nfunction isUserinfoPercentEncode(c) {\r\n  return isPathPercentEncode(c) || extraUserinfoPercentEncodeSet.has(c);\r\n}\r\n\r\nfunction percentEncodeChar(c, encodeSetPredicate) {\r\n  const cStr = String.fromCodePoint(c);\r\n\r\n  if (encodeSetPredicate(c)) {\r\n    return utf8PercentEncode(cStr);\r\n  }\r\n\r\n  return cStr;\r\n}\r\n\r\nfunction parseIPv4Number(input) {\r\n  let R = 10;\r\n\r\n  if (input.length >= 2 && input.charAt(0) === \"0\" && input.charAt(1).toLowerCase() === \"x\") {\r\n    input = input.substring(2);\r\n    R = 16;\r\n  } else if (input.length >= 2 && input.charAt(0) === \"0\") {\r\n    input = input.substring(1);\r\n    R = 8;\r\n  }\r\n\r\n  if (input === \"\") {\r\n    return 0;\r\n  }\r\n\r\n  const regex = R === 10 ? /[^0-9]/ : (R === 16 ? /[^0-9A-Fa-f]/ : /[^0-7]/);\r\n  if (regex.test(input)) {\r\n    return failure;\r\n  }\r\n\r\n  return parseInt(input, R);\r\n}\r\n\r\nfunction parseIPv4(input) {\r\n  const parts = input.split(\".\");\r\n  if (parts[parts.length - 1] === \"\") {\r\n    if (parts.length > 1) {\r\n      parts.pop();\r\n    }\r\n  }\r\n\r\n  if (parts.length > 4) {\r\n    return input;\r\n  }\r\n\r\n  const numbers = [];\r\n  for (const part of parts) {\r\n    if (part === \"\") {\r\n      return input;\r\n    }\r\n    const n = parseIPv4Number(part);\r\n    if (n === failure) {\r\n      return input;\r\n    }\r\n\r\n    numbers.push(n);\r\n  }\r\n\r\n  for (let i = 0; i < numbers.length - 1; ++i) {\r\n    if (numbers[i] > 255) {\r\n      return failure;\r\n    }\r\n  }\r\n  if (numbers[numbers.length - 1] >= Math.pow(256, 5 - numbers.length)) {\r\n    return failure;\r\n  }\r\n\r\n  let ipv4 = numbers.pop();\r\n  let counter = 0;\r\n\r\n  for (const n of numbers) {\r\n    ipv4 += n * Math.pow(256, 3 - counter);\r\n    ++counter;\r\n  }\r\n\r\n  return ipv4;\r\n}\r\n\r\nfunction serializeIPv4(address) {\r\n  let output = \"\";\r\n  let n = address;\r\n\r\n  for (let i = 1; i <= 4; ++i) {\r\n    output = String(n % 256) + output;\r\n    if (i !== 4) {\r\n      output = \".\" + output;\r\n    }\r\n    n = Math.floor(n / 256);\r\n  }\r\n\r\n  return output;\r\n}\r\n\r\nfunction parseIPv6(input) {\r\n  const address = [0, 0, 0, 0, 0, 0, 0, 0];\r\n  let pieceIndex = 0;\r\n  let compress = null;\r\n  let pointer = 0;\r\n\r\n  input = punycode.ucs2.decode(input);\r\n\r\n  if (input[pointer] === 58) {\r\n    if (input[pointer + 1] !== 58) {\r\n      return failure;\r\n    }\r\n\r\n    pointer += 2;\r\n    ++pieceIndex;\r\n    compress = pieceIndex;\r\n  }\r\n\r\n  while (pointer < input.length) {\r\n    if (pieceIndex === 8) {\r\n      return failure;\r\n    }\r\n\r\n    if (input[pointer] === 58) {\r\n      if (compress !== null) {\r\n        return failure;\r\n      }\r\n      ++pointer;\r\n      ++pieceIndex;\r\n      compress = pieceIndex;\r\n      continue;\r\n    }\r\n\r\n    let value = 0;\r\n    let length = 0;\r\n\r\n    while (length < 4 && isASCIIHex(input[pointer])) {\r\n      value = value * 0x10 + parseInt(at(input, pointer), 16);\r\n      ++pointer;\r\n      ++length;\r\n    }\r\n\r\n    if (input[pointer] === 46) {\r\n      if (length === 0) {\r\n        return failure;\r\n      }\r\n\r\n      pointer -= length;\r\n\r\n      if (pieceIndex > 6) {\r\n        return failure;\r\n      }\r\n\r\n      let numbersSeen = 0;\r\n\r\n      while (input[pointer] !== undefined) {\r\n        let ipv4Piece = null;\r\n\r\n        if (numbersSeen > 0) {\r\n          if (input[pointer] === 46 && numbersSeen < 4) {\r\n            ++pointer;\r\n          } else {\r\n            return failure;\r\n          }\r\n        }\r\n\r\n        if (!isASCIIDigit(input[pointer])) {\r\n          return failure;\r\n        }\r\n\r\n        while (isASCIIDigit(input[pointer])) {\r\n          const number = parseInt(at(input, pointer));\r\n          if (ipv4Piece === null) {\r\n            ipv4Piece = number;\r\n          } else if (ipv4Piece === 0) {\r\n            return failure;\r\n          } else {\r\n            ipv4Piece = ipv4Piece * 10 + number;\r\n          }\r\n          if (ipv4Piece > 255) {\r\n            return failure;\r\n          }\r\n          ++pointer;\r\n        }\r\n\r\n        address[pieceIndex] = address[pieceIndex] * 0x100 + ipv4Piece;\r\n\r\n        ++numbersSeen;\r\n\r\n        if (numbersSeen === 2 || numbersSeen === 4) {\r\n          ++pieceIndex;\r\n        }\r\n      }\r\n\r\n      if (numbersSeen !== 4) {\r\n        return failure;\r\n      }\r\n\r\n      break;\r\n    } else if (input[pointer] === 58) {\r\n      ++pointer;\r\n      if (input[pointer] === undefined) {\r\n        return failure;\r\n      }\r\n    } else if (input[pointer] !== undefined) {\r\n      return failure;\r\n    }\r\n\r\n    address[pieceIndex] = value;\r\n    ++pieceIndex;\r\n  }\r\n\r\n  if (compress !== null) {\r\n    let swaps = pieceIndex - compress;\r\n    pieceIndex = 7;\r\n    while (pieceIndex !== 0 && swaps > 0) {\r\n      const temp = address[compress + swaps - 1];\r\n      address[compress + swaps - 1] = address[pieceIndex];\r\n      address[pieceIndex] = temp;\r\n      --pieceIndex;\r\n      --swaps;\r\n    }\r\n  } else if (compress === null && pieceIndex !== 8) {\r\n    return failure;\r\n  }\r\n\r\n  return address;\r\n}\r\n\r\nfunction serializeIPv6(address) {\r\n  let output = \"\";\r\n  const seqResult = findLongestZeroSequence(address);\r\n  const compress = seqResult.idx;\r\n  let ignore0 = false;\r\n\r\n  for (let pieceIndex = 0; pieceIndex <= 7; ++pieceIndex) {\r\n    if (ignore0 && address[pieceIndex] === 0) {\r\n      continue;\r\n    } else if (ignore0) {\r\n      ignore0 = false;\r\n    }\r\n\r\n    if (compress === pieceIndex) {\r\n      const separator = pieceIndex === 0 ? \"::\" : \":\";\r\n      output += separator;\r\n      ignore0 = true;\r\n      continue;\r\n    }\r\n\r\n    output += address[pieceIndex].toString(16);\r\n\r\n    if (pieceIndex !== 7) {\r\n      output += \":\";\r\n    }\r\n  }\r\n\r\n  return output;\r\n}\r\n\r\nfunction parseHost(input, isSpecialArg) {\r\n  if (input[0] === \"[\") {\r\n    if (input[input.length - 1] !== \"]\") {\r\n      return failure;\r\n    }\r\n\r\n    return parseIPv6(input.substring(1, input.length - 1));\r\n  }\r\n\r\n  if (!isSpecialArg) {\r\n    return parseOpaqueHost(input);\r\n  }\r\n\r\n  const domain = utf8PercentDecode(input);\r\n  const asciiDomain = tr46.toASCII(domain, false, tr46.PROCESSING_OPTIONS.NONTRANSITIONAL, false);\r\n  if (asciiDomain === null) {\r\n    return failure;\r\n  }\r\n\r\n  if (containsForbiddenHostCodePoint(asciiDomain)) {\r\n    return failure;\r\n  }\r\n\r\n  const ipv4Host = parseIPv4(asciiDomain);\r\n  if (typeof ipv4Host === \"number\" || ipv4Host === failure) {\r\n    return ipv4Host;\r\n  }\r\n\r\n  return asciiDomain;\r\n}\r\n\r\nfunction parseOpaqueHost(input) {\r\n  if (containsForbiddenHostCodePointExcludingPercent(input)) {\r\n    return failure;\r\n  }\r\n\r\n  let output = \"\";\r\n  const decoded = punycode.ucs2.decode(input);\r\n  for (let i = 0; i < decoded.length; ++i) {\r\n    output += percentEncodeChar(decoded[i], isC0ControlPercentEncode);\r\n  }\r\n  return output;\r\n}\r\n\r\nfunction findLongestZeroSequence(arr) {\r\n  let maxIdx = null;\r\n  let maxLen = 1; // only find elements > 1\r\n  let currStart = null;\r\n  let currLen = 0;\r\n\r\n  for (let i = 0; i < arr.length; ++i) {\r\n    if (arr[i] !== 0) {\r\n      if (currLen > maxLen) {\r\n        maxIdx = currStart;\r\n        maxLen = currLen;\r\n      }\r\n\r\n      currStart = null;\r\n      currLen = 0;\r\n    } else {\r\n      if (currStart === null) {\r\n        currStart = i;\r\n      }\r\n      ++currLen;\r\n    }\r\n  }\r\n\r\n  // if trailing zeros\r\n  if (currLen > maxLen) {\r\n    maxIdx = currStart;\r\n    maxLen = currLen;\r\n  }\r\n\r\n  return {\r\n    idx: maxIdx,\r\n    len: maxLen\r\n  };\r\n}\r\n\r\nfunction serializeHost(host) {\r\n  if (typeof host === \"number\") {\r\n    return serializeIPv4(host);\r\n  }\r\n\r\n  // IPv6 serializer\r\n  if (host instanceof Array) {\r\n    return \"[\" + serializeIPv6(host) + \"]\";\r\n  }\r\n\r\n  return host;\r\n}\r\n\r\nfunction trimControlChars(url) {\r\n  return url.replace(/^[\\u0000-\\u001F\\u0020]+|[\\u0000-\\u001F\\u0020]+$/g, \"\");\r\n}\r\n\r\nfunction trimTabAndNewline(url) {\r\n  return url.replace(/\\u0009|\\u000A|\\u000D/g, \"\");\r\n}\r\n\r\nfunction shortenPath(url) {\r\n  const path = url.path;\r\n  if (path.length === 0) {\r\n    return;\r\n  }\r\n  if (url.scheme === \"file\" && path.length === 1 && isNormalizedWindowsDriveLetter(path[0])) {\r\n    return;\r\n  }\r\n\r\n  path.pop();\r\n}\r\n\r\nfunction includesCredentials(url) {\r\n  return url.username !== \"\" || url.password !== \"\";\r\n}\r\n\r\nfunction cannotHaveAUsernamePasswordPort(url) {\r\n  return url.host === null || url.host === \"\" || url.cannotBeABaseURL || url.scheme === \"file\";\r\n}\r\n\r\nfunction isNormalizedWindowsDriveLetter(string) {\r\n  return /^[A-Za-z]:$/.test(string);\r\n}\r\n\r\nfunction URLStateMachine(input, base, encodingOverride, url, stateOverride) {\r\n  this.pointer = 0;\r\n  this.input = input;\r\n  this.base = base || null;\r\n  this.encodingOverride = encodingOverride || \"utf-8\";\r\n  this.stateOverride = stateOverride;\r\n  this.url = url;\r\n  this.failure = false;\r\n  this.parseError = false;\r\n\r\n  if (!this.url) {\r\n    this.url = {\r\n      scheme: \"\",\r\n      username: \"\",\r\n      password: \"\",\r\n      host: null,\r\n      port: null,\r\n      path: [],\r\n      query: null,\r\n      fragment: null,\r\n\r\n      cannotBeABaseURL: false\r\n    };\r\n\r\n    const res = trimControlChars(this.input);\r\n    if (res !== this.input) {\r\n      this.parseError = true;\r\n    }\r\n    this.input = res;\r\n  }\r\n\r\n  const res = trimTabAndNewline(this.input);\r\n  if (res !== this.input) {\r\n    this.parseError = true;\r\n  }\r\n  this.input = res;\r\n\r\n  this.state = stateOverride || \"scheme start\";\r\n\r\n  this.buffer = \"\";\r\n  this.atFlag = false;\r\n  this.arrFlag = false;\r\n  this.passwordTokenSeenFlag = false;\r\n\r\n  this.input = punycode.ucs2.decode(this.input);\r\n\r\n  for (; this.pointer <= this.input.length; ++this.pointer) {\r\n    const c = this.input[this.pointer];\r\n    const cStr = isNaN(c) ? undefined : String.fromCodePoint(c);\r\n\r\n    // exec state machine\r\n    const ret = this[\"parse \" + this.state](c, cStr);\r\n    if (!ret) {\r\n      break; // terminate algorithm\r\n    } else if (ret === failure) {\r\n      this.failure = true;\r\n      break;\r\n    }\r\n  }\r\n}\r\n\r\nURLStateMachine.prototype[\"parse scheme start\"] = function parseSchemeStart(c, cStr) {\r\n  if (isASCIIAlpha(c)) {\r\n    this.buffer += cStr.toLowerCase();\r\n    this.state = \"scheme\";\r\n  } else if (!this.stateOverride) {\r\n    this.state = \"no scheme\";\r\n    --this.pointer;\r\n  } else {\r\n    this.parseError = true;\r\n    return failure;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse scheme\"] = function parseScheme(c, cStr) {\r\n  if (isASCIIAlphanumeric(c) || c === 43 || c === 45 || c === 46) {\r\n    this.buffer += cStr.toLowerCase();\r\n  } else if (c === 58) {\r\n    if (this.stateOverride) {\r\n      if (isSpecial(this.url) && !isSpecialScheme(this.buffer)) {\r\n        return false;\r\n      }\r\n\r\n      if (!isSpecial(this.url) && isSpecialScheme(this.buffer)) {\r\n        return false;\r\n      }\r\n\r\n      if ((includesCredentials(this.url) || this.url.port !== null) && this.buffer === \"file\") {\r\n        return false;\r\n      }\r\n\r\n      if (this.url.scheme === \"file\" && (this.url.host === \"\" || this.url.host === null)) {\r\n        return false;\r\n      }\r\n    }\r\n    this.url.scheme = this.buffer;\r\n    this.buffer = \"\";\r\n    if (this.stateOverride) {\r\n      return false;\r\n    }\r\n    if (this.url.scheme === \"file\") {\r\n      if (this.input[this.pointer + 1] !== 47 || this.input[this.pointer + 2] !== 47) {\r\n        this.parseError = true;\r\n      }\r\n      this.state = \"file\";\r\n    } else if (isSpecial(this.url) && this.base !== null && this.base.scheme === this.url.scheme) {\r\n      this.state = \"special relative or authority\";\r\n    } else if (isSpecial(this.url)) {\r\n      this.state = \"special authority slashes\";\r\n    } else if (this.input[this.pointer + 1] === 47) {\r\n      this.state = \"path or authority\";\r\n      ++this.pointer;\r\n    } else {\r\n      this.url.cannotBeABaseURL = true;\r\n      this.url.path.push(\"\");\r\n      this.state = \"cannot-be-a-base-URL path\";\r\n    }\r\n  } else if (!this.stateOverride) {\r\n    this.buffer = \"\";\r\n    this.state = \"no scheme\";\r\n    this.pointer = -1;\r\n  } else {\r\n    this.parseError = true;\r\n    return failure;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse no scheme\"] = function parseNoScheme(c) {\r\n  if (this.base === null || (this.base.cannotBeABaseURL && c !== 35)) {\r\n    return failure;\r\n  } else if (this.base.cannotBeABaseURL && c === 35) {\r\n    this.url.scheme = this.base.scheme;\r\n    this.url.path = this.base.path.slice();\r\n    this.url.query = this.base.query;\r\n    this.url.fragment = \"\";\r\n    this.url.cannotBeABaseURL = true;\r\n    this.state = \"fragment\";\r\n  } else if (this.base.scheme === \"file\") {\r\n    this.state = \"file\";\r\n    --this.pointer;\r\n  } else {\r\n    this.state = \"relative\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse special relative or authority\"] = function parseSpecialRelativeOrAuthority(c) {\r\n  if (c === 47 && this.input[this.pointer + 1] === 47) {\r\n    this.state = \"special authority ignore slashes\";\r\n    ++this.pointer;\r\n  } else {\r\n    this.parseError = true;\r\n    this.state = \"relative\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse path or authority\"] = function parsePathOrAuthority(c) {\r\n  if (c === 47) {\r\n    this.state = \"authority\";\r\n  } else {\r\n    this.state = \"path\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse relative\"] = function parseRelative(c) {\r\n  this.url.scheme = this.base.scheme;\r\n  if (isNaN(c)) {\r\n    this.url.username = this.base.username;\r\n    this.url.password = this.base.password;\r\n    this.url.host = this.base.host;\r\n    this.url.port = this.base.port;\r\n    this.url.path = this.base.path.slice();\r\n    this.url.query = this.base.query;\r\n  } else if (c === 47) {\r\n    this.state = \"relative slash\";\r\n  } else if (c === 63) {\r\n    this.url.username = this.base.username;\r\n    this.url.password = this.base.password;\r\n    this.url.host = this.base.host;\r\n    this.url.port = this.base.port;\r\n    this.url.path = this.base.path.slice();\r\n    this.url.query = \"\";\r\n    this.state = \"query\";\r\n  } else if (c === 35) {\r\n    this.url.username = this.base.username;\r\n    this.url.password = this.base.password;\r\n    this.url.host = this.base.host;\r\n    this.url.port = this.base.port;\r\n    this.url.path = this.base.path.slice();\r\n    this.url.query = this.base.query;\r\n    this.url.fragment = \"\";\r\n    this.state = \"fragment\";\r\n  } else if (isSpecial(this.url) && c === 92) {\r\n    this.parseError = true;\r\n    this.state = \"relative slash\";\r\n  } else {\r\n    this.url.username = this.base.username;\r\n    this.url.password = this.base.password;\r\n    this.url.host = this.base.host;\r\n    this.url.port = this.base.port;\r\n    this.url.path = this.base.path.slice(0, this.base.path.length - 1);\r\n\r\n    this.state = \"path\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse relative slash\"] = function parseRelativeSlash(c) {\r\n  if (isSpecial(this.url) && (c === 47 || c === 92)) {\r\n    if (c === 92) {\r\n      this.parseError = true;\r\n    }\r\n    this.state = \"special authority ignore slashes\";\r\n  } else if (c === 47) {\r\n    this.state = \"authority\";\r\n  } else {\r\n    this.url.username = this.base.username;\r\n    this.url.password = this.base.password;\r\n    this.url.host = this.base.host;\r\n    this.url.port = this.base.port;\r\n    this.state = \"path\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse special authority slashes\"] = function parseSpecialAuthoritySlashes(c) {\r\n  if (c === 47 && this.input[this.pointer + 1] === 47) {\r\n    this.state = \"special authority ignore slashes\";\r\n    ++this.pointer;\r\n  } else {\r\n    this.parseError = true;\r\n    this.state = \"special authority ignore slashes\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse special authority ignore slashes\"] = function parseSpecialAuthorityIgnoreSlashes(c) {\r\n  if (c !== 47 && c !== 92) {\r\n    this.state = \"authority\";\r\n    --this.pointer;\r\n  } else {\r\n    this.parseError = true;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse authority\"] = function parseAuthority(c, cStr) {\r\n  if (c === 64) {\r\n    this.parseError = true;\r\n    if (this.atFlag) {\r\n      this.buffer = \"%40\" + this.buffer;\r\n    }\r\n    this.atFlag = true;\r\n\r\n    // careful, this is based on buffer and has its own pointer (this.pointer != pointer) and inner chars\r\n    const len = countSymbols(this.buffer);\r\n    for (let pointer = 0; pointer < len; ++pointer) {\r\n      const codePoint = this.buffer.codePointAt(pointer);\r\n\r\n      if (codePoint === 58 && !this.passwordTokenSeenFlag) {\r\n        this.passwordTokenSeenFlag = true;\r\n        continue;\r\n      }\r\n      const encodedCodePoints = percentEncodeChar(codePoint, isUserinfoPercentEncode);\r\n      if (this.passwordTokenSeenFlag) {\r\n        this.url.password += encodedCodePoints;\r\n      } else {\r\n        this.url.username += encodedCodePoints;\r\n      }\r\n    }\r\n    this.buffer = \"\";\r\n  } else if (isNaN(c) || c === 47 || c === 63 || c === 35 ||\r\n             (isSpecial(this.url) && c === 92)) {\r\n    if (this.atFlag && this.buffer === \"\") {\r\n      this.parseError = true;\r\n      return failure;\r\n    }\r\n    this.pointer -= countSymbols(this.buffer) + 1;\r\n    this.buffer = \"\";\r\n    this.state = \"host\";\r\n  } else {\r\n    this.buffer += cStr;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse hostname\"] =\r\nURLStateMachine.prototype[\"parse host\"] = function parseHostName(c, cStr) {\r\n  if (this.stateOverride && this.url.scheme === \"file\") {\r\n    --this.pointer;\r\n    this.state = \"file host\";\r\n  } else if (c === 58 && !this.arrFlag) {\r\n    if (this.buffer === \"\") {\r\n      this.parseError = true;\r\n      return failure;\r\n    }\r\n\r\n    const host = parseHost(this.buffer, isSpecial(this.url));\r\n    if (host === failure) {\r\n      return failure;\r\n    }\r\n\r\n    this.url.host = host;\r\n    this.buffer = \"\";\r\n    this.state = \"port\";\r\n    if (this.stateOverride === \"hostname\") {\r\n      return false;\r\n    }\r\n  } else if (isNaN(c) || c === 47 || c === 63 || c === 35 ||\r\n             (isSpecial(this.url) && c === 92)) {\r\n    --this.pointer;\r\n    if (isSpecial(this.url) && this.buffer === \"\") {\r\n      this.parseError = true;\r\n      return failure;\r\n    } else if (this.stateOverride && this.buffer === \"\" &&\r\n               (includesCredentials(this.url) || this.url.port !== null)) {\r\n      this.parseError = true;\r\n      return false;\r\n    }\r\n\r\n    const host = parseHost(this.buffer, isSpecial(this.url));\r\n    if (host === failure) {\r\n      return failure;\r\n    }\r\n\r\n    this.url.host = host;\r\n    this.buffer = \"\";\r\n    this.state = \"path start\";\r\n    if (this.stateOverride) {\r\n      return false;\r\n    }\r\n  } else {\r\n    if (c === 91) {\r\n      this.arrFlag = true;\r\n    } else if (c === 93) {\r\n      this.arrFlag = false;\r\n    }\r\n    this.buffer += cStr;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse port\"] = function parsePort(c, cStr) {\r\n  if (isASCIIDigit(c)) {\r\n    this.buffer += cStr;\r\n  } else if (isNaN(c) || c === 47 || c === 63 || c === 35 ||\r\n             (isSpecial(this.url) && c === 92) ||\r\n             this.stateOverride) {\r\n    if (this.buffer !== \"\") {\r\n      const port = parseInt(this.buffer);\r\n      if (port > Math.pow(2, 16) - 1) {\r\n        this.parseError = true;\r\n        return failure;\r\n      }\r\n      this.url.port = port === defaultPort(this.url.scheme) ? null : port;\r\n      this.buffer = \"\";\r\n    }\r\n    if (this.stateOverride) {\r\n      return false;\r\n    }\r\n    this.state = \"path start\";\r\n    --this.pointer;\r\n  } else {\r\n    this.parseError = true;\r\n    return failure;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nconst fileOtherwiseCodePoints = new Set([47, 92, 63, 35]);\r\n\r\nURLStateMachine.prototype[\"parse file\"] = function parseFile(c) {\r\n  this.url.scheme = \"file\";\r\n\r\n  if (c === 47 || c === 92) {\r\n    if (c === 92) {\r\n      this.parseError = true;\r\n    }\r\n    this.state = \"file slash\";\r\n  } else if (this.base !== null && this.base.scheme === \"file\") {\r\n    if (isNaN(c)) {\r\n      this.url.host = this.base.host;\r\n      this.url.path = this.base.path.slice();\r\n      this.url.query = this.base.query;\r\n    } else if (c === 63) {\r\n      this.url.host = this.base.host;\r\n      this.url.path = this.base.path.slice();\r\n      this.url.query = \"\";\r\n      this.state = \"query\";\r\n    } else if (c === 35) {\r\n      this.url.host = this.base.host;\r\n      this.url.path = this.base.path.slice();\r\n      this.url.query = this.base.query;\r\n      this.url.fragment = \"\";\r\n      this.state = \"fragment\";\r\n    } else {\r\n      if (this.input.length - this.pointer - 1 === 0 || // remaining consists of 0 code points\r\n          !isWindowsDriveLetterCodePoints(c, this.input[this.pointer + 1]) ||\r\n          (this.input.length - this.pointer - 1 >= 2 && // remaining has at least 2 code points\r\n           !fileOtherwiseCodePoints.has(this.input[this.pointer + 2]))) {\r\n        this.url.host = this.base.host;\r\n        this.url.path = this.base.path.slice();\r\n        shortenPath(this.url);\r\n      } else {\r\n        this.parseError = true;\r\n      }\r\n\r\n      this.state = \"path\";\r\n      --this.pointer;\r\n    }\r\n  } else {\r\n    this.state = \"path\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse file slash\"] = function parseFileSlash(c) {\r\n  if (c === 47 || c === 92) {\r\n    if (c === 92) {\r\n      this.parseError = true;\r\n    }\r\n    this.state = \"file host\";\r\n  } else {\r\n    if (this.base !== null && this.base.scheme === \"file\") {\r\n      if (isNormalizedWindowsDriveLetterString(this.base.path[0])) {\r\n        this.url.path.push(this.base.path[0]);\r\n      } else {\r\n        this.url.host = this.base.host;\r\n      }\r\n    }\r\n    this.state = \"path\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse file host\"] = function parseFileHost(c, cStr) {\r\n  if (isNaN(c) || c === 47 || c === 92 || c === 63 || c === 35) {\r\n    --this.pointer;\r\n    if (!this.stateOverride && isWindowsDriveLetterString(this.buffer)) {\r\n      this.parseError = true;\r\n      this.state = \"path\";\r\n    } else if (this.buffer === \"\") {\r\n      this.url.host = \"\";\r\n      if (this.stateOverride) {\r\n        return false;\r\n      }\r\n      this.state = \"path start\";\r\n    } else {\r\n      let host = parseHost(this.buffer, isSpecial(this.url));\r\n      if (host === failure) {\r\n        return failure;\r\n      }\r\n      if (host === \"localhost\") {\r\n        host = \"\";\r\n      }\r\n      this.url.host = host;\r\n\r\n      if (this.stateOverride) {\r\n        return false;\r\n      }\r\n\r\n      this.buffer = \"\";\r\n      this.state = \"path start\";\r\n    }\r\n  } else {\r\n    this.buffer += cStr;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse path start\"] = function parsePathStart(c) {\r\n  if (isSpecial(this.url)) {\r\n    if (c === 92) {\r\n      this.parseError = true;\r\n    }\r\n    this.state = \"path\";\r\n\r\n    if (c !== 47 && c !== 92) {\r\n      --this.pointer;\r\n    }\r\n  } else if (!this.stateOverride && c === 63) {\r\n    this.url.query = \"\";\r\n    this.state = \"query\";\r\n  } else if (!this.stateOverride && c === 35) {\r\n    this.url.fragment = \"\";\r\n    this.state = \"fragment\";\r\n  } else if (c !== undefined) {\r\n    this.state = \"path\";\r\n    if (c !== 47) {\r\n      --this.pointer;\r\n    }\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse path\"] = function parsePath(c) {\r\n  if (isNaN(c) || c === 47 || (isSpecial(this.url) && c === 92) ||\r\n      (!this.stateOverride && (c === 63 || c === 35))) {\r\n    if (isSpecial(this.url) && c === 92) {\r\n      this.parseError = true;\r\n    }\r\n\r\n    if (isDoubleDot(this.buffer)) {\r\n      shortenPath(this.url);\r\n      if (c !== 47 && !(isSpecial(this.url) && c === 92)) {\r\n        this.url.path.push(\"\");\r\n      }\r\n    } else if (isSingleDot(this.buffer) && c !== 47 &&\r\n               !(isSpecial(this.url) && c === 92)) {\r\n      this.url.path.push(\"\");\r\n    } else if (!isSingleDot(this.buffer)) {\r\n      if (this.url.scheme === \"file\" && this.url.path.length === 0 && isWindowsDriveLetterString(this.buffer)) {\r\n        if (this.url.host !== \"\" && this.url.host !== null) {\r\n          this.parseError = true;\r\n          this.url.host = \"\";\r\n        }\r\n        this.buffer = this.buffer[0] + \":\";\r\n      }\r\n      this.url.path.push(this.buffer);\r\n    }\r\n    this.buffer = \"\";\r\n    if (this.url.scheme === \"file\" && (c === undefined || c === 63 || c === 35)) {\r\n      while (this.url.path.length > 1 && this.url.path[0] === \"\") {\r\n        this.parseError = true;\r\n        this.url.path.shift();\r\n      }\r\n    }\r\n    if (c === 63) {\r\n      this.url.query = \"\";\r\n      this.state = \"query\";\r\n    }\r\n    if (c === 35) {\r\n      this.url.fragment = \"\";\r\n      this.state = \"fragment\";\r\n    }\r\n  } else {\r\n    // TODO: If c is not a URL code point and not \"%\", parse error.\r\n\r\n    if (c === 37 &&\r\n      (!isASCIIHex(this.input[this.pointer + 1]) ||\r\n        !isASCIIHex(this.input[this.pointer + 2]))) {\r\n      this.parseError = true;\r\n    }\r\n\r\n    this.buffer += percentEncodeChar(c, isPathPercentEncode);\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse cannot-be-a-base-URL path\"] = function parseCannotBeABaseURLPath(c) {\r\n  if (c === 63) {\r\n    this.url.query = \"\";\r\n    this.state = \"query\";\r\n  } else if (c === 35) {\r\n    this.url.fragment = \"\";\r\n    this.state = \"fragment\";\r\n  } else {\r\n    // TODO: Add: not a URL code point\r\n    if (!isNaN(c) && c !== 37) {\r\n      this.parseError = true;\r\n    }\r\n\r\n    if (c === 37 &&\r\n        (!isASCIIHex(this.input[this.pointer + 1]) ||\r\n         !isASCIIHex(this.input[this.pointer + 2]))) {\r\n      this.parseError = true;\r\n    }\r\n\r\n    if (!isNaN(c)) {\r\n      this.url.path[0] = this.url.path[0] + percentEncodeChar(c, isC0ControlPercentEncode);\r\n    }\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse query\"] = function parseQuery(c, cStr) {\r\n  if (isNaN(c) || (!this.stateOverride && c === 35)) {\r\n    if (!isSpecial(this.url) || this.url.scheme === \"ws\" || this.url.scheme === \"wss\") {\r\n      this.encodingOverride = \"utf-8\";\r\n    }\r\n\r\n    const buffer = new Buffer(this.buffer); // TODO: Use encoding override instead\r\n    for (let i = 0; i < buffer.length; ++i) {\r\n      if (buffer[i] < 0x21 || buffer[i] > 0x7E || buffer[i] === 0x22 || buffer[i] === 0x23 ||\r\n          buffer[i] === 0x3C || buffer[i] === 0x3E) {\r\n        this.url.query += percentEncode(buffer[i]);\r\n      } else {\r\n        this.url.query += String.fromCodePoint(buffer[i]);\r\n      }\r\n    }\r\n\r\n    this.buffer = \"\";\r\n    if (c === 35) {\r\n      this.url.fragment = \"\";\r\n      this.state = \"fragment\";\r\n    }\r\n  } else {\r\n    // TODO: If c is not a URL code point and not \"%\", parse error.\r\n    if (c === 37 &&\r\n      (!isASCIIHex(this.input[this.pointer + 1]) ||\r\n        !isASCIIHex(this.input[this.pointer + 2]))) {\r\n      this.parseError = true;\r\n    }\r\n\r\n    this.buffer += cStr;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse fragment\"] = function parseFragment(c) {\r\n  if (isNaN(c)) { // do nothing\r\n  } else if (c === 0x0) {\r\n    this.parseError = true;\r\n  } else {\r\n    // TODO: If c is not a URL code point and not \"%\", parse error.\r\n    if (c === 37 &&\r\n      (!isASCIIHex(this.input[this.pointer + 1]) ||\r\n        !isASCIIHex(this.input[this.pointer + 2]))) {\r\n      this.parseError = true;\r\n    }\r\n\r\n    this.url.fragment += percentEncodeChar(c, isC0ControlPercentEncode);\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nfunction serializeURL(url, excludeFragment) {\r\n  let output = url.scheme + \":\";\r\n  if (url.host !== null) {\r\n    output += \"//\";\r\n\r\n    if (url.username !== \"\" || url.password !== \"\") {\r\n      output += url.username;\r\n      if (url.password !== \"\") {\r\n        output += \":\" + url.password;\r\n      }\r\n      output += \"@\";\r\n    }\r\n\r\n    output += serializeHost(url.host);\r\n\r\n    if (url.port !== null) {\r\n      output += \":\" + url.port;\r\n    }\r\n  } else if (url.host === null && url.scheme === \"file\") {\r\n    output += \"//\";\r\n  }\r\n\r\n  if (url.cannotBeABaseURL) {\r\n    output += url.path[0];\r\n  } else {\r\n    for (const string of url.path) {\r\n      output += \"/\" + string;\r\n    }\r\n  }\r\n\r\n  if (url.query !== null) {\r\n    output += \"?\" + url.query;\r\n  }\r\n\r\n  if (!excludeFragment && url.fragment !== null) {\r\n    output += \"#\" + url.fragment;\r\n  }\r\n\r\n  return output;\r\n}\r\n\r\nfunction serializeOrigin(tuple) {\r\n  let result = tuple.scheme + \"://\";\r\n  result += serializeHost(tuple.host);\r\n\r\n  if (tuple.port !== null) {\r\n    result += \":\" + tuple.port;\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nmodule.exports.serializeURL = serializeURL;\r\n\r\nmodule.exports.serializeURLOrigin = function (url) {\r\n  // https://url.spec.whatwg.org/#concept-url-origin\r\n  switch (url.scheme) {\r\n    case \"blob\":\r\n      try {\r\n        return module.exports.serializeURLOrigin(module.exports.parseURL(url.path[0]));\r\n      } catch (e) {\r\n        // serializing an opaque origin returns \"null\"\r\n        return \"null\";\r\n      }\r\n    case \"ftp\":\r\n    case \"gopher\":\r\n    case \"http\":\r\n    case \"https\":\r\n    case \"ws\":\r\n    case \"wss\":\r\n      return serializeOrigin({\r\n        scheme: url.scheme,\r\n        host: url.host,\r\n        port: url.port\r\n      });\r\n    case \"file\":\r\n      // spec says \"exercise to the reader\", chrome says \"file://\"\r\n      return \"file://\";\r\n    default:\r\n      // serializing an opaque origin returns \"null\"\r\n      return \"null\";\r\n  }\r\n};\r\n\r\nmodule.exports.basicURLParse = function (input, options) {\r\n  if (options === undefined) {\r\n    options = {};\r\n  }\r\n\r\n  const usm = new URLStateMachine(input, options.baseURL, options.encodingOverride, options.url, options.stateOverride);\r\n  if (usm.failure) {\r\n    return \"failure\";\r\n  }\r\n\r\n  return usm.url;\r\n};\r\n\r\nmodule.exports.setTheUsername = function (url, username) {\r\n  url.username = \"\";\r\n  const decoded = punycode.ucs2.decode(username);\r\n  for (let i = 0; i < decoded.length; ++i) {\r\n    url.username += percentEncodeChar(decoded[i], isUserinfoPercentEncode);\r\n  }\r\n};\r\n\r\nmodule.exports.setThePassword = function (url, password) {\r\n  url.password = \"\";\r\n  const decoded = punycode.ucs2.decode(password);\r\n  for (let i = 0; i < decoded.length; ++i) {\r\n    url.password += percentEncodeChar(decoded[i], isUserinfoPercentEncode);\r\n  }\r\n};\r\n\r\nmodule.exports.serializeHost = serializeHost;\r\n\r\nmodule.exports.cannotHaveAUsernamePasswordPort = cannotHaveAUsernamePasswordPort;\r\n\r\nmodule.exports.serializeInteger = function (integer) {\r\n  return String(integer);\r\n};\r\n\r\nmodule.exports.parseURL = function (input, options) {\r\n  if (options === undefined) {\r\n    options = {};\r\n  }\r\n\r\n  // We don't handle blobs, so this just delegates:\r\n  return module.exports.basicURLParse(input, { baseURL: options.baseURL, encodingOverride: options.encodingOverride });\r\n};\r\n","\"use strict\";\n\nmodule.exports.mixin = function mixin(target, source) {\n  const keys = Object.getOwnPropertyNames(source);\n  for (let i = 0; i < keys.length; ++i) {\n    Object.defineProperty(target, keys[i], Object.getOwnPropertyDescriptor(source, keys[i]));\n  }\n};\n\nmodule.exports.wrapperSymbol = Symbol(\"wrapper\");\nmodule.exports.implSymbol = Symbol(\"impl\");\n\nmodule.exports.wrapperForImpl = function (impl) {\n  return impl[module.exports.wrapperSymbol];\n};\n\nmodule.exports.implForWrapper = function (wrapper) {\n  return wrapper[module.exports.implSymbol];\n};\n\n","function toASCII(d) { return d; }\nmodule.exports = { toASCII };\n","module.exports = require(\"vscode\");","module.exports = require(\"buffer\");","module.exports = require(\"path\");","module.exports = require(\"punycode\");","module.exports = require(\"stream\");","module.exports = require(\"string_decoder\");","/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n  this.size = 0;\n}\n\nexport default listCacheClear;\n","import eq from './eq.js';\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\nexport default assocIndexOf;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype;\n\n/** Built-in value references. */\nvar splice = arrayProto.splice;\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  --this.size;\n  return true;\n}\n\nexport default listCacheDelete;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\nexport default listCacheGet;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\nexport default listCacheHas;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    ++this.size;\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\nexport default listCacheSet;\n","import listCacheClear from './_listCacheClear.js';\nimport listCacheDelete from './_listCacheDelete.js';\nimport listCacheGet from './_listCacheGet.js';\nimport listCacheHas from './_listCacheHas.js';\nimport listCacheSet from './_listCacheSet.js';\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\nexport default ListCache;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map');\n\nexport default Map;\n","import getNative from './_getNative.js';\n\n/* Built-in method references that are verified to be native. */\nvar nativeCreate = getNative(Object, 'create');\n\nexport default nativeCreate;\n","import nativeCreate from './_nativeCreate.js';\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n  this.size = 0;\n}\n\nexport default hashClear;\n","/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  var result = this.has(key) && delete this.__data__[key];\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default hashDelete;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\nexport default hashGet;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);\n}\n\nexport default hashHas;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  this.size += this.has(key) ? 0 : 1;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\nexport default hashSet;\n","import hashClear from './_hashClear.js';\nimport hashDelete from './_hashDelete.js';\nimport hashGet from './_hashGet.js';\nimport hashHas from './_hashHas.js';\nimport hashSet from './_hashSet.js';\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\nexport default Hash;\n","import Hash from './_Hash.js';\nimport ListCache from './_ListCache.js';\nimport Map from './_Map.js';\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.size = 0;\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\nexport default mapCacheClear;\n","/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\nexport default isKeyable;\n","import isKeyable from './_isKeyable.js';\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\nexport default getMapData;\n","import getMapData from './_getMapData.js';\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  var result = getMapData(this, key)['delete'](key);\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default mapCacheDelete;\n","import getMapData from './_getMapData.js';\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\nexport default mapCacheGet;\n","import getMapData from './_getMapData.js';\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\nexport default mapCacheHas;\n","import getMapData from './_getMapData.js';\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  var data = getMapData(this, key),\n      size = data.size;\n\n  data.set(key, value);\n  this.size += data.size == size ? 0 : 1;\n  return this;\n}\n\nexport default mapCacheSet;\n","import mapCacheClear from './_mapCacheClear.js';\nimport mapCacheDelete from './_mapCacheDelete.js';\nimport mapCacheGet from './_mapCacheGet.js';\nimport mapCacheHas from './_mapCacheHas.js';\nimport mapCacheSet from './_mapCacheSet.js';\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\nexport default MapCache;\n","/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Adds `value` to the array cache.\n *\n * @private\n * @name add\n * @memberOf SetCache\n * @alias push\n * @param {*} value The value to cache.\n * @returns {Object} Returns the cache instance.\n */\nfunction setCacheAdd(value) {\n  this.__data__.set(value, HASH_UNDEFINED);\n  return this;\n}\n\nexport default setCacheAdd;\n","/**\n * Checks if `value` is in the array cache.\n *\n * @private\n * @name has\n * @memberOf SetCache\n * @param {*} value The value to search for.\n * @returns {number} Returns `true` if `value` is found, else `false`.\n */\nfunction setCacheHas(value) {\n  return this.__data__.has(value);\n}\n\nexport default setCacheHas;\n","import MapCache from './_MapCache.js';\nimport setCacheAdd from './_setCacheAdd.js';\nimport setCacheHas from './_setCacheHas.js';\n\n/**\n *\n * Creates an array cache object to store unique values.\n *\n * @private\n * @constructor\n * @param {Array} [values] The values to cache.\n */\nfunction SetCache(values) {\n  var index = -1,\n      length = values == null ? 0 : values.length;\n\n  this.__data__ = new MapCache;\n  while (++index < length) {\n    this.add(values[index]);\n  }\n}\n\n// Add methods to `SetCache`.\nSetCache.prototype.add = SetCache.prototype.push = setCacheAdd;\nSetCache.prototype.has = setCacheHas;\n\nexport default SetCache;\n","import ListCache from './_ListCache.js';\n\n/**\n * Removes all key-value entries from the stack.\n *\n * @private\n * @name clear\n * @memberOf Stack\n */\nfunction stackClear() {\n  this.__data__ = new ListCache;\n  this.size = 0;\n}\n\nexport default stackClear;\n","/**\n * Removes `key` and its value from the stack.\n *\n * @private\n * @name delete\n * @memberOf Stack\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction stackDelete(key) {\n  var data = this.__data__,\n      result = data['delete'](key);\n\n  this.size = data.size;\n  return result;\n}\n\nexport default stackDelete;\n","/**\n * Gets the stack value for `key`.\n *\n * @private\n * @name get\n * @memberOf Stack\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction stackGet(key) {\n  return this.__data__.get(key);\n}\n\nexport default stackGet;\n","/**\n * Checks if a stack value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Stack\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction stackHas(key) {\n  return this.__data__.has(key);\n}\n\nexport default stackHas;\n","import ListCache from './_ListCache.js';\nimport Map from './_Map.js';\nimport MapCache from './_MapCache.js';\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/**\n * Sets the stack `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Stack\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the stack cache instance.\n */\nfunction stackSet(key, value) {\n  var data = this.__data__;\n  if (data instanceof ListCache) {\n    var pairs = data.__data__;\n    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {\n      pairs.push([key, value]);\n      this.size = ++data.size;\n      return this;\n    }\n    data = this.__data__ = new MapCache(pairs);\n  }\n  data.set(key, value);\n  this.size = data.size;\n  return this;\n}\n\nexport default stackSet;\n","import ListCache from './_ListCache.js';\nimport stackClear from './_stackClear.js';\nimport stackDelete from './_stackDelete.js';\nimport stackGet from './_stackGet.js';\nimport stackHas from './_stackHas.js';\nimport stackSet from './_stackSet.js';\n\n/**\n * Creates a stack cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Stack(entries) {\n  var data = this.__data__ = new ListCache(entries);\n  this.size = data.size;\n}\n\n// Add methods to `Stack`.\nStack.prototype.clear = stackClear;\nStack.prototype['delete'] = stackDelete;\nStack.prototype.get = stackGet;\nStack.prototype.has = stackHas;\nStack.prototype.set = stackSet;\n\nexport default Stack;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","/**\n * A specialized version of `_.map` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction arrayMap(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      result = Array(length);\n\n  while (++index < length) {\n    result[index] = iteratee(array[index], index, array);\n  }\n  return result;\n}\n\nexport default arrayMap;\n","/**\n * The base implementation of `_.findIndex` and `_.findLastIndex` without\n * support for iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Function} predicate The function invoked per iteration.\n * @param {number} fromIndex The index to search from.\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseFindIndex(array, predicate, fromIndex, fromRight) {\n  var length = array.length,\n      index = fromIndex + (fromRight ? 1 : -1);\n\n  while ((fromRight ? index-- : ++index < length)) {\n    if (predicate(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n}\n\nexport default baseFindIndex;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * A specialized version of `_.some` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {boolean} Returns `true` if any element passes the predicate check,\n *  else `false`.\n */\nfunction arraySome(array, predicate) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (predicate(array[index], index, array)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport default arraySome;\n","import SetCache from './_SetCache.js';\nimport arraySome from './_arraySome.js';\nimport cacheHas from './_cacheHas.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/**\n * A specialized version of `baseIsEqualDeep` for arrays with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Array} array The array to compare.\n * @param {Array} other The other array to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `array` and `other` objects.\n * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.\n */\nfunction equalArrays(array, other, bitmask, customizer, equalFunc, stack) {\n  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,\n      arrLength = array.length,\n      othLength = other.length;\n\n  if (arrLength != othLength && !(isPartial && othLength > arrLength)) {\n    return false;\n  }\n  // Check that cyclic values are equal.\n  var arrStacked = stack.get(array);\n  var othStacked = stack.get(other);\n  if (arrStacked && othStacked) {\n    return arrStacked == other && othStacked == array;\n  }\n  var index = -1,\n      result = true,\n      seen = (bitmask & COMPARE_UNORDERED_FLAG) ? new SetCache : undefined;\n\n  stack.set(array, other);\n  stack.set(other, array);\n\n  // Ignore non-index properties.\n  while (++index < arrLength) {\n    var arrValue = array[index],\n        othValue = other[index];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, arrValue, index, other, array, stack)\n        : customizer(arrValue, othValue, index, array, other, stack);\n    }\n    if (compared !== undefined) {\n      if (compared) {\n        continue;\n      }\n      result = false;\n      break;\n    }\n    // Recursively compare arrays (susceptible to call stack limits).\n    if (seen) {\n      if (!arraySome(other, function(othValue, othIndex) {\n            if (!cacheHas(seen, othIndex) &&\n                (arrValue === othValue || equalFunc(arrValue, othValue, bitmask, customizer, stack))) {\n              return seen.push(othIndex);\n            }\n          })) {\n        result = false;\n        break;\n      }\n    } else if (!(\n          arrValue === othValue ||\n            equalFunc(arrValue, othValue, bitmask, customizer, stack)\n        )) {\n      result = false;\n      break;\n    }\n  }\n  stack['delete'](array);\n  stack['delete'](other);\n  return result;\n}\n\nexport default equalArrays;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Uint8Array = root.Uint8Array;\n\nexport default Uint8Array;\n","/**\n * Converts `map` to its key-value pairs.\n *\n * @private\n * @param {Object} map The map to convert.\n * @returns {Array} Returns the key-value pairs.\n */\nfunction mapToArray(map) {\n  var index = -1,\n      result = Array(map.size);\n\n  map.forEach(function(value, key) {\n    result[++index] = [key, value];\n  });\n  return result;\n}\n\nexport default mapToArray;\n","/**\n * Converts `set` to an array of its values.\n *\n * @private\n * @param {Object} set The set to convert.\n * @returns {Array} Returns the values.\n */\nfunction setToArray(set) {\n  var index = -1,\n      result = Array(set.size);\n\n  set.forEach(function(value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nexport default setToArray;\n","import Symbol from './_Symbol.js';\nimport Uint8Array from './_Uint8Array.js';\nimport eq from './eq.js';\nimport equalArrays from './_equalArrays.js';\nimport mapToArray from './_mapToArray.js';\nimport setToArray from './_setToArray.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/** `Object#toString` result references. */\nvar boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]';\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;\n\n/**\n * A specialized version of `baseIsEqualDeep` for comparing objects of\n * the same `toStringTag`.\n *\n * **Note:** This function only supports comparing values with tags of\n * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {string} tag The `toStringTag` of the objects to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalByTag(object, other, tag, bitmask, customizer, equalFunc, stack) {\n  switch (tag) {\n    case dataViewTag:\n      if ((object.byteLength != other.byteLength) ||\n          (object.byteOffset != other.byteOffset)) {\n        return false;\n      }\n      object = object.buffer;\n      other = other.buffer;\n\n    case arrayBufferTag:\n      if ((object.byteLength != other.byteLength) ||\n          !equalFunc(new Uint8Array(object), new Uint8Array(other))) {\n        return false;\n      }\n      return true;\n\n    case boolTag:\n    case dateTag:\n    case numberTag:\n      // Coerce booleans to `1` or `0` and dates to milliseconds.\n      // Invalid dates are coerced to `NaN`.\n      return eq(+object, +other);\n\n    case errorTag:\n      return object.name == other.name && object.message == other.message;\n\n    case regexpTag:\n    case stringTag:\n      // Coerce regexes to strings and treat strings, primitives and objects,\n      // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring\n      // for more details.\n      return object == (other + '');\n\n    case mapTag:\n      var convert = mapToArray;\n\n    case setTag:\n      var isPartial = bitmask & COMPARE_PARTIAL_FLAG;\n      convert || (convert = setToArray);\n\n      if (object.size != other.size && !isPartial) {\n        return false;\n      }\n      // Assume cyclic values are equal.\n      var stacked = stack.get(object);\n      if (stacked) {\n        return stacked == other;\n      }\n      bitmask |= COMPARE_UNORDERED_FLAG;\n\n      // Recursively compare objects (susceptible to call stack limits).\n      stack.set(object, other);\n      var result = equalArrays(convert(object), convert(other), bitmask, customizer, equalFunc, stack);\n      stack['delete'](object);\n      return result;\n\n    case symbolTag:\n      if (symbolValueOf) {\n        return symbolValueOf.call(object) == symbolValueOf.call(other);\n      }\n  }\n  return false;\n}\n\nexport default equalByTag;\n","/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\nexport default arrayPush;\n","import arrayPush from './_arrayPush.js';\nimport isArray from './isArray.js';\n\n/**\n * The base implementation of `getAllKeys` and `getAllKeysIn` which uses\n * `keysFunc` and `symbolsFunc` to get the enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Function} keysFunc The function to get the keys of `object`.\n * @param {Function} symbolsFunc The function to get the symbols of `object`.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction baseGetAllKeys(object, keysFunc, symbolsFunc) {\n  var result = keysFunc(object);\n  return isArray(object) ? result : arrayPush(result, symbolsFunc(object));\n}\n\nexport default baseGetAllKeys;\n","/**\n * A specialized version of `_.filter` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {Array} Returns the new filtered array.\n */\nfunction arrayFilter(array, predicate) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      resIndex = 0,\n      result = [];\n\n  while (++index < length) {\n    var value = array[index];\n    if (predicate(value, index, array)) {\n      result[resIndex++] = value;\n    }\n  }\n  return result;\n}\n\nexport default arrayFilter;\n","/**\n * This method returns a new empty array.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {Array} Returns the new empty array.\n * @example\n *\n * var arrays = _.times(2, _.stubArray);\n *\n * console.log(arrays);\n * // => [[], []]\n *\n * console.log(arrays[0] === arrays[1]);\n * // => false\n */\nfunction stubArray() {\n  return [];\n}\n\nexport default stubArray;\n","import arrayFilter from './_arrayFilter.js';\nimport stubArray from './stubArray.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols;\n\n/**\n * Creates an array of the own enumerable symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbols = !nativeGetSymbols ? stubArray : function(object) {\n  if (object == null) {\n    return [];\n  }\n  object = Object(object);\n  return arrayFilter(nativeGetSymbols(object), function(symbol) {\n    return propertyIsEnumerable.call(object, symbol);\n  });\n};\n\nexport default getSymbols;\n","import baseGetAllKeys from './_baseGetAllKeys.js';\nimport getSymbols from './_getSymbols.js';\nimport keys from './keys.js';\n\n/**\n * Creates an array of own enumerable property names and symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeys(object) {\n  return baseGetAllKeys(object, keys, getSymbols);\n}\n\nexport default getAllKeys;\n","import getAllKeys from './_getAllKeys.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1;\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * A specialized version of `baseIsEqualDeep` for objects with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalObjects(object, other, bitmask, customizer, equalFunc, stack) {\n  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,\n      objProps = getAllKeys(object),\n      objLength = objProps.length,\n      othProps = getAllKeys(other),\n      othLength = othProps.length;\n\n  if (objLength != othLength && !isPartial) {\n    return false;\n  }\n  var index = objLength;\n  while (index--) {\n    var key = objProps[index];\n    if (!(isPartial ? key in other : hasOwnProperty.call(other, key))) {\n      return false;\n    }\n  }\n  // Check that cyclic values are equal.\n  var objStacked = stack.get(object);\n  var othStacked = stack.get(other);\n  if (objStacked && othStacked) {\n    return objStacked == other && othStacked == object;\n  }\n  var result = true;\n  stack.set(object, other);\n  stack.set(other, object);\n\n  var skipCtor = isPartial;\n  while (++index < objLength) {\n    key = objProps[index];\n    var objValue = object[key],\n        othValue = other[key];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, objValue, key, other, object, stack)\n        : customizer(objValue, othValue, key, object, other, stack);\n    }\n    // Recursively compare objects (susceptible to call stack limits).\n    if (!(compared === undefined\n          ? (objValue === othValue || equalFunc(objValue, othValue, bitmask, customizer, stack))\n          : compared\n        )) {\n      result = false;\n      break;\n    }\n    skipCtor || (skipCtor = key == 'constructor');\n  }\n  if (result && !skipCtor) {\n    var objCtor = object.constructor,\n        othCtor = other.constructor;\n\n    // Non `Object` object instances with different constructors are not equal.\n    if (objCtor != othCtor &&\n        ('constructor' in object && 'constructor' in other) &&\n        !(typeof objCtor == 'function' && objCtor instanceof objCtor &&\n          typeof othCtor == 'function' && othCtor instanceof othCtor)) {\n      result = false;\n    }\n  }\n  stack['delete'](object);\n  stack['delete'](other);\n  return result;\n}\n\nexport default equalObjects;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar DataView = getNative(root, 'DataView');\n\nexport default DataView;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Promise = getNative(root, 'Promise');\n\nexport default Promise;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Set = getNative(root, 'Set');\n\nexport default Set;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar WeakMap = getNative(root, 'WeakMap');\n\nexport default WeakMap;\n","import DataView from './_DataView.js';\nimport Map from './_Map.js';\nimport Promise from './_Promise.js';\nimport Set from './_Set.js';\nimport WeakMap from './_WeakMap.js';\nimport baseGetTag from './_baseGetTag.js';\nimport toSource from './_toSource.js';\n\n/** `Object#toString` result references. */\nvar mapTag = '[object Map]',\n    objectTag = '[object Object]',\n    promiseTag = '[object Promise]',\n    setTag = '[object Set]',\n    weakMapTag = '[object WeakMap]';\n\nvar dataViewTag = '[object DataView]';\n\n/** Used to detect maps, sets, and weakmaps. */\nvar dataViewCtorString = toSource(DataView),\n    mapCtorString = toSource(Map),\n    promiseCtorString = toSource(Promise),\n    setCtorString = toSource(Set),\n    weakMapCtorString = toSource(WeakMap);\n\n/**\n * Gets the `toStringTag` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nvar getTag = baseGetTag;\n\n// Fallback for data views, maps, sets, and weak maps in IE 11 and promises in Node.js < 6.\nif ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||\n    (Map && getTag(new Map) != mapTag) ||\n    (Promise && getTag(Promise.resolve()) != promiseTag) ||\n    (Set && getTag(new Set) != setTag) ||\n    (WeakMap && getTag(new WeakMap) != weakMapTag)) {\n  getTag = function(value) {\n    var result = baseGetTag(value),\n        Ctor = result == objectTag ? value.constructor : undefined,\n        ctorString = Ctor ? toSource(Ctor) : '';\n\n    if (ctorString) {\n      switch (ctorString) {\n        case dataViewCtorString: return dataViewTag;\n        case mapCtorString: return mapTag;\n        case promiseCtorString: return promiseTag;\n        case setCtorString: return setTag;\n        case weakMapCtorString: return weakMapTag;\n      }\n    }\n    return result;\n  };\n}\n\nexport default getTag;\n","import Stack from './_Stack.js';\nimport equalArrays from './_equalArrays.js';\nimport equalByTag from './_equalByTag.js';\nimport equalObjects from './_equalObjects.js';\nimport getTag from './_getTag.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isTypedArray from './isTypedArray.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    objectTag = '[object Object]';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * A specialized version of `baseIsEqual` for arrays and objects which performs\n * deep comparisons and tracks traversed objects enabling objects with circular\n * references to be compared.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} [stack] Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction baseIsEqualDeep(object, other, bitmask, customizer, equalFunc, stack) {\n  var objIsArr = isArray(object),\n      othIsArr = isArray(other),\n      objTag = objIsArr ? arrayTag : getTag(object),\n      othTag = othIsArr ? arrayTag : getTag(other);\n\n  objTag = objTag == argsTag ? objectTag : objTag;\n  othTag = othTag == argsTag ? objectTag : othTag;\n\n  var objIsObj = objTag == objectTag,\n      othIsObj = othTag == objectTag,\n      isSameTag = objTag == othTag;\n\n  if (isSameTag && isBuffer(object)) {\n    if (!isBuffer(other)) {\n      return false;\n    }\n    objIsArr = true;\n    objIsObj = false;\n  }\n  if (isSameTag && !objIsObj) {\n    stack || (stack = new Stack);\n    return (objIsArr || isTypedArray(object))\n      ? equalArrays(object, other, bitmask, customizer, equalFunc, stack)\n      : equalByTag(object, other, objTag, bitmask, customizer, equalFunc, stack);\n  }\n  if (!(bitmask & COMPARE_PARTIAL_FLAG)) {\n    var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),\n        othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');\n\n    if (objIsWrapped || othIsWrapped) {\n      var objUnwrapped = objIsWrapped ? object.value() : object,\n          othUnwrapped = othIsWrapped ? other.value() : other;\n\n      stack || (stack = new Stack);\n      return equalFunc(objUnwrapped, othUnwrapped, bitmask, customizer, stack);\n    }\n  }\n  if (!isSameTag) {\n    return false;\n  }\n  stack || (stack = new Stack);\n  return equalObjects(object, other, bitmask, customizer, equalFunc, stack);\n}\n\nexport default baseIsEqualDeep;\n","import baseIsEqualDeep from './_baseIsEqualDeep.js';\nimport isObjectLike from './isObjectLike.js';\n\n/**\n * The base implementation of `_.isEqual` which supports partial comparisons\n * and tracks traversed objects.\n *\n * @private\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @param {boolean} bitmask The bitmask flags.\n *  1 - Unordered comparison\n *  2 - Partial comparison\n * @param {Function} [customizer] The function to customize comparisons.\n * @param {Object} [stack] Tracks traversed `value` and `other` objects.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n */\nfunction baseIsEqual(value, other, bitmask, customizer, stack) {\n  if (value === other) {\n    return true;\n  }\n  if (value == null || other == null || (!isObjectLike(value) && !isObjectLike(other))) {\n    return value !== value && other !== other;\n  }\n  return baseIsEqualDeep(value, other, bitmask, customizer, baseIsEqual, stack);\n}\n\nexport default baseIsEqual;\n","/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\nexport default baseUnary;\n","/**\n * Checks if a `cache` value for `key` exists.\n *\n * @private\n * @param {Object} cache The cache to query.\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction cacheHas(cache, key) {\n  return cache.has(key);\n}\n\nexport default cacheHas;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import root from './_root.js';\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nexport default coreJsData;\n","import coreJsData from './_coreJsData.js';\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nexport default isMasked;\n","import isFunction from './isFunction.js';\nimport isMasked from './_isMasked.js';\nimport isObject from './isObject.js';\nimport toSource from './_toSource.js';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nexport default baseIsNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nexport default getValue;\n","import baseIsNative from './_baseIsNative.js';\nimport getValue from './_getValue.js';\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nexport default getNative;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  var type = typeof value;\n  length = length == null ? MAX_SAFE_INTEGER : length;\n\n  return !!length &&\n    (type == 'number' ||\n      (type != 'symbol' && reIsUint.test(value))) &&\n        (value > -1 && value % 1 == 0 && value < length);\n}\n\nexport default isIndex;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nexport default toSource;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nexport default eq;\n","/**\n * This method returns the first argument it receives.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Util\n * @param {*} value Any value.\n * @returns {*} Returns `value`.\n * @example\n *\n * var object = { 'a': 1 };\n *\n * console.log(_.identity(object) === object);\n * // => true\n */\nfunction identity(value) {\n  return value;\n}\n\nexport default identity;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]';\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\nexport default baseIsArguments;\n","import baseIsArguments from './_baseIsArguments.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\nexport default isArguments;\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nexport default isArray;\n","import isFunction from './isFunction.js';\nimport isLength from './isLength.js';\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\nexport default isArrayLike;\n","/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nexport default stubFalse;\n","import root from './_root.js';\nimport stubFalse from './stubFalse.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined;\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\nexport default isBuffer;\n","import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\nexport default isLength;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nexport default isSymbol;\n","import baseGetTag from './_baseGetTag.js';\nimport isLength from './isLength.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[baseGetTag(value)];\n}\n\nexport default baseIsTypedArray;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    // Use `util.types` for Node.js 10+.\n    var types = freeModule && freeModule.require && freeModule.require('util').types;\n\n    if (types) {\n      return types;\n    }\n\n    // Legacy `process.binding('util')` for Node.js < 10.\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\nexport default nodeUtil;\n","import baseIsTypedArray from './_baseIsTypedArray.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\nexport default isTypedArray;\n","/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\nexport default baseTimes;\n","import baseTimes from './_baseTimes.js';\nimport isArguments from './isArguments.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isIndex from './_isIndex.js';\nimport isTypedArray from './isTypedArray.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  var isArr = isArray(value),\n      isArg = !isArr && isArguments(value),\n      isBuff = !isArr && !isArg && isBuffer(value),\n      isType = !isArr && !isArg && !isBuff && isTypedArray(value),\n      skipIndexes = isArr || isArg || isBuff || isType,\n      result = skipIndexes ? baseTimes(value.length, String) : [],\n      length = result.length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (\n           // Safari 9 has enumerable `arguments.length` in strict mode.\n           key == 'length' ||\n           // Node.js 0.10 has enumerable non-index properties on buffers.\n           (isBuff && (key == 'offset' || key == 'parent')) ||\n           // PhantomJS 2 has enumerable non-index properties on typed arrays.\n           (isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset')) ||\n           // Skip index properties.\n           isIndex(key, length)\n        ))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default arrayLikeKeys;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\nexport default isPrototype;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nexport default overArg;\n","import overArg from './_overArg.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\nexport default nativeKeys;\n","import isPrototype from './_isPrototype.js';\nimport nativeKeys from './_nativeKeys.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default baseKeys;\n","import arrayLikeKeys from './_arrayLikeKeys.js';\nimport baseKeys from './_baseKeys.js';\nimport isArrayLike from './isArrayLike.js';\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\nexport default keys;\n","import toNumber from './toNumber.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0,\n    MAX_INTEGER = 1.7976931348623157e+308;\n\n/**\n * Converts `value` to a finite number.\n *\n * @static\n * @memberOf _\n * @since 4.12.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {number} Returns the converted number.\n * @example\n *\n * _.toFinite(3.2);\n * // => 3.2\n *\n * _.toFinite(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toFinite(Infinity);\n * // => 1.7976931348623157e+308\n *\n * _.toFinite('3.2');\n * // => 3.2\n */\nfunction toFinite(value) {\n  if (!value) {\n    return value === 0 ? value : 0;\n  }\n  value = toNumber(value);\n  if (value === INFINITY || value === -INFINITY) {\n    var sign = (value < 0 ? -1 : 1);\n    return sign * MAX_INTEGER;\n  }\n  return value === value ? value : 0;\n}\n\nexport default toFinite;\n","import toFinite from './toFinite.js';\n\n/**\n * Converts `value` to an integer.\n *\n * **Note:** This method is loosely based on\n * [`ToInteger`](http://www.ecma-international.org/ecma-262/7.0/#sec-tointeger).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {number} Returns the converted integer.\n * @example\n *\n * _.toInteger(3.2);\n * // => 3\n *\n * _.toInteger(Number.MIN_VALUE);\n * // => 0\n *\n * _.toInteger(Infinity);\n * // => 1.7976931348623157e+308\n *\n * _.toInteger('3.2');\n * // => 3\n */\nfunction toInteger(value) {\n  var result = toFinite(value),\n      remainder = result % 1;\n\n  return result === result ? (remainder ? result - remainder : result) : 0;\n}\n\nexport default toInteger;\n","/** Used to match a single whitespace character. */\nvar reWhitespace = /\\s/;\n\n/**\n * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace\n * character of `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the index of the last non-whitespace character.\n */\nfunction trimmedEndIndex(string) {\n  var index = string.length;\n\n  while (index-- && reWhitespace.test(string.charAt(index))) {}\n  return index;\n}\n\nexport default trimmedEndIndex;\n","import trimmedEndIndex from './_trimmedEndIndex.js';\n\n/** Used to match leading whitespace. */\nvar reTrimStart = /^\\s+/;\n\n/**\n * The base implementation of `_.trim`.\n *\n * @private\n * @param {string} string The string to trim.\n * @returns {string} Returns the trimmed string.\n */\nfunction baseTrim(string) {\n  return string\n    ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, '')\n    : string;\n}\n\nexport default baseTrim;\n","import baseTrim from './_baseTrim.js';\nimport isObject from './isObject.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = baseTrim(value);\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nexport default toNumber;\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"http\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"url\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"https\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"zlib\");","import Stream from 'stream';\nimport http from 'http';\nimport Url from 'url';\nimport whatwgUrl from 'whatwg-url';\nimport https from 'https';\nimport zlib from 'zlib';\n\n// Based on https://github.com/tmpvar/jsdom/blob/aa85b2abf07766ff7bf5c1f6daafb3726f2f2db5/lib/jsdom/living/blob.js\n\n// fix for \"Readable\" isn't a named export issue\nconst Readable = Stream.Readable;\n\nconst BUFFER = Symbol('buffer');\nconst TYPE = Symbol('type');\n\nclass Blob {\n\tconstructor() {\n\t\tthis[TYPE] = '';\n\n\t\tconst blobParts = arguments[0];\n\t\tconst options = arguments[1];\n\n\t\tconst buffers = [];\n\t\tlet size = 0;\n\n\t\tif (blobParts) {\n\t\t\tconst a = blobParts;\n\t\t\tconst length = Number(a.length);\n\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\tconst element = a[i];\n\t\t\t\tlet buffer;\n\t\t\t\tif (element instanceof Buffer) {\n\t\t\t\t\tbuffer = element;\n\t\t\t\t} else if (ArrayBuffer.isView(element)) {\n\t\t\t\t\tbuffer = Buffer.from(element.buffer, element.byteOffset, element.byteLength);\n\t\t\t\t} else if (element instanceof ArrayBuffer) {\n\t\t\t\t\tbuffer = Buffer.from(element);\n\t\t\t\t} else if (element instanceof Blob) {\n\t\t\t\t\tbuffer = element[BUFFER];\n\t\t\t\t} else {\n\t\t\t\t\tbuffer = Buffer.from(typeof element === 'string' ? element : String(element));\n\t\t\t\t}\n\t\t\t\tsize += buffer.length;\n\t\t\t\tbuffers.push(buffer);\n\t\t\t}\n\t\t}\n\n\t\tthis[BUFFER] = Buffer.concat(buffers);\n\n\t\tlet type = options && options.type !== undefined && String(options.type).toLowerCase();\n\t\tif (type && !/[^\\u0020-\\u007E]/.test(type)) {\n\t\t\tthis[TYPE] = type;\n\t\t}\n\t}\n\tget size() {\n\t\treturn this[BUFFER].length;\n\t}\n\tget type() {\n\t\treturn this[TYPE];\n\t}\n\ttext() {\n\t\treturn Promise.resolve(this[BUFFER].toString());\n\t}\n\tarrayBuffer() {\n\t\tconst buf = this[BUFFER];\n\t\tconst ab = buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength);\n\t\treturn Promise.resolve(ab);\n\t}\n\tstream() {\n\t\tconst readable = new Readable();\n\t\treadable._read = function () {};\n\t\treadable.push(this[BUFFER]);\n\t\treadable.push(null);\n\t\treturn readable;\n\t}\n\ttoString() {\n\t\treturn '[object Blob]';\n\t}\n\tslice() {\n\t\tconst size = this.size;\n\n\t\tconst start = arguments[0];\n\t\tconst end = arguments[1];\n\t\tlet relativeStart, relativeEnd;\n\t\tif (start === undefined) {\n\t\t\trelativeStart = 0;\n\t\t} else if (start < 0) {\n\t\t\trelativeStart = Math.max(size + start, 0);\n\t\t} else {\n\t\t\trelativeStart = Math.min(start, size);\n\t\t}\n\t\tif (end === undefined) {\n\t\t\trelativeEnd = size;\n\t\t} else if (end < 0) {\n\t\t\trelativeEnd = Math.max(size + end, 0);\n\t\t} else {\n\t\t\trelativeEnd = Math.min(end, size);\n\t\t}\n\t\tconst span = Math.max(relativeEnd - relativeStart, 0);\n\n\t\tconst buffer = this[BUFFER];\n\t\tconst slicedBuffer = buffer.slice(relativeStart, relativeStart + span);\n\t\tconst blob = new Blob([], { type: arguments[2] });\n\t\tblob[BUFFER] = slicedBuffer;\n\t\treturn blob;\n\t}\n}\n\nObject.defineProperties(Blob.prototype, {\n\tsize: { enumerable: true },\n\ttype: { enumerable: true },\n\tslice: { enumerable: true }\n});\n\nObject.defineProperty(Blob.prototype, Symbol.toStringTag, {\n\tvalue: 'Blob',\n\twritable: false,\n\tenumerable: false,\n\tconfigurable: true\n});\n\n/**\n * fetch-error.js\n *\n * FetchError interface for operational errors\n */\n\n/**\n * Create FetchError instance\n *\n * @param   String      message      Error message for human\n * @param   String      type         Error type for machine\n * @param   String      systemError  For Node.js system error\n * @return  FetchError\n */\nfunction FetchError(message, type, systemError) {\n  Error.call(this, message);\n\n  this.message = message;\n  this.type = type;\n\n  // when err.type is `system`, err.code contains system error code\n  if (systemError) {\n    this.code = this.errno = systemError.code;\n  }\n\n  // hide custom error implementation details from end-users\n  Error.captureStackTrace(this, this.constructor);\n}\n\nFetchError.prototype = Object.create(Error.prototype);\nFetchError.prototype.constructor = FetchError;\nFetchError.prototype.name = 'FetchError';\n\nlet convert;\ntry {\n\tconvert = require('encoding').convert;\n} catch (e) {}\n\nconst INTERNALS = Symbol('Body internals');\n\n// fix an issue where \"PassThrough\" isn't a named export for node <10\nconst PassThrough = Stream.PassThrough;\n\n/**\n * Body mixin\n *\n * Ref: https://fetch.spec.whatwg.org/#body\n *\n * @param   Stream  body  Readable stream\n * @param   Object  opts  Response options\n * @return  Void\n */\nfunction Body(body) {\n\tvar _this = this;\n\n\tvar _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n\t    _ref$size = _ref.size;\n\n\tlet size = _ref$size === undefined ? 0 : _ref$size;\n\tvar _ref$timeout = _ref.timeout;\n\tlet timeout = _ref$timeout === undefined ? 0 : _ref$timeout;\n\n\tif (body == null) {\n\t\t// body is undefined or null\n\t\tbody = null;\n\t} else if (isURLSearchParams(body)) {\n\t\t// body is a URLSearchParams\n\t\tbody = Buffer.from(body.toString());\n\t} else if (isBlob(body)) ; else if (Buffer.isBuffer(body)) ; else if (Object.prototype.toString.call(body) === '[object ArrayBuffer]') {\n\t\t// body is ArrayBuffer\n\t\tbody = Buffer.from(body);\n\t} else if (ArrayBuffer.isView(body)) {\n\t\t// body is ArrayBufferView\n\t\tbody = Buffer.from(body.buffer, body.byteOffset, body.byteLength);\n\t} else if (body instanceof Stream) ; else {\n\t\t// none of the above\n\t\t// coerce to string then buffer\n\t\tbody = Buffer.from(String(body));\n\t}\n\tthis[INTERNALS] = {\n\t\tbody,\n\t\tdisturbed: false,\n\t\terror: null\n\t};\n\tthis.size = size;\n\tthis.timeout = timeout;\n\n\tif (body instanceof Stream) {\n\t\tbody.on('error', function (err) {\n\t\t\tconst error = err.name === 'AbortError' ? err : new FetchError(`Invalid response body while trying to fetch ${_this.url}: ${err.message}`, 'system', err);\n\t\t\t_this[INTERNALS].error = error;\n\t\t});\n\t}\n}\n\nBody.prototype = {\n\tget body() {\n\t\treturn this[INTERNALS].body;\n\t},\n\n\tget bodyUsed() {\n\t\treturn this[INTERNALS].disturbed;\n\t},\n\n\t/**\n  * Decode response as ArrayBuffer\n  *\n  * @return  Promise\n  */\n\tarrayBuffer() {\n\t\treturn consumeBody.call(this).then(function (buf) {\n\t\t\treturn buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength);\n\t\t});\n\t},\n\n\t/**\n  * Return raw response as Blob\n  *\n  * @return Promise\n  */\n\tblob() {\n\t\tlet ct = this.headers && this.headers.get('content-type') || '';\n\t\treturn consumeBody.call(this).then(function (buf) {\n\t\t\treturn Object.assign(\n\t\t\t// Prevent copying\n\t\t\tnew Blob([], {\n\t\t\t\ttype: ct.toLowerCase()\n\t\t\t}), {\n\t\t\t\t[BUFFER]: buf\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n  * Decode response as json\n  *\n  * @return  Promise\n  */\n\tjson() {\n\t\tvar _this2 = this;\n\n\t\treturn consumeBody.call(this).then(function (buffer) {\n\t\t\ttry {\n\t\t\t\treturn JSON.parse(buffer.toString());\n\t\t\t} catch (err) {\n\t\t\t\treturn Body.Promise.reject(new FetchError(`invalid json response body at ${_this2.url} reason: ${err.message}`, 'invalid-json'));\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n  * Decode response as text\n  *\n  * @return  Promise\n  */\n\ttext() {\n\t\treturn consumeBody.call(this).then(function (buffer) {\n\t\t\treturn buffer.toString();\n\t\t});\n\t},\n\n\t/**\n  * Decode response as buffer (non-spec api)\n  *\n  * @return  Promise\n  */\n\tbuffer() {\n\t\treturn consumeBody.call(this);\n\t},\n\n\t/**\n  * Decode response as text, while automatically detecting the encoding and\n  * trying to decode to UTF-8 (non-spec api)\n  *\n  * @return  Promise\n  */\n\ttextConverted() {\n\t\tvar _this3 = this;\n\n\t\treturn consumeBody.call(this).then(function (buffer) {\n\t\t\treturn convertBody(buffer, _this3.headers);\n\t\t});\n\t}\n};\n\n// In browsers, all properties are enumerable.\nObject.defineProperties(Body.prototype, {\n\tbody: { enumerable: true },\n\tbodyUsed: { enumerable: true },\n\tarrayBuffer: { enumerable: true },\n\tblob: { enumerable: true },\n\tjson: { enumerable: true },\n\ttext: { enumerable: true }\n});\n\nBody.mixIn = function (proto) {\n\tfor (const name of Object.getOwnPropertyNames(Body.prototype)) {\n\t\t// istanbul ignore else: future proof\n\t\tif (!(name in proto)) {\n\t\t\tconst desc = Object.getOwnPropertyDescriptor(Body.prototype, name);\n\t\t\tObject.defineProperty(proto, name, desc);\n\t\t}\n\t}\n};\n\n/**\n * Consume and convert an entire Body to a Buffer.\n *\n * Ref: https://fetch.spec.whatwg.org/#concept-body-consume-body\n *\n * @return  Promise\n */\nfunction consumeBody() {\n\tvar _this4 = this;\n\n\tif (this[INTERNALS].disturbed) {\n\t\treturn Body.Promise.reject(new TypeError(`body used already for: ${this.url}`));\n\t}\n\n\tthis[INTERNALS].disturbed = true;\n\n\tif (this[INTERNALS].error) {\n\t\treturn Body.Promise.reject(this[INTERNALS].error);\n\t}\n\n\tlet body = this.body;\n\n\t// body is null\n\tif (body === null) {\n\t\treturn Body.Promise.resolve(Buffer.alloc(0));\n\t}\n\n\t// body is blob\n\tif (isBlob(body)) {\n\t\tbody = body.stream();\n\t}\n\n\t// body is buffer\n\tif (Buffer.isBuffer(body)) {\n\t\treturn Body.Promise.resolve(body);\n\t}\n\n\t// istanbul ignore if: should never happen\n\tif (!(body instanceof Stream)) {\n\t\treturn Body.Promise.resolve(Buffer.alloc(0));\n\t}\n\n\t// body is stream\n\t// get ready to actually consume the body\n\tlet accum = [];\n\tlet accumBytes = 0;\n\tlet abort = false;\n\n\treturn new Body.Promise(function (resolve, reject) {\n\t\tlet resTimeout;\n\n\t\t// allow timeout on slow response body\n\t\tif (_this4.timeout) {\n\t\t\tresTimeout = setTimeout(function () {\n\t\t\t\tabort = true;\n\t\t\t\treject(new FetchError(`Response timeout while trying to fetch ${_this4.url} (over ${_this4.timeout}ms)`, 'body-timeout'));\n\t\t\t}, _this4.timeout);\n\t\t}\n\n\t\t// handle stream errors\n\t\tbody.on('error', function (err) {\n\t\t\tif (err.name === 'AbortError') {\n\t\t\t\t// if the request was aborted, reject with this Error\n\t\t\t\tabort = true;\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\t// other errors, such as incorrect content-encoding\n\t\t\t\treject(new FetchError(`Invalid response body while trying to fetch ${_this4.url}: ${err.message}`, 'system', err));\n\t\t\t}\n\t\t});\n\n\t\tbody.on('data', function (chunk) {\n\t\t\tif (abort || chunk === null) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (_this4.size && accumBytes + chunk.length > _this4.size) {\n\t\t\t\tabort = true;\n\t\t\t\treject(new FetchError(`content size at ${_this4.url} over limit: ${_this4.size}`, 'max-size'));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\taccumBytes += chunk.length;\n\t\t\taccum.push(chunk);\n\t\t});\n\n\t\tbody.on('end', function () {\n\t\t\tif (abort) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tclearTimeout(resTimeout);\n\n\t\t\ttry {\n\t\t\t\tresolve(Buffer.concat(accum, accumBytes));\n\t\t\t} catch (err) {\n\t\t\t\t// handle streams that have accumulated too much data (issue #414)\n\t\t\t\treject(new FetchError(`Could not create Buffer from response body for ${_this4.url}: ${err.message}`, 'system', err));\n\t\t\t}\n\t\t});\n\t});\n}\n\n/**\n * Detect buffer encoding and convert to target encoding\n * ref: http://www.w3.org/TR/2011/WD-html5-20110113/parsing.html#determining-the-character-encoding\n *\n * @param   Buffer  buffer    Incoming buffer\n * @param   String  encoding  Target encoding\n * @return  String\n */\nfunction convertBody(buffer, headers) {\n\tif (typeof convert !== 'function') {\n\t\tthrow new Error('The package `encoding` must be installed to use the textConverted() function');\n\t}\n\n\tconst ct = headers.get('content-type');\n\tlet charset = 'utf-8';\n\tlet res, str;\n\n\t// header\n\tif (ct) {\n\t\tres = /charset=([^;]*)/i.exec(ct);\n\t}\n\n\t// no charset in content type, peek at response body for at most 1024 bytes\n\tstr = buffer.slice(0, 1024).toString();\n\n\t// html5\n\tif (!res && str) {\n\t\tres = /<meta.+?charset=(['\"])(.+?)\\1/i.exec(str);\n\t}\n\n\t// html4\n\tif (!res && str) {\n\t\tres = /<meta[\\s]+?http-equiv=(['\"])content-type\\1[\\s]+?content=(['\"])(.+?)\\2/i.exec(str);\n\t\tif (!res) {\n\t\t\tres = /<meta[\\s]+?content=(['\"])(.+?)\\1[\\s]+?http-equiv=(['\"])content-type\\3/i.exec(str);\n\t\t\tif (res) {\n\t\t\t\tres.pop(); // drop last quote\n\t\t\t}\n\t\t}\n\n\t\tif (res) {\n\t\t\tres = /charset=(.*)/i.exec(res.pop());\n\t\t}\n\t}\n\n\t// xml\n\tif (!res && str) {\n\t\tres = /<\\?xml.+?encoding=(['\"])(.+?)\\1/i.exec(str);\n\t}\n\n\t// found charset\n\tif (res) {\n\t\tcharset = res.pop();\n\n\t\t// prevent decode issues when sites use incorrect encoding\n\t\t// ref: https://hsivonen.fi/encoding-menu/\n\t\tif (charset === 'gb2312' || charset === 'gbk') {\n\t\t\tcharset = 'gb18030';\n\t\t}\n\t}\n\n\t// turn raw buffers into a single utf-8 buffer\n\treturn convert(buffer, 'UTF-8', charset).toString();\n}\n\n/**\n * Detect a URLSearchParams object\n * ref: https://github.com/bitinn/node-fetch/issues/296#issuecomment-307598143\n *\n * @param   Object  obj     Object to detect by type or brand\n * @return  String\n */\nfunction isURLSearchParams(obj) {\n\t// Duck-typing as a necessary condition.\n\tif (typeof obj !== 'object' || typeof obj.append !== 'function' || typeof obj.delete !== 'function' || typeof obj.get !== 'function' || typeof obj.getAll !== 'function' || typeof obj.has !== 'function' || typeof obj.set !== 'function') {\n\t\treturn false;\n\t}\n\n\t// Brand-checking and more duck-typing as optional condition.\n\treturn obj.constructor.name === 'URLSearchParams' || Object.prototype.toString.call(obj) === '[object URLSearchParams]' || typeof obj.sort === 'function';\n}\n\n/**\n * Check if `obj` is a W3C `Blob` object (which `File` inherits from)\n * @param  {*} obj\n * @return {boolean}\n */\nfunction isBlob(obj) {\n\treturn typeof obj === 'object' && typeof obj.arrayBuffer === 'function' && typeof obj.type === 'string' && typeof obj.stream === 'function' && typeof obj.constructor === 'function' && typeof obj.constructor.name === 'string' && /^(Blob|File)$/.test(obj.constructor.name) && /^(Blob|File)$/.test(obj[Symbol.toStringTag]);\n}\n\n/**\n * Clone body given Res/Req instance\n *\n * @param   Mixed  instance  Response or Request instance\n * @return  Mixed\n */\nfunction clone(instance) {\n\tlet p1, p2;\n\tlet body = instance.body;\n\n\t// don't allow cloning a used body\n\tif (instance.bodyUsed) {\n\t\tthrow new Error('cannot clone body after it is used');\n\t}\n\n\t// check that body is a stream and not form-data object\n\t// note: we can't clone the form-data object without having it as a dependency\n\tif (body instanceof Stream && typeof body.getBoundary !== 'function') {\n\t\t// tee instance body\n\t\tp1 = new PassThrough();\n\t\tp2 = new PassThrough();\n\t\tbody.pipe(p1);\n\t\tbody.pipe(p2);\n\t\t// set instance body to teed body and return the other teed body\n\t\tinstance[INTERNALS].body = p1;\n\t\tbody = p2;\n\t}\n\n\treturn body;\n}\n\n/**\n * Performs the operation \"extract a `Content-Type` value from |object|\" as\n * specified in the specification:\n * https://fetch.spec.whatwg.org/#concept-bodyinit-extract\n *\n * This function assumes that instance.body is present.\n *\n * @param   Mixed  instance  Any options.body input\n */\nfunction extractContentType(body) {\n\tif (body === null) {\n\t\t// body is null\n\t\treturn null;\n\t} else if (typeof body === 'string') {\n\t\t// body is string\n\t\treturn 'text/plain;charset=UTF-8';\n\t} else if (isURLSearchParams(body)) {\n\t\t// body is a URLSearchParams\n\t\treturn 'application/x-www-form-urlencoded;charset=UTF-8';\n\t} else if (isBlob(body)) {\n\t\t// body is blob\n\t\treturn body.type || null;\n\t} else if (Buffer.isBuffer(body)) {\n\t\t// body is buffer\n\t\treturn null;\n\t} else if (Object.prototype.toString.call(body) === '[object ArrayBuffer]') {\n\t\t// body is ArrayBuffer\n\t\treturn null;\n\t} else if (ArrayBuffer.isView(body)) {\n\t\t// body is ArrayBufferView\n\t\treturn null;\n\t} else if (typeof body.getBoundary === 'function') {\n\t\t// detect form data input from form-data module\n\t\treturn `multipart/form-data;boundary=${body.getBoundary()}`;\n\t} else if (body instanceof Stream) {\n\t\t// body is stream\n\t\t// can't really do much about this\n\t\treturn null;\n\t} else {\n\t\t// Body constructor defaults other things to string\n\t\treturn 'text/plain;charset=UTF-8';\n\t}\n}\n\n/**\n * The Fetch Standard treats this as if \"total bytes\" is a property on the body.\n * For us, we have to explicitly get it with a function.\n *\n * ref: https://fetch.spec.whatwg.org/#concept-body-total-bytes\n *\n * @param   Body    instance   Instance of Body\n * @return  Number?            Number of bytes, or null if not possible\n */\nfunction getTotalBytes(instance) {\n\tconst body = instance.body;\n\n\n\tif (body === null) {\n\t\t// body is null\n\t\treturn 0;\n\t} else if (isBlob(body)) {\n\t\treturn body.size;\n\t} else if (Buffer.isBuffer(body)) {\n\t\t// body is buffer\n\t\treturn body.length;\n\t} else if (body && typeof body.getLengthSync === 'function') {\n\t\t// detect form data input from form-data module\n\t\tif (body._lengthRetrievers && body._lengthRetrievers.length == 0 || // 1.x\n\t\tbody.hasKnownLength && body.hasKnownLength()) {\n\t\t\t// 2.x\n\t\t\treturn body.getLengthSync();\n\t\t}\n\t\treturn null;\n\t} else {\n\t\t// body is stream\n\t\treturn null;\n\t}\n}\n\n/**\n * Write a Body to a Node.js WritableStream (e.g. http.Request) object.\n *\n * @param   Body    instance   Instance of Body\n * @return  Void\n */\nfunction writeToStream(dest, instance) {\n\tconst body = instance.body;\n\n\n\tif (body === null) {\n\t\t// body is null\n\t\tdest.end();\n\t} else if (isBlob(body)) {\n\t\tbody.stream().pipe(dest);\n\t} else if (Buffer.isBuffer(body)) {\n\t\t// body is buffer\n\t\tdest.write(body);\n\t\tdest.end();\n\t} else {\n\t\t// body is stream\n\t\tbody.pipe(dest);\n\t}\n}\n\n// expose Promise\nBody.Promise = global.Promise;\n\n/**\n * headers.js\n *\n * Headers class offers convenient helpers\n */\n\nconst invalidTokenRegex = /[^\\^_`a-zA-Z\\-0-9!#$%&'*+.|~]/;\nconst invalidHeaderCharRegex = /[^\\t\\x20-\\x7e\\x80-\\xff]/;\n\nfunction validateName(name) {\n\tname = `${name}`;\n\tif (invalidTokenRegex.test(name) || name === '') {\n\t\tthrow new TypeError(`${name} is not a legal HTTP header name`);\n\t}\n}\n\nfunction validateValue(value) {\n\tvalue = `${value}`;\n\tif (invalidHeaderCharRegex.test(value)) {\n\t\tthrow new TypeError(`${value} is not a legal HTTP header value`);\n\t}\n}\n\n/**\n * Find the key in the map object given a header name.\n *\n * Returns undefined if not found.\n *\n * @param   String  name  Header name\n * @return  String|Undefined\n */\nfunction find(map, name) {\n\tname = name.toLowerCase();\n\tfor (const key in map) {\n\t\tif (key.toLowerCase() === name) {\n\t\t\treturn key;\n\t\t}\n\t}\n\treturn undefined;\n}\n\nconst MAP = Symbol('map');\nclass Headers {\n\t/**\n  * Headers class\n  *\n  * @param   Object  headers  Response headers\n  * @return  Void\n  */\n\tconstructor() {\n\t\tlet init = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : undefined;\n\n\t\tthis[MAP] = Object.create(null);\n\n\t\tif (init instanceof Headers) {\n\t\t\tconst rawHeaders = init.raw();\n\t\t\tconst headerNames = Object.keys(rawHeaders);\n\n\t\t\tfor (const headerName of headerNames) {\n\t\t\t\tfor (const value of rawHeaders[headerName]) {\n\t\t\t\t\tthis.append(headerName, value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// We don't worry about converting prop to ByteString here as append()\n\t\t// will handle it.\n\t\tif (init == null) ; else if (typeof init === 'object') {\n\t\t\tconst method = init[Symbol.iterator];\n\t\t\tif (method != null) {\n\t\t\t\tif (typeof method !== 'function') {\n\t\t\t\t\tthrow new TypeError('Header pairs must be iterable');\n\t\t\t\t}\n\n\t\t\t\t// sequence<sequence<ByteString>>\n\t\t\t\t// Note: per spec we have to first exhaust the lists then process them\n\t\t\t\tconst pairs = [];\n\t\t\t\tfor (const pair of init) {\n\t\t\t\t\tif (typeof pair !== 'object' || typeof pair[Symbol.iterator] !== 'function') {\n\t\t\t\t\t\tthrow new TypeError('Each header pair must be iterable');\n\t\t\t\t\t}\n\t\t\t\t\tpairs.push(Array.from(pair));\n\t\t\t\t}\n\n\t\t\t\tfor (const pair of pairs) {\n\t\t\t\t\tif (pair.length !== 2) {\n\t\t\t\t\t\tthrow new TypeError('Each header pair must be a name/value tuple');\n\t\t\t\t\t}\n\t\t\t\t\tthis.append(pair[0], pair[1]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// record<ByteString, ByteString>\n\t\t\t\tfor (const key of Object.keys(init)) {\n\t\t\t\t\tconst value = init[key];\n\t\t\t\t\tthis.append(key, value);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthrow new TypeError('Provided initializer must be an object');\n\t\t}\n\t}\n\n\t/**\n  * Return combined header value given name\n  *\n  * @param   String  name  Header name\n  * @return  Mixed\n  */\n\tget(name) {\n\t\tname = `${name}`;\n\t\tvalidateName(name);\n\t\tconst key = find(this[MAP], name);\n\t\tif (key === undefined) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this[MAP][key].join(', ');\n\t}\n\n\t/**\n  * Iterate over all headers\n  *\n  * @param   Function  callback  Executed for each item with parameters (value, name, thisArg)\n  * @param   Boolean   thisArg   `this` context for callback function\n  * @return  Void\n  */\n\tforEach(callback) {\n\t\tlet thisArg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;\n\n\t\tlet pairs = getHeaders(this);\n\t\tlet i = 0;\n\t\twhile (i < pairs.length) {\n\t\t\tvar _pairs$i = pairs[i];\n\t\t\tconst name = _pairs$i[0],\n\t\t\t      value = _pairs$i[1];\n\n\t\t\tcallback.call(thisArg, value, name, this);\n\t\t\tpairs = getHeaders(this);\n\t\t\ti++;\n\t\t}\n\t}\n\n\t/**\n  * Overwrite header values given name\n  *\n  * @param   String  name   Header name\n  * @param   String  value  Header value\n  * @return  Void\n  */\n\tset(name, value) {\n\t\tname = `${name}`;\n\t\tvalue = `${value}`;\n\t\tvalidateName(name);\n\t\tvalidateValue(value);\n\t\tconst key = find(this[MAP], name);\n\t\tthis[MAP][key !== undefined ? key : name] = [value];\n\t}\n\n\t/**\n  * Append a value onto existing header\n  *\n  * @param   String  name   Header name\n  * @param   String  value  Header value\n  * @return  Void\n  */\n\tappend(name, value) {\n\t\tname = `${name}`;\n\t\tvalue = `${value}`;\n\t\tvalidateName(name);\n\t\tvalidateValue(value);\n\t\tconst key = find(this[MAP], name);\n\t\tif (key !== undefined) {\n\t\t\tthis[MAP][key].push(value);\n\t\t} else {\n\t\t\tthis[MAP][name] = [value];\n\t\t}\n\t}\n\n\t/**\n  * Check for header name existence\n  *\n  * @param   String   name  Header name\n  * @return  Boolean\n  */\n\thas(name) {\n\t\tname = `${name}`;\n\t\tvalidateName(name);\n\t\treturn find(this[MAP], name) !== undefined;\n\t}\n\n\t/**\n  * Delete all header values given name\n  *\n  * @param   String  name  Header name\n  * @return  Void\n  */\n\tdelete(name) {\n\t\tname = `${name}`;\n\t\tvalidateName(name);\n\t\tconst key = find(this[MAP], name);\n\t\tif (key !== undefined) {\n\t\t\tdelete this[MAP][key];\n\t\t}\n\t}\n\n\t/**\n  * Return raw headers (non-spec api)\n  *\n  * @return  Object\n  */\n\traw() {\n\t\treturn this[MAP];\n\t}\n\n\t/**\n  * Get an iterator on keys.\n  *\n  * @return  Iterator\n  */\n\tkeys() {\n\t\treturn createHeadersIterator(this, 'key');\n\t}\n\n\t/**\n  * Get an iterator on values.\n  *\n  * @return  Iterator\n  */\n\tvalues() {\n\t\treturn createHeadersIterator(this, 'value');\n\t}\n\n\t/**\n  * Get an iterator on entries.\n  *\n  * This is the default iterator of the Headers object.\n  *\n  * @return  Iterator\n  */\n\t[Symbol.iterator]() {\n\t\treturn createHeadersIterator(this, 'key+value');\n\t}\n}\nHeaders.prototype.entries = Headers.prototype[Symbol.iterator];\n\nObject.defineProperty(Headers.prototype, Symbol.toStringTag, {\n\tvalue: 'Headers',\n\twritable: false,\n\tenumerable: false,\n\tconfigurable: true\n});\n\nObject.defineProperties(Headers.prototype, {\n\tget: { enumerable: true },\n\tforEach: { enumerable: true },\n\tset: { enumerable: true },\n\tappend: { enumerable: true },\n\thas: { enumerable: true },\n\tdelete: { enumerable: true },\n\tkeys: { enumerable: true },\n\tvalues: { enumerable: true },\n\tentries: { enumerable: true }\n});\n\nfunction getHeaders(headers) {\n\tlet kind = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'key+value';\n\n\tconst keys = Object.keys(headers[MAP]).sort();\n\treturn keys.map(kind === 'key' ? function (k) {\n\t\treturn k.toLowerCase();\n\t} : kind === 'value' ? function (k) {\n\t\treturn headers[MAP][k].join(', ');\n\t} : function (k) {\n\t\treturn [k.toLowerCase(), headers[MAP][k].join(', ')];\n\t});\n}\n\nconst INTERNAL = Symbol('internal');\n\nfunction createHeadersIterator(target, kind) {\n\tconst iterator = Object.create(HeadersIteratorPrototype);\n\titerator[INTERNAL] = {\n\t\ttarget,\n\t\tkind,\n\t\tindex: 0\n\t};\n\treturn iterator;\n}\n\nconst HeadersIteratorPrototype = Object.setPrototypeOf({\n\tnext() {\n\t\t// istanbul ignore if\n\t\tif (!this || Object.getPrototypeOf(this) !== HeadersIteratorPrototype) {\n\t\t\tthrow new TypeError('Value of `this` is not a HeadersIterator');\n\t\t}\n\n\t\tvar _INTERNAL = this[INTERNAL];\n\t\tconst target = _INTERNAL.target,\n\t\t      kind = _INTERNAL.kind,\n\t\t      index = _INTERNAL.index;\n\n\t\tconst values = getHeaders(target, kind);\n\t\tconst len = values.length;\n\t\tif (index >= len) {\n\t\t\treturn {\n\t\t\t\tvalue: undefined,\n\t\t\t\tdone: true\n\t\t\t};\n\t\t}\n\n\t\tthis[INTERNAL].index = index + 1;\n\n\t\treturn {\n\t\t\tvalue: values[index],\n\t\t\tdone: false\n\t\t};\n\t}\n}, Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));\n\nObject.defineProperty(HeadersIteratorPrototype, Symbol.toStringTag, {\n\tvalue: 'HeadersIterator',\n\twritable: false,\n\tenumerable: false,\n\tconfigurable: true\n});\n\n/**\n * Export the Headers object in a form that Node.js can consume.\n *\n * @param   Headers  headers\n * @return  Object\n */\nfunction exportNodeCompatibleHeaders(headers) {\n\tconst obj = Object.assign({ __proto__: null }, headers[MAP]);\n\n\t// http.request() only supports string as Host header. This hack makes\n\t// specifying custom Host header possible.\n\tconst hostHeaderKey = find(headers[MAP], 'Host');\n\tif (hostHeaderKey !== undefined) {\n\t\tobj[hostHeaderKey] = obj[hostHeaderKey][0];\n\t}\n\n\treturn obj;\n}\n\n/**\n * Create a Headers object from an object of headers, ignoring those that do\n * not conform to HTTP grammar productions.\n *\n * @param   Object  obj  Object of headers\n * @return  Headers\n */\nfunction createHeadersLenient(obj) {\n\tconst headers = new Headers();\n\tfor (const name of Object.keys(obj)) {\n\t\tif (invalidTokenRegex.test(name)) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (Array.isArray(obj[name])) {\n\t\t\tfor (const val of obj[name]) {\n\t\t\t\tif (invalidHeaderCharRegex.test(val)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (headers[MAP][name] === undefined) {\n\t\t\t\t\theaders[MAP][name] = [val];\n\t\t\t\t} else {\n\t\t\t\t\theaders[MAP][name].push(val);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (!invalidHeaderCharRegex.test(obj[name])) {\n\t\t\theaders[MAP][name] = [obj[name]];\n\t\t}\n\t}\n\treturn headers;\n}\n\nconst INTERNALS$1 = Symbol('Response internals');\n\n// fix an issue where \"STATUS_CODES\" aren't a named export for node <10\nconst STATUS_CODES = http.STATUS_CODES;\n\n/**\n * Response class\n *\n * @param   Stream  body  Readable stream\n * @param   Object  opts  Response options\n * @return  Void\n */\nclass Response {\n\tconstructor() {\n\t\tlet body = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n\t\tlet opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n\t\tBody.call(this, body, opts);\n\n\t\tconst status = opts.status || 200;\n\t\tconst headers = new Headers(opts.headers);\n\n\t\tif (body != null && !headers.has('Content-Type')) {\n\t\t\tconst contentType = extractContentType(body);\n\t\t\tif (contentType) {\n\t\t\t\theaders.append('Content-Type', contentType);\n\t\t\t}\n\t\t}\n\n\t\tthis[INTERNALS$1] = {\n\t\t\turl: opts.url,\n\t\t\tstatus,\n\t\t\tstatusText: opts.statusText || STATUS_CODES[status],\n\t\t\theaders,\n\t\t\tcounter: opts.counter\n\t\t};\n\t}\n\n\tget url() {\n\t\treturn this[INTERNALS$1].url || '';\n\t}\n\n\tget status() {\n\t\treturn this[INTERNALS$1].status;\n\t}\n\n\t/**\n  * Convenience property representing if the request ended normally\n  */\n\tget ok() {\n\t\treturn this[INTERNALS$1].status >= 200 && this[INTERNALS$1].status < 300;\n\t}\n\n\tget redirected() {\n\t\treturn this[INTERNALS$1].counter > 0;\n\t}\n\n\tget statusText() {\n\t\treturn this[INTERNALS$1].statusText;\n\t}\n\n\tget headers() {\n\t\treturn this[INTERNALS$1].headers;\n\t}\n\n\t/**\n  * Clone this response\n  *\n  * @return  Response\n  */\n\tclone() {\n\t\treturn new Response(clone(this), {\n\t\t\turl: this.url,\n\t\t\tstatus: this.status,\n\t\t\tstatusText: this.statusText,\n\t\t\theaders: this.headers,\n\t\t\tok: this.ok,\n\t\t\tredirected: this.redirected\n\t\t});\n\t}\n}\n\nBody.mixIn(Response.prototype);\n\nObject.defineProperties(Response.prototype, {\n\turl: { enumerable: true },\n\tstatus: { enumerable: true },\n\tok: { enumerable: true },\n\tredirected: { enumerable: true },\n\tstatusText: { enumerable: true },\n\theaders: { enumerable: true },\n\tclone: { enumerable: true }\n});\n\nObject.defineProperty(Response.prototype, Symbol.toStringTag, {\n\tvalue: 'Response',\n\twritable: false,\n\tenumerable: false,\n\tconfigurable: true\n});\n\nconst INTERNALS$2 = Symbol('Request internals');\nconst URL = Url.URL || whatwgUrl.URL;\n\n// fix an issue where \"format\", \"parse\" aren't a named export for node <10\nconst parse_url = Url.parse;\nconst format_url = Url.format;\n\n/**\n * Wrapper around `new URL` to handle arbitrary URLs\n *\n * @param  {string} urlStr\n * @return {void}\n */\nfunction parseURL(urlStr) {\n\t/*\n \tCheck whether the URL is absolute or not\n \t\tScheme: https://tools.ietf.org/html/rfc3986#section-3.1\n \tAbsolute URL: https://tools.ietf.org/html/rfc3986#section-4.3\n */\n\tif (/^[a-zA-Z][a-zA-Z\\d+\\-.]*:/.exec(urlStr)) {\n\t\turlStr = new URL(urlStr).toString();\n\t}\n\n\t// Fallback to old implementation for arbitrary URLs\n\treturn parse_url(urlStr);\n}\n\nconst streamDestructionSupported = 'destroy' in Stream.Readable.prototype;\n\n/**\n * Check if a value is an instance of Request.\n *\n * @param   Mixed   input\n * @return  Boolean\n */\nfunction isRequest(input) {\n\treturn typeof input === 'object' && typeof input[INTERNALS$2] === 'object';\n}\n\nfunction isAbortSignal(signal) {\n\tconst proto = signal && typeof signal === 'object' && Object.getPrototypeOf(signal);\n\treturn !!(proto && proto.constructor.name === 'AbortSignal');\n}\n\n/**\n * Request class\n *\n * @param   Mixed   input  Url or Request instance\n * @param   Object  init   Custom options\n * @return  Void\n */\nclass Request {\n\tconstructor(input) {\n\t\tlet init = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n\t\tlet parsedURL;\n\n\t\t// normalize input\n\t\tif (!isRequest(input)) {\n\t\t\tif (input && input.href) {\n\t\t\t\t// in order to support Node.js' Url objects; though WHATWG's URL objects\n\t\t\t\t// will fall into this branch also (since their `toString()` will return\n\t\t\t\t// `href` property anyway)\n\t\t\t\tparsedURL = parseURL(input.href);\n\t\t\t} else {\n\t\t\t\t// coerce input to a string before attempting to parse\n\t\t\t\tparsedURL = parseURL(`${input}`);\n\t\t\t}\n\t\t\tinput = {};\n\t\t} else {\n\t\t\tparsedURL = parseURL(input.url);\n\t\t}\n\n\t\tlet method = init.method || input.method || 'GET';\n\t\tmethod = method.toUpperCase();\n\n\t\tif ((init.body != null || isRequest(input) && input.body !== null) && (method === 'GET' || method === 'HEAD')) {\n\t\t\tthrow new TypeError('Request with GET/HEAD method cannot have body');\n\t\t}\n\n\t\tlet inputBody = init.body != null ? init.body : isRequest(input) && input.body !== null ? clone(input) : null;\n\n\t\tBody.call(this, inputBody, {\n\t\t\ttimeout: init.timeout || input.timeout || 0,\n\t\t\tsize: init.size || input.size || 0\n\t\t});\n\n\t\tconst headers = new Headers(init.headers || input.headers || {});\n\n\t\tif (inputBody != null && !headers.has('Content-Type')) {\n\t\t\tconst contentType = extractContentType(inputBody);\n\t\t\tif (contentType) {\n\t\t\t\theaders.append('Content-Type', contentType);\n\t\t\t}\n\t\t}\n\n\t\tlet signal = isRequest(input) ? input.signal : null;\n\t\tif ('signal' in init) signal = init.signal;\n\n\t\tif (signal != null && !isAbortSignal(signal)) {\n\t\t\tthrow new TypeError('Expected signal to be an instanceof AbortSignal');\n\t\t}\n\n\t\tthis[INTERNALS$2] = {\n\t\t\tmethod,\n\t\t\tredirect: init.redirect || input.redirect || 'follow',\n\t\t\theaders,\n\t\t\tparsedURL,\n\t\t\tsignal\n\t\t};\n\n\t\t// node-fetch-only options\n\t\tthis.follow = init.follow !== undefined ? init.follow : input.follow !== undefined ? input.follow : 20;\n\t\tthis.compress = init.compress !== undefined ? init.compress : input.compress !== undefined ? input.compress : true;\n\t\tthis.counter = init.counter || input.counter || 0;\n\t\tthis.agent = init.agent || input.agent;\n\t}\n\n\tget method() {\n\t\treturn this[INTERNALS$2].method;\n\t}\n\n\tget url() {\n\t\treturn format_url(this[INTERNALS$2].parsedURL);\n\t}\n\n\tget headers() {\n\t\treturn this[INTERNALS$2].headers;\n\t}\n\n\tget redirect() {\n\t\treturn this[INTERNALS$2].redirect;\n\t}\n\n\tget signal() {\n\t\treturn this[INTERNALS$2].signal;\n\t}\n\n\t/**\n  * Clone this request\n  *\n  * @return  Request\n  */\n\tclone() {\n\t\treturn new Request(this);\n\t}\n}\n\nBody.mixIn(Request.prototype);\n\nObject.defineProperty(Request.prototype, Symbol.toStringTag, {\n\tvalue: 'Request',\n\twritable: false,\n\tenumerable: false,\n\tconfigurable: true\n});\n\nObject.defineProperties(Request.prototype, {\n\tmethod: { enumerable: true },\n\turl: { enumerable: true },\n\theaders: { enumerable: true },\n\tredirect: { enumerable: true },\n\tclone: { enumerable: true },\n\tsignal: { enumerable: true }\n});\n\n/**\n * Convert a Request to Node.js http request options.\n *\n * @param   Request  A Request instance\n * @return  Object   The options object to be passed to http.request\n */\nfunction getNodeRequestOptions(request) {\n\tconst parsedURL = request[INTERNALS$2].parsedURL;\n\tconst headers = new Headers(request[INTERNALS$2].headers);\n\n\t// fetch step 1.3\n\tif (!headers.has('Accept')) {\n\t\theaders.set('Accept', '*/*');\n\t}\n\n\t// Basic fetch\n\tif (!parsedURL.protocol || !parsedURL.hostname) {\n\t\tthrow new TypeError('Only absolute URLs are supported');\n\t}\n\n\tif (!/^https?:$/.test(parsedURL.protocol)) {\n\t\tthrow new TypeError('Only HTTP(S) protocols are supported');\n\t}\n\n\tif (request.signal && request.body instanceof Stream.Readable && !streamDestructionSupported) {\n\t\tthrow new Error('Cancellation of streamed requests with AbortSignal is not supported in node < 8');\n\t}\n\n\t// HTTP-network-or-cache fetch steps 2.4-2.7\n\tlet contentLengthValue = null;\n\tif (request.body == null && /^(POST|PUT)$/i.test(request.method)) {\n\t\tcontentLengthValue = '0';\n\t}\n\tif (request.body != null) {\n\t\tconst totalBytes = getTotalBytes(request);\n\t\tif (typeof totalBytes === 'number') {\n\t\t\tcontentLengthValue = String(totalBytes);\n\t\t}\n\t}\n\tif (contentLengthValue) {\n\t\theaders.set('Content-Length', contentLengthValue);\n\t}\n\n\t// HTTP-network-or-cache fetch step 2.11\n\tif (!headers.has('User-Agent')) {\n\t\theaders.set('User-Agent', 'node-fetch/1.0 (+https://github.com/bitinn/node-fetch)');\n\t}\n\n\t// HTTP-network-or-cache fetch step 2.15\n\tif (request.compress && !headers.has('Accept-Encoding')) {\n\t\theaders.set('Accept-Encoding', 'gzip,deflate');\n\t}\n\n\tlet agent = request.agent;\n\tif (typeof agent === 'function') {\n\t\tagent = agent(parsedURL);\n\t}\n\n\tif (!headers.has('Connection') && !agent) {\n\t\theaders.set('Connection', 'close');\n\t}\n\n\t// HTTP-network fetch step 4.2\n\t// chunked encoding is handled by Node.js\n\n\treturn Object.assign({}, parsedURL, {\n\t\tmethod: request.method,\n\t\theaders: exportNodeCompatibleHeaders(headers),\n\t\tagent\n\t});\n}\n\n/**\n * abort-error.js\n *\n * AbortError interface for cancelled requests\n */\n\n/**\n * Create AbortError instance\n *\n * @param   String      message      Error message for human\n * @return  AbortError\n */\nfunction AbortError(message) {\n  Error.call(this, message);\n\n  this.type = 'aborted';\n  this.message = message;\n\n  // hide custom error implementation details from end-users\n  Error.captureStackTrace(this, this.constructor);\n}\n\nAbortError.prototype = Object.create(Error.prototype);\nAbortError.prototype.constructor = AbortError;\nAbortError.prototype.name = 'AbortError';\n\nconst URL$1 = Url.URL || whatwgUrl.URL;\n\n// fix an issue where \"PassThrough\", \"resolve\" aren't a named export for node <10\nconst PassThrough$1 = Stream.PassThrough;\n\nconst isDomainOrSubdomain = function isDomainOrSubdomain(destination, original) {\n\tconst orig = new URL$1(original).hostname;\n\tconst dest = new URL$1(destination).hostname;\n\n\treturn orig === dest || orig[orig.length - dest.length - 1] === '.' && orig.endsWith(dest);\n};\n\n/**\n * Fetch function\n *\n * @param   Mixed    url   Absolute url or Request instance\n * @param   Object   opts  Fetch options\n * @return  Promise\n */\nfunction fetch(url, opts) {\n\n\t// allow custom promise\n\tif (!fetch.Promise) {\n\t\tthrow new Error('native promise missing, set fetch.Promise to your favorite alternative');\n\t}\n\n\tBody.Promise = fetch.Promise;\n\n\t// wrap http.request into fetch\n\treturn new fetch.Promise(function (resolve, reject) {\n\t\t// build request object\n\t\tconst request = new Request(url, opts);\n\t\tconst options = getNodeRequestOptions(request);\n\n\t\tconst send = (options.protocol === 'https:' ? https : http).request;\n\t\tconst signal = request.signal;\n\n\t\tlet response = null;\n\n\t\tconst abort = function abort() {\n\t\t\tlet error = new AbortError('The user aborted a request.');\n\t\t\treject(error);\n\t\t\tif (request.body && request.body instanceof Stream.Readable) {\n\t\t\t\trequest.body.destroy(error);\n\t\t\t}\n\t\t\tif (!response || !response.body) return;\n\t\t\tresponse.body.emit('error', error);\n\t\t};\n\n\t\tif (signal && signal.aborted) {\n\t\t\tabort();\n\t\t\treturn;\n\t\t}\n\n\t\tconst abortAndFinalize = function abortAndFinalize() {\n\t\t\tabort();\n\t\t\tfinalize();\n\t\t};\n\n\t\t// send request\n\t\tconst req = send(options);\n\t\tlet reqTimeout;\n\n\t\tif (signal) {\n\t\t\tsignal.addEventListener('abort', abortAndFinalize);\n\t\t}\n\n\t\tfunction finalize() {\n\t\t\treq.abort();\n\t\t\tif (signal) signal.removeEventListener('abort', abortAndFinalize);\n\t\t\tclearTimeout(reqTimeout);\n\t\t}\n\n\t\tif (request.timeout) {\n\t\t\treq.once('socket', function (socket) {\n\t\t\t\treqTimeout = setTimeout(function () {\n\t\t\t\t\treject(new FetchError(`network timeout at: ${request.url}`, 'request-timeout'));\n\t\t\t\t\tfinalize();\n\t\t\t\t}, request.timeout);\n\t\t\t});\n\t\t}\n\n\t\treq.on('error', function (err) {\n\t\t\treject(new FetchError(`request to ${request.url} failed, reason: ${err.message}`, 'system', err));\n\t\t\tfinalize();\n\t\t});\n\n\t\treq.on('response', function (res) {\n\t\t\tclearTimeout(reqTimeout);\n\n\t\t\tconst headers = createHeadersLenient(res.headers);\n\n\t\t\t// HTTP fetch step 5\n\t\t\tif (fetch.isRedirect(res.statusCode)) {\n\t\t\t\t// HTTP fetch step 5.2\n\t\t\t\tconst location = headers.get('Location');\n\n\t\t\t\t// HTTP fetch step 5.3\n\t\t\t\tlet locationURL = null;\n\t\t\t\ttry {\n\t\t\t\t\tlocationURL = location === null ? null : new URL$1(location, request.url).toString();\n\t\t\t\t} catch (err) {\n\t\t\t\t\t// error here can only be invalid URL in Location: header\n\t\t\t\t\t// do not throw when options.redirect == manual\n\t\t\t\t\t// let the user extract the errorneous redirect URL\n\t\t\t\t\tif (request.redirect !== 'manual') {\n\t\t\t\t\t\treject(new FetchError(`uri requested responds with an invalid redirect URL: ${location}`, 'invalid-redirect'));\n\t\t\t\t\t\tfinalize();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// HTTP fetch step 5.5\n\t\t\t\tswitch (request.redirect) {\n\t\t\t\t\tcase 'error':\n\t\t\t\t\t\treject(new FetchError(`uri requested responds with a redirect, redirect mode is set to error: ${request.url}`, 'no-redirect'));\n\t\t\t\t\t\tfinalize();\n\t\t\t\t\t\treturn;\n\t\t\t\t\tcase 'manual':\n\t\t\t\t\t\t// node-fetch-specific step: make manual redirect a bit easier to use by setting the Location header value to the resolved URL.\n\t\t\t\t\t\tif (locationURL !== null) {\n\t\t\t\t\t\t\t// handle corrupted header\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\theaders.set('Location', locationURL);\n\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t// istanbul ignore next: nodejs server prevent invalid response headers, we can't test this through normal request\n\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'follow':\n\t\t\t\t\t\t// HTTP-redirect fetch step 2\n\t\t\t\t\t\tif (locationURL === null) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// HTTP-redirect fetch step 5\n\t\t\t\t\t\tif (request.counter >= request.follow) {\n\t\t\t\t\t\t\treject(new FetchError(`maximum redirect reached at: ${request.url}`, 'max-redirect'));\n\t\t\t\t\t\t\tfinalize();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// HTTP-redirect fetch step 6 (counter increment)\n\t\t\t\t\t\t// Create a new Request object.\n\t\t\t\t\t\tconst requestOpts = {\n\t\t\t\t\t\t\theaders: new Headers(request.headers),\n\t\t\t\t\t\t\tfollow: request.follow,\n\t\t\t\t\t\t\tcounter: request.counter + 1,\n\t\t\t\t\t\t\tagent: request.agent,\n\t\t\t\t\t\t\tcompress: request.compress,\n\t\t\t\t\t\t\tmethod: request.method,\n\t\t\t\t\t\t\tbody: request.body,\n\t\t\t\t\t\t\tsignal: request.signal,\n\t\t\t\t\t\t\ttimeout: request.timeout,\n\t\t\t\t\t\t\tsize: request.size\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (!isDomainOrSubdomain(request.url, locationURL)) {\n\t\t\t\t\t\t\tfor (const name of ['authorization', 'www-authenticate', 'cookie', 'cookie2']) {\n\t\t\t\t\t\t\t\trequestOpts.headers.delete(name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// HTTP-redirect fetch step 9\n\t\t\t\t\t\tif (res.statusCode !== 303 && request.body && getTotalBytes(request) === null) {\n\t\t\t\t\t\t\treject(new FetchError('Cannot follow redirect with body being a readable stream', 'unsupported-redirect'));\n\t\t\t\t\t\t\tfinalize();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// HTTP-redirect fetch step 11\n\t\t\t\t\t\tif (res.statusCode === 303 || (res.statusCode === 301 || res.statusCode === 302) && request.method === 'POST') {\n\t\t\t\t\t\t\trequestOpts.method = 'GET';\n\t\t\t\t\t\t\trequestOpts.body = undefined;\n\t\t\t\t\t\t\trequestOpts.headers.delete('content-length');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// HTTP-redirect fetch step 15\n\t\t\t\t\t\tresolve(fetch(new Request(locationURL, requestOpts)));\n\t\t\t\t\t\tfinalize();\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// prepare response\n\t\t\tres.once('end', function () {\n\t\t\t\tif (signal) signal.removeEventListener('abort', abortAndFinalize);\n\t\t\t});\n\t\t\tlet body = res.pipe(new PassThrough$1());\n\n\t\t\tconst response_options = {\n\t\t\t\turl: request.url,\n\t\t\t\tstatus: res.statusCode,\n\t\t\t\tstatusText: res.statusMessage,\n\t\t\t\theaders: headers,\n\t\t\t\tsize: request.size,\n\t\t\t\ttimeout: request.timeout,\n\t\t\t\tcounter: request.counter\n\t\t\t};\n\n\t\t\t// HTTP-network fetch step 12.1.1.3\n\t\t\tconst codings = headers.get('Content-Encoding');\n\n\t\t\t// HTTP-network fetch step 12.1.1.4: handle content codings\n\n\t\t\t// in following scenarios we ignore compression support\n\t\t\t// 1. compression support is disabled\n\t\t\t// 2. HEAD request\n\t\t\t// 3. no Content-Encoding header\n\t\t\t// 4. no content response (204)\n\t\t\t// 5. content not modified response (304)\n\t\t\tif (!request.compress || request.method === 'HEAD' || codings === null || res.statusCode === 204 || res.statusCode === 304) {\n\t\t\t\tresponse = new Response(body, response_options);\n\t\t\t\tresolve(response);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// For Node v6+\n\t\t\t// Be less strict when decoding compressed responses, since sometimes\n\t\t\t// servers send slightly invalid responses that are still accepted\n\t\t\t// by common browsers.\n\t\t\t// Always using Z_SYNC_FLUSH is what cURL does.\n\t\t\tconst zlibOptions = {\n\t\t\t\tflush: zlib.Z_SYNC_FLUSH,\n\t\t\t\tfinishFlush: zlib.Z_SYNC_FLUSH\n\t\t\t};\n\n\t\t\t// for gzip\n\t\t\tif (codings == 'gzip' || codings == 'x-gzip') {\n\t\t\t\tbody = body.pipe(zlib.createGunzip(zlibOptions));\n\t\t\t\tresponse = new Response(body, response_options);\n\t\t\t\tresolve(response);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// for deflate\n\t\t\tif (codings == 'deflate' || codings == 'x-deflate') {\n\t\t\t\t// handle the infamous raw deflate response from old servers\n\t\t\t\t// a hack for old IIS and Apache servers\n\t\t\t\tconst raw = res.pipe(new PassThrough$1());\n\t\t\t\traw.once('data', function (chunk) {\n\t\t\t\t\t// see http://stackoverflow.com/questions/37519828\n\t\t\t\t\tif ((chunk[0] & 0x0F) === 0x08) {\n\t\t\t\t\t\tbody = body.pipe(zlib.createInflate());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbody = body.pipe(zlib.createInflateRaw());\n\t\t\t\t\t}\n\t\t\t\t\tresponse = new Response(body, response_options);\n\t\t\t\t\tresolve(response);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// for br\n\t\t\tif (codings == 'br' && typeof zlib.createBrotliDecompress === 'function') {\n\t\t\t\tbody = body.pipe(zlib.createBrotliDecompress());\n\t\t\t\tresponse = new Response(body, response_options);\n\t\t\t\tresolve(response);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// otherwise, use response as-is\n\t\t\tresponse = new Response(body, response_options);\n\t\t\tresolve(response);\n\t\t});\n\n\t\twriteToStream(req, request);\n\t});\n}\n/**\n * Redirect code matching\n *\n * @param   Number   code  Status code\n * @return  Boolean\n */\nfetch.isRedirect = function (code) {\n\treturn code === 301 || code === 302 || code === 303 || code === 307 || code === 308;\n};\n\n// expose Promise\nfetch.Promise = global.Promise;\n\nexport default fetch;\nexport { Headers, Request, Response, FetchError };\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"feature-\" + {\"457\":\"github\",\"795\":\"heatmap-chroma\"}[chunkId] + \".js\";\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded chunks\n// \"1\" means \"loaded\", otherwise not loaded yet\nvar installedChunks = {\n\t898: 1\n};\n\n// no on chunks loaded\n\nvar installChunk = (chunk) => {\n\tvar moreModules = chunk.modules, chunkIds = chunk.ids, runtime = chunk.runtime;\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\tfor(var i = 0; i < chunkIds.length; i++)\n\t\tinstalledChunks[chunkIds[i]] = 1;\n\n};\n\n// require() chunk loading for javascript\n__webpack_require__.f.require = (chunkId, promises) => {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\tinstallChunk(require(\"./\" + __webpack_require__.u(chunkId)));\n\t\t} else installedChunks[chunkId] = 1;\n\t}\n};\n\n// no external install chunk\n\n// no HMR\n\n// no HMR manifest","import { Disposable } from 'vscode';\nimport { Container } from '../container';\nimport { Logger } from '../logger';\nimport { builtInActionRunnerName } from './actionRunners';\nimport type { Action, ActionContext, ActionRunner, GitLensApi } from './gitlens';\n\nconst emptyDisposable = Object.freeze({\n\tdispose: () => {\n\t\t/* noop */\n\t},\n});\n\nexport class Api implements GitLensApi {\n\treadonly #container: Container;\n\tconstructor(container: Container) {\n\t\tthis.#container = container;\n\t}\n\n\tregisterActionRunner<T extends ActionContext>(action: Action<T>, runner: ActionRunner): Disposable {\n\t\tif (runner.name === builtInActionRunnerName) {\n\t\t\tthrow new Error(`Cannot use the reserved name '${builtInActionRunnerName}'`);\n\t\t}\n\n\t\tif ((action as string) === 'hover.commandHelp') {\n\t\t\taction = 'hover.commands';\n\t\t}\n\t\treturn this.#container.actionRunners.register(action, runner);\n\t}\n\n\t// registerAutolinkProvider(provider: RemoteProvider): Disposable;\n\t// registerPullRequestProvider(provider: RemoteProvider): Disposable;\n\t// registerRemoteProvider(matcher: string | RegExp, provider: RemoteProvider | RichRemoteProvider): Disposable;\n}\n\nexport function preview() {\n\treturn (target: any, key: string, descriptor: PropertyDescriptor) => {\n\t\tlet fn: Function | undefined;\n\t\tif (typeof descriptor.value === 'function') {\n\t\t\tfn = descriptor.value;\n\t\t} else if (typeof descriptor.get === 'function') {\n\t\t\tfn = descriptor.get;\n\t\t}\n\t\tif (fn == null) throw new Error('Not supported');\n\n\t\tdescriptor.value = function (this: any, ...args: any[]) {\n\t\t\tif (Container.instance.insiders || Logger.isDebugging) return fn!.apply(this, args);\n\n\t\t\tconsole.error('GitLens preview APIs are only available in the Insiders edition');\n\t\t\treturn emptyDisposable;\n\t\t};\n\t};\n}\n","import { CancellationTokenSource, Extension, ExtensionContext, extensions, Uri } from 'vscode';\nimport type { ActionContext, HoverCommandsActionContext } from './api/gitlens';\nimport type { InviteToLiveShareCommandArgs } from './commands';\nimport { Commands, CoreCommands } from './constants';\nimport { Container } from './container';\nimport { executeCommand, executeCoreCommand } from './system/command';\n\nexport async function installExtension<T>(\n\textensionId: string,\n\ttokenSource: CancellationTokenSource,\n\ttimeout: number,\n\tvsix?: Uri,\n): Promise<Extension<T> | undefined> {\n\ttry {\n\t\tlet timer: ReturnType<typeof setTimeout> | undefined = undefined;\n\t\tconst extension = new Promise<Extension<any> | undefined>(resolve => {\n\t\t\tconst disposable = extensions.onDidChange(() => {\n\t\t\t\tconst extension = extensions.getExtension(extensionId);\n\t\t\t\tif (extension != null) {\n\t\t\t\t\tif (timer != null) {\n\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t\ttimer = undefined;\n\t\t\t\t\t}\n\t\t\t\t\tdisposable.dispose();\n\n\t\t\t\t\tresolve(extension);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttokenSource.token.onCancellationRequested(() => {\n\t\t\t\tdisposable.dispose();\n\n\t\t\t\tresolve(undefined);\n\t\t\t});\n\t\t});\n\n\t\tawait executeCoreCommand(CoreCommands.InstallExtension, vsix ?? extensionId);\n\t\t// Wait for extension activation until timeout expires\n\t\ttimer = setTimeout(() => {\n\t\t\ttimer = undefined;\n\t\t\ttokenSource.cancel();\n\t\t}, timeout);\n\n\t\treturn extension;\n\t} catch {\n\t\ttokenSource.cancel();\n\t\treturn undefined;\n\t}\n}\n\nexport function registerPartnerActionRunners(context: ExtensionContext): void {\n\tregisterLiveShare(context);\n}\n\nfunction registerLiveShare(context: ExtensionContext) {\n\tcontext.subscriptions.push(\n\t\tContainer.instance.actionRunners.registerBuiltInPartner<HoverCommandsActionContext>(\n\t\t\t'liveshare',\n\t\t\t'hover.commands',\n\t\t\t{\n\t\t\t\tname: 'Live Share',\n\t\t\t\tlabel: (context: ActionContext) => {\n\t\t\t\t\tif (context.type === 'hover.commands') {\n\t\t\t\t\t\tif (context.commit.author.name !== 'You') {\n\t\t\t\t\t\t\treturn `$(live-share) Invite ${context.commit.author.name}${\n\t\t\t\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\t\t\t\t\t\t\t\tcontext.commit.author.presence?.statusText\n\t\t\t\t\t\t\t\t\t? ` (${context.commit.author.presence?.statusText})`\n\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t} to a Live Share Session`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn '$(live-share) Start a Live Share Session';\n\t\t\t\t},\n\t\t\t\trun: async (context: ActionContext) => {\n\t\t\t\t\tif (context.type !== 'hover.commands' || context.commit.author.name === 'You') {\n\t\t\t\t\t\tawait executeCommand<InviteToLiveShareCommandArgs>(Commands.InviteToLiveShare, {});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tawait executeCommand<InviteToLiveShareCommandArgs>(Commands.InviteToLiveShare, {\n\t\t\t\t\t\temail: context.commit.author.email,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t},\n\t\t),\n\t);\n}\n","import { version as codeVersion, env, ExtensionContext, extensions, window, workspace } from 'vscode';\nimport { isWeb } from '@env/platform';\nimport { Api } from './api/api';\nimport type { CreatePullRequestActionContext, GitLensApi, OpenPullRequestActionContext } from './api/gitlens';\nimport type { CreatePullRequestOnRemoteCommandArgs, OpenPullRequestOnRemoteCommandArgs } from './commands';\nimport { configuration, Configuration, OutputLevel } from './configuration';\nimport { Commands, ContextKeys } from './constants';\nimport { Container } from './container';\nimport { setContext } from './context';\nimport { GitUri } from './git/gitUri';\nimport { GitBranch, GitCommit } from './git/models';\nimport { Logger, LogLevel } from './logger';\nimport { Messages } from './messages';\nimport { registerPartnerActionRunners } from './partners';\nimport { StorageKeys, SyncedStorageKeys } from './storage';\nimport { executeCommand, registerCommands } from './system/command';\nimport { once } from './system/event';\nimport { Stopwatch } from './system/stopwatch';\nimport { compare } from './system/version';\nimport { ViewNode } from './views/nodes';\n\nexport async function activate(context: ExtensionContext): Promise<GitLensApi | undefined> {\n\tconst insiders = context.extension.id === 'eamodio.gitlens-insiders';\n\tconst gitlensVersion = context.extension.packageJSON.version;\n\n\tLogger.configure(context, configuration.get('outputLevel'), o => {\n\t\tif (GitUri.is(o)) {\n\t\t\treturn `GitUri(${o.toString(true)}${o.repoPath ? ` repoPath=${o.repoPath}` : ''}${\n\t\t\t\to.sha ? ` sha=${o.sha}` : ''\n\t\t\t})`;\n\t\t}\n\n\t\tif (GitCommit.is(o)) {\n\t\t\treturn `GitCommit(${o.sha ? ` sha=${o.sha}` : ''}${o.repoPath ? ` repoPath=${o.repoPath}` : ''})`;\n\t\t}\n\n\t\tif (ViewNode.is(o)) return o.toString();\n\n\t\treturn undefined;\n\t});\n\n\tconst sw = new Stopwatch(`GitLens${insiders ? ' (Insiders)' : ''} v${gitlensVersion}`, {\n\t\tlog: {\n\t\t\tmessage: ` activating in ${env.appName}(${codeVersion}) on the ${isWeb ? 'web' : 'desktop'}`,\n\t\t\t//${context.extensionRuntime !== ExtensionRuntime.Node ? ' in a webworker' : ''}\n\t\t},\n\t});\n\n\tif (insiders) {\n\t\t// Ensure that stable isn't also installed\n\t\tconst stable = extensions.getExtension('eamodio.gitlens');\n\t\tif (stable != null) {\n\t\t\tsw.stop({ message: ' was NOT activated because GitLens is also enabled' });\n\n\t\t\t// If we don't use a setTimeout here this notification will get lost for some reason\n\t\t\tsetTimeout(() => void Messages.showInsidersErrorMessage(), 0);\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tif (!workspace.isTrusted) {\n\t\tvoid setContext(ContextKeys.Untrusted, true);\n\t\tcontext.subscriptions.push(\n\t\t\tworkspace.onDidGrantWorkspaceTrust(() => void setContext(ContextKeys.Untrusted, undefined)),\n\t\t);\n\t}\n\n\tsetKeysForSync(context);\n\n\tconst syncedVersion = context.globalState.get<string>(SyncedStorageKeys.Version);\n\tconst localVersion =\n\t\tcontext.globalState.get<string>(StorageKeys.Version) ??\n\t\tcontext.globalState.get<string>(StorageKeys.Deprecated_Version);\n\n\tlet previousVersion: string | undefined;\n\tif (localVersion == null || syncedVersion == null) {\n\t\tpreviousVersion = syncedVersion ?? localVersion;\n\t} else if (compare(syncedVersion, localVersion) === 1) {\n\t\tpreviousVersion = syncedVersion;\n\t} else {\n\t\tpreviousVersion = localVersion;\n\t}\n\n\tlet exitMessage;\n\tif (Logger.enabled(LogLevel.Debug)) {\n\t\texitMessage = `syncedVersion=${syncedVersion}, localVersion=${localVersion}, previousVersion=${previousVersion}, welcome=${context.globalState.get<boolean>(\n\t\t\tSyncedStorageKeys.HomeViewWelcomeVisible,\n\t\t)}`;\n\t}\n\n\tif (previousVersion == null) {\n\t\tvoid context.globalState.update(SyncedStorageKeys.HomeViewWelcomeVisible, true);\n\t}\n\n\tConfiguration.configure(context);\n\tconst cfg = configuration.get();\n\t// await migrateSettings(context, previousVersion);\n\n\tconst container = Container.create(context, cfg);\n\tonce(container.onReady)(() => {\n\t\tcontext.subscriptions.push(...registerCommands(container));\n\t\tregisterBuiltInActionRunners(container);\n\t\tregisterPartnerActionRunners(context);\n\n\t\tvoid showWelcomeOrWhatsNew(container, gitlensVersion, previousVersion);\n\n\t\tvoid context.globalState.update(StorageKeys.Version, gitlensVersion);\n\n\t\t// Only update our synced version if the new version is greater\n\t\tif (syncedVersion == null || compare(gitlensVersion, syncedVersion) === 1) {\n\t\t\tvoid context.globalState.update(SyncedStorageKeys.Version, gitlensVersion);\n\t\t}\n\n\t\tif (cfg.outputLevel === OutputLevel.Debug) {\n\t\t\tsetTimeout(async () => {\n\t\t\t\tif (cfg.outputLevel !== OutputLevel.Debug) return;\n\n\t\t\t\tif (!container.insiders) {\n\t\t\t\t\tif (await Messages.showDebugLoggingWarningMessage()) {\n\t\t\t\t\t\tvoid executeCommand(Commands.DisableDebugLogging);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 60000);\n\t\t}\n\t});\n\n\t// Signal that the container is now ready\n\tawait container.ready();\n\n\t// Set a context to only show some commands when debugging\n\tif (container.debugging) {\n\t\tvoid setContext(ContextKeys.Debugging, true);\n\t}\n\n\tsw.stop({\n\t\tmessage: ` activated${exitMessage != null ? `, ${exitMessage}` : ''}${\n\t\t\tcfg.mode.active ? `, mode: ${cfg.mode.active}` : ''\n\t\t}`,\n\t});\n\n\tconst api = new Api(container);\n\treturn Promise.resolve(api);\n}\n\nexport function deactivate() {\n\t// nothing to do\n}\n\n// async function migrateSettings(context: ExtensionContext, previousVersion: string | undefined) {\n// \tif (previousVersion === undefined) return;\n\n// \tconst previous = fromString(previousVersion);\n\n// \ttry {\n// \t\tif (compare(previous, from(11, 0, 0)) !== 1) {\n// \t\t}\n// \t} catch (ex) {\n// \t\tLogger.error(ex, 'migrateSettings');\n// \t}\n// }\n\nfunction setKeysForSync(context: ExtensionContext, ...keys: (SyncedStorageKeys | string)[]) {\n\treturn context.globalState?.setKeysForSync([\n\t\t...keys,\n\t\tSyncedStorageKeys.Version,\n\t\tSyncedStorageKeys.HomeViewWelcomeVisible,\n\t]);\n}\n\nfunction registerBuiltInActionRunners(container: Container): void {\n\tcontainer.context.subscriptions.push(\n\t\tcontainer.actionRunners.registerBuiltIn<CreatePullRequestActionContext>('createPullRequest', {\n\t\t\tlabel: ctx => `Create Pull Request on ${ctx.remote?.provider?.name ?? 'Remote'}`,\n\t\t\trun: async ctx => {\n\t\t\t\tif (ctx.type !== 'createPullRequest') return;\n\n\t\t\t\tvoid (await executeCommand<CreatePullRequestOnRemoteCommandArgs>(Commands.CreatePullRequestOnRemote, {\n\t\t\t\t\tbase: undefined,\n\t\t\t\t\tcompare: ctx.branch.isRemote\n\t\t\t\t\t\t? GitBranch.getNameWithoutRemote(ctx.branch.name)\n\t\t\t\t\t\t: ctx.branch.upstream\n\t\t\t\t\t\t? GitBranch.getNameWithoutRemote(ctx.branch.upstream)\n\t\t\t\t\t\t: ctx.branch.name,\n\t\t\t\t\tremote: ctx.remote?.name ?? '',\n\t\t\t\t\trepoPath: ctx.repoPath,\n\t\t\t\t}));\n\t\t\t},\n\t\t}),\n\t\tcontainer.actionRunners.registerBuiltIn<OpenPullRequestActionContext>('openPullRequest', {\n\t\t\tlabel: ctx => `Open Pull Request on ${ctx.provider?.name ?? 'Remote'}`,\n\t\t\trun: async ctx => {\n\t\t\t\tif (ctx.type !== 'openPullRequest') return;\n\n\t\t\t\tvoid (await executeCommand<OpenPullRequestOnRemoteCommandArgs>(Commands.OpenPullRequestOnRemote, {\n\t\t\t\t\tpr: { url: ctx.pullRequest.url },\n\t\t\t\t}));\n\t\t\t},\n\t\t}),\n\t);\n}\n\nasync function showWelcomeOrWhatsNew(container: Container, version: string, previousVersion: string | undefined) {\n\tif (previousVersion == null) {\n\t\tLogger.log(`GitLens first-time install; window.focused=${window.state.focused}`);\n\n\t\tvoid executeCommand(Commands.ShowHomeView);\n\n\t\tif (container.config.showWelcomeOnInstall === false) return;\n\n\t\tif (window.state.focused) {\n\t\t\tawait container.storage.delete(StorageKeys.PendingWelcomeOnFocus);\n\t\t\tawait executeCommand(Commands.ShowWelcomePage);\n\t\t} else {\n\t\t\t// Save pending on window getting focus\n\t\t\tawait container.storage.store(StorageKeys.PendingWelcomeOnFocus, true);\n\t\t\tconst disposable = window.onDidChangeWindowState(e => {\n\t\t\t\tif (!e.focused) return;\n\n\t\t\t\tdisposable.dispose();\n\n\t\t\t\t// If the window is now focused and we are pending the welcome, clear the pending state and show the welcome\n\t\t\t\tif (container.storage.get(StorageKeys.PendingWelcomeOnFocus) === true) {\n\t\t\t\t\tvoid container.storage.delete(StorageKeys.PendingWelcomeOnFocus);\n\t\t\t\t\tif (container.config.showWelcomeOnInstall) {\n\t\t\t\t\t\tvoid executeCommand(Commands.ShowWelcomePage);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tcontainer.context.subscriptions.push(disposable);\n\t\t}\n\n\t\treturn;\n\t}\n\n\tif (previousVersion !== version) {\n\t\tLogger.log(`GitLens upgraded from v${previousVersion} to v${version}; window.focused=${window.state.focused}`);\n\t}\n\n\tconst [major, minor] = version.split('.').map(v => parseInt(v, 10));\n\tconst [prevMajor, prevMinor] = previousVersion.split('.').map(v => parseInt(v, 10));\n\n\t// Don't notify on downgrades\n\tif (major === prevMajor || major < prevMajor || (major === prevMajor && minor < prevMinor)) {\n\t\treturn;\n\t}\n\n\tif (major !== prevMajor) {\n\t\tversion = String(major);\n\t}\n\n\tvoid executeCommand(Commands.ShowHomeView);\n\n\tif (container.config.showWhatsNewAfterUpgrades) {\n\t\tif (window.state.focused) {\n\t\t\tawait container.storage.delete(StorageKeys.PendingWhatsNewOnFocus);\n\t\t\tawait Messages.showWhatsNewMessage(version);\n\t\t} else {\n\t\t\t// Save pending on window getting focus\n\t\t\tawait container.storage.store(StorageKeys.PendingWhatsNewOnFocus, true);\n\t\t\tconst disposable = window.onDidChangeWindowState(e => {\n\t\t\t\tif (!e.focused) return;\n\n\t\t\t\tdisposable.dispose();\n\n\t\t\t\t// If the window is now focused and we are pending the what's new, clear the pending state and show the what's new\n\t\t\t\tif (container.storage.get(StorageKeys.PendingWhatsNewOnFocus) === true) {\n\t\t\t\t\tvoid container.storage.delete(StorageKeys.PendingWhatsNewOnFocus);\n\t\t\t\t\tif (container.config.showWhatsNewAfterUpgrades) {\n\t\t\t\t\t\tvoid Messages.showWhatsNewMessage(version);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tcontainer.context.subscriptions.push(disposable);\n\t\t}\n\t}\n}\n"],"names":[],"sourceRoot":""}